(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var a,o,s=e[0],l=e[1],c=e[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(n[a]=l[a]);for(u&&u(e);p.length;)p.shift()();return i.push.apply(i,c||[]),t()}function t(){for(var n,e=0;e<i.length;e++){for(var t=i[e],a=!0,s=1;s<t.length;s++){var l=t[s];0!==r[l]&&(a=!1)}a&&(i.splice(e--,1),n=o(o.s=t[0]))}return n}var a={},r={3:0},i=[];function o(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.e=function(n){var e=[],t=r[n];if(0!==t)if(t)e.push(t[2]);else{var a=new Promise((function(e,a){t=r[n]=[e,a]}));e.push(t[2]=a);var i,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(n){return o.p+"assets/js/"+({}[n]||n)+"."+{1:"fd1255a5",2:"6d94c54d",4:"7295131e",5:"6dc33016",6:"aad427d0",7:"2d9b4140",8:"494b86d7",9:"1a802d57",10:"28618317",11:"a2c1770a",12:"99ef68d3",13:"174279e9",14:"7f8d5a89",15:"60691f27",16:"84316f53",17:"313a5236",18:"a3dc36cd",19:"b1380c4b",20:"afac5783",21:"ec15928f",22:"bfd60d5d",23:"db4d5213",24:"7b1a6548",25:"6bd3882b",26:"b298e3e1",27:"ed00434e",28:"166ca593",29:"721bf53a",30:"fa06fc51",31:"511c71b3",32:"69972fe9",33:"9adc8c9a",34:"036a6690",35:"4673109c",36:"0499e7fa",37:"cffafda4",38:"5943895c",39:"1d31562f",40:"0fc9c435",41:"935050de",42:"c6247737",43:"3e73fb91",44:"16783dd5",45:"198bbf8e",46:"fefa82bc",47:"df58f55f",48:"b8081d15",49:"b76eb7c8",50:"27c4af69",51:"269beb10",52:"7f212a35",53:"7d7f27e0",54:"8e9b10f4",55:"c890ec4c",56:"b62e6d3a",57:"f81a1737",58:"b83ec62f",59:"6d788480",60:"7ed433ac",61:"5b1a6315",62:"79abf8e1",63:"16167c41",64:"896b67b9",65:"ea6ec387",66:"2511dd8f",67:"086e2598",68:"c72f6ee5",69:"dc7bd478",70:"56ad8495",71:"c3c362f6",72:"75b1ca37",73:"8d9b93c3",74:"3fe9b852",75:"27412ba6",76:"74679cdb",77:"ce510f3d",78:"1af2d5a1",79:"819f2e49",80:"a0484722",81:"6bcc495b",82:"a78968c4",83:"77a0f1f5",84:"8aaec0ec",85:"5112dd13"}[n]+".js"}(n);var l=new Error;i=function(e){s.onerror=s.onload=null,clearTimeout(c);var t=r[n];if(0!==t){if(t){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;l.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",l.name="ChunkLoadError",l.type=a,l.request=i,t[1](l)}r[n]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:s})}),12e4);s.onerror=s.onload=i,document.head.appendChild(s)}return Promise.all(e)},o.m=n,o.c=a,o.d=function(n,e,t){o.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},o.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},o.t=function(n,e){if(1&e&&(n=o(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)o.d(t,a,function(e){return n[e]}.bind(null,a));return t},o.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return o.d(e,"a",e),e},o.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},o.p="/vblog/",o.oe=function(n){throw console.error(n),n};var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;i.push([134,0]),t()}([function(n,e,t){"use strict";t.d(e,"a",(function(){return Hn})),t.d(e,"b",(function(){return ta})),t.d(e,"c",(function(){return Ke})),t.d(e,"d",(function(){return pn})),t.d(e,"e",(function(){return Qe})),t.d(e,"f",(function(){return Ge})),t.d(e,"g",(function(){return Mn})),t.d(e,"h",(function(){return Bn})),t.d(e,"i",(function(){return Vn}));
/*!
 * Vue.js v2.7.14
 * (c) 2014-2022 Evan You
 * Released under the MIT License.
 */
var a=Object.freeze({}),r=Array.isArray;function i(n){return null==n}function o(n){return null!=n}function s(n){return!0===n}function l(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return"function"==typeof n}function u(n){return null!==n&&"object"==typeof n}var d=Object.prototype.toString;function p(n){return"[object Object]"===d.call(n)}function h(n){return"[object RegExp]"===d.call(n)}function f(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function m(n){return o(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function g(n){return null==n?"":Array.isArray(n)||p(n)&&n.toString===d?JSON.stringify(n,null,2):String(n)}function v(n){var e=parseFloat(n);return isNaN(e)?n:e}function y(n,e){for(var t=Object.create(null),a=n.split(","),r=0;r<a.length;r++)t[a[r]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}y("slot,component",!0);var b=y("key,ref,slot,slot-scope,is");function k(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var a=n.indexOf(e);if(a>-1)return n.splice(a,1)}}var w=Object.prototype.hasOwnProperty;function x(n,e){return w.call(n,e)}function S(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var _=/-(\w)/g,j=S((function(n){return n.replace(_,(function(n,e){return e?e.toUpperCase():""}))})),T=S((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),C=/\B([A-Z])/g,A=S((function(n){return n.replace(C,"-$1").toLowerCase()}));var I=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var a=arguments.length;return a?a>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function E(n,e){e=e||0;for(var t=n.length-e,a=new Array(t);t--;)a[t]=n[t+e];return a}function O(n,e){for(var t in e)n[t]=e[t];return n}function L(n){for(var e={},t=0;t<n.length;t++)n[t]&&O(e,n[t]);return e}function $(n,e,t){}var P=function(n,e,t){return!1},z=function(n){return n};function D(n,e){if(n===e)return!0;var t=u(n),a=u(e);if(!t||!a)return!t&&!a&&String(n)===String(e);try{var r=Array.isArray(n),i=Array.isArray(e);if(r&&i)return n.length===e.length&&n.every((function(n,t){return D(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(r||i)return!1;var o=Object.keys(n),s=Object.keys(e);return o.length===s.length&&o.every((function(t){return D(n[t],e[t])}))}catch(n){return!1}}function M(n,e){for(var t=0;t<n.length;t++)if(D(n[t],e))return t;return-1}function F(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function R(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var q=["component","directive","filter"],N=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],B={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:P,isReservedAttr:P,isUnknownElement:P,getTagNamespace:$,parsePlatformTagName:z,mustUseProp:P,async:!0,_lifecycleHooks:N},U=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function J(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function V(n,e,t,a){Object.defineProperty(n,e,{value:t,enumerable:!!a,writable:!0,configurable:!0})}var W=new RegExp("[^".concat(U.source,".$_\\d]"));var H="__proto__"in{},Q="undefined"!=typeof window,G=Q&&window.navigator.userAgent.toLowerCase(),K=G&&/msie|trident/.test(G),Y=G&&G.indexOf("msie 9.0")>0,X=G&&G.indexOf("edge/")>0;G&&G.indexOf("android");var Z=G&&/iphone|ipad|ipod|ios/.test(G);G&&/chrome\/\d+/.test(G),G&&/phantomjs/.test(G);var nn,en=G&&G.match(/firefox\/(\d+)/),tn={}.watch,an=!1;if(Q)try{var rn={};Object.defineProperty(rn,"passive",{get:function(){an=!0}}),window.addEventListener("test-passive",null,rn)}catch(n){}var on=function(){return void 0===nn&&(nn=!Q&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),nn},sn=Q&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function ln(n){return"function"==typeof n&&/native code/.test(n.toString())}var cn,un="undefined"!=typeof Symbol&&ln(Symbol)&&"undefined"!=typeof Reflect&&ln(Reflect.ownKeys);cn="undefined"!=typeof Set&&ln(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var dn=null;function pn(){return dn&&{proxy:dn}}function hn(n){void 0===n&&(n=null),n||dn&&dn._scope.off(),dn=n,n&&n._scope.on()}var fn=function(){function n(n,e,t,a,r,i,o,s){this.tag=n,this.data=e,this.children=t,this.text=a,this.elm=r,this.ns=void 0,this.context=i,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),mn=function(n){void 0===n&&(n="");var e=new fn;return e.text=n,e.isComment=!0,e};function gn(n){return new fn(void 0,void 0,void 0,String(n))}function vn(n){var e=new fn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var yn=0,bn=[],kn=function(){function n(){this._pending=!1,this.id=yn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,bn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,a=e.length;t<a;t++){0,e[t].update()}},n}();kn.target=null;var wn=[];function xn(n){wn.push(n),kn.target=n}function Sn(){wn.pop(),kn.target=wn[wn.length-1]}var _n=Array.prototype,jn=Object.create(_n);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=_n[n];V(jn,n,(function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var r,i=e.apply(this,t),o=this.__ob__;switch(n){case"push":case"unshift":r=t;break;case"splice":r=t.slice(2)}return r&&o.observeArray(r),o.dep.notify(),i}))}));var Tn=Object.getOwnPropertyNames(jn),Cn={},An=!0;function In(n){An=n}var En={notify:$,depend:$,addSub:$,removeSub:$},On=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?En:new kn,this.vmCount=0,V(n,"__ob__",this),r(n)){if(!t)if(H)n.__proto__=jn;else for(var a=0,i=Tn.length;a<i;a++){V(n,s=Tn[a],jn[s])}e||this.observeArray(n)}else{var o=Object.keys(n);for(a=0;a<o.length;a++){var s;$n(n,s=o[a],Cn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Ln(n[e],!1,this.mock)},n}();function Ln(n,e,t){return n&&x(n,"__ob__")&&n.__ob__ instanceof On?n.__ob__:!An||!t&&on()||!r(n)&&!p(n)||!Object.isExtensible(n)||n.__v_skip||Nn(n)||n instanceof fn?void 0:new On(n,e,t)}function $n(n,e,t,a,i,o){var s=new kn,l=Object.getOwnPropertyDescriptor(n,e);if(!l||!1!==l.configurable){var c=l&&l.get,u=l&&l.set;c&&!u||t!==Cn&&2!==arguments.length||(t=n[e]);var d=!i&&Ln(t,!1,o);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=c?c.call(n):t;return kn.target&&(s.depend(),d&&(d.dep.depend(),r(e)&&Dn(e))),Nn(e)&&!i?e.value:e},set:function(e){var a=c?c.call(n):t;if(R(a,e)){if(u)u.call(n,e);else{if(c)return;if(!i&&Nn(a)&&!Nn(e))return void(a.value=e);t=e}d=!i&&Ln(e,!1,o),s.notify()}}}),s}}function Pn(n,e,t){if(!qn(n)){var a=n.__ob__;return r(n)&&f(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),a&&!a.shallow&&a.mock&&Ln(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||a&&a.vmCount?t:a?($n(a.value,e,t,void 0,a.shallow,a.mock),a.dep.notify(),t):(n[e]=t,t)}}function zn(n,e){if(r(n)&&f(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||qn(n)||x(n,e)&&(delete n[e],t&&t.dep.notify())}}function Dn(n){for(var e=void 0,t=0,a=n.length;t<a;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),r(e)&&Dn(e)}function Mn(n){return Rn(n,!1),n}function Fn(n){return Rn(n,!0),V(n,"__v_isShallow",!0),n}function Rn(n,e){if(!qn(n)){Ln(n,e,on());0}}function qn(n){return!(!n||!n.__v_isReadonly)}function Nn(n){return!(!n||!0!==n.__v_isRef)}function Bn(n){return Un(n,!1)}function Un(n,e){if(Nn(n))return n;var t={};return V(t,"__v_isRef",!0),V(t,"__v_isShallow",e),V(t,"dep",$n(t,"value",n,null,e,on())),t}function Jn(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(Nn(n))return n.value;var a=n&&n.__ob__;return a&&a.dep.depend(),n},set:function(n){var a=e[t];Nn(a)&&!Nn(n)?a.value=n:e[t]=n}})}function Vn(n){var e=r(n)?new Array(n.length):{};for(var t in n)e[t]=Wn(n,t);return e}function Wn(n,e,t){var a=n[e];if(Nn(a))return a;var r={get value(){var a=n[e];return void 0===a?t:a},set value(t){n[e]=t}};return V(r,"__v_isRef",!0),r}function Hn(n,e){var t,a,r=c(n);r?(t=n,a=$):(t=n.get,a=n.set);var i=on()?null:new et(dn,t,$,{lazy:!0});var o={effect:i,get value(){return i?(i.dirty&&i.evaluate(),kn.target&&i.depend(),i.value):t()},set value(n){a(n)}};return V(o,"__v_isRef",!0),V(o,"__v_isReadonly",r),o}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var Qn;var Gn=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Qn,!n&&Qn&&(this.index=(Qn.scopes||(Qn.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=Qn;try{return Qn=this,n()}finally{Qn=e}}else 0},n.prototype.on=function(){Qn=this},n.prototype.off=function(){Qn=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0,this.active=!1}},n}();function Kn(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Yn=S((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),a="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=a?n.slice(1):n,once:t,capture:a,passive:e}}));function Xn(n,e){function t(){var n=t.fns;if(!r(n))return Pe(n,null,arguments,e,"v-on handler");for(var a=n.slice(),i=0;i<a.length;i++)Pe(a[i],null,arguments,e,"v-on handler")}return t.fns=n,t}function Zn(n,e,t,a,r,o){var l,c,u,d;for(l in n)c=n[l],u=e[l],d=Yn(l),i(c)||(i(u)?(i(c.fns)&&(c=n[l]=Xn(c,o)),s(d.once)&&(c=n[l]=r(d.name,c,d.capture)),t(d.name,c,d.capture,d.passive,d.params)):c!==u&&(u.fns=c,n[l]=u));for(l in e)i(n[l])&&a((d=Yn(l)).name,e[l],d.capture)}function ne(n,e,t){var a;n instanceof fn&&(n=n.data.hook||(n.data.hook={}));var r=n[e];function l(){t.apply(this,arguments),k(a.fns,l)}i(r)?a=Xn([l]):o(r.fns)&&s(r.merged)?(a=r).fns.push(l):a=Xn([r,l]),a.merged=!0,n[e]=a}function ee(n,e,t,a,r){if(o(e)){if(x(e,t))return n[t]=e[t],r||delete e[t],!0;if(x(e,a))return n[t]=e[a],r||delete e[a],!0}return!1}function te(n){return l(n)?[gn(n)]:r(n)?function n(e,t){var a,c,u,d,p=[];for(a=0;a<e.length;a++)i(c=e[a])||"boolean"==typeof c||(u=p.length-1,d=p[u],r(c)?c.length>0&&(ae((c=n(c,"".concat(t||"","_").concat(a)))[0])&&ae(d)&&(p[u]=gn(d.text+c[0].text),c.shift()),p.push.apply(p,c)):l(c)?ae(d)?p[u]=gn(d.text+c):""!==c&&p.push(gn(c)):ae(c)&&ae(d)?p[u]=gn(d.text+c.text):(s(e._isVList)&&o(c.tag)&&i(c.key)&&o(t)&&(c.key="__vlist".concat(t,"_").concat(a,"__")),p.push(c)));return p}(n):void 0}function ae(n){return o(n)&&o(n.text)&&!1===n.isComment}function re(n,e){var t,a,i,s,l=null;if(r(n)||"string"==typeof n)for(l=new Array(n.length),t=0,a=n.length;t<a;t++)l[t]=e(n[t],t);else if("number"==typeof n)for(l=new Array(n),t=0;t<n;t++)l[t]=e(t+1,t);else if(u(n))if(un&&n[Symbol.iterator]){l=[];for(var c=n[Symbol.iterator](),d=c.next();!d.done;)l.push(e(d.value,l.length)),d=c.next()}else for(i=Object.keys(n),l=new Array(i.length),t=0,a=i.length;t<a;t++)s=i[t],l[t]=e(n[s],s,t);return o(l)||(l=[]),l._isVList=!0,l}function ie(n,e,t,a){var r,i=this.$scopedSlots[n];i?(t=t||{},a&&(t=O(O({},a),t)),r=i(t)||(c(e)?e():e)):r=this.$slots[n]||(c(e)?e():e);var o=t&&t.slot;return o?this.$createElement("template",{slot:o},r):r}function oe(n){return qt(this.$options,"filters",n,!0)||z}function se(n,e){return r(n)?-1===n.indexOf(e):n!==e}function le(n,e,t,a,r){var i=B.keyCodes[e]||t;return r&&a&&!B.keyCodes[e]?se(r,a):i?se(i,n):a?A(a)!==e:void 0===n}function ce(n,e,t,a,i){if(t)if(u(t)){r(t)&&(t=L(t));var o=void 0,s=function(r){if("class"===r||"style"===r||b(r))o=n;else{var s=n.attrs&&n.attrs.type;o=a||B.mustUseProp(e,s,r)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var l=j(r),c=A(r);l in o||c in o||(o[r]=t[r],i&&((n.on||(n.on={}))["update:".concat(r)]=function(n){t[r]=n}))};for(var l in t)s(l)}else;return n}function ue(n,e){var t=this._staticTrees||(this._staticTrees=[]),a=t[n];return a&&!e||pe(a=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),a}function de(n,e,t){return pe(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function pe(n,e,t){if(r(n))for(var a=0;a<n.length;a++)n[a]&&"string"!=typeof n[a]&&he(n[a],"".concat(e,"_").concat(a),t);else he(n,e,t)}function he(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function fe(n,e){if(e)if(p(e)){var t=n.on=n.on?O({},n.on):{};for(var a in e){var r=t[a],i=e[a];t[a]=r?[].concat(r,i):i}}else;return n}function me(n,e,t,a){e=e||{$stable:!t};for(var i=0;i<n.length;i++){var o=n[i];r(o)?me(o,e,t):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return a&&(e.$key=a),e}function ge(n,e){for(var t=0;t<e.length;t+=2){var a=e[t];"string"==typeof a&&a&&(n[e[t]]=e[t+1])}return n}function ve(n,e){return"string"==typeof n?e+n:n}function ye(n){n._o=de,n._n=v,n._s=g,n._l=re,n._t=ie,n._q=D,n._i=M,n._m=ue,n._f=oe,n._k=le,n._b=ce,n._v=gn,n._e=mn,n._u=me,n._g=fe,n._d=ge,n._p=ve}function be(n,e){if(!n||!n.length)return{};for(var t={},a=0,r=n.length;a<r;a++){var i=n[a],o=i.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,i.context!==e&&i.fnContext!==e||!o||null==o.slot)(t.default||(t.default=[])).push(i);else{var s=o.slot,l=t[s]||(t[s]=[]);"template"===i.tag?l.push.apply(l,i.children||[]):l.push(i)}}for(var c in t)t[c].every(ke)&&delete t[c];return t}function ke(n){return n.isComment&&!n.asyncFactory||" "===n.text}function we(n){return n.isComment&&n.asyncFactory}function xe(n,e,t,r){var i,o=Object.keys(t).length>0,s=e?!!e.$stable:!o,l=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(s&&r&&r!==a&&l===r.$key&&!o&&!r.$hasNormal)return r;for(var c in i={},e)e[c]&&"$"!==c[0]&&(i[c]=Se(n,t,c,e[c]))}else i={};for(var u in t)u in i||(i[u]=_e(t,u));return e&&Object.isExtensible(e)&&(e._normalized=i),V(i,"$stable",s),V(i,"$key",l),V(i,"$hasNormal",o),i}function Se(n,e,t,a){var i=function(){var e=dn;hn(n);var t=arguments.length?a.apply(null,arguments):a({}),i=(t=t&&"object"==typeof t&&!r(t)?[t]:te(t))&&t[0];return hn(e),t&&(!i||1===t.length&&i.isComment&&!we(i))?void 0:t};return a.proxy&&Object.defineProperty(e,t,{get:i,enumerable:!0,configurable:!0}),i}function _e(n,e){return function(){return n[e]}}function je(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};V(e,"_v_attr_proxy",!0),Te(e,n.$attrs,a,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||Te(n._listenersProxy={},n.$listeners,a,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||Ae(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:I(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return Jn(n,e,t)}))}}}function Te(n,e,t,a,r){var i=!1;for(var o in e)o in n?e[o]!==t[o]&&(i=!0):(i=!0,Ce(n,o,a,r));for(var o in n)o in e||(i=!0,delete n[o]);return i}function Ce(n,e,t,a){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[a][e]}})}function Ae(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var Ie=null;function Ee(n,e){return(n.__esModule||un&&"Module"===n[Symbol.toStringTag])&&(n=n.default),u(n)?e.extend(n):n}function Oe(n){if(r(n))for(var e=0;e<n.length;e++){var t=n[e];if(o(t)&&(o(t.componentOptions)||we(t)))return t}}function Le(n,e,t,a,d,p){return(r(t)||l(t))&&(d=a,a=t,t=void 0),s(p)&&(d=2),function(n,e,t,a,l){if(o(t)&&o(t.__ob__))return mn();o(t)&&o(t.is)&&(e=t.is);if(!e)return mn();0;r(a)&&c(a[0])&&((t=t||{}).scopedSlots={default:a[0]},a.length=0);2===l?a=te(a):1===l&&(a=function(n){for(var e=0;e<n.length;e++)if(r(n[e]))return Array.prototype.concat.apply([],n);return n}(a));var d,p;if("string"==typeof e){var h=void 0;p=n.$vnode&&n.$vnode.ns||B.getTagNamespace(e),d=B.isReservedTag(e)?new fn(B.parsePlatformTagName(e),t,a,void 0,void 0,n):t&&t.pre||!o(h=qt(n.$options,"components",e))?new fn(e,t,a,void 0,void 0,n):Et(h,t,n,a,e)}else d=Et(e,t,n,a);return r(d)?d:o(d)?(o(p)&&function n(e,t,a){e.ns=t,"foreignObject"===e.tag&&(t=void 0,a=!0);if(o(e.children))for(var r=0,l=e.children.length;r<l;r++){var c=e.children[r];o(c.tag)&&(i(c.ns)||s(a)&&"svg"!==c.tag)&&n(c,t,a)}}(d,p),o(t)&&function(n){u(n.style)&&Xe(n.style);u(n.class)&&Xe(n.class)}(t),d):mn()}(n,e,t,a,d)}function $e(n,e,t){xn();try{if(e)for(var a=e;a=a.$parent;){var r=a.$options.errorCaptured;if(r)for(var i=0;i<r.length;i++)try{if(!1===r[i].call(a,n,e,t))return}catch(n){ze(n,a,"errorCaptured hook")}}ze(n,e,t)}finally{Sn()}}function Pe(n,e,t,a,r){var i;try{(i=t?n.apply(e,t):n.call(e))&&!i._isVue&&m(i)&&!i._handled&&(i.catch((function(n){return $e(n,a,r+" (Promise/async)")})),i._handled=!0)}catch(n){$e(n,a,r)}return i}function ze(n,e,t){if(B.errorHandler)try{return B.errorHandler.call(null,n,e,t)}catch(e){e!==n&&De(e,null,"config.errorHandler")}De(n,e,t)}function De(n,e,t){if(!Q||"undefined"==typeof console)throw n;console.error(n)}var Me,Fe=!1,Re=[],qe=!1;function Ne(){qe=!1;var n=Re.slice(0);Re.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&ln(Promise)){var Be=Promise.resolve();Me=function(){Be.then(Ne),Z&&setTimeout($)},Fe=!0}else if(K||"undefined"==typeof MutationObserver||!ln(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Me="undefined"!=typeof setImmediate&&ln(setImmediate)?function(){setImmediate(Ne)}:function(){setTimeout(Ne,0)};else{var Ue=1,Je=new MutationObserver(Ne),Ve=document.createTextNode(String(Ue));Je.observe(Ve,{characterData:!0}),Me=function(){Ue=(Ue+1)%2,Ve.data=String(Ue)},Fe=!0}function We(n,e){var t;if(Re.push((function(){if(n)try{n.call(e)}catch(n){$e(n,e,"nextTick")}else t&&t(e)})),qe||(qe=!0,Me()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function He(n){return function(e,t){if(void 0===t&&(t=dn),t)return function(n,e,t){var a=n.$options;a[e]=Dt(a[e],t)}(t,n,e)}}He("beforeMount");var Qe=He("mounted"),Ge=(He("beforeUpdate"),He("updated"));He("beforeDestroy"),He("destroyed"),He("activated"),He("deactivated"),He("serverPrefetch"),He("renderTracked"),He("renderTriggered"),He("errorCaptured");function Ke(n){return n}var Ye=new cn;function Xe(n){return function n(e,t){var a,i,o=r(e);if(!o&&!u(e)||e.__v_skip||Object.isFrozen(e)||e instanceof fn)return;if(e.__ob__){var s=e.__ob__.dep.id;if(t.has(s))return;t.add(s)}if(o)for(a=e.length;a--;)n(e[a],t);else if(Nn(e))n(e.value,t);else for(i=Object.keys(e),a=i.length;a--;)n(e[i[a]],t)}(n,Ye),Ye.clear(),n}var Ze,nt=0,et=function(){function n(n,e,t,a,r){var i,o;i=this,void 0===(o=Qn&&!Qn._vm?Qn:n?n._scope:void 0)&&(o=Qn),o&&o.active&&o.effects.push(i),(this.vm=n)&&r&&(n._watcher=this),a?(this.deep=!!a.deep,this.user=!!a.user,this.lazy=!!a.lazy,this.sync=!!a.sync,this.before=a.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++nt,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new cn,this.newDepIds=new cn,this.expression="",c(e)?this.getter=e:(this.getter=function(n){if(!W.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=$)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;xn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;$e(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Xe(n),Sn(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():xt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||u(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');Pe(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&k(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function tt(n,e){Ze.$on(n,e)}function at(n,e){Ze.$off(n,e)}function rt(n,e){var t=Ze;return function a(){var r=e.apply(null,arguments);null!==r&&t.$off(n,a)}}function it(n,e,t){Ze=n,Zn(e,t||{},tt,at,rt,n),Ze=void 0}var ot=null;function st(n){var e=ot;return ot=n,function(){ot=e}}function lt(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function ct(n,e){if(e){if(n._directInactive=!1,lt(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)ct(n.$children[t]);ut(n,"activated")}}function ut(n,e,t,a){void 0===a&&(a=!0),xn();var r=dn;a&&hn(n);var i=n.$options[e],o="".concat(e," hook");if(i)for(var s=0,l=i.length;s<l;s++)Pe(i[s],n,t||null,n,o);n._hasHookEvent&&n.$emit("hook:"+e),a&&hn(r),Sn()}var dt=[],pt=[],ht={},ft=!1,mt=!1,gt=0;var vt=0,yt=Date.now;if(Q&&!K){var bt=window.performance;bt&&"function"==typeof bt.now&&yt()>document.createEvent("Event").timeStamp&&(yt=function(){return bt.now()})}var kt=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function wt(){var n,e;for(vt=yt(),mt=!0,dt.sort(kt),gt=0;gt<dt.length;gt++)(n=dt[gt]).before&&n.before(),e=n.id,ht[e]=null,n.run();var t=pt.slice(),a=dt.slice();gt=dt.length=pt.length=0,ht={},ft=mt=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,ct(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],a=t.vm;a&&a._watcher===t&&a._isMounted&&!a._isDestroyed&&ut(a,"updated")}}(a),function(){for(var n=0;n<bn.length;n++){var e=bn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}bn.length=0}(),sn&&B.devtools&&sn.emit("flush")}function xt(n){var e=n.id;if(null==ht[e]&&(n!==kn.target||!n.noRecurse)){if(ht[e]=!0,mt){for(var t=dt.length-1;t>gt&&dt[t].id>n.id;)t--;dt.splice(t+1,0,n)}else dt.push(n);ft||(ft=!0,We(wt))}}function St(n,e){if(n){for(var t=Object.create(null),a=un?Reflect.ownKeys(n):Object.keys(n),r=0;r<a.length;r++){var i=a[r];if("__ob__"!==i){var o=n[i].from;if(o in e._provided)t[i]=e._provided[o];else if("default"in n[i]){var s=n[i].default;t[i]=c(s)?s.call(e):s}else 0}}return t}}function _t(n,e,t,i,o){var l,c=this,u=o.options;x(i,"_uid")?(l=Object.create(i))._original=i:(l=i,i=i._original);var d=s(u._compiled),p=!d;this.data=n,this.props=e,this.children=t,this.parent=i,this.listeners=n.on||a,this.injections=St(u.inject,i),this.slots=function(){return c.$slots||xe(i,n.scopedSlots,c.$slots=be(t,i)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return xe(i,n.scopedSlots,this.slots())}}),d&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=xe(i,n.scopedSlots,this.$slots)),u._scopeId?this._c=function(n,e,t,a){var o=Le(l,n,e,t,a,p);return o&&!r(o)&&(o.fnScopeId=u._scopeId,o.fnContext=i),o}:this._c=function(n,e,t,a){return Le(l,n,e,t,a,p)}}function jt(n,e,t,a,r){var i=vn(n);return i.fnContext=t,i.fnOptions=a,e.slot&&((i.data||(i.data={})).slot=e.slot),i}function Tt(n,e){for(var t in e)n[j(t)]=e[t]}function Ct(n){return n.name||n.__name||n._componentTag}ye(_t.prototype);var At={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;At.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},a=n.data.inlineTemplate;o(a)&&(t.render=a.render,t.staticRenderFns=a.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,ot)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,r,i){var o=r.data.scopedSlots,s=n.$scopedSlots,l=!!(o&&!o.$stable||s!==a&&!s.$stable||o&&n.$scopedSlots.$key!==o.$key||!o&&n.$scopedSlots.$key),c=!!(i||n.$options._renderChildren||l),u=n.$vnode;n.$options._parentVnode=r,n.$vnode=r,n._vnode&&(n._vnode.parent=r),n.$options._renderChildren=i;var d=r.data.attrs||a;n._attrsProxy&&Te(n._attrsProxy,d,u.data&&u.data.attrs||a,n,"$attrs")&&(c=!0),n.$attrs=d,t=t||a;var p=n.$options._parentListeners;if(n._listenersProxy&&Te(n._listenersProxy,t,p||a,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,it(n,t,p),e&&n.$options.props){In(!1);for(var h=n._props,f=n.$options._propKeys||[],m=0;m<f.length;m++){var g=f[m],v=n.$options.props;h[g]=Nt(g,v,e,n)}In(!0),n.$options.propsData=e}c&&(n.$slots=be(i,r.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,a=n.componentInstance;a._isMounted||(a._isMounted=!0,ut(a,"mounted")),n.data.keepAlive&&(t._isMounted?((e=a)._inactive=!1,pt.push(e)):ct(a,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,lt(e))||e._inactive)){e._inactive=!0;for(var a=0;a<e.$children.length;a++)n(e.$children[a]);ut(e,"deactivated")}}(e,!0):e.$destroy())}},It=Object.keys(At);function Et(n,e,t,l,c){if(!i(n)){var d=t.$options._base;if(u(n)&&(n=d.extend(n)),"function"==typeof n){var p;if(i(n.cid)&&void 0===(n=function(n,e){if(s(n.error)&&o(n.errorComp))return n.errorComp;if(o(n.resolved))return n.resolved;var t=Ie;if(t&&o(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),s(n.loading)&&o(n.loadingComp))return n.loadingComp;if(t&&!o(n.owners)){var a=n.owners=[t],r=!0,l=null,c=null;t.$on("hook:destroyed",(function(){return k(a,t)}));var d=function(n){for(var e=0,t=a.length;e<t;e++)a[e].$forceUpdate();n&&(a.length=0,null!==l&&(clearTimeout(l),l=null),null!==c&&(clearTimeout(c),c=null))},p=F((function(t){n.resolved=Ee(t,e),r?a.length=0:d(!0)})),h=F((function(e){o(n.errorComp)&&(n.error=!0,d(!0))})),f=n(p,h);return u(f)&&(m(f)?i(n.resolved)&&f.then(p,h):m(f.component)&&(f.component.then(p,h),o(f.error)&&(n.errorComp=Ee(f.error,e)),o(f.loading)&&(n.loadingComp=Ee(f.loading,e),0===f.delay?n.loading=!0:l=setTimeout((function(){l=null,i(n.resolved)&&i(n.error)&&(n.loading=!0,d(!1))}),f.delay||200)),o(f.timeout)&&(c=setTimeout((function(){c=null,i(n.resolved)&&h(null)}),f.timeout)))),r=!1,n.loading?n.loadingComp:n.resolved}}(p=n,d)))return function(n,e,t,a,r){var i=mn();return i.asyncFactory=n,i.asyncMeta={data:e,context:t,children:a,tag:r},i}(p,e,t,l,c);e=e||{},ea(n),o(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",a=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var i=e.on||(e.on={}),s=i[a],l=e.model.callback;o(s)?(r(s)?-1===s.indexOf(l):s!==l)&&(i[a]=[l].concat(s)):i[a]=l}(n.options,e);var h=function(n,e,t){var a=e.options.props;if(!i(a)){var r={},s=n.attrs,l=n.props;if(o(s)||o(l))for(var c in a){var u=A(c);ee(r,l,c,u,!0)||ee(r,s,c,u,!1)}return r}}(e,n);if(s(n.options.functional))return function(n,e,t,i,s){var l=n.options,c={},u=l.props;if(o(u))for(var d in u)c[d]=Nt(d,u,e||a);else o(t.attrs)&&Tt(c,t.attrs),o(t.props)&&Tt(c,t.props);var p=new _t(t,c,s,i,n),h=l.render.call(null,p._c,p);if(h instanceof fn)return jt(h,t,p.parent,l,p);if(r(h)){for(var f=te(h)||[],m=new Array(f.length),g=0;g<f.length;g++)m[g]=jt(f[g],t,p.parent,l,p);return m}}(n,h,e,t,l);var f=e.on;if(e.on=e.nativeOn,s(n.options.abstract)){var g=e.slot;e={},g&&(e.slot=g)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<It.length;t++){var a=It[t],r=e[a],i=At[a];r===i||r&&r._merged||(e[a]=r?Ot(i,r):i)}}(e);var v=Ct(n.options)||c;return new fn("vue-component-".concat(n.cid).concat(v?"-".concat(v):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:h,listeners:f,tag:c,children:l},p)}}}function Ot(n,e){var t=function(t,a){n(t,a),e(t,a)};return t._merged=!0,t}var Lt=$,$t=B.optionMergeStrategies;function Pt(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var a,r,i,o=un?Reflect.ownKeys(e):Object.keys(e),s=0;s<o.length;s++)"__ob__"!==(a=o[s])&&(r=n[a],i=e[a],t&&x(n,a)?r!==i&&p(r)&&p(i)&&Pt(r,i):Pn(n,a,i));return n}function zt(n,e,t){return t?function(){var a=c(e)?e.call(t,t):e,r=c(n)?n.call(t,t):n;return a?Pt(a,r):r}:e?n?function(){return Pt(c(e)?e.call(this,this):e,c(n)?n.call(this,this):n)}:e:n}function Dt(n,e){var t=e?n?n.concat(e):r(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function Mt(n,e,t,a){var r=Object.create(n||null);return e?O(r,e):r}$t.data=function(n,e,t){return t?zt(n,e,t):e&&"function"!=typeof e?n:zt(n,e)},N.forEach((function(n){$t[n]=Dt})),q.forEach((function(n){$t[n+"s"]=Mt})),$t.watch=function(n,e,t,a){if(n===tn&&(n=void 0),e===tn&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var i={};for(var o in O(i,n),e){var s=i[o],l=e[o];s&&!r(s)&&(s=[s]),i[o]=s?s.concat(l):r(l)?l:[l]}return i},$t.props=$t.methods=$t.inject=$t.computed=function(n,e,t,a){if(!n)return e;var r=Object.create(null);return O(r,n),e&&O(r,e),r},$t.provide=function(n,e){return n?function(){var t=Object.create(null);return Pt(t,c(n)?n.call(this):n),e&&Pt(t,c(e)?e.call(this):e,!1),t}:e};var Ft=function(n,e){return void 0===e?n:e};function Rt(n,e,t){if(c(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var a,i,o={};if(r(t))for(a=t.length;a--;)"string"==typeof(i=t[a])&&(o[j(i)]={type:null});else if(p(t))for(var s in t)i=t[s],o[j(s)]=p(i)?i:{type:i};else 0;n.props=o}}(e),function(n,e){var t=n.inject;if(t){var a=n.inject={};if(r(t))for(var i=0;i<t.length;i++)a[t[i]]={from:t[i]};else if(p(t))for(var o in t){var s=t[o];a[o]=p(s)?O({from:o},s):{from:s}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var a=e[t];c(a)&&(e[t]={bind:a,update:a})}}(e),!e._base&&(e.extends&&(n=Rt(n,e.extends,t)),e.mixins))for(var a=0,i=e.mixins.length;a<i;a++)n=Rt(n,e.mixins[a],t);var o,s={};for(o in n)l(o);for(o in e)x(n,o)||l(o);function l(a){var r=$t[a]||Ft;s[a]=r(n[a],e[a],t,a)}return s}function qt(n,e,t,a){if("string"==typeof t){var r=n[e];if(x(r,t))return r[t];var i=j(t);if(x(r,i))return r[i];var o=T(i);return x(r,o)?r[o]:r[t]||r[i]||r[o]}}function Nt(n,e,t,a){var r=e[n],i=!x(t,n),o=t[n],s=Vt(Boolean,r.type);if(s>-1)if(i&&!x(r,"default"))o=!1;else if(""===o||o===A(n)){var l=Vt(String,r.type);(l<0||s<l)&&(o=!0)}if(void 0===o){o=function(n,e,t){if(!x(e,"default"))return;var a=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return c(a)&&"Function"!==Ut(e.type)?a.call(n):a}(a,r,n);var u=An;In(!0),Ln(o),In(u)}return o}var Bt=/^\s*function (\w+)/;function Ut(n){var e=n&&n.toString().match(Bt);return e?e[1]:""}function Jt(n,e){return Ut(n)===Ut(e)}function Vt(n,e){if(!r(e))return Jt(e,n)?0:-1;for(var t=0,a=e.length;t<a;t++)if(Jt(e[t],n))return t;return-1}var Wt={enumerable:!0,configurable:!0,get:$,set:$};function Ht(n,e,t){Wt.get=function(){return this[e][t]},Wt.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Wt)}function Qt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},a=n._props=Fn({}),r=n.$options._propKeys=[];n.$parent&&In(!1);var i=function(i){r.push(i);var o=Nt(i,e,t,n);$n(a,i,o),i in n||Ht(n,"_props",i)};for(var o in e)i(o);In(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var a=n._setupContext=je(n);hn(n),xn();var r=Pe(t,null,[n._props||Fn({}),a],n,"setup");if(Sn(),hn(),c(r))e.render=r;else if(u(r))if(n._setupState=r,r.__sfc){var i=n._setupProxy={};for(var o in r)"__sfc"!==o&&Jn(i,r,o)}else for(var o in r)J(o)||Jn(n,r,o);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?$:I(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;p(e=n._data=c(e)?function(n,e){xn();try{return n.call(e,e)}catch(n){return $e(n,e,"data()"),{}}finally{Sn()}}(e,n):e||{})||(e={});var t=Object.keys(e),a=n.$options.props,r=(n.$options.methods,t.length);for(;r--;){var i=t[r];0,a&&x(a,i)||J(i)||Ht(n,"_data",i)}var o=Ln(e);o&&o.vmCount++}(n);else{var t=Ln(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),a=on();for(var r in e){var i=e[r],o=c(i)?i:i.get;0,a||(t[r]=new et(n,o||$,$,Gt)),r in n||Kt(n,r,i)}}(n,e.computed),e.watch&&e.watch!==tn&&function(n,e){for(var t in e){var a=e[t];if(r(a))for(var i=0;i<a.length;i++)Zt(n,t,a[i]);else Zt(n,t,a)}}(n,e.watch)}var Gt={lazy:!0};function Kt(n,e,t){var a=!on();c(t)?(Wt.get=a?Yt(e):Xt(t),Wt.set=$):(Wt.get=t.get?a&&!1!==t.cache?Yt(e):Xt(t.get):$,Wt.set=t.set||$),Object.defineProperty(n,e,Wt)}function Yt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),kn.target&&e.depend(),e.value}}function Xt(n){return function(){return n.call(this,this)}}function Zt(n,e,t,a){return p(t)&&(a=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,a)}var na=0;function ea(n){var e=n.options;if(n.super){var t=ea(n.super);if(t!==n.superOptions){n.superOptions=t;var a=function(n){var e,t=n.options,a=n.sealedOptions;for(var r in t)t[r]!==a[r]&&(e||(e={}),e[r]=t[r]);return e}(n);a&&O(n.extendOptions,a),(e=n.options=Rt(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function ta(n){this._init(n)}function aa(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,a=t.cid,r=n._Ctor||(n._Ctor={});if(r[a])return r[a];var i=Ct(n)||Ct(t.options);var o=function(n){this._init(n)};return(o.prototype=Object.create(t.prototype)).constructor=o,o.cid=e++,o.options=Rt(t.options,n),o.super=t,o.options.props&&function(n){var e=n.options.props;for(var t in e)Ht(n.prototype,"_props",t)}(o),o.options.computed&&function(n){var e=n.options.computed;for(var t in e)Kt(n.prototype,t,e[t])}(o),o.extend=t.extend,o.mixin=t.mixin,o.use=t.use,q.forEach((function(n){o[n]=t[n]})),i&&(o.options.components[i]=o),o.superOptions=t.options,o.extendOptions=n,o.sealedOptions=O({},o.options),r[a]=o,o}}function ra(n){return n&&(Ct(n.Ctor.options)||n.tag)}function ia(n,e){return r(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!h(n)&&n.test(e)}function oa(n,e){var t=n.cache,a=n.keys,r=n._vnode;for(var i in t){var o=t[i];if(o){var s=o.name;s&&!e(s)&&sa(t,i,a,r)}}}function sa(n,e,t,a){var r=n[e];!r||a&&r.tag===a.tag||r.componentInstance.$destroy(),n[e]=null,k(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=na++,e._isVue=!0,e.__v_skip=!0,e._scope=new Gn(!0),e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),a=e._parentVnode;t.parent=e.parent,t._parentVnode=a;var r=a.componentOptions;t.propsData=r.propsData,t._parentListeners=r.listeners,t._renderChildren=r.children,t._componentTag=r.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=Rt(ea(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&it(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,r=t&&t.context;n.$slots=be(e._renderChildren,r),n.$scopedSlots=t?xe(n.$parent,t.data.scopedSlots,n.$slots):a,n._c=function(e,t,a,r){return Le(n,e,t,a,r,!1)},n.$createElement=function(e,t,a,r){return Le(n,e,t,a,r,!0)};var i=t&&t.data;$n(n,"$attrs",i&&i.attrs||a,null,!0),$n(n,"$listeners",e._parentListeners||a,null,!0)}(e),ut(e,"beforeCreate",void 0,!1),function(n){var e=St(n.$options.inject,n);e&&(In(!1),Object.keys(e).forEach((function(t){$n(n,t,e[t])})),In(!0))}(e),Qt(e),function(n){var e=n.$options.provide;if(e){var t=c(e)?e.call(n):e;if(!u(t))return;for(var a=Kn(n),r=un?Reflect.ownKeys(t):Object.keys(t),i=0;i<r.length;i++){var o=r[i];Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(t,o))}}}(e),ut(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(ta),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=Pn,n.prototype.$delete=zn,n.prototype.$watch=function(n,e,t){if(p(e))return Zt(this,n,e,t);(t=t||{}).user=!0;var a=new et(this,n,e,t);if(t.immediate){var r='callback for immediate watcher "'.concat(a.expression,'"');xn(),Pe(e,this,[a.value],this,r),Sn()}return function(){a.teardown()}}}(ta),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var a=this;if(r(n))for(var i=0,o=n.length;i<o;i++)a.$on(n[i],t);else(a._events[n]||(a._events[n]=[])).push(t),e.test(n)&&(a._hasHookEvent=!0);return a},n.prototype.$once=function(n,e){var t=this;function a(){t.$off(n,a),e.apply(t,arguments)}return a.fn=e,t.$on(n,a),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(r(n)){for(var a=0,i=n.length;a<i;a++)t.$off(n[a],e);return t}var o,s=t._events[n];if(!s)return t;if(!e)return t._events[n]=null,t;for(var l=s.length;l--;)if((o=s[l])===e||o.fn===e){s.splice(l,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?E(t):t;for(var a=E(arguments,1),r='event handler for "'.concat(n,'"'),i=0,o=t.length;i<o;i++)Pe(t[i],e,a,e,r)}return e}}(ta),function(n){n.prototype._update=function(n,e){var t=this,a=t.$el,r=t._vnode,i=st(t);t._vnode=n,t.$el=r?t.__patch__(r,n):t.__patch__(t.$el,n,e,!1),i(),a&&(a.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var o=t;o&&o.$vnode&&o.$parent&&o.$vnode===o.$parent._vnode;)o.$parent.$el=o.$el,o=o.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){ut(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||k(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),ut(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(ta),function(n){ye(n.prototype),n.prototype.$nextTick=function(n){return We(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,a=t.render,i=t._parentVnode;i&&e._isMounted&&(e.$scopedSlots=xe(e.$parent,i.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&Ae(e._slotsProxy,e.$scopedSlots)),e.$vnode=i;try{hn(e),Ie=e,n=a.call(e._renderProxy,e.$createElement)}catch(t){$e(t,e,"render"),n=e._vnode}finally{Ie=null,hn()}return r(n)&&1===n.length&&(n=n[0]),n instanceof fn||(n=mn()),n.parent=i,n}}(ta);var la=[String,RegExp,Array],ca={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:la,exclude:la,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,a=this.keyToCache;if(t){var r=t.tag,i=t.componentInstance,o=t.componentOptions;n[a]={name:ra(o),tag:r,componentInstance:i},e.push(a),this.max&&e.length>parseInt(this.max)&&sa(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)sa(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){oa(n,(function(n){return ia(e,n)}))})),this.$watch("exclude",(function(e){oa(n,(function(n){return!ia(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Oe(n),t=e&&e.componentOptions;if(t){var a=ra(t),r=this.include,i=this.exclude;if(r&&(!a||!ia(r,a))||i&&a&&ia(i,a))return e;var o=this.cache,s=this.keys,l=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;o[l]?(e.componentInstance=o[l].componentInstance,k(s,l),s.push(l)):(this.vnodeToCache=e,this.keyToCache=l),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return B}};Object.defineProperty(n,"config",e),n.util={warn:Lt,extend:O,mergeOptions:Rt,defineReactive:$n},n.set=Pn,n.delete=zn,n.nextTick=We,n.observable=function(n){return Ln(n),n},n.options=Object.create(null),q.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,O(n.options.components,ca),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=E(arguments,1);return t.unshift(this),c(n.install)?n.install.apply(n,t):c(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=Rt(this.options,n),this}}(n),aa(n),function(n){q.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&p(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&c(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(ta),Object.defineProperty(ta.prototype,"$isServer",{get:on}),Object.defineProperty(ta.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(ta,"FunctionalRenderContext",{value:_t}),ta.version="2.7.14";var ua=y("style,class"),da=y("input,textarea,option,select,progress"),pa=y("contenteditable,draggable,spellcheck"),ha=y("events,caret,typing,plaintext-only"),fa=y("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),ma="http://www.w3.org/1999/xlink",ga=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},va=function(n){return ga(n)?n.slice(6,n.length):""},ya=function(n){return null==n||!1===n};function ba(n){for(var e=n.data,t=n,a=n;o(a.componentInstance);)(a=a.componentInstance._vnode)&&a.data&&(e=ka(a.data,e));for(;o(t=t.parent);)t&&t.data&&(e=ka(e,t.data));return function(n,e){if(o(n)||o(e))return wa(n,xa(e));return""}(e.staticClass,e.class)}function ka(n,e){return{staticClass:wa(n.staticClass,e.staticClass),class:o(n.class)?[n.class,e.class]:e.class}}function wa(n,e){return n?e?n+" "+e:n:e||""}function xa(n){return Array.isArray(n)?function(n){for(var e,t="",a=0,r=n.length;a<r;a++)o(e=xa(n[a]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):u(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var Sa={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},_a=y("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),ja=y("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Ta=function(n){return _a(n)||ja(n)};var Ca=Object.create(null);var Aa=y("text,number,password,search,email,tel,url");var Ia=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(Sa[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),Ea={create:function(n,e){Oa(e)},update:function(n,e){n.data.ref!==e.data.ref&&(Oa(n,!0),Oa(e))},destroy:function(n){Oa(n,!0)}};function Oa(n,e){var t=n.data.ref;if(o(t)){var a=n.context,i=n.componentInstance||n.elm,s=e?null:i,l=e?void 0:i;if(c(t))Pe(t,a,[s],a,"template ref function");else{var u=n.data.refInFor,d="string"==typeof t||"number"==typeof t,p=Nn(t),h=a.$refs;if(d||p)if(u){var f=d?h[t]:t.value;e?r(f)&&k(f,i):r(f)?f.includes(i)||f.push(i):d?(h[t]=[i],La(a,t,h[t])):t.value=[i]}else if(d){if(e&&h[t]!==i)return;h[t]=l,La(a,t,s)}else if(p){if(e&&t.value!==i)return;t.value=s}else 0}}}function La(n,e,t){var a=n._setupState;a&&x(a,e)&&(Nn(a[e])?a[e].value=t:a[e]=t)}var $a=new fn("",{},[]),Pa=["create","activate","update","remove","destroy"];function za(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&o(n.data)===o(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,a=o(t=n.data)&&o(t=t.attrs)&&t.type,r=o(t=e.data)&&o(t=t.attrs)&&t.type;return a===r||Aa(a)&&Aa(r)}(n,e)||s(n.isAsyncPlaceholder)&&i(e.asyncFactory.error))}function Da(n,e,t){var a,r,i={};for(a=e;a<=t;++a)o(r=n[a].key)&&(i[r]=a);return i}var Ma={create:Fa,update:Fa,destroy:function(n){Fa(n,$a)}};function Fa(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,a,r,i=n===$a,o=e===$a,s=qa(n.data.directives,n.context),l=qa(e.data.directives,e.context),c=[],u=[];for(t in l)a=s[t],r=l[t],a?(r.oldValue=a.value,r.oldArg=a.arg,Ba(r,"update",e,n),r.def&&r.def.componentUpdated&&u.push(r)):(Ba(r,"bind",e,n),r.def&&r.def.inserted&&c.push(r));if(c.length){var d=function(){for(var t=0;t<c.length;t++)Ba(c[t],"inserted",e,n)};i?ne(e,"insert",d):d()}u.length&&ne(e,"postpatch",(function(){for(var t=0;t<u.length;t++)Ba(u[t],"componentUpdated",e,n)}));if(!i)for(t in s)l[t]||Ba(s[t],"unbind",n,n,o)}(n,e)}var Ra=Object.create(null);function qa(n,e){var t,a,r=Object.create(null);if(!n)return r;for(t=0;t<n.length;t++){if((a=n[t]).modifiers||(a.modifiers=Ra),r[Na(a)]=a,e._setupState&&e._setupState.__sfc){var i=a.def||qt(e,"_setupState","v-"+a.name);a.def="function"==typeof i?{bind:i,update:i}:i}a.def=a.def||qt(e.$options,"directives",a.name)}return r}function Na(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function Ba(n,e,t,a,r){var i=n.def&&n.def[e];if(i)try{i(t.elm,n,t,a,r)}catch(a){$e(a,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var Ua=[Ea,Ma];function Ja(n,e){var t=e.componentOptions;if(!(o(t)&&!1===t.Ctor.options.inheritAttrs||i(n.data.attrs)&&i(e.data.attrs))){var a,r,l=e.elm,c=n.data.attrs||{},u=e.data.attrs||{};for(a in(o(u.__ob__)||s(u._v_attr_proxy))&&(u=e.data.attrs=O({},u)),u)r=u[a],c[a]!==r&&Va(l,a,r,e.data.pre);for(a in(K||X)&&u.value!==c.value&&Va(l,"value",u.value),c)i(u[a])&&(ga(a)?l.removeAttributeNS(ma,va(a)):pa(a)||l.removeAttribute(a))}}function Va(n,e,t,a){a||n.tagName.indexOf("-")>-1?Wa(n,e,t):fa(e)?ya(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):pa(e)?n.setAttribute(e,function(n,e){return ya(e)||"false"===e?"false":"contenteditable"===n&&ha(e)?e:"true"}(e,t)):ga(e)?ya(t)?n.removeAttributeNS(ma,va(e)):n.setAttributeNS(ma,e,t):Wa(n,e,t)}function Wa(n,e,t){if(ya(t))n.removeAttribute(e);else{if(K&&!Y&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var a=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",a)};n.addEventListener("input",a),n.__ieph=!0}n.setAttribute(e,t)}}var Ha={create:Ja,update:Ja};function Qa(n,e){var t=e.elm,a=e.data,r=n.data;if(!(i(a.staticClass)&&i(a.class)&&(i(r)||i(r.staticClass)&&i(r.class)))){var s=ba(e),l=t._transitionClasses;o(l)&&(s=wa(s,xa(l))),s!==t._prevClass&&(t.setAttribute("class",s),t._prevClass=s)}}var Ga,Ka={create:Qa,update:Qa};function Ya(n,e,t){var a=Ga;return function r(){var i=e.apply(null,arguments);null!==i&&nr(n,r,t,a)}}var Xa=Fe&&!(en&&Number(en[1])<=53);function Za(n,e,t,a){if(Xa){var r=vt,i=e;e=i._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=r||n.timeStamp<=0||n.target.ownerDocument!==document)return i.apply(this,arguments)}}Ga.addEventListener(n,e,an?{capture:t,passive:a}:t)}function nr(n,e,t,a){(a||Ga).removeEventListener(n,e._wrapper||e,t)}function er(n,e){if(!i(n.data.on)||!i(e.data.on)){var t=e.data.on||{},a=n.data.on||{};Ga=e.elm||n.elm,function(n){if(o(n.__r)){var e=K?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}o(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),Zn(t,a,Za,nr,Ya,e.context),Ga=void 0}}var tr,ar={create:er,update:er,destroy:function(n){return er(n,$a)}};function rr(n,e){if(!i(n.data.domProps)||!i(e.data.domProps)){var t,a,r=e.elm,l=n.data.domProps||{},c=e.data.domProps||{};for(t in(o(c.__ob__)||s(c._v_attr_proxy))&&(c=e.data.domProps=O({},c)),l)t in c||(r[t]="");for(t in c){if(a=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),a===l[t])continue;1===r.childNodes.length&&r.removeChild(r.childNodes[0])}if("value"===t&&"PROGRESS"!==r.tagName){r._value=a;var u=i(a)?"":String(a);ir(r,u)&&(r.value=u)}else if("innerHTML"===t&&ja(r.tagName)&&i(r.innerHTML)){(tr=tr||document.createElement("div")).innerHTML="<svg>".concat(a,"</svg>");for(var d=tr.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;d.firstChild;)r.appendChild(d.firstChild)}else if(a!==l[t])try{r[t]=a}catch(n){}}}}function ir(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,a=n._vModifiers;if(o(a)){if(a.number)return v(t)!==v(e);if(a.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var or={create:rr,update:rr},sr=S((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var a=n.split(t);a.length>1&&(e[a[0].trim()]=a[1].trim())}})),e}));function lr(n){var e=cr(n.style);return n.staticStyle?O(n.staticStyle,e):e}function cr(n){return Array.isArray(n)?L(n):"string"==typeof n?sr(n):n}var ur,dr=/^--/,pr=/\s*!important$/,hr=function(n,e,t){if(dr.test(e))n.style.setProperty(e,t);else if(pr.test(t))n.style.setProperty(A(e),t.replace(pr,""),"important");else{var a=mr(e);if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n.style[a]=t[r];else n.style[a]=t}},fr=["Webkit","Moz","ms"],mr=S((function(n){if(ur=ur||document.createElement("div").style,"filter"!==(n=j(n))&&n in ur)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<fr.length;t++){var a=fr[t]+e;if(a in ur)return a}}));function gr(n,e){var t=e.data,a=n.data;if(!(i(t.staticStyle)&&i(t.style)&&i(a.staticStyle)&&i(a.style))){var r,s,l=e.elm,c=a.staticStyle,u=a.normalizedStyle||a.style||{},d=c||u,p=cr(e.data.style)||{};e.data.normalizedStyle=o(p.__ob__)?O({},p):p;var h=function(n,e){var t,a={};if(e)for(var r=n;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(t=lr(r.data))&&O(a,t);(t=lr(n.data))&&O(a,t);for(var i=n;i=i.parent;)i.data&&(t=lr(i.data))&&O(a,t);return a}(e,!0);for(s in d)i(h[s])&&hr(l,s,"");for(s in h)(r=h[s])!==d[s]&&hr(l,s,null==r?"":r)}}var vr={create:gr,update:gr},yr=/\s+/;function br(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(yr).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function kr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(yr).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),a=" "+e+" ";t.indexOf(a)>=0;)t=t.replace(a," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function wr(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&O(e,xr(n.name||"v")),O(e,n),e}return"string"==typeof n?xr(n):void 0}}var xr=S((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),Sr=Q&&!Y,_r="transition",jr="transitionend",Tr="animation",Cr="animationend";Sr&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(_r="WebkitTransition",jr="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Tr="WebkitAnimation",Cr="webkitAnimationEnd"));var Ar=Q?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function Ir(n){Ar((function(){Ar(n)}))}function Er(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),br(n,e))}function Or(n,e){n._transitionClasses&&k(n._transitionClasses,e),kr(n,e)}function Lr(n,e,t){var a=Pr(n,e),r=a.type,i=a.timeout,o=a.propCount;if(!r)return t();var s="transition"===r?jr:Cr,l=0,c=function(){n.removeEventListener(s,u),t()},u=function(e){e.target===n&&++l>=o&&c()};setTimeout((function(){l<o&&c()}),i+1),n.addEventListener(s,u)}var $r=/\b(transform|all)(,|$)/;function Pr(n,e){var t,a=window.getComputedStyle(n),r=(a[_r+"Delay"]||"").split(", "),i=(a[_r+"Duration"]||"").split(", "),o=zr(r,i),s=(a[Tr+"Delay"]||"").split(", "),l=(a[Tr+"Duration"]||"").split(", "),c=zr(s,l),u=0,d=0;return"transition"===e?o>0&&(t="transition",u=o,d=i.length):"animation"===e?c>0&&(t="animation",u=c,d=l.length):d=(t=(u=Math.max(o,c))>0?o>c?"transition":"animation":null)?"transition"===t?i.length:l.length:0,{type:t,timeout:u,propCount:d,hasTransform:"transition"===t&&$r.test(a[_r+"Property"])}}function zr(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Dr(e)+Dr(n[t])})))}function Dr(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function Mr(n,e){var t=n.elm;o(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var a=wr(n.data.transition);if(!i(a)&&!o(t._enterCb)&&1===t.nodeType){for(var r=a.css,s=a.type,l=a.enterClass,d=a.enterToClass,p=a.enterActiveClass,h=a.appearClass,f=a.appearToClass,m=a.appearActiveClass,g=a.beforeEnter,y=a.enter,b=a.afterEnter,k=a.enterCancelled,w=a.beforeAppear,x=a.appear,S=a.afterAppear,_=a.appearCancelled,j=a.duration,T=ot,C=ot.$vnode;C&&C.parent;)T=C.context,C=C.parent;var A=!T._isMounted||!n.isRootInsert;if(!A||x||""===x){var I=A&&h?h:l,E=A&&m?m:p,O=A&&f?f:d,L=A&&w||g,$=A&&c(x)?x:y,P=A&&S||b,z=A&&_||k,D=v(u(j)?j.enter:j);0;var M=!1!==r&&!Y,R=qr($),q=t._enterCb=F((function(){M&&(Or(t,O),Or(t,E)),q.cancelled?(M&&Or(t,I),z&&z(t)):P&&P(t),t._enterCb=null}));n.data.show||ne(n,"insert",(function(){var e=t.parentNode,a=e&&e._pending&&e._pending[n.key];a&&a.tag===n.tag&&a.elm._leaveCb&&a.elm._leaveCb(),$&&$(t,q)})),L&&L(t),M&&(Er(t,I),Er(t,E),Ir((function(){Or(t,I),q.cancelled||(Er(t,O),R||(Rr(D)?setTimeout(q,D):Lr(t,s,q)))}))),n.data.show&&(e&&e(),$&&$(t,q)),M||R||q()}}}function Fr(n,e){var t=n.elm;o(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var a=wr(n.data.transition);if(i(a)||1!==t.nodeType)return e();if(!o(t._leaveCb)){var r=a.css,s=a.type,l=a.leaveClass,c=a.leaveToClass,d=a.leaveActiveClass,p=a.beforeLeave,h=a.leave,f=a.afterLeave,m=a.leaveCancelled,g=a.delayLeave,y=a.duration,b=!1!==r&&!Y,k=qr(h),w=v(u(y)?y.leave:y);0;var x=t._leaveCb=F((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),b&&(Or(t,c),Or(t,d)),x.cancelled?(b&&Or(t,l),m&&m(t)):(e(),f&&f(t)),t._leaveCb=null}));g?g(S):S()}function S(){x.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),p&&p(t),b&&(Er(t,l),Er(t,d),Ir((function(){Or(t,l),x.cancelled||(Er(t,c),k||(Rr(w)?setTimeout(x,w):Lr(t,s,x)))}))),h&&h(t,x),b||k||x())}}function Rr(n){return"number"==typeof n&&!isNaN(n)}function qr(n){if(i(n))return!1;var e=n.fns;return o(e)?qr(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Nr(n,e){!0!==e.data.show&&Mr(e)}var Br=function(n){var e,t,a={},c=n.modules,u=n.nodeOps;for(e=0;e<Pa.length;++e)for(a[Pa[e]]=[],t=0;t<c.length;++t)o(c[t][Pa[e]])&&a[Pa[e]].push(c[t][Pa[e]]);function d(n){var e=u.parentNode(n);o(e)&&u.removeChild(e,n)}function p(n,e,t,r,i,l,c){if(o(n.elm)&&o(l)&&(n=l[c]=vn(n)),n.isRootInsert=!i,!function(n,e,t,r){var i=n.data;if(o(i)){var l=o(n.componentInstance)&&i.keepAlive;if(o(i=i.hook)&&o(i=i.init)&&i(n,!1),o(n.componentInstance))return h(n,e),f(t,n.elm,r),s(l)&&function(n,e,t,r){var i,s=n;for(;s.componentInstance;)if(s=s.componentInstance._vnode,o(i=s.data)&&o(i=i.transition)){for(i=0;i<a.activate.length;++i)a.activate[i]($a,s);e.push(s);break}f(t,n.elm,r)}(n,e,t,r),!0}}(n,e,t,r)){var d=n.data,p=n.children,g=n.tag;o(g)?(n.elm=n.ns?u.createElementNS(n.ns,g):u.createElement(g,n),b(n),m(n,p,e),o(d)&&v(n,e),f(t,n.elm,r)):s(n.isComment)?(n.elm=u.createComment(n.text),f(t,n.elm,r)):(n.elm=u.createTextNode(n.text),f(t,n.elm,r))}}function h(n,e){o(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,g(n)?(v(n,e),b(n)):(Oa(n),e.push(n))}function f(n,e,t){o(n)&&(o(t)?u.parentNode(t)===n&&u.insertBefore(n,e,t):u.appendChild(n,e))}function m(n,e,t){if(r(e)){0;for(var a=0;a<e.length;++a)p(e[a],t,n.elm,null,!0,e,a)}else l(n.text)&&u.appendChild(n.elm,u.createTextNode(String(n.text)))}function g(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return o(n.tag)}function v(n,t){for(var r=0;r<a.create.length;++r)a.create[r]($a,n);o(e=n.data.hook)&&(o(e.create)&&e.create($a,n),o(e.insert)&&t.push(n))}function b(n){var e;if(o(e=n.fnScopeId))u.setStyleScope(n.elm,e);else for(var t=n;t;)o(e=t.context)&&o(e=e.$options._scopeId)&&u.setStyleScope(n.elm,e),t=t.parent;o(e=ot)&&e!==n.context&&e!==n.fnContext&&o(e=e.$options._scopeId)&&u.setStyleScope(n.elm,e)}function k(n,e,t,a,r,i){for(;a<=r;++a)p(t[a],i,n,e,!1,t,a)}function w(n){var e,t,r=n.data;if(o(r))for(o(e=r.hook)&&o(e=e.destroy)&&e(n),e=0;e<a.destroy.length;++e)a.destroy[e](n);if(o(e=n.children))for(t=0;t<n.children.length;++t)w(n.children[t])}function x(n,e,t){for(;e<=t;++e){var a=n[e];o(a)&&(o(a.tag)?(S(a),w(a)):d(a.elm))}}function S(n,e){if(o(e)||o(n.data)){var t,r=a.remove.length+1;for(o(e)?e.listeners+=r:e=function(n,e){function t(){0==--t.listeners&&d(n)}return t.listeners=e,t}(n.elm,r),o(t=n.componentInstance)&&o(t=t._vnode)&&o(t.data)&&S(t,e),t=0;t<a.remove.length;++t)a.remove[t](n,e);o(t=n.data.hook)&&o(t=t.remove)?t(n,e):e()}else d(n.elm)}function _(n,e,t,a){for(var r=t;r<a;r++){var i=e[r];if(o(i)&&za(n,i))return r}}function j(n,e,t,r,l,c){if(n!==e){o(e.elm)&&o(r)&&(e=r[l]=vn(e));var d=e.elm=n.elm;if(s(n.isAsyncPlaceholder))o(e.asyncFactory.resolved)?A(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(s(e.isStatic)&&s(n.isStatic)&&e.key===n.key&&(s(e.isCloned)||s(e.isOnce)))e.componentInstance=n.componentInstance;else{var h,f=e.data;o(f)&&o(h=f.hook)&&o(h=h.prepatch)&&h(n,e);var m=n.children,v=e.children;if(o(f)&&g(e)){for(h=0;h<a.update.length;++h)a.update[h](n,e);o(h=f.hook)&&o(h=h.update)&&h(n,e)}i(e.text)?o(m)&&o(v)?m!==v&&function(n,e,t,a,r){var s,l,c,d=0,h=0,f=e.length-1,m=e[0],g=e[f],v=t.length-1,y=t[0],b=t[v],w=!r;for(0;d<=f&&h<=v;)i(m)?m=e[++d]:i(g)?g=e[--f]:za(m,y)?(j(m,y,a,t,h),m=e[++d],y=t[++h]):za(g,b)?(j(g,b,a,t,v),g=e[--f],b=t[--v]):za(m,b)?(j(m,b,a,t,v),w&&u.insertBefore(n,m.elm,u.nextSibling(g.elm)),m=e[++d],b=t[--v]):za(g,y)?(j(g,y,a,t,h),w&&u.insertBefore(n,g.elm,m.elm),g=e[--f],y=t[++h]):(i(s)&&(s=Da(e,d,f)),i(l=o(y.key)?s[y.key]:_(y,e,d,f))?p(y,a,n,m.elm,!1,t,h):za(c=e[l],y)?(j(c,y,a,t,h),e[l]=void 0,w&&u.insertBefore(n,c.elm,m.elm)):p(y,a,n,m.elm,!1,t,h),y=t[++h]);d>f?k(n,i(t[v+1])?null:t[v+1].elm,t,h,v,a):h>v&&x(e,d,f)}(d,m,v,t,c):o(v)?(o(n.text)&&u.setTextContent(d,""),k(d,null,v,0,v.length-1,t)):o(m)?x(m,0,m.length-1):o(n.text)&&u.setTextContent(d,""):n.text!==e.text&&u.setTextContent(d,e.text),o(f)&&o(h=f.hook)&&o(h=h.postpatch)&&h(n,e)}}}function T(n,e,t){if(s(t)&&o(n.parent))n.parent.data.pendingInsert=e;else for(var a=0;a<e.length;++a)e[a].data.hook.insert(e[a])}var C=y("attrs,class,staticClass,staticStyle,key");function A(n,e,t,a){var r,i=e.tag,l=e.data,c=e.children;if(a=a||l&&l.pre,e.elm=n,s(e.isComment)&&o(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(o(l)&&(o(r=l.hook)&&o(r=r.init)&&r(e,!0),o(r=e.componentInstance)))return h(e,t),!0;if(o(i)){if(o(c))if(n.hasChildNodes())if(o(r=l)&&o(r=r.domProps)&&o(r=r.innerHTML)){if(r!==n.innerHTML)return!1}else{for(var u=!0,d=n.firstChild,p=0;p<c.length;p++){if(!d||!A(d,c[p],t,a)){u=!1;break}d=d.nextSibling}if(!u||d)return!1}else m(e,c,t);if(o(l)){var f=!1;for(var g in l)if(!C(g)){f=!0,v(e,t);break}!f&&l.class&&Xe(l.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,r){if(!i(e)){var l,c=!1,d=[];if(i(n))c=!0,p(e,d);else{var h=o(n.nodeType);if(!h&&za(n,e))j(n,e,d,null,null,r);else{if(h){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),s(t)&&A(n,e,d))return T(e,d,!0),n;l=n,n=new fn(u.tagName(l).toLowerCase(),{},[],void 0,l)}var f=n.elm,m=u.parentNode(f);if(p(e,d,f._leaveCb?null:m,u.nextSibling(f)),o(e.parent))for(var v=e.parent,y=g(e);v;){for(var b=0;b<a.destroy.length;++b)a.destroy[b](v);if(v.elm=e.elm,y){for(var k=0;k<a.create.length;++k)a.create[k]($a,v);var S=v.data.hook.insert;if(S.merged)for(var _=1;_<S.fns.length;_++)S.fns[_]()}else Oa(v);v=v.parent}o(m)?x([n],0,0):o(n.tag)&&w(n)}}return T(e,d,c),e.elm}o(n)&&w(n)}}({nodeOps:Ia,modules:[Ha,Ka,ar,or,vr,Q?{create:Nr,activate:Nr,remove:function(n,e){!0!==n.data.show?Fr(n,e):e()}}:{}].concat(Ua)});Y&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&Kr(n,"input")}));var Ur={inserted:function(n,e,t,a){"select"===t.tag?(a.elm&&!a.elm._vOptions?ne(t,"postpatch",(function(){Ur.componentUpdated(n,e,t)})):Jr(n,e,t.context),n._vOptions=[].map.call(n.options,Hr)):("textarea"===t.tag||Aa(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",Qr),n.addEventListener("compositionend",Gr),n.addEventListener("change",Gr),Y&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Jr(n,e,t.context);var a=n._vOptions,r=n._vOptions=[].map.call(n.options,Hr);if(r.some((function(n,e){return!D(n,a[e])})))(n.multiple?e.value.some((function(n){return Wr(n,r)})):e.value!==e.oldValue&&Wr(e.value,r))&&Kr(n,"change")}}};function Jr(n,e,t){Vr(n,e,t),(K||X)&&setTimeout((function(){Vr(n,e,t)}),0)}function Vr(n,e,t){var a=e.value,r=n.multiple;if(!r||Array.isArray(a)){for(var i,o,s=0,l=n.options.length;s<l;s++)if(o=n.options[s],r)i=M(a,Hr(o))>-1,o.selected!==i&&(o.selected=i);else if(D(Hr(o),a))return void(n.selectedIndex!==s&&(n.selectedIndex=s));r||(n.selectedIndex=-1)}}function Wr(n,e){return e.every((function(e){return!D(e,n)}))}function Hr(n){return"_value"in n?n._value:n.value}function Qr(n){n.target.composing=!0}function Gr(n){n.target.composing&&(n.target.composing=!1,Kr(n.target,"input"))}function Kr(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function Yr(n){return!n.componentInstance||n.data&&n.data.transition?n:Yr(n.componentInstance._vnode)}var Xr={model:Ur,show:{bind:function(n,e,t){var a=e.value,r=(t=Yr(t)).data&&t.data.transition,i=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;a&&r?(t.data.show=!0,Mr(t,(function(){n.style.display=i}))):n.style.display=a?i:"none"},update:function(n,e,t){var a=e.value;!a!=!e.oldValue&&((t=Yr(t)).data&&t.data.transition?(t.data.show=!0,a?Mr(t,(function(){n.style.display=n.__vOriginalDisplay})):Fr(t,(function(){n.style.display="none"}))):n.style.display=a?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,a,r){r||(n.style.display=n.__vOriginalDisplay)}}},Zr={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function ni(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?ni(Oe(e.children)):n}function ei(n){var e={},t=n.$options;for(var a in t.propsData)e[a]=n[a];var r=t._parentListeners;for(var a in r)e[j(a)]=r[a];return e}function ti(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var ai=function(n){return n.tag||we(n)},ri=function(n){return"show"===n.name},ii={name:"transition",props:Zr,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(ai)).length){0;var a=this.mode;0;var r=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return r;var i=ni(r);if(!i)return r;if(this._leaving)return ti(n,r);var o="__transition-".concat(this._uid,"-");i.key=null==i.key?i.isComment?o+"comment":o+i.tag:l(i.key)?0===String(i.key).indexOf(o)?i.key:o+i.key:i.key;var s=(i.data||(i.data={})).transition=ei(this),c=this._vnode,u=ni(c);if(i.data.directives&&i.data.directives.some(ri)&&(i.data.show=!0),u&&u.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(i,u)&&!we(u)&&(!u.componentInstance||!u.componentInstance._vnode.isComment)){var d=u.data.transition=O({},s);if("out-in"===a)return this._leaving=!0,ne(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),ti(n,r);if("in-out"===a){if(we(i))return c;var p,h=function(){p()};ne(s,"afterEnter",h),ne(s,"enterCancelled",h),ne(d,"delayLeave",(function(n){p=n}))}}return r}}},oi=O({tag:String,moveClass:String},Zr);function si(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function li(n){n.data.newPos=n.elm.getBoundingClientRect()}function ci(n){var e=n.data.pos,t=n.data.newPos,a=e.left-t.left,r=e.top-t.top;if(a||r){n.data.moved=!0;var i=n.elm.style;i.transform=i.WebkitTransform="translate(".concat(a,"px,").concat(r,"px)"),i.transitionDuration="0s"}}delete oi.mode;var ui={Transition:ii,TransitionGroup:{props:oi,beforeMount:function(){var n=this,e=this._update;this._update=function(t,a){var r=st(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,r(),e.call(n,t,a)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),a=this.prevChildren=this.children,r=this.$slots.default||[],i=this.children=[],o=ei(this),s=0;s<r.length;s++){if((u=r[s]).tag)if(null!=u.key&&0!==String(u.key).indexOf("__vlist"))i.push(u),t[u.key]=u,(u.data||(u.data={})).transition=o;else;}if(a){var l=[],c=[];for(s=0;s<a.length;s++){var u;(u=a[s]).data.transition=o,u.data.pos=u.elm.getBoundingClientRect(),t[u.key]?l.push(u):c.push(u)}this.kept=n(e,null,l),this.removed=c}return n(e,null,i)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(si),n.forEach(li),n.forEach(ci),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,a=t.style;Er(t,e),a.transform=a.WebkitTransform=a.transitionDuration="",t.addEventListener(jr,t._moveCb=function n(a){a&&a.target!==t||a&&!/transform$/.test(a.propertyName)||(t.removeEventListener(jr,n),t._moveCb=null,Or(t,e))})}})))},methods:{hasMove:function(n,e){if(!Sr)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){kr(t,n)})),br(t,e),t.style.display="none",this.$el.appendChild(t);var a=Pr(t);return this.$el.removeChild(t),this._hasMove=a.hasTransform}}}};ta.config.mustUseProp=function(n,e,t){return"value"===t&&da(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},ta.config.isReservedTag=Ta,ta.config.isReservedAttr=ua,ta.config.getTagNamespace=function(n){return ja(n)?"svg":"math"===n?"math":void 0},ta.config.isUnknownElement=function(n){if(!Q)return!0;if(Ta(n))return!1;if(n=n.toLowerCase(),null!=Ca[n])return Ca[n];var e=document.createElement(n);return n.indexOf("-")>-1?Ca[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Ca[n]=/HTMLUnknownElement/.test(e.toString())},O(ta.options.directives,Xr),O(ta.options.components,ui),ta.prototype.__patch__=Q?Br:$,ta.prototype.$mount=function(n,e){return function(n,e,t){var a;n.$el=e,n.$options.render||(n.$options.render=mn),ut(n,"beforeMount"),a=function(){n._update(n._render(),t)},new et(n,a,$,{before:function(){n._isMounted&&!n._isDestroyed&&ut(n,"beforeUpdate")}},!0),t=!1;var r=n._preWatchers;if(r)for(var i=0;i<r.length;i++)r[i].run();return null==n.$vnode&&(n._isMounted=!0,ut(n,"mounted")),n}(this,n=n&&Q?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},Q&&setTimeout((function(){B.devtools&&sn&&sn.emit("init",ta)}),0)},function(n,e,t){"use strict";function a(n,e,t,a,r,i,o,s){var l,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),a&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),o?(l=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),r&&r.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(o)},c._ssrRegister=l):r&&(l=s?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(n,e){return l.call(e),u(n,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:n,options:c}}t.d(e,"a",(function(){return a}))},function(n,e,t){var a=t(70),r=a.all;n.exports=a.IS_HTMLDDA?function(n){return"function"==typeof n||n===r}:function(n){return"function"==typeof n}},function(n,e,t){"use strict";var a=t(114),r=Object.prototype.toString;function i(n){return"[object Array]"===r.call(n)}function o(n){return void 0===n}function s(n){return null!==n&&"object"==typeof n}function l(n){if("[object Object]"!==r.call(n))return!1;var e=Object.getPrototypeOf(n);return null===e||e===Object.prototype}function c(n){return"[object Function]"===r.call(n)}function u(n,e){if(null!=n)if("object"!=typeof n&&(n=[n]),i(n))for(var t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.call(null,n[r],r,n)}n.exports={isArray:i,isArrayBuffer:function(n){return"[object ArrayBuffer]"===r.call(n)},isBuffer:function(n){return null!==n&&!o(n)&&null!==n.constructor&&!o(n.constructor)&&"function"==typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)},isFormData:function(n){return"undefined"!=typeof FormData&&n instanceof FormData},isArrayBufferView:function(n){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&n.buffer instanceof ArrayBuffer},isString:function(n){return"string"==typeof n},isNumber:function(n){return"number"==typeof n},isObject:s,isPlainObject:l,isUndefined:o,isDate:function(n){return"[object Date]"===r.call(n)},isFile:function(n){return"[object File]"===r.call(n)},isBlob:function(n){return"[object Blob]"===r.call(n)},isFunction:c,isStream:function(n){return s(n)&&c(n.pipe)},isURLSearchParams:function(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function n(){var e={};function t(t,a){l(e[a])&&l(t)?e[a]=n(e[a],t):l(t)?e[a]=n({},t):i(t)?e[a]=t.slice():e[a]=t}for(var a=0,r=arguments.length;a<r;a++)u(arguments[a],t);return e},extend:function(n,e,t){return u(e,(function(e,r){n[r]=t&&"function"==typeof e?a(e,t):e})),n},trim:function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},stripBOM:function(n){return 65279===n.charCodeAt(0)&&(n=n.slice(1)),n}}},function(n,e,t){var a=t(41),r=Function.prototype,i=r.call,o=a&&r.bind.bind(i,i);n.exports=a?o:function(n){return function(){return i.apply(n,arguments)}}},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";t.d(e,"a",(function(){return d}));var a=t(0);
/**
  * vue-class-component v7.2.6
  * (c) 2015-present Evan You
  * @license MIT
  */function r(n){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n){return function(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(){return"undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function l(n,e){c(n,e),Object.getOwnPropertyNames(e.prototype).forEach((function(t){c(n.prototype,e.prototype,t)})),Object.getOwnPropertyNames(e).forEach((function(t){c(n,e,t)}))}function c(n,e,t){(t?Reflect.getOwnMetadataKeys(e,t):Reflect.getOwnMetadataKeys(e)).forEach((function(a){var r=t?Reflect.getOwnMetadata(a,e,t):Reflect.getOwnMetadata(a,e);t?Reflect.defineMetadata(a,r,n,t):Reflect.defineMetadata(a,r,n)}))}var u={__proto__:[]}instanceof Array;function d(n){return function(e,t,a){var r="function"==typeof e?e:e.constructor;r.__decorators__||(r.__decorators__=[]),"number"!=typeof a&&(a=void 0),r.__decorators__.push((function(e){return n(e,t,a)}))}}function p(n,e){var t=e.prototype._init;e.prototype._init=function(){var e=this,t=Object.getOwnPropertyNames(n);if(n.$options.props)for(var a in n.$options.props)n.hasOwnProperty(a)||t.push(a);t.forEach((function(t){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){n[t]=e},configurable:!0})}))};var a=new e;e.prototype._init=t;var r={};return Object.keys(a).forEach((function(n){void 0!==a[n]&&(r[n]=a[n])})),r}var h=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function f(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.name=e.name||n._componentTag||n.name;var t=n.prototype;Object.getOwnPropertyNames(t).forEach((function(n){if("constructor"!==n)if(h.indexOf(n)>-1)e[n]=t[n];else{var a=Object.getOwnPropertyDescriptor(t,n);void 0!==a.value?"function"==typeof a.value?(e.methods||(e.methods={}))[n]=a.value:(e.mixins||(e.mixins=[])).push({data:function(){return i({},n,a.value)}}):(a.get||a.set)&&((e.computed||(e.computed={}))[n]={get:a.get,set:a.set})}})),(e.mixins||(e.mixins=[])).push({data:function(){return p(this,n)}});var r=n.__decorators__;r&&(r.forEach((function(n){return n(e)})),delete n.__decorators__);var o=Object.getPrototypeOf(n.prototype),c=o instanceof a.b?o.constructor:a.b,u=c.extend(e);return g(u,n,c),s()&&l(u,n),u}var m={prototype:!0,arguments:!0,callee:!0,caller:!0};function g(n,e,t){Object.getOwnPropertyNames(e).forEach((function(a){if(!m[a]){var i=Object.getOwnPropertyDescriptor(n,a);if(!i||i.configurable){var o,s,l=Object.getOwnPropertyDescriptor(e,a);if(!u){if("cid"===a)return;var c=Object.getOwnPropertyDescriptor(t,a);if(o=l.value,s=r(o),null!=o&&("object"===s||"function"===s)&&c&&c.value===l.value)return}0,Object.defineProperty(n,a,l)}}}))}function v(n){return"function"==typeof n?f(n):function(e){return f(e,n)}}v.registerHooks=function(n){h.push.apply(h,o(n))},e.b=v},function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(n,e,t){var a=t(5);n.exports=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e,t){n.exports=t(310)},function(n,e,t){var a=t(88),r="object"==typeof self&&self&&self.Object===Object&&self,i=a||r||Function("return this")();n.exports=i},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var a=t(4),r=t(29),i=a({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return i(r(n),e)}},function(n,e,t){"use strict";var a=t(21),r=t(29),i=t(30),o=t(158),s=t(160);a({target:"Array",proto:!0,arity:1,forced:t(5)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=r(this),t=i(e),a=arguments.length;s(t+a);for(var l=0;l<a;l++)e[t]=arguments[l],t++;return o(e,t),t}})},function(n,e,t){var a=t(2),r=t(70),i=r.all;n.exports=r.IS_HTMLDDA?function(n){return"object"==typeof n?null!==n:a(n)||n===i}:function(n){return"object"==typeof n?null!==n:a(n)}},function(n,e,t){var a=t(192),r=t(195);n.exports=function(n,e){var t=r(n,e);return a(t)?t:void 0}},function(n,e,t){var a=t(298),r=t(112),i=/[T ]/,o=/:/,s=/^(\d{2})$/,l=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],c=/^(\d{4})/,u=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],d=/^-(\d{2})$/,p=/^-?(\d{3})$/,h=/^-?(\d{2})-?(\d{2})$/,f=/^-?W(\d{2})$/,m=/^-?W(\d{2})-?(\d{1})$/,g=/^(\d{2}([.,]\d*)?)$/,v=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,y=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,b=/([Z+-].*)$/,k=/^(Z)$/,w=/^([+-])(\d{2})$/,x=/^([+-])(\d{2}):?(\d{2})$/;function S(n,e,t){e=e||0,t=t||0;var a=new Date(0);a.setUTCFullYear(n,0,4);var r=7*e+t+1-(a.getUTCDay()||7);return a.setUTCDate(a.getUTCDate()+r),a}n.exports=function(n,e){if(r(n))return new Date(n.getTime());if("string"!=typeof n)return new Date(n);var t=(e||{}).additionalDigits;t=null==t?2:Number(t);var _=function(n){var e,t={},a=n.split(i);o.test(a[0])?(t.date=null,e=a[0]):(t.date=a[0],e=a[1]);if(e){var r=b.exec(e);r?(t.time=e.replace(r[1],""),t.timezone=r[1]):t.time=e}return t}(n),j=function(n,e){var t,a=l[e],r=u[e];if(t=c.exec(n)||r.exec(n)){var i=t[1];return{year:parseInt(i,10),restDateString:n.slice(i.length)}}if(t=s.exec(n)||a.exec(n)){var o=t[1];return{year:100*parseInt(o,10),restDateString:n.slice(o.length)}}return{year:null}}(_.date,t),T=j.year,C=function(n,e){if(null===e)return null;var t,a,r,i;if(0===n.length)return(a=new Date(0)).setUTCFullYear(e),a;if(t=d.exec(n))return a=new Date(0),r=parseInt(t[1],10)-1,a.setUTCFullYear(e,r),a;if(t=p.exec(n)){a=new Date(0);var o=parseInt(t[1],10);return a.setUTCFullYear(e,0,o),a}if(t=h.exec(n)){a=new Date(0),r=parseInt(t[1],10)-1;var s=parseInt(t[2],10);return a.setUTCFullYear(e,r,s),a}if(t=f.exec(n))return i=parseInt(t[1],10)-1,S(e,i);if(t=m.exec(n)){i=parseInt(t[1],10)-1;var l=parseInt(t[2],10)-1;return S(e,i,l)}return null}(j.restDateString,T);if(C){var A,I=C.getTime(),E=0;if(_.time&&(E=function(n){var e,t,a;if(e=g.exec(n))return(t=parseFloat(e[1].replace(",",".")))%24*36e5;if(e=v.exec(n))return t=parseInt(e[1],10),a=parseFloat(e[2].replace(",",".")),t%24*36e5+6e4*a;if(e=y.exec(n)){t=parseInt(e[1],10),a=parseInt(e[2],10);var r=parseFloat(e[3].replace(",","."));return t%24*36e5+6e4*a+1e3*r}return null}(_.time)),_.timezone)A=6e4*function(n){var e,t;if(e=k.exec(n))return 0;if(e=w.exec(n))return t=60*parseInt(e[2],10),"+"===e[1]?-t:t;if(e=x.exec(n))return t=60*parseInt(e[2],10)+parseInt(e[3],10),"+"===e[1]?-t:t;return 0}(_.timezone);else{var O=I+E,L=new Date(O);A=a(L);var $=new Date(O);$.setDate(L.getDate()+1);var P=a($)-a(L);P>0&&(A+=P)}return new Date(I+E+A)}return new Date(n)}},function(n,e,t){"use strict";t.d(e,"c",(function(){return i})),t.d(e,"i",(function(){return o})),t.d(e,"f",(function(){return l})),t.d(e,"g",(function(){return c})),t.d(e,"h",(function(){return u})),t.d(e,"d",(function(){return d})),t.d(e,"e",(function(){return p})),t.d(e,"k",(function(){return h})),t.d(e,"l",(function(){return f})),t.d(e,"j",(function(){return m})),t.d(e,"b",(function(){return v})),t.d(e,"a",(function(){return y}));t(13);const a=/#.*$/,r=/\.(md|html)$/,i=/\/$/,o=/^(https?:|mailto:|tel:)/;function s(n){return decodeURI(n).replace(a,"").replace(r,"")}function l(n){return o.test(n)}function c(n){return/^mailto:/.test(n)}function u(n){return/^tel:/.test(n)}function d(n){if(l(n))return n;const e=n.match(a),t=e?e[0]:"",r=s(n);return i.test(r)?n:r+".html"+t}function p(n,e){const t=n.hash,r=function(n){const e=n.match(a);if(e)return e[0]}(e);if(r&&t!==r)return!1;return s(n.path)===s(e)}function h(n,e,t){t&&(e=function(n,e,t){const a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;const r=e.split("/");t&&r[r.length-1]||r.pop();const i=n.replace(/^\//,"").split("/");for(let n=0;n<i.length;n++){const e=i[n];".."===e?r.pop():"."!==e&&r.push(e)}""!==r[0]&&r.unshift("");return r.join("/")}(e,t));const a=s(e);for(let e=0;e<n.length;e++)if(s(n[e].regularPath)===a)return Object.assign({},n[e],{type:"page",path:d(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function f(n,e,t,a){const{pages:r,themeConfig:i}=t,o=(a&&i.locales&&i.locales[a]||i).sidebar||i.sidebar,{base:s,config:l}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const a in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(a)))return{base:a,config:e[a]};var t;return{}}(e,o);return l?l.map(n=>function n(e,t,a,r=1){if("string"==typeof e)return h(t,e,a);if(Array.isArray(e))return Object.assign(h(t,e[0],a),{title:e[1]});{r>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const i=e.children||[];return 0===i.length&&e.path?Object.assign(h(t,e.path,a),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,children:i.map(e=>n(e,t,a,r+1)),collapsable:!1!==e.collapsable}}}(n,r,s)):[]}function m(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function g(n){return n?new Date(n).getTime():0}function v(n,e){const t=g(n.frontmatter.date),a=g(e.frontmatter.date);return 0===t||0===a?0:a-t}function y(n){const e=document.createElement("link");e.rel="stylesheet",e.href=n,document.head.append(e)}},function(n,e,t){var a=t(8),r=t(79),i=t(81),o=t(23),s=t(69),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor;e.f=a?i?function(n,e,t){if(o(n),e=s(e),o(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var a=u(n,e);a&&a.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:a.configurable,enumerable:"enumerable"in t?t.enumerable:a.enumerable,writable:!1})}return c(n,e,t)}:c:function(n,e,t){if(o(n),e=s(e),o(t),r)try{return c(n,e,t)}catch(n){}if("get"in t||"set"in t)throw l("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){"use strict";var a=t(286),r=t(296),i=t(61);n.exports={formats:i,parse:r,stringify:a}},function(n,e,t){var a=t(7),r=t(67).f,i=t(22),o=t(141),s=t(47),l=t(83),c=t(154);n.exports=function(n,e){var t,u,d,p,h,f=n.target,m=n.global,g=n.stat;if(t=m?a:g?a[f]||s(f,{}):(a[f]||{}).prototype)for(u in e){if(p=e[u],d=n.dontCallGetSet?(h=r(t,u))&&h.value:t[u],!c(m?u:f+(g?".":"#")+u,n.forced)&&void 0!==d){if(typeof p==typeof d)continue;l(p,d)}(n.sham||d&&d.sham)&&i(p,"sham",!0),o(t,u,p,n)}}},function(n,e,t){var a=t(8),r=t(18),i=t(44);n.exports=a?function(n,e,t){return r.f(n,e,i(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var a=t(14),r=String,i=TypeError;n.exports=function(n){if(a(n))return n;throw i(r(n)+" is not an object")}},function(n,e,t){var a=t(10).Symbol;n.exports=a},function(n,e,t){var a=t(24),r=t(177),i=t(178),o=a?a.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":o&&o in Object(n)?r(n):i(n)}},function(n,e,t){"use strict";t.d(e,"a",(function(){return r})),t.d(e,"c",(function(){return i})),t.d(e,"b",(function(){return o}));var a=t(17);function r(n,e){return n=n.filter((t,a)=>{const{title:r,frontmatter:{home:i,date:o,publish:s}}=t;if(n.indexOf(t)!==a)return!1;{const n=!0===i||null==r||!1===s;return!0===e?!(n||void 0===o):!n}})}function i(n){n.sort((n,e)=>{const t=n.frontmatter.sticky,r=e.frontmatter.sticky;return t&&r?t==r?Object(a.b)(n,e):t-r:t&&!r?-1:!t&&r?1:Object(a.b)(n,e)})}function o(n){n.sort((n,e)=>Object(a.b)(n,e))}},function(n,e,t){var a=t(4),r=a({}.toString),i=a("".slice);n.exports=function(n){return i(r(n),8,-1)}},function(n,e,t){var a=t(7),r=t(76),i=t(12),o=t(78),s=t(74),l=t(73),c=a.Symbol,u=r("wks"),d=l?c.for||c:c&&c.withoutSetter||o;n.exports=function(n){return i(u,n)||(u[n]=s&&i(c,n)?c[n]:d("Symbol."+n)),u[n]}},function(n,e,t){var a=t(45),r=Object;n.exports=function(n){return r(a(n))}},function(n,e,t){var a=t(152);n.exports=function(n){return a(n.length)}},function(n,e,t){var a=t(64),r=t(45);n.exports=function(n){return a(r(n))}},function(n,e,t){var a=t(7),r=t(2),i=function(n){return r(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?i(a[n]):a[n]&&a[n][e]}},function(n,e,t){var a=t(151);n.exports=function(n){var e=+n;return e!=e||0===e?0:a(e)}},function(n,e,t){var a=t(182),r=t(183),i=t(184),o=t(185),s=t(186);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=o,l.prototype.set=s,n.exports=l},function(n,e,t){var a=t(90);n.exports=function(n,e){for(var t=n.length;t--;)if(a(n[t][0],e))return t;return-1}},function(n,e,t){var a=t(15)(Object,"create");n.exports=a},function(n,e,t){var a=t(204);n.exports=function(n,e){var t=n.__data__;return a(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var a=t(57);n.exports=function(n){if("string"==typeof n||a(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var a,r;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(r="function"==typeof(a=function(){var n,e,t={version:"0.2.0"},a=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(n,e,t){return n<e?e:n>t?t:n}function i(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(a[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=r(n,a.minimum,1),t.status=1===n?null:n;var l=t.render(!e),c=l.querySelector(a.barSelector),u=a.speed,d=a.easing;return l.offsetWidth,o((function(e){""===a.positionUsing&&(a.positionUsing=t.getPositioningCSS()),s(c,function(n,e,t){var r;return(r="translate3d"===a.positionUsing?{transform:"translate3d("+i(n)+"%,0,0)"}:"translate"===a.positionUsing?{transform:"translate("+i(n)+"%,0)"}:{"margin-left":i(n)+"%"}).transition="all "+e+"ms "+t,r}(n,u,d)),1===n?(s(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){s(l,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),u)}),u)):setTimeout(e,u)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),a.trickleSpeed)};return a.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*r(Math.random()*e,.1,.95)),e=r(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*a.trickleRate)},n=0,e=0,t.promise=function(a){return a&&"resolved"!==a.state()?(0===e&&t.start(),n++,e++,a.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=a.template;var r,o=e.querySelector(a.barSelector),l=n?"-100":i(t.status||0),u=document.querySelector(a.parent);return s(o,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),a.showSpinner||(r=e.querySelector(a.spinnerSelector))&&p(r),u!=document.body&&c(u,"nprogress-custom-parent"),u.appendChild(e),e},t.remove=function(){u(document.documentElement,"nprogress-busy"),u(document.querySelector(a.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&p(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var o=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),s=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var a,r=n.length,i=e.charAt(0).toUpperCase()+e.slice(1);r--;)if((a=n[r]+i)in t)return a;return e}(t))}function a(n,e,a){e=t(e),n.style[e]=a}return function(n,e){var t,r,i=arguments;if(2==i.length)for(t in e)void 0!==(r=e[t])&&e.hasOwnProperty(t)&&a(n,t,r);else a(n,i[1],i[2])}}();function l(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=d(n),a=t+e;l(t,e)||(n.className=a.substring(1))}function u(n,e){var t,a=d(n);l(n,e)&&(t=a.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function p(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?a.call(e,t,e,n):a)||(n.exports=r)},function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return i}));t(13),t(17);function a(){const n=["#e15b64","#f47e60","#f8b26a","#abbd81","#849b87","#e15b64","#f47e60","#f8b26a","#f26d6d","#67cc86","#fb9b5f","#3498db"];return n[Math.floor(Math.random()*n.length)]}function r(n){const e=n.__proto__.push;n.__proto__.push=function(n){return e.call(this,n).catch(n=>n)}}function i(n){const e=n.getRoutes();n.beforeEach((n,t,a)=>{const r=e.find(e=>e.regex.test(n.path));return/\.html$/.test(n.path)||r&&"*"!==r.path&&!r.redirect?a():decodeURIComponent(n.path)!==n.path?a(Object.assign({},n,{path:decodeURIComponent(n.path),fullPath:decodeURIComponent(n.fullPath)})):void a()})}},function(n,e,t){var a=t(5);n.exports=!a((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){var a=t(2),r=t(139),i=TypeError;n.exports=function(n){if(a(n))return n;throw i(r(n)+" is not a function")}},function(n,e,t){var a=t(41),r=Function.prototype.call;n.exports=a?r.bind(r):function(){return r.apply(r,arguments)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var a=t(68),r=TypeError;n.exports=function(n){if(a(n))throw r("Can't call method on "+n);return n}},function(n,e,t){var a=t(7),r=t(47),i=a["__core-js_shared__"]||r("__core-js_shared__",{});n.exports=i},function(n,e,t){var a=t(7),r=Object.defineProperty;n.exports=function(n,e){try{r(a,n,{value:e,configurable:!0,writable:!0})}catch(t){a[n]=e}return e}},function(n,e){n.exports={}},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){var a=t(176),r=t(19),i=Object.prototype,o=i.hasOwnProperty,s=i.propertyIsEnumerable,l=a(function(){return arguments}())?a:function(n){return r(n)&&o.call(n,"callee")&&!s.call(n,"callee")};n.exports=l},function(n,e,t){var a=t(15)(t(10),"Map");n.exports=a},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var a=t(196),r=t(203),i=t(205),o=t(206),s=t(207);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=o,l.prototype.set=s,n.exports=l},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var a=t(11),r=t(57),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;n.exports=function(n,e){if(a(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!r(n))||(o.test(n)||!i.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var a=t(25),r=t(19);n.exports=function(n){return"symbol"==typeof n||r(n)&&"[object Symbol]"==a(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){"use strict";var a=SyntaxError,r=Function,i=TypeError,o=function(n){try{return r('"use strict"; return ('+n+").constructor;")()}catch(n){}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},"")}catch(n){s=null}var l=function(){throw new i},c=s?function(){try{return l}catch(n){try{return s(arguments,"callee").get}catch(n){return l}}}():l,u=t(288)(),d=Object.getPrototypeOf||function(n){return n.__proto__},p={},h="undefined"==typeof Uint8Array?void 0:d(Uint8Array),f={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":u?d([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?void 0:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?void 0:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u?d(d([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u?d((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u?d((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u?d(""[Symbol.iterator]()):void 0,"%Symbol%":u?Symbol:void 0,"%SyntaxError%":a,"%ThrowTypeError%":c,"%TypedArray%":h,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet};try{null.error}catch(n){var m=d(d(n));f["%Error.prototype%"]=m}var g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=t(60),y=t(291),b=v.call(Function.call,Array.prototype.concat),k=v.call(Function.apply,Array.prototype.splice),w=v.call(Function.call,String.prototype.replace),x=v.call(Function.call,String.prototype.slice),S=v.call(Function.call,RegExp.prototype.exec),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,j=/\\(\\)?/g,T=function(n){var e=x(n,0,1),t=x(n,-1);if("%"===e&&"%"!==t)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===t&&"%"!==e)throw new a("invalid intrinsic syntax, expected opening `%`");var r=[];return w(n,_,(function(n,e,t,a){r[r.length]=t?w(a,j,"$1"):e||n})),r},C=function(n,e){var t,r=n;if(y(g,r)&&(r="%"+(t=g[r])[0]+"%"),y(f,r)){var s=f[r];if(s===p&&(s=function n(e){var t;if("%AsyncFunction%"===e)t=o("async function () {}");else if("%GeneratorFunction%"===e)t=o("function* () {}");else if("%AsyncGeneratorFunction%"===e)t=o("async function* () {}");else if("%AsyncGenerator%"===e){var a=n("%AsyncGeneratorFunction%");a&&(t=a.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=n("%AsyncGenerator%");r&&(t=d(r.prototype))}return f[e]=t,t}(r)),void 0===s&&!e)throw new i("intrinsic "+n+" exists, but is not available. Please file an issue!");return{alias:t,name:r,value:s}}throw new a("intrinsic "+n+" does not exist!")};n.exports=function(n,e){if("string"!=typeof n||0===n.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new i('"allowMissing" argument must be a boolean');if(null===S(/^%?[^%]*%?$/,n))throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=T(n),r=t.length>0?t[0]:"",o=C("%"+r+"%",e),l=o.name,c=o.value,u=!1,d=o.alias;d&&(r=d[0],k(t,b([0,1],d)));for(var p=1,h=!0;p<t.length;p+=1){var m=t[p],g=x(m,0,1),v=x(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===v||"'"===v||"`"===v)&&g!==v)throw new a("property names with quotes must have matching quotes");if("constructor"!==m&&h||(u=!0),y(f,l="%"+(r+="."+m)+"%"))c=f[l];else if(null!=c){if(!(m in c)){if(!e)throw new i("base intrinsic for "+n+" exists, but the property is not available.");return}if(s&&p+1>=t.length){var w=s(c,m);c=(h=!!w)&&"get"in w&&!("originalValue"in w.get)?w.get:c[m]}else h=y(c,m),c=c[m];h&&!u&&(f[l]=c)}}return c}},function(n,e,t){"use strict";var a=t(290);n.exports=Function.prototype.bind||a},function(n,e,t){"use strict";var a=String.prototype.replace,r=/%20/g,i="RFC1738",o="RFC3986";n.exports={default:o,formatters:{RFC1738:function(n){return a.call(n,r,"+")},RFC3986:function(n){return String(n)}},RFC1738:i,RFC3986:o}},function(n,e,t){var a=t(303);n.exports=function(n){return a(n,{weekStartsOn:1})}},function(n,e,t){"use strict";var a=t(3),r=t(315),i=t(116),o={"Content-Type":"application/x-www-form-urlencoded"};function s(n,e){!a.isUndefined(n)&&a.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}var l,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(l=t(117)),l),transformRequest:[function(n,e){return r(e,"Accept"),r(e,"Content-Type"),a.isFormData(n)||a.isArrayBuffer(n)||a.isBuffer(n)||a.isStream(n)||a.isFile(n)||a.isBlob(n)?n:a.isArrayBufferView(n)?n.buffer:a.isURLSearchParams(n)?(s(e,"application/x-www-form-urlencoded;charset=utf-8"),n.toString()):a.isObject(n)||e&&"application/json"===e["Content-Type"]?(s(e,"application/json"),function(n,e,t){if(a.isString(n))try{return(e||JSON.parse)(n),a.trim(n)}catch(n){if("SyntaxError"!==n.name)throw n}return(t||JSON.stringify)(n)}(n)):n}],transformResponse:[function(n){var e=this.transitional,t=e&&e.silentJSONParsing,r=e&&e.forcedJSONParsing,o=!t&&"json"===this.responseType;if(o||r&&a.isString(n)&&n.length)try{return JSON.parse(n)}catch(n){if(o){if("SyntaxError"===n.name)throw i(n,this,"E_JSON_PARSE");throw n}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(n){return n>=200&&n<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},a.forEach(["delete","get","head"],(function(n){c.headers[n]={}})),a.forEach(["post","put","patch"],(function(n){c.headers[n]=a.merge(o)})),n.exports=c},function(n,e,t){var a=t(4),r=t(5),i=t(27),o=Object,s=a("".split);n.exports=r((function(){return!o("z").propertyIsEnumerable(0)}))?function(n){return"String"==i(n)?s(n,""):o(n)}:o},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e,t){"use strict";var a=t(21),r=t(155).left,i=t(156),o=t(75);a({target:"Array",proto:!0,forced:!t(157)&&o>79&&o<83||!i("reduce")},{reduce:function(n){var e=arguments.length;return r(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){var a=t(8),r=t(43),i=t(135),o=t(44),s=t(31),l=t(69),c=t(12),u=t(79),d=Object.getOwnPropertyDescriptor;e.f=a?d:function(n,e){if(n=s(n),e=l(e),u)try{return d(n,e)}catch(n){}if(c(n,e))return o(!r(i.f,n,e),n[e])}},function(n,e){n.exports=function(n){return null==n}},function(n,e,t){var a=t(136),r=t(71);n.exports=function(n){var e=a(n,"string");return r(e)?e:e+""}},function(n,e){var t="object"==typeof document&&document.all,a=void 0===t&&void 0!==t;n.exports={all:t,IS_HTMLDDA:a}},function(n,e,t){var a=t(32),r=t(2),i=t(72),o=t(73),s=Object;n.exports=o?function(n){return"symbol"==typeof n}:function(n){var e=a("Symbol");return r(e)&&i(e.prototype,s(n))}},function(n,e,t){var a=t(4);n.exports=a({}.isPrototypeOf)},function(n,e,t){var a=t(74);n.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var a=t(75),r=t(5);n.exports=!!Object.getOwnPropertySymbols&&!r((function(){var n=Symbol();return!String(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&a&&a<41}))},function(n,e,t){var a,r,i=t(7),o=t(137),s=i.process,l=i.Deno,c=s&&s.versions||l&&l.version,u=c&&c.v8;u&&(r=(a=u.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!r&&o&&(!(a=o.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=o.match(/Chrome\/(\d+)/))&&(r=+a[1]),n.exports=r},function(n,e,t){var a=t(77),r=t(46);(n.exports=function(n,e){return r[n]||(r[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.0",mode:a?"pure":"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.0/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e){n.exports=!1},function(n,e,t){var a=t(4),r=0,i=Math.random(),o=a(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+o(++r+i,36)}},function(n,e,t){var a=t(8),r=t(5),i=t(80);n.exports=!a&&!r((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var a=t(7),r=t(14),i=a.document,o=r(i)&&r(i.createElement);n.exports=function(n){return o?i.createElement(n):{}}},function(n,e,t){var a=t(8),r=t(5);n.exports=a&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var a=t(76),r=t(78),i=a("keys");n.exports=function(n){return i[n]||(i[n]=r(n))}},function(n,e,t){var a=t(12),r=t(147),i=t(67),o=t(18);n.exports=function(n,e,t){for(var s=r(e),l=o.f,c=i.f,u=0;u<s.length;u++){var d=s[u];a(n,d)||t&&a(t,d)||l(n,d,c(e,d))}}},function(n,e,t){var a=t(4),r=t(12),i=t(31),o=t(149).indexOf,s=t(48),l=a([].push);n.exports=function(n,e){var t,a=i(n),c=0,u=[];for(t in a)!r(s,t)&&r(a,t)&&l(u,t);for(;e.length>c;)r(a,t=e[c++])&&(~o(u,t)||l(u,t));return u}},function(n,e,t){var a=t(163),r=t(23),i=t(164);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=a(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,a){return r(t),i(a),e?n(t,a):t.__proto__=a,t}}():void 0)},function(n,e,t){var a=t(168),r=String;n.exports=function(n){if("Symbol"===a(n))throw TypeError("Cannot convert a Symbol value to a string");return r(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,a=e.length,r=n.length;++t<a;)n[r+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var a=t(34),r=t(187),i=t(188),o=t(189),s=t(190),l=t(191);function c(n){var e=this.__data__=new a(n);this.size=e.size}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=l,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var a=t(25),r=t(52);n.exports=function(n){if(!r(n))return!1;var e=a(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var a=t(208),r=t(19);n.exports=function n(e,t,i,o,s){return e===t||(null==e||null==t||!r(e)&&!r(t)?e!=e&&t!=t:a(e,t,i,o,n,s))}},function(n,e,t){var a=t(95),r=t(211),i=t(96);n.exports=function(n,e,t,o,s,l){var c=1&t,u=n.length,d=e.length;if(u!=d&&!(c&&d>u))return!1;var p=l.get(n),h=l.get(e);if(p&&h)return p==e&&h==n;var f=-1,m=!0,g=2&t?new a:void 0;for(l.set(n,e),l.set(e,n);++f<u;){var v=n[f],y=e[f];if(o)var b=c?o(y,v,f,e,n,l):o(v,y,f,n,e,l);if(void 0!==b){if(b)continue;m=!1;break}if(g){if(!r(e,(function(n,e){if(!i(g,e)&&(v===n||s(v,n,t,o,l)))return g.push(e)}))){m=!1;break}}else if(v!==y&&!s(v,y,t,o,l)){m=!1;break}}return l.delete(n),l.delete(e),m}},function(n,e,t){var a=t(53),r=t(209),i=t(210);function o(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new a;++e<t;)this.add(n[e])}o.prototype.add=o.prototype.push=r,o.prototype.has=i,n.exports=o},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var a=t(221),r=t(227),i=t(101);n.exports=function(n){return i(n)?a(n):r(n)}},function(n,e,t){(function(n){var a=t(10),r=t(223),i=e&&!e.nodeType&&e,o=i&&"object"==typeof n&&n&&!n.nodeType&&n,s=o&&o.exports===i?a.Buffer:void 0,l=(s?s.isBuffer:void 0)||r;n.exports=l}).call(this,t(65)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var a=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==a||"symbol"!=a&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var a=t(224),r=t(225),i=t(226),o=i&&i.isTypedArray,s=o?r(o):a;n.exports=s},function(n,e,t){var a=t(91),r=t(55);n.exports=function(n){return null!=n&&r(n.length)&&!a(n)}},function(n,e,t){var a=t(15)(t(10),"Set");n.exports=a},function(n,e,t){var a=t(52);n.exports=function(n){return n==n&&!a(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var a=t(106),r=t(38);n.exports=function(n,e){for(var t=0,i=(e=a(e,n)).length;null!=n&&t<i;)n=n[r(e[t++])];return t&&t==i?n:void 0}},function(n,e,t){var a=t(11),r=t(56),i=t(238),o=t(241);n.exports=function(n,e){return a(n)?n:r(n,e)?[n]:i(o(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";var a=t(61),r=Object.prototype.hasOwnProperty,i=Array.isArray,o=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),s=function(n,e){for(var t=e&&e.plainObjects?Object.create(null):{},a=0;a<n.length;++a)void 0!==n[a]&&(t[a]=n[a]);return t};n.exports={arrayToObject:s,assign:function(n,e){return Object.keys(e).reduce((function(n,t){return n[t]=e[t],n}),n)},combine:function(n,e){return[].concat(n,e)},compact:function(n){for(var e=[{obj:{o:n},prop:"o"}],t=[],a=0;a<e.length;++a)for(var r=e[a],o=r.obj[r.prop],s=Object.keys(o),l=0;l<s.length;++l){var c=s[l],u=o[c];"object"==typeof u&&null!==u&&-1===t.indexOf(u)&&(e.push({obj:o,prop:c}),t.push(u))}return function(n){for(;n.length>1;){var e=n.pop(),t=e.obj[e.prop];if(i(t)){for(var a=[],r=0;r<t.length;++r)void 0!==t[r]&&a.push(t[r]);e.obj[e.prop]=a}}}(e),n},decode:function(n,e,t){var a=n.replace(/\+/g," ");if("iso-8859-1"===t)return a.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(a)}catch(n){return a}},encode:function(n,e,t,r,i){if(0===n.length)return n;var s=n;if("symbol"==typeof n?s=Symbol.prototype.toString.call(n):"string"!=typeof n&&(s=String(n)),"iso-8859-1"===t)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(n){return"%26%23"+parseInt(n.slice(2),16)+"%3B"}));for(var l="",c=0;c<s.length;++c){var u=s.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||i===a.RFC1738&&(40===u||41===u)?l+=s.charAt(c):u<128?l+=o[u]:u<2048?l+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?l+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(c)),l+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return l},isBuffer:function(n){return!(!n||"object"!=typeof n)&&!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))},isRegExp:function(n){return"[object RegExp]"===Object.prototype.toString.call(n)},maybeMap:function(n,e){if(i(n)){for(var t=[],a=0;a<n.length;a+=1)t.push(e(n[a]));return t}return e(n)},merge:function n(e,t,a){if(!t)return e;if("object"!=typeof t){if(i(e))e.push(t);else{if(!e||"object"!=typeof e)return[e,t];(a&&(a.plainObjects||a.allowPrototypes)||!r.call(Object.prototype,t))&&(e[t]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(t);var o=e;return i(e)&&!i(t)&&(o=s(e,a)),i(e)&&i(t)?(t.forEach((function(t,i){if(r.call(e,i)){var o=e[i];o&&"object"==typeof o&&t&&"object"==typeof t?e[i]=n(o,t,a):e.push(t)}else e[i]=t})),e):Object.keys(t).reduce((function(e,i){var o=t[i];return r.call(e,i)?e[i]=n(e[i],o,a):e[i]=o,e}),o)}}},function(n,e){n.exports=function(n){return n instanceof Date}},function(n,e,t){var a=t(16),r=t(62);n.exports=function(n){var e=a(n),t=e.getFullYear(),i=new Date(0);i.setFullYear(t+1,0,4),i.setHours(0,0,0,0);var o=r(i),s=new Date(0);s.setFullYear(t,0,4),s.setHours(0,0,0,0);var l=r(s);return e.getTime()>=o.getTime()?t+1:e.getTime()>=l.getTime()?t:t-1}},function(n,e,t){"use strict";n.exports=function(n,e){return function(){for(var t=new Array(arguments.length),a=0;a<t.length;a++)t[a]=arguments[a];return n.apply(e,t)}}},function(n,e,t){"use strict";var a=t(3);function r(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}n.exports=function(n,e,t){if(!e)return n;var i;if(t)i=t(e);else if(a.isURLSearchParams(e))i=e.toString();else{var o=[];a.forEach(e,(function(n,e){null!=n&&(a.isArray(n)?e+="[]":n=[n],a.forEach(n,(function(n){a.isDate(n)?n=n.toISOString():a.isObject(n)&&(n=JSON.stringify(n)),o.push(r(e)+"="+r(n))})))})),i=o.join("&")}if(i){var s=n.indexOf("#");-1!==s&&(n=n.slice(0,s)),n+=(-1===n.indexOf("?")?"?":"&")+i}return n}},function(n,e,t){"use strict";n.exports=function(n,e,t,a,r){return n.config=e,t&&(n.code=t),n.request=a,n.response=r,n.isAxiosError=!0,n.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},n}},function(n,e,t){"use strict";var a=t(3),r=t(316),i=t(317),o=t(115),s=t(318),l=t(321),c=t(322),u=t(118);n.exports=function(n){return new Promise((function(e,t){var d=n.data,p=n.headers,h=n.responseType;a.isFormData(d)&&delete p["Content-Type"];var f=new XMLHttpRequest;if(n.auth){var m=n.auth.username||"",g=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";p.Authorization="Basic "+btoa(m+":"+g)}var v=s(n.baseURL,n.url);function y(){if(f){var a="getAllResponseHeaders"in f?l(f.getAllResponseHeaders()):null,i={data:h&&"text"!==h&&"json"!==h?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:a,config:n,request:f};r(e,t,i),f=null}}if(f.open(n.method.toUpperCase(),o(v,n.params,n.paramsSerializer),!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=y:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(y)},f.onabort=function(){f&&(t(u("Request aborted",n,"ECONNABORTED",f)),f=null)},f.onerror=function(){t(u("Network Error",n,null,f)),f=null},f.ontimeout=function(){var e="timeout of "+n.timeout+"ms exceeded";n.timeoutErrorMessage&&(e=n.timeoutErrorMessage),t(u(e,n,n.transitional&&n.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},a.isStandardBrowserEnv()){var b=(n.withCredentials||c(v))&&n.xsrfCookieName?i.read(n.xsrfCookieName):void 0;b&&(p[n.xsrfHeaderName]=b)}"setRequestHeader"in f&&a.forEach(p,(function(n,e){void 0===d&&"content-type"===e.toLowerCase()?delete p[e]:f.setRequestHeader(e,n)})),a.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),h&&"json"!==h&&(f.responseType=n.responseType),"function"==typeof n.onDownloadProgress&&f.addEventListener("progress",n.onDownloadProgress),"function"==typeof n.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",n.onUploadProgress),n.cancelToken&&n.cancelToken.promise.then((function(n){f&&(f.abort(),t(n),f=null)})),d||(d=null),f.send(d)}))}},function(n,e,t){"use strict";var a=t(116);n.exports=function(n,e,t,r,i){var o=new Error(n);return a(o,e,t,r,i)}},function(n,e,t){"use strict";n.exports=function(n){return!(!n||!n.__CANCEL__)}},function(n,e,t){"use strict";var a=t(3);n.exports=function(n,e){e=e||{};var t={},r=["url","method","data"],i=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function l(n,e){return a.isPlainObject(n)&&a.isPlainObject(e)?a.merge(n,e):a.isPlainObject(e)?a.merge({},e):a.isArray(e)?e.slice():e}function c(r){a.isUndefined(e[r])?a.isUndefined(n[r])||(t[r]=l(void 0,n[r])):t[r]=l(n[r],e[r])}a.forEach(r,(function(n){a.isUndefined(e[n])||(t[n]=l(void 0,e[n]))})),a.forEach(i,c),a.forEach(o,(function(r){a.isUndefined(e[r])?a.isUndefined(n[r])||(t[r]=l(void 0,n[r])):t[r]=l(void 0,e[r])})),a.forEach(s,(function(a){a in e?t[a]=l(n[a],e[a]):a in n&&(t[a]=l(void 0,n[a]))}));var u=r.concat(i).concat(o).concat(s),d=Object.keys(n).concat(Object.keys(e)).filter((function(n){return-1===u.indexOf(n)}));return a.forEach(d,c),t}},function(n,e,t){"use strict";function a(n){this.message=n}a.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},a.prototype.__CANCEL__=!0,n.exports=a},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(174),r=t(179),i=t(250),o=t(258),s=t(267),l=t(268),c=i((function(n){var e=l(n);return s(e)&&(e=void 0),o(a(n,1,s,!0),r(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var a=/["'&<>]/;n.exports=function(n){var e,t=""+n,r=a.exec(t);if(!r)return t;var i="",o=0,s=0;for(o=r.index;o<t.length;o++){switch(t.charCodeAt(o)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}s!==o&&(i+=t.substring(s,o)),s=o+1,i+=e}return s!==o?i+t.substring(s,o):i}},function(n,e){var t=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,i=/^0o[0-7]+$/i,o=parseInt,s="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=s||l||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,h=function(){return c.Date.now()};function f(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function m(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==u.call(n)}(n))return NaN;if(f(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=f(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var s=r.test(n);return s||i.test(n)?o(n.slice(2),s?2:8):a.test(n)?NaN:+n}n.exports=function(n,e,t){var a,r,i,o,s,l,c=0,u=!1,g=!1,v=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function y(e){var t=a,i=r;return a=r=void 0,c=e,o=n.apply(i,t)}function b(n){return c=n,s=setTimeout(w,e),u?y(n):o}function k(n){var t=n-l;return void 0===l||t>=e||t<0||g&&n-c>=i}function w(){var n=h();if(k(n))return x(n);s=setTimeout(w,function(n){var t=e-(n-l);return g?p(t,i-(n-c)):t}(n))}function x(n){return s=void 0,v&&a?y(n):(a=r=void 0,o)}function S(){var n=h(),t=k(n);if(a=arguments,r=this,l=n,t){if(void 0===s)return b(l);if(g)return s=setTimeout(w,e),y(l)}return void 0===s&&(s=setTimeout(w,e)),o}return e=m(e)||0,f(t)&&(u=!!t.leading,i=(g="maxWait"in t)?d(m(t.maxWait)||0,e):i,v="trailing"in t?!!t.trailing:v),S.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=r=s=void 0},S.flush=function(){return void 0===s?o:x(h())},S}},function(n,e,t){!function(){"use strict";n.exports={polyfill:function(){var n=window,e=document;if(!("scrollBehavior"in e.documentElement.style)||!0===n.__forceSmoothScrollPolyfill__){var t,a=n.HTMLElement||n.Element,r={scroll:n.scroll||n.scrollTo,scrollBy:n.scrollBy,elementScroll:a.prototype.scroll||s,scrollIntoView:a.prototype.scrollIntoView},i=n.performance&&n.performance.now?n.performance.now.bind(n.performance):Date.now,o=(t=n.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(t)?1:0);n.scroll=n.scrollTo=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?f.call(n,e.body,void 0!==arguments[0].left?~~arguments[0].left:n.scrollX||n.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:n.scrollY||n.pageYOffset):r.scroll.call(n,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:n.scrollX||n.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:n.scrollY||n.pageYOffset))},n.scrollBy=function(){void 0!==arguments[0]&&(l(arguments[0])?r.scrollBy.call(n,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):f.call(n,e.body,~~arguments[0].left+(n.scrollX||n.pageXOffset),~~arguments[0].top+(n.scrollY||n.pageYOffset)))},a.prototype.scroll=a.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==l(arguments[0])){var n=arguments[0].left,e=arguments[0].top;f.call(this,this,void 0===n?this.scrollLeft:~~n,void 0===e?this.scrollTop:~~e)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");r.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},a.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):r.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},a.prototype.scrollIntoView=function(){if(!0!==l(arguments[0])){var t=p(this),a=t.getBoundingClientRect(),i=this.getBoundingClientRect();t!==e.body?(f.call(this,t,t.scrollLeft+i.left-a.left,t.scrollTop+i.top-a.top),"fixed"!==n.getComputedStyle(t).position&&n.scrollBy({left:a.left,top:a.top,behavior:"smooth"})):n.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else r.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function s(n,e){this.scrollLeft=n,this.scrollTop=e}function l(n){if(null===n||"object"!=typeof n||void 0===n.behavior||"auto"===n.behavior||"instant"===n.behavior)return!0;if("object"==typeof n&&"smooth"===n.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+n.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(n,e){return"Y"===e?n.clientHeight+o<n.scrollHeight:"X"===e?n.clientWidth+o<n.scrollWidth:void 0}function u(e,t){var a=n.getComputedStyle(e,null)["overflow"+t];return"auto"===a||"scroll"===a}function d(n){var e=c(n,"Y")&&u(n,"Y"),t=c(n,"X")&&u(n,"X");return e||t}function p(n){for(;n!==e.body&&!1===d(n);)n=n.parentNode||n.host;return n}function h(e){var t,a,r,o,s=(i()-e.startTime)/468;o=s=s>1?1:s,t=.5*(1-Math.cos(Math.PI*o)),a=e.startX+(e.x-e.startX)*t,r=e.startY+(e.y-e.startY)*t,e.method.call(e.scrollable,a,r),a===e.x&&r===e.y||n.requestAnimationFrame(h.bind(n,e))}function f(t,a,o){var l,c,u,d,p=i();t===e.body?(l=n,c=n.scrollX||n.pageXOffset,u=n.scrollY||n.pageYOffset,d=r.scroll):(l=t,c=t.scrollLeft,u=t.scrollTop,d=s),h({scrollable:l,method:d,startTime:p,startX:c,startY:u,x:a,y:o})}}}}()},function(n,e,t){function a(){var n;try{n=e.storage.debug}catch(n){}return!n&&"undefined"!=typeof process&&"env"in process&&(n=process.env.DEBUG),n}(e=n.exports=t(281)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(n){var t=this.useColors;if(n[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+n[0]+(t?"%c ":" ")+"+"+e.humanize(this.diff),!t)return;var a="color: "+this.color;n.splice(1,0,a,"color: inherit");var r=0,i=0;n[0].replace(/%[a-zA-Z%]/g,(function(n){"%%"!==n&&(r++,"%c"===n&&(i=r))})),n.splice(i,0,a)},e.save=function(n){try{null==n?e.storage.removeItem("debug"):e.storage.debug=n}catch(n){}},e.load=a,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(n){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(n){try{return JSON.stringify(n)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}},e.enable(a())},function(n,e,t){var a=t(297),r=t(302),i=t(113),o=t(16),s=t(305),l=t(306);var c={M:function(n){return n.getMonth()+1},MM:function(n){return p(n.getMonth()+1,2)},Q:function(n){return Math.ceil((n.getMonth()+1)/3)},D:function(n){return n.getDate()},DD:function(n){return p(n.getDate(),2)},DDD:function(n){return a(n)},DDDD:function(n){return p(a(n),3)},d:function(n){return n.getDay()},E:function(n){return n.getDay()||7},W:function(n){return r(n)},WW:function(n){return p(r(n),2)},YY:function(n){return p(n.getFullYear(),4).substr(2)},YYYY:function(n){return p(n.getFullYear(),4)},GG:function(n){return String(i(n)).substr(2)},GGGG:function(n){return i(n)},H:function(n){return n.getHours()},HH:function(n){return p(n.getHours(),2)},h:function(n){var e=n.getHours();return 0===e?12:e>12?e%12:e},hh:function(n){return p(c.h(n),2)},m:function(n){return n.getMinutes()},mm:function(n){return p(n.getMinutes(),2)},s:function(n){return n.getSeconds()},ss:function(n){return p(n.getSeconds(),2)},S:function(n){return Math.floor(n.getMilliseconds()/100)},SS:function(n){return p(Math.floor(n.getMilliseconds()/10),2)},SSS:function(n){return p(n.getMilliseconds(),3)},Z:function(n){return d(n.getTimezoneOffset(),":")},ZZ:function(n){return d(n.getTimezoneOffset())},X:function(n){return Math.floor(n.getTime()/1e3)},x:function(n){return n.getTime()}};function u(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|]$/g,""):n.replace(/\\/g,"")}function d(n,e){e=e||"";var t=n>0?"-":"+",a=Math.abs(n),r=a%60;return t+p(Math.floor(a/60),2)+e+p(r,2)}function p(n,e){for(var t=Math.abs(n).toString();t.length<e;)t="0"+t;return t}n.exports=function(n,e,t){var a=e?String(e):"YYYY-MM-DDTHH:mm:ss.SSSZ",r=(t||{}).locale,i=l.format.formatters,d=l.format.formattingTokensRegExp;r&&r.format&&r.format.formatters&&(i=r.format.formatters,r.format.formattingTokensRegExp&&(d=r.format.formattingTokensRegExp));var p=o(n);return s(p)?function(n,e,t){var a,r,i=n.match(t),o=i.length;for(a=0;a<o;a++)r=e[i[a]]||c[i[a]],i[a]=r||u(i[a]);return function(n){for(var e="",t=0;t<o;t++)i[t]instanceof Function?e+=i[t](n,c):e+=i[t];return e}}(a,i,d)(p):"Invalid Date"}},function(n,e,t){var a=t(21),r=t(7),i=t(161),o=t(162),s=r.WebAssembly,l=7!==Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=o(n,e,l),a({global:!0,constructor:!0,arity:1,forced:l},t)},u=function(n,e){if(s&&s[n]){var t={};t[n]=o("WebAssembly."+n,e,l),a({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:l},t)}};c("Error",(function(n){return function(e){return i(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return i(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return i(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return i(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return i(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return i(n,this,arguments)}})),c("URIError",(function(n){return function(e){return i(n,this,arguments)}})),u("CompileError",(function(n){return function(e){return i(n,this,arguments)}})),u("LinkError",(function(n){return function(e){return i(n,this,arguments)}})),u("RuntimeError",(function(n){return function(e){return i(n,this,arguments)}}))},function(n,e,t){var a=t(28),r=t(274),i=t(18).f,o=a("unscopables"),s=Array.prototype;null==s[o]&&i(s,o,{configurable:!0,value:r(null)}),n.exports=function(n){s[o][n]=!0}},function(n,e,t){n.exports=t(333)},function(n,e,t){"use strict";var a={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!a.call({1:2},1);e.f=i?function(n){var e=r(this,n);return!!e&&e.enumerable}:a},function(n,e,t){var a=t(43),r=t(14),i=t(71),o=t(138),s=t(140),l=t(28),c=TypeError,u=l("toPrimitive");n.exports=function(n,e){if(!r(n)||i(n))return n;var t,l=o(n,u);if(l){if(void 0===e&&(e="default"),t=a(l,n,e),!r(t)||i(t))return t;throw c("Can't convert object to primitive value")}return void 0===e&&(e="number"),s(n,e)}},function(n,e){n.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},function(n,e,t){var a=t(42),r=t(68);n.exports=function(n,e){var t=n[e];return r(t)?void 0:a(t)}},function(n,e){var t=String;n.exports=function(n){try{return t(n)}catch(n){return"Object"}}},function(n,e,t){var a=t(43),r=t(2),i=t(14),o=TypeError;n.exports=function(n,e){var t,s;if("string"===e&&r(t=n.toString)&&!i(s=a(t,n)))return s;if(r(t=n.valueOf)&&!i(s=a(t,n)))return s;if("string"!==e&&r(t=n.toString)&&!i(s=a(t,n)))return s;throw o("Can't convert object to primitive value")}},function(n,e,t){var a=t(2),r=t(18),i=t(142),o=t(47);n.exports=function(n,e,t,s){s||(s={});var l=s.enumerable,c=void 0!==s.name?s.name:e;if(a(t)&&i(t,c,s),s.global)l?n[e]=t:o(e,t);else{try{s.unsafe?n[e]&&(l=!0):delete n[e]}catch(n){}l?n[e]=t:r.f(n,e,{value:t,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return n}},function(n,e,t){var a=t(4),r=t(5),i=t(2),o=t(12),s=t(8),l=t(143).CONFIGURABLE,c=t(144),u=t(145),d=u.enforce,p=u.get,h=String,f=Object.defineProperty,m=a("".slice),g=a("".replace),v=a([].join),y=s&&!r((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),k=n.exports=function(n,e,t){"Symbol("===m(h(e),0,7)&&(e="["+g(h(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!o(n,"name")||l&&n.name!==e)&&(s?f(n,"name",{value:e,configurable:!0}):n.name=e),y&&t&&o(t,"arity")&&n.length!==t.arity&&f(n,"length",{value:t.arity});try{t&&o(t,"constructor")&&t.constructor?s&&f(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var a=d(n);return o(a,"source")||(a.source=v(b,"string"==typeof e?e:"")),n};Function.prototype.toString=k((function(){return i(this)&&p(this).source||c(this)}),"toString")},function(n,e,t){var a=t(8),r=t(12),i=Function.prototype,o=a&&Object.getOwnPropertyDescriptor,s=r(i,"name"),l=s&&"something"===function(){}.name,c=s&&(!a||a&&o(i,"name").configurable);n.exports={EXISTS:s,PROPER:l,CONFIGURABLE:c}},function(n,e,t){var a=t(4),r=t(2),i=t(46),o=a(Function.toString);r(i.inspectSource)||(i.inspectSource=function(n){return o(n)}),n.exports=i.inspectSource},function(n,e,t){var a,r,i,o=t(146),s=t(7),l=t(14),c=t(22),u=t(12),d=t(46),p=t(82),h=t(48),f=s.TypeError,m=s.WeakMap;if(o||d.state){var g=d.state||(d.state=new m);g.get=g.get,g.has=g.has,g.set=g.set,a=function(n,e){if(g.has(n))throw f("Object already initialized");return e.facade=n,g.set(n,e),e},r=function(n){return g.get(n)||{}},i=function(n){return g.has(n)}}else{var v=p("state");h[v]=!0,a=function(n,e){if(u(n,v))throw f("Object already initialized");return e.facade=n,c(n,v,e),e},r=function(n){return u(n,v)?n[v]:{}},i=function(n){return u(n,v)}}n.exports={set:a,get:r,has:i,enforce:function(n){return i(n)?r(n):a(n,{})},getterFor:function(n){return function(e){var t;if(!l(e)||(t=r(e)).type!==n)throw f("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){var a=t(7),r=t(2),i=a.WeakMap;n.exports=r(i)&&/native code/.test(String(i))},function(n,e,t){var a=t(32),r=t(4),i=t(148),o=t(153),s=t(23),l=r([].concat);n.exports=a("Reflect","ownKeys")||function(n){var e=i.f(s(n)),t=o.f;return t?l(e,t(n)):e}},function(n,e,t){var a=t(84),r=t(49).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return a(n,r)}},function(n,e,t){var a=t(31),r=t(150),i=t(30),o=function(n){return function(e,t,o){var s,l=a(e),c=i(l),u=r(o,c);if(n&&t!=t){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((n||u in l)&&l[u]===t)return n||u||0;return!n&&-1}};n.exports={includes:o(!0),indexOf:o(!1)}},function(n,e,t){var a=t(33),r=Math.max,i=Math.min;n.exports=function(n,e){var t=a(n);return t<0?r(t+e,0):i(t,e)}},function(n,e){var t=Math.ceil,a=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?a:t)(e)}},function(n,e,t){var a=t(33),r=Math.min;n.exports=function(n){return n>0?r(a(n),9007199254740991):0}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var a=t(5),r=t(2),i=/#|\.prototype\./,o=function(n,e){var t=l[s(n)];return t==u||t!=c&&(r(e)?a(e):!!e)},s=o.normalize=function(n){return String(n).replace(i,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";n.exports=o},function(n,e,t){var a=t(42),r=t(29),i=t(64),o=t(30),s=TypeError,l=function(n){return function(e,t,l,c){a(t);var u=r(e),d=i(u),p=o(u),h=n?p-1:0,f=n?-1:1;if(l<2)for(;;){if(h in d){c=d[h],h+=f;break}if(h+=f,n?h<0:p<=h)throw s("Reduce of empty array with no initial value")}for(;n?h>=0:p>h;h+=f)h in d&&(c=t(c,d[h],h,u));return c}};n.exports={left:l(!1),right:l(!0)}},function(n,e,t){"use strict";var a=t(5);n.exports=function(n,e){var t=[][n];return!!t&&a((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var a=t(27);n.exports="undefined"!=typeof process&&"process"==a(process)},function(n,e,t){"use strict";var a=t(8),r=t(159),i=TypeError,o=Object.getOwnPropertyDescriptor,s=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=s?function(n,e){if(r(n)&&!o(n,"length").writable)throw i("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){var a=t(27);n.exports=Array.isArray||function(n){return"Array"==a(n)}},function(n,e){var t=TypeError;n.exports=function(n){if(n>9007199254740991)throw t("Maximum allowed index exceeded");return n}},function(n,e,t){var a=t(41),r=Function.prototype,i=r.apply,o=r.call;n.exports="object"==typeof Reflect&&Reflect.apply||(a?o.bind(i):function(){return o.apply(i,arguments)})},function(n,e,t){"use strict";var a=t(32),r=t(12),i=t(22),o=t(72),s=t(85),l=t(83),c=t(165),u=t(166),d=t(167),p=t(170),h=t(171),f=t(8),m=t(77);n.exports=function(n,e,t,g){var v=g?2:1,y=n.split("."),b=y[y.length-1],k=a.apply(null,y);if(k){var w=k.prototype;if(!m&&r(w,"cause")&&delete w.cause,!t)return k;var x=a("Error"),S=e((function(n,e){var t=d(g?e:n,void 0),a=g?new k(n):new k;return void 0!==t&&i(a,"message",t),h(a,S,a.stack,2),this&&o(w,this)&&u(a,this,S),arguments.length>v&&p(a,arguments[v]),a}));if(S.prototype=w,"Error"!==b?s?s(S,x):l(S,x,{name:!0}):f&&"stackTraceLimit"in k&&(c(S,k,"stackTraceLimit"),c(S,k,"prepareStackTrace")),l(S,k),!m)try{w.name!==b&&i(w,"name",b),w.constructor=S}catch(n){}return S}}},function(n,e,t){var a=t(4),r=t(42);n.exports=function(n,e,t){try{return a(r(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){var a=t(2),r=String,i=TypeError;n.exports=function(n){if("object"==typeof n||a(n))return n;throw i("Can't set "+r(n)+" as a prototype")}},function(n,e,t){var a=t(18).f;n.exports=function(n,e,t){t in n||a(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){var a=t(2),r=t(14),i=t(85);n.exports=function(n,e,t){var o,s;return i&&a(o=e.constructor)&&o!==t&&r(s=o.prototype)&&s!==t.prototype&&i(n,s),n}},function(n,e,t){var a=t(86);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:a(n)}},function(n,e,t){var a=t(169),r=t(2),i=t(27),o=t(28)("toStringTag"),s=Object,l="Arguments"==i(function(){return arguments}());n.exports=a?i:function(n){var e,t,a;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=s(n),o))?t:l?i(e):"Object"==(a=i(e))&&r(e.callee)?"Arguments":a}},function(n,e,t){var a={};a[t(28)("toStringTag")]="z",n.exports="[object z]"===String(a)},function(n,e,t){var a=t(14),r=t(22);n.exports=function(n,e){a(e)&&"cause"in e&&r(n,"cause",e.cause)}},function(n,e,t){var a=t(22),r=t(172),i=t(173),o=Error.captureStackTrace;n.exports=function(n,e,t,s){i&&(o?o(n,e):a(n,"stack",r(t,s)))}},function(n,e,t){var a=t(4),r=Error,i=a("".replace),o=String(r("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,l=s.test(o);n.exports=function(n,e){if(l&&"string"==typeof n&&!r.prepareStackTrace)for(;e--;)n=i(n,s,"");return n}},function(n,e,t){var a=t(5),r=t(44);n.exports=!a((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",r(1,7)),7!==n.stack)}))},function(n,e,t){var a=t(87),r=t(175);n.exports=function n(e,t,i,o,s){var l=-1,c=e.length;for(i||(i=r),s||(s=[]);++l<c;){var u=e[l];t>0&&i(u)?t>1?n(u,t-1,i,o,s):a(s,u):o||(s[s.length]=u)}return s}},function(n,e,t){var a=t(24),r=t(50),i=t(11),o=a?a.isConcatSpreadable:void 0;n.exports=function(n){return i(n)||r(n)||!!(o&&n&&n[o])}},function(n,e,t){var a=t(25),r=t(19);n.exports=function(n){return r(n)&&"[object Arguments]"==a(n)}},function(n,e,t){var a=t(24),r=Object.prototype,i=r.hasOwnProperty,o=r.toString,s=a?a.toStringTag:void 0;n.exports=function(n){var e=i.call(n,s),t=n[s];try{n[s]=void 0;var a=!0}catch(n){}var r=o.call(n);return a&&(e?n[s]=t:delete n[s]),r}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var a=t(180),r=t(236),i=t(58),o=t(11),s=t(247);n.exports=function(n){return"function"==typeof n?n:null==n?i:"object"==typeof n?o(n)?r(n[0],n[1]):a(n):s(n)}},function(n,e,t){var a=t(181),r=t(235),i=t(104);n.exports=function(n){var e=r(n);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(t){return t===n||a(t,n,e)}}},function(n,e,t){var a=t(89),r=t(93);n.exports=function(n,e,t,i){var o=t.length,s=o,l=!i;if(null==n)return!s;for(n=Object(n);o--;){var c=t[o];if(l&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++o<s;){var u=(c=t[o])[0],d=n[u],p=c[1];if(l&&c[2]){if(void 0===d&&!(u in n))return!1}else{var h=new a;if(i)var f=i(d,p,u,n,e,h);if(!(void 0===f?r(p,d,3,i,h):f))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var a=t(35),r=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=a(e,n);return!(t<0)&&(t==e.length-1?e.pop():r.call(e,t,1),--this.size,!0)}},function(n,e,t){var a=t(35);n.exports=function(n){var e=this.__data__,t=a(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var a=t(35);n.exports=function(n){return a(this.__data__,n)>-1}},function(n,e,t){var a=t(35);n.exports=function(n,e){var t=this.__data__,r=a(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}},function(n,e,t){var a=t(34);n.exports=function(){this.__data__=new a,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var a=t(34),r=t(51),i=t(53);n.exports=function(n,e){var t=this.__data__;if(t instanceof a){var o=t.__data__;if(!r||o.length<199)return o.push([n,e]),this.size=++t.size,this;t=this.__data__=new i(o)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var a=t(91),r=t(193),i=t(52),o=t(92),s=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,u=l.toString,d=c.hasOwnProperty,p=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!i(n)||r(n))&&(a(n)?p:s).test(o(n))}},function(n,e,t){var a,r=t(194),i=(a=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";n.exports=function(n){return!!i&&i in n}},function(n,e,t){var a=t(10)["__core-js_shared__"];n.exports=a},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var a=t(197),r=t(34),i=t(51);n.exports=function(){this.size=0,this.__data__={hash:new a,map:new(i||r),string:new a}}},function(n,e,t){var a=t(198),r=t(199),i=t(200),o=t(201),s=t(202);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=o,l.prototype.set=s,n.exports=l},function(n,e,t){var a=t(36);n.exports=function(){this.__data__=a?a(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var a=t(36),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(a){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return r.call(e,n)?e[n]:void 0}},function(n,e,t){var a=t(36),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return a?void 0!==e[n]:r.call(e,n)}},function(n,e,t){var a=t(36);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=a&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var a=t(37);n.exports=function(n){var e=a(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var a=t(37);n.exports=function(n){return a(this,n).get(n)}},function(n,e,t){var a=t(37);n.exports=function(n){return a(this,n).has(n)}},function(n,e,t){var a=t(37);n.exports=function(n,e){var t=a(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}},function(n,e,t){var a=t(89),r=t(94),i=t(212),o=t(215),s=t(231),l=t(11),c=t(98),u=t(100),d="[object Object]",p=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,h,f,m){var g=l(n),v=l(e),y=g?"[object Array]":s(n),b=v?"[object Array]":s(e),k=(y="[object Arguments]"==y?d:y)==d,w=(b="[object Arguments]"==b?d:b)==d,x=y==b;if(x&&c(n)){if(!c(e))return!1;g=!0,k=!1}if(x&&!k)return m||(m=new a),g||u(n)?r(n,e,t,h,f,m):i(n,e,y,t,h,f,m);if(!(1&t)){var S=k&&p.call(n,"__wrapped__"),_=w&&p.call(e,"__wrapped__");if(S||_){var j=S?n.value():n,T=_?e.value():e;return m||(m=new a),f(j,T,t,h,m)}}return!!x&&(m||(m=new a),o(n,e,t,h,f,m))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length;++t<a;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var a=t(24),r=t(213),i=t(90),o=t(94),s=t(214),l=t(54),c=a?a.prototype:void 0,u=c?c.valueOf:void 0;n.exports=function(n,e,t,a,c,d,p){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new r(n),new r(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var h=s;case"[object Set]":var f=1&a;if(h||(h=l),n.size!=e.size&&!f)return!1;var m=p.get(n);if(m)return m==e;a|=2,p.set(n,e);var g=o(h(n),h(e),a,c,d,p);return p.delete(n),g;case"[object Symbol]":if(u)return u.call(n)==u.call(e)}return!1}},function(n,e,t){var a=t(10).Uint8Array;n.exports=a},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,a){t[++e]=[a,n]})),t}},function(n,e,t){var a=t(216),r=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,i,o,s){var l=1&t,c=a(n),u=c.length;if(u!=a(e).length&&!l)return!1;for(var d=u;d--;){var p=c[d];if(!(l?p in e:r.call(e,p)))return!1}var h=s.get(n),f=s.get(e);if(h&&f)return h==e&&f==n;var m=!0;s.set(n,e),s.set(e,n);for(var g=l;++d<u;){var v=n[p=c[d]],y=e[p];if(i)var b=l?i(y,v,p,e,n,s):i(v,y,p,n,e,s);if(!(void 0===b?v===y||o(v,y,t,i,s):b)){m=!1;break}g||(g="constructor"==p)}if(m&&!g){var k=n.constructor,w=e.constructor;k==w||!("constructor"in n)||!("constructor"in e)||"function"==typeof k&&k instanceof k&&"function"==typeof w&&w instanceof w||(m=!1)}return s.delete(n),s.delete(e),m}},function(n,e,t){var a=t(217),r=t(218),i=t(97);n.exports=function(n){return a(n,i,r)}},function(n,e,t){var a=t(87),r=t(11);n.exports=function(n,e,t){var i=e(n);return r(n)?i:a(i,t(n))}},function(n,e,t){var a=t(219),r=t(220),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,s=o?function(n){return null==n?[]:(n=Object(n),a(o(n),(function(e){return i.call(n,e)})))}:r;n.exports=s},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=0,i=[];++t<a;){var o=n[t];e(o,t,n)&&(i[r++]=o)}return i}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var a=t(222),r=t(50),i=t(11),o=t(98),s=t(99),l=t(100),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=i(n),u=!t&&r(n),d=!t&&!u&&o(n),p=!t&&!u&&!d&&l(n),h=t||u||d||p,f=h?a(n.length,String):[],m=f.length;for(var g in n)!e&&!c.call(n,g)||h&&("length"==g||d&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(n,e){n.exports=function(n,e){for(var t=-1,a=Array(n);++t<n;)a[t]=e(t);return a}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var a=t(25),r=t(55),i=t(19),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,n.exports=function(n){return i(n)&&r(n.length)&&!!o[a(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var a=t(88),r=e&&!e.nodeType&&e,i=r&&"object"==typeof n&&n&&!n.nodeType&&n,o=i&&i.exports===r&&a.process,s=function(){try{var n=i&&i.require&&i.require("util").types;return n||o&&o.binding&&o.binding("util")}catch(n){}}();n.exports=s}).call(this,t(65)(n))},function(n,e,t){var a=t(228),r=t(229),i=Object.prototype.hasOwnProperty;n.exports=function(n){if(!a(n))return r(n);var e=[];for(var t in Object(n))i.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var a=t(230)(Object.keys,Object);n.exports=a},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var a=t(232),r=t(51),i=t(233),o=t(102),s=t(234),l=t(25),c=t(92),u=c(a),d=c(r),p=c(i),h=c(o),f=c(s),m=l;(a&&"[object DataView]"!=m(new a(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||i&&"[object Promise]"!=m(i.resolve())||o&&"[object Set]"!=m(new o)||s&&"[object WeakMap]"!=m(new s))&&(m=function(n){var e=l(n),t="[object Object]"==e?n.constructor:void 0,a=t?c(t):"";if(a)switch(a){case u:return"[object DataView]";case d:return"[object Map]";case p:return"[object Promise]";case h:return"[object Set]";case f:return"[object WeakMap]"}return e}),n.exports=m},function(n,e,t){var a=t(15)(t(10),"DataView");n.exports=a},function(n,e,t){var a=t(15)(t(10),"Promise");n.exports=a},function(n,e,t){var a=t(15)(t(10),"WeakMap");n.exports=a},function(n,e,t){var a=t(103),r=t(97);n.exports=function(n){for(var e=r(n),t=e.length;t--;){var i=e[t],o=n[i];e[t]=[i,o,a(o)]}return e}},function(n,e,t){var a=t(93),r=t(237),i=t(244),o=t(56),s=t(103),l=t(104),c=t(38);n.exports=function(n,e){return o(n)&&s(e)?l(c(n),e):function(t){var o=r(t,n);return void 0===o&&o===e?i(t,n):a(e,o,3)}}},function(n,e,t){var a=t(105);n.exports=function(n,e,t){var r=null==n?void 0:a(n,e);return void 0===r?t:r}},function(n,e,t){var a=t(239),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=a((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(r,(function(n,t,a,r){e.push(a?r.replace(i,"$1"):t||n)})),e}));n.exports=o},function(n,e,t){var a=t(240);n.exports=function(n){var e=a(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var a=t(53);function r(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var a=arguments,r=e?e.apply(this,a):a[0],i=t.cache;if(i.has(r))return i.get(r);var o=n.apply(this,a);return t.cache=i.set(r,o)||i,o};return t.cache=new(r.Cache||a),t}r.Cache=a,n.exports=r},function(n,e,t){var a=t(242);n.exports=function(n){return null==n?"":a(n)}},function(n,e,t){var a=t(24),r=t(243),i=t(11),o=t(57),s=a?a.prototype:void 0,l=s?s.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(i(e))return r(e,n)+"";if(o(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=Array(a);++t<a;)r[t]=e(n[t],t,n);return r}},function(n,e,t){var a=t(245),r=t(246);n.exports=function(n,e){return null!=n&&r(n,e,a)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var a=t(106),r=t(50),i=t(11),o=t(99),s=t(55),l=t(38);n.exports=function(n,e,t){for(var c=-1,u=(e=a(e,n)).length,d=!1;++c<u;){var p=l(e[c]);if(!(d=null!=n&&t(n,p)))break;n=n[p]}return d||++c!=u?d:!!(u=null==n?0:n.length)&&s(u)&&o(p,u)&&(i(n)||r(n))}},function(n,e,t){var a=t(248),r=t(249),i=t(56),o=t(38);n.exports=function(n){return i(n)?a(o(n)):r(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var a=t(105);n.exports=function(n){return function(e){return a(e,n)}}},function(n,e,t){var a=t(58),r=t(251),i=t(253);n.exports=function(n,e){return i(r(n,e,a),n+"")}},function(n,e,t){var a=t(252),r=Math.max;n.exports=function(n,e,t){return e=r(void 0===e?n.length-1:e,0),function(){for(var i=arguments,o=-1,s=r(i.length-e,0),l=Array(s);++o<s;)l[o]=i[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=i[o];return c[e]=t(l),a(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var a=t(254),r=t(257)(a);n.exports=r},function(n,e,t){var a=t(255),r=t(256),i=t(58),o=r?function(n,e){return r(n,"toString",{configurable:!0,enumerable:!1,value:a(e),writable:!0})}:i;n.exports=o},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var a=t(15),r=function(){try{var n=a(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=r},function(n,e){var t=Date.now;n.exports=function(n){var e=0,a=0;return function(){var r=t(),i=16-(r-a);if(a=r,i>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var a=t(95),r=t(259),i=t(264),o=t(96),s=t(265),l=t(54);n.exports=function(n,e,t){var c=-1,u=r,d=n.length,p=!0,h=[],f=h;if(t)p=!1,u=i;else if(d>=200){var m=e?null:s(n);if(m)return l(m);p=!1,u=o,f=new a}else f=e?[]:h;n:for(;++c<d;){var g=n[c],v=e?e(g):g;if(g=t||0!==g?g:0,p&&v==v){for(var y=f.length;y--;)if(f[y]===v)continue n;e&&f.push(v),h.push(g)}else u(f,v,t)||(f!==h&&f.push(v),h.push(g))}return h}},function(n,e,t){var a=t(260);n.exports=function(n,e){return!!(null==n?0:n.length)&&a(n,e,0)>-1}},function(n,e,t){var a=t(261),r=t(262),i=t(263);n.exports=function(n,e,t){return e==e?i(n,e,t):a(n,r,t)}},function(n,e){n.exports=function(n,e,t,a){for(var r=n.length,i=t+(a?1:-1);a?i--:++i<r;)if(e(n[i],i,n))return i;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var a=t-1,r=n.length;++a<r;)if(n[a]===e)return a;return-1}},function(n,e){n.exports=function(n,e,t){for(var a=-1,r=null==n?0:n.length;++a<r;)if(t(e,n[a]))return!0;return!1}},function(n,e,t){var a=t(102),r=t(266),i=t(54),o=a&&1/i(new a([,-0]))[1]==1/0?function(n){return new a(n)}:r;n.exports=o},function(n,e){n.exports=function(){}},function(n,e,t){var a=t(101),r=t(19);n.exports=function(n){return r(n)&&a(n)}},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(107)},function(n,e,t){"use strict";var a=t(21),r=t(29),i=t(30),o=t(33),s=t(133);a({target:"Array",proto:!0},{at:function(n){var e=r(this),t=i(e),a=o(n),s=a>=0?a:t+a;return s<0||s>=t?void 0:e[s]}}),s("at")},function(n,e,t){var a,r=t(23),i=t(275),o=t(49),s=t(48),l=t(277),c=t(80),u=t(82),d=u("IE_PROTO"),p=function(){},h=function(n){return"<script>"+n+"<\/script>"},f=function(n){n.write(h("")),n.close();var e=n.parentWindow.Object;return n=null,e},m=function(){try{a=new ActiveXObject("htmlfile")}catch(n){}var n,e;m="undefined"!=typeof document?document.domain&&a?f(a):((e=c("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(n=e.contentWindow.document).open(),n.write(h("document.F=Object")),n.close(),n.F):f(a);for(var t=o.length;t--;)delete m.prototype[o[t]];return m()};s[d]=!0,n.exports=Object.create||function(n,e){var t;return null!==n?(p.prototype=r(n),t=new p,p.prototype=null,t[d]=n):t=m(),void 0===e?t:i.f(t,e)}},function(n,e,t){var a=t(8),r=t(81),i=t(18),o=t(23),s=t(31),l=t(276);e.f=a&&!r?Object.defineProperties:function(n,e){o(n);for(var t,a=s(e),r=l(e),c=r.length,u=0;c>u;)i.f(n,t=r[u++],a[t]);return n}},function(n,e,t){var a=t(84),r=t(49);n.exports=Object.keys||function(n){return a(n,r)}},function(n,e,t){var a=t(32);n.exports=a("document","documentElement")},function(n,e,t){"use strict";var a=t(21),r=t(4),i=t(45),o=t(33),s=t(86),l=t(5),c=r("".charAt);a({target:"String",proto:!0,forced:l((function(){return"\ud842"!=="".at(-2)}))},{at:function(n){var e=s(i(this)),t=e.length,a=o(n),r=a>=0?a:t+a;return r<0||r>=t?void 0:c(e,r)}})},function(n,e,t){"use strict";t(108)},function(n,e,t){},function(n,e,t){var a;function r(n){function t(){if(t.enabled){var n=t,r=+new Date,i=r-(a||r);n.diff=i,n.prev=a,n.curr=r,a=r;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var l=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(t,a){if("%%"===t)return t;l++;var r=e.formatters[a];if("function"==typeof r){var i=o[l];t=r.call(n,i),o.splice(l,1),l--}return t})),e.formatArgs.call(n,o);var c=t.log||e.log||console.log.bind(console);c.apply(n,o)}}return t.namespace=n,t.enabled=e.enabled(n),t.useColors=e.useColors(),t.color=function(n){var t,a=0;for(t in n)a=(a<<5)-a+n.charCodeAt(t),a|=0;return e.colors[Math.abs(a)%e.colors.length]}(n),"function"==typeof e.init&&e.init(t),t}(e=n.exports=r.debug=r.default=r).coerce=function(n){return n instanceof Error?n.stack||n.message:n},e.disable=function(){e.enable("")},e.enable=function(n){e.save(n),e.names=[],e.skips=[];for(var t=("string"==typeof n?n:"").split(/[\s,]+/),a=t.length,r=0;r<a;r++)t[r]&&("-"===(n=t[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+n.substr(1)+"$")):e.names.push(new RegExp("^"+n+"$")))},e.enabled=function(n){var t,a;for(t=0,a=e.skips.length;t<a;t++)if(e.skips[t].test(n))return!1;for(t=0,a=e.names.length;t<a;t++)if(e.names[t].test(n))return!0;return!1},e.humanize=t(282),e.names=[],e.skips=[],e.formatters={}},function(n,e){var t=1e3,a=6e4,r=60*a,i=24*r;function o(n,e,t){if(!(n<e))return n<1.5*e?Math.floor(n/e)+" "+t:Math.ceil(n/e)+" "+t+"s"}n.exports=function(n,e){e=e||{};var s,l=typeof n;if("string"===l&&n.length>0)return function(n){if((n=String(n)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(n);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*a;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(n);if("number"===l&&!1===isNaN(n))return e.long?o(s=n,i,"day")||o(s,r,"hour")||o(s,a,"minute")||o(s,t,"second")||s+" ms":function(n){if(n>=i)return Math.round(n/i)+"d";if(n>=r)return Math.round(n/r)+"h";if(n>=a)return Math.round(n/a)+"m";if(n>=t)return Math.round(n/t)+"s";return n+"ms"}(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))}},function(n,e,t){"use strict";t(109)},function(n,e,t){
/*!
 * Valine v1.5.1
 * (c) 2017-2022 xCss
 * Released under the GPL-2.0 License.
 * Last Update: 2022-7-21 3:43:59 F10: PM
 */
n.exports=function(n){function e(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return n[a].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var t={};return e.m=n,e.c=t,e.i=function(n){return n},e.d=function(n,t,a){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:a})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=108)}([function(n,e,t){"use strict";var a=SyntaxError,r=Function,i=TypeError,o=function(n){try{return r('"use strict"; return ('+n+").constructor;")()}catch(n){}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},"")}catch(n){s=null}var l=function(){throw new i},c=s?function(){try{return l}catch(n){try{return s(arguments,"callee").get}catch(n){return l}}}():l,u=t(22)(),d=Object.getPrototypeOf||function(n){return n.__proto__},p={},h="undefined"==typeof Uint8Array?void 0:d(Uint8Array),f={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":u?d([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u?d(d([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u?d((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u?d((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u?d(""[Symbol.iterator]()):void 0,"%Symbol%":u?Symbol:void 0,"%SyntaxError%":a,"%ThrowTypeError%":c,"%TypedArray%":h,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet},m=function n(e){var t;if("%AsyncFunction%"===e)t=o("async function () {}");else if("%GeneratorFunction%"===e)t=o("function* () {}");else if("%AsyncGeneratorFunction%"===e)t=o("async function* () {}");else if("%AsyncGenerator%"===e){var a=n("%AsyncGeneratorFunction%");a&&(t=a.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=n("%AsyncGenerator%");r&&(t=d(r.prototype))}return f[e]=t,t},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=t(9),y=t(25),b=v.call(Function.call,Array.prototype.concat),k=v.call(Function.apply,Array.prototype.splice),w=v.call(Function.call,String.prototype.replace),x=v.call(Function.call,String.prototype.slice),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_=/\\(\\)?/g,j=function(n){var e=x(n,0,1),t=x(n,-1);if("%"===e&&"%"!==t)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===t&&"%"!==e)throw new a("invalid intrinsic syntax, expected opening `%`");var r=[];return w(n,S,(function(n,e,t,a){r[r.length]=t?w(a,_,"$1"):e||n})),r},T=function(n,e){var t,r=n;if(y(g,r)&&(r="%"+(t=g[r])[0]+"%"),y(f,r)){var o=f[r];if(o===p&&(o=m(r)),void 0===o&&!e)throw new i("intrinsic "+n+" exists, but is not available. Please file an issue!");return{alias:t,name:r,value:o}}throw new a("intrinsic "+n+" does not exist!")};n.exports=function(n,e){if("string"!=typeof n||0===n.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new i('"allowMissing" argument must be a boolean');var t=j(n),r=t.length>0?t[0]:"",o=T("%"+r+"%",e),l=o.name,c=o.value,u=!1,d=o.alias;d&&(r=d[0],k(t,b([0,1],d)));for(var p=1,h=!0;p<t.length;p+=1){var m=t[p],g=x(m,0,1),v=x(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===v||"'"===v||"`"===v)&&g!==v)throw new a("property names with quotes must have matching quotes");if("constructor"!==m&&h||(u=!0),y(f,l="%"+(r+="."+m)+"%"))c=f[l];else if(null!=c){if(!(m in c)){if(!e)throw new i("base intrinsic for "+n+" exists, but the property is not available.");return}if(s&&p+1>=t.length){var w=s(c,m);c=(h=!!w)&&"get"in w&&!("originalValue"in w.get)?w.get:c[m]}else h=y(c,m),c=c[m];h&&!u&&(f[l]=c)}}return c}},function(n,e,t){"use strict";var a=t(0),r=t(4),i=r(a("String.prototype.indexOf"));n.exports=function(n,e){var t=a(n,!!e);return"function"==typeof t&&i(n,".prototype.")>-1?r(t):t}},function(n,e,t){"use strict";var a=t(88),r="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,o=Array.prototype.concat,s=Object.defineProperty,l=s&&function(){var n={};try{for(var e in s(n,"x",{enumerable:!1,value:n}),n)return!1;return n.x===n}catch(n){return!1}}(),c=function(n,e,t,a){(!(e in n)||function(n){return"function"==typeof n&&"[object Function]"===i.call(n)}(a)&&a())&&(l?s(n,e,{configurable:!0,enumerable:!1,value:t,writable:!0}):n[e]=t)},u=function(n,e){var t=arguments.length>2?arguments[2]:{},i=a(e);r&&(i=o.call(i,Object.getOwnPropertySymbols(e)));for(var s=0;s<i.length;s+=1)c(n,i[s],e[i[s]],t[i[s]])};u.supportsDescriptors=!!l,n.exports=u},function(n,e,t){"use strict";function a(n){return n&&n.__esModule?n:{default:n}}e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i=a(t(85)),o=a(t(49)),s=a(t(46)),l=a(t(48)),c=a(t(45)),u=document,d=navigator,p=/[&<>"'`\\]/g,h=RegExp(p.source),f=/&(?:amp|lt|gt|quot|#39|#x60|#x5c);/g,m=RegExp(f.source),g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#x60;","\\":"&#x5c;"},v={};for(var y in g)v[g[y]]=y;var b=null;Array.prototype.forEach||(Array.prototype.forEach=function(n,e){var t,a;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof n)throw new TypeError(n+" is not a function");for(arguments.length>1&&(t=e),a=0;a<i;){var o;a in r&&(o=r[a],n.call(t,o,a,r)),a++}}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),(0,i.default)(o.default.fn,{prepend:function(n){return n instanceof HTMLElement||(n=n[0]),this.forEach((function(e){e.insertAdjacentElement("afterBegin",n)})),this},append:function(n){return n instanceof HTMLElement||(n=n[0]),this.forEach((function(e){e.insertAdjacentElement("beforeEnd",n)})),this},remove:function(){return this.forEach((function(n){try{n.parentNode.removeChild(n)}catch(n){}})),this},find:function(n){return(0,o.default)(n,this)},show:function(){return this.forEach((function(n){n.style.display="block"})),this},hide:function(){return this.forEach((function(n){n.style.display="none"})),this},on:function(n,e,t){return o.default.fn.off(n,e,t),this.forEach((function(a){n.split(" ").forEach((function(n){a.addEventListener?a.addEventListener(n,e,t||!1):a.attachEvent?a.attachEvent("on"+n,e):a["on"+n]=e}))})),this},off:function(n,e,t){return this.forEach((function(a){n.split(" ").forEach((function(n){a.removeEventListener?a.removeEventListener(n,e,t||!1):a.detachEvent?a.detachEvent("on"+n,e):a["on"+n]=null}))})),this},html:function(n){return void 0!==n?(this.forEach((function(e){e.innerHTML=n})),this):this[0].innerHTML},text:function(n){return void 0!==n?(this.forEach((function(e){e.innerText=n})),this):this[0].innerText},empty:function(n){return n=n||0,this.forEach((function(e){setTimeout((function(n){e.innerText=""}),n)})),this},val:function(n){return void 0!==n?(this.forEach((function(e){e.value=n})),this):this[0].value||""},attr:function(){var n=arguments;if("object"==r(arguments[0])){var e=arguments[0],t=this;return Object.keys(e).forEach((function(n){t.forEach((function(t){t.setAttribute(n,e[n])}))})),this}return"string"==typeof arguments[0]&&arguments.length<2?this[0].getAttribute(arguments[0])||"":(this.forEach((function(e){e.setAttribute(n[0],n[1])})),this)},removeAttr:function(n){return this.forEach((function(e){var t,a=0,r=n&&n.match(/[^\x20\t\r\n\f\*\/\\]+/g);if(r&&1===e.nodeType)for(;t=r[a++];)e.removeAttribute(t)})),this},hasClass:function(n){return!!this[0]&&new RegExp("(\\s|^)"+n+"(\\s|$)").test(this[0].getAttribute("class"))},addClass:function(n){return this.forEach((function(e){var t=(0,o.default)(e),a=t.attr("class");t.hasClass(n)||t.attr("class",a+=" "+n)})),this},removeClass:function(n){return this.forEach((function(e){var t=(0,o.default)(e),a=t.attr("class");if(t.hasClass(n)){var r=new RegExp("(\\s|^)"+n+"(\\s|$)");t.attr("class",a.replace(r,""))}})),this}}),(0,i.default)(o.default,{extend:i.default,noop:function(){},navi:d,ua:d.userAgent,lang:d.language||d.languages[0],detect:s.default,store:l.default,escape:function(n){return n&&h.test(n)?n.replace(p,(function(n){return g[n]})):n},unescape:function(n){return n&&m.test(n)?n.replace(f,(function(n){return v[n]})):n},dynamicLoadSource:function(n,e){if((0,o.default)('script[src="'+n+'"]').length)e&&e();else{var t=u.createElement("script");t.onload=t.onreadystatechange=function(){this.onload=this.onreadystatechange=null,e&&e(),(0,o.default)(t).remove()},t.async=!0,t.setAttribute("referrerPolicy","no-referrer"),(0,o.default)("head")[0].appendChild(t),t.src=n}},sdkLoader:function(n,e,t){e in window&&window[e]?(b&&clearTimeout(b),t&&t()):o.default.dynamicLoadSource(n,(function(){b=setTimeout(o.default.sdkLoader(n,e,t),100)}))},deleteInWin:function(n,e){var t=function(e){if(n in window)try{delete window[n]}catch(e){window[n]=null}};0===e?t():setTimeout(t,e||500)},ajax:c.default}),e.default=o.default},function(n,e,t){"use strict";var a=t(9),r=t(0),i=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),s=r("%Reflect.apply%",!0)||a.call(o,i),l=r("%Object.getOwnPropertyDescriptor%",!0),c=r("%Object.defineProperty%",!0),u=r("%Math.max%");if(c)try{c({},"a",{value:1})}catch(n){c=null}n.exports=function(n){var e=s(a,o,arguments);return l&&c&&l(e,"length").configurable&&c(e,"length",{value:1+u(0,n.length-(arguments.length-1))}),e};var d=function(){return s(a,i,arguments)};c?c(n.exports,"apply",{value:d}):n.exports.apply=d},function(n,e,t){"use strict";n.exports=t(62)},function(n,e,t){"use strict";e.__esModule=!0,e.DEFAULT_EMOJI_CDN="//img.t.sinajs.cn/t4/appstyle/expression/ext/normal/",e.DB_NAME="Comment",e.CONFIG={lang:"zh-CN",langMode:null,appId:"",appKey:"",clazzName:"Comment",meta:["nick","mail","link"],path:location.pathname,placeholder:"Just Go Go",pageSize:10,recordIP:!0,serverURLs:"",visitor:!1,mathJax:!1,emojiCDN:"",emojiMaps:void 0,enableQQ:!1,requiredFields:[]},e.defaultMeta=["nick","mail","link"],e.QQCacheKey="_v_Cache_Q",e.MetaCacheKey="_v_Cache_Meta",e.RandomStr=function(n){return(Date.now()+Math.round(1e3*Math.random())).toString(32)},e.VERSION="1.5.1"},function(n,e,t){var a=t(16),r=t(50);for(var i in(e=n.exports=function(n,e){return new r(e).process(n)}).FilterCSS=r,a)e[i]=a[i];"undefined"!=typeof window&&(window.filterCSS=n.exports)},function(n,e,t){"use strict";var a=t(66);n.exports=function(n){return"symbol"==typeof n?"Symbol":"bigint"==typeof n?"BigInt":a(n)}},function(n,e,t){"use strict";var a=t(78);n.exports=Function.prototype.bind||a},function(n,e,t){"use strict";var a,r,i=Function.prototype.toString,o="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof o&&"function"==typeof Object.defineProperty)try{a=Object.defineProperty({},"length",{get:function(){throw r}}),r={},o((function(){throw 42}),null,a)}catch(n){n!==r&&(o=null)}else o=null;var s=/^\s*class\b/,l=function(n){try{var e=i.call(n);return s.test(e)}catch(n){return!1}},c=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,d="object"==typeof document&&void 0===document.all&&void 0!==document.all?document.all:{};n.exports=o?function(n){if(n===d)return!0;if(!n)return!1;if("function"!=typeof n&&"object"!=typeof n)return!1;if("function"==typeof n&&!n.prototype)return!0;try{o(n,null,a)}catch(n){if(n!==r)return!1}return!l(n)}:function(n){if(n===d)return!0;if(!n)return!1;if("function"!=typeof n&&"object"!=typeof n)return!1;if("function"==typeof n&&!n.prototype)return!0;if(u)return function(n){try{return!l(n)&&(i.call(n),!0)}catch(n){return!1}}(n);if(l(n))return!1;var e=c.call(n);return"[object Function]"===e||"[object GeneratorFunction]"===e}},function(n,e){n.exports={indexOf:function(n,e){var t,a;if(Array.prototype.indexOf)return n.indexOf(e);for(t=0,a=n.length;t<a;t++)if(n[t]===e)return t;return-1},forEach:function(n,e,t){var a,r;if(Array.prototype.forEach)return n.forEach(e,t);for(a=0,r=n.length;a<r;a++)e.call(t,n[a],a,n)},trim:function(n){return String.prototype.trim?n.trim():n.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(n){var e=/\s|\n|\t/.exec(n);return e?e.index:-1}}},function(n,e,t){"use strict";e.__esModule=!0;var a={cdn:t(6).DEFAULT_EMOJI_CDN,maps:t(97),parse:function(n,e){return String(n).replace(new RegExp(":("+Object.keys(a.maps).join("|")+"):","ig"),(function(n,t){return a.maps[t]?a.build(t,e):n}))},build:function(n,e){var t=/^(https?:)?\/\//i,r=a.maps[n],i=t.test(r)?r:a.cdn+r,o=' <img alt="'+n+'" referrerpolicy="no-referrer" class="vemoji" src="'+i+'" />';return t.test(i)?o:""}};e.default=a},function(n,e,t){"use strict";e.__esModule=!0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t(95));e.default=function(n){return(0,a.default)(n,{onTagAttr:function(n,e,t,a){return r(n,e,t,a)},onIgnoreTagAttr:function(n,e,t,a){return r(n,e,t,a)}}).replace(/\<\/?div\>/gi,"")};var r=function(n,e,t,r){if(/video|audio/i.test(n))return"";if(/code|pre|span/i.test(n)){if("style"==e){var i=t.match(/color:([#a-z0-9]{3,7}|\s+[#a-z0-9]{3,8})/gi);return i&&i.length?'style="'+i[0]+'"':""}if("class"==e)return e+"='"+a.default.escapeAttrValue(t)+"'"}return"a"===n&&"class"==e&&"at"===t?e+"='"+a.default.escapeAttrValue(t)+"'":"img"===n&&/src|class/i.test(e)?e+"='"+a.default.escapeAttrValue(t)+"' referrerPolicy='no-referrer'":void 0}},function(n,e,t){"use strict";var a=t(0),r=t(1),i=a("%TypeError%"),o=t(52),s=t(18),l=t(53),c=t(55),u=t(56),d=t(60),p=t(20),h=t(81),f=r("String.prototype.split"),m=Object("a"),g="a"!==m[0]||!(0 in m);n.exports=function(n){var e,t=d(this),a=g&&h(this)?f(this,""):t,r=u(a);if(!c(n))throw new i("Array.prototype.forEach callback must be a function");arguments.length>1&&(e=arguments[1]);for(var m=0;m<r;){var v=p(m);if(l(a,v)){var y=s(a,v);o(n,e,[y,m,a])}m+=1}}},function(n,e,t){"use strict";var a=t(75),r=t(14);n.exports=function(){var n=Array.prototype.forEach;return a(n)?n:r}},function(n,e){function t(){var n={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return n}var a=/javascript\s*\:/gim;e.whiteList=t(),e.getDefaultWhiteList=t,e.onAttr=function(n,e,t){},e.onIgnoreAttr=function(n,e,t){},e.safeAttrValue=function(n,e){return a.test(e)?"":e}},function(n,e){n.exports={indexOf:function(n,e){var t,a;if(Array.prototype.indexOf)return n.indexOf(e);for(t=0,a=n.length;t<a;t++)if(n[t]===e)return t;return-1},forEach:function(n,e,t){var a,r;if(Array.prototype.forEach)return n.forEach(e,t);for(a=0,r=n.length;a<r;a++)e.call(t,n[a],a,n)},trim:function(n){return String.prototype.trim?n.trim():n.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(n){return String.prototype.trimRight?n.trimRight():n.replace(/(\s*$)/g,"")}}},function(n,e,t){"use strict";var a=t(0)("%TypeError%"),r=t(86),i=t(19),o=t(8);n.exports=function(n,e){if("Object"!==o(n))throw new a("Assertion failed: Type(O) is not Object");if(!i(e))throw new a("Assertion failed: IsPropertyKey(P) is not true, got "+r(e));return n[e]}},function(n,e,t){"use strict";n.exports=function(n){return"string"==typeof n||"symbol"==typeof n}},function(n,e,t){"use strict";var a=t(0),r=a("%String%"),i=a("%TypeError%");n.exports=function(n){if("symbol"==typeof n)throw new i("Cannot convert a Symbol value to a string");return r(n)}},function(n,e,t){"use strict";n.exports=function(n){return null===n||"function"!=typeof n&&"object"!=typeof n}},function(n,e,t){"use strict";var a="undefined"!=typeof Symbol&&Symbol,r=t(23);n.exports=function(){return"function"==typeof a&&"function"==typeof Symbol&&"symbol"==typeof a("foo")&&"symbol"==typeof Symbol("bar")&&r()}},function(n,e,t){"use strict";n.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var n={},e=Symbol("test"),t=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;for(e in n[e]=42,n)return!1;if("function"==typeof Object.keys&&0!==Object.keys(n).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(n).length)return!1;var a=Object.getOwnPropertySymbols(n);if(1!==a.length||a[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(n,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},function(n,e,t){"use strict";var a=t(23);n.exports=function(){return a()&&!!Symbol.toStringTag}},function(n,e,t){"use strict";var a=t(9);n.exports=a.call(Function.call,Object.prototype.hasOwnProperty)},function(n,e,t){"use strict";var a=Object.prototype.toString;n.exports=function(n){var e=a.call(n),t="[object Arguments]"===e;return t||(t="[object Array]"!==e&&null!==n&&"object"==typeof n&&"number"==typeof n.length&&n.length>=0&&"[object Function]"===a.call(n.callee)),t}},function(n,e,t){"use strict";var a=t(5),r=t(1),i=r("Object.prototype.propertyIsEnumerable"),o=r("Array.prototype.push");n.exports=function(n){var e=a(n),t=[];for(var r in e)i(e,r)&&o(t,[r,e[r]]);return t}},function(n,e,t){"use strict";var a=t(27);n.exports=function(){return"function"==typeof Object.entries?Object.entries:a}},function(n,e,t){"use strict";var a=t(5),r=t(20),i=t(1)("String.prototype.replace"),o=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,s=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;n.exports=function(){var n=r(a(this));return i(i(n,o,""),s,"")}},function(n,e,t){"use strict";var a=t(29);n.exports=function(){return String.prototype.trim&&""==="".trim()?String.prototype.trim:a}},function(n,e,t){function a(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}function r(n){return n.replace(g,"&lt;").replace(v,"&gt;")}function i(n){return n.replace(y,"&quot;")}function o(n){return n.replace(b,'"')}function s(n){return n.replace(k,(function(n,e){return"x"===e[0]||"X"===e[0]?String.fromCharCode(parseInt(e.substr(1),16)):String.fromCharCode(parseInt(e,10))}))}function l(n){return n.replace(w,":").replace(x," ")}function c(n){for(var e="",t=0,a=n.length;t<a;t++)e+=n.charCodeAt(t)<32?" ":n.charAt(t);return f.trim(e)}function u(n){return c(n=l(n=s(n=o(n))))}function d(n){return r(n=i(n))}var p=t(7).FilterCSS,h=t(7).getDefaultWhiteList,f=t(11),m=new p,g=/</g,v=/>/g,y=/"/g,b=/&quot;/g,k=/&#([a-zA-Z0-9]*);?/gim,w=/&colon;?/gim,x=/&newline;?/gim,S=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,_=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,j=/u\s*r\s*l\s*\(.*/gi;e.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},e.getDefaultWhiteList=a,e.onTag=function(n,e,t){},e.onIgnoreTag=function(n,e,t){},e.onTagAttr=function(n,e,t){},e.onIgnoreTagAttr=function(n,e,t){},e.safeAttrValue=function(n,e,t,a){if(t=u(t),"href"===e||"src"===e){if("#"===(t=f.trim(t)))return"#";if("http://"!==t.substr(0,7)&&"https://"!==t.substr(0,8)&&"mailto:"!==t.substr(0,7)&&"tel:"!==t.substr(0,4)&&"data:image/"!==t.substr(0,11)&&"ftp://"!==t.substr(0,6)&&"./"!==t.substr(0,2)&&"../"!==t.substr(0,3)&&"#"!==t[0]&&"/"!==t[0])return""}else if("background"===e){if(S.lastIndex=0,S.test(t))return""}else if("style"===e){if(_.lastIndex=0,_.test(t))return"";if(j.lastIndex=0,j.test(t)&&(S.lastIndex=0,S.test(t)))return"";!1!==a&&(t=(a=a||m).process(t))}return d(t)},e.escapeHtml=r,e.escapeQuote=i,e.unescapeQuote=o,e.escapeHtmlEntities=s,e.escapeDangerHtml5Entities=l,e.clearNonPrintableCharacter=c,e.friendlyAttrValue=u,e.escapeAttrValue=d,e.onIgnoreTagStripAll=function(){return""},e.StripTagBody=function(n,e){function t(e){return!!a||-1!==f.indexOf(n,e)}"function"!=typeof e&&(e=function(){});var a=!Array.isArray(n),r=[],i=!1;return{onIgnoreTag:function(n,a,o){if(t(n)){if(o.isClosing){var s="[/removed]",l=o.position+s.length;return r.push([!1!==i?i:o.position,l]),i=!1,s}return i||(i=o.position),"[removed]"}return e(n,a,o)},remove:function(n){var e="",t=0;return f.forEach(r,(function(a){e+=n.slice(t,a[0]),t=a[1]})),e+=n.slice(t)}}},e.stripCommentTag=function(n){for(var e="",t=0;t<n.length;){var a=n.indexOf("\x3c!--",t);if(-1===a){e+=n.slice(t);break}e+=n.slice(t,a);var r=n.indexOf("--\x3e",a);if(-1===r)break;t=r+3}return e},e.stripBlankChar=function(n){var e=n.split("");return(e=e.filter((function(n){var e=n.charCodeAt(0);return!(127===e||e<=31&&10!==e&&13!==e)}))).join("")},e.cssFilter=m,e.getDefaultCSSWhiteList=h},function(n,e,t){function a(n){var e=l.spaceIndex(n);if(-1===e)var t=n.slice(1,-1);else t=n.slice(1,e+1);return"/"===(t=l.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function r(n){return"</"===n.slice(0,2)}function i(n,e){for(;e<n.length;e++){var t=n[e];if(" "!==t)return"="===t?e:-1}}function o(n,e){for(;e>0;e--){var t=n[e];if(" "!==t)return"="===t?e:-1}}function s(n){return function(n){return'"'===n[0]&&'"'===n[n.length-1]||"'"===n[0]&&"'"===n[n.length-1]}(n)?n.substr(1,n.length-2):n}var l=t(11),c=/[^a-zA-Z0-9_:\.\-]/gim;e.parseTag=function(n,e,t){"use strict";var i="",o=0,s=!1,l=!1,c=0,u=n.length,d="",p="";n:for(c=0;c<u;c++){var h=n.charAt(c);if(!1===s){if("<"===h){s=c;continue}}else if(!1===l){if("<"===h){i+=t(n.slice(o,c)),s=c,o=c;continue}if(">"===h){i+=t(n.slice(o,s)),d=a(p=n.slice(s,c+1)),i+=e(s,i.length,d,p,r(p)),o=c+1,s=!1;continue}if('"'===h||"'"===h)for(var f=1,m=n.charAt(c-f);""===m.trim()||"="===m;){if("="===m){l=h;continue n}m=n.charAt(c-++f)}}else if(h===l){l=!1;continue}}return o<n.length&&(i+=t(n.substr(o))),i},e.parseAttr=function(n,e){"use strict";function t(n,t){if(!((n=(n=l.trim(n)).replace(c,"").toLowerCase()).length<1)){var a=e(n,t||"");a&&r.push(a)}}for(var a=0,r=[],u=!1,d=n.length,p=0;p<d;p++){var h,f=n.charAt(p);if(!1!==u||"="!==f)if(!1===u||p!==a||'"'!==f&&"'"!==f||"="!==n.charAt(p-1)){if(/\s|\n|\t/.test(f)){if(n=n.replace(/\s|\n|\t/g," "),!1===u){if(-1===(h=i(n,p))){t(l.trim(n.slice(a,p))),u=!1,a=p+1;continue}p=h-1;continue}if(-1===(h=o(n,p-1))){t(u,s(l.trim(n.slice(a,p)))),u=!1,a=p+1;continue}}}else{if(-1===(h=n.indexOf(f,p+1)))break;t(u,l.trim(n.slice(a+1,h))),u=!1,a=(p=h)+1}else u=n.slice(a,p),a=p+1}return a<n.length&&(!1===u?t(n.slice(a)):t(u,s(l.trim(n.slice(a))))),l.trim(r.join(" "))}},function(n,e,t){var a,r,i;
/*!
	autosize 4.0.4
	license: MIT
	http://www.jacklmoore.com/autosize
*/r=[n,e],a=function(n,e){"use strict";function t(n){function e(e){var t=n.style.width;n.style.width="0px",n.offsetWidth,n.style.width=t,n.style.overflowY=e}function t(){if(0!==n.scrollHeight){var e=function(n){for(var e=[];n&&n.parentNode&&n.parentNode instanceof Element;)n.parentNode.scrollTop&&e.push({node:n.parentNode,scrollTop:n.parentNode.scrollTop}),n=n.parentNode;return e}(n),t=document.documentElement&&document.documentElement.scrollTop;n.style.height="",n.style.height=n.scrollHeight+r+"px",s=n.clientWidth,e.forEach((function(n){n.node.scrollTop=n.scrollTop})),t&&(document.documentElement.scrollTop=t)}}function a(){t();var a=Math.round(parseFloat(n.style.height)),r=window.getComputedStyle(n,null),i="content-box"===r.boxSizing?Math.round(parseFloat(r.height)):n.offsetHeight;if(i<a?"hidden"===r.overflowY&&(e("scroll"),t(),i="content-box"===r.boxSizing?Math.round(parseFloat(window.getComputedStyle(n,null).height)):n.offsetHeight):"hidden"!==r.overflowY&&(e("hidden"),t(),i="content-box"===r.boxSizing?Math.round(parseFloat(window.getComputedStyle(n,null).height)):n.offsetHeight),l!==i){l=i;var s=o("autosize:resized");try{n.dispatchEvent(s)}catch(n){}}}if(n&&n.nodeName&&"TEXTAREA"===n.nodeName&&!i.has(n)){var r=null,s=null,l=null,c=function(){n.clientWidth!==s&&a()},u=function(e){window.removeEventListener("resize",c,!1),n.removeEventListener("input",a,!1),n.removeEventListener("keyup",a,!1),n.removeEventListener("autosize:destroy",u,!1),n.removeEventListener("autosize:update",a,!1),Object.keys(e).forEach((function(t){n.style[t]=e[t]})),i.delete(n)}.bind(n,{height:n.style.height,resize:n.style.resize,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",u,!1),"onpropertychange"in n&&"oninput"in n&&n.addEventListener("keyup",a,!1),window.addEventListener("resize",c,!1),n.addEventListener("input",a,!1),n.addEventListener("autosize:update",a,!1),n.style.overflowX="hidden",n.style.wordWrap="break-word",i.set(n,{destroy:u,update:a}),function(){var e=window.getComputedStyle(n,null);"vertical"===e.resize?n.style.resize="none":"both"===e.resize&&(n.style.resize="horizontal"),r="content-box"===e.boxSizing?-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)):parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth),isNaN(r)&&(r=0),a()}()}}function a(n){var e=i.get(n);e&&e.destroy()}function r(n){var e=i.get(n);e&&e.update()}var i="function"==typeof Map?new Map:function(){var n=[],e=[];return{has:function(e){return n.indexOf(e)>-1},get:function(t){return e[n.indexOf(t)]},set:function(t,a){-1===n.indexOf(t)&&(n.push(t),e.push(a))},delete:function(t){var a=n.indexOf(t);a>-1&&(n.splice(a,1),e.splice(a,1))}}}(),o=function(n){return new Event(n,{bubbles:!0})};try{new Event("test")}catch(n){o=function(n){var e=document.createEvent("Event");return e.initEvent(n,!0,!1),e}}var s=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((s=function(n){return n}).destroy=function(n){return n},s.update=function(n){return n}):((s=function(n,e){return n&&Array.prototype.forEach.call(n.length?n:[n],(function(n){return t(n)})),n}).destroy=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],a),n},s.update=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],r),n}),e.default=s,n.exports=e.default},void 0!==(i="function"==typeof a?a.apply(e,r):a)&&(n.exports=i)},function(n,e,t){"use strict";function a(n){return n&&n.__esModule?n:{default:n}}function r(n){return!!n&&this.init(n),this}function i(n){return new r(n)}var o=a(t(42)),s=a(t(33)),l=a(t(37)),c=a(t(12)),u=t(6),d=a(t(41)),p=a(t(36)),h=t(40),f=a(t(38)),m=a(t(3)),g=a(t(39)),v=a(t(13)),y=(a(t(35)),{comment:"",nick:"",mail:"",link:"",ua:m.default.ua,url:"",QQAvatar:""}),b="",k={},w={cdn:"https://gravatar.loli.net/avatar/",ds:["mp","identicon","monsterid","wavatar","robohash","retro",""],params:"",hide:!1};r.prototype.init=function(n){if("undefined"==typeof document)throw new Error("Sorry, Valine does not support Server-side rendering.");var e=this;return n&&(n=m.default.extend(u.CONFIG,n),e.i18n=(0,l.default)(n.lang||m.default.lang,n.langMode),e.cfg=n,c.default.maps=!!n.emojiMaps&&n.emojiMaps||c.default.maps,c.default.cdn=!!n.emojiCDN&&n.emojiCDN||c.default.cdn,e._init()),e},r.prototype._init=function(){var n=this;try{var e=n.cfg,t=e.avatar,a=e.avatarForce,r=e.avatar_cdn,i=e.visitor,o=e.path,s=void 0===o?location.pathname:o,l=e.pageSize,c=e.recordIP;n.cfg.path=s.replace(/index\.html?$/,"");var d=w.ds,g=a?"&q="+(0,u.RandomStr)():"";w.params="?d="+(d.indexOf(t)>-1?t:"mp")+"&v="+u.VERSION+g,w.hide="hide"===t,w.cdn=/^https?\:\/\//.test(r)?r:w.cdn,n.cfg.pageSize=isNaN(l)||l<1?10:l,c&&(0,h.recordIPFn)((function(n){return y.ip=n}));var v=n.cfg.el||null,b=(0,m.default)(v);if(v=v instanceof HTMLElement?v:b[b.length-1]||null){n.$el=(0,m.default)(v),n.$el.addClass("v").attr("data-class","v"),w.hide&&n.$el.addClass("hide-avatar"),n.cfg.meta=(n.cfg.guest_info||n.cfg.meta||u.defaultMeta).filter((function(n){return u.defaultMeta.indexOf(n)>-1})),n.cfg.requiredFields=n.cfg.requiredFields.filter((function(n){return u.defaultMeta.indexOf(n)>-1}));var k=(0==n.cfg.meta.length?u.defaultMeta:n.cfg.meta).map((function(e){var t="mail"==e?"email":"text";return u.defaultMeta.indexOf(e)>-1?'<input name="'+e+'" placeholder="'+n.i18n.t(e)+'" class="v'+e+' vinput" type="'+t+'">':""})),x='<div class="vpanel"><div class="vwrap"><p class="cancel-reply text-right" style="display:none;" title="'+n.i18n.t("cancelReply")+'"><svg class="vicon cancel-reply-btn" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4220" width="22" height="22"><path d="M796.454 985H227.545c-50.183 0-97.481-19.662-133.183-55.363-35.7-35.701-55.362-83-55.362-133.183V227.545c0-50.183 19.662-97.481 55.363-133.183 35.701-35.7 83-55.362 133.182-55.362h568.909c50.183 0 97.481 19.662 133.183 55.363 35.701 35.702 55.363 83 55.363 133.183v568.909c0 50.183-19.662 97.481-55.363 133.183S846.637 985 796.454 985zM227.545 91C152.254 91 91 152.254 91 227.545v568.909C91 871.746 152.254 933 227.545 933h568.909C871.746 933 933 871.746 933 796.454V227.545C933 152.254 871.746 91 796.454 91H227.545z" p-id="4221"></path><path d="M568.569 512l170.267-170.267c15.556-15.556 15.556-41.012 0-56.569s-41.012-15.556-56.569 0L512 455.431 341.733 285.165c-15.556-15.556-41.012-15.556-56.569 0s-15.556 41.012 0 56.569L455.431 512 285.165 682.267c-15.556 15.556-15.556 41.012 0 56.569 15.556 15.556 41.012 15.556 56.569 0L512 568.569l170.267 170.267c15.556 15.556 41.012 15.556 56.569 0 15.556-15.556 15.556-41.012 0-56.569L568.569 512z" p-id="4222" ></path></svg></p><div class="vheader item'+k.length+'">'+k.join("")+'</div><div class="vedit"><textarea id="veditor" class="veditor vinput" placeholder="'+n.cfg.placeholder+'"></textarea><div class="vrow"><div class="vcol vcol-60 status-bar"></div><div class="vcol vcol-40 vctrl text-right"><span title="'+n.i18n.t("emoji")+'"  class="vicon vemoji-btn"><svg  viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16172" width="22" height="22" ><path d="M512 1024a512 512 0 1 1 512-512 512 512 0 0 1-512 512zM512 56.888889a455.111111 455.111111 0 1 0 455.111111 455.111111 455.111111 455.111111 0 0 0-455.111111-455.111111zM312.888889 512A85.333333 85.333333 0 1 1 398.222222 426.666667 85.333333 85.333333 0 0 1 312.888889 512z" p-id="16173"></path><path d="M512 768A142.222222 142.222222 0 0 1 369.777778 625.777778a28.444444 28.444444 0 0 1 56.888889 0 85.333333 85.333333 0 0 0 170.666666 0 28.444444 28.444444 0 0 1 56.888889 0A142.222222 142.222222 0 0 1 512 768z" p-id="16174"></path><path d="M782.222222 391.964444l-113.777778 59.733334a29.013333 29.013333 0 0 1-38.684444-10.808889 28.444444 28.444444 0 0 1 10.24-38.684445l113.777778-56.888888a28.444444 28.444444 0 0 1 38.684444 10.24 28.444444 28.444444 0 0 1-10.24 36.408888z" p-id="16175"></path><path d="M640.568889 451.697778l113.777778 56.888889a27.875556 27.875556 0 0 0 38.684444-10.24 27.875556 27.875556 0 0 0-10.24-38.684445l-113.777778-56.888889a28.444444 28.444444 0 0 0-38.684444 10.808889 28.444444 28.444444 0 0 0 10.24 38.115556z" p-id="16176"></path></svg></span><span title="'+n.i18n.t("preview")+'" class="vicon vpreview-btn"><svg  viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17688" width="22" height="22"><path d="M502.390154 935.384615a29.538462 29.538462 0 1 1 0 59.076923H141.430154C79.911385 994.461538 29.538462 946.254769 29.538462 886.153846V137.846154C29.538462 77.745231 79.950769 29.538462 141.390769 29.538462h741.218462c61.44 0 111.852308 48.206769 111.852307 108.307692v300.268308a29.538462 29.538462 0 1 1-59.076923 0V137.846154c0-26.899692-23.355077-49.230769-52.775384-49.230769H141.390769c-29.420308 0-52.775385 22.331077-52.775384 49.230769v748.307692c0 26.899692 23.355077 49.230769 52.775384 49.230769h360.999385z" p-id="17689"></path><path d="M196.923077 216.615385m29.538461 0l374.153847 0q29.538462 0 29.538461 29.538461l0 0q0 29.538462-29.538461 29.538462l-374.153847 0q-29.538462 0-29.538461-29.538462l0 0q0-29.538462 29.538461-29.538461Z" p-id="17690"></path><path d="M649.846154 846.769231a216.615385 216.615385 0 1 0 0-433.230769 216.615385 216.615385 0 0 0 0 433.230769z m0 59.076923a275.692308 275.692308 0 1 1 0-551.384616 275.692308 275.692308 0 0 1 0 551.384616z" p-id="17691"></path><path d="M807.398383 829.479768m20.886847-20.886846l0 0q20.886846-20.886846 41.773692 0l125.321079 125.321079q20.886846 20.886846 0 41.773693l0 0q-20.886846 20.886846-41.773693 0l-125.321078-125.321079q-20.886846-20.886846 0-41.773693Z" p-id="17692"></path></svg></span></div></div></div><div class="vrow"><div class="vcol vcol-30" ><a alt="Markdown is supported" href="https://guides.github.com/features/mastering-markdown/" class="vicon" target="_blank"><svg class="markdown" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z"></path></svg></a></div><div class="vcol vcol-70 text-right"><button type="button"  title="Cmd|Ctrl+Enter" class="vsubmit vbtn">'+n.i18n.t("submit")+'</button></div></div><div class="vemojis" style="display:none;"></div><div class="vinput vpreview" style="display:none;"></div></div></div><div class="vcount" style="display:none;"><span class="vnum">0</span> '+n.i18n.t("comments")+'</div><div class="vload-top text-center" style="display:none;"><i class="vspinner" style="width:30px;height:30px;"></i></div><div class="vcards"></div><div class="vload-bottom text-center" style="display:none;"><i class="vspinner" style="width:30px;height:30px;"></i></div><div class="vempty" style="display:none;"></div><div class="vpage txt-center" style="display:none"><button type="button" class="vmore vbtn">'+n.i18n.t("more")+'</button></div><div class="vpower txt-right">Powered By <a href="https://valine.js.org" target="_blank">Valine</a><br>v'+u.VERSION+"</div>";n.$el.html(x),n.$el.find(".cancel-reply").on("click",(function(e){n.reset()}));var _=n.$el.find(".vempty");n.$nodata={show:function(e){return _.html(e||n.i18n.t("sofa")).show(),n},hide:function(){return _.hide(),n}};var j=n.$el.find(".vload-bottom"),T=n.$el.find(".vload-top");n.$loading={show:function(e){return e&&T.show()||j.show(),n.$nodata.hide(),n},hide:function(){return T.hide(),j.hide(),0===n.$el.find(".vcard").length&&n.$nodata.show(),n}}}(0,p.default)(n.cfg,(function(e){var t=(0,m.default)(".valine-comment-count"),a=0;!function e(t){var r=t[a++];if(r){var i=(0,m.default)(r).attr("data-xid");i&&n.Q(i).count().then((function(n){r.innerText=n,e(t)})).catch((function(n){r.innerText=0}))}}(t),i&&S.add(AV.Object.extend("Counter"),n.cfg.path),n.$el&&n.bind()}))}catch(e){(0,f.default)(n,e,"init")}};var x=function(n,e){var t=new n,a=new AV.ACL;a.setPublicReadAccess(!0),a.setPublicWriteAccess(!0),t.setACL(a),t.set("url",e.url),t.set("xid",e.xid),t.set("title",e.title),t.set("time",1),t.save().then((function(n){(0,m.default)(e.el).find(".leancloud-visitors-count").text(1)})).catch((function(n){}))},S={add:function(n,e){var t=this,a=(0,m.default)(".leancloud_visitors,.leancloud-visitors");if(1===a.length){var r=a[0],i=decodeURI((0,m.default)(r).attr("id")),o=(0,m.default)(r).attr("data-flag-title"),s=encodeURI(i),l={el:r,url:i,xid:s,title:o};if(decodeURI(i)===decodeURI(e)){var c=new AV.Query(n);c.equalTo("url",i),c.find().then((function(e){if(e.length>0){var t=e[0];t.increment("time"),t.save().then((function(n){(0,m.default)(r).find(".leancloud-visitors-count").text(n.get("time"))})).catch((function(n){}))}else x(n,l)})).catch((function(e){101==e.code?x(n,l):(0,f.default)(t,e)}))}else S.show(n,a)}else S.show(n,a)},show:function(n,e){var t=[];if(e.forEach((function(n){var e=(0,m.default)(n).find(".leancloud-visitors-count");e&&e.text("0"),t.push(/\%/.test((0,m.default)(n).attr("id"))?decodeURI((0,m.default)(n).attr("id")):(0,m.default)(n).attr("id"))})),t.length){var a=new AV.Query(n);a.containedIn("url",t),a.find().then((function(n){n.length>0&&e.forEach((function(e){n.forEach((function(n){var t=n.get("xid")||encodeURI(n.get("url")),a=n.get("time"),r=(0,m.default)(e),i=r.attr("id");if((/\%/.test(i)?i:encodeURI(i))==t){var o=r.find(".leancloud-visitors-count");o&&o.text(a)}}))}))})).catch((function(n){}))}}};r.prototype.Q=function(n){var e=this,t=arguments.length,a=e.cfg.clazzName;if(1==t){var r=new AV.Query(a);r.doesNotExist("rid");var i=new AV.Query(a);i.equalTo("rid","");var o=AV.Query.or(r,i);return"*"===n?o.exists("url"):o.equalTo("url",decodeURI(n)),o.addDescending("createdAt"),o.addDescending("insertedAt"),o}var s=JSON.stringify(arguments[1]).replace(/(\[|\])/g,""),l="select * from "+a+" where rid in ("+s+") order by -createdAt,-createdAt";return AV.Query.doCloudQuery(l)},r.prototype.installLocale=function(n,e){return this.i18n(n,e),this},r.prototype.setPath=function(n){return this.config.path=n,this},r.prototype.bind=function(){var n=this,e=n.$el.find(".vemojis"),t=n.$el.find(".vpreview"),a=n.$el.find(".vemoji-btn"),r=n.$el.find(".vpreview-btn"),i=n.$el.find(".veditor"),l=c.default.maps,p=!1;n.$emoji={show:function(){return!p&&function(n){var t=[];for(var a in l)l.hasOwnProperty(a)&&c.default.build(a)&&t.push('<i title="'+a+'" >'+c.default.build(a)+"</i>");e.html(t.join("")),p=!0,e.find("i").on("click",(function(n){n.preventDefault(),A(i[0]," :"+(0,m.default)(this).attr("title")+":")}))}(),n.$preview.hide(),e.show(),a.addClass("actived"),n.$emoji},hide:function(){return a.removeClass("actived"),e.hide(),n.$emoji}},n.$preview={show:function(){return b?(n.$emoji.hide(),r.addClass("actived"),t.html((0,g.default)(b)).show(),D()):n.$preview.hide(),n.$preview},hide:function(){return r.removeClass("actived"),t.hide().html(""),n.$preview}};var x=function(e){var a=e.val()||"";a||n.$preview.hide(),b!=a&&(b=a,r.hasClass("actived")>-1&&b!=t.html()&&t.html((0,g.default)(b)),D())};a.on("click",(function(e){a.hasClass("actived")?n.$emoji.hide():n.$emoji.show()})),r.on("click",(function(e){r.hasClass("actived")?n.$preview.hide():n.$preview.show()}));var S=n.cfg.meta,_={},j={veditor:"comment"};for(var T in S.forEach((function(n){j["v"+n]=n})),j)j.hasOwnProperty(T)&&function(){var e=j[T],t=n.$el.find("."+T);_[e]=t,t.on("input change blur propertychange",(function(a){n.cfg.enableQQ&&"blur"===a.type&&"nick"===e&&(t.val()&&!isNaN(t.val())?(0,h.fetchQQFn)(t.val(),(function(n){var e=n.nick||t.val(),a=n.qq+"@qq.com";(0,m.default)(".vnick").val(e),(0,m.default)(".vmail").val(a),y.nick=e,y.mail=a,y.QQAvatar=n.pic})):m.default.store.get(u.QQCacheKey)&&m.default.store.get(u.QQCacheKey).nick!=t.val()&&(m.default.store.remove(u.QQCacheKey),y.nick=t.val(),y.mail="",y.QQAvatar="")),"comment"===e?((0,s.default)(t[0]),C((function(n){x(t)}))()):y[e]=(0,v.default)(t.val().replace(/(^\s*)|(\s*$)/g,"").substring(0,35))}))}();var C=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,t=void 0;return function(){var a=this,r=arguments;t&&clearTimeout(t),t=setTimeout((function(){n.apply(a,r)}),e)}},A=function(n,e){if(document.selection)n.focus(),document.selection.createRange().text=e,n.focus();else if(n.selectionStart||"0"==n.selectionStart){var t=n.selectionStart,a=n.selectionEnd,r=n.scrollTop;n.value=n.value.substring(0,t)+e+n.value.substring(a,n.value.length),n.focus(),n.selectionStart=t+e.length,n.selectionEnd=t+e.length,n.scrollTop=r}else n.focus(),n.value+=e;C((function(e){x((0,m.default)(n))}))()},I={no:1,size:n.cfg.pageSize,skip:n.cfg.pageSize},E=n.$el.find(".vpage");E.on("click",(function(n){E.hide(),I.no++,O()}));var O=function(){var e=I.size,t=I.no,a=Number(n.$el.find(".vnum").text());n.$loading.show();var r=n.Q(n.cfg.path);r.limit(e),r.skip((t-1)*e),r.find().then((function(r){if(I.skip=I.size,r&&r.length){var i=[];r.forEach((function(e){i.push(e.id),$(e,n.$el.find(".vcards"),!0)})),n.Q(n.cfg.path,i).then((function(n){(n&&n.results||[]).forEach((function(n){$(n,(0,m.default)('.vquote[data-self-id="'+n.get("rid")+'"]'))}))})).catch((function(n){})),e*t<a?E.show():E.hide(),D()}else n.$nodata.show();n.$loading.hide()})).catch((function(e){n.$loading.hide(),(0,f.default)(n,e,"query")}))};n.Q(n.cfg.path).count().then((function(e){e>0?(n.$el.find(".vcount").show().find(".vnum").text(e),O()):n.$loading.hide()})).catch((function(e){(0,f.default)(n,e,"count")}));var L=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=/(https?|http):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,t=n.match(e)||[];return t.length>0?t[0]:""},$=function(e,t,a){var r=(0,m.default)('<div class="vcard" id="'+e.id+'"></div>'),i=(0,v.default)(e.get("ua")),s="";i&&!/ja/.test(n.cfg.lang)&&(s=(i=m.default.detect(i)).version?i.os?'<span class="vsys">'+i.browser+" "+i.version+'</span> <span class="vsys">'+i.os+" "+i.osVersion+"</span>":"":'<span class="vsys">'+i.browser+"</span>"),"*"===n.cfg.path&&(s='<a href="'+e.get("url")+'" class="vsys">'+e.get("url")+"</a>");var l=e.get("link")?/^https?\:\/\//.test(e.get("link"))?e.get("link"):"http://"+e.get("link"):"",c=m.default.escape((0,v.default)(e.get("nick").substring(0,30))),u=l?'<a class="vnick" rel="nofollow" href="'+L(l)+'" target="_blank" >'+c+"</a>":'<span class="vnick">'+c+"</span>",p=(w.hide?"":n.cfg.enableQQ&&e.get("QQAvatar")?(0,v.default)('<img class="vimg" src="'+L(e.get("QQAvatar"))+'" referrerPolicy="no-referrer"/>'):'<img class="vimg" src="'+(w.cdn+(0,o.default)(e.get("mail"))+w.params)+'">')+'<div class="vh"><div class="vhead">'+u+" "+s+'</div><div class="vmeta"><span class="vtime" >'+(0,d.default)(e.get("insertedAt"),n.i18n)+'</span><span class="vat" data-vm-id="'+(e.get("rid")||e.id)+'" data-self-id="'+e.id+'">'+n.i18n.t("reply")+'</span></div><div class="vcontent" data-expand="'+n.i18n.t("expand")+'">'+(0,g.default)(e.get("comment"))+'</div><div class="vreply-wrapper" data-self-id="'+e.id+'"></div><div class="vquote" data-self-id="'+e.id+'"></div></div>';r.html(p);var h=r.find(".vat");r.find("a:not(.at)").forEach((function(n){(0,m.default)(n).attr({target:"_blank",rel:"noopener"})})),a?t.append(r):t.prepend(r);var f=r.find(".vcontent");f&&M(f),h&&z(h,e)},P={},z=function(e,t){e.on("click",(function(a){var r=e.attr("data-vm-id"),i=e.attr("data-self-id"),o=n.$el.find(".vwrap"),s="@"+m.default.escape(t.get("nick"));(0,m.default)('.vreply-wrapper[data-self-id="'+i+'"]').append(o).find(".cancel-reply").show(),P={at:m.default.escape(s)+" ",rid:r,pid:i,rmail:t.get("mail")},_.comment.attr({placeholder:s})[0].focus()}))},D=function(){setTimeout((function(){try{n.cfg.mathjax&&"MathJax"in window&&"version"in window.MathJax&&(/^3.*/.test(window.MathJax.version)&&MathJax.typeset()||MathJax.Hub.Queue(["Typeset",MathJax.Hub,document.querySelector(".v")])),"renderMathInElement"in window&&renderMathInElement((0,m.default)(".v")[0],{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})}catch(n){}}),100)},M=function(n){setTimeout((function(){n[0].offsetHeight>200&&(n.addClass("expand"),n.on("click",(function(e){n.removeClass("expand")})))}))};!function(e){if(e=m.default.store.get(u.MetaCacheKey)||e)for(var t in S)if(S.hasOwnProperty(t)){var a=S[t];n.$el.find(".v"+a).val(m.default.unescape(e[a])),y[a]=e[a]}var r=m.default.store.get(u.QQCacheKey);y.QQAvatar=n.cfg.enableQQ&&!!r&&r.pic||""}(),n.reset=function(){y.comment="",_.comment.val(""),x(_.comment),_.comment.attr("placeholder",n.cfg.placeholder),P={},n.$preview.hide(),n.$el.find(".vpanel").append(n.$el.find(".vwrap")),n.$el.find(".cancel-reply").hide(),b="",s.default.update(_.comment[0])};var F=n.$el.find(".vsubmit"),R=function(e){if(n.cfg.requiredFields.indexOf("nick")>-1&&y.nick.length<3)return _.nick[0].focus(),void n.$el.find(".status-bar").text(""+n.i18n.t("nickFail")).empty(3e3);if(n.cfg.requiredFields.indexOf("mail")>-1&&!/[\w-\.]+@([\w-]+\.)+[a-z]{2,3}/.test(y.mail))return _.mail[0].focus(),void n.$el.find(".status-bar").text(""+n.i18n.t("mailFail")).empty(3e3);if(""!=b){for(var t in k)if(k.hasOwnProperty(t)){var a=k[t];b=b.replace(t,a),URL.revokeObjectURL(t)}k={},y.comment=(0,v.default)(b),y.nick=y.nick||"Anonymous";var r=m.default.store.get("vlx");r&&Date.now()/1e3-r/1e3<20?n.$el.find(".status-bar").text(n.i18n.t("busy")).empty(3e3):q()}else _.comment[0].focus()},q=function(){m.default.store.set("vlx",Date.now()),F.attr({disabled:!0}),n.$loading.show(!0);var e=new(AV.Object.extend(n.cfg.clazzName||"Comment"));if(y.url=decodeURI(n.cfg.path),y.insertedAt=new Date,P.rid){var t=P.pid||P.rid;e.set("rid",P.rid),e.set("pid",t),y.comment=b.replace("<p>",'<p><a class="at" href="#'+t+'">'+P.at+"</a> , ")}for(var a in y)if(y.hasOwnProperty(a)){var r=y[a];e.set(a,r)}e.setACL(function(){var n=new AV.ACL;return n.setPublicReadAccess(!0),n.setPublicWriteAccess(!1),n}()),e.save().then((function(e){"Anonymous"!=y.nick&&m.default.store.set(u.MetaCacheKey,{nick:y.nick,link:y.link,mail:y.mail});var t=n.$el.find(".vnum");try{P.rid?$(e,(0,m.default)('.vquote[data-self-id="'+P.rid+'"]'),!0):(Number(t.text())?t.text(Number(t.text())+1):n.$el.find(".vcount").show().find(".vnum").text(Number(t.text())+1),$(e,n.$el.find(".vcards")),I.skip++),F.removeAttr("disabled"),n.$loading.hide(),n.reset()}catch(e){(0,f.default)(n,e,"save")}})).catch((function(e){(0,f.default)(n,e,"commitEvt")}))};F.on("click",R),(0,m.default)(document).on("keydown",(function(n){var e=(n=window.event||n).keyCode||n.which||n.charCode;(n.ctrlKey||n.metaKey)&&13===e&&R(),9===e&&"veditor"==(document.activeElement.id||"")&&(n.preventDefault(),A(i[0],"    "))})).on("paste",(function(n){var e="clipboardData"in n?n.clipboardData:n.originalEvent&&n.originalEvent.clipboardData||window.clipboardData;e&&N(e.items,!0)})),i.on("dragenter dragleave dragover drop",(function(n){n.stopPropagation(),n.preventDefault(),"drop"===n.type&&N(n.dataTransfer.items)}));var N=function(n,e){for(var t=0,a=n.length;t<a;t++){var r=n[t];if("string"===r.kind&&r.type.match("^text/html"))!e&&r.getAsString((function(n){n&&A(i[0],n.replace(/<[^>]+>/g,""))}));else if(r.type.indexOf("image")>-1){B(r.getAsFile());continue}}},B=function(n){try{var e=URL.createObjectURL(n),t="![image]("+e+") ",a=new FileReader;A(i[0],t),a.onload=function(){k[e]=a.result},a.readAsDataURL(n)}catch(n){}}},n.exports=i,n.exports.default=i},function(n,e,t){"use strict";e.__esModule=!0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t(3));e.default={getApi:function(n,e){a.default.ajax({url:"https://app-router.com/2/route",body:{appId:n}}).then((function(n){n.json().then((function(n){return e&&e("//"+n.api_server)}))}))}}},function(n,e,t){"use strict";e.__esModule=!0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t(3)),r=!1;e.default=function(n,e){if("AV"in window){var t=window.AV.version||window.AV.VERSION;parseInt(t.split(".")[0])>2?r=!!AV.applicationId&&!!AV.applicationKey:a.default.deleteInWin("AV",0)}r?e&&e():a.default.sdkLoader("//unpkg.com/leancloud-storage@3/dist/av-min.js","AV",(function(t){var a,i="https://",o=n.app_id||n.appId,s=n.app_key||n.appKey;if(!n.serverURLs)switch(o.slice(-9)){case"-9Nh9j0Va":i+="tab.";break;case"-MdYXbMMI":i+="us."}a=n.serverURLs||i+"leancloud.cn",AV.init({appId:o,appKey:s,serverURLs:a}),r=!0,e&&e()}))}},function(n,e,t){"use strict";function a(n){return n&&n.__esModule?n:{default:n}}e.__esModule=!0;var r=a(t(84)),i=a(t(100)),o=a(t(101)),s=a(t(98)),l=a(t(99)),c={zh:i.default,"zh-cn":i.default,"zh-CN":i.default,"zh-TW":o.default,en:s.default,"en-US":s.default,ja:l.default,"ja-JP":l.default};e.default=function(n,e){return!c[n]&&n&&e&&(c[n]=e),new r.default({phrases:c[n||"zh"],locale:n})}},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n,e){if(n.$el&&n.$loading.hide().$nodata.hide(),"[object Error]"==={}.toString.call(e)){var t=e.code||e.message||e.error||"";if(isNaN(t))n.$el&&n.$nodata.show('<pre style="text-align:left;"> '+JSON.stringify(e)+"</pre>");else{var a=n.i18n.t("code-"+t),r=(a=="code-"+t?void 0:a)||e.message||e.error||"";101==t||-1==t?n.$nodata.show():n.$el&&n.$nodata.show('<pre style="text-align:left;">Code '+t+": "+r+"</pre>")}}else n.$el&&n.$nodata.show('<pre style="text-align:left;">'+JSON.stringify(e)+"</pre>")}},function(n,e,t){"use strict";function a(n){return n&&n.__esModule?n:{default:n}}e.__esModule=!0;var r=t(83),i=a(t(79)),o=a(t(3)),s=a(t(12)),l=a(t(13)),c=new r.marked.Renderer;c.code=function(n,e){return'<pre><code class="hljs language-'+e+'">'+(e&&hljs.getLanguage(e)?hljs.highlight(e,n).value:o.default.escape(n))+"</code></pre>"},r.marked.setOptions({renderer:"hljs"in window?c:new r.marked.Renderer,highlight:function(n,e){return"hljs"in window?e&&hljs.getLanguage(e)&&hljs.highlight(e,n,!0).value||hljs.highlightAuto(n).value:(0,i.default)(n)},gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!0,headerPrefix:"v-"}),e.default=function(n){return(0,l.default)((0,r.marked)(s.default.parse(n,!0)))}},function(n,e,t){"use strict";e.__esModule=!0,e.recordIPFn=e.fetchQQFn=void 0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t(3)),r=t(6);e.fetchQQFn=function(n,e){var t=a.default.store.get(r.QQCacheKey);t&&t.qq==n?e&&e(t):a.default.ajax({url:"//valine.api.ioliu.cn/getqqinfo",method:"POST",body:{qq:n}}).then((function(n){n.json().then((function(n){n.errmsg||(a.default.store.set(r.QQCacheKey,n),e&&e(n))}))}))},e.recordIPFn=function(n){a.default.ajax({url:"https://forge.speedtest.cn/api/location/info",method:"get"}).then((function(n){return n.json()})).then((function(e){n&&n(e.ip)}))}},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n,e){if(!n)return"Invalid Date.";try{var t=r(n).getTime();if(isNaN(t))return"Invalid Date.";var i=(new Date).getTime()-t,o=Math.floor(i/864e5);if(0===o){var s=i%864e5,l=Math.floor(s/36e5);if(0===l){var c=s%36e5,u=Math.floor(c/6e4);if(0===u){var d=c%6e4;return Math.round(d/1e3)+" "+e.t("seconds")}return u+" "+e.t("minutes")}return l+" "+e.t("hours")}return o<0?e.t("now"):o<8?o+" "+e.t("days"):a(n)}catch(n){}};var a=function(n){var e=i(n.getDate(),2),t=i(n.getMonth()+1,2);return i(n.getFullYear(),2)+"-"+t+"-"+e},r=function n(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):/GMT/.test(e||"")?n(new Date(e).getTime()):(e=(e||"").replace(/(^\s*)|(\s*$)/g,"").replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))},i=function(n,e){for(var t=n.toString();t.length<e;)t="0"+t;return t}},function(n,e,t){var a;!function(r){"use strict";function i(n,e){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}function o(n,e,t,a,r,o){return i(function(n,e){return n<<e|n>>>32-e}(i(i(e,n),i(a,o)),r),t)}function s(n,e,t,a,r,i,s){return o(e&t|~e&a,n,e,r,i,s)}function l(n,e,t,a,r,i,s){return o(e&a|t&~a,n,e,r,i,s)}function c(n,e,t,a,r,i,s){return o(e^t^a,n,e,r,i,s)}function u(n,e,t,a,r,i,s){return o(t^(e|~a),n,e,r,i,s)}function d(n,e){n[e>>5]|=128<<e%32,n[14+(e+64>>>9<<4)]=e;var t,a,r,o,d,p=1732584193,h=-271733879,f=-1732584194,m=271733878;for(t=0;t<n.length;t+=16)a=p,r=h,o=f,d=m,p=s(p,h,f,m,n[t],7,-680876936),m=s(m,p,h,f,n[t+1],12,-389564586),f=s(f,m,p,h,n[t+2],17,606105819),h=s(h,f,m,p,n[t+3],22,-1044525330),p=s(p,h,f,m,n[t+4],7,-176418897),m=s(m,p,h,f,n[t+5],12,1200080426),f=s(f,m,p,h,n[t+6],17,-1473231341),h=s(h,f,m,p,n[t+7],22,-45705983),p=s(p,h,f,m,n[t+8],7,1770035416),m=s(m,p,h,f,n[t+9],12,-1958414417),f=s(f,m,p,h,n[t+10],17,-42063),h=s(h,f,m,p,n[t+11],22,-1990404162),p=s(p,h,f,m,n[t+12],7,1804603682),m=s(m,p,h,f,n[t+13],12,-40341101),f=s(f,m,p,h,n[t+14],17,-1502002290),p=l(p,h=s(h,f,m,p,n[t+15],22,1236535329),f,m,n[t+1],5,-165796510),m=l(m,p,h,f,n[t+6],9,-1069501632),f=l(f,m,p,h,n[t+11],14,643717713),h=l(h,f,m,p,n[t],20,-373897302),p=l(p,h,f,m,n[t+5],5,-701558691),m=l(m,p,h,f,n[t+10],9,38016083),f=l(f,m,p,h,n[t+15],14,-660478335),h=l(h,f,m,p,n[t+4],20,-405537848),p=l(p,h,f,m,n[t+9],5,568446438),m=l(m,p,h,f,n[t+14],9,-1019803690),f=l(f,m,p,h,n[t+3],14,-187363961),h=l(h,f,m,p,n[t+8],20,1163531501),p=l(p,h,f,m,n[t+13],5,-1444681467),m=l(m,p,h,f,n[t+2],9,-51403784),f=l(f,m,p,h,n[t+7],14,1735328473),p=c(p,h=l(h,f,m,p,n[t+12],20,-1926607734),f,m,n[t+5],4,-378558),m=c(m,p,h,f,n[t+8],11,-2022574463),f=c(f,m,p,h,n[t+11],16,1839030562),h=c(h,f,m,p,n[t+14],23,-35309556),p=c(p,h,f,m,n[t+1],4,-1530992060),m=c(m,p,h,f,n[t+4],11,1272893353),f=c(f,m,p,h,n[t+7],16,-155497632),h=c(h,f,m,p,n[t+10],23,-1094730640),p=c(p,h,f,m,n[t+13],4,681279174),m=c(m,p,h,f,n[t],11,-358537222),f=c(f,m,p,h,n[t+3],16,-722521979),h=c(h,f,m,p,n[t+6],23,76029189),p=c(p,h,f,m,n[t+9],4,-640364487),m=c(m,p,h,f,n[t+12],11,-421815835),f=c(f,m,p,h,n[t+15],16,530742520),p=u(p,h=c(h,f,m,p,n[t+2],23,-995338651),f,m,n[t],6,-198630844),m=u(m,p,h,f,n[t+7],10,1126891415),f=u(f,m,p,h,n[t+14],15,-1416354905),h=u(h,f,m,p,n[t+5],21,-57434055),p=u(p,h,f,m,n[t+12],6,1700485571),m=u(m,p,h,f,n[t+3],10,-1894986606),f=u(f,m,p,h,n[t+10],15,-1051523),h=u(h,f,m,p,n[t+1],21,-2054922799),p=u(p,h,f,m,n[t+8],6,1873313359),m=u(m,p,h,f,n[t+15],10,-30611744),f=u(f,m,p,h,n[t+6],15,-1560198380),h=u(h,f,m,p,n[t+13],21,1309151649),p=u(p,h,f,m,n[t+4],6,-145523070),m=u(m,p,h,f,n[t+11],10,-1120210379),f=u(f,m,p,h,n[t+2],15,718787259),h=u(h,f,m,p,n[t+9],21,-343485551),p=i(p,a),h=i(h,r),f=i(f,o),m=i(m,d);return[p,h,f,m]}function p(n){var e,t="",a=32*n.length;for(e=0;e<a;e+=8)t+=String.fromCharCode(n[e>>5]>>>e%32&255);return t}function h(n){var e,t=[];for(t[(n.length>>2)-1]=void 0,e=0;e<t.length;e+=1)t[e]=0;var a=8*n.length;for(e=0;e<a;e+=8)t[e>>5]|=(255&n.charCodeAt(e/8))<<e%32;return t}function f(n){var e,t,a="0123456789abcdef",r="";for(t=0;t<n.length;t+=1)e=n.charCodeAt(t),r+=a.charAt(e>>>4&15)+a.charAt(15&e);return r}function m(n){return unescape(encodeURIComponent(n))}function g(n){return function(n){return p(d(h(n),8*n.length))}(m(n))}function v(n,e){return function(n,e){var t,a,r=h(n),i=[],o=[];for(i[15]=o[15]=void 0,r.length>16&&(r=d(r,8*n.length)),t=0;t<16;t+=1)i[t]=909522486^r[t],o[t]=1549556828^r[t];return a=d(i.concat(h(e)),512+8*e.length),p(d(o.concat(a),640))}(m(n),m(e))}function y(n,e,t){return e?t?v(e,n):function(n,e){return f(v(n,e))}(e,n):t?g(n):function(n){return f(g(n))}(n)}void 0!==(a=function(){return y}.call(e,t,e,n))&&(n.exports=a)}()},function(n,e,t){"use strict";var a=t(2),r=t(4),i=t(1),o=t(5),s=t(14),l=t(15),c=l(),u=t(44),d=i("Array.prototype.slice"),p=r.apply(c),h=function(n,e){return o(n),p(n,d(arguments,1))};a(h,{getPolyfill:l,implementation:s,shim:u}),n.exports=h},function(n,e,t){"use strict";var a=t(2),r=t(15);n.exports=function(){var n=r();return a(Array.prototype,{forEach:n},{forEach:function(){return Array.prototype.forEach!==n}}),n}},function(n,e,t){"use strict";e.__esModule=!0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t(47));e.default=function(n){return n=(0,a.default)({url:"",method:"get",body:{}},n),new Promise((function(e,t){if("jsonp"==n.method){var a="cb_"+(Date.now()+Math.round(1e3*Math.random())).toString(32),r=document,o=r.body,s=r.createElement("script");return s.async=!0,s.defer=!0,n.url.indexOf("?")>-1?n.url+="&"+i({callback:a,t:Date.now()}):n.url+="?"+i({callback:a,t:Date.now()}),s.src=n.url,window[a]=function(n){window[a]=null,o.removeChild(s),e(n)},void o.appendChild(s)}var l="XMLHttpRequest"in window?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c=[],u=[],d={};for(var p in i(n.body)&&(n.url=n.url+"?"+("get"==n.method?i(n.body):"")),l.open(n.method||"get",n.url),"blob"==n.dataType&&(l.responseType="blob"),l.onload=function(){l.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(n,e,t){c.push(e=e.toLowerCase()),u.push([e,t]),d[e]=d[e]?d[e]+","+t:t})),e(function n(){return{ok:2==(l.status/100|0),statusText:l.statusText,status:l.status,url:l.responseURL,text:function(){return Promise.resolve(l.responseText)},json:function(){return Promise.resolve(l.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([l.response]))},clone:n,headers:{keys:function(){return c},entries:function(){return u},get:function(n){return d[n.toLowerCase()]},has:function(n){return n.toLowerCase()in d}}}}())},l.onerror=t,l.withCredentials="include"==n.credentials,n.headers)l.setRequestHeader(p,n.headers[p]);l.send("post"==n.method?n.body:"get"==n.method?"":i(n.body))}))};var r=encodeURIComponent,i=function(n){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(r(t)+"="+r(n[t]));return(e=e.join("&").replace(/%20/g,"+"))||""}},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n){var e={},t={Trident:(n=n||navigator.userAgent).indexOf("Trident")>-1||n.indexOf("NET CLR")>-1,Presto:n.indexOf("Presto")>-1,WebKit:n.indexOf("AppleWebKit")>-1,Gecko:n.indexOf("Gecko/")>-1,Safari:n.indexOf("Safari")>-1,Edge:n.indexOf("Edge")>-1||n.indexOf("Edg")>-1,Chrome:n.indexOf("Chrome")>-1||n.indexOf("CriOS")>-1,IE:n.indexOf("MSIE")>-1||n.indexOf("Trident")>-1,Firefox:n.indexOf("Firefox")>-1||n.indexOf("FxiOS")>-1,"Firefox Focus":n.indexOf("Focus")>-1,Chromium:n.indexOf("Chromium")>-1,Opera:n.indexOf("Opera")>-1||n.indexOf("OPR")>-1,Vivaldi:n.indexOf("Vivaldi")>-1,Yandex:n.indexOf("YaBrowser")>-1,Kindle:n.indexOf("Kindle")>-1||n.indexOf("Silk/")>-1,360:n.indexOf("360EE")>-1||n.indexOf("360SE")>-1,UC:n.indexOf("UC")>-1||n.indexOf(" UBrowser")>-1,QQBrowser:n.indexOf("QQBrowser")>-1,QQ:n.indexOf("QQ/")>-1,Baidu:n.indexOf("Baidu")>-1||n.indexOf("BIDUBrowser")>-1,Maxthon:n.indexOf("Maxthon")>-1,Sogou:n.indexOf("MetaSr")>-1||n.indexOf("Sogou")>-1,LBBROWSER:n.indexOf("LBBROWSER")>-1,"2345Explorer":n.indexOf("2345Explorer")>-1,TheWorld:n.indexOf("TheWorld")>-1,XiaoMi:n.indexOf("MiuiBrowser")>-1,Quark:n.indexOf("Quark")>-1,Qiyu:n.indexOf("Qiyu")>-1,Wechat:n.indexOf("MicroMessenger")>-1,Taobao:n.indexOf("AliApp(TB")>-1,Alipay:n.indexOf("AliApp(AP")>-1,Weibo:n.indexOf("Weibo")>-1,Douban:n.indexOf("com.douban.frodo")>-1,Suning:n.indexOf("SNEBUY-APP")>-1,iQiYi:n.indexOf("IqiyiApp")>-1,Windows:n.indexOf("Windows")>-1,Linux:n.indexOf("Linux")>-1||n.indexOf("X11")>-1,macOS:n.indexOf("Macintosh")>-1,Android:n.indexOf("Android")>-1||n.indexOf("Adr")>-1,Ubuntu:n.indexOf("Ubuntu")>-1,FreeBSD:n.indexOf("FreeBSD")>-1,Debian:n.indexOf("Debian")>-1,"Windows Phone":n.indexOf("IEMobile")>-1||n.indexOf("Windows Phone")>-1,BlackBerry:n.indexOf("BlackBerry")>-1||n.indexOf("RIM")>-1||n.indexOf("BB10")>-1,MeeGo:n.indexOf("MeeGo")>-1,Symbian:n.indexOf("Symbian")>-1,iOS:n.indexOf("like Mac OS X")>-1,"Chrome OS":n.indexOf("CrOS")>-1,WebOS:n.indexOf("hpwOS")>-1,Mobile:n.indexOf("Mobi")>-1||n.indexOf("iPh")>-1||n.indexOf("480")>-1,Tablet:n.indexOf("Tablet")>-1||n.indexOf("Pad")>-1||n.indexOf("Nexus 7")>-1};t.Mobile&&(t.Mobile=!(n.indexOf("iPad")>-1));var a={browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Kindle","360","UC","QQBrowser","QQ","Baidu","Maxthon","Sogou","LBBROWSER","2345Explorer","TheWorld","XiaoMi","Quark","Qiyu","Wechat","Taobao","Alipay","Weibo","Douban","Suning","iQiYi"],os:["Windows","Linux","Mac OS","macOS","Android","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"]};for(var r in a)if(a.hasOwnProperty(r))for(var i=0,o=a[r].length;i<o;i++){var s=a[r][i];t[s]&&(e[r]=s)}var l={Windows:function(){return{"10.0":"11",6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[n.replace(/^.*Windows NT ([\d.]+).*$/,"$1")]},Android:n.replace(/^.*Android ([\d.]+);.*$/,"$1"),iOS:n.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,"."),Debian:n.replace(/^.*Debian\/([\d.]+).*$/,"$1"),"Windows Phone":n.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2"),macOS:n.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,"."),WebOS:n.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1"),BlackBerry:n.replace(/^.*BB([\d.]+);*$/,"$1")};e.osVersion="";var c=l[e.os];c&&(e.osVersion="function"==typeof c?c():c==n?"":c);var u={Safari:n.replace(/^.*Version\/([\d.]+).*$/,"$1"),Chrome:n.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1"),IE:n.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1"),Edge:n.replace(/^.*Edge?\/([\d.]+).*$/,"$1"),Firefox:n.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1"),"Firefox Focus":n.replace(/^.*Focus\/([\d.]+).*$/,"$1"),Chromium:n.replace(/^.*Chromium\/([\d.]+).*$/,"$1"),Opera:n.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1"),Vivaldi:n.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1"),Yandex:n.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1"),Kindle:n.replace(/^.*Version\/([\d.]+).*$/,"$1"),Maxthon:n.replace(/^.*Maxthon\/([\d.]+).*$/,"$1"),QQBrowser:n.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1"),QQ:n.replace(/^.*QQ\/([\d.]+).*$/,"$1"),Baidu:n.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1"),UC:n.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1"),Sogou:n.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1"),"2345Explorer":n.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1"),TheWorld:n.replace(/^.*TheWorld ([\d.]+).*$/,"$1"),XiaoMi:n.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1"),Quark:n.replace(/^.*Quark\/([\d.]+).*$/,"$1"),Qiyu:n.replace(/^.*Qiyu\/([\d.]+).*$/,"$1"),Wechat:n.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1"),Taobao:n.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1"),Alipay:n.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1"),Weibo:n.replace(/^.*weibo__([\d.]+).*$/,"$1"),Douban:n.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1"),Suning:n.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1"),iQiYi:n.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")};e.version="";var d=u[e.browser];return d&&(e.version="function"==typeof d?d():d==n?"":d),null==e.browser&&(e.browser="Unknow App"),e}},function(n,e,t){"use strict";e.__esModule=!0,e.default=function(n){n=Object(n);for(var e=1,t=arguments.length;e<t;e++){var a=arguments[e];if(a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n}},function(n,e,t){"use strict";function a(n){return/^\{[\s\S]*\}$/.test(JSON.stringify(n))}function r(n){return"[object Function]"==={}.toString.call(n)}function i(n){return"[object Array]"==={}.toString.call(n)}function o(n){if("string"==typeof n)try{return JSON.parse(n)}catch(e){return n}}function s(){if(!(this instanceof s))return new s}function l(n,e){var t=arguments,o=null;if(u||(u=s()),0===t.length)return u.get();if(1===t.length){if("string"==typeof n)return u.get(n);if(a(n))return u.set(n)}if(2===t.length&&"string"==typeof n){if(!e)return u.remove(n);if(e&&"string"==typeof e)return u.set(n,e);e&&r(e)&&(o=null,o=e(n,u.get(n)),l.set(n,o))}if(2===t.length&&i(n)&&r(e))for(var c=0,d=n.length;c<d;c++)o=e(n[c],u.get(n[c])),l.set(n[c],o);return l}e.__esModule=!0;var c=window.localStorage;c=function(n){var e="_Is_Incognit";try{n.setItem(e,"yes")}catch(e){if(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].indexOf(e.name)>-1){var t=function(){};n.__proto__={setItem:t,getItem:t,removeItem:t,clear:t}}}finally{"yes"===n.getItem(e)&&n.removeItem(e)}return n}(c),s.prototype={set:function(n,e){if(n&&!a(n))c.setItem(n,function(n){return void 0===n||"function"==typeof n?n+"":JSON.stringify(n)}(e));else if(a(n))for(var t in n)this.set(t,n[t]);return this},get:function(n){if(!n){var e={};return this.each((function(n,t){return e[n]=t})),e}if("?"===n.charAt(0))return this.has(n.substr(1));var t=arguments;if(t.length>1){for(var a={},r=0,i=t.length;r<i;r++){var s=o(c.getItem(t[r]));s&&(a[t[r]]=s)}return a}return o(c.getItem(n))},clear:function(){return c.clear(),this},remove:function(n){var e=this.get(n);return c.removeItem(n),e},has:function(n){return{}.hasOwnProperty.call(this.get(),n)},keys:function(){var n=[];return this.each((function(e){n.push(e)})),n},each:function(n){for(var e=0,t=c.length;e<t;e++){var a=c.key(e);n(a,this.get(a))}return this},search:function(n){for(var e=this.keys(),t={},a=0,r=e.length;a<r;a++)e[a].indexOf(n)>-1&&(t[e[a]]=this.get(e[a]));return t}};var u=null;for(var d in s.prototype)l[d]=s.prototype[d];e.default=l},function(n,e,t){var a,r;r=function(n,e,t){function a(e,r,i){return i=Object.create(a.fn),e&&i.push.apply(i,e.addEventListener?[e]:""+e===e?/</.test(e)?((r=n.createElement(r)).innerHTML=e,r.children):r?(r=a(r)[0])?r[t](e):i:n[t](e):e),i}return a.fn=[],a.one=function(n,e){return a(n,e)[0]||null},a}(document,0,"querySelectorAll"),void 0!==(a=function(){return r}.apply(e,[]))&&(n.exports=a)},function(n,e,t){function a(n){return null==n}function r(n){(n=function(n){var e={};for(var t in n)e[t]=n[t];return e}(n||{})).whiteList=n.whiteList||i.whiteList,n.onAttr=n.onAttr||i.onAttr,n.onIgnoreAttr=n.onIgnoreAttr||i.onIgnoreAttr,n.safeAttrValue=n.safeAttrValue||i.safeAttrValue,this.options=n}var i=t(16),o=t(51);t(17),r.prototype.process=function(n){if(!(n=(n=n||"").toString()))return"";var e=this.options,t=e.whiteList,r=e.onAttr,i=e.onIgnoreAttr,s=e.safeAttrValue;return o(n,(function(n,e,o,l,c){var u=t[o],d=!1;if(!0===u?d=u:"function"==typeof u?d=u(l):u instanceof RegExp&&(d=u.test(l)),!0!==d&&(d=!1),l=s(o,l)){var p,h={position:e,sourcePosition:n,source:c,isWhite:d};return d?a(p=r(o,l,h))?o+":"+l:p:a(p=i(o,l,h))?void 0:p}}))},n.exports=r},function(n,e,t){var a=t(17);n.exports=function(n,e){function t(){if(!i){var t=a.trim(n.slice(o,s)),r=t.indexOf(":");if(-1!==r){var c=a.trim(t.slice(0,r)),u=a.trim(t.slice(r+1));if(c){var d=e(o,l.length,c,u,t);d&&(l+=d+"; ")}}}o=s+1}";"!==(n=a.trimRight(n))[n.length-1]&&(n+=";");for(var r=n.length,i=!1,o=0,s=0,l="";s<r;s++){var c=n[s];if("/"===c&&"*"===n[s+1]){var u=n.indexOf("*/",s+2);if(-1===u)break;o=(s=u+1)+1,i=!1}else"("===c?i=!0:")"===c?i=!1:";"===c?i||t():"\n"===c&&t()}return a.trim(l)}},function(n,e,t){"use strict";var a=t(0),r=t(1),i=a("%TypeError%"),o=t(54),s=a("%Reflect.apply%",!0)||r("%Function.prototype.apply%");n.exports=function(n,e){var t=arguments.length>2?arguments[2]:[];if(!o(t))throw new i("Assertion failed: optional `argumentsList`, if provided, must be a List");return s(n,e,t)}},function(n,e,t){"use strict";var a=t(0)("%TypeError%"),r=t(19),i=t(8);n.exports=function(n,e){if("Object"!==i(n))throw new a("Assertion failed: `O` must be an Object");if(!r(e))throw new a("Assertion failed: `P` must be a Property Key");return e in n}},function(n,e,t){"use strict";var a=t(0)("%Array%"),r=!a.isArray&&t(1)("Object.prototype.toString");n.exports=a.isArray||function(n){return"[object Array]"===r(n)}},function(n,e,t){"use strict";n.exports=t(10)},function(n,e,t){"use strict";var a=t(0)("%TypeError%"),r=t(18),i=t(58),o=t(8);n.exports=function(n){if("Object"!==o(n))throw new a("Assertion failed: `obj` must be an Object");return i(r(n,"length"))}},function(n,e,t){"use strict";var a=t(63),r=t(59);n.exports=function(n){var e=r(n);return 0!==e&&(e=a(e)),0===e?0:e}},function(n,e,t){"use strict";var a=t(72),r=t(57);n.exports=function(n){var e=r(n);return e<=0?0:e>a?a:e}},function(n,e,t){"use strict";var a=t(0),r=a("%TypeError%"),i=a("%Number%"),o=a("%RegExp%"),s=a("%parseInt%"),l=t(1),c=t(73),u=t(71),d=l("String.prototype.slice"),p=c(/^0b[01]+$/i),h=c(/^0o[0-7]+$/i),f=c(/^[-+]0x[0-9a-f]+$/i),m=c(new o("["+["","",""].join("")+"]","g")),g=["\t\n\v\f\r ","\u2028","\u2029\ufeff"].join(""),v=new RegExp("(^["+g+"]+)|(["+g+"]+$)","g"),y=l("String.prototype.replace"),b=t(61);n.exports=function n(e){var t=u(e)?e:b(e,i);if("symbol"==typeof t)throw new r("Cannot convert a Symbol value to a number");if("bigint"==typeof t)throw new r("Conversion from 'BigInt' to 'number' is not allowed.");if("string"==typeof t){if(p(t))return n(s(d(t,2),2));if(h(t))return n(s(d(t,2),8));if(m(t)||f(t))return NaN;var a=function(n){return y(n,v,"")}(t);if(a!==t)return n(a)}return i(t)}},function(n,e,t){"use strict";var a=t(0)("%Object%"),r=t(5);n.exports=function(n){return r(n),a(n)}},function(n,e,t){"use strict";var a=t(76);n.exports=function(n){return arguments.length>1?a(n,arguments[1]):a(n)}},function(n,e,t){"use strict";var a=t(0)("%TypeError%");n.exports=function(n,e){if(null==n)throw new a(e||"Cannot call method on "+n);return n}},function(n,e,t){"use strict";var a=t(67),r=t(68),i=t(64),o=t(70),s=t(69),l=t(74);n.exports=function(n){var e=i(n);return o(e)?0:0!==e&&s(e)?l(e)*r(a(e)):e}},function(n,e,t){"use strict";var a=t(65);n.exports=function(n){var e=a(n,Number);if("string"!=typeof e)return+e;var t=e.replace(/^[ \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u0085]+|[ \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u0085]+$/g,"");return/^0[ob]|^[+-]0x/.test(t)?NaN:+t}},function(n,e,t){"use strict";n.exports=t(77)},function(n,e,t){"use strict";n.exports=function(n){return null===n?"Null":void 0===n?"Undefined":"function"==typeof n||"object"==typeof n?"Object":"number"==typeof n?"Number":"boolean"==typeof n?"Boolean":"string"==typeof n?"String":void 0}},function(n,e,t){"use strict";var a=t(0)("%Math.abs%");n.exports=function(n){return a(n)}},function(n,e,t){"use strict";var a=Math.floor;n.exports=function(n){return a(n)}},function(n,e,t){"use strict";var a=Number.isNaN||function(n){return n!=n};n.exports=Number.isFinite||function(n){return"number"==typeof n&&!a(n)&&n!==1/0&&n!==-1/0}},function(n,e,t){"use strict";n.exports=Number.isNaN||function(n){return n!=n}},function(n,e,t){"use strict";n.exports=function(n){return null===n||"function"!=typeof n&&"object"!=typeof n}},function(n,e,t){"use strict";var a=t(0),r=a("%Math%"),i=a("%Number%");n.exports=i.MAX_SAFE_INTEGER||r.pow(2,53)-1},function(n,e,t){"use strict";var a=t(0)("RegExp.prototype.test"),r=t(4);n.exports=function(n){return r(a,n)}},function(n,e,t){"use strict";n.exports=function(n){return n>=0?1:-1}},function(n,e){n.exports=function(n){var e=!0,t=!0,a=!1;if("function"==typeof n){try{n.call("f",(function(n,t,a){"object"!=typeof a&&(e=!1)})),n.call([null],(function(){"use strict";t="string"==typeof this}),"x")}catch(n){a=!0}return!a&&e&&t}return!1}},function(n,e,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,r=t(21),i=t(10),o=t(80),s=t(82),l=function(n,e){if(null==n)throw new TypeError("Cannot call method on "+n);if("string"!=typeof e||"number"!==e&&"string"!==e)throw new TypeError('hint must be "string" or "number"');var t,a,o,s="string"===e?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<s.length;++o)if(t=n[s[o]],i(t)&&(a=t.call(n),r(a)))return a;throw new TypeError("No default value")},c=function(n,e){var t=n[e];if(null!=t){if(!i(t))throw new TypeError(t+" returned for property "+e+" of object "+n+" is not a function");return t}};n.exports=function(n){if(r(n))return n;var e,t="default";if(arguments.length>1&&(arguments[1]===String?t="string":arguments[1]===Number&&(t="number")),a&&(Symbol.toPrimitive?e=c(n,Symbol.toPrimitive):s(n)&&(e=Symbol.prototype.valueOf)),void 0!==e){var i=e.call(n,t);if(r(i))return i;throw new TypeError("unable to convert exotic object to primitive")}return"default"===t&&(o(n)||s(n))&&(t="string"),l(n,"default"===t?"number":t)}},function(n,e,t){"use strict";var a=Object.prototype.toString,r=t(21),i=t(10),o=function(n){var e;if((e=arguments.length>1?arguments[1]:"[object Date]"===a.call(n)?String:Number)===String||e===Number){var t,o,s=e===String?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<s.length;++o)if(i(n[s[o]])&&(t=n[s[o]](),r(t)))return t;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};n.exports=function(n){return r(n)?n:arguments.length>1?o(n,arguments[1]):o(n)}},function(n,e,t){"use strict";var a=Array.prototype.slice,r=Object.prototype.toString;n.exports=function(n){var e=this;if("function"!=typeof e||"[object Function]"!==r.call(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var t,i=a.call(arguments,1),o=function(){if(this instanceof t){var r=e.apply(this,i.concat(a.call(arguments)));return Object(r)===r?r:this}return e.apply(n,i.concat(a.call(arguments)))},s=Math.max(0,e.length-i.length),l=[],c=0;c<s;c++)l.push("$"+c);if(t=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var u=function(){};u.prototype=e.prototype,t.prototype=new u,u.prototype=null}return t}},function(n,e,t){n.exports=function(){"use strict";var n=function(n,e){return function(n){var e=n.exports=function(){return new RegExp("(?:"+e.line().source+")|(?:"+e.block().source+")","gm")};e.line=function(){return/(?:^|\s)\/\/(.+?)$/gm},e.block=function(){return/\/\*([\S\s]*?)\*\//gm}}(e={exports:{}}),e.exports}(),e=["23AC69","91C132","F19726","E8552D","1AAB8E","E1147F","2980C1","1BA1E6","9FA0A0","F19726","E30B20","E30B20","A3338B"];return function(t,a){void 0===a&&(a={});var r=a.colors;void 0===r&&(r=e);var i=0,o={},s=new RegExp("("+/[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af\u0400-\u04FF]+|\w+/.source+"|"+/</.source+")|("+n().source+")","gmi");return t.replace(s,(function(n,e,t){if(t)return function(n){return'<span style="color: slategray">'+n+"</span>"}(t);if("<"===e)return"&lt;";var a;o[e]?a=o[e]:(a=r[i],o[e]=a);var s='<span style="color: #'+a+'">'+e+"</span>";return i=++i%r.length,s}))}}()},function(n,e,t){"use strict";var a=Date.prototype.getDay,r=Object.prototype.toString,i=t(24)();n.exports=function(n){return"object"==typeof n&&null!==n&&(i?function(n){try{return a.call(n),!0}catch(n){return!1}}(n):"[object Date]"===r.call(n))}},function(n,e,t){"use strict";var a=String.prototype.valueOf,r=Object.prototype.toString,i=t(24)();n.exports=function(n){return"string"==typeof n||"object"==typeof n&&(i?function(n){try{return a.call(n),!0}catch(n){return!1}}(n):"[object String]"===r.call(n))}},function(n,e,t){"use strict";var a=Object.prototype.toString;if(t(22)()){var r=Symbol.prototype.toString,i=/^Symbol\(.*\)$/;n.exports=function(n){if("symbol"==typeof n)return!0;if("[object Symbol]"!==a.call(n))return!1;try{return function(n){return"symbol"==typeof n.valueOf()&&i.test(r.call(n))}(n)}catch(n){return!1}}}else n.exports=function(n){return!1}},function(n,e,t){!function(n){"use strict";function e(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}function t(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function a(n,e){if(n){if("string"==typeof n)return r(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(n,e):void 0}}function r(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=n[t];return a}function i(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=a(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var r=0;return function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}function s(e){n.defaults=e}function l(n,e){if(e){if(w.test(n))return n.replace(x,T)}else if(S.test(n))return n.replace(_,T);return n}function c(n){return n.replace(C,(function(n,e){return"colon"===(e=e.toLowerCase())?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""}))}function u(n,e){n=n.source||n,e=e||"";var t={replace:function(e,a){return a=(a=a.source||a).replace(A,"$1"),n=n.replace(e,a),t},getRegex:function(){return new RegExp(n,e)}};return t}function d(n,e,t){if(n){var a;try{a=decodeURIComponent(c(t)).replace(I,"").toLowerCase()}catch(n){return null}if(0===a.indexOf("javascript:")||0===a.indexOf("vbscript:")||0===a.indexOf("data:"))return null}e&&!E.test(t)&&(t=function(n,e){O[" "+n]||(L.test(n)?O[" "+n]=n+"/":O[" "+n]=f(n,"/",!0));var t=-1===(n=O[" "+n]).indexOf(":");return"//"===e.substring(0,2)?t?e:n.replace($,"$1")+e:"/"===e.charAt(0)?t?e:n.replace(P,"$1")+e:n+e}(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch(n){return null}return t}function p(n){for(var e,t,a=1;a<arguments.length;a++)for(t in e=arguments[a])Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n}function h(n,e){var t=n.replace(/\|/g,(function(n,e,t){for(var a=!1,r=e;--r>=0&&"\\"===t[r];)a=!a;return a?"|":" |"})).split(/ \|/),a=0;if(t[0].trim()||t.shift(),t.length>0&&!t[t.length-1].trim()&&t.pop(),t.length>e)t.splice(e);else for(;t.length<e;)t.push("");for(;a<t.length;a++)t[a]=t[a].trim().replace(/\\\|/g,"|");return t}function f(n,e,t){var a=n.length;if(0===a)return"";for(var r=0;r<a;){var i=n.charAt(a-r-1);if(i!==e||t){if(i===e||!t)break;r++}else r++}return n.substr(0,a-r)}function m(n){n&&n.sanitize&&n.silent}function g(n,e){if(e<1)return"";for(var t="";e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n}function v(n,e,t,a){var r=e.href,i=e.title?l(e.title):null,o=n[1].replace(/\\([\[\]])/g,"$1");if("!"!==n[0].charAt(0)){a.state.inLink=!0;var s={type:"link",raw:t,href:r,title:i,text:o,tokens:a.inlineTokens(o,[])};return a.state.inLink=!1,s}return{type:"image",raw:t,href:r,title:i,text:l(o)}}function y(n){return n.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function b(n){var e,t,a="",r=n.length;for(e=0;e<r;e++)t=n.charCodeAt(e),Math.random()>.5&&(t="x"+t.toString(16)),a+="&#"+t+";";return a}function k(n,e,t){if(null==n)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof n)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected");if("function"==typeof e&&(t=e,e=null),m(e=p({},k.defaults,e||{})),t){var a,r=e.highlight;try{a=R.lex(n,e)}catch(n){return t(n)}var i=function(n){var i;if(!n)try{e.walkTokens&&k.walkTokens(a,e.walkTokens),i=U.parse(a,e)}catch(e){n=e}return e.highlight=r,n?t(n):t(null,i)};if(!r||r.length<3)return i();if(delete e.highlight,!a.length)return i();var o=0;return k.walkTokens(a,(function(n){"code"===n.type&&(o++,setTimeout((function(){r(n.text,n.lang,(function(e,t){if(e)return i(e);null!=t&&t!==n.text&&(n.text=t,n.escaped=!0),0==--o&&i()}))}),0))})),void(0===o&&i())}try{var s=R.lex(n,e);return e.walkTokens&&k.walkTokens(s,e.walkTokens),U.parse(s,e)}catch(n){if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e.silent)return"<p>An error occurred:</p><pre>"+l(n.message+"",!0)+"</pre>";throw n}}n.defaults={baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};var w=/[&<>"']/,x=/[&<>"']/g,S=/[<>"']|&(?!#?\w+;)/,_=/[<>"']|&(?!#?\w+;)/g,j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},T=function(n){return j[n]},C=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,A=/(^|[^\[])\^/g,I=/[^\w:]/g,E=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i,O={},L=/^[^:]+:\/*[^/]*$/,$=/^([^:]+:)[\s\S]*$/,P=/^([^:]+:\/*[^/]*)[\s\S]*$/,z={exec:function(){}},D=function(){function e(e){this.options=e||n.defaults}var t=e.prototype;return t.space=function(n){var e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}},t.code=function(n){var e=this.rules.block.code.exec(n);if(e){var t=e[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:f(t,"\n")}}},t.fences=function(n){var e=this.rules.block.fences.exec(n);if(e){var t=e[0],a=function(n,e){var t=n.match(/^(\s+)(?:```)/);if(null===t)return e;var a=t[1];return e.split("\n").map((function(n){var e=n.match(/^\s+/);return null===e?n:e[0].length>=a.length?n.slice(a.length):n})).join("\n")}(t,e[3]||"");return{type:"code",raw:t,lang:e[2]?e[2].trim():e[2],text:a}}},t.heading=function(n){var e=this.rules.block.heading.exec(n);if(e){var t=e[2].trim();if(/#$/.test(t)){var a=f(t,"#");this.options.pedantic?t=a.trim():a&&!/ $/.test(a)||(t=a.trim())}var r={type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:[]};return this.lexer.inline(r.text,r.tokens),r}},t.hr=function(n){var e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:e[0]}},t.blockquote=function(n){var e=this.rules.block.blockquote.exec(n);if(e){var t=e[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:e[0],tokens:this.lexer.blockTokens(t,[]),text:t}}},t.list=function(n){var e=this.rules.block.list.exec(n);if(e){var t,a,r,o,s,l,c,u,d,p,h,f,m=e[1].trim(),g=m.length>1,v={type:"list",raw:"",ordered:g,start:g?+m.slice(0,-1):"",loose:!1,items:[]};m=g?"\\d{1,9}\\"+m.slice(-1):"\\"+m,this.options.pedantic&&(m=g?m:"[*+-]");for(var y=new RegExp("^( {0,3}"+m+")((?: [^\\n]*)?(?:\\n|$))");n&&(f=!1,e=y.exec(n))&&!this.rules.block.hr.test(n);){if(t=e[0],n=n.substring(t.length),u=e[2].split("\n",1)[0],d=n.split("\n",1)[0],this.options.pedantic?(o=2,h=u.trimLeft()):(o=(o=e[2].search(/[^ ]/))>4?1:o,h=u.slice(o),o+=e[1].length),l=!1,!u&&/^ *$/.test(d)&&(t+=d+"\n",n=n.substring(d.length+1),f=!0),!f)for(var b=new RegExp("^ {0,"+Math.min(3,o-1)+"}(?:[*+-]|\\d{1,9}[.)])");n&&(u=p=n.split("\n",1)[0],this.options.pedantic&&(u=u.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!b.test(u));){if(u.search(/[^ ]/)>=o||!u.trim())h+="\n"+u.slice(o);else{if(l)break;h+="\n"+u}l||u.trim()||(l=!0),t+=p+"\n",n=n.substring(p.length+1)}v.loose||(c?v.loose=!0:/\n *\n *$/.test(t)&&(c=!0)),this.options.gfm&&(a=/^\[[ xX]\] /.exec(h))&&(r="[ ] "!==a[0],h=h.replace(/^\[[ xX]\] +/,"")),v.items.push({type:"list_item",raw:t,task:!!a,checked:r,loose:!1,text:h}),v.raw+=t}v.items[v.items.length-1].raw=t.trimRight(),v.items[v.items.length-1].text=h.trimRight(),v.raw=v.raw.trimRight();var k=v.items.length;for(s=0;s<k;s++){this.lexer.state.top=!1,v.items[s].tokens=this.lexer.blockTokens(v.items[s].text,[]);var w=v.items[s].tokens.filter((function(n){return"space"===n.type})),x=w.every((function(n){for(var e,t=0,a=i(n.raw.split(""));!(e=a()).done;)if("\n"===e.value&&(t+=1),t>1)return!0;return!1}));!v.loose&&w.length&&x&&(v.loose=!0,v.items[s].loose=!0)}return v}},t.html=function(n){var e=this.rules.block.html.exec(n);if(e){var t={type:"html",raw:e[0],pre:!this.options.sanitizer&&("pre"===e[1]||"script"===e[1]||"style"===e[1]),text:e[0]};return this.options.sanitize&&(t.type="paragraph",t.text=this.options.sanitizer?this.options.sanitizer(e[0]):l(e[0]),t.tokens=[],this.lexer.inline(t.text,t.tokens)),t}},t.def=function(n){var e=this.rules.block.def.exec(n);if(e)return e[3]&&(e[3]=e[3].substring(1,e[3].length-1)),{type:"def",tag:e[1].toLowerCase().replace(/\s+/g," "),raw:e[0],href:e[2],title:e[3]}},t.table=function(n){var e=this.rules.block.table.exec(n);if(e){var t={type:"table",header:h(e[1]).map((function(n){return{text:n}})),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:e[3]&&e[3].trim()?e[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(t.header.length===t.align.length){t.raw=e[0];var a,r,i,o,s=t.align.length;for(a=0;a<s;a++)/^ *-+: *$/.test(t.align[a])?t.align[a]="right":/^ *:-+: *$/.test(t.align[a])?t.align[a]="center":/^ *:-+ *$/.test(t.align[a])?t.align[a]="left":t.align[a]=null;for(s=t.rows.length,a=0;a<s;a++)t.rows[a]=h(t.rows[a],t.header.length).map((function(n){return{text:n}}));for(s=t.header.length,r=0;r<s;r++)t.header[r].tokens=[],this.lexer.inlineTokens(t.header[r].text,t.header[r].tokens);for(s=t.rows.length,r=0;r<s;r++)for(o=t.rows[r],i=0;i<o.length;i++)o[i].tokens=[],this.lexer.inlineTokens(o[i].text,o[i].tokens);return t}}},t.lheading=function(n){var e=this.rules.block.lheading.exec(n);if(e){var t={type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:[]};return this.lexer.inline(t.text,t.tokens),t}},t.paragraph=function(n){var e=this.rules.block.paragraph.exec(n);if(e){var t={type:"paragraph",raw:e[0],text:"\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1],tokens:[]};return this.lexer.inline(t.text,t.tokens),t}},t.text=function(n){var e=this.rules.block.text.exec(n);if(e){var t={type:"text",raw:e[0],text:e[0],tokens:[]};return this.lexer.inline(t.text,t.tokens),t}},t.escape=function(n){var e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:l(e[1])}},t.tag=function(n){var e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(e[0]):l(e[0]):e[0]}},t.link=function(n){var e=this.rules.inline.link.exec(n);if(e){var t=e[2].trim();if(!this.options.pedantic&&/^</.test(t)){if(!/>$/.test(t))return;var a=f(t.slice(0,-1),"\\");if((t.length-a.length)%2==0)return}else{var r=function(n,e){if(-1===n.indexOf(e[1]))return-1;for(var t=n.length,a=0,r=0;r<t;r++)if("\\"===n[r])r++;else if(n[r]===e[0])a++;else if(n[r]===e[1]&&--a<0)return r;return-1}(e[2],"()");if(r>-1){var i=(0===e[0].indexOf("!")?5:4)+e[1].length+r;e[2]=e[2].substring(0,r),e[0]=e[0].substring(0,i).trim(),e[3]=""}}var o=e[2],s="";if(this.options.pedantic){var l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(o);l&&(o=l[1],s=l[3])}else s=e[3]?e[3].slice(1,-1):"";return o=o.trim(),/^</.test(o)&&(o=this.options.pedantic&&!/>$/.test(t)?o.slice(1):o.slice(1,-1)),v(e,{href:o?o.replace(this.rules.inline._escapes,"$1"):o,title:s?s.replace(this.rules.inline._escapes,"$1"):s},e[0],this.lexer)}},t.reflink=function(n,e){var t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){var a=(t[2]||t[1]).replace(/\s+/g," ");if(!(a=e[a.toLowerCase()])||!a.href){var r=t[0].charAt(0);return{type:"text",raw:r,text:r}}return v(t,a,t[0],this.lexer)}},t.emStrong=function(n,e,t){void 0===t&&(t="");var a=this.rules.inline.emStrong.lDelim.exec(n);if(a&&(!a[3]||!t.match(/(?:[0-9A-Za-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B50-\u1B59\u1B83-\u1BA0\u1BAE-\u1BE5\u1C00-\u1C23\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF-\uA9D9\uA9E0-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD23\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/))){var r=a[1]||a[2]||"";if(!r||r&&(""===t||this.rules.inline.punctuation.exec(t))){var i,o,s=a[0].length-1,l=s,c=0,u="*"===a[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(u.lastIndex=0,e=e.slice(-1*n.length+s);null!=(a=u.exec(e));)if(i=a[1]||a[2]||a[3]||a[4]||a[5]||a[6])if(o=i.length,a[3]||a[4])l+=o;else if(!((a[5]||a[6])&&s%3)||(s+o)%3){if(!((l-=o)>0)){if(o=Math.min(o,o+l+c),Math.min(s,o)%2){var d=n.slice(1,s+a.index+o);return{type:"em",raw:n.slice(0,s+a.index+o+1),text:d,tokens:this.lexer.inlineTokens(d,[])}}var p=n.slice(2,s+a.index+o-1);return{type:"strong",raw:n.slice(0,s+a.index+o+1),text:p,tokens:this.lexer.inlineTokens(p,[])}}}else c+=o}}},t.codespan=function(n){var e=this.rules.inline.code.exec(n);if(e){var t=e[2].replace(/\n/g," "),a=/[^ ]/.test(t),r=/^ /.test(t)&&/ $/.test(t);return a&&r&&(t=t.substring(1,t.length-1)),t=l(t,!0),{type:"codespan",raw:e[0],text:t}}},t.br=function(n){var e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}},t.del=function(n){var e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2],[])}},t.autolink=function(n,e){var t,a,r=this.rules.inline.autolink.exec(n);if(r)return a="@"===r[2]?"mailto:"+(t=l(this.options.mangle?e(r[1]):r[1])):t=l(r[1]),{type:"link",raw:r[0],text:t,href:a,tokens:[{type:"text",raw:t,text:t}]}},t.url=function(n,e){var t;if(t=this.rules.inline.url.exec(n)){var a,r;if("@"===t[2])r="mailto:"+(a=l(this.options.mangle?e(t[0]):t[0]));else{var i;do{i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0]}while(i!==t[0]);a=l(t[0]),r="www."===t[1]?"http://"+a:a}return{type:"link",raw:t[0],text:a,href:r,tokens:[{type:"text",raw:a,text:a}]}}},t.inlineText=function(n,e){var t,a=this.rules.inline.text.exec(n);if(a)return t=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(a[0]):l(a[0]):a[0]:l(this.options.smartypants?e(a[0]):a[0]),{type:"text",raw:a[0],text:t}},e}(),M={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)( [^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:z,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};M.def=u(M.def).replace("label",M._label).replace("title",M._title).getRegex(),M.bullet=/(?:[*+-]|\d{1,9}[.)])/,M.listItemStart=u(/^( *)(bull) */).replace("bull",M.bullet).getRegex(),M.list=u(M.list).replace(/bull/g,M.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+M.def.source+")").getRegex(),M._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",M._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,M.html=u(M.html,"i").replace("comment",M._comment).replace("tag",M._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),M.paragraph=u(M._paragraph).replace("hr",M.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",M._tag).getRegex(),M.blockquote=u(M.blockquote).replace("paragraph",M.paragraph).getRegex(),M.normal=p({},M),M.gfm=p({},M.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),M.gfm.table=u(M.gfm.table).replace("hr",M.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",M._tag).getRegex(),M.gfm.paragraph=u(M._paragraph).replace("hr",M.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",M.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",M._tag).getRegex(),M.pedantic=p({},M.normal,{html:u("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",M._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:z,paragraph:u(M.normal._paragraph).replace("hr",M.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",M.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var F={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:z,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:z,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/,_punctuation:"!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~"};F.punctuation=u(F.punctuation).replace(/punctuation/g,F._punctuation).getRegex(),F.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,F.escapedEmSt=/\\\*|\\_/g,F._comment=u(M._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),F.emStrong.lDelim=u(F.emStrong.lDelim).replace(/punct/g,F._punctuation).getRegex(),F.emStrong.rDelimAst=u(F.emStrong.rDelimAst,"g").replace(/punct/g,F._punctuation).getRegex(),F.emStrong.rDelimUnd=u(F.emStrong.rDelimUnd,"g").replace(/punct/g,F._punctuation).getRegex(),F._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,F._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,F._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,F.autolink=u(F.autolink).replace("scheme",F._scheme).replace("email",F._email).getRegex(),F._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,F.tag=u(F.tag).replace("comment",F._comment).replace("attribute",F._attribute).getRegex(),F._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,F._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,F._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,F.link=u(F.link).replace("label",F._label).replace("href",F._href).replace("title",F._title).getRegex(),F.reflink=u(F.reflink).replace("label",F._label).replace("ref",M._label).getRegex(),F.nolink=u(F.nolink).replace("ref",M._label).getRegex(),F.reflinkSearch=u(F.reflinkSearch,"g").replace("reflink",F.reflink).replace("nolink",F.nolink).getRegex(),F.normal=p({},F),F.pedantic=p({},F.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:u(/^!?\[(label)\]\((.*?)\)/).replace("label",F._label).getRegex(),reflink:u(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",F._label).getRegex()}),F.gfm=p({},F.normal,{escape:u(F.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),F.gfm.url=u(F.gfm.url,"i").replace("email",F.gfm._extended_email).getRegex(),F.breaks=p({},F.gfm,{br:u(F.br).replace("{2,}","*").getRegex(),text:u(F.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var R=function(){function e(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||n.defaults,this.options.tokenizer=this.options.tokenizer||new D,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};var t={block:M.normal,inline:F.normal};this.options.pedantic?(t.block=M.pedantic,t.inline=F.pedantic):this.options.gfm&&(t.block=M.gfm,this.options.breaks?t.inline=F.breaks:t.inline=F.gfm),this.tokenizer.rules=t}e.lex=function(n,t){return new e(t).lex(n)},e.lexInline=function(n,t){return new e(t).inlineTokens(n)};var a=e.prototype;return a.lex=function(n){n=n.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),this.blockTokens(n,this.tokens);for(var e;e=this.inlineQueue.shift();)this.inlineTokens(e.src,e.tokens);return this.tokens},a.blockTokens=function(n,e){var t,a,r,i,o=this;for(void 0===e&&(e=[]),this.options.pedantic&&(n=n.replace(/^ +$/gm,""));n;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((function(a){return!!(t=a.call({lexer:o},n,e))&&(n=n.substring(t.raw.length),e.push(t),!0)}))))if(t=this.tokenizer.space(n))n=n.substring(t.raw.length),1===t.raw.length&&e.length>0?e[e.length-1].raw+="\n":e.push(t);else if(t=this.tokenizer.code(n))n=n.substring(t.raw.length),!(a=e[e.length-1])||"paragraph"!==a.type&&"text"!==a.type?e.push(t):(a.raw+="\n"+t.raw,a.text+="\n"+t.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text);else if(t=this.tokenizer.fences(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.heading(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.hr(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.blockquote(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.list(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.html(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.def(n))n=n.substring(t.raw.length),!(a=e[e.length-1])||"paragraph"!==a.type&&"text"!==a.type?this.tokens.links[t.tag]||(this.tokens.links[t.tag]={href:t.href,title:t.title}):(a.raw+="\n"+t.raw,a.text+="\n"+t.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text);else if(t=this.tokenizer.table(n))n=n.substring(t.raw.length),e.push(t);else if(t=this.tokenizer.lheading(n))n=n.substring(t.raw.length),e.push(t);else if(r=n,this.options.extensions&&this.options.extensions.startBlock&&function(){var e=1/0,t=n.slice(1),a=void 0;o.options.extensions.startBlock.forEach((function(n){"number"==typeof(a=n.call({lexer:this},t))&&a>=0&&(e=Math.min(e,a))})),e<1/0&&e>=0&&(r=n.substring(0,e+1))}(),this.state.top&&(t=this.tokenizer.paragraph(r)))a=e[e.length-1],i&&"paragraph"===a.type?(a.raw+="\n"+t.raw,a.text+="\n"+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):e.push(t),i=r.length!==n.length,n=n.substring(t.raw.length);else if(t=this.tokenizer.text(n))n=n.substring(t.raw.length),(a=e[e.length-1])&&"text"===a.type?(a.raw+="\n"+t.raw,a.text+="\n"+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):e.push(t);else if(n){var s="Infinite loop on byte: "+n.charCodeAt(0);if(this.options.silent)break;throw new Error(s)}return this.state.top=!0,e},a.inline=function(n,e){this.inlineQueue.push({src:n,tokens:e})},a.inlineTokens=function(n,e){var t=this;void 0===e&&(e=[]);var a,r,i,o,s,l,c=n;if(this.tokens.links){var u=Object.keys(this.tokens.links);if(u.length>0)for(;null!=(o=this.tokenizer.rules.inline.reflinkSearch.exec(c));)u.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(c=c.slice(0,o.index)+"["+g("a",o[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(o=this.tokenizer.rules.inline.blockSkip.exec(c));)c=c.slice(0,o.index)+"["+g("a",o[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(o=this.tokenizer.rules.inline.escapedEmSt.exec(c));)c=c.slice(0,o.index)+"++"+c.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;n;)if(s||(l=""),s=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((function(r){return!!(a=r.call({lexer:t},n,e))&&(n=n.substring(a.raw.length),e.push(a),!0)}))))if(a=this.tokenizer.escape(n))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.tag(n))n=n.substring(a.raw.length),(r=e[e.length-1])&&"text"===a.type&&"text"===r.type?(r.raw+=a.raw,r.text+=a.text):e.push(a);else if(a=this.tokenizer.link(n))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.reflink(n,this.tokens.links))n=n.substring(a.raw.length),(r=e[e.length-1])&&"text"===a.type&&"text"===r.type?(r.raw+=a.raw,r.text+=a.text):e.push(a);else if(a=this.tokenizer.emStrong(n,c,l))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.codespan(n))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.br(n))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.del(n))n=n.substring(a.raw.length),e.push(a);else if(a=this.tokenizer.autolink(n,b))n=n.substring(a.raw.length),e.push(a);else if(this.state.inLink||!(a=this.tokenizer.url(n,b))){if(i=n,this.options.extensions&&this.options.extensions.startInline&&function(){var e=1/0,a=n.slice(1),r=void 0;t.options.extensions.startInline.forEach((function(n){"number"==typeof(r=n.call({lexer:this},a))&&r>=0&&(e=Math.min(e,r))})),e<1/0&&e>=0&&(i=n.substring(0,e+1))}(),a=this.tokenizer.inlineText(i,y))n=n.substring(a.raw.length),"_"!==a.raw.slice(-1)&&(l=a.raw.slice(-1)),s=!0,(r=e[e.length-1])&&"text"===r.type?(r.raw+=a.raw,r.text+=a.text):e.push(a);else if(n){var d="Infinite loop on byte: "+n.charCodeAt(0);if(this.options.silent)break;throw new Error(d)}}else n=n.substring(a.raw.length),e.push(a);return e},t(e,null,[{key:"rules",get:function(){return{block:M,inline:F}}}]),e}(),q=function(){function e(e){this.options=e||n.defaults}var t=e.prototype;return t.code=function(n,e,t){var a=(e||"").match(/\S*/)[0];if(this.options.highlight){var r=this.options.highlight(n,a);null!=r&&r!==n&&(t=!0,n=r)}return n=n.replace(/\n$/,"")+"\n",a?'<pre><code class="'+this.options.langPrefix+l(a,!0)+'">'+(t?n:l(n,!0))+"</code></pre>\n":"<pre><code>"+(t?n:l(n,!0))+"</code></pre>\n"},t.blockquote=function(n){return"<blockquote>\n"+n+"</blockquote>\n"},t.html=function(n){return n},t.heading=function(n,e,t,a){return this.options.headerIds?"<h"+e+' id="'+this.options.headerPrefix+a.slug(t)+'">'+n+"</h"+e+">\n":"<h"+e+">"+n+"</h"+e+">\n"},t.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},t.list=function(n,e,t){var a=e?"ol":"ul";return"<"+a+(e&&1!==t?' start="'+t+'"':"")+">\n"+n+"</"+a+">\n"},t.listitem=function(n){return"<li>"+n+"</li>\n"},t.checkbox=function(n){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},t.paragraph=function(n){return"<p>"+n+"</p>\n"},t.table=function(n,e){return e&&(e="<tbody>"+e+"</tbody>"),"<table>\n<thead>\n"+n+"</thead>\n"+e+"</table>\n"},t.tablerow=function(n){return"<tr>\n"+n+"</tr>\n"},t.tablecell=function(n,e){var t=e.header?"th":"td";return(e.align?"<"+t+' align="'+e.align+'">':"<"+t+">")+n+"</"+t+">\n"},t.strong=function(n){return"<strong>"+n+"</strong>"},t.em=function(n){return"<em>"+n+"</em>"},t.codespan=function(n){return"<code>"+n+"</code>"},t.br=function(){return this.options.xhtml?"<br/>":"<br>"},t.del=function(n){return"<del>"+n+"</del>"},t.link=function(n,e,t){if(null===(n=d(this.options.sanitize,this.options.baseUrl,n)))return t;var a='<a href="'+l(n)+'"';return e&&(a+=' title="'+e+'"'),a+">"+t+"</a>"},t.image=function(n,e,t){if(null===(n=d(this.options.sanitize,this.options.baseUrl,n)))return t;var a='<img src="'+n+'" alt="'+t+'"';return e&&(a+=' title="'+e+'"'),a+(this.options.xhtml?"/>":">")},t.text=function(n){return n},e}(),N=function(){function n(){}var e=n.prototype;return e.strong=function(n){return n},e.em=function(n){return n},e.codespan=function(n){return n},e.del=function(n){return n},e.html=function(n){return n},e.text=function(n){return n},e.link=function(n,e,t){return""+t},e.image=function(n,e,t){return""+t},e.br=function(){return""},n}(),B=function(){function n(){this.seen={}}var e=n.prototype;return e.serialize=function(n){return n.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")},e.getNextSafeSlug=function(n,e){var t=n,a=0;if(this.seen.hasOwnProperty(t)){a=this.seen[n];do{t=n+"-"+ ++a}while(this.seen.hasOwnProperty(t))}return e||(this.seen[n]=a,this.seen[t]=0),t},e.slug=function(n,e){void 0===e&&(e={});var t=this.serialize(n);return this.getNextSafeSlug(t,e.dryrun)},n}(),U=function(){function e(e){this.options=e||n.defaults,this.options.renderer=this.options.renderer||new q,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new N,this.slugger=new B}e.parse=function(n,t){return new e(t).parse(n)},e.parseInline=function(n,t){return new e(t).parseInline(n)};var t=e.prototype;return t.parse=function(n,e){void 0===e&&(e=!0);var t,a,r,i,o,s,l,u,d,p,h,f,m,g,v,y,b,k,w,x="",S=n.length;for(t=0;t<S;t++)if(p=n[t],!(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[p.type])||!1===(w=this.options.extensions.renderers[p.type].call({parser:this},p))&&["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(p.type))switch(p.type){case"space":continue;case"hr":x+=this.renderer.hr();continue;case"heading":x+=this.renderer.heading(this.parseInline(p.tokens),p.depth,c(this.parseInline(p.tokens,this.textRenderer)),this.slugger);continue;case"code":x+=this.renderer.code(p.text,p.lang,p.escaped);continue;case"table":for(u="",l="",i=p.header.length,a=0;a<i;a++)l+=this.renderer.tablecell(this.parseInline(p.header[a].tokens),{header:!0,align:p.align[a]});for(u+=this.renderer.tablerow(l),d="",i=p.rows.length,a=0;a<i;a++){for(l="",o=(s=p.rows[a]).length,r=0;r<o;r++)l+=this.renderer.tablecell(this.parseInline(s[r].tokens),{header:!1,align:p.align[r]});d+=this.renderer.tablerow(l)}x+=this.renderer.table(u,d);continue;case"blockquote":d=this.parse(p.tokens),x+=this.renderer.blockquote(d);continue;case"list":for(h=p.ordered,f=p.start,m=p.loose,i=p.items.length,d="",a=0;a<i;a++)y=(v=p.items[a]).checked,b=v.task,g="",v.task&&(k=this.renderer.checkbox(y),m?v.tokens.length>0&&"paragraph"===v.tokens[0].type?(v.tokens[0].text=k+" "+v.tokens[0].text,v.tokens[0].tokens&&v.tokens[0].tokens.length>0&&"text"===v.tokens[0].tokens[0].type&&(v.tokens[0].tokens[0].text=k+" "+v.tokens[0].tokens[0].text)):v.tokens.unshift({type:"text",text:k}):g+=k),g+=this.parse(v.tokens,m),d+=this.renderer.listitem(g,b,y);x+=this.renderer.list(d,h,f);continue;case"html":x+=this.renderer.html(p.text);continue;case"paragraph":x+=this.renderer.paragraph(this.parseInline(p.tokens));continue;case"text":for(d=p.tokens?this.parseInline(p.tokens):p.text;t+1<S&&"text"===n[t+1].type;)d+="\n"+((p=n[++t]).tokens?this.parseInline(p.tokens):p.text);x+=e?this.renderer.paragraph(d):d;continue;default:var _='Token with "'+p.type+'" type was not found.';if(this.options.silent)return;throw new Error(_)}else x+=w||"";return x},t.parseInline=function(n,e){e=e||this.renderer;var t,a,r,i="",o=n.length;for(t=0;t<o;t++)if(a=n[t],!(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[a.type])||!1===(r=this.options.extensions.renderers[a.type].call({parser:this},a))&&["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type))switch(a.type){case"escape":i+=e.text(a.text);break;case"html":i+=e.html(a.text);break;case"link":i+=e.link(a.href,a.title,this.parseInline(a.tokens,e));break;case"image":i+=e.image(a.href,a.title,a.text);break;case"strong":i+=e.strong(this.parseInline(a.tokens,e));break;case"em":i+=e.em(this.parseInline(a.tokens,e));break;case"codespan":i+=e.codespan(a.text);break;case"br":i+=e.br();break;case"del":i+=e.del(this.parseInline(a.tokens,e));break;case"text":i+=e.text(a.text);break;default:var s='Token with "'+a.type+'" type was not found.';if(this.options.silent)return;throw new Error(s)}else i+=r||"";return i},e}();k.options=k.setOptions=function(n){return p(k.defaults,n),s(k.defaults),k},k.getDefaults=o,k.defaults=n.defaults,k.use=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var a,r=p.apply(void 0,[{}].concat(e)),i=k.defaults.extensions||{renderers:{},childTokens:{}};e.forEach((function(n){if(n.extensions&&(a=!0,n.extensions.forEach((function(n){if(!n.name)throw new Error("extension name required");if(n.renderer){var e=i.renderers?i.renderers[n.name]:null;i.renderers[n.name]=e?function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var i=n.renderer.apply(this,a);return!1===i&&(i=e.apply(this,a)),i}:n.renderer}if(n.tokenizer){if(!n.level||"block"!==n.level&&"inline"!==n.level)throw new Error("extension level must be 'block' or 'inline'");i[n.level]?i[n.level].unshift(n.tokenizer):i[n.level]=[n.tokenizer],n.start&&("block"===n.level?i.startBlock?i.startBlock.push(n.start):i.startBlock=[n.start]:"inline"===n.level&&(i.startInline?i.startInline.push(n.start):i.startInline=[n.start]))}n.childTokens&&(i.childTokens[n.name]=n.childTokens)}))),n.renderer&&function(){var e=k.defaults.renderer||new q;for(var t in n.renderer)!function(t){var a=e[t];e[t]=function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=n.renderer[t].apply(e,i);return!1===s&&(s=a.apply(e,i)),s}}(t);r.renderer=e}(),n.tokenizer&&function(){var e=k.defaults.tokenizer||new D;for(var t in n.tokenizer)!function(t){var a=e[t];e[t]=function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=n.tokenizer[t].apply(e,i);return!1===s&&(s=a.apply(e,i)),s}}(t);r.tokenizer=e}(),n.walkTokens){var e=k.defaults.walkTokens;r.walkTokens=function(t){n.walkTokens.call(this,t),e&&e.call(this,t)}}a&&(r.extensions=i),k.setOptions(r)}))},k.walkTokens=function(n,e){for(var t,a=i(n);!(t=a()).done;)!function(){var n=t.value;switch(e.call(k,n),n.type){case"table":for(var a,r=i(n.header);!(a=r()).done;){var o=a.value;k.walkTokens(o.tokens,e)}for(var s,l=i(n.rows);!(s=l()).done;)for(var c,u=i(s.value);!(c=u()).done;){var d=c.value;k.walkTokens(d.tokens,e)}break;case"list":k.walkTokens(n.items,e);break;default:k.defaults.extensions&&k.defaults.extensions.childTokens&&k.defaults.extensions.childTokens[n.type]?k.defaults.extensions.childTokens[n.type].forEach((function(t){k.walkTokens(n[t],e)})):n.tokens&&k.walkTokens(n.tokens,e)}}()},k.parseInline=function(n,e){if(null==n)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof n)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected");m(e=p({},k.defaults,e||{}));try{var t=R.lexInline(n,e);return e.walkTokens&&k.walkTokens(t,e.walkTokens),U.parseInline(t,e)}catch(n){if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e.silent)return"<p>An error occurred:</p><pre>"+l(n.message+"",!0)+"</pre>";throw n}},k.Parser=U,k.parser=U.parse,k.Renderer=q,k.TextRenderer=N,k.Lexer=R,k.lexer=R.lex,k.Tokenizer=D,k.Slugger=B,k.parse=k;var J=k.options,V=k.setOptions,W=k.use,H=k.walkTokens,Q=k.parseInline,G=k,K=U.parse,Y=R.lex;n.Lexer=R,n.Parser=U,n.Renderer=q,n.Slugger=B,n.TextRenderer=N,n.Tokenizer=D,n.getDefaults=o,n.lexer=Y,n.marked=k,n.options=J,n.parse=G,n.parseInline=Q,n.parser=K,n.setOptions=V,n.use=W,n.walkTokens=H,Object.defineProperty(n,"__esModule",{value:!0})}(e)},function(n,e,t){"use strict";function a(n,e){var t=function(n){var e={};return s(l(n),(function(n){var t=n[0],a=n[1];s(a,(function(n){e[n]=t}))})),e}(n.pluralTypeToLanguages);return t[e]||t[f.call(e,/-/,1)[0]]||t.en}function r(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(n,e,t,a,r){if("string"!=typeof n)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return n;var i=n,o=a||b,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&n){var l=r||v,c=f.call(n,m),p=function(n,e,t){return n.pluralTypes[e](t)}(l,y(l,t||"en"),s.smart_count);i=d(c[p]||c[0])}return h.call(i,o,(function(n,e){return u(s,e)&&null!=s[e]?s[e]:n}))}function o(n){var e=n||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var t=e.allowMissing?i:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:t,this.warn=e.warn||p,this.tokenRegex=function(n){var e=n&&n.prefix||"%{",t=n&&n.suffix||"}";if(e===m||t===m)throw new RangeError('"'+m+'" token is reserved for pluralization');return new RegExp(r(e)+"(.*?)"+r(t),"g")}(e.interpolation),this.pluralRules=e.pluralRules||v}var s=t(43),l=t(89),c=t(94),u=t(25),d=t(92),p=function(n){c(!1,n)},h=String.prototype.replace,f=String.prototype.split,m="||||",g=function(n){var e=n%100,t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},v={pluralTypes:{arabic:function(n){if(n<3)return n;var e=n%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:g,chinese:function(){return 0},croatian:g,french:function(n){return n>=2?1:0},german:function(n){return 1!==n?1:0},russian:g,lithuanian:function(n){return n%10==1&&n%100!=11?0:n%10>=2&&n%10<=9&&(n%100<11||n%100>19)?1:2},czech:function(n){return 1===n?0:n>=2&&n<=4?1:2},polish:function(n){if(1===n)return 0;var e=n%10;return 2<=e&&e<=4&&(n%100<10||n%100>=20)?1:2},icelandic:function(n){return n%10!=1||n%100==11?1:0},slovenian:function(n){var e=n%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}},y=function(){var n={};return function(e,t){var r=n[t];return r&&!e.pluralTypes[r]&&(r=null,n[t]=r),r||(r=a(e,t))&&(n[t]=r),r}}(),b=/%\{(.*?)\}/g;o.prototype.locale=function(n){return n&&(this.currentLocale=n),this.currentLocale},o.prototype.extend=function(n,e){s(l(n||{}),(function(n){var t=n[0],a=n[1],r=e?e+"."+t:t;"object"==typeof a?this.extend(a,r):this.phrases[r]=a}),this)},o.prototype.unset=function(n,e){"string"==typeof n?delete this.phrases[n]:s(l(n||{}),(function(n){var t=n[0],a=n[1],r=e?e+"."+t:t;"object"==typeof a?this.unset(a,r):delete this.phrases[r]}),this)},o.prototype.clear=function(){this.phrases={}},o.prototype.replace=function(n){this.clear(),this.extend(n)},o.prototype.t=function(n,e){var t,a,r=null==e?{}:e;return"string"==typeof this.phrases[n]?t=this.phrases[n]:"string"==typeof r._?t=r._:this.onMissingKey?a=(0,this.onMissingKey)(n,r,this.currentLocale,this.tokenRegex,this.pluralRules):(this.warn('Missing translation for key: "'+n+'"'),a=n),"string"==typeof t&&(a=i(t,r,this.currentLocale,this.tokenRegex,this.pluralRules)),a},o.prototype.has=function(n){return u(this.phrases,n)},o.transformPhrase=function(n,e,t){return i(n,e,t)},n.exports=o},function(n,e,t){"use strict";function a(n){if(null==n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;n.exports=function(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de","5"===Object.getOwnPropertyNames(n)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(n){return e[n]})).join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach((function(n){a[n]=n})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch(n){return!1}}()?Object.assign:function(n,e){for(var t,s,l=a(n),c=1;c<arguments.length;c++){for(var u in t=Object(arguments[c]))i.call(t,u)&&(l[u]=t[u]);if(r){s=r(t);for(var d=0;d<s.length;d++)o.call(t,s[d])&&(l[s[d]]=t[s[d]])}}return l}},function(n,e,t){function a(n,e){if(n===1/0||n===-1/0||n!=n||n&&n>-1e3&&n<1e3||N.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof n){var a=n<0?-V(-n):V(n);if(a!==n){var r=String(a),i=M.call(e,r.length+1);return F.call(r,t,"$&_")+"."+F.call(F.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return F.call(e,t,"$&_")}function r(n,e,t){var a="double"===(t.quoteStyle||e)?'"':"'";return a+n+a}function i(n){return F.call(String(n),/"/g,"&quot;")}function o(n){return!("[object Array]"!==c(n)||K&&"object"==typeof n&&K in n)}function s(n){if(G)return n&&"object"==typeof n&&n instanceof Symbol;if("symbol"==typeof n)return!0;if(!n||"object"!=typeof n||!Q)return!1;try{return Q.call(n),!0}catch(n){}return!1}function l(n,e){return en.call(n,e)}function c(n){return P.call(n)}function u(n){if(n.name)return n.name;var e=D.call(z.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function d(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,a=n.length;t<a;t++)if(n[t]===e)return t;return-1}function p(n){if(!E||!n||"object"!=typeof n)return!1;try{E.call(n,E);try{O.call(n,O)}catch(n){return!0}return n instanceof WeakMap}catch(n){}return!1}function h(n){if(!L||!n||"object"!=typeof n)return!1;try{return L.call(n),!0}catch(n){}return!1}function f(n){if(!O||!n||"object"!=typeof n)return!1;try{O.call(n,O);try{E.call(n,E)}catch(n){return!0}return n instanceof WeakSet}catch(n){}return!1}function m(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,a="... "+t+" more character"+(t>1?"s":"");return m(M.call(n,0,e.maxStringLength),e)+a}return r(F.call(F.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,g),"single",e)}function g(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+R.call(e.toString(16))}function v(n){return"Object("+n+")"}function y(n){return n+" { ? }"}function b(n,e,t,a){return n+" ("+e+") {"+(a?k(t,a):U.call(t,", "))+"}"}function k(n,e){if(0===n.length)return"";var t="\n"+e.prev+e.base;return t+U.call(n,","+t)+"\n"+e.prev}function w(n,e){var t=o(n),a=[];if(t){a.length=n.length;for(var r=0;r<n.length;r++)a[r]=l(n,r)?e(n[r],n):""}var i,s="function"==typeof H?H(n):[];if(G){i={};for(var c=0;c<s.length;c++)i["$"+s[c]]=s[c]}for(var u in n)l(n,u)&&(t&&String(Number(u))===u&&u<n.length||G&&i["$"+u]instanceof Symbol||(N.call(/[^\w$]/,u)?a.push(e(u,n)+": "+e(n[u],n)):a.push(u+": "+e(n[u],n))));if("function"==typeof H)for(var d=0;d<s.length;d++)Y.call(n,s[d])&&a.push("["+e(s[d])+"]: "+e(n[s[d]],n));return a}var x="function"==typeof Map&&Map.prototype,S=Object.getOwnPropertyDescriptor&&x?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,_=x&&S&&"function"==typeof S.get?S.get:null,j=x&&Map.prototype.forEach,T="function"==typeof Set&&Set.prototype,C=Object.getOwnPropertyDescriptor&&T?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,A=T&&C&&"function"==typeof C.get?C.get:null,I=T&&Set.prototype.forEach,E="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,O="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,L="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,$=Boolean.prototype.valueOf,P=Object.prototype.toString,z=Function.prototype.toString,D=String.prototype.match,M=String.prototype.slice,F=String.prototype.replace,R=String.prototype.toUpperCase,q=String.prototype.toLowerCase,N=RegExp.prototype.test,B=Array.prototype.concat,U=Array.prototype.join,J=Array.prototype.slice,V=Math.floor,W="function"==typeof BigInt?BigInt.prototype.valueOf:null,H=Object.getOwnPropertySymbols,Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,G="function"==typeof Symbol&&"object"==typeof Symbol.iterator,K="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,Y=Object.prototype.propertyIsEnumerable,X=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null),Z=t(102).custom,nn=Z&&s(Z)?Z:null;n.exports=function n(e,t,g,x){function S(e,t,a){if(t&&(x=J.call(x)).push(t),a){var r={depth:T.depth};return l(T,"quoteStyle")&&(r.quoteStyle=T.quoteStyle),n(e,r,g+1,x)}return n(e,T,g+1,x)}var T=t||{};if(l(T,"quoteStyle")&&"single"!==T.quoteStyle&&"double"!==T.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(l(T,"maxStringLength")&&("number"==typeof T.maxStringLength?T.maxStringLength<0&&T.maxStringLength!==1/0:null!==T.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var C=!l(T,"customInspect")||T.customInspect;if("boolean"!=typeof C&&"symbol"!==C)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(l(T,"indent")&&null!==T.indent&&"\t"!==T.indent&&!(parseInt(T.indent,10)===T.indent&&T.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(l(T,"numericSeparator")&&"boolean"!=typeof T.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var E=T.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return m(e,T);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var O=String(e);return E?a(e,O):O}if("bigint"==typeof e){var L=String(e)+"n";return E?a(e,L):L}var P=void 0===T.depth?5:T.depth;if(void 0===g&&(g=0),g>=P&&P>0&&"object"==typeof e)return o(e)?"[Array]":"[Object]";var z=function(n,e){var t;if("\t"===n.indent)t="\t";else{if(!("number"==typeof n.indent&&n.indent>0))return null;t=U.call(Array(n.indent+1)," ")}return{base:t,prev:U.call(Array(e+1),t)}}(T,g);if(void 0===x)x=[];else if(d(x,e)>=0)return"[Circular]";if("function"==typeof e){var D=u(e),R=w(e,S);return"[Function"+(D?": "+D:" (anonymous)")+"]"+(R.length>0?" { "+U.call(R,", ")+" }":"")}if(s(e)){var N=G?F.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Q.call(e);return"object"!=typeof e||G?N:v(N)}if(function(n){return!(!n||"object"!=typeof n)&&("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||"string"==typeof n.nodeName&&"function"==typeof n.getAttribute)}(e)){for(var V="<"+q.call(String(e.nodeName)),H=e.attributes||[],Z=0;Z<H.length;Z++)V+=" "+H[Z].name+"="+r(i(H[Z].value),"double",T);return V+=">",e.childNodes&&e.childNodes.length&&(V+="..."),V+"</"+q.call(String(e.nodeName))+">"}if(o(e)){if(0===e.length)return"[]";var en=w(e,S);return z&&!function(n){for(var e=0;e<n.length;e++)if(d(n[e],"\n")>=0)return!1;return!0}(en)?"["+k(en,z)+"]":"[ "+U.call(en,", ")+" ]"}if(function(n){return!("[object Error]"!==c(n)||K&&"object"==typeof n&&K in n)}(e)){var tn=w(e,S);return"cause"in e&&!Y.call(e,"cause")?"{ ["+String(e)+"] "+U.call(B.call("[cause]: "+S(e.cause),tn),", ")+" }":0===tn.length?"["+String(e)+"]":"{ ["+String(e)+"] "+U.call(tn,", ")+" }"}if("object"==typeof e&&C){if(nn&&"function"==typeof e[nn])return e[nn]();if("symbol"!==C&&"function"==typeof e.inspect)return e.inspect()}if(function(n){if(!_||!n||"object"!=typeof n)return!1;try{_.call(n);try{A.call(n)}catch(n){return!0}return n instanceof Map}catch(n){}return!1}(e)){var an=[];return j.call(e,(function(n,t){an.push(S(t,e,!0)+" => "+S(n,e))})),b("Map",_.call(e),an,z)}if(function(n){if(!A||!n||"object"!=typeof n)return!1;try{A.call(n);try{_.call(n)}catch(n){return!0}return n instanceof Set}catch(n){}return!1}(e)){var rn=[];return I.call(e,(function(n){rn.push(S(n,e))})),b("Set",A.call(e),rn,z)}if(p(e))return y("WeakMap");if(f(e))return y("WeakSet");if(h(e))return y("WeakRef");if(function(n){return!("[object Number]"!==c(n)||K&&"object"==typeof n&&K in n)}(e))return v(S(Number(e)));if(function(n){if(!n||"object"!=typeof n||!W)return!1;try{return W.call(n),!0}catch(n){}return!1}(e))return v(S(W.call(e)));if(function(n){return!("[object Boolean]"!==c(n)||K&&"object"==typeof n&&K in n)}(e))return v($.call(e));if(function(n){return!("[object String]"!==c(n)||K&&"object"==typeof n&&K in n)}(e))return v(S(String(e)));if(!function(n){return!("[object Date]"!==c(n)||K&&"object"==typeof n&&K in n)}(e)&&!function(n){return!("[object RegExp]"!==c(n)||K&&"object"==typeof n&&K in n)}(e)){var on=w(e,S),sn=X?X(e)===Object.prototype:e instanceof Object||e.constructor===Object,ln=e instanceof Object?"":"null prototype",cn=!sn&&K&&Object(e)===e&&K in e?M.call(c(e),8,-1):ln?"Object":"",un=(sn||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(cn||ln?"["+U.call(B.call([],cn||[],ln||[]),": ")+"] ":"");return 0===on.length?un+"{}":z?un+"{"+k(on,z)+"}":un+"{ "+U.call(on,", ")+" }"}return String(e)};var en=Object.prototype.hasOwnProperty||function(n){return n in this}},function(n,e,t){"use strict";var a;if(!Object.keys){var r=Object.prototype.hasOwnProperty,i=Object.prototype.toString,o=t(26),s=Object.prototype.propertyIsEnumerable,l=!s.call({toString:null},"toString"),c=s.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(n){var e=n.constructor;return e&&e.prototype===n},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if("undefined"==typeof window)return!1;for(var n in window)try{if(!p["$"+n]&&r.call(window,n)&&null!==window[n]&&"object"==typeof window[n])try{d(window[n])}catch(n){return!0}}catch(n){return!0}return!1}(),f=function(n){if("undefined"==typeof window||!h)return d(n);try{return d(n)}catch(n){return!1}};a=function(n){var e=null!==n&&"object"==typeof n,t="[object Function]"===i.call(n),a=o(n),s=e&&"[object String]"===i.call(n),d=[];if(!e&&!t&&!a)throw new TypeError("Object.keys called on a non-object");var p=c&&t;if(s&&n.length>0&&!r.call(n,0))for(var h=0;h<n.length;++h)d.push(String(h));if(a&&n.length>0)for(var m=0;m<n.length;++m)d.push(String(m));else for(var g in n)p&&"prototype"===g||!r.call(n,g)||d.push(String(g));if(l)for(var v=f(n),y=0;y<u.length;++y)v&&"constructor"===u[y]||!r.call(n,u[y])||d.push(u[y]);return d}}n.exports=a},function(n,e,t){"use strict";var a=Array.prototype.slice,r=t(26),i=Object.keys,o=i?function(n){return i(n)}:t(87),s=Object.keys;o.shim=function(){return Object.keys?function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2)||(Object.keys=function(n){return s(r(n)?a.call(n):n)}):Object.keys=o,Object.keys||o},n.exports=o},function(n,e,t){"use strict";var a=t(2),r=t(4),i=t(27),o=t(28),s=t(90),l=r(o(),Object);a(l,{getPolyfill:o,implementation:i,shim:s}),n.exports=l},function(n,e,t){"use strict";var a=t(28),r=t(2);n.exports=function(){var n=a();return r(Object,{entries:n},{entries:function(){return Object.entries!==n}}),n}},function(n,e){function t(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(n){if(c===setTimeout)return setTimeout(n,0);if((c===t||!c)&&setTimeout)return c=setTimeout,setTimeout(n,0);try{return c(n,0)}catch(e){try{return c.call(null,n,0)}catch(e){return c.call(this,n,0)}}}function i(){f&&p&&(f=!1,p.length?h=p.concat(h):m=-1,h.length&&o())}function o(){if(!f){var n=r(i);f=!0;for(var e=h.length;e;){for(p=h,h=[];++m<e;)p&&p[m].run();m=-1,e=h.length}p=null,f=!1,function(n){if(u===clearTimeout)return clearTimeout(n);if((u===a||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(n);try{u(n)}catch(e){try{return u.call(null,n)}catch(e){return u.call(this,n)}}}(n)}}function s(n,e){this.fun=n,this.array=e}function l(){}var c,u,d=n.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:t}catch(n){c=t}try{u="function"==typeof clearTimeout?clearTimeout:a}catch(n){u=a}}();var p,h=[],f=!1,m=-1;d.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];h.push(new s(n,e)),1!==h.length||f||r(o)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(n){return[]},d.binding=function(n){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(n){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(n,e,t){"use strict";var a=t(4),r=t(2),i=t(29),o=t(30),s=t(93),l=a(o());r(l,{getPolyfill:o,implementation:i,shim:s}),n.exports=l},function(n,e,t){"use strict";var a=t(2),r=t(30);n.exports=function(){var n=r();return a(String.prototype,{trim:n},{trim:function(){return String.prototype.trim!==n}}),n}},function(n,e,t){"use strict";(function(e){var t=function(){};if("production"!==e.env.NODE_ENV){var a=function(n,e){var t=arguments.length;e=new Array(t>1?t-1:0);for(var a=1;a<t;a++)e[a-1]=arguments[a];var r=0,i="Warning: "+n.replace(/%s/g,(function(){return e[r++]}));try{throw new Error(i)}catch(n){}};t=function(n,e,t){var r=arguments.length;t=new Array(r>2?r-2:0);for(var i=2;i<r;i++)t[i-2]=arguments[i];if(void 0===e)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");n||a.apply(null,[e].concat(t))}}n.exports=t}).call(e,t(91))},function(n,e,t){function a(n,e){return new o(e).process(n)}var r=t(31),i=t(32),o=t(96);for(var s in(e=n.exports=a).filterXSS=a,e.FilterXSS=o,r)e[s]=r[s];for(var s in i)e[s]=i[s];"undefined"!=typeof window&&(window.filterXSS=n.exports),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=n.exports)},function(n,e,t){function a(n){return null==n}function r(n){(n=function(n){var e={};for(var t in n)e[t]=n[t];return e}(n||{})).stripIgnoreTag&&(n.onIgnoreTag,n.onIgnoreTag=o.onIgnoreTagStripAll),n.whiteList=n.whiteList||n.allowList||o.whiteList,n.onTag=n.onTag||o.onTag,n.onTagAttr=n.onTagAttr||o.onTagAttr,n.onIgnoreTag=n.onIgnoreTag||o.onIgnoreTag,n.onIgnoreTagAttr=n.onIgnoreTagAttr||o.onIgnoreTagAttr,n.safeAttrValue=n.safeAttrValue||o.safeAttrValue,n.escapeHtml=n.escapeHtml||o.escapeHtml,this.options=n,!1===n.css?this.cssFilter=!1:(n.css=n.css||{},this.cssFilter=new i(n.css))}var i=t(7).FilterCSS,o=t(31),s=t(32),l=s.parseTag,c=s.parseAttr,u=t(11);r.prototype.process=function(n){if(!(n=(n=n||"").toString()))return"";var e=this.options,t=e.whiteList,r=e.onTag,i=e.onIgnoreTag,s=e.onTagAttr,d=e.onIgnoreTagAttr,p=e.safeAttrValue,h=e.escapeHtml,f=this.cssFilter;e.stripBlankChar&&(n=o.stripBlankChar(n)),e.allowCommentTag||(n=o.stripCommentTag(n));var m=!1;e.stripIgnoreTagBody&&(m=o.StripTagBody(e.stripIgnoreTagBody,i),i=m.onIgnoreTag);var g=l(n,(function(n,e,o,l,m){var g,v={sourcePosition:n,position:e,isClosing:m,isWhite:t.hasOwnProperty(o)};if(!a(g=r(o,l,v)))return g;if(v.isWhite){if(v.isClosing)return"</"+o+">";var y=function(n){var e=u.spaceIndex(n);if(-1===e)return{html:"",closing:"/"===n[n.length-2]};var t="/"===(n=u.trim(n.slice(e+1,-1)))[n.length-1];return t&&(n=u.trim(n.slice(0,-1))),{html:n,closing:t}}(l),b=t[o],k=c(y.html,(function(n,e){var t,r=-1!==u.indexOf(b,n);return a(t=s(o,n,e,r))?r?(e=p(o,n,e,f))?n+'="'+e+'"':n:a(t=d(o,n,e,r))?void 0:t:t}));return l="<"+o,k&&(l+=" "+k),y.closing&&(l+=" /"),l+">"}return a(g=i(o,l,v))?h(l):g}),h);return m&&(g=m.remove(g)),g},n.exports=r},function(n,e){n.exports={smile:"e3/2018new_weixioa02_org.png",lovely:"09/2018new_keai_org.png",happy:"1e/2018new_taikaixin_org.png",clap:"6e/2018new_guzhang_thumb.png",whee:"33/2018new_xixi_thumb.png",haha:"8f/2018new_haha_thumb.png","laugh and cry":"4a/2018new_xiaoku_thumb.png",wink:"43/2018new_jiyan_org.png",greddy:"fa/2018new_chanzui_org.png",awkward:"a3/2018new_heixian_thumb.png",sweat:"28/2018new_han_org.png","pick nose":"9a/2018new_wabi_thumb.png",hum:"7c/2018new_heng_thumb.png",angry:"f6/2018new_nu_thumb.png",grievance:"a5/2018new_weiqu_thumb.png",poor:"96/2018new_kelian_org.png",disappoint:"aa/2018new_shiwang_thumb.png",sad:"ee/2018new_beishang_org.png",tear:"6e/2018new_leimu_org.png","no way":"83/2018new_kuxiao_org.png",shy:"c1/2018new_haixiu_org.png",dirt:"10/2018new_wu_thumb.png","love you":"f6/2018new_aini_org.png",kiss:"2c/2018new_qinqin_thumb.png",amorousness:"9d/2018new_huaxin_org.png",longing:"c9/2018new_chongjing_org.png",desire:"3e/2018new_tianping_thumb.png","bad laugh":"4d/2018new_huaixiao_org.png",blackness:"9e/2018new_yinxian_org.png","laugh without word":"2d/2018new_xiaoerbuyu_org.png",titter:"71/2018new_touxiao_org.png",cool:"c4/2018new_ku_org.png","not easy":"aa/2018new_bingbujiandan_thumb.png",think:"30/2018new_sikao_org.png",question:"b8/2018new_ningwen_org.png","no idea":"2a/2018new_wenhao_thumb.png",dizzy:"07/2018new_yun_thumb.png",bomb:"a2/2018new_shuai_thumb.png",bone:"a1/2018new_kulou_thumb.png","be quiet":"b0/2018new_xu_org.png","shut up":"62/2018new_bizui_org.png",stupid:"dd/2018new_shayan_org.png","surprise ":"49/2018new_chijing_org.png",vomit:"08/2018new_tu_org.png",cold:"40/2018new_kouzhao_thumb.png",sick:"3b/2018new_shengbing_thumb.png",bye:"fd/2018new_baibai_thumb.png","look down on":"da/2018new_bishi_org.png","white eye":"ef/2018new_landelini_org.png","left hum":"43/2018new_zuohengheng_thumb.png","right hum":"c1/2018new_youhengheng_thumb.png",crazy:"17/2018new_zhuakuang_org.png","scold ":"87/2018new_zhouma_thumb.png","hit on face":"cb/2018new_dalian_org.png",wow:"ae/2018new_ding_org.png",fan:"86/2018new_hufen02_org.png",money:"a2/2018new_qian_thumb.png",yawn:"55/2018new_dahaqian_org.png",sleepy:"3c/2018new_kun_thumb.png",sleep:"e2/2018new_shuijiao_thumb.png","watermelon ":"01/2018new_chigua_thumb.png",doge:"a1/2018new_doge02_org.png",dog:"22/2018new_erha_org.png",cat:"7b/2018new_miaomiao_thumb.png",thumb:"e6/2018new_zan_org.png",good:"8a/2018new_good_org.png",ok:"45/2018new_ok_org.png",yeah:"29/2018new_ye_thumb.png","shack hand":"e9/2018new_woshou_thumb.png",bow:"e7/2018new_zuoyi_org.png",come:"42/2018new_guolai_thumb.png",punch:"86/2018new_quantou_thumb.png"}},function(n,e){n.exports={nick:"NickName",mail:"E-Mail",link:"Website(http://)",nickFail:"NickName cannot be less than 3 bytes.",mailFail:"Please confirm your email address.",sofa:"No comment yet.",submit:"Submit",reply:"Reply",cancelReply:"Cancel reply",comments:"Comments",cancel:"Cancel",confirm:"Confirm",continue:"Continue",more:"Load More...",preview:"Preview",emoji:"Emoji",expand:"See more....",seconds:"seconds ago",minutes:"minutes ago",hours:"hours ago",days:"days ago",now:"just now",uploading:"Uploading ...",uploadDone:"Upload completed!",busy:"Submit is busy, please wait...","code-98":"Valine initialization failed, please check your version of av-min.js.","code-99":"Valine initialization failed, Please check the `el` element in the init method.","code-100":"Valine initialization failed, Please check your appId and appKey.","code-140":"The total number of API calls today has exceeded the development version limit.","code-401":"Unauthorized operation, Please check your appId and appKey.","code-403":"Access denied by API domain white list, Please check your security domain."}},function(n,e){n.exports={nick:"",mail:"",link:"(http://)",nickFail:"3.",mailFail:".",sofa:"~",submit:"",reply:"",cancelReply:"",comments:"",cancel:"",confirm:"",continue:"",more:"...",preview:"",emoji:"",expand:"",seconds:"",minutes:"",hours:"",days:"",now:"",uploading:"...",uploadDone:"!",busy:"20     ...","code-98":"av-min.js .","code-99":"init`el`.","code-100":"AppIdAppKey.","code-140":"API.","code-401":"AppIdAppKey.","code-403":"API"}},function(n,e){n.exports={nick:"",mail:"",link:"(http://)",nickFail:"3",mailFail:"",sofa:"~",submit:"",reply:"",cancelReply:"",comments:"",cancel:"",confirm:"",continue:"",more:"...",preview:"",emoji:"",expand:"...",seconds:"",minutes:"",hours:"",days:"",now:"",uploading:"...",uploadDone:"!",busy:"...","code-98":"Valine  av-min.js ","code-99":"Valine init`el`.","code-100":"Valine AppIdAppKey.","code-140":" API .","code-401":"AppIdAppKey.","code-403":"API."}},function(n,e){n.exports={nick:"",mail:"",link:"(http://)",nickFail:"3",mailFail:"",sofa:"~",submit:"",reply:"",cancelReply:"",comments:"",cancel:"",confirm:"",continue:"",more:"...",preview:"",emoji:"",expand:"...",seconds:"",minutes:"",hours:"",days:"",now:"",uploading:"...",uploadDone:"!",busy:"...","code-98":"Valine  av-min.js ","code-99":"Valine init`el`.","code-100":"Valine AppIdAppKey.","code-140":" API .","code-401":"AppIdAppKey.","code-403":"API."}},function(n,e){},function(n,e,t){var a=t(104);"string"==typeof a&&(a=[[n.i,a,""]]);var r={transform:void 0};t(106)(a,r),a.locals&&(n.exports=a.locals)},function(n,e,t){(e=t(105)(!1)).push([n.i,'.v[data-class=v]{font-size:16px;text-align:left}.v[data-class=v] *{-webkit-box-sizing:border-box;box-sizing:border-box;line-height:1.75}.v[data-class=v] .vinput,.v[data-class=v] .veditor,.v[data-class=v] p,.v[data-class=v] pre code,.v[data-class=v] .status-bar{color:#555}.v[data-class=v] .vtime,.v[data-class=v] .vsys{color:#b3b3b3}.v[data-class=v] .text-right{text-align:right}.v[data-class=v] .text-center{text-align:center}.v[data-class=v] img{max-width:100%;border:none}.v[data-class=v] hr{margin:.825em 0;border-color:#f6f6f6;border-style:dashed}.v[data-class=v].hide-avatar .vimg{display:none}.v[data-class=v] a{position:relative;cursor:pointer;color:#1abc9c;text-decoration:none;display:inline-block}.v[data-class=v] a:hover{color:#d7191a}.v[data-class=v] pre,.v[data-class=v] code{background-color:#f8f8f8;padding:.2em .4em;border-radius:3px;font-size:85%;margin:0}.v[data-class=v] pre{padding:10px;overflow:auto;line-height:1.45}.v[data-class=v] pre code{padding:0;background:transparent;white-space:pre-wrap;word-break:keep-all}.v[data-class=v] blockquote{color:#666;margin:.5em 0;padding:0 0 0 1em;border-left:8px solid rgba(238,238,238,.5)}.v[data-class=v] .vinput{border:none;resize:none;outline:none;padding:10px 5px;max-width:100%;font-size:.775em;-webkit-box-sizing:border-box;box-sizing:border-box}.v[data-class=v] input[type=checkbox],.v[data-class=v] input[type=radio]{display:inline-block;vertical-align:middle;margin-top:-2px}.v[data-class=v] .vicon{cursor:pointer;display:inline-block;overflow:hidden;fill:#555;vertical-align:middle}.v[data-class=v] .vicon+.vicon{margin-left:10px}.v[data-class=v] .vicon.actived{fill:#66b1ff}.v[data-class=v] .vrow{font-size:0;padding:10px 0}.v[data-class=v] .vrow .vcol{display:inline-block;vertical-align:middle;font-size:14px}.v[data-class=v] .vrow .vcol.vcol-20{width:20%}.v[data-class=v] .vrow .vcol.vcol-30{width:30%}.v[data-class=v] .vrow .vcol.vcol-40{width:40%}.v[data-class=v] .vrow .vcol.vcol-50{width:50%}.v[data-class=v] .vrow .vcol.vcol-60{width:60%}.v[data-class=v] .vrow .vcol.vcol-70{width:70%}.v[data-class=v] .vrow .vcol.vcol-80{width:80%}.v[data-class=v] .vrow .vcol.vctrl{font-size:12px}.v[data-class=v] .vemoji,.v[data-class=v] .emoji{width:26px;height:26px;overflow:hidden;vertical-align:middle;margin:0 1px;display:inline-block}.v[data-class=v] .vwrap{border:1px solid #f0f0f0;border-radius:4px;margin-bottom:10px;overflow:hidden;position:relative;padding:10px}.v[data-class=v] .vwrap input{background:transparent}.v[data-class=v] .vwrap .vedit{position:relative;padding-top:10px}.v[data-class=v] .vwrap .cancel-reply-btn{position:absolute;right:5px;top:5px;cursor:pointer}.v[data-class=v] .vwrap .vemojis{display:none;font-size:18px;max-height:145px;overflow:auto;padding-bottom:10px;-webkit-box-shadow:0px 0 1px #f0f0f0;box-shadow:0px 0 1px #f0f0f0}.v[data-class=v] .vwrap .vemojis i{font-style:normal;padding-top:7px;width:36px;cursor:pointer;text-align:center;display:inline-block;vertical-align:middle}.v[data-class=v] .vwrap .vpreview{padding:7px;-webkit-box-shadow:0px 0 1px #f0f0f0;box-shadow:0px 0 1px #f0f0f0}.v[data-class=v] .vwrap .vheader .vinput{width:33.33%;border-bottom:1px #dedede dashed}.v[data-class=v] .vwrap .vheader.item2 .vinput{width:50%}.v[data-class=v] .vwrap .vheader.item1 .vinput{width:100%}.v[data-class=v] .vwrap .vheader .vinput:focus{border-bottom-color:#eb5055}@media screen and (max-width: 520px){.v[data-class=v] .vwrap .vheader .vinput{width:100%}.v[data-class=v] .vwrap .vheader.item2 .vinput{width:100%}}.v[data-class=v] .vpower{color:#999;font-size:.75em;padding:.5em 0}.v[data-class=v] .vpower a{font-size:.75em}.v[data-class=v] .vcount{padding:5px;font-weight:600;font-size:1.25em}.v[data-class=v] ul,.v[data-class=v] ol{padding:0;margin-left:1.25em}.v[data-class=v] .txt-center{text-align:center}.v[data-class=v] .txt-right{text-align:right}.v[data-class=v] .veditor{width:100%;min-height:8.75em;font-size:.875em;background:transparent;resize:vertical;-webkit-transition:all .25s ease;transition:all .25s ease}.v[data-class=v] .vbtn{-webkit-transition-duration:.4s;transition-duration:.4s;text-align:center;color:#555;border:1px solid #ededed;border-radius:.3em;display:inline-block;background:transparent;margin-bottom:0;font-weight:400;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;white-space:nowrap;padding:.5em 1.25em;font-size:.875em;line-height:1.42857143;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline:none}.v[data-class=v] .vbtn+.vbtn{margin-left:1.25em}.v[data-class=v] .vbtn:active,.v[data-class=v] .vbtn:hover{color:#3090e4;border-color:#3090e4}.v[data-class=v] .vbtn:disabled{border-color:#e1e1e1;color:#e1e1e1;background-color:#fdfafa;cursor:not-allowed}.v[data-class=v] .vempty{padding:1.25em;text-align:center;color:#555;overflow:auto}.v[data-class=v] .vsys{display:inline-block;padding:.2em .5em;font-size:.75em;border-radius:.2em;margin-right:.3em}@media screen and (max-width: 520px){.v[data-class=v] .vsys{display:none}}.v[data-class=v] .vcards{width:100%}.v[data-class=v] .vcards .vcard{padding-top:1.25em;position:relative;display:block}.v[data-class=v] .vcards .vcard:after{content:"";clear:both;display:block}.v[data-class=v] .vcards .vcard .vimg{width:3.125em;height:3.125em;float:left;border-radius:50%;margin-right:.7525em;border:1px solid #f5f5f5;padding:.125em}@media screen and (max-width: 720px){.v[data-class=v] .vcards .vcard .vimg{width:2.5em;height:2.5em}}.v[data-class=v] .vcards .vcard .vhead{line-height:1.5;margin-top:0}.v[data-class=v] .vcards .vcard .vhead .vnick{position:relative;font-size:.875em;font-weight:500;margin-right:.875em;cursor:pointer;text-decoration:none;display:inline-block}.v[data-class=v] .vcards .vcard .vhead .vnick:hover{color:#d7191a}.v[data-class=v] .vcards .vcard .vh{overflow:hidden;padding-bottom:.5em;border-bottom:1px dashed #f5f5f5}.v[data-class=v] .vcards .vcard .vh .vtime{font-size:.75em;margin-right:.875em}.v[data-class=v] .vcards .vcard .vh .vmeta{line-height:1;position:relative}.v[data-class=v] .vcards .vcard .vh .vmeta .vat{font-size:.8125em;color:#ef2f11;cursor:pointer;float:right}.v[data-class=v] .vcards .vcard:last-child .vh{border-bottom:none}.v[data-class=v] .vcards .vcard .vcontent{word-wrap:break-word;word-break:break-all;font-size:.875em;line-height:2;position:relative;margin-bottom:.75em;padding-top:.625em}.v[data-class=v] .vcards .vcard .vcontent.expand{cursor:pointer;max-height:8em;overflow:hidden}.v[data-class=v] .vcards .vcard .vcontent.expand::before{display:block;content:"";position:absolute;width:100%;left:0;top:0;bottom:3.15em;background:-webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(rgba(255, 255, 255, 0.9)));background:linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.9));z-index:999}.v[data-class=v] .vcards .vcard .vcontent.expand::after{display:block;content:attr(data-expand);text-align:center;color:#828586;position:absolute;width:100%;height:3.15em;line-height:3.15em;left:0;bottom:0;z-index:999;background:rgba(255,255,255,.9)}.v[data-class=v] .vcards .vcard .vquote{padding-left:1em;border-left:1px dashed rgba(238,238,238,.5)}.v[data-class=v] .vcards .vcard .vquote .vimg{width:2.225em;height:2.225em}.v[data-class=v] .vpage .vmore{margin:1em 0}.v[data-class=v] .clear{content:"";display:block;clear:both}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes pulse{50%{background:#dcdcdc}}@keyframes pulse{50%{background:#dcdcdc}}.v[data-class=v] .vspinner{width:22px;height:22px;display:inline-block;border:6px double #a0a0a0;border-top-color:transparent;border-bottom-color:transparent;border-radius:50%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear;position:relative;vertical-align:middle;margin:0 5px}[data-theme=dark] .v[data-class=v] .vinput,[data-theme=dark] .v[data-class=v] .veditor,[data-theme=dark] .v[data-class=v] p,[data-theme=dark] .v[data-class=v] pre code,[data-theme=dark] .v[data-class=v] .status-bar,.dark .v[data-class=v] .vinput,.dark .v[data-class=v] .veditor,.dark .v[data-class=v] p,.dark .v[data-class=v] pre code,.dark .v[data-class=v] .status-bar,.theme__dark .v[data-class=v] .vinput,.theme__dark .v[data-class=v] .veditor,.theme__dark .v[data-class=v] p,.theme__dark .v[data-class=v] pre code,.theme__dark .v[data-class=v] .status-bar,.night .v[data-class=v] .vinput,.night .v[data-class=v] .veditor,.night .v[data-class=v] p,.night .v[data-class=v] pre code,.night .v[data-class=v] .status-bar{color:#b2b2b5}[data-theme=dark] .v[data-class=v] .vtime,[data-theme=dark] .v[data-class=v] .vsys,.dark .v[data-class=v] .vtime,.dark .v[data-class=v] .vsys,.theme__dark .v[data-class=v] .vtime,.theme__dark .v[data-class=v] .vsys,.night .v[data-class=v] .vtime,.night .v[data-class=v] .vsys{color:#929298}[data-theme=dark] .v[data-class=v] pre,[data-theme=dark] .v[data-class=v] code,[data-theme=dark] .v[data-class=v] pre code,.dark .v[data-class=v] pre,.dark .v[data-class=v] code,.dark .v[data-class=v] pre code,.theme__dark .v[data-class=v] pre,.theme__dark .v[data-class=v] code,.theme__dark .v[data-class=v] pre code,.night .v[data-class=v] pre,.night .v[data-class=v] code,.night .v[data-class=v] pre code{color:#929298;background-color:#151414}[data-theme=dark] .v[data-class=v] .vwrap,.dark .v[data-class=v] .vwrap,.theme__dark .v[data-class=v] .vwrap,.night .v[data-class=v] .vwrap{border-color:#b2b2b5}[data-theme=dark] .v[data-class=v] .vicon,.dark .v[data-class=v] .vicon,.theme__dark .v[data-class=v] .vicon,.night .v[data-class=v] .vicon{fill:#b2b2b5}[data-theme=dark] .v[data-class=v] .vicon.actived,.dark .v[data-class=v] .vicon.actived,.theme__dark .v[data-class=v] .vicon.actived,.night .v[data-class=v] .vicon.actived{fill:#66b1ff}[data-theme=dark] .v[data-class=v] .vbtn,.dark .v[data-class=v] .vbtn,.theme__dark .v[data-class=v] .vbtn,.night .v[data-class=v] .vbtn{color:#b2b2b5;border-color:#b2b2b5}[data-theme=dark] .v[data-class=v] .vbtn:hover,.dark .v[data-class=v] .vbtn:hover,.theme__dark .v[data-class=v] .vbtn:hover,.night .v[data-class=v] .vbtn:hover{color:#66b1ff;border-color:#66b1ff}[data-theme=dark] .v[data-class=v] a:hover,.dark .v[data-class=v] a:hover,.theme__dark .v[data-class=v] a:hover,.night .v[data-class=v] a:hover{color:#d7191a}[data-theme=dark] .v[data-class=v] .vcards .vcard .vcontent.expand::before,.dark .v[data-class=v] .vcards .vcard .vcontent.expand::before,.theme__dark .v[data-class=v] .vcards .vcard .vcontent.expand::before,.night .v[data-class=v] .vcards .vcard .vcontent.expand::before{background:-webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.3)), to(rgba(0, 0, 0, 0.7)));background:linear-gradient(180deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7))}[data-theme=dark] .v[data-class=v] .vcards .vcard .vcontent.expand::after,.dark .v[data-class=v] .vcards .vcard .vcontent.expand::after,.theme__dark .v[data-class=v] .vcards .vcard .vcontent.expand::after,.night .v[data-class=v] .vcards .vcard .vcontent.expand::after{background:rgba(0,0,0,.7)}@media(prefers-color-scheme: dark){.v[data-class=v] .vinput,.v[data-class=v] .veditor,.v[data-class=v] p,.v[data-class=v] pre code,.v[data-class=v] .status-bar{color:#b2b2b5}.v[data-class=v] .vtime,.v[data-class=v] .vsys{color:#929298}.v[data-class=v] pre,.v[data-class=v] code,.v[data-class=v] pre code{color:#929298;background-color:#151414}.v[data-class=v] .vwrap{border-color:#b2b2b5}.v[data-class=v] .vicon{fill:#b2b2b5}.v[data-class=v] .vicon.actived{fill:#66b1ff}.v[data-class=v] .vbtn{color:#b2b2b5;border-color:#b2b2b5}.v[data-class=v] .vbtn:hover{color:#66b1ff;border-color:#66b1ff}.v[data-class=v] a:hover{color:#d7191a}.v[data-class=v] .vcards .vcard .vcontent.expand::before{background:-webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.3)), to(rgba(0, 0, 0, 0.7)));background:linear-gradient(180deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7))}.v[data-class=v] .vcards .vcard .vcontent.expand::after{background:rgba(0,0,0,.7)}}',""]),n.exports=e},function(n,e,t){"use strict";function a(n,e){var t=n[1]||"",a=n[3];if(!a)return t;if(e&&"function"==typeof btoa){var r=function(n){return"/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n)))))," */")}(a);return[t].concat(a.sources.map((function(n){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(n," */")}))).concat([r]).join("\n")}return[t].join("\n")}n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t=a(e,n);return e[2]?"@media ".concat(e[2]," {").concat(t,"}"):t})).join("")},e.i=function(n,t,a){"string"==typeof n&&(n=[[null,n,""]]);var r={};if(a)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var s=0;s<n.length;s++){var l=[].concat(n[s]);a&&r[l[0]]||(t&&(l[2]?l[2]="".concat(t," and ").concat(l[2]):l[2]=t),e.push(l))}},e}},function(n,e,t){function a(n,e){for(var t=0;t<n.length;t++){var a=n[t],r=f[a.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](a.parts[i]);for(;i<a.parts.length;i++)r.parts.push(u(a.parts[i],e))}else{var o=[];for(i=0;i<a.parts.length;i++)o.push(u(a.parts[i],e));f[a.id]={id:a.id,refs:1,parts:o}}}}function r(n,e){for(var t=[],a={},r=0;r<n.length;r++){var i=n[r],o=e.base?i[0]+e.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};a[o]?a[o].parts.push(s):t.push(a[o]={id:o,parts:[s]})}return t}function i(n,e){var t=g(n.insertInto);if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var a=b[b.length-1];if("top"===n.insertAt)a?a.nextSibling?t.insertBefore(e,a.nextSibling):t.appendChild(e):t.insertBefore(e,t.firstChild),b.push(e);else{if("bottom"!==n.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");t.appendChild(e)}}function o(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n);var e=b.indexOf(n);e>=0&&b.splice(e,1)}function s(n){var e=document.createElement("style");return n.attrs.type="text/css",c(e,n.attrs),i(n,e),e}function l(n){var e=document.createElement("link");return n.attrs.type="text/css",n.attrs.rel="stylesheet",c(e,n.attrs),i(n,e),e}function c(n,e){Object.keys(e).forEach((function(t){n.setAttribute(t,e[t])}))}function u(n,e){var t,a,r,i;if(e.transform&&n.css){if(!(i=e.transform(n.css)))return function(){};n.css=i}if(e.singleton){var c=y++;t=v||(v=s(e)),a=d.bind(null,t,c,!1),r=d.bind(null,t,c,!0)}else n.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(t=l(e),a=h.bind(null,t,e),r=function(){o(t),t.href&&URL.revokeObjectURL(t.href)}):(t=s(e),a=p.bind(null,t),r=function(){o(t)});return a(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap)return;a(n=e)}else r()}}function d(n,e,t,a){var r=t?"":a.css;if(n.styleSheet)n.styleSheet.cssText=w(e,r);else{var i=document.createTextNode(r),o=n.childNodes;o[e]&&n.removeChild(o[e]),o.length?n.insertBefore(i,o[e]):n.appendChild(i)}}function p(n,e){var t=e.css,a=e.media;if(a&&n.setAttribute("media",a),n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}function h(n,e,t){var a=t.css,r=t.sourceMap,i=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||i)&&(a=k(a)),r&&(a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([a],{type:"text/css"}),s=n.href;n.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}var f={},m=function(n){var e;return function(){return void 0===e&&(e=n.apply(this,arguments)),e}}((function(){return window&&document&&document.all&&!window.atob})),g=function(n){var e={};return function(t){return void 0===e[t]&&(e[t]=n.call(this,t)),e[t]}}((function(n){return document.querySelector(n)})),v=null,y=0,b=[],k=t(107);n.exports=function(n,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||(e.singleton=m()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var t=r(n,e);return a(t,e),function(n){for(var i=[],o=0;o<t.length;o++){var s=t[o];(l=f[s.id]).refs--,i.push(l)}for(n&&a(r(n,e),e),o=0;o<i.length;o++){var l;if(0===(l=i[o]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete f[l.id]}}}};var w=function(){var n=[];return function(e,t){return n[e]=t,n.filter(Boolean).join("\n")}}()},function(n,e){n.exports=function(n){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!n||"string"!=typeof n)return n;var t=e.protocol+"//"+e.host,a=t+e.pathname.replace(/\/[^\/]*$/,"/");return n.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(n,e){var r,i=e.trim().replace(/^"(.*)"$/,(function(n,e){return e})).replace(/^'(.*)'$/,(function(n,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(i)?n:(r=0===i.indexOf("//")?i:0===i.indexOf("/")?t+i:a+i.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(n,e,t){t(103),n.exports=t(34)}])},function(n,e,t){"use strict";t(110)},function(n,e,t){"use strict";var a=t(287),r=t(111),i=t(61),o=Object.prototype.hasOwnProperty,s={brackets:function(n){return n+"[]"},comma:"comma",indices:function(n,e){return n+"["+e+"]"},repeat:function(n){return n}},l=Array.isArray,c=String.prototype.split,u=Array.prototype.push,d=function(n,e){u.apply(n,l(e)?e:[e])},p=Date.prototype.toISOString,h=i.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:h,formatter:i.formatters[h],indices:!1,serializeDate:function(n){return p.call(n)},skipNulls:!1,strictNullHandling:!1},m={},g=function n(e,t,i,o,s,u,p,h,g,v,y,b,k,w,x,S){for(var _,j=e,T=S,C=0,A=!1;void 0!==(T=T.get(m))&&!A;){var I=T.get(e);if(C+=1,void 0!==I){if(I===C)throw new RangeError("Cyclic object value");A=!0}void 0===T.get(m)&&(C=0)}if("function"==typeof h?j=h(t,j):j instanceof Date?j=y(j):"comma"===i&&l(j)&&(j=r.maybeMap(j,(function(n){return n instanceof Date?y(n):n}))),null===j){if(s)return p&&!w?p(t,f.encoder,x,"key",b):t;j=""}if("string"==typeof(_=j)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||r.isBuffer(j)){if(p){var E=w?t:p(t,f.encoder,x,"key",b);if("comma"===i&&w){for(var O=c.call(String(j),","),L="",$=0;$<O.length;++$)L+=(0===$?"":",")+k(p(O[$],f.encoder,x,"value",b));return[k(E)+(o&&l(j)&&1===O.length?"[]":"")+"="+L]}return[k(E)+"="+k(p(j,f.encoder,x,"value",b))]}return[k(t)+"="+k(String(j))]}var P,z=[];if(void 0===j)return z;if("comma"===i&&l(j))P=[{value:j.length>0?j.join(",")||null:void 0}];else if(l(h))P=h;else{var D=Object.keys(j);P=g?D.sort(g):D}for(var M=o&&l(j)&&1===j.length?t+"[]":t,F=0;F<P.length;++F){var R=P[F],q="object"==typeof R&&void 0!==R.value?R.value:j[R];if(!u||null!==q){var N=l(j)?"function"==typeof i?i(M,R):M:M+(v?"."+R:"["+R+"]");S.set(e,C);var B=a();B.set(m,S),d(z,n(q,N,i,o,s,u,p,h,g,v,y,b,k,w,x,B))}}return z};n.exports=function(n,e){var t,r=n,c=function(n){if(!n)return f;if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var e=n.charset||f.charset;if(void 0!==n.charset&&"utf-8"!==n.charset&&"iso-8859-1"!==n.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=i.default;if(void 0!==n.format){if(!o.call(i.formatters,n.format))throw new TypeError("Unknown format option provided.");t=n.format}var a=i.formatters[t],r=f.filter;return("function"==typeof n.filter||l(n.filter))&&(r=n.filter),{addQueryPrefix:"boolean"==typeof n.addQueryPrefix?n.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===n.allowDots?f.allowDots:!!n.allowDots,charset:e,charsetSentinel:"boolean"==typeof n.charsetSentinel?n.charsetSentinel:f.charsetSentinel,delimiter:void 0===n.delimiter?f.delimiter:n.delimiter,encode:"boolean"==typeof n.encode?n.encode:f.encode,encoder:"function"==typeof n.encoder?n.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:f.encodeValuesOnly,filter:r,format:t,formatter:a,serializeDate:"function"==typeof n.serializeDate?n.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof n.skipNulls?n.skipNulls:f.skipNulls,sort:"function"==typeof n.sort?n.sort:null,strictNullHandling:"boolean"==typeof n.strictNullHandling?n.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(t=c.filter);var u,p=[];if("object"!=typeof r||null===r)return"";u=e&&e.arrayFormat in s?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var h=s[u];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===h&&e&&e.commaRoundTrip;t||(t=Object.keys(r)),c.sort&&t.sort(c.sort);for(var v=a(),y=0;y<t.length;++y){var b=t[y];c.skipNulls&&null===r[b]||d(p,g(r[b],b,h,m,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,v))}var k=p.join(c.delimiter),w=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),k.length>0?w+k:""}},function(n,e,t){"use strict";var a=t(59),r=t(292),i=t(294),o=a("%TypeError%"),s=a("%WeakMap%",!0),l=a("%Map%",!0),c=r("WeakMap.prototype.get",!0),u=r("WeakMap.prototype.set",!0),d=r("WeakMap.prototype.has",!0),p=r("Map.prototype.get",!0),h=r("Map.prototype.set",!0),f=r("Map.prototype.has",!0),m=function(n,e){for(var t,a=n;null!==(t=a.next);a=t)if(t.key===e)return a.next=t.next,t.next=n.next,n.next=t,t};n.exports=function(){var n,e,t,a={assert:function(n){if(!a.has(n))throw new o("Side channel does not contain "+i(n))},get:function(a){if(s&&a&&("object"==typeof a||"function"==typeof a)){if(n)return c(n,a)}else if(l){if(e)return p(e,a)}else if(t)return function(n,e){var t=m(n,e);return t&&t.value}(t,a)},has:function(a){if(s&&a&&("object"==typeof a||"function"==typeof a)){if(n)return d(n,a)}else if(l){if(e)return f(e,a)}else if(t)return function(n,e){return!!m(n,e)}(t,a);return!1},set:function(a,r){s&&a&&("object"==typeof a||"function"==typeof a)?(n||(n=new s),u(n,a,r)):l?(e||(e=new l),h(e,a,r)):(t||(t={key:{},next:null}),function(n,e,t){var a=m(n,e);a?a.value=t:n.next={key:e,next:n.next,value:t}}(t,a,r))}};return a}},function(n,e,t){"use strict";var a="undefined"!=typeof Symbol&&Symbol,r=t(289);n.exports=function(){return"function"==typeof a&&("function"==typeof Symbol&&("symbol"==typeof a("foo")&&("symbol"==typeof Symbol("bar")&&r())))}},function(n,e,t){"use strict";n.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var n={},e=Symbol("test"),t=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;for(e in n[e]=42,n)return!1;if("function"==typeof Object.keys&&0!==Object.keys(n).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(n).length)return!1;var a=Object.getOwnPropertySymbols(n);if(1!==a.length||a[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(n,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},function(n,e,t){"use strict";var a="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,i=Object.prototype.toString;n.exports=function(n){var e=this;if("function"!=typeof e||"[object Function]"!==i.call(e))throw new TypeError(a+e);for(var t,o=r.call(arguments,1),s=function(){if(this instanceof t){var a=e.apply(this,o.concat(r.call(arguments)));return Object(a)===a?a:this}return e.apply(n,o.concat(r.call(arguments)))},l=Math.max(0,e.length-o.length),c=[],u=0;u<l;u++)c.push("$"+u);if(t=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var d=function(){};d.prototype=e.prototype,t.prototype=new d,d.prototype=null}return t}},function(n,e,t){"use strict";var a=t(60);n.exports=a.call(Function.call,Object.prototype.hasOwnProperty)},function(n,e,t){"use strict";var a=t(59),r=t(293),i=r(a("String.prototype.indexOf"));n.exports=function(n,e){var t=a(n,!!e);return"function"==typeof t&&i(n,".prototype.")>-1?r(t):t}},function(n,e,t){"use strict";var a=t(60),r=t(59),i=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),s=r("%Reflect.apply%",!0)||a.call(o,i),l=r("%Object.getOwnPropertyDescriptor%",!0),c=r("%Object.defineProperty%",!0),u=r("%Math.max%");if(c)try{c({},"a",{value:1})}catch(n){c=null}n.exports=function(n){var e=s(a,o,arguments);if(l&&c){var t=l(e,"length");t.configurable&&c(e,"length",{value:1+u(0,n.length-(arguments.length-1))})}return e};var d=function(){return s(a,i,arguments)};c?c(n.exports,"apply",{value:d}):n.exports.apply=d},function(n,e,t){var a="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=a&&r&&"function"==typeof r.get?r.get:null,o=a&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,v=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,k=String.prototype.toUpperCase,w=String.prototype.toLowerCase,x=RegExp.prototype.test,S=Array.prototype.concat,_=Array.prototype.join,j=Array.prototype.slice,T=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,E="function"==typeof Symbol&&"object"==typeof Symbol.iterator,O="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===E||"symbol")?Symbol.toStringTag:null,L=Object.prototype.propertyIsEnumerable,$=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function P(n,e){if(n===1/0||n===-1/0||n!=n||n&&n>-1e3&&n<1e3||x.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof n){var a=n<0?-T(-n):T(n);if(a!==n){var r=String(a),i=y.call(e,r.length+1);return b.call(r,t,"$&_")+"."+b.call(b.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(e,t,"$&_")}var z=t(295),D=z.custom,M=B(D)?D:null;function F(n,e,t){var a="double"===(t.quoteStyle||e)?'"':"'";return a+n+a}function R(n){return b.call(String(n),/"/g,"&quot;")}function q(n){return!("[object Array]"!==V(n)||O&&"object"==typeof n&&O in n)}function N(n){return!("[object RegExp]"!==V(n)||O&&"object"==typeof n&&O in n)}function B(n){if(E)return n&&"object"==typeof n&&n instanceof Symbol;if("symbol"==typeof n)return!0;if(!n||"object"!=typeof n||!I)return!1;try{return I.call(n),!0}catch(n){}return!1}n.exports=function n(e,t,a,r){var s=t||{};if(J(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(J(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!J(s,"customInspect")||s.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(J(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(J(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=s.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return function n(e,t){if(e.length>t.maxStringLength){var a=e.length-t.maxStringLength,r="... "+a+" more character"+(a>1?"s":"");return n(y.call(e,0,t.maxStringLength),t)+r}return F(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,H),"single",t)}(e,s);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var k=String(e);return m?P(e,k):k}if("bigint"==typeof e){var x=String(e)+"n";return m?P(e,x):x}var T=void 0===s.depth?5:s.depth;if(void 0===a&&(a=0),a>=T&&T>0&&"object"==typeof e)return q(e)?"[Array]":"[Object]";var A=function(n,e){var t;if("\t"===n.indent)t="\t";else{if(!("number"==typeof n.indent&&n.indent>0))return null;t=_.call(Array(n.indent+1)," ")}return{base:t,prev:_.call(Array(e+1),t)}}(s,a);if(void 0===r)r=[];else if(W(r,e)>=0)return"[Circular]";function D(e,t,i){if(t&&(r=j.call(r)).push(t),i){var o={depth:s.depth};return J(s,"quoteStyle")&&(o.quoteStyle=s.quoteStyle),n(e,o,a+1,r)}return n(e,s,a+1,r)}if("function"==typeof e&&!N(e)){var U=function(n){if(n.name)return n.name;var e=v.call(g.call(n),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),Z=X(e,D);return"[Function"+(U?": "+U:" (anonymous)")+"]"+(Z.length>0?" { "+_.call(Z,", ")+" }":"")}if(B(e)){var nn=E?b.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(e);return"object"!=typeof e||E?nn:Q(nn)}if(function(n){if(!n||"object"!=typeof n)return!1;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement)return!0;return"string"==typeof n.nodeName&&"function"==typeof n.getAttribute}(e)){for(var en="<"+w.call(String(e.nodeName)),tn=e.attributes||[],an=0;an<tn.length;an++)en+=" "+tn[an].name+"="+F(R(tn[an].value),"double",s);return en+=">",e.childNodes&&e.childNodes.length&&(en+="..."),en+="</"+w.call(String(e.nodeName))+">"}if(q(e)){if(0===e.length)return"[]";var rn=X(e,D);return A&&!function(n){for(var e=0;e<n.length;e++)if(W(n[e],"\n")>=0)return!1;return!0}(rn)?"["+Y(rn,A)+"]":"[ "+_.call(rn,", ")+" ]"}if(function(n){return!("[object Error]"!==V(n)||O&&"object"==typeof n&&O in n)}(e)){var on=X(e,D);return"cause"in Error.prototype||!("cause"in e)||L.call(e,"cause")?0===on.length?"["+String(e)+"]":"{ ["+String(e)+"] "+_.call(on,", ")+" }":"{ ["+String(e)+"] "+_.call(S.call("[cause]: "+D(e.cause),on),", ")+" }"}if("object"==typeof e&&l){if(M&&"function"==typeof e[M]&&z)return z(e,{depth:T-a});if("symbol"!==l&&"function"==typeof e.inspect)return e.inspect()}if(function(n){if(!i||!n||"object"!=typeof n)return!1;try{i.call(n);try{c.call(n)}catch(n){return!0}return n instanceof Map}catch(n){}return!1}(e)){var sn=[];return o&&o.call(e,(function(n,t){sn.push(D(t,e,!0)+" => "+D(n,e))})),K("Map",i.call(e),sn,A)}if(function(n){if(!c||!n||"object"!=typeof n)return!1;try{c.call(n);try{i.call(n)}catch(n){return!0}return n instanceof Set}catch(n){}return!1}(e)){var ln=[];return u&&u.call(e,(function(n){ln.push(D(n,e))})),K("Set",c.call(e),ln,A)}if(function(n){if(!d||!n||"object"!=typeof n)return!1;try{d.call(n,d);try{p.call(n,p)}catch(n){return!0}return n instanceof WeakMap}catch(n){}return!1}(e))return G("WeakMap");if(function(n){if(!p||!n||"object"!=typeof n)return!1;try{p.call(n,p);try{d.call(n,d)}catch(n){return!0}return n instanceof WeakSet}catch(n){}return!1}(e))return G("WeakSet");if(function(n){if(!h||!n||"object"!=typeof n)return!1;try{return h.call(n),!0}catch(n){}return!1}(e))return G("WeakRef");if(function(n){return!("[object Number]"!==V(n)||O&&"object"==typeof n&&O in n)}(e))return Q(D(Number(e)));if(function(n){if(!n||"object"!=typeof n||!C)return!1;try{return C.call(n),!0}catch(n){}return!1}(e))return Q(D(C.call(e)));if(function(n){return!("[object Boolean]"!==V(n)||O&&"object"==typeof n&&O in n)}(e))return Q(f.call(e));if(function(n){return!("[object String]"!==V(n)||O&&"object"==typeof n&&O in n)}(e))return Q(D(String(e)));if(!function(n){return!("[object Date]"!==V(n)||O&&"object"==typeof n&&O in n)}(e)&&!N(e)){var cn=X(e,D),un=$?$(e)===Object.prototype:e instanceof Object||e.constructor===Object,dn=e instanceof Object?"":"null prototype",pn=!un&&O&&Object(e)===e&&O in e?y.call(V(e),8,-1):dn?"Object":"",hn=(un||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(pn||dn?"["+_.call(S.call([],pn||[],dn||[]),": ")+"] ":"");return 0===cn.length?hn+"{}":A?hn+"{"+Y(cn,A)+"}":hn+"{ "+_.call(cn,", ")+" }"}return String(e)};var U=Object.prototype.hasOwnProperty||function(n){return n in this};function J(n,e){return U.call(n,e)}function V(n){return m.call(n)}function W(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,a=n.length;t<a;t++)if(n[t]===e)return t;return-1}function H(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+k.call(e.toString(16))}function Q(n){return"Object("+n+")"}function G(n){return n+" { ? }"}function K(n,e,t,a){return n+" ("+e+") {"+(a?Y(t,a):_.call(t,", "))+"}"}function Y(n,e){if(0===n.length)return"";var t="\n"+e.prev+e.base;return t+_.call(n,","+t)+"\n"+e.prev}function X(n,e){var t=q(n),a=[];if(t){a.length=n.length;for(var r=0;r<n.length;r++)a[r]=J(n,r)?e(n[r],n):""}var i,o="function"==typeof A?A(n):[];if(E){i={};for(var s=0;s<o.length;s++)i["$"+o[s]]=o[s]}for(var l in n)J(n,l)&&(t&&String(Number(l))===l&&l<n.length||E&&i["$"+l]instanceof Symbol||(x.call(/[^\w$]/,l)?a.push(e(l,n)+": "+e(n[l],n)):a.push(l+": "+e(n[l],n))));if("function"==typeof A)for(var c=0;c<o.length;c++)L.call(n,o[c])&&a.push("["+e(o[c])+"]: "+e(n[o[c]],n));return a}},function(n,e){},function(n,e,t){"use strict";var a=t(111),r=Object.prototype.hasOwnProperty,i=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:a.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(n){return n.replace(/&#(\d+);/g,(function(n,e){return String.fromCharCode(parseInt(e,10))}))},l=function(n,e){return n&&"string"==typeof n&&e.comma&&n.indexOf(",")>-1?n.split(","):n},c=function(n,e,t,a){if(n){var i=t.allowDots?n.replace(/\.([^.[]+)/g,"[$1]"):n,o=/(\[[^[\]]*])/g,s=t.depth>0&&/(\[[^[\]]*])/.exec(i),c=s?i.slice(0,s.index):i,u=[];if(c){if(!t.plainObjects&&r.call(Object.prototype,c)&&!t.allowPrototypes)return;u.push(c)}for(var d=0;t.depth>0&&null!==(s=o.exec(i))&&d<t.depth;){if(d+=1,!t.plainObjects&&r.call(Object.prototype,s[1].slice(1,-1))&&!t.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+i.slice(s.index)+"]"),function(n,e,t,a){for(var r=a?e:l(e,t),i=n.length-1;i>=0;--i){var o,s=n[i];if("[]"===s&&t.parseArrays)o=[].concat(r);else{o=t.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(c,10);t.parseArrays||""!==c?!isNaN(u)&&s!==c&&String(u)===c&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(o=[])[u]=r:"__proto__"!==c&&(o[c]=r):o={0:r}}r=o}return r}(u,e,t,a)}};n.exports=function(n,e){var t=function(n){if(!n)return o;if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==n.charset&&"utf-8"!==n.charset&&"iso-8859-1"!==n.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===n.charset?o.charset:n.charset;return{allowDots:void 0===n.allowDots?o.allowDots:!!n.allowDots,allowPrototypes:"boolean"==typeof n.allowPrototypes?n.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof n.allowSparse?n.allowSparse:o.allowSparse,arrayLimit:"number"==typeof n.arrayLimit?n.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof n.charsetSentinel?n.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof n.comma?n.comma:o.comma,decoder:"function"==typeof n.decoder?n.decoder:o.decoder,delimiter:"string"==typeof n.delimiter||a.isRegExp(n.delimiter)?n.delimiter:o.delimiter,depth:"number"==typeof n.depth||!1===n.depth?+n.depth:o.depth,ignoreQueryPrefix:!0===n.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof n.interpretNumericEntities?n.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof n.parameterLimit?n.parameterLimit:o.parameterLimit,parseArrays:!1!==n.parseArrays,plainObjects:"boolean"==typeof n.plainObjects?n.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof n.strictNullHandling?n.strictNullHandling:o.strictNullHandling}}(e);if(""===n||null==n)return t.plainObjects?Object.create(null):{};for(var u="string"==typeof n?function(n,e){var t,c={},u=e.ignoreQueryPrefix?n.replace(/^\?/,""):n,d=e.parameterLimit===1/0?void 0:e.parameterLimit,p=u.split(e.delimiter,d),h=-1,f=e.charset;if(e.charsetSentinel)for(t=0;t<p.length;++t)0===p[t].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[t]?f="utf-8":"utf8=%26%2310003%3B"===p[t]&&(f="iso-8859-1"),h=t,t=p.length);for(t=0;t<p.length;++t)if(t!==h){var m,g,v=p[t],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(m=e.decoder(v,o.decoder,f,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(v.slice(0,b),o.decoder,f,"key"),g=a.maybeMap(l(v.slice(b+1),e),(function(n){return e.decoder(n,o.decoder,f,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===f&&(g=s(g)),v.indexOf("[]=")>-1&&(g=i(g)?[g]:g),r.call(c,m)?c[m]=a.combine(c[m],g):c[m]=g}return c}(n,t):n,d=t.plainObjects?Object.create(null):{},p=Object.keys(u),h=0;h<p.length;++h){var f=p[h],m=c(f,u[f],t,"string"==typeof n);d=a.merge(d,m,t)}return!0===t.allowSparse?d:a.compact(d)}},function(n,e,t){var a=t(16),r=t(299),i=t(300);n.exports=function(n){var e=a(n);return i(e,r(e))+1}},function(n,e){n.exports=function(n){var e=new Date(n.getTime()),t=e.getTimezoneOffset();return e.setSeconds(0,0),6e4*t+e.getTime()%6e4}},function(n,e,t){var a=t(16);n.exports=function(n){var e=a(n),t=new Date(0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}},function(n,e,t){var a=t(301);n.exports=function(n,e){var t=a(n),r=a(e),i=t.getTime()-6e4*t.getTimezoneOffset(),o=r.getTime()-6e4*r.getTimezoneOffset();return Math.round((i-o)/864e5)}},function(n,e,t){var a=t(16);n.exports=function(n){var e=a(n);return e.setHours(0,0,0,0),e}},function(n,e,t){var a=t(16),r=t(62),i=t(304);n.exports=function(n){var e=a(n),t=r(e).getTime()-i(e).getTime();return Math.round(t/6048e5)+1}},function(n,e,t){var a=t(16);n.exports=function(n,e){var t=e&&Number(e.weekStartsOn)||0,r=a(n),i=r.getDay(),o=(i<t?7:0)+i-t;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}},function(n,e,t){var a=t(113),r=t(62);n.exports=function(n){var e=a(n),t=new Date(0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),r(t)}},function(n,e,t){var a=t(112);n.exports=function(n){if(a(n))return!isNaN(n);throw new TypeError(toString.call(n)+" is not an instance of Date")}},function(n,e,t){var a=t(307),r=t(308);n.exports={distanceInWords:a(),format:r()}},function(n,e){n.exports=function(){var n={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,t,a){var r;return a=a||{},r="string"==typeof n[e]?n[e]:1===t?n[e].one:n[e].other.replace("{{count}}",t),a.addSuffix?a.comparison>0?"in "+r:r+" ago":r}}}},function(n,e,t){var a=t(309);n.exports=function(){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["January","February","March","April","May","June","July","August","September","October","November","December"],t=["Su","Mo","Tu","We","Th","Fr","Sa"],r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],s=["am","pm"],l=["a.m.","p.m."],c={MMM:function(e){return n[e.getMonth()]},MMMM:function(n){return e[n.getMonth()]},dd:function(n){return t[n.getDay()]},ddd:function(n){return r[n.getDay()]},dddd:function(n){return i[n.getDay()]},A:function(n){return n.getHours()/12>=1?o[1]:o[0]},a:function(n){return n.getHours()/12>=1?s[1]:s[0]},aa:function(n){return n.getHours()/12>=1?l[1]:l[0]}};return["M","D","DDD","d","Q","W"].forEach((function(n){c[n+"o"]=function(e,t){return function(n){var e=n%100;if(e>20||e<10)switch(e%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"}(t[n](e))}})),{formatters:c,formattingTokensRegExp:a(c)}}},function(n,e){var t=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];n.exports=function(n){var e=[];for(var a in n)n.hasOwnProperty(a)&&e.push(a);var r=t.concat(e).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+r.join("|")+"|.)","g")}},function(n,e,t){"use strict";var a=t(3),r=t(114),i=t(311),o=t(120);function s(n){var e=new i(n),t=r(i.prototype.request,e);return a.extend(t,i.prototype,e),a.extend(t,e),t}var l=s(t(63));l.Axios=i,l.create=function(n){return s(o(l.defaults,n))},l.Cancel=t(121),l.CancelToken=t(325),l.isCancel=t(119),l.all=function(n){return Promise.all(n)},l.spread=t(326),l.isAxiosError=t(327),n.exports=l,n.exports.default=l},function(n,e,t){"use strict";var a=t(3),r=t(115),i=t(312),o=t(313),s=t(120),l=t(323),c=l.validators;function u(n){this.defaults=n,this.interceptors={request:new i,response:new i}}u.prototype.request=function(n){"string"==typeof n?(n=arguments[1]||{}).url=arguments[0]:n=n||{},(n=s(this.defaults,n)).method?n.method=n.method.toLowerCase():this.defaults.method?n.method=this.defaults.method.toLowerCase():n.method="get";var e=n.transitional;void 0!==e&&l.assertOptions(e,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var t=[],a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(n)||(a=a&&e.synchronous,t.unshift(e.fulfilled,e.rejected))}));var r,i=[];if(this.interceptors.response.forEach((function(n){i.push(n.fulfilled,n.rejected)})),!a){var u=[o,void 0];for(Array.prototype.unshift.apply(u,t),u=u.concat(i),r=Promise.resolve(n);u.length;)r=r.then(u.shift(),u.shift());return r}for(var d=n;t.length;){var p=t.shift(),h=t.shift();try{d=p(d)}catch(n){h(n);break}}try{r=o(d)}catch(n){return Promise.reject(n)}for(;i.length;)r=r.then(i.shift(),i.shift());return r},u.prototype.getUri=function(n){return n=s(this.defaults,n),r(n.url,n.params,n.paramsSerializer).replace(/^\?/,"")},a.forEach(["delete","get","head","options"],(function(n){u.prototype[n]=function(e,t){return this.request(s(t||{},{method:n,url:e,data:(t||{}).data}))}})),a.forEach(["post","put","patch"],(function(n){u.prototype[n]=function(e,t,a){return this.request(s(a||{},{method:n,url:e,data:t}))}})),n.exports=u},function(n,e,t){"use strict";var a=t(3);function r(){this.handlers=[]}r.prototype.use=function(n,e,t){return this.handlers.push({fulfilled:n,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(n){this.handlers[n]&&(this.handlers[n]=null)},r.prototype.forEach=function(n){a.forEach(this.handlers,(function(e){null!==e&&n(e)}))},n.exports=r},function(n,e,t){"use strict";var a=t(3),r=t(314),i=t(119),o=t(63);function s(n){n.cancelToken&&n.cancelToken.throwIfRequested()}n.exports=function(n){return s(n),n.headers=n.headers||{},n.data=r.call(n,n.data,n.headers,n.transformRequest),n.headers=a.merge(n.headers.common||{},n.headers[n.method]||{},n.headers),a.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete n.headers[e]})),(n.adapter||o.adapter)(n).then((function(e){return s(n),e.data=r.call(n,e.data,e.headers,n.transformResponse),e}),(function(e){return i(e)||(s(n),e&&e.response&&(e.response.data=r.call(n,e.response.data,e.response.headers,n.transformResponse))),Promise.reject(e)}))}},function(n,e,t){"use strict";var a=t(3),r=t(63);n.exports=function(n,e,t){var i=this||r;return a.forEach(t,(function(t){n=t.call(i,n,e)})),n}},function(n,e,t){"use strict";var a=t(3);n.exports=function(n,e){a.forEach(n,(function(t,a){a!==e&&a.toUpperCase()===e.toUpperCase()&&(n[e]=t,delete n[a])}))}},function(n,e,t){"use strict";var a=t(118);n.exports=function(n,e,t){var r=t.config.validateStatus;t.status&&r&&!r(t.status)?e(a("Request failed with status code "+t.status,t.config,null,t.request,t)):n(t)}},function(n,e,t){"use strict";var a=t(3);n.exports=a.isStandardBrowserEnv()?{write:function(n,e,t,r,i,o){var s=[];s.push(n+"="+encodeURIComponent(e)),a.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),a.isString(r)&&s.push("path="+r),a.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){var e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(n,e,t){"use strict";var a=t(319),r=t(320);n.exports=function(n,e){return n&&!a(e)?r(n,e):e}},function(n,e,t){"use strict";n.exports=function(n){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(n)}},function(n,e,t){"use strict";n.exports=function(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}},function(n,e,t){"use strict";var a=t(3),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];n.exports=function(n){var e,t,i,o={};return n?(a.forEach(n.split("\n"),(function(n){if(i=n.indexOf(":"),e=a.trim(n.substr(0,i)).toLowerCase(),t=a.trim(n.substr(i+1)),e){if(o[e]&&r.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([t]):o[e]?o[e]+", "+t:t}})),o):o}},function(n,e,t){"use strict";var a=t(3);n.exports=a.isStandardBrowserEnv()?function(){var n,e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");function r(n){var a=n;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){var t=a.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0}},function(n,e,t){"use strict";var a=t(324),r={};["object","boolean","number","function","string","symbol"].forEach((function(n,e){r[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}}));var i={},o=a.version.split(".");function s(n,e){for(var t=e?e.split("."):o,a=n.split("."),r=0;r<3;r++){if(t[r]>a[r])return!0;if(t[r]<a[r])return!1}return!1}r.transitional=function(n,e,t){var r=e&&s(e);function o(n,e){return"[Axios v"+a.version+"] Transitional option '"+n+"'"+e+(t?". "+t:"")}return function(t,a,s){if(!1===n)throw new Error(o(a," has been removed in "+e));return r&&!i[a]&&(i[a]=!0,console.warn(o(a," has been deprecated since v"+e+" and will be removed in the near future"))),!n||n(t,a,s)}},n.exports={isOlderVersion:s,assertOptions:function(n,e,t){if("object"!=typeof n)throw new TypeError("options must be an object");for(var a=Object.keys(n),r=a.length;r-- >0;){var i=a[r],o=e[i];if(o){var s=n[i],l=void 0===s||o(s,i,n);if(!0!==l)throw new TypeError("option "+i+" must be "+l)}else if(!0!==t)throw Error("Unknown option "+i)}},validators:r}},function(n){n.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(n,e,t){"use strict";var a=t(121);function r(n){if("function"!=typeof n)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(n){e=n}));var t=this;n((function(n){t.reason||(t.reason=new a(n),e(t.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var n;return{token:new r((function(e){n=e})),cancel:n}},n.exports=r},function(n,e,t){"use strict";n.exports=function(n){return function(e){return n.apply(null,e)}}},function(n,e,t){"use strict";n.exports=function(n){return"object"==typeof n&&!0===n.isAxiosError}},function(n,e,t){},function(n,e,t){"use strict";t(122)},function(n,e,t){"use strict";t(123)},function(n,e,t){"use strict";t(124)},function(n,e,t){"use strict";t(125)},function(n,e,t){"use strict";t.r(e);var a=t(0);
/*!
  * vue-router v3.6.5
  * (c) 2022 Evan You
  * @license MIT
  */function r(n,e){for(var t in e)n[t]=e[t];return n}var i=/[!'()*]/g,o=function(n){return"%"+n.charCodeAt(0).toString(16)},s=/%2C/g,l=function(n){return encodeURIComponent(n).replace(i,o).replace(s,",")};function c(n){try{return decodeURIComponent(n)}catch(n){0}return n}var u=function(n){return null==n||"object"==typeof n?n:String(n)};function d(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),a=c(t.shift()),r=t.length>0?c(t.join("=")):null;void 0===e[a]?e[a]=r:Array.isArray(e[a])?e[a].push(r):e[a]=[e[a],r]})),e):e}function p(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return l(e);if(Array.isArray(t)){var a=[];return t.forEach((function(n){void 0!==n&&(null===n?a.push(l(e)):a.push(l(e)+"="+l(n)))})),a.join("&")}return l(e)+"="+l(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var h=/\/?$/;function f(n,e,t,a){var r=a&&a.options.stringifyQuery,i=e.query||{};try{i=m(i)}catch(n){}var o={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:y(e,r),matched:n?v(n):[]};return t&&(o.redirectedFrom=y(t,r)),Object.freeze(o)}function m(n){if(Array.isArray(n))return n.map(m);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=m(n[t]);return e}return n}var g=f(null,{path:"/"});function v(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function y(n,e){var t=n.path,a=n.query;void 0===a&&(a={});var r=n.hash;return void 0===r&&(r=""),(t||"/")+(e||p)(a)+r}function b(n,e,t){return e===g?n===e:!!e&&(n.path&&e.path?n.path.replace(h,"")===e.path.replace(h,"")&&(t||n.hash===e.hash&&k(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&k(n.query,e.query)&&k(n.params,e.params))))}function k(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),a=Object.keys(e).sort();return t.length===a.length&&t.every((function(t,r){var i=n[t];if(a[r]!==t)return!1;var o=e[t];return null==i||null==o?i===o:"object"==typeof i&&"object"==typeof o?k(i,o):String(i)===String(o)}))}function w(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var a in t.instances){var r=t.instances[a],i=t.enteredCbs[a];if(r&&i){delete t.enteredCbs[a];for(var o=0;o<i.length;o++)r._isBeingDestroyed||i[o](r)}}}}var x={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,a=e.children,i=e.parent,o=e.data;o.routerView=!0;for(var s=i.$createElement,l=t.name,c=i.$route,u=i._routerViewCache||(i._routerViewCache={}),d=0,p=!1;i&&i._routerRoot!==i;){var h=i.$vnode?i.$vnode.data:{};h.routerView&&d++,h.keepAlive&&i._directInactive&&i._inactive&&(p=!0),i=i.$parent}if(o.routerViewDepth=d,p){var f=u[l],m=f&&f.component;return m?(f.configProps&&S(m,o,f.route,f.configProps),s(m,o,a)):s()}var g=c.matched[d],v=g&&g.components[l];if(!g||!v)return u[l]=null,s();u[l]={component:v},o.registerRouteInstance=function(n,e){var t=g.instances[l];(e&&t!==n||!e&&t===n)&&(g.instances[l]=e)},(o.hook||(o.hook={})).prepatch=function(n,e){g.instances[l]=e.componentInstance},o.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[l]&&(g.instances[l]=n.componentInstance),w(c)};var y=g.props&&g.props[l];return y&&(r(u[l],{route:c,configProps:y}),S(v,o,c,y)),s(v,o,a)}};function S(n,e,t,a){var i=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,a);if(i){i=e.props=r({},i);var o=e.attrs=e.attrs||{};for(var s in i)n.props&&s in n.props||(o[s]=i[s],delete i[s])}}function _(n,e,t){var a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;var r=e.split("/");t&&r[r.length-1]||r.pop();for(var i=n.replace(/^\//,"").split("/"),o=0;o<i.length;o++){var s=i[o];".."===s?r.pop():"."!==s&&r.push(s)}return""!==r[0]&&r.unshift(""),r.join("/")}function j(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var T=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},C=N,A=$,I=function(n,e){return z($(n,e),e)},E=z,O=q,L=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function $(n,e){for(var t,a=[],r=0,i=0,o="",s=e&&e.delimiter||"/";null!=(t=L.exec(n));){var l=t[0],c=t[1],u=t.index;if(o+=n.slice(i,u),i=u+l.length,c)o+=c[1];else{var d=n[i],p=t[2],h=t[3],f=t[4],m=t[5],g=t[6],v=t[7];o&&(a.push(o),o="");var y=null!=p&&null!=d&&d!==p,b="+"===g||"*"===g,k="?"===g||"*"===g,w=t[2]||s,x=f||m;a.push({name:h||r++,prefix:p||"",delimiter:w,optional:k,repeat:b,partial:y,asterisk:!!v,pattern:x?M(x):v?".*":"[^"+D(w)+"]+?"})}}return i<n.length&&(o+=n.substr(i)),o&&a.push(o),a}function P(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function z(n,e){for(var t=new Array(n.length),a=0;a<n.length;a++)"object"==typeof n[a]&&(t[a]=new RegExp("^(?:"+n[a].pattern+")$",R(e)));return function(e,a){for(var r="",i=e||{},o=(a||{}).pretty?P:encodeURIComponent,s=0;s<n.length;s++){var l=n[s];if("string"!=typeof l){var c,u=i[l.name];if(null==u){if(l.optional){l.partial&&(r+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(T(u)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(u)+"`");if(0===u.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<u.length;d++){if(c=o(u[d]),!t[s].test(c))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(c)+"`");r+=(0===d?l.prefix:l.delimiter)+c}}else{if(c=l.asterisk?encodeURI(u).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):o(u),!t[s].test(c))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+c+'"');r+=l.prefix+c}}else r+=l}return r}}function D(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function M(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function F(n,e){return n.keys=e,n}function R(n){return n&&n.sensitive?"":"i"}function q(n,e,t){T(e)||(t=e||t,e=[]);for(var a=(t=t||{}).strict,r=!1!==t.end,i="",o=0;o<n.length;o++){var s=n[o];if("string"==typeof s)i+=D(s);else{var l=D(s.prefix),c="(?:"+s.pattern+")";e.push(s),s.repeat&&(c+="(?:"+l+c+")*"),i+=c=s.optional?s.partial?l+"("+c+")?":"(?:"+l+"("+c+"))?":l+"("+c+")"}}var u=D(t.delimiter||"/"),d=i.slice(-u.length)===u;return a||(i=(d?i.slice(0,-u.length):i)+"(?:"+u+"(?=$))?"),i+=r?"$":a&&d?"":"(?="+u+"|$)",F(new RegExp("^"+i,R(t)),e)}function N(n,e,t){return T(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var a=0;a<t.length;a++)e.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return F(n,e)}(n,e):T(n)?function(n,e,t){for(var a=[],r=0;r<n.length;r++)a.push(N(n[r],e,t).source);return F(new RegExp("(?:"+a.join("|")+")",R(t)),e)}(n,e,t):function(n,e,t){return q($(n,t),e,t)}(n,e,t)}C.parse=A,C.compile=I,C.tokensToFunction=E,C.tokensToRegExp=O;var B=Object.create(null);function U(n,e,t){e=e||{};try{var a=B[n]||(B[n]=C.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),a(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function J(n,e,t,a){var i="string"==typeof n?{path:n}:n;if(i._normalized)return i;if(i.name){var o=(i=r({},n)).params;return o&&"object"==typeof o&&(i.params=r({},o)),i}if(!i.path&&i.params&&e){(i=r({},i))._normalized=!0;var s=r(r({},e.params),i.params);if(e.name)i.name=e.name,i.params=s;else if(e.matched.length){var l=e.matched[e.matched.length-1].path;i.path=U(l,s,e.path)}else 0;return i}var c=function(n){var e="",t="",a=n.indexOf("#");a>=0&&(e=n.slice(a),n=n.slice(0,a));var r=n.indexOf("?");return r>=0&&(t=n.slice(r+1),n=n.slice(0,r)),{path:n,query:t,hash:e}}(i.path||""),p=e&&e.path||"/",h=c.path?_(c.path,p,t||i.append):p,f=function(n,e,t){void 0===e&&(e={});var a,r=t||d;try{a=r(n||"")}catch(n){a={}}for(var i in e){var o=e[i];a[i]=Array.isArray(o)?o.map(u):u(o)}return a}(c.query,i.query,a&&a.options.parseQuery),m=i.hash||c.hash;return m&&"#"!==m.charAt(0)&&(m="#"+m),{_normalized:!0,path:h,query:f,hash:m}}var V,W=function(){},H={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,a=this.$route,i=t.resolve(this.to,a,this.append),o=i.location,s=i.route,l=i.href,c={},u=t.options.linkActiveClass,d=t.options.linkExactActiveClass,p=null==u?"router-link-active":u,m=null==d?"router-link-exact-active":d,g=null==this.activeClass?p:this.activeClass,v=null==this.exactActiveClass?m:this.exactActiveClass,y=s.redirectedFrom?f(null,J(s.redirectedFrom),null,t):s;c[v]=b(a,y,this.exactPath),c[g]=this.exact||this.exactPath?c[v]:function(n,e){return 0===n.path.replace(h,"/").indexOf(e.path.replace(h,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(a,y);var k=c[v]?this.ariaCurrentValue:null,w=function(n){Q(n)&&(e.replace?t.replace(o,W):t.push(o,W))},x={click:Q};Array.isArray(this.event)?this.event.forEach((function(n){x[n]=w})):x[this.event]=w;var S={class:c},_=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:l,route:s,navigate:w,isActive:c[g],isExactActive:c[v]});if(_){if(1===_.length)return _[0];if(_.length>1||!_.length)return 0===_.length?n():n("span",{},_)}if("a"===this.tag)S.on=x,S.attrs={href:l,"aria-current":k};else{var j=function n(e){var t;if(e)for(var a=0;a<e.length;a++){if("a"===(t=e[a]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(j){j.isStatic=!1;var T=j.data=r({},j.data);for(var C in T.on=T.on||{},T.on){var A=T.on[C];C in x&&(T.on[C]=Array.isArray(A)?A:[A])}for(var I in x)I in T.on?T.on[I].push(x[I]):T.on[I]=w;var E=j.data.attrs=r({},j.data.attrs);E.href=l,E["aria-current"]=k}else S.on=x}return n(this.tag,S,this.$slots.default)}};function Q(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var G="undefined"!=typeof window;function K(n,e,t,a,r){var i=e||[],o=t||Object.create(null),s=a||Object.create(null);n.forEach((function(n){!function n(e,t,a,r,i,o){var s=r.path,l=r.name;0;var c=r.pathToRegexpOptions||{},u=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return j(e.path+"/"+n)}(s,i,c.strict);"boolean"==typeof r.caseSensitive&&(c.sensitive=r.caseSensitive);var d={path:u,regex:Y(u,c),components:r.components||{default:r.component},alias:r.alias?"string"==typeof r.alias?[r.alias]:r.alias:[],instances:{},enteredCbs:{},name:l,parent:i,matchAs:o,redirect:r.redirect,beforeEnter:r.beforeEnter,meta:r.meta||{},props:null==r.props?{}:r.components?r.props:{default:r.props}};r.children&&r.children.forEach((function(r){var i=o?j(o+"/"+r.path):void 0;n(e,t,a,r,d,i)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==r.alias)for(var p=Array.isArray(r.alias)?r.alias:[r.alias],h=0;h<p.length;++h){0;var f={path:p[h],children:r.children};n(e,t,a,f,i,d.path||"/")}l&&(a[l]||(a[l]=d))}(i,o,s,n,r)}));for(var l=0,c=i.length;l<c;l++)"*"===i[l]&&(i.push(i.splice(l,1)[0]),c--,l--);return{pathList:i,pathMap:o,nameMap:s}}function Y(n,e){return C(n,[],e)}function X(n,e){var t=K(n),a=t.pathList,r=t.pathMap,i=t.nameMap;function o(n,t,o){var s=J(n,t,!1,e),c=s.name;if(c){var u=i[c];if(!u)return l(null,s);var d=u.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof s.params&&(s.params={}),t&&"object"==typeof t.params)for(var p in t.params)!(p in s.params)&&d.indexOf(p)>-1&&(s.params[p]=t.params[p]);return s.path=U(u.path,s.params),l(u,s,o)}if(s.path){s.params={};for(var h=0;h<a.length;h++){var f=a[h],m=r[f];if(Z(m.regex,s.path,s.params))return l(m,s,o)}}return l(null,s)}function s(n,t){var a=n.redirect,r="function"==typeof a?a(f(n,t,null,e)):a;if("string"==typeof r&&(r={path:r}),!r||"object"!=typeof r)return l(null,t);var s=r,c=s.name,u=s.path,d=t.query,p=t.hash,h=t.params;if(d=s.hasOwnProperty("query")?s.query:d,p=s.hasOwnProperty("hash")?s.hash:p,h=s.hasOwnProperty("params")?s.params:h,c){i[c];return o({_normalized:!0,name:c,query:d,hash:p,params:h},void 0,t)}if(u){var m=function(n,e){return _(n,e.parent?e.parent.path:"/",!0)}(u,n);return o({_normalized:!0,path:U(m,h),query:d,hash:p},void 0,t)}return l(null,t)}function l(n,t,a){return n&&n.redirect?s(n,a||t):n&&n.matchAs?function(n,e,t){var a=o({_normalized:!0,path:U(t,e.params)});if(a){var r=a.matched,i=r[r.length-1];return e.params=a.params,l(i,e)}return l(null,e)}(0,t,n.matchAs):f(n,t,a,e)}return{match:o,addRoute:function(n,e){var t="object"!=typeof n?i[n]:void 0;K([e||n],a,r,i,t),t&&t.alias.length&&K(t.alias.map((function(n){return{path:n,children:[e]}})),a,r,i,t)},getRoutes:function(){return a.map((function(n){return r[n]}))},addRoutes:function(n){K(n,a,r,i)}}}function Z(n,e,t){var a=e.match(n);if(!a)return!1;if(!t)return!0;for(var r=1,i=a.length;r<i;++r){var o=n.keys[r-1];o&&(t[o.name||"pathMatch"]="string"==typeof a[r]?c(a[r]):a[r])}return!0}var nn=G&&window.performance&&window.performance.now?window.performance:Date;function en(){return nn.now().toFixed(3)}var tn=en();function an(){return tn}function rn(n){return tn=n}var on=Object.create(null);function sn(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=r({},window.history.state);return t.key=an(),window.history.replaceState(t,"",e),window.addEventListener("popstate",un),function(){window.removeEventListener("popstate",un)}}function ln(n,e,t,a){if(n.app){var r=n.options.scrollBehavior;r&&n.app.$nextTick((function(){var i=function(){var n=an();if(n)return on[n]}(),o=r.call(n,e,t,a?i:null);o&&("function"==typeof o.then?o.then((function(n){mn(n,i)})).catch((function(n){0})):mn(o,i))}))}}function cn(){var n=an();n&&(on[n]={x:window.pageXOffset,y:window.pageYOffset})}function un(n){cn(),n.state&&n.state.key&&rn(n.state.key)}function dn(n){return hn(n.x)||hn(n.y)}function pn(n){return{x:hn(n.x)?n.x:window.pageXOffset,y:hn(n.y)?n.y:window.pageYOffset}}function hn(n){return"number"==typeof n}var fn=/^#\d/;function mn(n,e){var t,a="object"==typeof n;if(a&&"string"==typeof n.selector){var r=fn.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(r){var i=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return{x:a.left-t.left-e.x,y:a.top-t.top-e.y}}(r,i={x:hn((t=i).x)?t.x:0,y:hn(t.y)?t.y:0})}else dn(n)&&(e=pn(n))}else a&&dn(n)&&(e=pn(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var gn,vn=G&&((-1===(gn=window.navigator.userAgent).indexOf("Android 2.")&&-1===gn.indexOf("Android 4.0")||-1===gn.indexOf("Mobile Safari")||-1!==gn.indexOf("Chrome")||-1!==gn.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function yn(n,e){cn();var t=window.history;try{if(e){var a=r({},t.state);a.key=an(),t.replaceState(a,"",n)}else t.pushState({key:rn(en())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function bn(n){yn(n,!0)}var kn={redirected:2,aborted:4,cancelled:8,duplicated:16};function wn(n,e){return Sn(n,e,kn.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return _n.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function xn(n,e){return Sn(n,e,kn.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function Sn(n,e,t,a){var r=new Error(a);return r._isRouter=!0,r.from=n,r.to=e,r.type=t,r}var _n=["params","query","hash"];function jn(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function Tn(n,e){return jn(n)&&n._isRouter&&(null==e||n.type===e)}function Cn(n,e,t){var a=function(r){r>=n.length?t():n[r]?e(n[r],(function(){a(r+1)})):a(r+1)};a(0)}function An(n){return function(e,t,a){var r=!1,i=0,o=null;In(n,(function(n,e,t,s){if("function"==typeof n&&void 0===n.cid){r=!0,i++;var l,c=Ln((function(e){var r;((r=e).__esModule||On&&"Module"===r[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:V.extend(e),t.components[s]=e,--i<=0&&a()})),u=Ln((function(n){var e="Failed to resolve async component "+s+": "+n;o||(o=jn(n)?n:new Error(e),a(o))}));try{l=n(c,u)}catch(n){u(n)}if(l)if("function"==typeof l.then)l.then(c,u);else{var d=l.component;d&&"function"==typeof d.then&&d.then(c,u)}}})),r||a()}}function In(n,e){return En(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function En(n){return Array.prototype.concat.apply([],n)}var On="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Ln(n){var e=!1;return function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(!e)return e=!0,n.apply(this,t)}}var $n=function(n,e){this.router=n,this.base=function(n){if(!n)if(G){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=g,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Pn(n,e,t,a){var r=In(n,(function(n,a,r,i){var o=function(n,e){"function"!=typeof n&&(n=V.extend(n));return n.options[e]}(n,e);if(o)return Array.isArray(o)?o.map((function(n){return t(n,a,r,i)})):t(o,a,r,i)}));return En(a?r.reverse():r)}function zn(n,e){if(e)return function(){return n.apply(e,arguments)}}$n.prototype.listen=function(n){this.cb=n},$n.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},$n.prototype.onError=function(n){this.errorCbs.push(n)},$n.prototype.transitionTo=function(n,e,t){var a,r=this;try{a=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var i=this.current;this.confirmTransition(a,(function(){r.updateRoute(a),e&&e(a),r.ensureURL(),r.router.afterHooks.forEach((function(n){n&&n(a,i)})),r.ready||(r.ready=!0,r.readyCbs.forEach((function(n){n(a)})))}),(function(n){t&&t(n),n&&!r.ready&&(Tn(n,kn.redirected)&&i===g||(r.ready=!0,r.readyErrorCbs.forEach((function(e){e(n)}))))}))},$n.prototype.confirmTransition=function(n,e,t){var a=this,r=this.current;this.pending=n;var i=function(n){!Tn(n)&&jn(n)&&(a.errorCbs.length?a.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},o=n.matched.length-1,s=r.matched.length-1;if(b(n,r)&&o===s&&n.matched[o]===r.matched[s])return this.ensureURL(),n.hash&&ln(this.router,r,n,!1),i(function(n,e){var t=Sn(n,e,kn.duplicated,'Avoided redundant navigation to current location: "'+n.fullPath+'".');return t.name="NavigationDuplicated",t}(r,n));var l=function(n,e){var t,a=Math.max(n.length,e.length);for(t=0;t<a&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),c=l.updated,u=l.deactivated,d=l.activated,p=[].concat(function(n){return Pn(n,"beforeRouteLeave",zn,!0)}(u),this.router.beforeHooks,function(n){return Pn(n,"beforeRouteUpdate",zn)}(c),d.map((function(n){return n.beforeEnter})),An(d)),h=function(e,t){if(a.pending!==n)return i(xn(r,n));try{e(n,r,(function(e){!1===e?(a.ensureURL(!0),i(function(n,e){return Sn(n,e,kn.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(r,n))):jn(e)?(a.ensureURL(!0),i(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(i(wn(r,n)),"object"==typeof e&&e.replace?a.replace(e):a.push(e)):t(e)}))}catch(n){i(n)}};Cn(p,h,(function(){Cn(function(n){return Pn(n,"beforeRouteEnter",(function(n,e,t,a){return function(n,e,t){return function(a,r,i){return n(a,r,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),i(n)}))}}(n,t,a)}))}(d).concat(a.router.resolveHooks),h,(function(){if(a.pending!==n)return i(xn(r,n));a.pending=null,e(n),a.router.app&&a.router.app.$nextTick((function(){w(n)}))}))}))},$n.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},$n.prototype.setupListeners=function(){},$n.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=g,this.pending=null};var Dn=function(n){function e(e,t){n.call(this,e,t),this._startLocation=Mn(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,a=vn&&t;a&&this.listeners.push(sn());var r=function(){var t=n.current,r=Mn(n.base);n.current===g&&r===n._startLocation||n.transitionTo(r,(function(n){a&&ln(e,n,t,!0)}))};window.addEventListener("popstate",r),this.listeners.push((function(){window.removeEventListener("popstate",r)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){yn(j(a.base+n.fullPath)),ln(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){bn(j(a.base+n.fullPath)),ln(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(Mn(this.base)!==this.current.fullPath){var e=j(this.base+this.current.fullPath);n?yn(e):bn(e)}},e.prototype.getCurrentLocation=function(){return Mn(this.base)},e}($n);function Mn(n){var e=window.location.pathname,t=e.toLowerCase(),a=n.toLowerCase();return!n||t!==a&&0!==t.indexOf(j(a+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var Fn=function(n){function e(e,t,a){n.call(this,e,t),a&&function(n){var e=Mn(n);if(!/^\/#/.test(e))return window.location.replace(j(n+"/#"+e)),!0}(this.base)||Rn()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=vn&&e;t&&this.listeners.push(sn());var a=function(){var e=n.current;Rn()&&n.transitionTo(qn(),(function(a){t&&ln(n.router,a,e,!0),vn||Un(a.fullPath)}))},r=vn?"popstate":"hashchange";window.addEventListener(r,a),this.listeners.push((function(){window.removeEventListener(r,a)}))}},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){Bn(n.fullPath),ln(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){Un(n.fullPath),ln(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;qn()!==e&&(n?Bn(e):Un(e))},e.prototype.getCurrentLocation=function(){return qn()},e}($n);function Rn(){var n=qn();return"/"===n.charAt(0)||(Un("/"+n),!1)}function qn(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Nn(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function Bn(n){vn?yn(Nn(n)):window.location.hash=n}function Un(n){vn?bn(Nn(n)):window.location.replace(Nn(n))}var Jn=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index+1).concat(n),a.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var a=this.stack[t];this.confirmTransition(a,(function(){var n=e.current;e.index=t,e.updateRoute(a),e.router.afterHooks.forEach((function(e){e&&e(a,n)}))}),(function(n){Tn(n,kn.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}($n),Vn=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=X(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!vn&&!1!==n.fallback,this.fallback&&(e="hash"),G||(e="abstract"),this.mode=e,e){case"history":this.history=new Dn(this,n.base);break;case"hash":this.history=new Fn(this,n.base,this.fallback);break;case"abstract":this.history=new Jn(this,n.base);break;default:0}},Wn={currentRoute:{configurable:!0}};Vn.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Wn.currentRoute.get=function(){return this.history&&this.history.current},Vn.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof Dn||t instanceof Fn){var a=function(n){t.setupListeners(),function(n){var a=t.current,r=e.options.scrollBehavior;vn&&r&&"fullPath"in n&&ln(e,n,a,!1)}(n)};t.transitionTo(t.getCurrentLocation(),a,a)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Vn.prototype.beforeEach=function(n){return Qn(this.beforeHooks,n)},Vn.prototype.beforeResolve=function(n){return Qn(this.resolveHooks,n)},Vn.prototype.afterEach=function(n){return Qn(this.afterHooks,n)},Vn.prototype.onReady=function(n,e){this.history.onReady(n,e)},Vn.prototype.onError=function(n){this.history.onError(n)},Vn.prototype.push=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.push(n,e,t)}));this.history.push(n,e,t)},Vn.prototype.replace=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.replace(n,e,t)}));this.history.replace(n,e,t)},Vn.prototype.go=function(n){this.history.go(n)},Vn.prototype.back=function(){this.go(-1)},Vn.prototype.forward=function(){this.go(1)},Vn.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Vn.prototype.resolve=function(n,e,t){var a=J(n,e=e||this.history.current,t,this),r=this.match(a,e),i=r.redirectedFrom||r.fullPath;return{location:a,route:r,href:function(n,e,t){var a="hash"===t?"#"+e:e;return n?j(n+"/"+a):a}(this.history.base,i,this.mode),normalizedTo:a,resolved:r}},Vn.prototype.getRoutes=function(){return this.matcher.getRoutes()},Vn.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==g&&this.history.transitionTo(this.history.getCurrentLocation())},Vn.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==g&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Vn.prototype,Wn);var Hn=Vn;function Qn(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Vn.install=function n(e){if(!n.installed||V!==e){n.installed=!0,V=e;var t=function(n){return void 0!==n},a=function(n,e){var a=n.$options._parentVnode;t(a)&&t(a=a.data)&&t(a=a.registerRouteInstance)&&a(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,a(this,this)},destroyed:function(){a(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",x),e.component("RouterLink",H);var r=e.config.optionMergeStrategies;r.beforeRouteEnter=r.beforeRouteLeave=r.beforeRouteUpdate=r.created}},Vn.version="3.6.5",Vn.isNavigationFailure=Tn,Vn.NavigationFailureType=kn,Vn.START_LOCATION=g,G&&window.Vue&&window.Vue.use(Vn);t(66);t(13),t(132);var Gn={NotFound:()=>Promise.all([t.e(0),t.e(10)]).then(t.bind(null,432)),Category:()=>Promise.all([t.e(0),t.e(2),t.e(1),t.e(7)]).then(t.bind(null,433)),Layout:()=>Promise.all([t.e(0),t.e(2),t.e(1),t.e(4)]).then(t.bind(null,431)),Tag:()=>Promise.all([t.e(0),t.e(2),t.e(1),t.e(5)]).then(t.bind(null,434)),Tags:()=>Promise.all([t.e(0),t.e(2),t.e(1),t.e(6)]).then(t.bind(null,435)),TimeLines:()=>Promise.all([t.e(0),t.e(2),t.e(1),t.e(8)]).then(t.bind(null,436))},Kn={"v-5e2a9a26":()=>t.e(11).then(t.bind(null,437)),"v-6f983ce8":()=>t.e(13).then(t.bind(null,438)),"v-44275e2e":()=>t.e(12).then(t.bind(null,439)),"v-96320d50":()=>t.e(14).then(t.bind(null,440)),"v-24391208":()=>t.e(16).then(t.bind(null,441)),"v-7989f230":()=>t.e(17).then(t.bind(null,442)),"v-433786d8":()=>t.e(18).then(t.bind(null,443)),"v-85306db0":()=>t.e(15).then(t.bind(null,444)),"v-be2976b0":()=>t.e(19).then(t.bind(null,445)),"v-cdde13b0":()=>t.e(20).then(t.bind(null,446)),"v-a5a02d48":()=>t.e(23).then(t.bind(null,447)),"v-52bd9ac8":()=>t.e(21).then(t.bind(null,448)),"v-38eee2e4":()=>t.e(22).then(t.bind(null,449)),"v-1cc09c4e":()=>t.e(24).then(t.bind(null,450)),"v-b2e6d364":()=>t.e(25).then(t.bind(null,451)),"v-07a8195c":()=>t.e(27).then(t.bind(null,452)),"v-b516cde4":()=>t.e(26).then(t.bind(null,453)),"v-7b0a2d92":()=>t.e(29).then(t.bind(null,454)),"v-6c3f60b6":()=>t.e(28).then(t.bind(null,455)),"v-7b44edde":()=>t.e(30).then(t.bind(null,456)),"v-3d73bcce":()=>t.e(31).then(t.bind(null,457)),"v-5764f320":()=>t.e(32).then(t.bind(null,458)),"v-4eee7d98":()=>t.e(33).then(t.bind(null,459)),"v-b4527ba4":()=>t.e(34).then(t.bind(null,460)),"v-e0f7392c":()=>t.e(35).then(t.bind(null,461)),"v-8b849c24":()=>t.e(37).then(t.bind(null,462)),"v-3ff5c12e":()=>t.e(36).then(t.bind(null,463)),"v-4b0b72ce":()=>t.e(38).then(t.bind(null,464)),"v-5391637e":()=>t.e(41).then(t.bind(null,465)),"v-d895a124":()=>t.e(42).then(t.bind(null,466)),"v-bf576b64":()=>t.e(39).then(t.bind(null,467)),"v-2d139d12":()=>t.e(40).then(t.bind(null,468)),"v-2c08e938":()=>t.e(43).then(t.bind(null,469)),"v-681ae11a":()=>t.e(44).then(t.bind(null,470)),"v-79b9f78c":()=>t.e(45).then(t.bind(null,471)),"v-428b51f0":()=>t.e(46).then(t.bind(null,472)),"v-46722458":()=>t.e(47).then(t.bind(null,473)),"v-c5de697c":()=>t.e(48).then(t.bind(null,474)),"v-57df1a48":()=>t.e(49).then(t.bind(null,475)),"v-08deb28e":()=>t.e(51).then(t.bind(null,476)),"v-f4a06f18":()=>t.e(52).then(t.bind(null,477)),"v-3a16cf30":()=>t.e(50).then(t.bind(null,478)),"v-fd7622f0":()=>t.e(53).then(t.bind(null,479)),"v-66e98988":()=>t.e(55).then(t.bind(null,480)),"v-58b25868":()=>t.e(54).then(t.bind(null,481)),"v-6b101374":()=>t.e(56).then(t.bind(null,482)),"v-4a34de8e":()=>t.e(57).then(t.bind(null,483)),"v-4c4bcd8c":()=>t.e(58).then(t.bind(null,484)),"v-781a7d54":()=>t.e(59).then(t.bind(null,485)),"v-2cb56542":()=>t.e(60).then(t.bind(null,486)),"v-2f00794e":()=>t.e(61).then(t.bind(null,487)),"v-6690af24":()=>t.e(63).then(t.bind(null,488)),"v-039b744e":()=>t.e(64).then(t.bind(null,489)),"v-695fc26e":()=>t.e(62).then(t.bind(null,490)),"v-4ac8f434":()=>t.e(66).then(t.bind(null,491)),"v-3969da64":()=>t.e(65).then(t.bind(null,492)),"v-6403e0ae":()=>t.e(67).then(t.bind(null,493)),"v-120dde14":()=>t.e(68).then(t.bind(null,494)),"v-0751ed32":()=>t.e(69).then(t.bind(null,495)),"v-58f4b370":()=>t.e(71).then(t.bind(null,496)),"v-57dda42e":()=>t.e(70).then(t.bind(null,497)),"v-32f9ea64":()=>t.e(72).then(t.bind(null,498)),"v-a5b25408":()=>t.e(74).then(t.bind(null,499)),"v-21f7fb68":()=>t.e(76).then(t.bind(null,500)),"v-e8b8e8e8":()=>t.e(73).then(t.bind(null,501)),"v-4212a3b8":()=>t.e(77).then(t.bind(null,502)),"v-2bc4f624":()=>t.e(75).then(t.bind(null,503)),"v-a53cce24":()=>t.e(78).then(t.bind(null,504)),"v-57973fdc":()=>t.e(79).then(t.bind(null,505)),"v-3fa2451e":()=>t.e(80).then(t.bind(null,506)),"v-88e9c230":()=>t.e(84).then(t.bind(null,507)),"v-4ffe6dba":()=>t.e(82).then(t.bind(null,508)),"v-064549ee":()=>t.e(83).then(t.bind(null,509)),"v-c2b654bc":()=>t.e(85).then(t.bind(null,510)),"v-07d81cee":()=>t.e(81).then(t.bind(null,511))};function Yn(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Xn=/-(\w)/g,Zn=Yn(n=>n.replace(Xn,(n,e)=>e?e.toUpperCase():"")),ne=/\B([A-Z])/g,ee=Yn(n=>n.replace(ne,"-$1").toLowerCase()),te=Yn(n=>n.charAt(0).toUpperCase()+n.slice(1));function ae(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(te(Zn(e))):n(te(e))||n(ee(e))}const re=Object.assign({},Gn,Kn),ie=n=>re[n],oe=n=>Kn[n],se=n=>Gn[n],le=n=>a.b.component(n);function ce(n){return ae(oe,n)}function ue(n){return ae(se,n)}function de(n){return ae(ie,n)}function pe(n){return ae(le,n)}function he(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!pe(n)&&de(n)){const e=await de(n)();a.b.component(n,e.default)}}))}function fe(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var me=t(126),ge=t.n(me),ve=t(127),ye=t.n(ve),be={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${ye()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=we(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=xe(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return ge()([{name:"description",content:this.$description}],n,this.siteMeta,Se)},updateCanonicalLink(){ke(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",we(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){xe(null,this.currentMetaTags),ke()}};function ke(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function we(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function xe(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function Se(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var _e=t(128),je={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(_e)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),r=window.innerHeight+t;for(let n=0;n<e.length;n++){const i=e[n],o=e[n+1],s=0===n&&0===t||t>=i.parentElement.offsetTop+10&&(!o||t<o.parentElement.offsetTop-10),l=decodeURIComponent(this.$route.hash);if(s&&l!==decodeURIComponent(i.hash)){const t=i;if(r===a)for(let t=n+1;t<e.length;t++)if(l===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},Te=(t(269),Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n}),Ce=function(n){return"IMG"===n.tagName},Ae=function(n){return n&&1===n.nodeType},Ie=function(n){return".svg"===(n.currentSrc||n.src).substr(-4).toLowerCase()},Ee=function(n){try{return Array.isArray(n)?n.filter(Ce):function(n){return NodeList.prototype.isPrototypeOf(n)}(n)?[].slice.call(n).filter(Ce):Ae(n)?[n].filter(Ce):"string"==typeof n?[].slice.call(document.querySelectorAll(n)).filter(Ce):[]}catch(n){throw new TypeError("The provided selector is invalid.\nExpects a CSS selector, a Node element, a NodeList or an array.\nSee: https://github.com/francoischalifour/medium-zoom")}},Oe=function(n){var e=document.createElement("div");return e.classList.add("medium-zoom-overlay"),e.style.background=n,e},Le=function(n){var e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.width,i=e.height,o=n.cloneNode(),s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return o.removeAttribute("id"),o.style.position="absolute",o.style.top=t+s+"px",o.style.left=a+l+"px",o.style.width=r+"px",o.style.height=i+"px",o.style.transform="",o},$e=function(n,e){var t=Te({bubbles:!1,cancelable:!1,detail:void 0},e);if("function"==typeof window.CustomEvent)return new CustomEvent(n,t);var a=document.createEvent("CustomEvent");return a.initCustomEvent(n,t.bubbles,t.cancelable,t.detail),a};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}(".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}");var Pe=function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.Promise||function(n){function e(){}n(e,e)},r=function(n){var e=n.target;e!==j?-1!==b.indexOf(e)&&m({target:e}):f()},i=function(){if(!w&&_.original){var n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(x-n)>S.scrollOffset&&setTimeout(f,150)}},o=function(n){var e=n.key||n.keyCode;"Escape"!==e&&"Esc"!==e&&27!==e||f()},s=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n;if(n.background&&(j.style.background=n.background),n.container&&n.container instanceof Object&&(e.container=Te({},S.container,n.container)),n.template){var t=Ae(n.template)?n.template:document.querySelector(n.template);e.template=t}return S=Te({},S,e),b.forEach((function(n){n.dispatchEvent($e("medium-zoom:update",{detail:{zoom:T}}))})),T},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(Te({},S,e))},c=function(){for(var n=arguments.length,e=Array(n),t=0;t<n;t++)e[t]=arguments[t];var a=e.reduce((function(n,e){return[].concat(n,Ee(e))}),[]);return a.filter((function(n){return-1===b.indexOf(n)})).forEach((function(n){b.push(n),n.classList.add("medium-zoom-image")})),k.forEach((function(n){var e=n.type,t=n.listener,r=n.options;a.forEach((function(n){n.addEventListener(e,t,r)}))})),T},u=function(){for(var n=arguments.length,e=Array(n),t=0;t<n;t++)e[t]=arguments[t];_.zoomed&&f();var a=e.length>0?e.reduce((function(n,e){return[].concat(n,Ee(e))}),[]):b;return a.forEach((function(n){n.classList.remove("medium-zoom-image"),n.dispatchEvent($e("medium-zoom:detach",{detail:{zoom:T}}))})),b=b.filter((function(n){return-1===a.indexOf(n)})),T},d=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return b.forEach((function(a){a.addEventListener("medium-zoom:"+n,e,t)})),k.push({type:"medium-zoom:"+n,listener:e,options:t}),T},p=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return b.forEach((function(a){a.removeEventListener("medium-zoom:"+n,e,t)})),k=k.filter((function(t){return!(t.type==="medium-zoom:"+n&&t.listener.toString()===e.toString())})),T},h=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.target,t=function(){var n={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},e=void 0,t=void 0;if(S.container)if(S.container instanceof Object)e=(n=Te({},n,S.container)).width-n.left-n.right-2*S.margin,t=n.height-n.top-n.bottom-2*S.margin;else{var a=(Ae(S.container)?S.container:document.querySelector(S.container)).getBoundingClientRect(),r=a.width,i=a.height,o=a.left,s=a.top;n=Te({},n,{width:r,height:i,left:o,top:s})}e=e||n.width-2*S.margin,t=t||n.height-2*S.margin;var l=_.zoomedHd||_.original,c=Ie(l)?e:l.naturalWidth||e,u=Ie(l)?t:l.naturalHeight||t,d=l.getBoundingClientRect(),p=d.top,h=d.left,f=d.width,m=d.height,g=Math.min(Math.max(f,c),e)/f,v=Math.min(Math.max(m,u),t)/m,y=Math.min(g,v),b="scale("+y+") translate3d("+((e-f)/2-h+S.margin+n.left)/y+"px, "+((t-m)/2-p+S.margin+n.top)/y+"px, 0)";_.zoomed.style.transform=b,_.zoomedHd&&(_.zoomedHd.style.transform=b)};return new a((function(n){if(e&&-1===b.indexOf(e))n(T);else{if(_.zoomed)n(T);else{if(e)_.original=e;else{if(!(b.length>0))return void n(T);var a=b;_.original=a[0]}if(_.original.dispatchEvent($e("medium-zoom:open",{detail:{zoom:T}})),x=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,w=!0,_.zoomed=Le(_.original),document.body.appendChild(j),S.template){var r=Ae(S.template)?S.template:document.querySelector(S.template);_.template=document.createElement("div"),_.template.appendChild(r.content.cloneNode(!0)),document.body.appendChild(_.template)}if(_.original.parentElement&&"PICTURE"===_.original.parentElement.tagName&&_.original.currentSrc&&(_.zoomed.src=_.original.currentSrc),document.body.appendChild(_.zoomed),window.requestAnimationFrame((function(){document.body.classList.add("medium-zoom--opened")})),_.original.classList.add("medium-zoom-image--hidden"),_.zoomed.classList.add("medium-zoom-image--opened"),_.zoomed.addEventListener("click",f),_.zoomed.addEventListener("transitionend",(function e(){w=!1,_.zoomed.removeEventListener("transitionend",e),_.original.dispatchEvent($e("medium-zoom:opened",{detail:{zoom:T}})),n(T)})),_.original.getAttribute("data-zoom-src")){_.zoomedHd=_.zoomed.cloneNode(),_.zoomedHd.removeAttribute("srcset"),_.zoomedHd.removeAttribute("sizes"),_.zoomedHd.removeAttribute("loading"),_.zoomedHd.src=_.zoomed.getAttribute("data-zoom-src"),_.zoomedHd.onerror=function(){clearInterval(i),console.warn("Unable to reach the zoom image target "+_.zoomedHd.src),_.zoomedHd=null,t()};var i=setInterval((function(){_.zoomedHd.complete&&(clearInterval(i),_.zoomedHd.classList.add("medium-zoom-image--opened"),_.zoomedHd.addEventListener("click",f),document.body.appendChild(_.zoomedHd),t())}),10)}else if(_.original.hasAttribute("srcset")){_.zoomedHd=_.zoomed.cloneNode(),_.zoomedHd.removeAttribute("sizes"),_.zoomedHd.removeAttribute("loading");var o=_.zoomedHd.addEventListener("load",(function(){_.zoomedHd.removeEventListener("load",o),_.zoomedHd.classList.add("medium-zoom-image--opened"),_.zoomedHd.addEventListener("click",f),document.body.appendChild(_.zoomedHd),t()}))}else t()}}}))},f=function(){return new a((function(n){if(!w&&_.original){w=!0,document.body.classList.remove("medium-zoom--opened"),_.zoomed.style.transform="",_.zoomedHd&&(_.zoomedHd.style.transform=""),_.template&&(_.template.style.transition="opacity 150ms",_.template.style.opacity=0),_.original.dispatchEvent($e("medium-zoom:close",{detail:{zoom:T}})),_.zoomed.addEventListener("transitionend",(function e(){_.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(_.zoomed),_.zoomedHd&&document.body.removeChild(_.zoomedHd),document.body.removeChild(j),_.zoomed.classList.remove("medium-zoom-image--opened"),_.template&&document.body.removeChild(_.template),w=!1,_.zoomed.removeEventListener("transitionend",e),_.original.dispatchEvent($e("medium-zoom:closed",{detail:{zoom:T}})),_.original=null,_.zoomed=null,_.zoomedHd=null,_.template=null,n(T)}))}else n(T)}))},m=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.target;return _.original?f():h({target:e})},g=function(){return S},v=function(){return b},y=function(){return _.original},b=[],k=[],w=!1,x=0,S=t,_={original:null,zoomed:null,zoomedHd:null,template:null};"[object Object]"===Object.prototype.toString.call(e)?S=e:(e||"string"==typeof e)&&c(e),S=Te({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},S);var j=Oe(S.background);document.addEventListener("click",r),document.addEventListener("keyup",o),document.addEventListener("scroll",i),window.addEventListener("resize",f);var T={open:h,close:f,toggle:m,update:s,clone:l,attach:c,detach:u,on:d,off:p,getOptions:g,getImages:v,getZoomedImage:y};return T},ze={data:()=>({zoom:null}),mounted(){this.updateZoom()},updated(){this.updateZoom()},methods:{updateZoom(){setTimeout(()=>{this.zoom&&this.zoom.detach(),this.zoom=Pe(".theme-reco-content :not(a) > img",{})},1e3)}}},De=t(39),Me=t.n(De),Fe={mounted(){Me.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||a.b.component(n.name)||Me.a.start(),t()}),this.$router.afterEach(()=>{Me.a.done(),this.isSidebarOpen=!1})}},Re=t(129),qe=t.n(Re),Ne=(t(270),[be,je,ze,Fe,{mounted(){qe.a.polyfill()}}]),Be={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return fe("layout",n),a.b.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},Ue=t(1),Je=Object(Ue.a)(Be,(function(){return(0,this._self._c)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(Je,"mixins",Ne);const Ve=[{name:"v-5e2a9a26",path:"/",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-5e2a9a26").then(t)}},{path:"/index.html",redirect:"/"},{name:"v-6f983ce8",path:"/algorithm/basic/alg-basic-overview.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-6f983ce8").then(t)}},{name:"v-44275e2e",path:"/about.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-44275e2e").then(t)}},{name:"v-96320d50",path:"/java/basic/java-advanced-spi.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-96320d50").then(t)}},{name:"v-24391208",path:"/java/basic/java-basic-lan-sum.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-24391208").then(t)}},{name:"v-7989f230",path:"/java/basic/java-basic-oop.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-7989f230").then(t)}},{name:"v-433786d8",path:"/java/basic/java-basic-x-annotation.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-433786d8").then(t)}},{name:"v-85306db0",path:"/java/basic/java-basic-lan-basic.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-85306db0").then(t)}},{name:"v-be2976b0",path:"/java/basic/java-basic-x-exception.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-be2976b0").then(t)}},{name:"v-cdde13b0",path:"/java/basic/java-basic-x-generic.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-cdde13b0").then(t)}},{name:"v-a5a02d48",path:"/java/collection/java-collection-LinkedList.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-a5a02d48").then(t)}},{name:"v-52bd9ac8",path:"/java/basic/java-basic-x-reflection.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-52bd9ac8").then(t)}},{name:"v-38eee2e4",path:"/java/collection/java-collection-ArrayList.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-38eee2e4").then(t)}},{name:"v-1cc09c4e",path:"/java/collection/java-collection-PriorityQueue.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-1cc09c4e").then(t)}},{name:"v-b2e6d364",path:"/java/collection/java-collection-Queue&Stack.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-b2e6d364").then(t)}},{name:"v-07a8195c",path:"/java/collection/java-map-HashMap&HashSet.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-07a8195c").then(t)}},{name:"v-b516cde4",path:"/java/collection/java-collection-all.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-b516cde4").then(t)}},{name:"v-7b0a2d92",path:"/java/collection/java-map-TreeMap&TreeSet.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-7b0a2d92").then(t)}},{name:"v-6c3f60b6",path:"/java/collection/java-map-LinkedHashMap&LinkedHashSet.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-6c3f60b6").then(t)}},{name:"v-7b44edde",path:"/java/collection/java-map-WeakHashMap.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-7b44edde").then(t)}},{name:"v-3d73bcce",path:"/java/io/java-io-aio.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-3d73bcce").then(t)}},{name:"v-5764f320",path:"/java/io/java-io-basic-category.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-5764f320").then(t)}},{name:"v-4eee7d98",path:"/java/io/java-io-basic-code-inputstream.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4eee7d98").then(t)}},{name:"v-b4527ba4",path:"/java/io/java-io-basic-code-outputstream.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-b4527ba4").then(t)}},{name:"v-e0f7392c",path:"/java/io/java-io-basic-design-pattern.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-e0f7392c").then(t)}},{name:"v-8b849c24",path:"/java/io/java-io-bio.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-8b849c24").then(t)}},{name:"v-3ff5c12e",path:"/java/io/java-io-basic-usage.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-3ff5c12e").then(t)}},{name:"v-4b0b72ce",path:"/java/io/java-io-model.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4b0b72ce").then(t)}},{name:"v-5391637e",path:"/java/io/java-io-nio-zerocopy.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-5391637e").then(t)}},{name:"v-d895a124",path:"/java/io/java-io-nio.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-d895a124").then(t)}},{name:"v-bf576b64",path:"/java/io/java-io-nio-netty.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-bf576b64").then(t)}},{name:"v-2d139d12",path:"/java/io/java-io-nio-select-epoll.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-2d139d12").then(t)}},{name:"v-2c08e938",path:"/java/io/java-io-overview.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-2c08e938").then(t)}},{name:"v-681ae11a",path:"/java/java8/java8-anno-repeat.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-681ae11a").then(t)}},{name:"v-79b9f78c",path:"/java/java8/java8-default.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-79b9f78c").then(t)}},{name:"v-428b51f0",path:"/java/java8/java8-javafx.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-428b51f0").then(t)}},{name:"v-46722458",path:"/java/java8/java8-jre.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-46722458").then(t)}},{name:"v-c5de697c",path:"/java/java8/java8-localdatetime.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-c5de697c").then(t)}},{name:"v-57df1a48",path:"/java/java8/java8-optional.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-57df1a48").then(t)}},{name:"v-08deb28e",path:"/java/java8/java8-permgen.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-08deb28e").then(t)}},{name:"v-f4a06f18",path:"/java/java8/java8-stampedlock.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-f4a06f18").then(t)}},{name:"v-3a16cf30",path:"/java/java8/java8-others.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-3a16cf30").then(t)}},{name:"v-fd7622f0",path:"/java/java8/java8-stream.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-fd7622f0").then(t)}},{name:"v-66e98988",path:"/java/java8/java8-type.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-66e98988").then(t)}},{name:"v-58b25868",path:"/java/java8/java8-type-anno.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-58b25868").then(t)}},{name:"v-6b101374",path:"/java/java8/java8.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-6b101374").then(t)}},{name:"v-4a34de8e",path:"/java/thread/java-thread-x-juc-AtomicInteger.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4a34de8e").then(t)}},{name:"v-4c4bcd8c",path:"/java/thread/java-thread-x-juc-collection-BlockingQueue.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4c4bcd8c").then(t)}},{name:"v-781a7d54",path:"/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-781a7d54").then(t)}},{name:"v-2cb56542",path:"/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-2cb56542").then(t)}},{name:"v-2f00794e",path:"/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-2f00794e").then(t)}},{name:"v-6690af24",path:"/java/thread/java-thread-x-juc-executor-FutureTask.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-6690af24").then(t)}},{name:"v-039b744e",path:"/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-039b744e").then(t)}},{name:"v-695fc26e",path:"/java/thread/java-thread-x-juc-executor-ForkJoinPool.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-695fc26e").then(t)}},{name:"v-4ac8f434",path:"/java/thread/java-thread-x-juc-overview.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4ac8f434").then(t)}},{name:"v-3969da64",path:"/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-3969da64").then(t)}},{name:"v-6403e0ae",path:"/java/thread/java-thread-x-juc-tool-countdownlatch.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-6403e0ae").then(t)}},{name:"v-120dde14",path:"/java/thread/java-thread-x-juc-tool-cyclicbarrier.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-120dde14").then(t)}},{name:"v-0751ed32",path:"/java/thread/java-thread-x-juc-tool-exchanger.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-0751ed32").then(t)}},{name:"v-58f4b370",path:"/java/thread/java-thread-x-juc-tool-semaphore.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-58f4b370").then(t)}},{name:"v-57dda42e",path:"/java/thread/java-thread-x-juc-tool-phaser.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-57dda42e").then(t)}},{name:"v-32f9ea64",path:"/java/thread/java-thread-x-key-final.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-32f9ea64").then(t)}},{name:"v-a5b25408",path:"/java/thread/java-thread-x-key-volatile.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-a5b25408").then(t)}},{name:"v-21f7fb68",path:"/java/thread/java-thread-x-lock-LockSupport.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-21f7fb68").then(t)}},{name:"v-e8b8e8e8",path:"/java/thread/java-thread-x-key-synchronized.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-e8b8e8e8").then(t)}},{name:"v-4212a3b8",path:"/java/thread/java-thread-x-lock-ReentrantLock.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4212a3b8").then(t)}},{name:"v-2bc4f624",path:"/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-2bc4f624").then(t)}},{name:"v-a53cce24",path:"/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-a53cce24").then(t)}},{name:"v-57973fdc",path:"/java/thread/java-thread-x-lock-all.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-57973fdc").then(t)}},{name:"v-3fa2451e",path:"/java/thread/java-thread-x-overview.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-3fa2451e").then(t)}},{name:"v-88e9c230",path:"/spring/basic/spring.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-88e9c230").then(t)}},{name:"v-4ffe6dba",path:"/java/thread/java-thread-x-thread-basic.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-4ffe6dba").then(t)}},{name:"v-064549ee",path:"/java/thread/java-thread-x-threadlocal.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-064549ee").then(t)}},{name:"v-c2b654bc",path:"/sql/basic/sql-db.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-c2b654bc").then(t)}},{name:"v-07d81cee",path:"/java/thread/java-thread-x-theorty.html",component:Je,beforeEnter:(n,e,t)=>{he("Layout","v-07d81cee").then(t)}},{name:"v-b1564aac",path:"/tag/",component:Je,beforeEnter:(n,e,t)=>{he("Tags","v-b1564aac").then(t)},meta:{pid:"tags",id:"tags"}},{path:"/tag/index.html",redirect:"/tag/"},{name:"v-ef9325c4",path:"/categories/",component:Je,beforeEnter:(n,e,t)=>{he("FrontmatterKey","v-ef9325c4").then(t)},meta:{pid:"categories",id:"categories"}},{path:"/categories/index.html",redirect:"/categories/"},{name:"v-6319eb4e",path:"/timeline/",component:Je,beforeEnter:(n,e,t)=>{he("TimeLines","v-6319eb4e").then(t)},meta:{pid:"timeline",id:"timeline"}},{path:"/timeline/index.html",redirect:"/timeline/"},{path:"*",component:Je}],We={title:"Lowsky's blog",description:"",base:"/vblog/",headTags:[["link",{rel:"icon",href:"/vblog/Eminem.svg"}]],pages:[{title:"Home",frontmatter:{home:!0,heroImage:"/hero.png",heroText:"",tagline:null,actionText:" ",actionLink:"/java/basic/java-basic-oop",features:[{title:"",details:" Markdown "},{title:"Vue",details:" Vue + webpack  Markdown  Vue  Vue "},{title:"",details:"VuePress  HTML SPA "}],footer:"MIT Licensed | Copyright  2018-present Evan You"},regularPath:"/",relativePath:"README.md",key:"v-5e2a9a26",path:"/",lastUpdated:"2023/4/10 01:17:23",lastUpdatedTimestamp:1681060643e3,headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"",frontmatter:{},regularPath:"/algorithm/basic/alg-basic-overview.html",relativePath:"algorithm/basic/alg-basic-overview.md",key:"v-6f983ce8",path:"/algorithm/basic/alg-basic-overview.html",headers:[{level:2,title:"",slug:"",normalizedTitle:"",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:9},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:138},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:146},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:154}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"    ",content:'# \n\n\n\n()\n\n * \n * \n * \n * \n\n\n# \n\n\n\n\n\n\n\n> \n\n\n\n\n\n\n\n\n\nAVLAVLAVL\n\nAVLMap\n\n ()I/O\n\nBB\n\nB+B(B+) B+(Mysql)\n\nB*B+B+, B+1/22/3\n\nR\n\nTrieTrie\n\n\n\n> A.  \n\n *  - Overview\n\n> B.  \n\n *  - \n   * \n *  - \n   * n\n * () - \n   * Hash table(Key value)\n *  - \n   * \n\n> C.  (BST)(AVL)(R-B Tree)(Trie)\n\n *  - Overview\n   * \n *  - (BST)\n   *  Binary Search Tree   \n *  - (AVL)\n   * Balanced Binary Tree1AVLTreap  F(n)=F(n-1)+F(n-2)+1 Fibonacci1F(n-1)F(n-2)\n *  - (R-B Tree)\n   * Red Black Tree AVL\n *  - \n   * , \n *  - (Trie)\n   * Trie\n\n> D.  (Prim & Kruskal)(Dijkstra & Frolyd)(Topological sort)AOE & \n\n *  - Overview\n   * (Graph): \n *  - (BFS & DFS)\n   * (Depth First Search); (Breadth First Search)""""\n *  - (Prim & Kruskal)\n   * Kruskalprim\n *  - (Dijkstra & Frolyd)\n   * \n *  - (Topological sort)\n   * (dependency resolution)\n *  - AOE & \n   * (: )\n\n\n# \n\n *  Data Structure Visualizations\n\n *  Java Point - DS\n\n * Githubjava TheAlgorithms - Java\n\n * @skywang12345 skywang12345 - DS\n\n * @QG-whz() QG-whz\n\n * @  - DS\n\n\n# \n\n * @July  July -  \n\n\n# \n\n * https://www.cnblogs.com/small-boy/p/8039007.html\n\n * https://www.jianshu.com/p/5c84f7b6c354\n\n * https://blog.csdn.net/flowing_wind/article/details/81431354\n\n *  https://www.pdai.tech/md/algorithm/alg-basic-overview.html',normalizedContent:'# \n\n\n\n()\n\n * \n * \n * \n * \n\n\n# \n\n\n\n\n\n\n\n> \n\n\n\n\n\n\n\n\n\navlavlavl\n\navlmap\n\n ()i/o\n\nbb\n\nb+b(b+) b+(mysql)\n\nb*b+b+, b+1/22/3\n\nr\n\ntrietrie\n\n\n\n> a.  \n\n *  - overview\n\n> b.  \n\n *  - \n   * \n *  - \n   * n\n * () - \n   * hash table(key value)\n *  - \n   * \n\n> c.  (bst)(avl)(r-b tree)(trie)\n\n *  - overview\n   * \n *  - (bst)\n   *  binary search tree   \n *  - (avl)\n   * balanced binary tree1avltreap  f(n)=f(n-1)+f(n-2)+1 fibonacci1f(n-1)f(n-2)\n *  - (r-b tree)\n   * red black tree avl\n *  - \n   * , \n *  - (trie)\n   * trie\n\n> d.  (prim & kruskal)(dijkstra & frolyd)(topological sort)aoe & \n\n *  - overview\n   * (graph): \n *  - (bfs & dfs)\n   * (depth first search); (breadth first search)""""\n *  - (prim & kruskal)\n   * kruskalprim\n *  - (dijkstra & frolyd)\n   * \n *  - (topological sort)\n   * (dependency resolution)\n *  - aoe & \n   * (: )\n\n\n# \n\n *  data structure visualizations\n\n *  java point - ds\n\n * githubjava thealgorithms - java\n\n * @skywang12345 skywang12345 - ds\n\n * @qg-whz() qg-whz\n\n * @  - ds\n\n\n# \n\n * @july  july -  \n\n\n# \n\n * https://www.cnblogs.com/small-boy/p/8039007.html\n\n * https://www.jianshu.com/p/5c84f7b6c354\n\n * https://blog.csdn.net/flowing_wind/article/details/81431354\n\n *  https://www.pdai.tech/md/algorithm/alg-basic-overview.html',charsets:{cjk:!0}},{frontmatter:{},regularPath:"/about.html",relativePath:"about.md",key:"v-44275e2e",path:"/about.html",lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:null,content:", @pdai https://www.pdai.tech/\n\n\n\n * \n * \n * \n\n",normalizedContent:", @pdai https://www.pdai.tech/\n\n\n\n * \n * \n * \n\n",charsets:{cjk:!0}},{title:"Java - SPI",frontmatter:{},regularPath:"/java/basic/java-advanced-spi.html",relativePath:"java/basic/java-advanced-spi.md",key:"v-96320d50",path:"/java/basic/java-advanced-spi.html",headers:[{level:2,title:"Java - SPI",slug:"java-spi",normalizedTitle:"java - spi",charIndex:2},{level:2,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:132},{level:2,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:146},{level:2,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:162},{level:3,title:"SPI - JDBC DriverManager",slug:"spi-jdbc-drivermanager",normalizedTitle:"spi - jdbc drivermanager",charIndex:180},{level:3,title:"SPI - Common-Logging",slug:"spi-common-logging",normalizedTitle:"spi - common-logging",charIndex:299},{level:3,title:"SPI - ",slug:"spi-",normalizedTitle:"spi - ",charIndex:329},{level:3,title:"SPI - SpringSPI",slug:"spi-springspi",normalizedTitle:"spi - springspi",charIndex:349},{level:2,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:375},{level:3,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:392},{level:3,title:"SPIAPI",slug:"spiapi",normalizedTitle:"spiapi",charIndex:477},{level:3,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:498},{level:3,title:"SPI",slug:"spi",normalizedTitle:"spi",charIndex:515},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:529}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java - SPI SPI SPI SPI SPI - JDBC DriverManager SPI - Common-Logging SPI -  SPI - SpringSPI SPI SPI SPIAPI SPI SPI ",content:'# Java - SPI\n\n> SPIService Provider InterfaceJDK \n\n * Java - SPI\n   * SPI\n   * SPI\n   * SPI\n     * SPI - JDBC DriverManager\n       * JDBC\n       * mysql\n       * postgresql\n       * \n       * \n     * SPI - Common-Logging\n     * SPI - \n     * SPI - SpringSPI\n   * SPI\n     * SPI\n       * \n       * \n       * \n       * \n     * SPIAPI\n     * SPI\n     * SPI\n   * \n\n\n# SPI\n\nSPIService Provider InterfaceJDK java.sql.DriverMySQLPostgreSQLJavaSPIJavaSPI \n\nSPI\n\n\n\nclasspathMETA-INF/services/jarjarMETA-INF/services/JDKjava.util.ServiceLoader\n\n\n# SPI\n\n> \n\n\n\n * \n\npublic interface Search {\n    public List<String> searchDoc(String keyword);   \n}\n\n\n * \n\npublic class FileSearch implements Search{\n    @Override\n    public List<String> searchDoc(String keyword) {\n        System.out.println(" "+keyword);\n        return null;\n    }\n}\n\n\n * \n\npublic class DatabaseSearch implements Search{\n    @Override\n    public List<String> searchDoc(String keyword) {\n        System.out.println(" "+keyword);\n        return null;\n    }\n}\n\n\n * resources resourcesMETA-INF/services/com.cainiao.ys.spi.learn.Search\n\ncom.cainiao.ys.spi.learn.FileSearch\n\n\n * \n\npublic class TestCase {\n    public static void main(String[] args) {\n        ServiceLoader<Search> s = ServiceLoader.load(Search.class);\n        Iterator<Search> iterator = s.iterator();\n        while (iterator.hasNext()) {\n           Search search =  iterator.next();\n           search.searchDoc("hello world");\n        }\n    }\n}\n\n\n hello world\n\ncom.cainiao.ys.spi.learn.Search\n\nServiceLoader.load(Search.class)META-INF/services\n\nspiproviderproviderjarMETA-INF/services\n\n\n# SPI\n\n\n# SPI - JDBC DriverManager\n\n> JDBC4.0Class.forName("com.mysql.jdbc.Driver")JDBC4.0Class.forName("com.mysql.jdbc.Driver")JavaSPI\n\n# JDBC\n\njavajava.sql.Driver\n\n# mysql\n\nmysqljarmysql-connector-java-6.0.6.jarMETA-INF/servicesjava.sql.Drivercom.mysql.cj.jdbc.DriverJava\n\n# postgresql\n\npostgresqljarpostgresql-42.0.0.jarorg.postgresql.DriverpostgresqlJavajava.sql.Driver\n\n# \n\nSPIJavaClass.forName("com.mysql.jdbc.Driver")\n\nString url = "jdbc:xxxx://xxxx:xxxx/xxxx";\nConnection conn = DriverManager.getConnection(url,username,password);\n.....\n\n\nspi\n\n# \n\nSPIClass.forName("com.mysql.jdbc.Driver")\n\nSPIJavaSPIDriverManagerDriverManagerJavaDriverManager\n\nstatic {\n    loadInitialDrivers();\n    println("JDBC DriverManager initialized");\n}\n\n\nloadInitialDrivers\n\nprivate static void loadInitialDrivers() {\n    String drivers;\n    try {\n        drivers = AccessController.doPrivileged(new PrivilegedAction<String>() {\n            public String run() {\n                return System.getProperty("jdbc.drivers");\n            }\n        });\n    } catch (Exception ex) {\n        drivers = null;\n    }\n\n    AccessController.doPrivileged(new PrivilegedAction<Void>() {\n        public Void run() {\n\t\t\t//SPIServiceLoader\n            ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n            Iterator<Driver> driversIterator = loadedDrivers.iterator();\n            try{\n                while(driversIterator.hasNext()) {\n                    driversIterator.next();\n                }\n            } catch(Throwable t) {\n            // Do nothing\n            }\n            return null;\n        }\n    });\n\n    println("DriverManager.initialize: jdbc.drivers = " + drivers);\n\n    if (drivers == null || drivers.equals("")) {\n        return;\n    }\n    String[] driversList = drivers.split(":");\n    println("number of Drivers:" + driversList.length);\n    for (String aDriver : driversList) {\n        try {\n            println("DriverManager.Initialize: loading " + aDriver);\n            Class.forName(aDriver, true,\n                    ClassLoader.getSystemClassLoader());\n        } catch (Exception ex) {\n            println("DriverManager.Initialize: load failed: " + ex);\n        }\n    }\n}\n\n\n\n\n * \n * SPI\n * SPI\n * \n\n2,3SPISPI\n\nServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n\n\nMETA-INF/services\n\nSPI\n\n//\nIterator<Driver> driversIterator = loadedDrivers.iterator();\n//\nwhile(driversIterator.hasNext()) {\n    driversIterator.next();\n}\n\n\ndriversIterator.hasNext()classpathjarMETA-INF/servicesjava.sql.DriverServiceLoader\n\ndriversIterator.next();\n\njarmysql-connector-java-6.0.6.jarpostgresql-42.0.0.0.jarDriverManager\n\n\n\nmysqlpostgresql\n\n\n# SPI - Common-Logging\n\n> common-loggingJakarta Commons Logging JCL\n\nLogFactorygetLog(String)\n\npublic static getLog(Class clazz) throws LogConfigurationException {\n    return getFactory().getInstance(clazz);\n}\n\n\nLogFatoryFactory getFactory()\n\npublic static org.apache.commons.logging.LogFactory getFactory() throws LogConfigurationException {\n    // Identify the class loader we will be using\n    ClassLoader contextClassLoader = getContextClassLoaderInternal();\n\n    if (contextClassLoader == null) {\n        // This is an odd enough situation to report about. This\n        // output will be a nuisance on JDK1.1, as the system\n        // classloader is null in that environment.\n        if (isDiagnosticsEnabled()) {\n            logDiagnostic("Context classloader is null.");\n        }\n    }\n\n    // Return any previously registered factory for this class loader\n    org.apache.commons.logging.LogFactory factory = getCachedFactory(contextClassLoader);\n    if (factory != null) {\n        return factory;\n    }\n\n    if (isDiagnosticsEnabled()) {\n        logDiagnostic(\n                "[LOOKUP] LogFactory implementation requested for the first time for context classloader " +\n                        objectId(contextClassLoader));\n        logHierarchy("[LOOKUP] ", contextClassLoader);\n    }\n\n    // Load properties file.\n    //\n    // If the properties file exists, then its contents are used as\n    // "attributes" on the LogFactory implementation class. One particular\n    // property may also control which LogFactory concrete subclass is\n    // used, but only if other discovery mechanisms fail..\n    //\n    // As the properties file (if it exists) will be used one way or\n    // another in the end we may as well look for it first.\n    // classpathcommons-logging.properties\n    Properties props = getConfigurationFile(contextClassLoader, FACTORY_PROPERTIES);\n\n    // Determine whether we will be using the thread context class loader to\n    // load logging classes or not by checking the loaded properties file (if any).\n    // classpathcommons-logging.propertiesuse_tccl\n    ClassLoader baseClassLoader = contextClassLoader;\n    if (props != null) {\n        String useTCCLStr = props.getProperty(TCCL_KEY);\n        if (useTCCLStr != null) {\n            // The Boolean.valueOf(useTCCLStr).booleanValue() formulation\n            // is required for Java 1.2 compatibility.\n            if (Boolean.valueOf(useTCCLStr).booleanValue() == false) {\n                // Don\'t use current context classloader when locating any\n                // LogFactory or Log classes, just use the class that loaded\n                // this abstract class. When this class is deployed in a shared\n                // classpath of a container, it means webapps cannot deploy their\n                // own logging implementations. It also means that it is up to the\n                // implementation whether to load library-specific config files\n                // from the TCCL or not.\n                baseClassLoader = thisClassLoader;\n            }\n        }\n    }\n\n    // factory\n    // vmorg.apache.commons.logging.LogFactoryfactory\n    // Determine which concrete LogFactory subclass to use.\n    // First, try a global system property\n    if (isDiagnosticsEnabled()) {\n        logDiagnostic("[LOOKUP] Looking for system property [" + FACTORY_PROPERTY +\n                "] to define the LogFactory subclass to use...");\n    }\n\n    try {\n        String factoryClass = getSystemProperty(FACTORY_PROPERTY, null);\n        if (factoryClass != null) {\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic("[LOOKUP] Creating an instance of LogFactory class \'" + factoryClass +\n                        "\' as specified by system property " + FACTORY_PROPERTY);\n            }\n            factory = newFactory(factoryClass, baseClassLoader, contextClassLoader);\n        } else {\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic("[LOOKUP] No system property [" + FACTORY_PROPERTY + "] defined.");\n            }\n        }\n    } catch (SecurityException e) {\n        if (isDiagnosticsEnabled()) {\n            logDiagnostic("[LOOKUP] A security exception occurred while trying to create an" +\n                    " instance of the custom factory class" + ": [" + trim(e.getMessage()) +\n                    "]. Trying alternative implementations...");\n        }\n        // ignore\n    } catch (RuntimeException e) {\n        // This is not consistent with the behaviour when a bad LogFactory class is\n        // specified in a services file.\n        //\n        // One possible exception that can occur here is a ClassCastException when\n        // the specified class wasn\'t castable to this LogFactory type.\n        if (isDiagnosticsEnabled()) {\n            logDiagnostic("[LOOKUP] An exception occurred while trying to create an" +\n                    " instance of the custom factory class" + ": [" +\n                    trim(e.getMessage()) +\n                    "] as specified by a system property.");\n        }\n        throw e;\n    }\n\n    // java spiMETA-INF/servicesorg.apache.commons.logging.LogFactory\n    // Second, try to find a service by using the JDK1.3 class\n    // discovery mechanism, which involves putting a file with the name\n    // of an interface class in the META-INF/services directory, where the\n    // contents of the file is a single line specifying a concrete class\n    // that implements the desired interface.\n\n    if (factory == null) {\n        if (isDiagnosticsEnabled()) {\n            logDiagnostic("[LOOKUP] Looking for a resource file of name [" + SERVICE_ID +\n                    "] to define the LogFactory subclass to use...");\n        }\n        try {\n            // META-INF/services/org.apache.commons.logging.LogFactory, SERVICE_ID\n            final InputStream is = getResourceAsStream(contextClassLoader, SERVICE_ID);\n\n            if (is != null) {\n                // This code is needed by EBCDIC and other strange systems.\n                // It\'s a fix for bugs reported in xerces\n                BufferedReader rd;\n                try {\n                    rd = new BufferedReader(new InputStreamReader(is, "UTF-8"));\n                } catch (java.io.UnsupportedEncodingException e) {\n                    rd = new BufferedReader(new InputStreamReader(is));\n                }\n\n                String factoryClassName = rd.readLine();\n                rd.close();\n\n                if (factoryClassName != null && !"".equals(factoryClassName)) {\n                    if (isDiagnosticsEnabled()) {\n                        logDiagnostic("[LOOKUP]  Creating an instance of LogFactory class " +\n                                factoryClassName +\n                                " as specified by file \'" + SERVICE_ID +\n                                "\' which was present in the path of the context classloader.");\n                    }\n                    factory = newFactory(factoryClassName, baseClassLoader, contextClassLoader);\n                }\n            } else {\n                // is == null\n                if (isDiagnosticsEnabled()) {\n                    logDiagnostic("[LOOKUP] No resource file with name \'" + SERVICE_ID + "\' found.");\n                }\n            }\n        } catch (Exception ex) {\n            // note: if the specified LogFactory class wasn\'t compatible with LogFactory\n            // for some reason, a ClassCastException will be caught here, and attempts will\n            // continue to find a compatible class.\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic(\n                        "[LOOKUP] A security exception occurred while trying to create an" +\n                                " instance of the custom factory class" +\n                                ": [" + trim(ex.getMessage()) +\n                                "]. Trying alternative implementations...");\n            }\n            // ignore\n        }\n    }\n\n    // classpathcommons-logging.propertiesorg.apache.commons.logging.LogFactoryfactory\n    // Third try looking into the properties file read earlier (if found)\n\n    if (factory == null) {\n        if (props != null) {\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic(\n                        "[LOOKUP] Looking in properties file for entry with key \'" + FACTORY_PROPERTY +\n                                "\' to define the LogFactory subclass to use...");\n            }\n            String factoryClass = props.getProperty(FACTORY_PROPERTY);\n            if (factoryClass != null) {\n                if (isDiagnosticsEnabled()) {\n                    logDiagnostic(\n                            "[LOOKUP] Properties file specifies LogFactory subclass \'" + factoryClass + "\'");\n                }\n                factory = newFactory(factoryClass, baseClassLoader, contextClassLoader);\n\n                // TODO: think about whether we need to handle exceptions from newFactory\n            } else {\n                if (isDiagnosticsEnabled()) {\n                    logDiagnostic("[LOOKUP] Properties file has no entry specifying LogFactory subclass.");\n                }\n            }\n        } else {\n            if (isDiagnosticsEnabled()) {\n                logDiagnostic("[LOOKUP] No properties file available to determine" + " LogFactory subclass from..");\n            }\n        }\n    }\n\n    // factoryorg.apache.commons.logging.impl.LogFactoryImpl\n    // Fourth, try the fallback implementation class\n\n    if (factory == null) {\n        if (isDiagnosticsEnabled()) {\n            logDiagnostic(\n                    "[LOOKUP] Loading the default LogFactory implementation \'" + FACTORY_DEFAULT +\n                            "\' via the same classloader that loaded this LogFactory" +\n                            " class (ie not looking in the context classloader).");\n        }\n\n        // Note: unlike the above code which can try to load custom LogFactory\n        // implementations via the TCCL, we don\'t try to load the default LogFactory\n        // implementation via the context classloader because:\n        // * that can cause problems (see comments in newFactory method)\n        // * no-one should be customising the code of the default class\n        // Yes, we do give up the ability for the child to ship a newer\n        // version of the LogFactoryImpl class and have it used dynamically\n        // by an old LogFactory class in the parent, but that isn\'t\n        // necessarily a good idea anyway.\n        factory = newFactory(FACTORY_DEFAULT, thisClassLoader, contextClassLoader);\n    }\n\n    if (factory != null) {\n        /**\n            * Always cache using context class loader.\n            */\n        cacheFactory(contextClassLoader, factory);\n\n        if (props != null) {\n            Enumeration names = props.propertyNames();\n            while (names.hasMoreElements()) {\n                String name = (String) names.nextElement();\n                String value = props.getProperty(name);\n                factory.setAttribute(name, value);\n            }\n        }\n    }\n\n    return factory;\n}\n\n\nLogFactory\n\n * vmorg.apache.commons.logging.LogFactory\n * SPIorg.apache.commons.logging.LogFactory\n * classpathcommons-logging.propertiesorg.apache.commons.logging.LogFactoryfactory\n * factoryorg.apache.commons.logging.impl.LogFactoryImpl\n\n> LogFactorygetLog()org.apache.commons.logging.Logtracefatalorg.apache.commons.logging.LogFactoryLog\n\n\n# SPI - \n\n> spieclipse\n\nEclipseOSGi\n\n\n\n * META-INF/MANIFEST.MF: \n * build.properties: \n * plugin.xml\n\neclipsepluginsMANIFEST.MF\n\neclipseeclipsespi\n\n\n# SPI - SpringSPI\n\nspringbootMETA-INF/spring.factoriesSpringFactoriesLoaderCLASSPATHJarMETA-INF/spring.factoriespropertiesClassPathJarClasspathjar\n\npublic static final String FACTORIES_RESOURCE_LOCATION = "META-INF/spring.factories";\n// spring.factorieskey=value1,value2,value3\n// jarMETA-INF/spring.factories\n// key=factoryClassvalue\npublic static List<String> loadFactoryNames(Class<?> factoryClass, ClassLoader classLoader) {\n    String factoryClassName = factoryClass.getName();\n    // URL\n    Enumeration<URL> urls = (classLoader != null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) : ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));\n    List<String> result = new ArrayList<String>();\n    // URL\n    while (urls.hasMoreElements()) {\n        URL url = urls.nextElement();\n        // URLproperties@Configuration\n        Properties properties = PropertiesLoaderUtils.loadProperties(new UrlResource(url));\n        String factoryClassNames = properties.getProperty(factoryClassName);\n        // \n        result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));\n    }\n    return result;\n}\n\n\n\n# SPI\n\n\n# SPI\n\n\n\n * \n * \n * \n\n# \n\njava.sql.Driver\n\n# \n\n\n\nMETA-INF/servicesjava.sql.Driverme.cxis.sql.MyDriver\n\nme.cxis.sql.MyDriverDriver\n\n# \n\njar\n\nServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n//\nIterator<Driver> driversIterator = loadedDrivers.iterator();\n//\nwhile(driversIterator.hasNext()) {\n    driversIterator.next();\n    //\n}\n\n\n# \n\njdk spi\n\n\n\n\n# SPIAPI\n\n> SPIAPIAPISPI\n\n> SPI - \n\n * \n * \n * \n * \n\n> API - \n\n * \n * \n * \n\n\n\n * difference-between-spi-and-api\n *  SPI  API\n\n\n\n\n\n\n# SPI\n\nJDKServiceLoader<S>\n\n//ServiceLoaderIterable\npublic final class ServiceLoader<S>\n    implements Iterable<S>\n{\n\n    //\n    private static final String PREFIX = "META-INF/services/";\n\n    //\n    private final Class<S> service;\n\n    //ClassLoader\n    private final ClassLoader loader;\n\n    // \n    private final AccessControlContext acc;\n\n    // \n    private LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\n    // \n    private LazyIterator lookupIterator;\n\n\n    //ServiceLoaderJava\n    public void reload() {\n        //\n        providers.clear();\n        //\n        lookupIterator = new LazyIterator(service, loader);\n    }\n\n    //\n    //\n    //\n    private ServiceLoader(Class<S> svc, ClassLoader cl) {\n        service = Objects.requireNonNull(svc, "Service interface cannot be null");\n        loader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl;\n        acc = (System.getSecurityManager() != null) ? AccessController.getContext() : null;\n        reload();\n    }\n\n    //\n    private static void fail(Class<?> service, String msg, Throwable cause)\n        throws ServiceConfigurationError\n    {\n        throw new ServiceConfigurationError(service.getName() + ": " + msg,\n                                            cause);\n    }\n\n    private static void fail(Class<?> service, String msg)\n        throws ServiceConfigurationError\n    {\n        throw new ServiceConfigurationError(service.getName() + ": " + msg);\n    }\n\n    private static void fail(Class<?> service, URL u, int line, String msg)\n        throws ServiceConfigurationError\n    {\n        fail(service, u + ":" + line + ": " + msg);\n    }\n\n    //\n    //\n    //\n    //\n    private int parseLine(Class<?> service, URL u, BufferedReader r, int lc,\n                          List<String> names)\n        throws IOException, ServiceConfigurationError\n    {\n        //\n        String ln = r.readLine();\n        if (ln == null) {\n            return -1;\n        }\n        //#\n        int ci = ln.indexOf(\'#\');\n        if (ci >= 0) ln = ln.substring(0, ci);\n        ln = ln.trim();\n        int n = ln.length();\n        if (n != 0) {\n            if ((ln.indexOf(\' \') >= 0) || (ln.indexOf(\'\\t\') >= 0))\n                fail(service, u, lc, "Illegal configuration-file syntax");\n            int cp = ln.codePointAt(0);\n            if (!Character.isJavaIdentifierStart(cp))\n                fail(service, u, lc, "Illegal provider-class name: " + ln);\n            for (int i = Character.charCount(cp); i < n; i += Character.charCount(cp)) {\n                cp = ln.codePointAt(i);\n                if (!Character.isJavaIdentifierPart(cp) && (cp != \'.\'))\n                    fail(service, u, lc, "Illegal provider-class name: " + ln);\n            }\n            if (!providers.containsKey(ln) && !names.contains(ln))\n                names.add(ln);\n        }\n        return lc + 1;\n    }\n\n    //url\n    //parseLine\n    private Iterator<String> parse(Class<?> service, URL u)\n        throws ServiceConfigurationError\n    {\n        InputStream in = null;\n        BufferedReader r = null;\n        ArrayList<String> names = new ArrayList<>();\n        try {\n            in = u.openStream();\n            r = new BufferedReader(new InputStreamReader(in, "utf-8"));\n            int lc = 1;\n            while ((lc = parseLine(service, u, r, lc, names)) >= 0);\n        }\n        return names.iterator();\n    }\n\n    //\n    private class LazyIterator\n        implements Iterator<S>\n    {\n\n        Class<S> service;//\n        ClassLoader loader;//\n        Enumeration<URL> configs = null;//url\n        Iterator<String> pending = null;//\n        String nextName = null;//\n\n        private LazyIterator(Class<S> service, ClassLoader loader) {\n            this.service = service;\n            this.loader = loader;\n        }\n\n        private boolean hasNextService() {\n            if (nextName != null) {\n                return true;\n            }\n            if (configs == null) {\n                try {\n                    String fullName = PREFIX + service.getName();\n                    if (loader == null)\n                        configs = ClassLoader.getSystemResources(fullName);\n                    else\n                        configs = loader.getResources(fullName);\n                }\n            }\n            while ((pending == null) || !pending.hasNext()) {\n                if (!configs.hasMoreElements()) {\n                    return false;\n                }\n                pending = parse(service, configs.nextElement());\n            }\n            nextName = pending.next();\n            return true;\n        }\n\n        private S nextService() {\n            if (!hasNextService())\n                throw new NoSuchElementException();\n            String cn = nextName;\n            nextName = null;\n            Class<?> c = null;\n            try {\n                c = Class.forName(cn, false, loader);\n            }\n            if (!service.isAssignableFrom(c)) {\n                fail(service, "Provider " + cn  + " not a subtype");\n            }\n            try {\n                S p = service.cast(c.newInstance());\n                providers.put(cn, p);\n                return p;\n            }\n        }\n\n        public boolean hasNext() {\n            if (acc == null) {\n                return hasNextService();\n            } else {\n                PrivilegedAction<Boolean> action = new PrivilegedAction<Boolean>() {\n                    public Boolean run() { return hasNextService(); }\n                };\n                return AccessController.doPrivileged(action, acc);\n            }\n        }\n\n        public S next() {\n            if (acc == null) {\n                return nextService();\n            } else {\n                PrivilegedAction<S> action = new PrivilegedAction<S>() {\n                    public S run() { return nextService(); }\n                };\n                return AccessController.doPrivileged(action, acc);\n            }\n        }\n\n        public void remove() {\n            throw new UnsupportedOperationException();\n        }\n\n    }\n\n    //\n    //\n    //\n    //\n    public Iterator<S> iterator() {\n        return new Iterator<S>() {\n            //\n            Iterator<Map.Entry<String,S>> knownProviders\n                = providers.entrySet().iterator();\n\n            public boolean hasNext() {\n                if (knownProviders.hasNext())\n                    return true;\n                return lookupIterator.hasNext();\n            }\n\n            public S next() {\n                if (knownProviders.hasNext())\n                    return knownProviders.next().getValue();\n                return lookupIterator.next();\n            }\n\n            public void remove() {\n                throw new UnsupportedOperationException();\n            }\n\n        };\n    }\n\n    //ServiceLoader\n    public static <S> ServiceLoader<S> load(Class<S> service,\n                                            ClassLoader loader)\n    {\n        return new ServiceLoader<>(service, loader);\n    }\n\n    //ServiceLoader\n    public static <S> ServiceLoader<S> load(Class<S> service) {\n        ClassLoader cl = Thread.currentThread().getContextClassLoader();\n        return ServiceLoader.load(service, cl);\n    }\n\n    //ServiceLoader\n    //Java\n    public static <S> ServiceLoader<S> loadInstalled(Class<S> service) {\n        ClassLoader cl = ClassLoader.getSystemClassLoader();\n        ClassLoader prev = null;\n        while (cl != null) {\n            prev = cl;\n            cl = cl.getParent();\n        }\n        return ServiceLoader.load(service, prev);\n    }\n\n    public String toString() {\n        return "java.util.ServiceLoader[" + service.getName() + "]";\n    }\n\n}\n\n\nServiceLoaderIterablehasNextnextlookupIteratorhasNextnextlookupIterator\n\nLazyIteratorhasNextPREFIXMETA-INF/services/classpathMETA-INF/services/\n\nClass.forName()newInstanceproviders(LinkedHashMap<String,S>\n\nServiceLoaderhasNextnext\n\nreload\n\n\n# SPI\n\nSPI\n\n * \n\n *  Iterator \n\n *  ServiceLoader \n\n\n# \n\n * https://cxis.me/2017/04/17/Java%E4%B8%ADSPI%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%85%A5%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/\n * https://stackoverflow.com/questions/2954372/difference-between-spi-and-api?answertab=votes#tab-top\n * https://zhuanlan.zhihu.com/p/28909673\n * http://blog.itpub.net/69912579/viewspace-2656555/\n * https://www.cnblogs.com/happyframework/archive/2013/09/17/3325560.html\n * https://blog.csdn.net/sakurainluojia/article/details/53534949\n * https://www.jianshu.com/p/0d196ad23915\n *  https://www.pdai.tech/md/java/advanced/java-advanced-spi.html',normalizedContent:'# java - spi\n\n> spiservice provider interfacejdk \n\n * java - spi\n   * spi\n   * spi\n   * spi\n     * spi - jdbc drivermanager\n       * jdbc\n       * mysql\n       * postgresql\n       * \n       * \n     * spi - common-logging\n     * spi - \n     * spi - springspi\n   * spi\n     * spi\n       * \n       * \n       * \n       * \n     * spiapi\n     * spi\n     * spi\n   * \n\n\n# spi\n\nspiservice provider interfacejdk java.sql.drivermysqlpostgresqljavaspijavaspi \n\nspi\n\n\n\nclasspathmeta-inf/services/jarjarmeta-inf/services/jdkjava.util.serviceloader\n\n\n# spi\n\n> \n\n\n\n * \n\npublic interface search {\n    public list<string> searchdoc(string keyword);   \n}\n\n\n * \n\npublic class filesearch implements search{\n    @override\n    public list<string> searchdoc(string keyword) {\n        system.out.println(" "+keyword);\n        return null;\n    }\n}\n\n\n * \n\npublic class databasesearch implements search{\n    @override\n    public list<string> searchdoc(string keyword) {\n        system.out.println(" "+keyword);\n        return null;\n    }\n}\n\n\n * resources resourcesmeta-inf/services/com.cainiao.ys.spi.learn.search\n\ncom.cainiao.ys.spi.learn.filesearch\n\n\n * \n\npublic class testcase {\n    public static void main(string[] args) {\n        serviceloader<search> s = serviceloader.load(search.class);\n        iterator<search> iterator = s.iterator();\n        while (iterator.hasnext()) {\n           search search =  iterator.next();\n           search.searchdoc("hello world");\n        }\n    }\n}\n\n\n hello world\n\ncom.cainiao.ys.spi.learn.search\n\nserviceloader.load(search.class)meta-inf/services\n\nspiproviderproviderjarmeta-inf/services\n\n\n# spi\n\n\n# spi - jdbc drivermanager\n\n> jdbc4.0class.forname("com.mysql.jdbc.driver")jdbc4.0class.forname("com.mysql.jdbc.driver")javaspi\n\n# jdbc\n\njavajava.sql.driver\n\n# mysql\n\nmysqljarmysql-connector-java-6.0.6.jarmeta-inf/servicesjava.sql.drivercom.mysql.cj.jdbc.driverjava\n\n# postgresql\n\npostgresqljarpostgresql-42.0.0.jarorg.postgresql.driverpostgresqljavajava.sql.driver\n\n# \n\nspijavaclass.forname("com.mysql.jdbc.driver")\n\nstring url = "jdbc:xxxx://xxxx:xxxx/xxxx";\nconnection conn = drivermanager.getconnection(url,username,password);\n.....\n\n\nspi\n\n# \n\nspiclass.forname("com.mysql.jdbc.driver")\n\nspijavaspidrivermanagerdrivermanagerjavadrivermanager\n\nstatic {\n    loadinitialdrivers();\n    println("jdbc drivermanager initialized");\n}\n\n\nloadinitialdrivers\n\nprivate static void loadinitialdrivers() {\n    string drivers;\n    try {\n        drivers = accesscontroller.doprivileged(new privilegedaction<string>() {\n            public string run() {\n                return system.getproperty("jdbc.drivers");\n            }\n        });\n    } catch (exception ex) {\n        drivers = null;\n    }\n\n    accesscontroller.doprivileged(new privilegedaction<void>() {\n        public void run() {\n\t\t\t//spiserviceloader\n            serviceloader<driver> loadeddrivers = serviceloader.load(driver.class);\n            iterator<driver> driversiterator = loadeddrivers.iterator();\n            try{\n                while(driversiterator.hasnext()) {\n                    driversiterator.next();\n                }\n            } catch(throwable t) {\n            // do nothing\n            }\n            return null;\n        }\n    });\n\n    println("drivermanager.initialize: jdbc.drivers = " + drivers);\n\n    if (drivers == null || drivers.equals("")) {\n        return;\n    }\n    string[] driverslist = drivers.split(":");\n    println("number of drivers:" + driverslist.length);\n    for (string adriver : driverslist) {\n        try {\n            println("drivermanager.initialize: loading " + adriver);\n            class.forname(adriver, true,\n                    classloader.getsystemclassloader());\n        } catch (exception ex) {\n            println("drivermanager.initialize: load failed: " + ex);\n        }\n    }\n}\n\n\n\n\n * \n * spi\n * spi\n * \n\n2,3spispi\n\nserviceloader<driver> loadeddrivers = serviceloader.load(driver.class);\n\n\nmeta-inf/services\n\nspi\n\n//\niterator<driver> driversiterator = loadeddrivers.iterator();\n//\nwhile(driversiterator.hasnext()) {\n    driversiterator.next();\n}\n\n\ndriversiterator.hasnext()classpathjarmeta-inf/servicesjava.sql.driverserviceloader\n\ndriversiterator.next();\n\njarmysql-connector-java-6.0.6.jarpostgresql-42.0.0.0.jardrivermanager\n\n\n\nmysqlpostgresql\n\n\n# spi - common-logging\n\n> common-loggingjakarta commons logging jcl\n\nlogfactorygetlog(string)\n\npublic static getlog(class clazz) throws logconfigurationexception {\n    return getfactory().getinstance(clazz);\n}\n\n\nlogfatoryfactory getfactory()\n\npublic static org.apache.commons.logging.logfactory getfactory() throws logconfigurationexception {\n    // identify the class loader we will be using\n    classloader contextclassloader = getcontextclassloaderinternal();\n\n    if (contextclassloader == null) {\n        // this is an odd enough situation to report about. this\n        // output will be a nuisance on jdk1.1, as the system\n        // classloader is null in that environment.\n        if (isdiagnosticsenabled()) {\n            logdiagnostic("context classloader is null.");\n        }\n    }\n\n    // return any previously registered factory for this class loader\n    org.apache.commons.logging.logfactory factory = getcachedfactory(contextclassloader);\n    if (factory != null) {\n        return factory;\n    }\n\n    if (isdiagnosticsenabled()) {\n        logdiagnostic(\n                "[lookup] logfactory implementation requested for the first time for context classloader " +\n                        objectid(contextclassloader));\n        loghierarchy("[lookup] ", contextclassloader);\n    }\n\n    // load properties file.\n    //\n    // if the properties file exists, then its contents are used as\n    // "attributes" on the logfactory implementation class. one particular\n    // property may also control which logfactory concrete subclass is\n    // used, but only if other discovery mechanisms fail..\n    //\n    // as the properties file (if it exists) will be used one way or\n    // another in the end we may as well look for it first.\n    // classpathcommons-logging.properties\n    properties props = getconfigurationfile(contextclassloader, factory_properties);\n\n    // determine whether we will be using the thread context class loader to\n    // load logging classes or not by checking the loaded properties file (if any).\n    // classpathcommons-logging.propertiesuse_tccl\n    classloader baseclassloader = contextclassloader;\n    if (props != null) {\n        string usetcclstr = props.getproperty(tccl_key);\n        if (usetcclstr != null) {\n            // the boolean.valueof(usetcclstr).booleanvalue() formulation\n            // is required for java 1.2 compatibility.\n            if (boolean.valueof(usetcclstr).booleanvalue() == false) {\n                // don\'t use current context classloader when locating any\n                // logfactory or log classes, just use the class that loaded\n                // this abstract class. when this class is deployed in a shared\n                // classpath of a container, it means webapps cannot deploy their\n                // own logging implementations. it also means that it is up to the\n                // implementation whether to load library-specific config files\n                // from the tccl or not.\n                baseclassloader = thisclassloader;\n            }\n        }\n    }\n\n    // factory\n    // vmorg.apache.commons.logging.logfactoryfactory\n    // determine which concrete logfactory subclass to use.\n    // first, try a global system property\n    if (isdiagnosticsenabled()) {\n        logdiagnostic("[lookup] looking for system property [" + factory_property +\n                "] to define the logfactory subclass to use...");\n    }\n\n    try {\n        string factoryclass = getsystemproperty(factory_property, null);\n        if (factoryclass != null) {\n            if (isdiagnosticsenabled()) {\n                logdiagnostic("[lookup] creating an instance of logfactory class \'" + factoryclass +\n                        "\' as specified by system property " + factory_property);\n            }\n            factory = newfactory(factoryclass, baseclassloader, contextclassloader);\n        } else {\n            if (isdiagnosticsenabled()) {\n                logdiagnostic("[lookup] no system property [" + factory_property + "] defined.");\n            }\n        }\n    } catch (securityexception e) {\n        if (isdiagnosticsenabled()) {\n            logdiagnostic("[lookup] a security exception occurred while trying to create an" +\n                    " instance of the custom factory class" + ": [" + trim(e.getmessage()) +\n                    "]. trying alternative implementations...");\n        }\n        // ignore\n    } catch (runtimeexception e) {\n        // this is not consistent with the behaviour when a bad logfactory class is\n        // specified in a services file.\n        //\n        // one possible exception that can occur here is a classcastexception when\n        // the specified class wasn\'t castable to this logfactory type.\n        if (isdiagnosticsenabled()) {\n            logdiagnostic("[lookup] an exception occurred while trying to create an" +\n                    " instance of the custom factory class" + ": [" +\n                    trim(e.getmessage()) +\n                    "] as specified by a system property.");\n        }\n        throw e;\n    }\n\n    // java spimeta-inf/servicesorg.apache.commons.logging.logfactory\n    // second, try to find a service by using the jdk1.3 class\n    // discovery mechanism, which involves putting a file with the name\n    // of an interface class in the meta-inf/services directory, where the\n    // contents of the file is a single line specifying a concrete class\n    // that implements the desired interface.\n\n    if (factory == null) {\n        if (isdiagnosticsenabled()) {\n            logdiagnostic("[lookup] looking for a resource file of name [" + service_id +\n                    "] to define the logfactory subclass to use...");\n        }\n        try {\n            // meta-inf/services/org.apache.commons.logging.logfactory, service_id\n            final inputstream is = getresourceasstream(contextclassloader, service_id);\n\n            if (is != null) {\n                // this code is needed by ebcdic and other strange systems.\n                // it\'s a fix for bugs reported in xerces\n                bufferedreader rd;\n                try {\n                    rd = new bufferedreader(new inputstreamreader(is, "utf-8"));\n                } catch (java.io.unsupportedencodingexception e) {\n                    rd = new bufferedreader(new inputstreamreader(is));\n                }\n\n                string factoryclassname = rd.readline();\n                rd.close();\n\n                if (factoryclassname != null && !"".equals(factoryclassname)) {\n                    if (isdiagnosticsenabled()) {\n                        logdiagnostic("[lookup]  creating an instance of logfactory class " +\n                                factoryclassname +\n                                " as specified by file \'" + service_id +\n                                "\' which was present in the path of the context classloader.");\n                    }\n                    factory = newfactory(factoryclassname, baseclassloader, contextclassloader);\n                }\n            } else {\n                // is == null\n                if (isdiagnosticsenabled()) {\n                    logdiagnostic("[lookup] no resource file with name \'" + service_id + "\' found.");\n                }\n            }\n        } catch (exception ex) {\n            // note: if the specified logfactory class wasn\'t compatible with logfactory\n            // for some reason, a classcastexception will be caught here, and attempts will\n            // continue to find a compatible class.\n            if (isdiagnosticsenabled()) {\n                logdiagnostic(\n                        "[lookup] a security exception occurred while trying to create an" +\n                                " instance of the custom factory class" +\n                                ": [" + trim(ex.getmessage()) +\n                                "]. trying alternative implementations...");\n            }\n            // ignore\n        }\n    }\n\n    // classpathcommons-logging.propertiesorg.apache.commons.logging.logfactoryfactory\n    // third try looking into the properties file read earlier (if found)\n\n    if (factory == null) {\n        if (props != null) {\n            if (isdiagnosticsenabled()) {\n                logdiagnostic(\n                        "[lookup] looking in properties file for entry with key \'" + factory_property +\n                                "\' to define the logfactory subclass to use...");\n            }\n            string factoryclass = props.getproperty(factory_property);\n            if (factoryclass != null) {\n                if (isdiagnosticsenabled()) {\n                    logdiagnostic(\n                            "[lookup] properties file specifies logfactory subclass \'" + factoryclass + "\'");\n                }\n                factory = newfactory(factoryclass, baseclassloader, contextclassloader);\n\n                // todo: think about whether we need to handle exceptions from newfactory\n            } else {\n                if (isdiagnosticsenabled()) {\n                    logdiagnostic("[lookup] properties file has no entry specifying logfactory subclass.");\n                }\n            }\n        } else {\n            if (isdiagnosticsenabled()) {\n                logdiagnostic("[lookup] no properties file available to determine" + " logfactory subclass from..");\n            }\n        }\n    }\n\n    // factoryorg.apache.commons.logging.impl.logfactoryimpl\n    // fourth, try the fallback implementation class\n\n    if (factory == null) {\n        if (isdiagnosticsenabled()) {\n            logdiagnostic(\n                    "[lookup] loading the default logfactory implementation \'" + factory_default +\n                            "\' via the same classloader that loaded this logfactory" +\n                            " class (ie not looking in the context classloader).");\n        }\n\n        // note: unlike the above code which can try to load custom logfactory\n        // implementations via the tccl, we don\'t try to load the default logfactory\n        // implementation via the context classloader because:\n        // * that can cause problems (see comments in newfactory method)\n        // * no-one should be customising the code of the default class\n        // yes, we do give up the ability for the child to ship a newer\n        // version of the logfactoryimpl class and have it used dynamically\n        // by an old logfactory class in the parent, but that isn\'t\n        // necessarily a good idea anyway.\n        factory = newfactory(factory_default, thisclassloader, contextclassloader);\n    }\n\n    if (factory != null) {\n        /**\n            * always cache using context class loader.\n            */\n        cachefactory(contextclassloader, factory);\n\n        if (props != null) {\n            enumeration names = props.propertynames();\n            while (names.hasmoreelements()) {\n                string name = (string) names.nextelement();\n                string value = props.getproperty(name);\n                factory.setattribute(name, value);\n            }\n        }\n    }\n\n    return factory;\n}\n\n\nlogfactory\n\n * vmorg.apache.commons.logging.logfactory\n * spiorg.apache.commons.logging.logfactory\n * classpathcommons-logging.propertiesorg.apache.commons.logging.logfactoryfactory\n * factoryorg.apache.commons.logging.impl.logfactoryimpl\n\n> logfactorygetlog()org.apache.commons.logging.logtracefatalorg.apache.commons.logging.logfactorylog\n\n\n# spi - \n\n> spieclipse\n\neclipseosgi\n\n\n\n * meta-inf/manifest.mf: \n * build.properties: \n * plugin.xml\n\neclipsepluginsmanifest.mf\n\neclipseeclipsespi\n\n\n# spi - springspi\n\nspringbootmeta-inf/spring.factoriesspringfactoriesloaderclasspathjarmeta-inf/spring.factoriespropertiesclasspathjarclasspathjar\n\npublic static final string factories_resource_location = "meta-inf/spring.factories";\n// spring.factorieskey=value1,value2,value3\n// jarmeta-inf/spring.factories\n// key=factoryclassvalue\npublic static list<string> loadfactorynames(class<?> factoryclass, classloader classloader) {\n    string factoryclassname = factoryclass.getname();\n    // url\n    enumeration<url> urls = (classloader != null ? classloader.getresources(factories_resource_location) : classloader.getsystemresources(factories_resource_location));\n    list<string> result = new arraylist<string>();\n    // url\n    while (urls.hasmoreelements()) {\n        url url = urls.nextelement();\n        // urlproperties@configuration\n        properties properties = propertiesloaderutils.loadproperties(new urlresource(url));\n        string factoryclassnames = properties.getproperty(factoryclassname);\n        // \n        result.addall(arrays.aslist(stringutils.commadelimitedlisttostringarray(factoryclassnames)));\n    }\n    return result;\n}\n\n\n\n# spi\n\n\n# spi\n\n\n\n * \n * \n * \n\n# \n\njava.sql.driver\n\n# \n\n\n\nmeta-inf/servicesjava.sql.driverme.cxis.sql.mydriver\n\nme.cxis.sql.mydriverdriver\n\n# \n\njar\n\nserviceloader<driver> loadeddrivers = serviceloader.load(driver.class);\n//\niterator<driver> driversiterator = loadeddrivers.iterator();\n//\nwhile(driversiterator.hasnext()) {\n    driversiterator.next();\n    //\n}\n\n\n# \n\njdk spi\n\n\n\n\n# spiapi\n\n> spiapiapispi\n\n> spi - \n\n * \n * \n * \n * \n\n> api - \n\n * \n * \n * \n\n\n\n * difference-between-spi-and-api\n *  spi  api\n\n\n\n\n\n\n# spi\n\njdkserviceloader<s>\n\n//serviceloaderiterable\npublic final class serviceloader<s>\n    implements iterable<s>\n{\n\n    //\n    private static final string prefix = "meta-inf/services/";\n\n    //\n    private final class<s> service;\n\n    //classloader\n    private final classloader loader;\n\n    // \n    private final accesscontrolcontext acc;\n\n    // \n    private linkedhashmap<string,s> providers = new linkedhashmap<>();\n\n    // \n    private lazyiterator lookupiterator;\n\n\n    //serviceloaderjava\n    public void reload() {\n        //\n        providers.clear();\n        //\n        lookupiterator = new lazyiterator(service, loader);\n    }\n\n    //\n    //\n    //\n    private serviceloader(class<s> svc, classloader cl) {\n        service = objects.requirenonnull(svc, "service interface cannot be null");\n        loader = (cl == null) ? classloader.getsystemclassloader() : cl;\n        acc = (system.getsecuritymanager() != null) ? accesscontroller.getcontext() : null;\n        reload();\n    }\n\n    //\n    private static void fail(class<?> service, string msg, throwable cause)\n        throws serviceconfigurationerror\n    {\n        throw new serviceconfigurationerror(service.getname() + ": " + msg,\n                                            cause);\n    }\n\n    private static void fail(class<?> service, string msg)\n        throws serviceconfigurationerror\n    {\n        throw new serviceconfigurationerror(service.getname() + ": " + msg);\n    }\n\n    private static void fail(class<?> service, url u, int line, string msg)\n        throws serviceconfigurationerror\n    {\n        fail(service, u + ":" + line + ": " + msg);\n    }\n\n    //\n    //\n    //\n    //\n    private int parseline(class<?> service, url u, bufferedreader r, int lc,\n                          list<string> names)\n        throws ioexception, serviceconfigurationerror\n    {\n        //\n        string ln = r.readline();\n        if (ln == null) {\n            return -1;\n        }\n        //#\n        int ci = ln.indexof(\'#\');\n        if (ci >= 0) ln = ln.substring(0, ci);\n        ln = ln.trim();\n        int n = ln.length();\n        if (n != 0) {\n            if ((ln.indexof(\' \') >= 0) || (ln.indexof(\'\\t\') >= 0))\n                fail(service, u, lc, "illegal configuration-file syntax");\n            int cp = ln.codepointat(0);\n            if (!character.isjavaidentifierstart(cp))\n                fail(service, u, lc, "illegal provider-class name: " + ln);\n            for (int i = character.charcount(cp); i < n; i += character.charcount(cp)) {\n                cp = ln.codepointat(i);\n                if (!character.isjavaidentifierpart(cp) && (cp != \'.\'))\n                    fail(service, u, lc, "illegal provider-class name: " + ln);\n            }\n            if (!providers.containskey(ln) && !names.contains(ln))\n                names.add(ln);\n        }\n        return lc + 1;\n    }\n\n    //url\n    //parseline\n    private iterator<string> parse(class<?> service, url u)\n        throws serviceconfigurationerror\n    {\n        inputstream in = null;\n        bufferedreader r = null;\n        arraylist<string> names = new arraylist<>();\n        try {\n            in = u.openstream();\n            r = new bufferedreader(new inputstreamreader(in, "utf-8"));\n            int lc = 1;\n            while ((lc = parseline(service, u, r, lc, names)) >= 0);\n        }\n        return names.iterator();\n    }\n\n    //\n    private class lazyiterator\n        implements iterator<s>\n    {\n\n        class<s> service;//\n        classloader loader;//\n        enumeration<url> configs = null;//url\n        iterator<string> pending = null;//\n        string nextname = null;//\n\n        private lazyiterator(class<s> service, classloader loader) {\n            this.service = service;\n            this.loader = loader;\n        }\n\n        private boolean hasnextservice() {\n            if (nextname != null) {\n                return true;\n            }\n            if (configs == null) {\n                try {\n                    string fullname = prefix + service.getname();\n                    if (loader == null)\n                        configs = classloader.getsystemresources(fullname);\n                    else\n                        configs = loader.getresources(fullname);\n                }\n            }\n            while ((pending == null) || !pending.hasnext()) {\n                if (!configs.hasmoreelements()) {\n                    return false;\n                }\n                pending = parse(service, configs.nextelement());\n            }\n            nextname = pending.next();\n            return true;\n        }\n\n        private s nextservice() {\n            if (!hasnextservice())\n                throw new nosuchelementexception();\n            string cn = nextname;\n            nextname = null;\n            class<?> c = null;\n            try {\n                c = class.forname(cn, false, loader);\n            }\n            if (!service.isassignablefrom(c)) {\n                fail(service, "provider " + cn  + " not a subtype");\n            }\n            try {\n                s p = service.cast(c.newinstance());\n                providers.put(cn, p);\n                return p;\n            }\n        }\n\n        public boolean hasnext() {\n            if (acc == null) {\n                return hasnextservice();\n            } else {\n                privilegedaction<boolean> action = new privilegedaction<boolean>() {\n                    public boolean run() { return hasnextservice(); }\n                };\n                return accesscontroller.doprivileged(action, acc);\n            }\n        }\n\n        public s next() {\n            if (acc == null) {\n                return nextservice();\n            } else {\n                privilegedaction<s> action = new privilegedaction<s>() {\n                    public s run() { return nextservice(); }\n                };\n                return accesscontroller.doprivileged(action, acc);\n            }\n        }\n\n        public void remove() {\n            throw new unsupportedoperationexception();\n        }\n\n    }\n\n    //\n    //\n    //\n    //\n    public iterator<s> iterator() {\n        return new iterator<s>() {\n            //\n            iterator<map.entry<string,s>> knownproviders\n                = providers.entryset().iterator();\n\n            public boolean hasnext() {\n                if (knownproviders.hasnext())\n                    return true;\n                return lookupiterator.hasnext();\n            }\n\n            public s next() {\n                if (knownproviders.hasnext())\n                    return knownproviders.next().getvalue();\n                return lookupiterator.next();\n            }\n\n            public void remove() {\n                throw new unsupportedoperationexception();\n            }\n\n        };\n    }\n\n    //serviceloader\n    public static <s> serviceloader<s> load(class<s> service,\n                                            classloader loader)\n    {\n        return new serviceloader<>(service, loader);\n    }\n\n    //serviceloader\n    public static <s> serviceloader<s> load(class<s> service) {\n        classloader cl = thread.currentthread().getcontextclassloader();\n        return serviceloader.load(service, cl);\n    }\n\n    //serviceloader\n    //java\n    public static <s> serviceloader<s> loadinstalled(class<s> service) {\n        classloader cl = classloader.getsystemclassloader();\n        classloader prev = null;\n        while (cl != null) {\n            prev = cl;\n            cl = cl.getparent();\n        }\n        return serviceloader.load(service, prev);\n    }\n\n    public string tostring() {\n        return "java.util.serviceloader[" + service.getname() + "]";\n    }\n\n}\n\n\nserviceloaderiterablehasnextnextlookupiteratorhasnextnextlookupiterator\n\nlazyiteratorhasnextprefixmeta-inf/services/classpathmeta-inf/services/\n\nclass.forname()newinstanceproviders(linkedhashmap<string,s>\n\nserviceloaderhasnextnext\n\nreload\n\n\n# spi\n\nspi\n\n * \n\n *  iterator \n\n *  serviceloader \n\n\n# \n\n * https://cxis.me/2017/04/17/java%e4%b8%adspi%e6%9c%ba%e5%88%b6%e6%b7%b1%e5%85%a5%e5%8f%8a%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90/\n * https://stackoverflow.com/questions/2954372/difference-between-spi-and-api?answertab=votes#tab-top\n * https://zhuanlan.zhihu.com/p/28909673\n * http://blog.itpub.net/69912579/viewspace-2656555/\n * https://www.cnblogs.com/happyframework/archive/2013/09/17/3325560.html\n * https://blog.csdn.net/sakurainluojia/article/details/53534949\n * https://www.jianshu.com/p/0d196ad23915\n *  https://www.pdai.tech/md/java/advanced/java-advanced-spi.html',charsets:{cjk:!0}},{title:"Java  -  & Q/A",frontmatter:{},regularPath:"/java/basic/java-basic-lan-sum.html",relativePath:"java/basic/java-basic-lan-sum.md",key:"v-24391208",path:"/java/basic/java-basic-lan-sum.html",headers:[{level:2,title:"Java  -  & Q/A",slug:"java---q-a",normalizedTitle:"java  -  &amp; q/a",charIndex:null},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:85},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:35},{level:2,title:"Q&A",slug:"q-a",normalizedTitle:"q&amp;a",charIndex:null},{level:3,title:"Java ?",slug:"java-",normalizedTitle:"java ?",charIndex:116},{level:3,title:" byte  String?",slug:"-byte--string",normalizedTitle:" byte  string?",charIndex:146},{level:3,title:"Java  bytes  long ?",slug:"java--bytes--long-",normalizedTitle:"java  bytes  long ?",charIndex:174},{level:3,title:" int  byte ?  byte ?",slug:"-int--byte---byte--",normalizedTitle:" int  byte ?  byte ?",charIndex:210},{level:3,title:"B  AC  B B  C ?  C = (C) B",slug:"-b--a-c--b--b--c---c-c-b",normalizedTitle:"b  ac  b b  c ?  c = (c) b",charIndex:273},{level:3,title:" clone ?  Cloneable  Object?",slug:"-clone---cloneable--object",normalizedTitle:" clone ?  cloneable  object?",charIndex:329},{level:3,title:"Java  ++ ?",slug:"java--",normalizedTitle:"java  ++ ?",charIndex:375},{level:3,title:"a = a + b  a += b ",slug:"a-a-b--a-b-",normalizedTitle:"a = a + b  a += b ",charIndex:404},{level:3,title:" double  long ?",slug:"-double--long-",normalizedTitle:" double  long ?",charIndex:434},{level:3,title:"3*0.1 == 0.3 ? true  false?",slug:"_3-0-1-0-3--true--false",normalizedTitle:"3*0.1 == 0.3 ? true  false?",charIndex:484},{level:3,title:"int  Integer ?",slug:"int--integer-",normalizedTitle:"int  integer ?",charIndex:527},{level:3,title:" Java  String (Immutable)?",slug:"-java--string--immutable",normalizedTitle:" java  string (immutable)?",charIndex:560},{level:3,title:" Switch  String ?",slug:"-switch--string-",normalizedTitle:" switch  string ?",charIndex:604},{level:3,title:"Java ?",slug:"java-",normalizedTitle:"java ?",charIndex:637},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:660},{level:3,title:"(immutable object)? Java ?",slug:"-immutable-object-java-",normalizedTitle:"(immutable object)? java ?",charIndex:671},{level:3,title:"?",slug:"",normalizedTitle:"?",charIndex:725},{level:3,title:" hashcode?",slug:"-hashcode",normalizedTitle:" hashcode?",charIndex:754},{level:3,title:" hash code ?",slug:"-hash-code-",normalizedTitle:" hash code ?",charIndex:789},{level:3,title:" hashcode() ?",slug:"-hashcode-",normalizedTitle:" hashcode() ?",charIndex:822},{level:3,title:"Java Comparator  Comparable ?",slug:"java--comparator--comparable-",normalizedTitle:"java comparator  comparable ?",charIndex:856},{level:3,title:" equals  hashCode ?",slug:"-equals--hashcode-",normalizedTitle:" equals  hashcode ?",charIndex:901},{level:3,title:"a==ba.equals(b)?",slug:"a-b--a-equals-b-",normalizedTitle:"a==ba.equals(b)?",charIndex:945},{level:3,title:"a.hashCode() ?  a.equals(b) ?",slug:"a-hashcode---a-equals-b-",normalizedTitle:"a.hashcode() ?  a.equals(b) ?",charIndex:979},{level:3,title:"finalfinalize  finally ?",slug:"finalfinalize--finally-",normalizedTitle:"finalfinalize  finally ?",charIndex:1026},{level:3,title:"Java ? ?",slug:"java--",normalizedTitle:"java ? ?",charIndex:1065},{level:3,title:"?",slug:"",normalizedTitle:"?",charIndex:1099},{level:3,title:"Java Serializable  Externalizable ?",slug:"java--serializable--externalizable-",normalizedTitle:"java serializable  externalizable ?",charIndex:1122},{level:3,title:" JDK 1.7 ?",slug:"-jdk-1-7-",normalizedTitle:" jdk 1.7 ?",charIndex:1171},{level:3,title:" 5  JDK 1.8 ?",slug:"-5--jdk-1-8-",normalizedTitle:" 5  jdk 1.8 ?",charIndex:1198},{level:3,title:"? ?",slug:"-",normalizedTitle:"? ?",charIndex:1228},{level:3,title:"Java ?",slug:"java--",normalizedTitle:"java ?",charIndex:1262},{level:3,title:"Object?",slug:"object",normalizedTitle:"object?",charIndex:1291},{level:3,title:"equals==",slug:"equals-",normalizedTitle:"equals==",charIndex:1313},{level:3,title:"StringStringBufferStringBuilder",slug:"stringstringbufferstringbuilder",normalizedTitle:"stringstringbufferstringbuilder",charIndex:1333},{level:3,title:"switchString",slug:"switchstring",normalizedTitle:"switchstring",charIndex:1377},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1403},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1417},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1432},{level:3,title:"finally",slug:"finally",normalizedTitle:"finally",charIndex:1442},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1459},{level:3,title:"super",slug:"super",normalizedTitle:"super",charIndex:1478},{level:3,title:"this() & super()",slug:"this-super-",normalizedTitle:"this() &amp; super()",charIndex:null},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1541},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1562},{level:3,title:"Java",slug:"java",normalizedTitle:"java",charIndex:1573},{level:3,title:"&",slug:"-",normalizedTitle:"&amp;",charIndex:null},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1603},{level:3,title:"Java",slug:"java",normalizedTitle:"java",charIndex:1622}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -  & Q/A   Q&A Java ?  byte  String? Java  bytes  long ?  int  byte ?  byte ? B  AC  B B  C ?  C = (C) B  clone ?  Cloneable  Object? Java  ++ ? a = a + b  a += b   double  long ? 3*0.1 == 0.3 ? true  false? int  Integer ?  Java  String (Immutable)?  Switch  String ? Java ?  (immutable object)? Java ? ?  hashcode?  hash code ?  hashcode() ? Java Comparator  Comparable ?  equals  hashCode ? a==ba.equals(b)? a.hashCode() ?  a.equals(b) ? finalfinalize  finally ? Java ? ? ? Java Serializable  Externalizable ?  JDK 1.7 ?  5  JDK 1.8 ? ? ? Java ? Object? equals== StringStringBufferStringBuilder switchString    finally  super this() & super()   Java &  Java",content:"# Java  -  & Q/A\n\n> JavaQ&A\n\n * Java  -  & Q/A\n   * \n   * \n   * Q&A\n     * Java ?\n     *  byte  String?\n     * Java  bytes  long ?\n     *  int  byte ?  byte ?\n     * B  AC  B B  C ?  C = (C) B\n     *  clone ?  Cloneable  Object?\n     * Java  ++ ?\n     * a = a + b  a += b \n     *  double  long ?\n     * 3*0.1 == 0.3 ? true  false?\n     * int  Integer ?\n     *  Java  String (Immutable)?\n     *  Switch  String ?\n     * Java ?\n     * \n     * (immutable object)? Java ?\n     * ?\n     *  hashcode?\n     *  hash code ?\n     *  hashcode() ?\n     * Java Comparator  Comparable ?\n     *  equals  hashCode ?\n     * a==ba.equals(b)?\n     * a.hashCode() ?  a.equals(b) ?\n     * finalfinalize  finally ?\n     * Java ? ?\n     * ?\n     * Java Serializable  Externalizable ?\n     *  JDK 1.7 ?\n     *  5  JDK 1.8 ?\n     * ? ?\n     * Java ?\n     * Object?\n     * equals==\n     * StringStringBufferStringBuilder\n     * switchString\n     * \n     * \n     * \n     * finally\n     * \n     * super\n     * this() & super()\n     * \n     * \n     * Java\n     * &\n     * \n     * Java\n\n\n# \n\n * Thinking in Java (Java ) Gitbook https://java.quanke.name/\n * Thinking in Java (Java ) Github https://github.com/quanke/think-in-java\n * Thinking in Java (Java ) Gitbook2 https://www.gitbook.com/book/wizardforcel/thinking-in-java/details\n *  https://www.pdai.tech/md/java/basic/java-basic-lan-sum.html\n\n\n# \n\n\n\n\n# Q&A\n\n\n# Java ?\n\nBigDecimal double \n\n\n#  byte  String?\n\n String  byte[] \n\n\n# Java  bytes  long ?\n\nStringbytesStringLong.parseLong\n\n\n#  int  byte ?  byte ?\n\n Java  int  32  byte  8 int  24 byte  -128  127\n\n\n# B  AC  B B  C ?  C = (C) B\n\n.\n\n\n#  clone ?  Cloneable  Object?\n\njava.lang.Cloneable clone  object  clone()  c  c++  \n\n\n# Java  ++ ?\n\n(--)\n\n\n# a = a + b  a += b \n\n+=  byteshort  int int \n\nbyte a = 127;\nbyte b = 127;\nb = a + b; // error : cannot convert from int to byte\nb += a; // ok\n\n\n( a+b  ab  int  int  byte )\n\n\n#  double  long ?\n\n double  long  double  long \n\n\n# 3*0.1 == 0.3 ? true  false?\n\nfalse\n\n\n# int  Integer ?\n\nInteger Integer  int \n\n\n#  Java  String (Immutable)?\n\nJava  String  Java \n\n\n#  Switch  String ?\n\n Java 7  switch case  switch  hash code\n\n\n# Java ?\n\nJava \n\n\n# \n\nJDK1.5 \n\n\n# (immutable object)? Java ?\n\n StringInteger\n\nJavaImmutable?\n\n:\n\n1)immutable\n\n2)Immutablefinal\n\n3): (leak)\n\n4)finalimmutable\n\n5)mutable()\n\n\n# ?\n\n\n\n\n#  hashcode?\n\n hashcode  hashmap  hashcode hashcode \n\n\n#  hash code ?\n\n hash code \n\n\n#  hashcode() ?\n\n hashcode \n\n\n# Java Comparator  Comparable ?\n\nComparable  comparator Comparable  comparator \n\n\n#  equals  hashCode ?\n\n hashcode  equals  HashMapHashSet  hashcode  equals \n\n\n# a==ba.equals(b)?\n\n a  b  a==b  a  b  true a.equals(b) String  equals() \n\n\n# a.hashCode() ?  a.equals(b) ?\n\n: hashCode()  hash  hash  HashtableHashMapLinkedHashMap equals()  Java  equals()  hash code\n\n1hashcode\n\nListSetSet? equals? hashcodehashcode\n\n2hashcode\n\nListhashmap, hashset, hashtable\n\n3equals\n\n *  x.equals(y)truey.equals(x)true\n *  x.equals(x)true\n *  x.equals(y)true,y.equals(z)true,x.equals(z)true\n *  x,y\n *  x.equals(null) falsex.equals(x)false\n\n\n# finalfinalize  finally ?\n\n * final  final \n * Java  finalize()  finalize \n * finally  try  catch finally  try \n\n\n# Java ? ?\n\n public jar JAR \n\n\n# ?\n\n HashMap.Entry HashMap Entry\n\n\n# Java Serializable  Externalizable ?\n\nSerializable  Java  JVM Externalizable \n\n\n#  JDK 1.7 ?\n\n JDK 1.7  JDK 5  8  try-with-resource Java Fork-Join  Java  Map-reduce Switch  String (<>) catch \n\n\n#  5  JDK 1.8 ?\n\nJava 8  Java  JDK 8  5 : Lambda  Stream API CPU Date  Time API  \n\n Java  SOLID OOP  GOF \n\n\n# ? ?\n\n API List  ArrayList LinkedList Java 8 \n\n\n# Java ?\n\nJava  Java  \n\n\n# Object?\n\nclone equals hashcode wait notify notifyall finalize toString getClass clonefinalize\n\n11wait\n\n\n# equals==\n\n1. == equalsObject\n\n2. \n\n * : ==equals\n * ==equals true falseequals\n\n\n# StringStringBufferStringBuilder\n\n: StringStringBufferStringBuilderStringStringStringBufferStringBuilderString\n\n: StringfinalimmutableStringBuilderStringBufferStringBuilderStringBufferStringBuilder\n\n\n# switchString\n\nJava1.7Javabyteshortintswitchboolean\n\n\n# \n\n * , \n * , \n * , \n * , public static final()\n * , JDK8JDK8defaultJDK9\n * JDK8JDK8\n * publicprotected; JDK8public abstractJDK8defaultJDK9private\n\n\n# \n\n, \n\n, ()\n\n\n# \n\n throwthrowstry...catchfinally\n\n * throws , \n * throw throw\n * try , , catchcatch\n\n\n# finally\n\n * finally\n * trycatchreturnfinallyfinallyreturn\n * , finallyreturn\n * finallyreturn(finally)finally\n\n: finallyreturntrycatch\n\nfinally: System.exit, \n\n\n# \n\n * (checked exceptions),try...catch, throws,Checked ExceptionJava, Java, \n\nchecked exception: ClassNotFoundException IOException FileNotFoundException EOFException\n\n * (runtime exceptions), ,,0...\n\nruntime exception: NullPointerException ArithmeticException ClassCastException IllegalArgumentException IllegalStateException IndexOutOfBoundsException NoSuchElementException\n\n * ErrorError\n\n\n# super\n\n * super.xxx(xxx)xxx\n * super.xxx(); (xxx)\n * super() \n\n: super\n\n\n# this() & super()\n\n * super(), \n * super, this\n * this, 2\n * thissuper, \n * this()super(),static\n * thissuper\n\n\n# \n\npublic class Enclosingone {\n\tpublic class Insideone {}\n\tpublic static class Insideone{}\n}\n\npublic class Test {\n\tpublic static void main(String[] args) {\n\t// \n\tEnclosingone.Insideone obj1 = new Enclosingone().new Insideone();\n\t// \n\tEnclosingone.Insideone obj2 = new Enclosingone.Insideone();\n\t}\n}\n\n\n\n\n\n# \n\nstatictransient \n\n\n# Java\n\njava\n\n * << :,x << 1,x2(),0\n * >> :,x >> 1,x2,0,1\n * >>> :,,0\n\n\n# &\n\nlocal variable. finalfinal: final ()\n\n\n# \n\n\n\n\n# Java\n\nJavaJavaJava",normalizedContent:"# java  -  & q/a\n\n> javaq&a\n\n * java  -  & q/a\n   * \n   * \n   * q&a\n     * java ?\n     *  byte  string?\n     * java  bytes  long ?\n     *  int  byte ?  byte ?\n     * b  ac  b b  c ?  c = (c) b\n     *  clone ?  cloneable  object?\n     * java  ++ ?\n     * a = a + b  a += b \n     *  double  long ?\n     * 3*0.1 == 0.3 ? true  false?\n     * int  integer ?\n     *  java  string (immutable)?\n     *  switch  string ?\n     * java ?\n     * \n     * (immutable object)? java ?\n     * ?\n     *  hashcode?\n     *  hash code ?\n     *  hashcode() ?\n     * java comparator  comparable ?\n     *  equals  hashcode ?\n     * a==ba.equals(b)?\n     * a.hashcode() ?  a.equals(b) ?\n     * finalfinalize  finally ?\n     * java ? ?\n     * ?\n     * java serializable  externalizable ?\n     *  jdk 1.7 ?\n     *  5  jdk 1.8 ?\n     * ? ?\n     * java ?\n     * object?\n     * equals==\n     * stringstringbufferstringbuilder\n     * switchstring\n     * \n     * \n     * \n     * finally\n     * \n     * super\n     * this() & super()\n     * \n     * \n     * java\n     * &\n     * \n     * java\n\n\n# \n\n * thinking in java (java ) gitbook https://java.quanke.name/\n * thinking in java (java ) github https://github.com/quanke/think-in-java\n * thinking in java (java ) gitbook2 https://www.gitbook.com/book/wizardforcel/thinking-in-java/details\n *  https://www.pdai.tech/md/java/basic/java-basic-lan-sum.html\n\n\n# \n\n\n\n\n# q&a\n\n\n# java ?\n\nbigdecimal double \n\n\n#  byte  string?\n\n string  byte[] \n\n\n# java  bytes  long ?\n\nstringbytesstringlong.parselong\n\n\n#  int  byte ?  byte ?\n\n java  int  32  byte  8 int  24 byte  -128  127\n\n\n# b  ac  b b  c ?  c = (c) b\n\n.\n\n\n#  clone ?  cloneable  object?\n\njava.lang.cloneable clone  object  clone()  c  c++  \n\n\n# java  ++ ?\n\n(--)\n\n\n# a = a + b  a += b \n\n+=  byteshort  int int \n\nbyte a = 127;\nbyte b = 127;\nb = a + b; // error : cannot convert from int to byte\nb += a; // ok\n\n\n( a+b  ab  int  int  byte )\n\n\n#  double  long ?\n\n double  long  double  long \n\n\n# 3*0.1 == 0.3 ? true  false?\n\nfalse\n\n\n# int  integer ?\n\ninteger integer  int \n\n\n#  java  string (immutable)?\n\njava  string  java \n\n\n#  switch  string ?\n\n java 7  switch case  switch  hash code\n\n\n# java ?\n\njava \n\n\n# \n\njdk1.5 \n\n\n# (immutable object)? java ?\n\n stringinteger\n\njavaimmutable?\n\n:\n\n1)immutable\n\n2)immutablefinal\n\n3): (leak)\n\n4)finalimmutable\n\n5)mutable()\n\n\n# ?\n\n\n\n\n#  hashcode?\n\n hashcode  hashmap  hashcode hashcode \n\n\n#  hash code ?\n\n hash code \n\n\n#  hashcode() ?\n\n hashcode \n\n\n# java comparator  comparable ?\n\ncomparable  comparator comparable  comparator \n\n\n#  equals  hashcode ?\n\n hashcode  equals  hashmaphashset  hashcode  equals \n\n\n# a==ba.equals(b)?\n\n a  b  a==b  a  b  true a.equals(b) string  equals() \n\n\n# a.hashcode() ?  a.equals(b) ?\n\n: hashcode()  hash  hash  hashtablehashmaplinkedhashmap equals()  java  equals()  hash code\n\n1hashcode\n\nlistsetset? equals? hashcodehashcode\n\n2hashcode\n\nlisthashmap, hashset, hashtable\n\n3equals\n\n *  x.equals(y)truey.equals(x)true\n *  x.equals(x)true\n *  x.equals(y)true,y.equals(z)true,x.equals(z)true\n *  x,y\n *  x.equals(null) falsex.equals(x)false\n\n\n# finalfinalize  finally ?\n\n * final  final \n * java  finalize()  finalize \n * finally  try  catch finally  try \n\n\n# java ? ?\n\n public jar jar \n\n\n# ?\n\n hashmap.entry hashmap entry\n\n\n# java serializable  externalizable ?\n\nserializable  java  jvm externalizable \n\n\n#  jdk 1.7 ?\n\n jdk 1.7  jdk 5  8  try-with-resource java fork-join  java  map-reduce switch  string (<>) catch \n\n\n#  5  jdk 1.8 ?\n\njava 8  java  jdk 8  5 : lambda  stream api cpu date  time api  \n\n java  solid oop  gof \n\n\n# ? ?\n\n api list  arraylist linkedlist java 8 \n\n\n# java ?\n\njava  java  \n\n\n# object?\n\nclone equals hashcode wait notify notifyall finalize tostring getclass clonefinalize\n\n11wait\n\n\n# equals==\n\n1. == equalsobject\n\n2. \n\n * : ==equals\n * ==equals true falseequals\n\n\n# stringstringbufferstringbuilder\n\n: stringstringbufferstringbuilderstringstringstringbufferstringbuilderstring\n\n: stringfinalimmutablestringbuilderstringbufferstringbuilderstringbufferstringbuilder\n\n\n# switchstring\n\njava1.7javabyteshortintswitchboolean\n\n\n# \n\n * , \n * , \n * , \n * , public static final()\n * , jdk8jdk8defaultjdk9\n * jdk8jdk8\n * publicprotected; jdk8public abstractjdk8defaultjdk9private\n\n\n# \n\n, \n\n, ()\n\n\n# \n\n throwthrowstry...catchfinally\n\n * throws , \n * throw throw\n * try , , catchcatch\n\n\n# finally\n\n * finally\n * trycatchreturnfinallyfinallyreturn\n * , finallyreturn\n * finallyreturn(finally)finally\n\n: finallyreturntrycatch\n\nfinally: system.exit, \n\n\n# \n\n * (checked exceptions),try...catch, throws,checked exceptionjava, java, \n\nchecked exception: classnotfoundexception ioexception filenotfoundexception eofexception\n\n * (runtime exceptions), ,,0...\n\nruntime exception: nullpointerexception arithmeticexception classcastexception illegalargumentexception illegalstateexception indexoutofboundsexception nosuchelementexception\n\n * errorerror\n\n\n# super\n\n * super.xxx(xxx)xxx\n * super.xxx(); (xxx)\n * super() \n\n: super\n\n\n# this() & super()\n\n * super(), \n * super, this\n * this, 2\n * thissuper, \n * this()super(),static\n * thissuper\n\n\n# \n\npublic class enclosingone {\n\tpublic class insideone {}\n\tpublic static class insideone{}\n}\n\npublic class test {\n\tpublic static void main(string[] args) {\n\t// \n\tenclosingone.insideone obj1 = new enclosingone().new insideone();\n\t// \n\tenclosingone.insideone obj2 = new enclosingone.insideone();\n\t}\n}\n\n\n\n\n\n# \n\nstatictransient \n\n\n# java\n\njava\n\n * << :,x << 1,x2(),0\n * >> :,x >> 1,x2,0,1\n * >>> :,,0\n\n\n# &\n\nlocal variable. finalfinal: final ()\n\n\n# \n\n\n\n\n# java\n\njavajavajava",charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-oop.html",relativePath:"java/basic/java-basic-oop.md",key:"v-7989f230",path:"/java/basic/java-basic-oop.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:72},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:84},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:94},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:104},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:44},{level:3,title:" (Generalization)",slug:"-generalization",normalizedTitle:" (generalization)",charIndex:122},{level:3,title:" (Realization)",slug:"-realization",normalizedTitle:" (realization)",charIndex:151},{level:3,title:" (Aggregation)",slug:"-aggregation",normalizedTitle:" (aggregation)",charIndex:177},{level:3,title:" (Composition)",slug:"-composition",normalizedTitle:" (composition)",charIndex:203},{level:3,title:" (Association)",slug:"-association",normalizedTitle:" (association)",charIndex:229},{level:3,title:" (Dependency)",slug:"-dependency",normalizedTitle:" (dependency)",charIndex:255},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:278}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -        (Generalization)  (Realization)  (Aggregation)  (Composition)  (Association)  (Dependency) ",content:'# Java  - \n\n> Java OOP \n\n * Java  - \n   * \n     * \n     * \n     * \n   * \n     *  (Generalization)\n     *  (Realization)\n     *  (Aggregation)\n     *  (Composition)\n     *  (Association)\n     *  (Dependency)\n   * \n\n\n# \n\n\n# \n\n\n\n:\n\n * : \n * : \n * : \n * \n * : \n\n Person  namegenderage  get()  Person  name  gender  age  age  work() \n\n gender  int  gender \n\npublic class Person {\n\n    private String name;\n    private int gender;\n    private int age;\n\n    public String getName() {\n        return name;\n    }\n\n    public String getGender() {\n        return gender == 0 ? "man" : "woman";\n    }\n\n    public void work() {\n        if (18 <= age && age <= 50) {\n            System.out.println(name + " is working very hard!");\n        } else {\n            System.out.println(name + " can\'t work any more!");\n        }\n    }\n}\n\n\n\n# \n\n IS-A  Cat  Animal  IS-A  Cat  Animal Animal  private \n\n\n\nCat  Animal  Animal  Cat   \n\nAnimal animal = new Cat();\n\n\n\n# \n\n:\n\n * \n * \n\n:\n\n * \n * ()\n * \n\n(Instrument): Wind  Percussion play()  main()  Instrument  Wind  Percussion  Instrument  play()  play()  Instrument \n\npublic class Instrument {\n    public void play() {\n        System.out.println("Instrument is playing...");\n    }\n}\n\npublic class Wind extends Instrument {\n    public void play() {\n        System.out.println("Wind is playing...");\n    }\n}\n\npublic class Percussion extends Instrument {\n    public void play() {\n        System.out.println("Percussion is playing...");\n    }\n}\n\npublic class Music {\n    public static void main(String[] args) {\n        List<Instrument> instruments = new ArrayList<>();\n        instruments.add(new Wind());\n        instruments.add(new Percussion());\n        for(Instrument instrument : instruments) {\n            instrument.play();\n        }\n    }\n}\n\n\n\n# \n\n PlantUML : http://plantuml.com/ \n\n\n#  (Generalization)\n\n Java  extends \n\n\n\n@startuml\n\ntitle Generalization\n\nclass Vehical\nclass Car\nclass Truck\n\nVehical <|-- Car\nVehical <|-- Truck\n\n@enduml\n\n\n\n#  (Realization)\n\n Java  implements \n\n\n\n@startuml\n\ntitle Realization\n\ninterface MoveBehavior\nclass Fly\nclass Run\n\nMoveBehavior <|.. Fly\nMoveBehavior <|.. Run\n\n@enduml\n\n\n\n#  (Aggregation)\n\n\n\n\n\n@startuml\n\ntitle Aggregation\n\nclass Computer\nclass Keyboard\nclass Mouse\nclass Screen\n\nComputer o-- Keyboard\nComputer o-- Mouse\nComputer o-- Screen\n\n@enduml\n\n\n\n#  (Composition)\n\n\n\n\n\n@startuml\n\ntitle Composition\n\nclass Company\nclass DepartmentA\nclass DepartmentB\n\nCompany *-- DepartmentA\nCompany *-- DepartmentB\n\n@enduml\n\n\n\n#  (Association)\n\n 1  1 1\n\n\n\n@startuml\n\ntitle Association\n\nclass School\nclass Student\n\nSchool "1" - "n" Student\n\n@enduml\n\n\n\n#  (Dependency)\n\nA  B :\n\n * A  B ()\n * A  B \n * A  B  B \n\n\n\n@startuml\n\ntitle Dependency\n\nclass Vehicle {\n    move(MoveBehavior)\n}\n\ninterface MoveBehavior {\n    move()\n}\n\nnote "MoveBehavior.move()" as N\n\nVehicle ..> MoveBehavior\n\nVehicle .. N\n\n@enduml\n\n\n\n# \n\n * Java \n\n * : \n\n *  SOLID \n\n *  UML \n\n * UML ()sequence diagram\n\n *  ------ \n\n * javaoop https://blog.csdn.net/weixin_38173324/article/details/70037927\n\n * JavaOOP() https://www.cnblogs.com/AlanLee/p/6475334.html\n\n * Java oop http://www.cnblogs.com/wujing-hubei/p/6012105.html\n\n *  https://www.pdai.tech/md/java/basic/java-basic-oop.html',normalizedContent:'# java  - \n\n> java oop \n\n * java  - \n   * \n     * \n     * \n     * \n   * \n     *  (generalization)\n     *  (realization)\n     *  (aggregation)\n     *  (composition)\n     *  (association)\n     *  (dependency)\n   * \n\n\n# \n\n\n# \n\n\n\n:\n\n * : \n * : \n * : \n * \n * : \n\n person  namegenderage  get()  person  name  gender  age  age  work() \n\n gender  int  gender \n\npublic class person {\n\n    private string name;\n    private int gender;\n    private int age;\n\n    public string getname() {\n        return name;\n    }\n\n    public string getgender() {\n        return gender == 0 ? "man" : "woman";\n    }\n\n    public void work() {\n        if (18 <= age && age <= 50) {\n            system.out.println(name + " is working very hard!");\n        } else {\n            system.out.println(name + " can\'t work any more!");\n        }\n    }\n}\n\n\n\n# \n\n is-a  cat  animal  is-a  cat  animal animal  private \n\n\n\ncat  animal  animal  cat   \n\nanimal animal = new cat();\n\n\n\n# \n\n:\n\n * \n * \n\n:\n\n * \n * ()\n * \n\n(instrument): wind  percussion play()  main()  instrument  wind  percussion  instrument  play()  play()  instrument \n\npublic class instrument {\n    public void play() {\n        system.out.println("instrument is playing...");\n    }\n}\n\npublic class wind extends instrument {\n    public void play() {\n        system.out.println("wind is playing...");\n    }\n}\n\npublic class percussion extends instrument {\n    public void play() {\n        system.out.println("percussion is playing...");\n    }\n}\n\npublic class music {\n    public static void main(string[] args) {\n        list<instrument> instruments = new arraylist<>();\n        instruments.add(new wind());\n        instruments.add(new percussion());\n        for(instrument instrument : instruments) {\n            instrument.play();\n        }\n    }\n}\n\n\n\n# \n\n plantuml : http://plantuml.com/ \n\n\n#  (generalization)\n\n java  extends \n\n\n\n@startuml\n\ntitle generalization\n\nclass vehical\nclass car\nclass truck\n\nvehical <|-- car\nvehical <|-- truck\n\n@enduml\n\n\n\n#  (realization)\n\n java  implements \n\n\n\n@startuml\n\ntitle realization\n\ninterface movebehavior\nclass fly\nclass run\n\nmovebehavior <|.. fly\nmovebehavior <|.. run\n\n@enduml\n\n\n\n#  (aggregation)\n\n\n\n\n\n@startuml\n\ntitle aggregation\n\nclass computer\nclass keyboard\nclass mouse\nclass screen\n\ncomputer o-- keyboard\ncomputer o-- mouse\ncomputer o-- screen\n\n@enduml\n\n\n\n#  (composition)\n\n\n\n\n\n@startuml\n\ntitle composition\n\nclass company\nclass departmenta\nclass departmentb\n\ncompany *-- departmenta\ncompany *-- departmentb\n\n@enduml\n\n\n\n#  (association)\n\n 1  1 1\n\n\n\n@startuml\n\ntitle association\n\nclass school\nclass student\n\nschool "1" - "n" student\n\n@enduml\n\n\n\n#  (dependency)\n\na  b :\n\n * a  b ()\n * a  b \n * a  b  b \n\n\n\n@startuml\n\ntitle dependency\n\nclass vehicle {\n    move(movebehavior)\n}\n\ninterface movebehavior {\n    move()\n}\n\nnote "movebehavior.move()" as n\n\nvehicle ..> movebehavior\n\nvehicle .. n\n\n@enduml\n\n\n\n# \n\n * java \n\n * : \n\n *  solid \n\n *  uml \n\n * uml ()sequence diagram\n\n *  ------ \n\n * javaoop https://blog.csdn.net/weixin_38173324/article/details/70037927\n\n * javaoop() https://www.cnblogs.com/alanlee/p/6475334.html\n\n * java oop http://www.cnblogs.com/wujing-hubei/p/6012105.html\n\n *  https://www.pdai.tech/md/java/basic/java-basic-oop.html',charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-x-annotation.html",relativePath:"java/basic/java-basic-x-annotation.md",key:"v-433786d8",path:"/java/basic/java-basic-x-annotation.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:126},{level:3,title:"Java",slug:"java",normalizedTitle:"java",charIndex:138},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:242},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:440},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:455},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:466},{level:3,title:"Java8",slug:"java8",normalizedTitle:"java8",charIndex:480},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:503},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:519},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:533},{level:3,title:" - ",slug:"-",normalizedTitle:" - ",charIndex:548},{level:3,title:" - Junit3Junit4",slug:"-junit3junit4",normalizedTitle:" - junit3junit4",charIndex:571},{level:3,title:"AOP - ",slug:"aop-",normalizedTitle:"aop - ",charIndex:604},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:630}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -   Java     Java8     -   - Junit3Junit4 AOP -  ",content:'# Java  - \n\n> JDK1.5\n\n * Java  - \n   * \n     * Java\n       *  - @Override\n       *  - @Deprecated\n       *  - @SuppressWarnings\n     * \n       *  - @Target\n       *  - @Retention & @RetentionTarget\n       *  - @Documented\n       *  - @Inherited\n       *  - @Repeatable (Java8)\n       *  - @Native (Java8)\n     * \n     * \n   * \n     * Java8\n     * \n     * \n   * \n     *  - \n     *  - Junit3Junit4\n     * AOP - \n   * \n\n\n# \n\nJDK1.5\n\n * javadoc\n * \n * \n * \n\n\n\n * Java@Override@Deprecated@SuppressWarnings\n * @Retention@Target@Inherited@Documented@Retention@Target@Inherited@Documentedjavadoc\n * \n\n\n\n\n# Java\n\nJava\n\nclass A{\n    public void test() {\n        \n    }\n}\n\nclass B extends A{\n\n    /**\n        * test\n        */\n    @Override\n    public void test() {\n    }\n\n    /**\n        * \n        */\n    @Deprecated\n    public void oldMethod() {\n    }\n\n    /**\n        * \n        * \n        * @return\n        */\n    @SuppressWarnings("rawtypes")\n    public List processList() {\n        List list = new ArrayList();\n        return list;\n    }\n}\n\n\nJava 1.5@Override@Deprecated@SuppressWarnings\n\n * @Override\n * @Deprecated@Deprecated\n * @SuppressWarnings\n\n\n\n#  - @Override\n\n\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.SOURCE)\npublic @interface Override {\n}\n\n\nclass\n\n#  - @Deprecated\n\n\n\n@Documented\n@Retention(RetentionPolicy.RUNTIME)\n@Target(value={CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE})\npublic @interface Deprecated {\n}\n\n\n\n\n#  - @SuppressWarnings\n\n\n\n@Target({TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE})\n@Retention(RetentionPolicy.SOURCE)\npublic @interface SuppressWarnings {\n    String[] value();\n}\n\n\nString[]\n\n                                                                 \nall                                                            to suppress all warnings\nboxing                                                 to suppress warnings relative to boxing/unboxing operations\ncast                                                        to suppress warnings relative to cast operations\ndep-ann                                                     to suppress warnings relative to deprecated annotation\ndeprecation                                                  to suppress warnings relative to deprecation\nfallthrough                switchbreaks                    to suppress warnings relative to missing breaks in switch\n                                                                     statements\nfinally                    finally                        to suppress warnings relative to finally block that dont\n                                                                     return\nhiding                                              to suppress warnings relative to locals that hide variable\nincomplete-switch          switch                           to suppress warnings relative to missing entries in a switch\n                                                                     statement (enum case)\nnls                        nls                               to suppress warnings relative to non-nls string literals\nnull                       null                                to suppress warnings relative to null analysis\nrawtype                    generics                    to suppress warnings relative to un-specific types when\n                                                                     using\nrestriction                                        to suppress warnings relative to usage of discouraged or\nserial                     serializableserialVersionUID   to suppress warnings relative to missing serialVersionUID\n                                                                     field for a serializable class\nstatic-access                                          to suppress warnings relative to incorrect static access\nsynthetic-access                                  to suppress warnings relative to unoptimized access from\n                                                                     inner classes\nunchecked                                             to suppress warnings relative to unchecked operations\nunqualified-field-access                                to suppress warnings relative to field access unqualified\nunused                                                  to suppress warnings relative to unused code\n\n\n# \n\nJDK 1.54@Target@Retention@Documented@Inherited, JDK 1.8 @Repeatable@Native\n\n#  - @Target\n\n> Target \n\nTarget packagestypescatch@Target ElementType \n\npublic enum ElementType {\n \n    TYPE, // \n \n    FIELD, // \n \n    METHOD, // \n \n    PARAMETER, // \n \n    CONSTRUCTOR, // \n \n    LOCAL_VARIABLE, // \n \n    ANNOTATION_TYPE, // \n \n    PACKAGE, // \n \n    TYPE_PARAMETER, // JDK 1.8 \n \n    TYPE_USE // JDK 1.8 \n \n}\n\n\n#  - @Retention & @RetentionTarget\n\n> Reteniton \n\nRetenitonRetentionPolicy\n\npublic enum RetentionPolicy {\n \n    SOURCE,    // \n    CLASS,       // \n    RUNTIME   // \n}\n\n\n\n\n@Retention(RetentionPolicy.SOURCE)\npublic @interface SourcePolicy {\n \n}\n@Retention(RetentionPolicy.CLASS)\npublic @interface ClassPolicy {\n \n}\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface RuntimePolicy {\n \n}\n\n\n\n\npublic class RetentionTest {\n \n\t@SourcePolicy\n\tpublic void sourcePolicy() {\n\t}\n \n\t@ClassPolicy\n\tpublic void classPolicy() {\n\t}\n \n\t@RuntimePolicy\n\tpublic void runtimePolicy() {\n\t}\n}\n\n\n javap -verbose RetentionTestRetentionTest  class \n\n{\n  public retention.RetentionTest();\n    flags: ACC_PUBLIC\n    Code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1                  // Method java/lang/Object."<init>":()V\n         4: return\n      LineNumberTable:\n        line 3: 0\n\n  public void sourcePolicy();\n    flags: ACC_PUBLIC\n    Code:\n      stack=0, locals=1, args_size=1\n         0: return\n      LineNumberTable:\n        line 7: 0\n\n  public void classPolicy();\n    flags: ACC_PUBLIC\n    Code:\n      stack=0, locals=1, args_size=1\n         0: return\n      LineNumberTable:\n        line 11: 0\n    RuntimeInvisibleAnnotations:\n      0: #11()\n\n  public void runtimePolicy();\n    flags: ACC_PUBLIC\n    Code:\n      stack=0, locals=1, args_size=1\n         0: return\n      LineNumberTable:\n        line 15: 0\n    RuntimeVisibleAnnotations:\n      0: #14()\n}\n\n\nRetentionTest\n\n *  sourcePolicy() \n *  RuntimeInvisibleAnnotations  RuntimeVisibleAnnotations classPolicy()  runtimePolicy() \n\n#  - @Documented\n\n> Documented javadoc \n\nJavadoc@TestDocAnnotation\n\nimport java.lang.annotation.Documented;\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Target;\n \n@Documented\n@Target({ElementType.TYPE,ElementType.METHOD})\npublic @interface TestDocAnnotation {\n \n\tpublic String value() default "default";\n}\n\n\n@TestDocAnnotation("myMethodDoc")\npublic void testDoc() {\n\n}\n\n\n#  - @Inherited\n\n> InheritedAnnotation@InheritedAnnotation\n\n\n\n * @Inherited\n\n@Inherited\n@Retention(RetentionPolicy.RUNTIME)\n@Target({ElementType.TYPE,ElementType.METHOD})\npublic @interface TestInheritedAnnotation {\n    String [] values();\n    int number();\n}\n\n\n * \n\n@TestInheritedAnnotation(values = {"value"}, number = 10)\npublic class Person {\n}\n\nclass Student extends Person{\n\t@Test\n    public void test(){\n        Class clazz = Student.class;\n        Annotation[] annotations = clazz.getAnnotations();\n        for (Annotation annotation : annotations) {\n            System.out.println(annotation.toString());\n        }\n    }\n}\n\n\n * \n\nxxxxxxx.TestInheritedAnnotation(values=[value], number=10)\n\n\nStudent@TestInheritedAnnotationPerson@TestInheritedAnnotation@InheritedStudent\n\n#  - @Repeatable (Java8)\n\n@RepeatableJava 8 - \n\n#  - @Native (Java8)\n\n @Native  @Native \n\n\n# \n\n> java.lang.reflectAnnotatedElementRUNTIMEclassclassAnnotation\n\nAnnotatedElement ClassMethodConstructorAnnotatedElementAnnotation\n\n * boolean isAnnotationPresent(Class<?extends Annotation> annotationClass)\n\ntruefalse\n\n * <T extends Annotation> T getAnnotation(Class<T> annotationClass)\n\nnull\n\n * Annotation[] getAnnotations()\n\n0\n\n * <T extends Annotation> T[] getAnnotationsByType(Class<T> annotationClass)\n\n0getAnnotationsByType getAnnotationgetAnnotationsByType\n\n * <T extends Annotation> T getDeclaredAnnotation(Class<T> annotationClass)\n\nnull\n\n * <T extends Annotation> T[] getDeclaredAnnotationsByType(Class<T> annotationClass)\n\n\n\n * Annotation[] getDeclaredAnnotations()\n\n\n\n\n# \n\n> , , \n\n * \n\npackage com.pdai.java.annotation;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface MyMethodAnnotation {\n\n    public String title() default "";\n\n    public String description() default "";\n\n}\n\n\n * \n\npackage com.pdai.java.annotation;\n\nimport java.io.FileNotFoundException;\nimport java.lang.annotation.Annotation;\nimport java.lang.reflect.Method;\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class TestMethodAnnotation {\n\n    @Override\n    @MyMethodAnnotation(title = "toStringMethod", description = "override toString method")\n    public String toString() {\n        return "Override toString method";\n    }\n\n    @Deprecated\n    @MyMethodAnnotation(title = "old static method", description = "deprecated old static method")\n    public static void oldMethod() {\n        System.out.println("old method, don\'t use it.");\n    }\n\n    @SuppressWarnings({"unchecked", "deprecation"})\n    @MyMethodAnnotation(title = "test method", description = "suppress warning static method")\n    public static void genericsTest() throws FileNotFoundException {\n        List l = new ArrayList();\n        l.add("abc");\n        oldMethod();\n    }\n}\n\n\n * \n\nTestMethodAnnotationMain\n\npublic static void main(String[] args) {\n    try {\n        // methods\n        Method[] methods = TestMethodAnnotation.class.getClassLoader()\n                .loadClass(("com.pdai.java.annotation.TestMethodAnnotation"))\n                .getMethods();\n\n        // \n        for (Method method : methods) {\n            // MyMethodAnnotation\n            if (method.isAnnotationPresent(MyMethodAnnotation.class)) {\n                try {\n                    // \n                    for (Annotation anno : method.getDeclaredAnnotations()) {\n                        System.out.println("Annotation in Method \'"\n                                + method + "\' : " + anno);\n                    }\n\n                    // MyMethodAnnotation\n                    MyMethodAnnotation methodAnno = method\n                            .getAnnotation(MyMethodAnnotation.class);\n\n                    System.out.println(methodAnno.title());\n\n                } catch (Throwable ex) {\n                    ex.printStackTrace();\n                }\n            }\n        }\n    } catch (SecurityException | ClassNotFoundException e) {\n        e.printStackTrace();\n    }\n}\n\n\n * \n\nAnnotation in Method \'public static void com.pdai.java.annotation.TestMethodAnnotation.oldMethod()\' : @java.lang.Deprecated()\nAnnotation in Method \'public static void com.pdai.java.annotation.TestMethodAnnotation.oldMethod()\' : @com.pdai.java.annotation.MyMethodAnnotation(title=old static method, description=deprecated old static method)\nold static method\nAnnotation in Method \'public static void com.pdai.java.annotation.TestMethodAnnotation.genericsTest() throws java.io.FileNotFoundException\' : @com.pdai.java.annotation.MyMethodAnnotation(title=test method, description=suppress warning static method)\ntest method\nAnnotation in Method \'public java.lang.String com.pdai.java.annotation.TestMethodAnnotation.toString()\' : @com.pdai.java.annotation.MyMethodAnnotation(title=toStringMethod, description=override toString method)\ntoStringMethod\n\n\n\n# \n\n\n# Java8\n\n * @Repeatable\n\nJava 8 - \n\n * ElementType.TYPE_USE\n\nJava 8 - \n\n * ElementType.TYPE_PARAMETER\n\nElementType.TYPE_USE()ElementType.TYPE()ElementType.TYPE_PARAMETER(), \n\n// ElementType.TYPE_PARAMETER\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE_PARAMETER)\npublic @interface MyNotEmpty {\n}\n\n// ElementType.TYPE_USE\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE_USE)\npublic @interface MyNotNull {\n}\n\n// \npublic class TypeParameterAndTypeUseAnnotation<@MyNotEmpty T>{\n\n  //TYPE_PARAMETER\n//\t\tpublic @MyNotEmpty T test(@MyNotEmpty T a){\n//\t\t\tnew ArrayList<@MyNotEmpty String>();\n//\t\t\t\treturn a;\n//\t\t}\n\n  //TYPE_USE\n  public @MyNotNull T test2(@MyNotNull T a){\n    new ArrayList<@MyNotNull String>();\n    return a;\n  }\n}\n\n\n\n# \n\n> \n\nextends@interfacejava.lang.annotation.Annotation.\n\nAnnotationJavaextends@interface\n\n@Inherited @InheritedAnnotation\n\n\n# \n\n> \n\n\n\n * https://blog.csdn.net/qq_20009015/article/details/106038023\n * https://www.race604.com/annotation-processing/\n\n\n# \n\n\n\n@pdai\n\n\n#  - \n\nSpring  \n\n\n#  - Junit3Junit4\n\n> Junit3 Junit4\n\n * \n\npublic class HelloWorld {\n \t\n \tpublic void sayHello(){\n \t\tSystem.out.println("hello....");\n \t\tthrow new NumberFormatException();\n \t}\n \t\n \tpublic void sayWorld(){\n \t\tSystem.out.println("world....");\n \t}\n \t\n \tpublic String say(){\n \t\treturn "hello world!";\n \t}\n \t\n}\n\n\n * Junit 3 UT\n\n TestCaseOverridetest\n\npublic class HelloWorldTest extends TestCase{\n \tprivate HelloWorld hw;\n \t\n \t@Override\n \tprotected void setUp() throws Exception {\n \t\tsuper.setUp();\n \t\thw=new HelloWorld();\n \t}\n \t\n \t//1.\n \tpublic void testHello(){\n \t\ttry {\n \t\t\thw.sayHello();\n \t\t} catch (Exception e) {\n \t\t\tSystem.out.println(".....");\n \t\t}\n \t\t\n \t}\n \tpublic void testWorld(){\n \t\thw.sayWorld();\n \t}\n \t//2.\n \t// \n \tpublic void testSay(){\n \t\tassertEquals("", hw.say(), "hello world!");\n \t}\n \t//\n \tpublic void testObj(){\n \t\tassertNull("", null);\n \t\tassertNotNull("",new String());\n \t}\n \t@Override\n \tprotected void tearDown() throws Exception {\n \t\tsuper.tearDown();\n \t\thw=null;\n \t}\t\n}\n\n\n * Junit 4 UT\n\n@Before@Test@After\n\npublic class HelloWorldTest {\n \tprivate HelloWorld hw;\n \n \t@Before\n \tpublic void setUp() {\n \t\thw = new HelloWorld();\n \t}\n \n \t@Test(expected=NumberFormatException.class)\n \t// 1.,junit3\n \tpublic void testHello() {\n \t\thw.sayHello();\n \t}\n \t@Test\n \tpublic void testWorld() {\n \t\thw.sayWorld();\n \t}\n \t\n \t@Test\n \t// 2.\n \t// \n \tpublic void testSay() {\n \t\tassertEquals("", hw.say(), "hello world!");\n \t}\n \t\n \t@Test\n \t// \n \tpublic void testObj() {\n \t\tassertNull("", null);\n \t\tassertNotNull("", new String());\n \t}\n \n \t@After\n \tpublic void tearDown() throws Exception {\n \t\thw = null;\n \t}\n \n}\n\n\nJunit4JUnit4\n\n\n# AOP - \n\n> Spring AOP\n\n * Log\n\n@Target({ ElementType.PARAMETER, ElementType.METHOD })\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Log {\n    /**\n     *  \n     */\n    public String title() default "";\n\n    /**\n     * \n     */\n    public BusinessType businessType() default BusinessType.OTHER;\n\n    /**\n     * \n     */\n    public OperatorType operatorType() default OperatorType.MANAGE;\n\n    /**\n     * \n     */\n    public boolean isSaveRequestData() default true;\n}\n\n\n * , Log\n\n@Log\n\n@Aspect\n@Component\npublic class LogAspect {\n    private static final Logger log = LoggerFactory.getLogger(LogAspect.class);\n\n    /**\n     *  - \n     * \n     */\n    @Pointcut("@annotation(com.xxx.aspectj.lang.annotation.Log)")\n    public void logPointCut() {\n    }\n\n    /**\n     * \n     *\n     * @param joinPoint \n     */\n    @AfterReturning(pointcut = "logPointCut()", returning = "jsonResult")\n    public void doAfterReturning(JoinPoint joinPoint, Object jsonResult) {\n        handleLog(joinPoint, null, jsonResult);\n    }\n\n    /**\n     * \n     * \n     * @param joinPoint \n     * @param e \n     */\n    @AfterThrowing(value = "logPointCut()", throwing = "e")\n    public void doAfterThrowing(JoinPoint joinPoint, Exception e) {\n        handleLog(joinPoint, e, null);\n    }\n\n    protected void handleLog(final JoinPoint joinPoint, final Exception e, Object jsonResult) {\n        try {\n            // \n            Log controllerLog = getAnnotationLog(joinPoint);\n            if (controllerLog == null) {\n                return;\n            }\n\n            // \n            User currentUser = ShiroUtils.getSysUser();\n\n            // *=================*//\n            OperLog operLog = new OperLog();\n            operLog.setStatus(BusinessStatus.SUCCESS.ordinal());\n            // \n            String ip = ShiroUtils.getIp();\n            operLog.setOperIp(ip);\n            // \n            operLog.setJsonResult(JSONObject.toJSONString(jsonResult));\n\n            operLog.setOperUrl(ServletUtils.getRequest().getRequestURI());\n            if (currentUser != null) {\n                operLog.setOperName(currentUser.getLoginName());\n                if (StringUtils.isNotNull(currentUser.getDept())\n                        && StringUtils.isNotEmpty(currentUser.getDept().getDeptName())) {\n                    operLog.setDeptName(currentUser.getDept().getDeptName());\n                }\n            }\n\n            if (e != null) {\n                operLog.setStatus(BusinessStatus.FAIL.ordinal());\n                operLog.setErrorMsg(StringUtils.substring(e.getMessage(), 0, 2000));\n            }\n            // \n            String className = joinPoint.getTarget().getClass().getName();\n            String methodName = joinPoint.getSignature().getName();\n            operLog.setMethod(className + "." + methodName + "()");\n            // \n            operLog.setRequestMethod(ServletUtils.getRequest().getMethod());\n            // \n            getControllerMethodDescription(controllerLog, operLog);\n            // \n            AsyncManager.me().execute(AsyncFactory.recordOper(operLog));\n        } catch (Exception exp) {\n            // \n            log.error("====");\n            log.error(":{}", exp.getMessage());\n            exp.printStackTrace();\n        }\n    }\n\n    /**\n     *  Controller\n     * \n     * @param log \n     * @param operLog \n     * @throws Exception\n     */\n    public void getControllerMethodDescription(Log log, OperLog operLog) throws Exception {\n        // action\n        operLog.setBusinessType(log.businessType().ordinal());\n        // \n        operLog.setTitle(log.title());\n        // \n        operLog.setOperatorType(log.operatorType().ordinal());\n        // request\n        if (log.isSaveRequestData()) {\n            // \n            setRequestValue(operLog);\n        }\n    }\n\n    /**\n     * log\n     * \n     * @param operLog\n     * @param request\n     */\n    private void setRequestValue(OperLog operLog) {\n        Map<String, String[]> map = ServletUtils.getRequest().getParameterMap();\n        String params = JSONObject.toJSONString(map);\n        operLog.setOperParam(StringUtils.substring(params, 0, 2000));\n    }\n\n    /**\n     * \n     */\n    private Log getAnnotationLog(JoinPoint joinPoint) throws Exception {\n        Signature signature = joinPoint.getSignature();\n        MethodSignature methodSignature = (MethodSignature) signature;\n        Method method = methodSignature.getMethod();\n\n        if (method != null)\n        {\n            return method.getAnnotation(Log.class);\n        }\n        return null;\n    }\n}\n\n\n * @Log\n\nCRUD, \n\n@Controller\n@RequestMapping("/system/dept")\npublic class DeptController extends BaseController {\n    private String prefix = "system/dept";\n\n    @Autowired\n    private IDeptService deptService;\n    \n    /**\n     * \n     */\n    @Log(title = "", businessType = BusinessType.INSERT)\n    @RequiresPermissions("system:dept:add")\n    @PostMapping("/add")\n    @ResponseBody\n    public AjaxResult addSave(@Validated Dept dept) {\n        if (UserConstants.DEPT_NAME_NOT_UNIQUE.equals(deptService.checkDeptNameUnique(dept))) {\n            return error("\'" + dept.getDeptName() + "\'");\n        }\n        return toAjax(deptService.insertDept(dept));\n    }\n\n    /**\n     * \n     */\n    @Log(title = "", businessType = BusinessType.UPDATE)\n    @RequiresPermissions("system:dept:edit")\n    @PostMapping("/edit")\n    @ResponseBody\n    public AjaxResult editSave(@Validated Dept dept) {\n        if (UserConstants.DEPT_NAME_NOT_UNIQUE.equals(deptService.checkDeptNameUnique(dept))) {\n            return error("\'" + dept.getDeptName() + "\'");\n        } else if(dept.getParentId().equals(dept.getDeptId())) {\n            return error("\'" + dept.getDeptName() + "\'");\n        }\n        return toAjax(deptService.updateDept(dept));\n    }\n\n    /**\n     * \n     */\n    @Log(title = "", businessType = BusinessType.DELETE)\n    @RequiresPermissions("system:dept:remove")\n    @GetMapping("/remove/{deptId}")\n    @ResponseBody\n    public AjaxResult remove(@PathVariable("deptId") Long deptId) {\n        if (deptService.selectDeptCount(deptId) > 0) {\n            return AjaxResult.warn(",");\n        }\n        if (deptService.checkDeptExistUser(deptId)) {\n            return AjaxResult.warn(",");\n        }\n        return toAjax(deptService.deleteDeptById(deptId));\n    }\n\n  // ...\n}\n\n\n> @RequiresPermissions+AOP\n\n\n# \n\n * https://blog.csdn.net/javazejian/article/details/71860633\n * https://blog.csdn.net/qq_20009015/article/details/106038023\n * https://www.zhihu.com/question/47449512\n * https://www.race604.com/annotation-processing/\n * https://www.runoob.com/w3cnote/java-annotation.html\n *  https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html',normalizedContent:'# java  - \n\n> jdk1.5\n\n * java  - \n   * \n     * java\n       *  - @override\n       *  - @deprecated\n       *  - @suppresswarnings\n     * \n       *  - @target\n       *  - @retention & @retentiontarget\n       *  - @documented\n       *  - @inherited\n       *  - @repeatable (java8)\n       *  - @native (java8)\n     * \n     * \n   * \n     * java8\n     * \n     * \n   * \n     *  - \n     *  - junit3junit4\n     * aop - \n   * \n\n\n# \n\njdk1.5\n\n * javadoc\n * \n * \n * \n\n\n\n * java@override@deprecated@suppresswarnings\n * @retention@target@inherited@documented@retention@target@inherited@documentedjavadoc\n * \n\n\n\n\n# java\n\njava\n\nclass a{\n    public void test() {\n        \n    }\n}\n\nclass b extends a{\n\n    /**\n        * test\n        */\n    @override\n    public void test() {\n    }\n\n    /**\n        * \n        */\n    @deprecated\n    public void oldmethod() {\n    }\n\n    /**\n        * \n        * \n        * @return\n        */\n    @suppresswarnings("rawtypes")\n    public list processlist() {\n        list list = new arraylist();\n        return list;\n    }\n}\n\n\njava 1.5@override@deprecated@suppresswarnings\n\n * @override\n * @deprecated@deprecated\n * @suppresswarnings\n\n\n\n#  - @override\n\n\n\n@target(elementtype.method)\n@retention(retentionpolicy.source)\npublic @interface override {\n}\n\n\nclass\n\n#  - @deprecated\n\n\n\n@documented\n@retention(retentionpolicy.runtime)\n@target(value={constructor, field, local_variable, method, package, parameter, type})\npublic @interface deprecated {\n}\n\n\n\n\n#  - @suppresswarnings\n\n\n\n@target({type, field, method, parameter, constructor, local_variable})\n@retention(retentionpolicy.source)\npublic @interface suppresswarnings {\n    string[] value();\n}\n\n\nstring[]\n\n                                                                 \nall                                                            to suppress all warnings\nboxing                                                 to suppress warnings relative to boxing/unboxing operations\ncast                                                        to suppress warnings relative to cast operations\ndep-ann                                                     to suppress warnings relative to deprecated annotation\ndeprecation                                                  to suppress warnings relative to deprecation\nfallthrough                switchbreaks                    to suppress warnings relative to missing breaks in switch\n                                                                     statements\nfinally                    finally                        to suppress warnings relative to finally block that dont\n                                                                     return\nhiding                                              to suppress warnings relative to locals that hide variable\nincomplete-switch          switch                           to suppress warnings relative to missing entries in a switch\n                                                                     statement (enum case)\nnls                        nls                               to suppress warnings relative to non-nls string literals\nnull                       null                                to suppress warnings relative to null analysis\nrawtype                    generics                    to suppress warnings relative to un-specific types when\n                                                                     using\nrestriction                                        to suppress warnings relative to usage of discouraged or\nserial                     serializableserialversionuid   to suppress warnings relative to missing serialversionuid\n                                                                     field for a serializable class\nstatic-access                                          to suppress warnings relative to incorrect static access\nsynthetic-access                                  to suppress warnings relative to unoptimized access from\n                                                                     inner classes\nunchecked                                             to suppress warnings relative to unchecked operations\nunqualified-field-access                                to suppress warnings relative to field access unqualified\nunused                                                  to suppress warnings relative to unused code\n\n\n# \n\njdk 1.54@target@retention@documented@inherited, jdk 1.8 @repeatable@native\n\n#  - @target\n\n> target \n\ntarget packagestypescatch@target elementtype \n\npublic enum elementtype {\n \n    type, // \n \n    field, // \n \n    method, // \n \n    parameter, // \n \n    constructor, // \n \n    local_variable, // \n \n    annotation_type, // \n \n    package, // \n \n    type_parameter, // jdk 1.8 \n \n    type_use // jdk 1.8 \n \n}\n\n\n#  - @retention & @retentiontarget\n\n> reteniton \n\nretenitonretentionpolicy\n\npublic enum retentionpolicy {\n \n    source,    // \n    class,       // \n    runtime   // \n}\n\n\n\n\n@retention(retentionpolicy.source)\npublic @interface sourcepolicy {\n \n}\n@retention(retentionpolicy.class)\npublic @interface classpolicy {\n \n}\n@retention(retentionpolicy.runtime)\npublic @interface runtimepolicy {\n \n}\n\n\n\n\npublic class retentiontest {\n \n\t@sourcepolicy\n\tpublic void sourcepolicy() {\n\t}\n \n\t@classpolicy\n\tpublic void classpolicy() {\n\t}\n \n\t@runtimepolicy\n\tpublic void runtimepolicy() {\n\t}\n}\n\n\n javap -verbose retentiontestretentiontest  class \n\n{\n  public retention.retentiontest();\n    flags: acc_public\n    code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1                  // method java/lang/object."<init>":()v\n         4: return\n      linenumbertable:\n        line 3: 0\n\n  public void sourcepolicy();\n    flags: acc_public\n    code:\n      stack=0, locals=1, args_size=1\n         0: return\n      linenumbertable:\n        line 7: 0\n\n  public void classpolicy();\n    flags: acc_public\n    code:\n      stack=0, locals=1, args_size=1\n         0: return\n      linenumbertable:\n        line 11: 0\n    runtimeinvisibleannotations:\n      0: #11()\n\n  public void runtimepolicy();\n    flags: acc_public\n    code:\n      stack=0, locals=1, args_size=1\n         0: return\n      linenumbertable:\n        line 15: 0\n    runtimevisibleannotations:\n      0: #14()\n}\n\n\nretentiontest\n\n *  sourcepolicy() \n *  runtimeinvisibleannotations  runtimevisibleannotations classpolicy()  runtimepolicy() \n\n#  - @documented\n\n> documented javadoc \n\njavadoc@testdocannotation\n\nimport java.lang.annotation.documented;\nimport java.lang.annotation.elementtype;\nimport java.lang.annotation.target;\n \n@documented\n@target({elementtype.type,elementtype.method})\npublic @interface testdocannotation {\n \n\tpublic string value() default "default";\n}\n\n\n@testdocannotation("mymethoddoc")\npublic void testdoc() {\n\n}\n\n\n#  - @inherited\n\n> inheritedannotation@inheritedannotation\n\n\n\n * @inherited\n\n@inherited\n@retention(retentionpolicy.runtime)\n@target({elementtype.type,elementtype.method})\npublic @interface testinheritedannotation {\n    string [] values();\n    int number();\n}\n\n\n * \n\n@testinheritedannotation(values = {"value"}, number = 10)\npublic class person {\n}\n\nclass student extends person{\n\t@test\n    public void test(){\n        class clazz = student.class;\n        annotation[] annotations = clazz.getannotations();\n        for (annotation annotation : annotations) {\n            system.out.println(annotation.tostring());\n        }\n    }\n}\n\n\n * \n\nxxxxxxx.testinheritedannotation(values=[value], number=10)\n\n\nstudent@testinheritedannotationperson@testinheritedannotation@inheritedstudent\n\n#  - @repeatable (java8)\n\n@repeatablejava 8 - \n\n#  - @native (java8)\n\n @native  @native \n\n\n# \n\n> java.lang.reflectannotatedelementruntimeclassclassannotation\n\nannotatedelement classmethodconstructorannotatedelementannotation\n\n * boolean isannotationpresent(class<?extends annotation> annotationclass)\n\ntruefalse\n\n * <t extends annotation> t getannotation(class<t> annotationclass)\n\nnull\n\n * annotation[] getannotations()\n\n0\n\n * <t extends annotation> t[] getannotationsbytype(class<t> annotationclass)\n\n0getannotationsbytype getannotationgetannotationsbytype\n\n * <t extends annotation> t getdeclaredannotation(class<t> annotationclass)\n\nnull\n\n * <t extends annotation> t[] getdeclaredannotationsbytype(class<t> annotationclass)\n\n\n\n * annotation[] getdeclaredannotations()\n\n\n\n\n# \n\n> , , \n\n * \n\npackage com.pdai.java.annotation;\n\nimport java.lang.annotation.elementtype;\nimport java.lang.annotation.retention;\nimport java.lang.annotation.retentionpolicy;\nimport java.lang.annotation.target;\n\n@target(elementtype.method)\n@retention(retentionpolicy.runtime)\npublic @interface mymethodannotation {\n\n    public string title() default "";\n\n    public string description() default "";\n\n}\n\n\n * \n\npackage com.pdai.java.annotation;\n\nimport java.io.filenotfoundexception;\nimport java.lang.annotation.annotation;\nimport java.lang.reflect.method;\nimport java.util.arraylist;\nimport java.util.list;\n\npublic class testmethodannotation {\n\n    @override\n    @mymethodannotation(title = "tostringmethod", description = "override tostring method")\n    public string tostring() {\n        return "override tostring method";\n    }\n\n    @deprecated\n    @mymethodannotation(title = "old static method", description = "deprecated old static method")\n    public static void oldmethod() {\n        system.out.println("old method, don\'t use it.");\n    }\n\n    @suppresswarnings({"unchecked", "deprecation"})\n    @mymethodannotation(title = "test method", description = "suppress warning static method")\n    public static void genericstest() throws filenotfoundexception {\n        list l = new arraylist();\n        l.add("abc");\n        oldmethod();\n    }\n}\n\n\n * \n\ntestmethodannotationmain\n\npublic static void main(string[] args) {\n    try {\n        // methods\n        method[] methods = testmethodannotation.class.getclassloader()\n                .loadclass(("com.pdai.java.annotation.testmethodannotation"))\n                .getmethods();\n\n        // \n        for (method method : methods) {\n            // mymethodannotation\n            if (method.isannotationpresent(mymethodannotation.class)) {\n                try {\n                    // \n                    for (annotation anno : method.getdeclaredannotations()) {\n                        system.out.println("annotation in method \'"\n                                + method + "\' : " + anno);\n                    }\n\n                    // mymethodannotation\n                    mymethodannotation methodanno = method\n                            .getannotation(mymethodannotation.class);\n\n                    system.out.println(methodanno.title());\n\n                } catch (throwable ex) {\n                    ex.printstacktrace();\n                }\n            }\n        }\n    } catch (securityexception | classnotfoundexception e) {\n        e.printstacktrace();\n    }\n}\n\n\n * \n\nannotation in method \'public static void com.pdai.java.annotation.testmethodannotation.oldmethod()\' : @java.lang.deprecated()\nannotation in method \'public static void com.pdai.java.annotation.testmethodannotation.oldmethod()\' : @com.pdai.java.annotation.mymethodannotation(title=old static method, description=deprecated old static method)\nold static method\nannotation in method \'public static void com.pdai.java.annotation.testmethodannotation.genericstest() throws java.io.filenotfoundexception\' : @com.pdai.java.annotation.mymethodannotation(title=test method, description=suppress warning static method)\ntest method\nannotation in method \'public java.lang.string com.pdai.java.annotation.testmethodannotation.tostring()\' : @com.pdai.java.annotation.mymethodannotation(title=tostringmethod, description=override tostring method)\ntostringmethod\n\n\n\n# \n\n\n# java8\n\n * @repeatable\n\njava 8 - \n\n * elementtype.type_use\n\njava 8 - \n\n * elementtype.type_parameter\n\nelementtype.type_use()elementtype.type()elementtype.type_parameter(), \n\n// elementtype.type_parameter\n@retention(retentionpolicy.runtime)\n@target(elementtype.type_parameter)\npublic @interface mynotempty {\n}\n\n// elementtype.type_use\n@retention(retentionpolicy.runtime)\n@target(elementtype.type_use)\npublic @interface mynotnull {\n}\n\n// \npublic class typeparameterandtypeuseannotation<@mynotempty t>{\n\n  //type_parameter\n//\t\tpublic @mynotempty t test(@mynotempty t a){\n//\t\t\tnew arraylist<@mynotempty string>();\n//\t\t\t\treturn a;\n//\t\t}\n\n  //type_use\n  public @mynotnull t test2(@mynotnull t a){\n    new arraylist<@mynotnull string>();\n    return a;\n  }\n}\n\n\n\n# \n\n> \n\nextends@interfacejava.lang.annotation.annotation.\n\nannotationjavaextends@interface\n\n@inherited @inheritedannotation\n\n\n# \n\n> \n\n\n\n * https://blog.csdn.net/qq_20009015/article/details/106038023\n * https://www.race604.com/annotation-processing/\n\n\n# \n\n\n\n@pdai\n\n\n#  - \n\nspring  \n\n\n#  - junit3junit4\n\n> junit3 junit4\n\n * \n\npublic class helloworld {\n \t\n \tpublic void sayhello(){\n \t\tsystem.out.println("hello....");\n \t\tthrow new numberformatexception();\n \t}\n \t\n \tpublic void sayworld(){\n \t\tsystem.out.println("world....");\n \t}\n \t\n \tpublic string say(){\n \t\treturn "hello world!";\n \t}\n \t\n}\n\n\n * junit 3 ut\n\n testcaseoverridetest\n\npublic class helloworldtest extends testcase{\n \tprivate helloworld hw;\n \t\n \t@override\n \tprotected void setup() throws exception {\n \t\tsuper.setup();\n \t\thw=new helloworld();\n \t}\n \t\n \t//1.\n \tpublic void testhello(){\n \t\ttry {\n \t\t\thw.sayhello();\n \t\t} catch (exception e) {\n \t\t\tsystem.out.println(".....");\n \t\t}\n \t\t\n \t}\n \tpublic void testworld(){\n \t\thw.sayworld();\n \t}\n \t//2.\n \t// \n \tpublic void testsay(){\n \t\tassertequals("", hw.say(), "hello world!");\n \t}\n \t//\n \tpublic void testobj(){\n \t\tassertnull("", null);\n \t\tassertnotnull("",new string());\n \t}\n \t@override\n \tprotected void teardown() throws exception {\n \t\tsuper.teardown();\n \t\thw=null;\n \t}\t\n}\n\n\n * junit 4 ut\n\n@before@test@after\n\npublic class helloworldtest {\n \tprivate helloworld hw;\n \n \t@before\n \tpublic void setup() {\n \t\thw = new helloworld();\n \t}\n \n \t@test(expected=numberformatexception.class)\n \t// 1.,junit3\n \tpublic void testhello() {\n \t\thw.sayhello();\n \t}\n \t@test\n \tpublic void testworld() {\n \t\thw.sayworld();\n \t}\n \t\n \t@test\n \t// 2.\n \t// \n \tpublic void testsay() {\n \t\tassertequals("", hw.say(), "hello world!");\n \t}\n \t\n \t@test\n \t// \n \tpublic void testobj() {\n \t\tassertnull("", null);\n \t\tassertnotnull("", new string());\n \t}\n \n \t@after\n \tpublic void teardown() throws exception {\n \t\thw = null;\n \t}\n \n}\n\n\njunit4junit4\n\n\n# aop - \n\n> spring aop\n\n * log\n\n@target({ elementtype.parameter, elementtype.method })\n@retention(retentionpolicy.runtime)\n@documented\npublic @interface log {\n    /**\n     *  \n     */\n    public string title() default "";\n\n    /**\n     * \n     */\n    public businesstype businesstype() default businesstype.other;\n\n    /**\n     * \n     */\n    public operatortype operatortype() default operatortype.manage;\n\n    /**\n     * \n     */\n    public boolean issaverequestdata() default true;\n}\n\n\n * , log\n\n@log\n\n@aspect\n@component\npublic class logaspect {\n    private static final logger log = loggerfactory.getlogger(logaspect.class);\n\n    /**\n     *  - \n     * \n     */\n    @pointcut("@annotation(com.xxx.aspectj.lang.annotation.log)")\n    public void logpointcut() {\n    }\n\n    /**\n     * \n     *\n     * @param joinpoint \n     */\n    @afterreturning(pointcut = "logpointcut()", returning = "jsonresult")\n    public void doafterreturning(joinpoint joinpoint, object jsonresult) {\n        handlelog(joinpoint, null, jsonresult);\n    }\n\n    /**\n     * \n     * \n     * @param joinpoint \n     * @param e \n     */\n    @afterthrowing(value = "logpointcut()", throwing = "e")\n    public void doafterthrowing(joinpoint joinpoint, exception e) {\n        handlelog(joinpoint, e, null);\n    }\n\n    protected void handlelog(final joinpoint joinpoint, final exception e, object jsonresult) {\n        try {\n            // \n            log controllerlog = getannotationlog(joinpoint);\n            if (controllerlog == null) {\n                return;\n            }\n\n            // \n            user currentuser = shiroutils.getsysuser();\n\n            // *=================*//\n            operlog operlog = new operlog();\n            operlog.setstatus(businessstatus.success.ordinal());\n            // \n            string ip = shiroutils.getip();\n            operlog.setoperip(ip);\n            // \n            operlog.setjsonresult(jsonobject.tojsonstring(jsonresult));\n\n            operlog.setoperurl(servletutils.getrequest().getrequesturi());\n            if (currentuser != null) {\n                operlog.setopername(currentuser.getloginname());\n                if (stringutils.isnotnull(currentuser.getdept())\n                        && stringutils.isnotempty(currentuser.getdept().getdeptname())) {\n                    operlog.setdeptname(currentuser.getdept().getdeptname());\n                }\n            }\n\n            if (e != null) {\n                operlog.setstatus(businessstatus.fail.ordinal());\n                operlog.seterrormsg(stringutils.substring(e.getmessage(), 0, 2000));\n            }\n            // \n            string classname = joinpoint.gettarget().getclass().getname();\n            string methodname = joinpoint.getsignature().getname();\n            operlog.setmethod(classname + "." + methodname + "()");\n            // \n            operlog.setrequestmethod(servletutils.getrequest().getmethod());\n            // \n            getcontrollermethoddescription(controllerlog, operlog);\n            // \n            asyncmanager.me().execute(asyncfactory.recordoper(operlog));\n        } catch (exception exp) {\n            // \n            log.error("====");\n            log.error(":{}", exp.getmessage());\n            exp.printstacktrace();\n        }\n    }\n\n    /**\n     *  controller\n     * \n     * @param log \n     * @param operlog \n     * @throws exception\n     */\n    public void getcontrollermethoddescription(log log, operlog operlog) throws exception {\n        // action\n        operlog.setbusinesstype(log.businesstype().ordinal());\n        // \n        operlog.settitle(log.title());\n        // \n        operlog.setoperatortype(log.operatortype().ordinal());\n        // request\n        if (log.issaverequestdata()) {\n            // \n            setrequestvalue(operlog);\n        }\n    }\n\n    /**\n     * log\n     * \n     * @param operlog\n     * @param request\n     */\n    private void setrequestvalue(operlog operlog) {\n        map<string, string[]> map = servletutils.getrequest().getparametermap();\n        string params = jsonobject.tojsonstring(map);\n        operlog.setoperparam(stringutils.substring(params, 0, 2000));\n    }\n\n    /**\n     * \n     */\n    private log getannotationlog(joinpoint joinpoint) throws exception {\n        signature signature = joinpoint.getsignature();\n        methodsignature methodsignature = (methodsignature) signature;\n        method method = methodsignature.getmethod();\n\n        if (method != null)\n        {\n            return method.getannotation(log.class);\n        }\n        return null;\n    }\n}\n\n\n * @log\n\ncrud, \n\n@controller\n@requestmapping("/system/dept")\npublic class deptcontroller extends basecontroller {\n    private string prefix = "system/dept";\n\n    @autowired\n    private ideptservice deptservice;\n    \n    /**\n     * \n     */\n    @log(title = "", businesstype = businesstype.insert)\n    @requirespermissions("system:dept:add")\n    @postmapping("/add")\n    @responsebody\n    public ajaxresult addsave(@validated dept dept) {\n        if (userconstants.dept_name_not_unique.equals(deptservice.checkdeptnameunique(dept))) {\n            return error("\'" + dept.getdeptname() + "\'");\n        }\n        return toajax(deptservice.insertdept(dept));\n    }\n\n    /**\n     * \n     */\n    @log(title = "", businesstype = businesstype.update)\n    @requirespermissions("system:dept:edit")\n    @postmapping("/edit")\n    @responsebody\n    public ajaxresult editsave(@validated dept dept) {\n        if (userconstants.dept_name_not_unique.equals(deptservice.checkdeptnameunique(dept))) {\n            return error("\'" + dept.getdeptname() + "\'");\n        } else if(dept.getparentid().equals(dept.getdeptid())) {\n            return error("\'" + dept.getdeptname() + "\'");\n        }\n        return toajax(deptservice.updatedept(dept));\n    }\n\n    /**\n     * \n     */\n    @log(title = "", businesstype = businesstype.delete)\n    @requirespermissions("system:dept:remove")\n    @getmapping("/remove/{deptid}")\n    @responsebody\n    public ajaxresult remove(@pathvariable("deptid") long deptid) {\n        if (deptservice.selectdeptcount(deptid) > 0) {\n            return ajaxresult.warn(",");\n        }\n        if (deptservice.checkdeptexistuser(deptid)) {\n            return ajaxresult.warn(",");\n        }\n        return toajax(deptservice.deletedeptbyid(deptid));\n    }\n\n  // ...\n}\n\n\n> @requirespermissions+aop\n\n\n# \n\n * https://blog.csdn.net/javazejian/article/details/71860633\n * https://blog.csdn.net/qq_20009015/article/details/106038023\n * https://www.zhihu.com/question/47449512\n * https://www.race604.com/annotation-processing/\n * https://www.runoob.com/w3cnote/java-annotation.html\n *  https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html',charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-lan-basic.html",relativePath:"java/basic/java-basic-lan-basic.md",key:"v-85306db0",path:"/java/basic/java-basic-lan-basic.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:62},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:74},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:86},{level:2,title:"String",slug:"string",normalizedTitle:"string",charIndex:95},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:109},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:119},{level:3,title:"String, StringBuffer and StringBuilder",slug:"string-stringbuffer-and-stringbuilder",normalizedTitle:"string, stringbuffer and stringbuilder",charIndex:133},{level:3,title:"String.intern()",slug:"string-intern",normalizedTitle:"string.intern()",charIndex:179},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:200},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:210},{level:3,title:"float  double",slug:"float--double",normalizedTitle:"float  double",charIndex:222},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:244},{level:3,title:"switch",slug:"switch",normalizedTitle:"switch",charIndex:258},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:270},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:280},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:292},{level:3,title:"super",slug:"super",normalizedTitle:"super",charIndex:306},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:319},{level:2,title:"Object ",slug:"object-",normalizedTitle:"object ",charIndex:330},{level:3,title:"",slug:"-2",normalizedTitle:"",charIndex:109},{level:3,title:"equals()",slug:"equals",normalizedTitle:"equals()",charIndex:359},{level:3,title:"hashCode()",slug:"hashcode",normalizedTitle:"hashcode()",charIndex:375},{level:3,title:"toString()",slug:"tostring",normalizedTitle:"tostring()",charIndex:393},{level:3,title:"clone()",slug:"clone",normalizedTitle:"clone()",charIndex:411},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:424},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:435},{level:3,title:"static",slug:"static",normalizedTitle:"static",charIndex:448},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:460},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:468},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:476},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:484},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:492},{level:3,title:"Java ",slug:"java-",normalizedTitle:"java ",charIndex:502},{level:3,title:"Java  C++ ",slug:"java--c-",normalizedTitle:"java  c++ ",charIndex:522},{level:3,title:"JRE or JDK",slug:"jre-or-jdk",normalizedTitle:"jre or jdk",charIndex:544},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:560}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -     String   String, StringBuffer and StringBuilder String.intern()   float  double  switch    super  Object   equals() hashCode() toString() clone()  final static      Java  Java  C++  JRE or JDK ",content:'# Java  - \n\n> Java\n\n * Java  - \n   * \n     * \n     * \n   * String\n     * \n     * \n     * String, StringBuffer and StringBuilder\n     * String.intern()\n   * \n     * \n     * float  double\n     * \n     * switch\n   * \n     * \n     * \n     * super\n     * \n   * Object \n     * \n     * equals()\n     * hashCode()\n     * toString()\n     * clone()\n   * \n     * final\n     * static\n   * \n   * \n   * \n   * \n   * \n     * Java \n     * Java  C++ \n     * JRE or JDK\n   * \n\n\n# \n\n\n# \n\n:\n\n * boolean/1\n * byte/8\n * char/16\n * short/16\n * int/32\n * float/32\n * long/64\n * double/64\n\n\n\nInteger x = 2;     // \nint y = x;         // \n\n\n\n# \n\nnew Integer(123)  Integer.valueOf(123) :\n\n * new Integer(123) \n * Integer.valueOf(123) \n\nInteger x = new Integer(123);\nInteger y = new Integer(123);\nSystem.out.println(x == y);    // false\nInteger z = Integer.valueOf(123);\nInteger k = Integer.valueOf(123);\nSystem.out.println(z == k);   // true\n\n\nvalueOf() \n\npublic static Integer valueOf(int i) {\n    if (i >= IntegerCache.low && i <= IntegerCache.high)\n        return IntegerCache.cache[i + (-IntegerCache.low)];\n    return new Integer(i);\n}\n\n\n Java 8 Integer  -128~127\n\nstatic final int low = -128;\nstatic final int high;\nstatic final Integer cache[];\n\nstatic {\n    // high value may be configured by property\n    int h = 127;\n    String integerCacheHighPropValue =\n        sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");\n    if (integerCacheHighPropValue != null) {\n        try {\n            int i = parseInt(integerCacheHighPropValue);\n            i = Math.max(i, 127);\n            // Maximum array size is Integer.MAX_VALUE\n            h = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n        } catch( NumberFormatException nfe) {\n            // If the property cannot be parsed into an int, ignore it.\n        }\n    }\n    high = h;\n\n    cache = new Integer[(high - low) + 1];\n    int j = low;\n    for(int k = 0; k < cache.length; k++)\n        cache[k] = new Integer(j++);\n\n    // range [-128, 127] must be interned (JLS7 5.1.7)\n    assert IntegerCache.high >= 127;\n}\n\n\n valueOf()  Integer \n\nInteger m = 123;\nInteger n = 123;\nSystem.out.println(m == n); // true\n\n\n:\n\n * boolean values true and false\n * all byte values\n * short values between -128 and 127\n * int values between -128 and 127\n * char in the range \\u0000 to \\u007F\n\n\n\n\n\nInteger m = 323;\nInteger n = 323;\nSystem.out.println(m == n); // false\n\n\n\n# String\n\n\n# \n\nString  final\n\n char  final value  String  value  String \n\npublic final class String\n    implements java.io.Serializable, Comparable<String>, CharSequence {\n    /** The value is used for character storage. */\n    private final char value[];\n\n\n\n# \n\n1.  hash \n\n String  hash  String  HashMap  key hash \n\n2. String Pool \n\n String  String Pool  String  String Pool\n\n\n\n3. \n\nString String  String String  String \n\n4. \n\nString \n\nProgram Creek : Why String is immutable in Java?\n\n\n# String, StringBuffer and StringBuilder\n\n1. \n\n * String \n * StringBuffer  StringBuilder \n\n2. \n\n * String \n * StringBuilder \n * StringBuffer  synchronized \n\nStackOverflow : String, StringBuffer, and StringBuilder\n\n\n# String.intern()\n\n String.intern() \n\ns1  s2  new String()  s3  s1.intern() intern()  s1  String Pool() s3  s1 \n\nString s1 = new String("aaa");\nString s2 = new String("aaa");\nSystem.out.println(s1 == s2);           // false\nString s3 = s1.intern();\nSystem.out.println(s1.intern() == s3);  // true\n\n\n "bbb"  String Pool \n\nString s4 = "bbb";\nString s5 = "bbb";\nSystem.out.println(s4 == s5);  // true\n\n\n * HotSpot\n\n 1. Runtime Constant Pool\n 2.  HotSpot \n 3. HotSpotHotSpotJDK\n\nJDK                                       \njdk1.6                    HotSpot\njdk1.7                   HotSpot\njdk1.8      HotSpot\n\n\n# \n\n\n# \n\nJava \n\n Dog dog  dog \n\npublic class Dog {\n    String name;\n\n    Dog(String name) {\n        this.name = name;\n    }\n\n    String getName() {\n        return this.name;\n    }\n\n    void setName(String name) {\n        this.name = name;\n    }\n\n    String getObjectAddress() {\n        return super.toString();\n    }\n}\n\n\npublic class PassByValueExample {\n    public static void main(String[] args) {\n        Dog dog = new Dog("A");\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        func(dog);\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        System.out.println(dog.getName());          // A\n    }\n\n    private static void func(Dog dog) {\n        System.out.println(dog.getObjectAddress()); // Dog@4554617c\n        dog = new Dog("B");\n        System.out.println(dog.getObjectAddress()); // Dog@74a14482\n        System.out.println(dog.getName());          // B\n    }\n}\n\n\n\n\nclass PassByValueExample {\n    public static void main(String[] args) {\n        Dog dog = new Dog("A");\n        func(dog);\n        System.out.println(dog.getName());          // B\n    }\n\n    private static void func(Dog dog) {\n        dog.setName("B");\n    }\n}\n\n\nStackOverflow: Is Java pass-by-reference or pass-by-value?\n\n\n# float  double\n\n1.1  double  1.1  float Java \n\n1.1f  float \n\n\n# \n\n 1  int  short  int  short \n\nshort s1 = 1;\n// s1 = s1 + 1;\n\n\n += \n\n s1 + 1 :\n\nStackOverflow : Why don\'t Java\'s +=, -=, *=, /= compound assignment operators require casting?\n\n\n# switch\n\n Java 7  switch  String \n\nString s = "a";\nswitch (s) {\n    case "a":\n        System.out.println("aaa");\n        break;\n    case "b":\n        System.out.println("bbb");\n        break;\n}\n\n\nswitch  long switch  if \n\n// long x = 111;\n// switch (x) { // Incompatible types. Found: \'long\', required: \'char, byte, short, int, Character, Byte, Short, Integer, String, or an enum\'\n//     case 111:\n//         System.out.println(111);\n//         break;\n//     case 222:\n//         System.out.println(222);\n//         break;\n// }\n\n\nStackOverflow : Why can\'t your switch statement data type be long, Java?\n\n\n# \n\n\n# \n\nJava : privateprotected  public\n\n()\n\n * \n * \n\nprotected \n\n API  API \n\n\n\nAccessExample  id  int  id \n\npublic class AccessExample {\n    public String id;\n}\n\n\n getter  setter \n\npublic class AccessExample {\n\n    private int id;\n\n    public String getId() {\n        return id + "";\n    }\n\n    public void setId(String id) {\n        this.id = Integer.valueOf(id);\n    }\n}\n\n\n\n\npublic class AccessWithInnerClassExample {\n    private class InnerClass {\n        int x;\n    }\n\n    private InnerClass innerClass;\n\n    public AccessWithInnerClassExample() {\n        innerClass = new InnerClass();\n    }\n\n    public int getValue() {\n        return innerClass.x;  // \n    }\n}\n\n\n\n# \n\n1. \n\n abstract \n\n\n\npublic abstract class AbstractClassExample {\n\n    protected int x;\n    private int y;\n\n    public abstract void func1();\n\n    public void func2() {\n        System.out.println("func2");\n    }\n}\n\n\npublic class AbstractExtendClassExample extends AbstractClassExample {\n    @Override\n    public void func1() {\n        System.out.println("func1");\n    }\n}\n\n\n// AbstractClassExample ac1 = new AbstractClassExample(); // \'AbstractClassExample\' is abstract; cannot be instantiated\nAbstractClassExample ac2 = new AbstractExtendClassExample();\nac2.func1();\n\n\n2. \n\n Java 8 \n\n Java 8  Java 8 \n\n( + ) public  private  protected\n\n static  final \n\npublic interface InterfaceExample {\n    void func1();\n\n    default void func2(){\n        System.out.println("func2");\n    }\n\n    int x = 123;\n    // int y;               // Variable \'y\' might not have been initialized\n    public int z = 0;       // Modifier \'public\' is redundant for interface fields\n    // private int k = 0;   // Modifier \'private\' not allowed here\n    // protected int l = 0; // Modifier \'protected\' not allowed here\n    // private void fun3(); // Modifier \'private\' not allowed here\n}\n\n\npublic class InterfaceImplementExample implements InterfaceExample {\n    @Override\n    public void func1() {\n        System.out.println("func1");\n    }\n}\n\n\n// InterfaceExample ie1 = new InterfaceExample(); // \'InterfaceExample\' is abstract; cannot be instantiated\nInterfaceExample ie2 = new InterfaceImplementExample();\nie2.func1();\nSystem.out.println(InterfaceExample.x);\n\n\n3. \n\n *  IS-A  LIKE-A  IS-A \n * \n *  static  final \n *  public \n\n4. \n\n:\n\n *  Compareable  compareTo() \n * \n\n:\n\n * \n *  public\n * \n\n Java 8 \n\n *  abstract class  interface\n * When to Use Abstract Class and Interface\n\n\n# super\n\n * :  super() \n * :  super \n\npublic class SuperExample {\n    protected int x;\n    protected int y;\n\n    public SuperExample(int x, int y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    public void func() {\n        System.out.println("SuperExample.func()");\n    }\n}\n\n\npublic class SuperExtendExample extends SuperExample {\n    private int z;\n\n    public SuperExtendExample(int x, int y, int z) {\n        super(x, y);\n        this.z = z;\n    }\n\n    @Override\n    public void func() {\n        super.func();\n        System.out.println("SuperExtendExample.func()");\n    }\n}\n\n\nSuperExample e = new SuperExtendExample(1, 2, 3);\ne.func();\n\n\nSuperExample.func()\nSuperExtendExample.func()\n\n\nUsing the Keyword super\n\n\n# \n\n1. (Override)\n\n\n\n:\n\n * \n * \n\n @Override \n\n2. (Overload)\n\n\n\n\n\n\n# Object \n\n\n# \n\npublic final native Class<?> getClass()\n\npublic native int hashCode()\n\npublic boolean equals(Object obj)\n\nprotected native Object clone() throws CloneNotSupportedException\n\npublic String toString()\n\npublic final native void notify()\n\npublic final native void notifyAll()\n\npublic final native void wait(long timeout) throws InterruptedException\n\npublic final void wait(long timeout, int nanos) throws InterruptedException\n\npublic final void wait() throws InterruptedException\n\nprotected void finalize() throws Throwable {}\n\n\n\n# equals()\n\n1. \n\n()\n\n()\n\nx.equals(y) == y.equals(x); // true\n\n\n()\n\nif (x.equals(y) && y.equals(z))\n    x.equals(z); // true;\n\n\n()\n\n equals() \n\nx.equals(y) == x.equals(y); // true\n\n\n() null \n\n null  x  x.equals(null)  false\n\nx.equals(null); // false;\n\n\n2. equals()  ==\n\n * ==  equals() \n * ==  equals() \n\nInteger x = new Integer(1);\nInteger y = new Integer(1);\nSystem.out.println(x.equals(y)); // true\nSystem.out.println(x == y);      // false\n\n\n3. \n\n *  true\n *  false\n *  Object \n * \n\npublic class EqualExample {\n    private int x;\n    private int y;\n    private int z;\n\n    public EqualExample(int x, int y, int z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n\n        EqualExample that = (EqualExample) o;\n\n        if (x != that.x) return false;\n        if (y != that.y) return false;\n        return z == that.z;\n    }\n}\n\n\n\n# hashCode()\n\nhashCode()  equals() \n\n equals()  hashCode() \n\n HashSet  EqualExample  hasCode() \n\nEqualExample e1 = new EqualExample(1, 1, 1);\nEqualExample e2 = new EqualExample(1, 1, 1);\nSystem.out.println(e1.equals(e2)); // true\nHashSet<EqualExample> set = new HashSet<>();\nset.add(e1);\nset.add(e2);\nSystem.out.println(set.size());   // 2\n\n\n R  R R  31 2 \n\n 31 : 31*x == (x<<5)-x\n\n@Override\npublic int hashCode() {\n    int result = 17;\n    result = 31 * result + x;\n    result = 31 * result + y;\n    result = 31 * result + z;\n    return result;\n}\n\n\n\n# toString()\n\n ToStringExample@4554617c  @ \n\npublic class ToStringExample {\n    private int number;\n\n    public ToStringExample(int number) {\n        this.number = number;\n    }\n}\n\n\nToStringExample example = new ToStringExample(123);\nSystem.out.println(example.toString());\n\n\n\n# clone()\n\n1. cloneable\n\nclone()  Object  protected  public clone() clone() \n\npublic class CloneExample {\n    private int a;\n    private int b;\n}\n\n\nCloneExample e1 = new CloneExample();\n// CloneExample e2 = e1.clone(); // \'clone()\' has protected access in \'java.lang.Object\'\n\n\n clone() :\n\npublic class CloneExample {\n    private int a;\n    private int b;\n\n    @Override\n    protected CloneExample clone() throws CloneNotSupportedException {\n        return (CloneExample)super.clone();\n    }\n}\n\n\nCloneExample e1 = new CloneExample();\ntry {\n    CloneExample e2 = e1.clone();\n} catch (CloneNotSupportedException e) {\n    e.printStackTrace();\n}\n\n\njava.lang.CloneNotSupportedException: CloneExample\n\n\n CloneNotSupportedException CloneExample  Cloneable \n\nclone()  Cloneable  Object  protected Cloneable  Cloneable  clone()  CloneNotSupportedException\n\npublic class CloneExample implements Cloneable {\n    private int a;\n    private int b;\n\n    @Override\n    protected Object clone() throws CloneNotSupportedException {\n        return super.clone();\n    }\n}\n\n\n2. \n\n\n\npublic class ShallowCloneExample implements Cloneable {\n    private int[] arr;\n\n    public ShallowCloneExample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n\n    @Override\n    protected ShallowCloneExample clone() throws CloneNotSupportedException {\n        return (ShallowCloneExample) super.clone();\n    }\n}\n\n\nShallowCloneExample e1 = new ShallowCloneExample();\nShallowCloneExample e2 = null;\ntry {\n    e2 = e1.clone();\n} catch (CloneNotSupportedException e) {\n    e.printStackTrace();\n}\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 222\n\n\n3. \n\n\n\npublic class DeepCloneExample implements Cloneable {\n    private int[] arr;\n\n    public DeepCloneExample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n\n    @Override\n    protected DeepCloneExample clone() throws CloneNotSupportedException {\n        DeepCloneExample result = (DeepCloneExample) super.clone();\n        result.arr = new int[arr.length];\n        for (int i = 0; i < arr.length; i++) {\n            result.arr[i] = arr[i];\n        }\n        return result;\n    }\n}\n\n\nDeepCloneExample e1 = new DeepCloneExample();\nDeepCloneExample e2 = null;\ntry {\n    e2 = e1.clone();\n} catch (CloneNotSupportedException e) {\n    e.printStackTrace();\n}\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 2\n\n\n4. clone() \n\n clone() Effective Java  clone()\n\npublic class CloneConstructorExample {\n    private int[] arr;\n\n    public CloneConstructorExample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public CloneConstructorExample(CloneConstructorExample original) {\n        arr = new int[original.arr.length];\n        for (int i = 0; i < original.arr.length; i++) {\n            arr[i] = original.arr[i];\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n}\n\n\nCloneConstructorExample e1 = new CloneConstructorExample();\nCloneConstructorExample e2 = new CloneConstructorExample(e1);\ne1.set(2, 222);\nSystem.out.println(e2.get(2)); // 2\n\n\n\n# \n\n\n# final\n\n1. \n\n\n\n * final \n * final \n\nfinal int x = 1;\n// x = 2;  // cannot assign value to final variable \'x\'\nfinal A y = new A();\ny.a = 1;\n\n\n2. \n\n\n\nprivate  final private \n\n3. \n\n\n\n\n# static\n\n1. \n\n * : \n * : \n\npublic class A {\n    private int x;         // \n    private static int y;  // \n\n    public static void main(String[] args) {\n        // int x = A.x;  // Non-static field \'x\' cannot be referenced from a static context\n        A a = new A();\n        int x = a.x;\n        int y = A.y;\n    }\n}\n\n\n2. \n\n(abstract)\n\npublic abstract class A {\n    public static void func1(){\n    }\n    // public abstract static void func2();  // Illegal combination of modifiers: \'abstract\' and \'static\'\n}\n\n\n this  super \n\npublic class A {\n    private static int x;\n    private int y;\n\n    public static void func1(){\n        int a = x;\n        // int b = y;  // Non-static field \'y\' cannot be referenced from a static context\n        // int b = this.y;     // \'A.this\' cannot be referenced from a static context\n    }\n}\n\n\n3. \n\n\n\npublic class A {\n    static {\n        System.out.println("123");\n    }\n\n    public static void main(String[] args) {\n        A a1 = new A();\n        A a2 = new A();\n    }\n}\n\n\n4. \n\n\n\npublic class OuterClass {\n    class InnerClass {\n    }\n\n    static class StaticInnerClass {\n    }\n\n    public static void main(String[] args) {\n        // InnerClass innerClass = new InnerClass(); // \'OuterClass.this\' cannot be referenced from a static context\n        OuterClass outerClass = new OuterClass();\n        InnerClass innerClass = outerClass.new InnerClass();\n        StaticInnerClass staticInnerClass = new StaticInnerClass();\n    }\n}\n\n\n\n\n5. \n\n ClassName\n\nimport static com.xxx.ClassName.*\n\n\n6. \n\n\n\npublic static String staticField = "";\n\n\nstatic {\n    System.out.println("");\n}\n\n\npublic String field = "";\n\n\n{\n    System.out.println("");\n}\n\n\n\n\npublic InitialOrderTest() {\n    System.out.println("");\n}\n\n\n:\n\n * ()\n * ()\n * ()\n * ()\n * ()\n * ()\n\n\n# \n\n Class  .class  Class \n\n Class  JVM  Class.forName("com.mysql.jdbc.Driver")  Class \n\n .class \n\nClass  java.lang.reflect java.lang.reflect :\n\n * Field :  get()  set()  Field \n * Method :  invoke()  Method \n * Constructor :  Constructor \n\nAdvantages of Using Reflection:\n\n * Extensibility Features : An application may make use of external, user-defined classes by creating instances of extensibility objects using their fully-qualified names.\n * Class Browsers and Visual Development Environments : A class browser needs to be able to enumerate the members of classes. Visual development environments can benefit from making use of type information available in reflection to aid the developer in writing correct code.\n * Debuggers and Test Tools : Debuggers need to be able to examine private members on classes. Test harnesses can make use of reflection to systematically call a discoverable set APIs defined on a class, to insure a high level of code coverage in a test suite.\n\nDrawbacks of Reflection:\n\nReflection is powerful, but should not be used indiscriminately. If it is possible to perform an operation without using reflection, then it is preferable to avoid using it. The following concerns should be kept in mind when accessing code via reflection.\n\n * Performance Overhead : Because reflection involves types that are dynamically resolved, certain Java virtual machine optimizations can not be performed. Consequently, reflective operations have slower performance than their non-reflective counterparts, and should be avoided in sections of code which are called frequently in performance-sensitive applications.\n * Security Restrictions : Reflection requires a runtime permission which may not be present when running under a security manager. This is in an important consideration for code which has to run in a restricted security context, such as in an Applet.\n * Exposure of Internals :Since reflection allows code to perform operations that would be illegal in non-reflective code, such as accessing private fields and methods, the use of reflection can result in unexpected side-effects, which may render code dysfunctional and may destroy portability. Reflective code breaks abstractions and therefore may change behavior with upgrades of the platform.\n\nJava  - \n\n\n# \n\nThrowable : Error  Exception Error  JVM Exception :\n\n *  :  try...catch... \n *  :  0  Arithmetic Exception\n\n\n\nJava  - \n\n\n# \n\npublic class Box<T> {\n    // T stands for "Type"\n    private T t;\n    public void set(T t) { this.t = t; }\n    public T get() { return t; }\n}\n\n\nJava  - \n\n\n# \n\nJava \n\nJava  - \n\n\n# \n\n\n# Java \n\nNew highlights in Java SE 8\n\n 1. Lambda Expressions\n 2. Pipelines and Streams\n 3. Date and Time API\n 4. Default Methods\n 5. Type Annotations\n 6. Nashhorn JavaScript Engine\n 7. Concurrent Accumulators\n 8. Parallel operations\n 9. PermGen Error Removed\n\nNew highlights in Java SE 7\n\n 1. Strings in Switch Statement\n 2. Type Inference for Generic Instance Creation\n 3. Multiple Exception Handling\n 4. Support for Dynamic Languages\n 5. Try with Resources\n 6. Java nio Package\n 7. Binary Literals, Underscore in literals\n 8. Diamond Syntax\n\n * Difference between Java 1.8 and Java 1.7?\n * Java 8 \n\n\n# Java  C++ \n\n * Java  java.lang.ObjectC++  C \n * Java  C++ \n * Java  C++  C \n * Java  C++ \n * Java  C++ \n * Java  String  C++ \n * Java  goto C++  goto\n * Java C++  #ifdef #ifndef \n\nWhat are the main differences between Java and C++?\n\n\n# JRE or JDK\n\n * JRE is the JVM program, Java application need to run on JRE.\n * JDK is a superset of JRE, JRE + tools for developing java programs. e.g, it provides the compiler "javac"\n\n\n# \n\n * Eckel B. Java [M]. , 2002.\n * Bloch J. Effective java[M]. Addison-Wesley Professional, 2017.\n *  https://www.pdai.tech/md/java/basic/java-basic-lan-basic.html',normalizedContent:'# java  - \n\n> java\n\n * java  - \n   * \n     * \n     * \n   * string\n     * \n     * \n     * string, stringbuffer and stringbuilder\n     * string.intern()\n   * \n     * \n     * float  double\n     * \n     * switch\n   * \n     * \n     * \n     * super\n     * \n   * object \n     * \n     * equals()\n     * hashcode()\n     * tostring()\n     * clone()\n   * \n     * final\n     * static\n   * \n   * \n   * \n   * \n   * \n     * java \n     * java  c++ \n     * jre or jdk\n   * \n\n\n# \n\n\n# \n\n:\n\n * boolean/1\n * byte/8\n * char/16\n * short/16\n * int/32\n * float/32\n * long/64\n * double/64\n\n\n\ninteger x = 2;     // \nint y = x;         // \n\n\n\n# \n\nnew integer(123)  integer.valueof(123) :\n\n * new integer(123) \n * integer.valueof(123) \n\ninteger x = new integer(123);\ninteger y = new integer(123);\nsystem.out.println(x == y);    // false\ninteger z = integer.valueof(123);\ninteger k = integer.valueof(123);\nsystem.out.println(z == k);   // true\n\n\nvalueof() \n\npublic static integer valueof(int i) {\n    if (i >= integercache.low && i <= integercache.high)\n        return integercache.cache[i + (-integercache.low)];\n    return new integer(i);\n}\n\n\n java 8 integer  -128~127\n\nstatic final int low = -128;\nstatic final int high;\nstatic final integer cache[];\n\nstatic {\n    // high value may be configured by property\n    int h = 127;\n    string integercachehighpropvalue =\n        sun.misc.vm.getsavedproperty("java.lang.integer.integercache.high");\n    if (integercachehighpropvalue != null) {\n        try {\n            int i = parseint(integercachehighpropvalue);\n            i = math.max(i, 127);\n            // maximum array size is integer.max_value\n            h = math.min(i, integer.max_value - (-low) -1);\n        } catch( numberformatexception nfe) {\n            // if the property cannot be parsed into an int, ignore it.\n        }\n    }\n    high = h;\n\n    cache = new integer[(high - low) + 1];\n    int j = low;\n    for(int k = 0; k < cache.length; k++)\n        cache[k] = new integer(j++);\n\n    // range [-128, 127] must be interned (jls7 5.1.7)\n    assert integercache.high >= 127;\n}\n\n\n valueof()  integer \n\ninteger m = 123;\ninteger n = 123;\nsystem.out.println(m == n); // true\n\n\n:\n\n * boolean values true and false\n * all byte values\n * short values between -128 and 127\n * int values between -128 and 127\n * char in the range \\u0000 to \\u007f\n\n\n\n\n\ninteger m = 323;\ninteger n = 323;\nsystem.out.println(m == n); // false\n\n\n\n# string\n\n\n# \n\nstring  final\n\n char  final value  string  value  string \n\npublic final class string\n    implements java.io.serializable, comparable<string>, charsequence {\n    /** the value is used for character storage. */\n    private final char value[];\n\n\n\n# \n\n1.  hash \n\n string  hash  string  hashmap  key hash \n\n2. string pool \n\n string  string pool  string  string pool\n\n\n\n3. \n\nstring string  string string  string \n\n4. \n\nstring \n\nprogram creek : why string is immutable in java?\n\n\n# string, stringbuffer and stringbuilder\n\n1. \n\n * string \n * stringbuffer  stringbuilder \n\n2. \n\n * string \n * stringbuilder \n * stringbuffer  synchronized \n\nstackoverflow : string, stringbuffer, and stringbuilder\n\n\n# string.intern()\n\n string.intern() \n\ns1  s2  new string()  s3  s1.intern() intern()  s1  string pool() s3  s1 \n\nstring s1 = new string("aaa");\nstring s2 = new string("aaa");\nsystem.out.println(s1 == s2);           // false\nstring s3 = s1.intern();\nsystem.out.println(s1.intern() == s3);  // true\n\n\n "bbb"  string pool \n\nstring s4 = "bbb";\nstring s5 = "bbb";\nsystem.out.println(s4 == s5);  // true\n\n\n * hotspot\n\n 1. runtime constant pool\n 2.  hotspot \n 3. hotspothotspotjdk\n\njdk                                       \njdk1.6                    hotspot\njdk1.7                   hotspot\njdk1.8      hotspot\n\n\n# \n\n\n# \n\njava \n\n dog dog  dog \n\npublic class dog {\n    string name;\n\n    dog(string name) {\n        this.name = name;\n    }\n\n    string getname() {\n        return this.name;\n    }\n\n    void setname(string name) {\n        this.name = name;\n    }\n\n    string getobjectaddress() {\n        return super.tostring();\n    }\n}\n\n\npublic class passbyvalueexample {\n    public static void main(string[] args) {\n        dog dog = new dog("a");\n        system.out.println(dog.getobjectaddress()); // dog@4554617c\n        func(dog);\n        system.out.println(dog.getobjectaddress()); // dog@4554617c\n        system.out.println(dog.getname());          // a\n    }\n\n    private static void func(dog dog) {\n        system.out.println(dog.getobjectaddress()); // dog@4554617c\n        dog = new dog("b");\n        system.out.println(dog.getobjectaddress()); // dog@74a14482\n        system.out.println(dog.getname());          // b\n    }\n}\n\n\n\n\nclass passbyvalueexample {\n    public static void main(string[] args) {\n        dog dog = new dog("a");\n        func(dog);\n        system.out.println(dog.getname());          // b\n    }\n\n    private static void func(dog dog) {\n        dog.setname("b");\n    }\n}\n\n\nstackoverflow: is java pass-by-reference or pass-by-value?\n\n\n# float  double\n\n1.1  double  1.1  float java \n\n1.1f  float \n\n\n# \n\n 1  int  short  int  short \n\nshort s1 = 1;\n// s1 = s1 + 1;\n\n\n += \n\n s1 + 1 :\n\nstackoverflow : why don\'t java\'s +=, -=, *=, /= compound assignment operators require casting?\n\n\n# switch\n\n java 7  switch  string \n\nstring s = "a";\nswitch (s) {\n    case "a":\n        system.out.println("aaa");\n        break;\n    case "b":\n        system.out.println("bbb");\n        break;\n}\n\n\nswitch  long switch  if \n\n// long x = 111;\n// switch (x) { // incompatible types. found: \'long\', required: \'char, byte, short, int, character, byte, short, integer, string, or an enum\'\n//     case 111:\n//         system.out.println(111);\n//         break;\n//     case 222:\n//         system.out.println(222);\n//         break;\n// }\n\n\nstackoverflow : why can\'t your switch statement data type be long, java?\n\n\n# \n\n\n# \n\njava : privateprotected  public\n\n()\n\n * \n * \n\nprotected \n\n api  api \n\n\n\naccessexample  id  int  id \n\npublic class accessexample {\n    public string id;\n}\n\n\n getter  setter \n\npublic class accessexample {\n\n    private int id;\n\n    public string getid() {\n        return id + "";\n    }\n\n    public void setid(string id) {\n        this.id = integer.valueof(id);\n    }\n}\n\n\n\n\npublic class accesswithinnerclassexample {\n    private class innerclass {\n        int x;\n    }\n\n    private innerclass innerclass;\n\n    public accesswithinnerclassexample() {\n        innerclass = new innerclass();\n    }\n\n    public int getvalue() {\n        return innerclass.x;  // \n    }\n}\n\n\n\n# \n\n1. \n\n abstract \n\n\n\npublic abstract class abstractclassexample {\n\n    protected int x;\n    private int y;\n\n    public abstract void func1();\n\n    public void func2() {\n        system.out.println("func2");\n    }\n}\n\n\npublic class abstractextendclassexample extends abstractclassexample {\n    @override\n    public void func1() {\n        system.out.println("func1");\n    }\n}\n\n\n// abstractclassexample ac1 = new abstractclassexample(); // \'abstractclassexample\' is abstract; cannot be instantiated\nabstractclassexample ac2 = new abstractextendclassexample();\nac2.func1();\n\n\n2. \n\n java 8 \n\n java 8  java 8 \n\n( + ) public  private  protected\n\n static  final \n\npublic interface interfaceexample {\n    void func1();\n\n    default void func2(){\n        system.out.println("func2");\n    }\n\n    int x = 123;\n    // int y;               // variable \'y\' might not have been initialized\n    public int z = 0;       // modifier \'public\' is redundant for interface fields\n    // private int k = 0;   // modifier \'private\' not allowed here\n    // protected int l = 0; // modifier \'protected\' not allowed here\n    // private void fun3(); // modifier \'private\' not allowed here\n}\n\n\npublic class interfaceimplementexample implements interfaceexample {\n    @override\n    public void func1() {\n        system.out.println("func1");\n    }\n}\n\n\n// interfaceexample ie1 = new interfaceexample(); // \'interfaceexample\' is abstract; cannot be instantiated\ninterfaceexample ie2 = new interfaceimplementexample();\nie2.func1();\nsystem.out.println(interfaceexample.x);\n\n\n3. \n\n *  is-a  like-a  is-a \n * \n *  static  final \n *  public \n\n4. \n\n:\n\n *  compareable  compareto() \n * \n\n:\n\n * \n *  public\n * \n\n java 8 \n\n *  abstract class  interface\n * when to use abstract class and interface\n\n\n# super\n\n * :  super() \n * :  super \n\npublic class superexample {\n    protected int x;\n    protected int y;\n\n    public superexample(int x, int y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    public void func() {\n        system.out.println("superexample.func()");\n    }\n}\n\n\npublic class superextendexample extends superexample {\n    private int z;\n\n    public superextendexample(int x, int y, int z) {\n        super(x, y);\n        this.z = z;\n    }\n\n    @override\n    public void func() {\n        super.func();\n        system.out.println("superextendexample.func()");\n    }\n}\n\n\nsuperexample e = new superextendexample(1, 2, 3);\ne.func();\n\n\nsuperexample.func()\nsuperextendexample.func()\n\n\nusing the keyword super\n\n\n# \n\n1. (override)\n\n\n\n:\n\n * \n * \n\n @override \n\n2. (overload)\n\n\n\n\n\n\n# object \n\n\n# \n\npublic final native class<?> getclass()\n\npublic native int hashcode()\n\npublic boolean equals(object obj)\n\nprotected native object clone() throws clonenotsupportedexception\n\npublic string tostring()\n\npublic final native void notify()\n\npublic final native void notifyall()\n\npublic final native void wait(long timeout) throws interruptedexception\n\npublic final void wait(long timeout, int nanos) throws interruptedexception\n\npublic final void wait() throws interruptedexception\n\nprotected void finalize() throws throwable {}\n\n\n\n# equals()\n\n1. \n\n()\n\n()\n\nx.equals(y) == y.equals(x); // true\n\n\n()\n\nif (x.equals(y) && y.equals(z))\n    x.equals(z); // true;\n\n\n()\n\n equals() \n\nx.equals(y) == x.equals(y); // true\n\n\n() null \n\n null  x  x.equals(null)  false\n\nx.equals(null); // false;\n\n\n2. equals()  ==\n\n * ==  equals() \n * ==  equals() \n\ninteger x = new integer(1);\ninteger y = new integer(1);\nsystem.out.println(x.equals(y)); // true\nsystem.out.println(x == y);      // false\n\n\n3. \n\n *  true\n *  false\n *  object \n * \n\npublic class equalexample {\n    private int x;\n    private int y;\n    private int z;\n\n    public equalexample(int x, int y, int z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    @override\n    public boolean equals(object o) {\n        if (this == o) return true;\n        if (o == null || getclass() != o.getclass()) return false;\n\n        equalexample that = (equalexample) o;\n\n        if (x != that.x) return false;\n        if (y != that.y) return false;\n        return z == that.z;\n    }\n}\n\n\n\n# hashcode()\n\nhashcode()  equals() \n\n equals()  hashcode() \n\n hashset  equalexample  hascode() \n\nequalexample e1 = new equalexample(1, 1, 1);\nequalexample e2 = new equalexample(1, 1, 1);\nsystem.out.println(e1.equals(e2)); // true\nhashset<equalexample> set = new hashset<>();\nset.add(e1);\nset.add(e2);\nsystem.out.println(set.size());   // 2\n\n\n r  r r  31 2 \n\n 31 : 31*x == (x<<5)-x\n\n@override\npublic int hashcode() {\n    int result = 17;\n    result = 31 * result + x;\n    result = 31 * result + y;\n    result = 31 * result + z;\n    return result;\n}\n\n\n\n# tostring()\n\n tostringexample@4554617c  @ \n\npublic class tostringexample {\n    private int number;\n\n    public tostringexample(int number) {\n        this.number = number;\n    }\n}\n\n\ntostringexample example = new tostringexample(123);\nsystem.out.println(example.tostring());\n\n\n\n# clone()\n\n1. cloneable\n\nclone()  object  protected  public clone() clone() \n\npublic class cloneexample {\n    private int a;\n    private int b;\n}\n\n\ncloneexample e1 = new cloneexample();\n// cloneexample e2 = e1.clone(); // \'clone()\' has protected access in \'java.lang.object\'\n\n\n clone() :\n\npublic class cloneexample {\n    private int a;\n    private int b;\n\n    @override\n    protected cloneexample clone() throws clonenotsupportedexception {\n        return (cloneexample)super.clone();\n    }\n}\n\n\ncloneexample e1 = new cloneexample();\ntry {\n    cloneexample e2 = e1.clone();\n} catch (clonenotsupportedexception e) {\n    e.printstacktrace();\n}\n\n\njava.lang.clonenotsupportedexception: cloneexample\n\n\n clonenotsupportedexception cloneexample  cloneable \n\nclone()  cloneable  object  protected cloneable  cloneable  clone()  clonenotsupportedexception\n\npublic class cloneexample implements cloneable {\n    private int a;\n    private int b;\n\n    @override\n    protected object clone() throws clonenotsupportedexception {\n        return super.clone();\n    }\n}\n\n\n2. \n\n\n\npublic class shallowcloneexample implements cloneable {\n    private int[] arr;\n\n    public shallowcloneexample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n\n    @override\n    protected shallowcloneexample clone() throws clonenotsupportedexception {\n        return (shallowcloneexample) super.clone();\n    }\n}\n\n\nshallowcloneexample e1 = new shallowcloneexample();\nshallowcloneexample e2 = null;\ntry {\n    e2 = e1.clone();\n} catch (clonenotsupportedexception e) {\n    e.printstacktrace();\n}\ne1.set(2, 222);\nsystem.out.println(e2.get(2)); // 222\n\n\n3. \n\n\n\npublic class deepcloneexample implements cloneable {\n    private int[] arr;\n\n    public deepcloneexample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n\n    @override\n    protected deepcloneexample clone() throws clonenotsupportedexception {\n        deepcloneexample result = (deepcloneexample) super.clone();\n        result.arr = new int[arr.length];\n        for (int i = 0; i < arr.length; i++) {\n            result.arr[i] = arr[i];\n        }\n        return result;\n    }\n}\n\n\ndeepcloneexample e1 = new deepcloneexample();\ndeepcloneexample e2 = null;\ntry {\n    e2 = e1.clone();\n} catch (clonenotsupportedexception e) {\n    e.printstacktrace();\n}\ne1.set(2, 222);\nsystem.out.println(e2.get(2)); // 2\n\n\n4. clone() \n\n clone() effective java  clone()\n\npublic class cloneconstructorexample {\n    private int[] arr;\n\n    public cloneconstructorexample() {\n        arr = new int[10];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = i;\n        }\n    }\n\n    public cloneconstructorexample(cloneconstructorexample original) {\n        arr = new int[original.arr.length];\n        for (int i = 0; i < original.arr.length; i++) {\n            arr[i] = original.arr[i];\n        }\n    }\n\n    public void set(int index, int value) {\n        arr[index] = value;\n    }\n\n    public int get(int index) {\n        return arr[index];\n    }\n}\n\n\ncloneconstructorexample e1 = new cloneconstructorexample();\ncloneconstructorexample e2 = new cloneconstructorexample(e1);\ne1.set(2, 222);\nsystem.out.println(e2.get(2)); // 2\n\n\n\n# \n\n\n# final\n\n1. \n\n\n\n * final \n * final \n\nfinal int x = 1;\n// x = 2;  // cannot assign value to final variable \'x\'\nfinal a y = new a();\ny.a = 1;\n\n\n2. \n\n\n\nprivate  final private \n\n3. \n\n\n\n\n# static\n\n1. \n\n * : \n * : \n\npublic class a {\n    private int x;         // \n    private static int y;  // \n\n    public static void main(string[] args) {\n        // int x = a.x;  // non-static field \'x\' cannot be referenced from a static context\n        a a = new a();\n        int x = a.x;\n        int y = a.y;\n    }\n}\n\n\n2. \n\n(abstract)\n\npublic abstract class a {\n    public static void func1(){\n    }\n    // public abstract static void func2();  // illegal combination of modifiers: \'abstract\' and \'static\'\n}\n\n\n this  super \n\npublic class a {\n    private static int x;\n    private int y;\n\n    public static void func1(){\n        int a = x;\n        // int b = y;  // non-static field \'y\' cannot be referenced from a static context\n        // int b = this.y;     // \'a.this\' cannot be referenced from a static context\n    }\n}\n\n\n3. \n\n\n\npublic class a {\n    static {\n        system.out.println("123");\n    }\n\n    public static void main(string[] args) {\n        a a1 = new a();\n        a a2 = new a();\n    }\n}\n\n\n4. \n\n\n\npublic class outerclass {\n    class innerclass {\n    }\n\n    static class staticinnerclass {\n    }\n\n    public static void main(string[] args) {\n        // innerclass innerclass = new innerclass(); // \'outerclass.this\' cannot be referenced from a static context\n        outerclass outerclass = new outerclass();\n        innerclass innerclass = outerclass.new innerclass();\n        staticinnerclass staticinnerclass = new staticinnerclass();\n    }\n}\n\n\n\n\n5. \n\n classname\n\nimport static com.xxx.classname.*\n\n\n6. \n\n\n\npublic static string staticfield = "";\n\n\nstatic {\n    system.out.println("");\n}\n\n\npublic string field = "";\n\n\n{\n    system.out.println("");\n}\n\n\n\n\npublic initialordertest() {\n    system.out.println("");\n}\n\n\n:\n\n * ()\n * ()\n * ()\n * ()\n * ()\n * ()\n\n\n# \n\n class  .class  class \n\n class  jvm  class.forname("com.mysql.jdbc.driver")  class \n\n .class \n\nclass  java.lang.reflect java.lang.reflect :\n\n * field :  get()  set()  field \n * method :  invoke()  method \n * constructor :  constructor \n\nadvantages of using reflection:\n\n * extensibility features : an application may make use of external, user-defined classes by creating instances of extensibility objects using their fully-qualified names.\n * class browsers and visual development environments : a class browser needs to be able to enumerate the members of classes. visual development environments can benefit from making use of type information available in reflection to aid the developer in writing correct code.\n * debuggers and test tools : debuggers need to be able to examine private members on classes. test harnesses can make use of reflection to systematically call a discoverable set apis defined on a class, to insure a high level of code coverage in a test suite.\n\ndrawbacks of reflection:\n\nreflection is powerful, but should not be used indiscriminately. if it is possible to perform an operation without using reflection, then it is preferable to avoid using it. the following concerns should be kept in mind when accessing code via reflection.\n\n * performance overhead : because reflection involves types that are dynamically resolved, certain java virtual machine optimizations can not be performed. consequently, reflective operations have slower performance than their non-reflective counterparts, and should be avoided in sections of code which are called frequently in performance-sensitive applications.\n * security restrictions : reflection requires a runtime permission which may not be present when running under a security manager. this is in an important consideration for code which has to run in a restricted security context, such as in an applet.\n * exposure of internals :since reflection allows code to perform operations that would be illegal in non-reflective code, such as accessing private fields and methods, the use of reflection can result in unexpected side-effects, which may render code dysfunctional and may destroy portability. reflective code breaks abstractions and therefore may change behavior with upgrades of the platform.\n\njava  - \n\n\n# \n\nthrowable : error  exception error  jvm exception :\n\n *  :  try...catch... \n *  :  0  arithmetic exception\n\n\n\njava  - \n\n\n# \n\npublic class box<t> {\n    // t stands for "type"\n    private t t;\n    public void set(t t) { this.t = t; }\n    public t get() { return t; }\n}\n\n\njava  - \n\n\n# \n\njava \n\njava  - \n\n\n# \n\n\n# java \n\nnew highlights in java se 8\n\n 1. lambda expressions\n 2. pipelines and streams\n 3. date and time api\n 4. default methods\n 5. type annotations\n 6. nashhorn javascript engine\n 7. concurrent accumulators\n 8. parallel operations\n 9. permgen error removed\n\nnew highlights in java se 7\n\n 1. strings in switch statement\n 2. type inference for generic instance creation\n 3. multiple exception handling\n 4. support for dynamic languages\n 5. try with resources\n 6. java nio package\n 7. binary literals, underscore in literals\n 8. diamond syntax\n\n * difference between java 1.8 and java 1.7?\n * java 8 \n\n\n# java  c++ \n\n * java  java.lang.objectc++  c \n * java  c++ \n * java  c++  c \n * java  c++ \n * java  c++ \n * java  string  c++ \n * java  goto c++  goto\n * java c++  #ifdef #ifndef \n\nwhat are the main differences between java and c++?\n\n\n# jre or jdk\n\n * jre is the jvm program, java application need to run on jre.\n * jdk is a superset of jre, jre + tools for developing java programs. e.g, it provides the compiler "javac"\n\n\n# \n\n * eckel b. java [m]. , 2002.\n * bloch j. effective java[m]. addison-wesley professional, 2017.\n *  https://www.pdai.tech/md/java/basic/java-basic-lan-basic.html',charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-x-exception.html",relativePath:"java/basic/java-basic-x-exception.md",key:"v-be2976b0",path:"/java/basic/java-basic-x-exception.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:176},{level:3,title:"Throwable",slug:"throwable",normalizedTitle:"throwable",charIndex:191},{level:3,title:"Error",slug:"error-",normalizedTitle:"error",charIndex:208},{level:3,title:"Exception",slug:"exception-",normalizedTitle:"exception",charIndex:225},{level:3,title:"checked exceptionsunchecked exceptions",slug:"-checked-exceptions--unchecked-exceptions",normalizedTitle:"checked exceptionsunchecked exceptions",charIndex:246},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:306},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:318},{level:3,title:"(throws)",slug:"-throws",normalizedTitle:"(throws)",charIndex:331},{level:3,title:"(throw)",slug:"-throw",normalizedTitle:"(throw)",charIndex:352},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:372},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:386},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:493},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:507},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:518},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:530},{level:3,title:" finally  try-with-resource ",slug:"-finally--try-with-resource-",normalizedTitle:" finally  try-with-resource ",charIndex:552},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:601},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:618},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:635},{level:3,title:" Throwable ",slug:"-throwable-",normalizedTitle:" throwable ",charIndex:653},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:677},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:691},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:708},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:730},{level:3,title:"finallyreturn",slug:"finallyreturn",normalizedTitle:"finallyreturn",charIndex:751},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:778},{level:3,title:"JVM",slug:"jvm",normalizedTitle:"jvm",charIndex:792},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:811},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:831}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -   Throwable Error Exception checked exceptionsunchecked exceptions   (throws) (throw)        finally  try-with-resource      Throwable      finallyreturn  JVM  ",content:'# Java  - \n\n> JavaJavajavaJava Java\n\n * Java  - \n   * \n     * Throwable\n     * Error\n     * Exception\n     * checked exceptionsunchecked exceptions\n   * \n     * \n     * (throws)\n     * (throw)\n     * \n     * \n       * try-catch\n       * try-catch-finally\n       * try-finally\n       * try-with-resource\n     * \n     * \n   * \n     * \n     *  finally  try-with-resource \n     * \n     * \n     * \n     *  Throwable \n     * \n     * \n     * \n     * \n     * finallyreturn\n   * \n     * JVM\n     * \n   * \n\n\n# \n\nJava APIThrowableJavaThrowable \n\nJava\n\n\n\n\n# Throwable\n\nThrowable  Java \n\nThrowable Error Exception\n\nThrowable  printStackTrace() \n\n\n# Error\n\nError \n\n JVM  Virtual MachineErrorNoClassDefFoundError OutOfMemoryErrorStackOverflowErrorJVM \n\nJavaError\n\n\n# Exception\n\nException \n\n * \n\nRuntimeExceptionNullPointerException()IndexOutOfBoundsException()\n\nJavatry-catchthrows\n\n *  \n\nRuntimeExceptionExceptionIOExceptionSQLExceptionException\n\n\n# checked exceptionsunchecked exceptions\n\n * \n\n\n\nRuntimeExceptionExceptionJavatry-catchthrows\n\n * ()\n\nRuntimeExceptionError\n\n\n# \n\n\n# \n\n * try  ()trytry\n * catch  catchtry\n * finally  finallytry()finallytrycatchreturnthrowfinallyreturnthrow\n * throw  \n * throws  \n\n\n# (throws)\n\nJavaJavamain throws\n\npublic static void method() throws IOException, FileNotFoundException{\n    //something statements\n}\n\n\n\n\n throws \n\nprivate static void readFile(String filePath) throws IOException {\n    File file = new File(filePath);\n    String result;\n    BufferedReader reader = new BufferedReader(new FileReader(file));\n    while((result = reader.readLine())!=null) {\n        System.out.println(result);\n    }\n    reader.close();\n}\n\n\nThrows\n\n * unchecked exceptionErrorRuntimeExceptionthrows\n * checked exceptiontry-catchthrows\n * \n * \n\n\n# (throw)\n\n\n\npublic static double method(int value) {\n    if(value == 0) {\n        throw new ArithmeticException("0"); //\n    }\n    return 5.0 / value;\n}\n\n\nJava\n\n catch \n\nprivate static void readFile(String filePath) throws MyException {    \n    try {\n        // code\n    } catch (IOException e) {\n        MyException ex = new MyException("read file failed.");\n        ex.initCause(e);\n        throw ex;\n    }\n}\n\n\n\n# \n\nThrowable  toString , MyException\n\npublic class MyException extends Exception {\n    public MyException(){ }\n    public MyException(String msg){\n        super(msg);\n    }\n    // ...\n}\n\n\n\n# \n\n\n\n * try-catch\n * try-catch-finally\n * try-finally\n * try-with-resource\n\n# try-catch\n\n try-catch \n\nprivate static void readFile(String filePath) {\n    try {\n        // code\n    } catch (FileNotFoundException e) {\n        // handle FileNotFoundException\n    } catch (IOException e){\n        // handle IOException\n    }\n}\n\n\n catch  | \n\nprivate static void readFile(String filePath) {\n    try {\n        // code\n    } catch (FileNotFoundException | UnknownHostException e) {\n        // handle FileNotFoundException or UnknownHostException\n    } catch (IOException e){\n        // handle IOException\n    }\n}\n\n\n# try-catch-finally\n\n * \n\ntry {                        \n    //                 \n} catch(Exception e) {   \n    //   \n} finally {\n    //\n}\n\n\n * \n   * trytrycatchfinally\n   * trycatchtrycatchJVMfinallyfinally\n   * trycatchtrycatchcatchcatchtrycatchfinallyfinally\n\n\n\n * \n\nprivate static void readFile(String filePath) throws MyException {\n    File file = new File(filePath);\n    String result;\n    BufferedReader reader = null;\n    try {\n        reader = new BufferedReader(new FileReader(file));\n        while((result = reader.readLine())!=null) {\n            System.out.println(result);\n        }\n    } catch (IOException e) {\n        System.out.println("readFile method catch block.");\n        MyException ex = new MyException("read file failed.");\n        ex.initCause(e);\n        throw ex;\n    } finally {\n        System.out.println("readFile method finally block.");\n        if (null != reader) {\n            try {\n                reader.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\n\n# try-finally\n\n> try-finally \n\ntryfinally trytryfinally\n\ntry-finallyIOLockfinally\n\n//Locktry-finally\nReentrantLock lock = new ReentrantLock();\ntry {\n    //\n} finally {\n    lock.unlock(); //\n}\n\n\nfinally\n\n * System.exit()\n * finally\n * \n * CPU\n\n# try-with-resource\n\n> try-with-resourceJava 7\n\nfinally  close  IOException, JAVA 7  AutoCloseable \n\n * \n\nprivate  static void tryWithResourceTest(){\n    try (Scanner scanner = new Scanner(new FileInputStream("c:/abc"),"UTF-8")){\n        // code\n    } catch (IOException e){\n        // handle exception\n    }\n}\n\n\n * Scanner\n\npublic final class Scanner implements Iterator<String>, Closeable {\n  // ...\n}\npublic interface Closeable extends AutoCloseable {\n    public void close() throws IOException;\n}\n\n\ntry  scanner.close  scanner.close  finally  scanner.close  addSusppressed  getSuppressed \n\n\n# \n\n * trycatchfinallytry-catchtry-finallytry-catch-finally\n * trycatch\n * finally \n * throws\n * throw \n\nJava\n\n * \n * \n * \n * \n * \n * \n * \n * \n * \n\n\n# \n\nJavaJavaJava:\n\n * RuntimeException\n   \n   * java.lang.ArrayIndexOutOfBoundsException \n   * java.lang.ArithmeticException \n   * java.lang.NullPointerException nullnullnullnullthrownull\n   * java.lang.ClassNotFoundException CLASSPAHclass\n   * java.lang.NegativeArraySizeException \n   * java.lang.ArrayStoreException \n   * java.lang.SecurityException \n   * java.lang.IllegalArgumentException \n\n * IOException\n   \n   * IOException\n   * EOFException \n   * FileNotFoundException \n\n * \n   \n   * ClassCastException \n   * ArrayStoreException \n   * SQLException \n   * NoSuchFieldException \n   * NoSuchMethodException \n   * NumberFormatException \n   * StringIndexOutOfBoundsException \n   * IllegalAccessException \n   * InstantiationException ClassnewInstance()\n\n\n# \n\n\n\n Java \n\n API \n\n\n\n\n\n\n# \n\n> Java RuntimeExceptioncatch NullPointerExceptionIndexOutOfBoundsException\n\ncatch Exception\n\n * 1\n\nif (obj != null) {\n  //...\n}\n\n\n * 2\n\ntry { \n  obj.method(); \n} catch (NullPointerException e) {\n  //...\n}\n\n\n\n\n * JVM\n * try-catchJVM\n * JVM\n\n\n#  finally  try-with-resource \n\nInputStreamtry\n\n * \n\npublic void doNotCloseResourceInTry() {\n    FileInputStream inputStream = null;\n    try {\n        File file = new File("./tmp.txt");\n        inputStream = new FileInputStream(file);\n        // use the inputStream to read a file\n        // do NOT do this\n        inputStream.close();\n    } catch (FileNotFoundException e) {\n        log.error(e);\n    } catch (IOException e) {\n        log.error(e);\n    }\n}\n\n\ntry  try  try \n\n finally  try-with-resource \n\n *  finally \n\n try finally  try  catch \n\npublic void closeResourceInFinally() {\n    FileInputStream inputStream = null;\n    try {\n        File file = new File("./tmp.txt");\n        inputStream = new FileInputStream(file);\n        // use the inputStream to read a file\n    } catch (FileNotFoundException e) {\n        log.error(e);\n    } finally {\n        if (inputStream != null) {\n            try {\n                inputStream.close();\n            } catch (IOException e) {\n                log.error(e);\n            }\n        }\n    }\n}\n\n\n * Java 7  try-with-resource \n\n AutoCloseable  Java  try  try \n\npublic void automaticallyCloseResource() {\n    File file = new File("./tmp.txt");\n    try (FileInputStream inputStream = new FileInputStream(file);) {\n        // use the inputStream to read a file\n    } catch (FileNotFoundException e) {\n        log.error(e);\n    } catch (IOException e) {\n        log.error(e);\n    }\n}\n\n\n\n# \n\n> \n\n\n\n * API\n * API\n * \n\nJava\n\n                                \nIllegalArgumentException          \nIllegalStateException             \nNullPointerException              nullnull\nIndexOutOfBoundsException         \nConcurrentModificationException   \nUnsupportedOperationException     \n\nJavaArithmeticExceptionNumberFormatException\n\n(handSize)IllegalArgumentException(handSize)IllegalStateException()\n\n\n# \n\n> \n\n Javadoc  @throws \n\n/**\n* Method description\n* \n* @throws MyBusinessException - businuess exception description\n*/\npublic void doSomething(String input) throws MyBusinessException {\n   // ...\n}\n\n\nMyBusinessException \n\n\n# \n\n>  IDE \n\n catch   IllegalArgumentException  NumberFormatException  catch  IllegalArgumentException \n\n catch \n\n try-catch   catch  NumberFormatException  NumberFormatException IllegalArgumentException \n\npublic void catchMostSpecificExceptionFirst() {\n    try {\n        doSomething("A message");\n    } catch (NumberFormatException e) {\n        log.error(e);\n    } catch (IllegalArgumentException e) {\n        log.error(e)\n    }\n}\n\n\n\n#  Throwable \n\n> Throwable  catch \n\n catch  Throwable JVM   OutOfMemoryError  StackOverflowError \n\n Throwable \n\npublic void doNotCatchThrowable() {\n    try {\n        // do something\n    } catch (Throwable t) {\n        // don\'t do this!\n    }\n}\n\n\n\n# \n\n> catch\n\npublic void doNotIgnoreExceptions() {\n    try {\n        // do something\n    } catch (NumberFormatException e) {\n        // this will never happen\n    }\n}\n\n\n()\n\n\n\npublic void logAnException() {\n    try {\n        // do something\n    } catch (NumberFormatException e) {\n        log.error("This should never happen: " + e); // see this line\n    }\n}\n\n\n\n# \n\n> \n\n\n\ntry {\n    new Long("xyz");\n} catch (NumberFormatException e) {\n    log.error(e);\n    throw e;\n}\n\n\n\n\n17:44:28,945 ERROR TestExceptionHandling:65 - java.lang.NumberFormatException: For input string: "xyz"\nException in thread "main" java.lang.NumberFormatException: For input string: "xyz"\nat java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\nat java.lang.Long.parseLong(Long.java:589)\nat java.lang.Long.(Long.java:965)\nat com.stackify.example.TestExceptionHandling.logAndThrowException(TestExceptionHandling.java:63)\nat com.stackify.example.TestExceptionHandling.main(TestExceptionHandling.java:58)\n\n\n\n\npublic void wrapException(String input) throws MyBusinessException {\n    try {\n        // do something\n    } catch (NumberFormatException e) {\n        throw new MyBusinessException("A message that describes the error.", e);\n    }\n}\n\n\n\n\n\n# \n\n  NumberFormatException e  e Exception  Throwable \n\npublic void wrapException(String input) throws MyBusinessException {\n    try {\n        // do something\n    } catch (NumberFormatException e) {\n        throw new MyBusinessException("A message that describes the error.", e);\n    }\n}\n\n\n\n# \n\nif\n\n\n# finallyreturn\n\ntryreturnfinallyreturntry\n\n\n\nprivate int x = 0;\npublic int checkReturn() {\n    try {\n        // x1\n        return ++x;\n    } finally {\n        // 2\n        return ++x;\n    }\n}\n\n\n\n# \n\n\n# JVM\n\nJVMException Table Java \n\npublic static void simpleTryCatch() {\n   try {\n       testNPE();\n   } catch (Exception e) {\n       e.printStackTrace();\n   }\n}\n\n\n\n\n\n\njavap,classjavacJDK\n\njavapjavac\n\n//javap -c Main\n public static void simpleTryCatch();\n    Code:\n       0: invokestatic  #3                  // Method testNPE:()V\n       3: goto          11\n       6: astore_0\n       7: aload_0\n       8: invokevirtual #5                  // Method java/lang/Exception.printStackTrace:()V\n      11: return\n    Exception table:\n       from    to  target type\n           0     3     6   Class java/lang/Exception\n\n\nException table\n\n(Exception Handler)\n\n * from \n * to \n * target fromto\n * type \n\n\n\n\n\n * 1.JVM\n * 2.fromtotypeJVMtarget\n * 3.\n * 4.\n * 5.ThreadThread\n * 6.ThreadJVM\n\nJVM\n\ntry catch -finally\n\ntry-catchfinally\n\npublic static void simpleTryCatchFinally() {\n   try {\n       testNPE();\n   } catch (Exception e) {\n       e.printStackTrace();\n   } finally {\n       System.out.println("Finally");\n   }\n}\n\n\njavap\n\npublic static void simpleTryCatchFinally();\n    Code:\n       0: invokestatic  #3                  // Method testNPE:()V\n       3: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n       6: ldc           #7                  // String Finally\n       8: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      11: goto          41\n      14: astore_0\n      15: aload_0\n      16: invokevirtual #5                  // Method java/lang/Exception.printStackTrace:()V\n      19: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      22: ldc           #7                  // String Finally\n      24: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      27: goto          41\n      30: astore_1\n      31: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      34: ldc           #7                  // String Finally\n      36: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      39: aload_1\n      40: athrow\n      41: return\n    Exception table:\n       from    to  target type\n           0     3    14   Class java/lang/Exception\n           0     3    30   any\n          14    19    30   any\n\n\nException, itemtypeany; item:\n\n * 03Exception14\n * 0330\n * 1419catch30\n\nJavafinallytrycatch\n\npublic static void simpleTryCatchFinally();\n    Code:\n      //try finallyfinallygoto41  \n\n       0: invokestatic  #3                  // Method testNPE:()V\n       3: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n       6: ldc           #7                  // String Finally\n       8: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      11: goto          41\n\n      //catchfinallyfinallygot41\n      14: astore_0\n      15: aload_0\n      16: invokevirtual #5                  // Method java/lang/Exception.printStackTrace:()V\n      19: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      22: ldc           #7                  // String Finally\n      24: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      27: goto          41\n      //finallytrycatch\n      30: astore_1\n      31: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      34: ldc           #7                  // String Finally\n      36: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      39: aload_1\n      40: athrow     //catchfinally\n      41: return\n\n\nCatch\n\ncatch\n\nprivate static void misuseCatchException() {\n   try {\n       testNPE();\n   } catch (Throwable t) {\n       t.printStackTrace();\n   } catch (Exception e) { //error occurs during compilings with tips Exception Java.lang.Exception has already benn caught.\n       e.printStackTrace();\n   }\n}\n\n\nThrowableExceptioncatch\n\nReturn finally\n\nreturnfinallyfinally\n\npublic static String tryCatchReturn() {\n   try {\n       testNPE();\n       return  "OK";\n   } catch (Exception e) {\n       return "ERROR";\n   } finally {\n       System.out.println("tryCatchReturn");\n   }\n}\n\n\nfinallyfinally\n\npublic static java.lang.String tryCatchReturn();\n    Code:\n       0: invokestatic  #3                  // Method testNPE:()V\n       3: ldc           #6                  // String OK\n       5: astore_0\n       6: getstatic     #7                  // Field java/lang/System.out:Ljava/io/PrintStream;\n       9: ldc           #8                  // String tryCatchReturn\n      11: invokevirtual #9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      14: aload_0\n      15: areturn       OKareturnreturn a reference from a method\n      16: astore_0\n      17: ldc           #10                 // String ERROR\n      19: astore_1\n      20: getstatic     #7                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      23: ldc           #8                  // String tryCatchReturn\n      25: invokevirtual #9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      28: aload_1\n      29: areturn  //ERROR\n      30: astore_2\n      31: getstatic     #7                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      34: ldc           #8                  // String tryCatchReturn\n      36: invokevirtual #9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n      39: aload_2\n      40: athrow  catch\n\n\n\n# \n\n\n\npublic class ExceptionTest {  \n  \n    private int testTimes;  \n  \n    public ExceptionTest(int testTimes) {  \n        this.testTimes = testTimes;  \n    }  \n  \n    public void newObject() {  \n        long l = System.nanoTime();  \n        for (int i = 0; i < testTimes; i++) {  \n            new Object();  \n        }  \n        System.out.println("" + (System.nanoTime() - l));  \n    }  \n  \n    public void newException() {  \n        long l = System.nanoTime();  \n        for (int i = 0; i < testTimes; i++) {  \n            new Exception();  \n        }  \n        System.out.println("" + (System.nanoTime() - l));  \n    }  \n  \n    public void catchException() {  \n        long l = System.nanoTime();  \n        for (int i = 0; i < testTimes; i++) {  \n            try {  \n                throw new Exception();  \n            } catch (Exception e) {  \n            }  \n        }  \n        System.out.println("" + (System.nanoTime() - l));  \n    }  \n  \n    public static void main(String[] args) {  \n        ExceptionTest test = new ExceptionTest(10000);  \n        test.newObject();  \n        test.newException();  \n        test.catchException();  \n    }  \n}  \n\n\n\n\n575817  \n9589080  \n47394475  \n\n\nObject204\n\n\n\n * https://www.iteye.com/blog/icyfenix-857722\n\n\n# \n\n * https://blog.csdn.net/MacWx/article/details/90204111\n * https://blog.csdn.net/hguisu/article/details/6155636\n * https://blog.csdn.net/ThinkWon/article/details/101681073\n * https://www.cnblogs.com/skywang12345/p/3544287.html\n * https://www.codercto.com/a/33350.html\n *  https://www.pdai.tech/md/java/basic/java-basic-x-exception.html',normalizedContent:'# java  - \n\n> javajavajavajava java\n\n * java  - \n   * \n     * throwable\n     * error\n     * exception\n     * checked exceptionsunchecked exceptions\n   * \n     * \n     * (throws)\n     * (throw)\n     * \n     * \n       * try-catch\n       * try-catch-finally\n       * try-finally\n       * try-with-resource\n     * \n     * \n   * \n     * \n     *  finally  try-with-resource \n     * \n     * \n     * \n     *  throwable \n     * \n     * \n     * \n     * \n     * finallyreturn\n   * \n     * jvm\n     * \n   * \n\n\n# \n\njava apithrowablejavathrowable \n\njava\n\n\n\n\n# throwable\n\nthrowable  java \n\nthrowable error exception\n\nthrowable  printstacktrace() \n\n\n# error\n\nerror \n\n jvm  virtual machineerrornoclassdeffounderror outofmemoryerrorstackoverflowerrorjvm \n\njavaerror\n\n\n# exception\n\nexception \n\n * \n\nruntimeexceptionnullpointerexception()indexoutofboundsexception()\n\njavatry-catchthrows\n\n *  \n\nruntimeexceptionexceptionioexceptionsqlexceptionexception\n\n\n# checked exceptionsunchecked exceptions\n\n * \n\n\n\nruntimeexceptionexceptionjavatry-catchthrows\n\n * ()\n\nruntimeexceptionerror\n\n\n# \n\n\n# \n\n * try  ()trytry\n * catch  catchtry\n * finally  finallytry()finallytrycatchreturnthrowfinallyreturnthrow\n * throw  \n * throws  \n\n\n# (throws)\n\njavajavamain throws\n\npublic static void method() throws ioexception, filenotfoundexception{\n    //something statements\n}\n\n\n\n\n throws \n\nprivate static void readfile(string filepath) throws ioexception {\n    file file = new file(filepath);\n    string result;\n    bufferedreader reader = new bufferedreader(new filereader(file));\n    while((result = reader.readline())!=null) {\n        system.out.println(result);\n    }\n    reader.close();\n}\n\n\nthrows\n\n * unchecked exceptionerrorruntimeexceptionthrows\n * checked exceptiontry-catchthrows\n * \n * \n\n\n# (throw)\n\n\n\npublic static double method(int value) {\n    if(value == 0) {\n        throw new arithmeticexception("0"); //\n    }\n    return 5.0 / value;\n}\n\n\njava\n\n catch \n\nprivate static void readfile(string filepath) throws myexception {    \n    try {\n        // code\n    } catch (ioexception e) {\n        myexception ex = new myexception("read file failed.");\n        ex.initcause(e);\n        throw ex;\n    }\n}\n\n\n\n# \n\nthrowable  tostring , myexception\n\npublic class myexception extends exception {\n    public myexception(){ }\n    public myexception(string msg){\n        super(msg);\n    }\n    // ...\n}\n\n\n\n# \n\n\n\n * try-catch\n * try-catch-finally\n * try-finally\n * try-with-resource\n\n# try-catch\n\n try-catch \n\nprivate static void readfile(string filepath) {\n    try {\n        // code\n    } catch (filenotfoundexception e) {\n        // handle filenotfoundexception\n    } catch (ioexception e){\n        // handle ioexception\n    }\n}\n\n\n catch  | \n\nprivate static void readfile(string filepath) {\n    try {\n        // code\n    } catch (filenotfoundexception | unknownhostexception e) {\n        // handle filenotfoundexception or unknownhostexception\n    } catch (ioexception e){\n        // handle ioexception\n    }\n}\n\n\n# try-catch-finally\n\n * \n\ntry {                        \n    //                 \n} catch(exception e) {   \n    //   \n} finally {\n    //\n}\n\n\n * \n   * trytrycatchfinally\n   * trycatchtrycatchjvmfinallyfinally\n   * trycatchtrycatchcatchcatchtrycatchfinallyfinally\n\n\n\n * \n\nprivate static void readfile(string filepath) throws myexception {\n    file file = new file(filepath);\n    string result;\n    bufferedreader reader = null;\n    try {\n        reader = new bufferedreader(new filereader(file));\n        while((result = reader.readline())!=null) {\n            system.out.println(result);\n        }\n    } catch (ioexception e) {\n        system.out.println("readfile method catch block.");\n        myexception ex = new myexception("read file failed.");\n        ex.initcause(e);\n        throw ex;\n    } finally {\n        system.out.println("readfile method finally block.");\n        if (null != reader) {\n            try {\n                reader.close();\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n        }\n    }\n}\n\n\n# try-finally\n\n> try-finally \n\ntryfinally trytryfinally\n\ntry-finallyiolockfinally\n\n//locktry-finally\nreentrantlock lock = new reentrantlock();\ntry {\n    //\n} finally {\n    lock.unlock(); //\n}\n\n\nfinally\n\n * system.exit()\n * finally\n * \n * cpu\n\n# try-with-resource\n\n> try-with-resourcejava 7\n\nfinally  close  ioexception, java 7  autocloseable \n\n * \n\nprivate  static void trywithresourcetest(){\n    try (scanner scanner = new scanner(new fileinputstream("c:/abc"),"utf-8")){\n        // code\n    } catch (ioexception e){\n        // handle exception\n    }\n}\n\n\n * scanner\n\npublic final class scanner implements iterator<string>, closeable {\n  // ...\n}\npublic interface closeable extends autocloseable {\n    public void close() throws ioexception;\n}\n\n\ntry  scanner.close  scanner.close  finally  scanner.close  addsusppressed  getsuppressed \n\n\n# \n\n * trycatchfinallytry-catchtry-finallytry-catch-finally\n * trycatch\n * finally \n * throws\n * throw \n\njava\n\n * \n * \n * \n * \n * \n * \n * \n * \n * \n\n\n# \n\njavajavajava:\n\n * runtimeexception\n   \n   * java.lang.arrayindexoutofboundsexception \n   * java.lang.arithmeticexception \n   * java.lang.nullpointerexception nullnullnullnullthrownull\n   * java.lang.classnotfoundexception classpahclass\n   * java.lang.negativearraysizeexception \n   * java.lang.arraystoreexception \n   * java.lang.securityexception \n   * java.lang.illegalargumentexception \n\n * ioexception\n   \n   * ioexception\n   * eofexception \n   * filenotfoundexception \n\n * \n   \n   * classcastexception \n   * arraystoreexception \n   * sqlexception \n   * nosuchfieldexception \n   * nosuchmethodexception \n   * numberformatexception \n   * stringindexoutofboundsexception \n   * illegalaccessexception \n   * instantiationexception classnewinstance()\n\n\n# \n\n\n\n java \n\n api \n\n\n\n\n\n\n# \n\n> java runtimeexceptioncatch nullpointerexceptionindexoutofboundsexception\n\ncatch exception\n\n * 1\n\nif (obj != null) {\n  //...\n}\n\n\n * 2\n\ntry { \n  obj.method(); \n} catch (nullpointerexception e) {\n  //...\n}\n\n\n\n\n * jvm\n * try-catchjvm\n * jvm\n\n\n#  finally  try-with-resource \n\ninputstreamtry\n\n * \n\npublic void donotcloseresourceintry() {\n    fileinputstream inputstream = null;\n    try {\n        file file = new file("./tmp.txt");\n        inputstream = new fileinputstream(file);\n        // use the inputstream to read a file\n        // do not do this\n        inputstream.close();\n    } catch (filenotfoundexception e) {\n        log.error(e);\n    } catch (ioexception e) {\n        log.error(e);\n    }\n}\n\n\ntry  try  try \n\n finally  try-with-resource \n\n *  finally \n\n try finally  try  catch \n\npublic void closeresourceinfinally() {\n    fileinputstream inputstream = null;\n    try {\n        file file = new file("./tmp.txt");\n        inputstream = new fileinputstream(file);\n        // use the inputstream to read a file\n    } catch (filenotfoundexception e) {\n        log.error(e);\n    } finally {\n        if (inputstream != null) {\n            try {\n                inputstream.close();\n            } catch (ioexception e) {\n                log.error(e);\n            }\n        }\n    }\n}\n\n\n * java 7  try-with-resource \n\n autocloseable  java  try  try \n\npublic void automaticallycloseresource() {\n    file file = new file("./tmp.txt");\n    try (fileinputstream inputstream = new fileinputstream(file);) {\n        // use the inputstream to read a file\n    } catch (filenotfoundexception e) {\n        log.error(e);\n    } catch (ioexception e) {\n        log.error(e);\n    }\n}\n\n\n\n# \n\n> \n\n\n\n * api\n * api\n * \n\njava\n\n                                \nillegalargumentexception          \nillegalstateexception             \nnullpointerexception              nullnull\nindexoutofboundsexception         \nconcurrentmodificationexception   \nunsupportedoperationexception     \n\njavaarithmeticexceptionnumberformatexception\n\n(handsize)illegalargumentexception(handsize)illegalstateexception()\n\n\n# \n\n> \n\n javadoc  @throws \n\n/**\n* method description\n* \n* @throws mybusinessexception - businuess exception description\n*/\npublic void dosomething(string input) throws mybusinessexception {\n   // ...\n}\n\n\nmybusinessexception \n\n\n# \n\n>  ide \n\n catch   illegalargumentexception  numberformatexception  catch  illegalargumentexception \n\n catch \n\n try-catch   catch  numberformatexception  numberformatexception illegalargumentexception \n\npublic void catchmostspecificexceptionfirst() {\n    try {\n        dosomething("a message");\n    } catch (numberformatexception e) {\n        log.error(e);\n    } catch (illegalargumentexception e) {\n        log.error(e)\n    }\n}\n\n\n\n#  throwable \n\n> throwable  catch \n\n catch  throwable jvm   outofmemoryerror  stackoverflowerror \n\n throwable \n\npublic void donotcatchthrowable() {\n    try {\n        // do something\n    } catch (throwable t) {\n        // don\'t do this!\n    }\n}\n\n\n\n# \n\n> catch\n\npublic void donotignoreexceptions() {\n    try {\n        // do something\n    } catch (numberformatexception e) {\n        // this will never happen\n    }\n}\n\n\n()\n\n\n\npublic void loganexception() {\n    try {\n        // do something\n    } catch (numberformatexception e) {\n        log.error("this should never happen: " + e); // see this line\n    }\n}\n\n\n\n# \n\n> \n\n\n\ntry {\n    new long("xyz");\n} catch (numberformatexception e) {\n    log.error(e);\n    throw e;\n}\n\n\n\n\n17:44:28,945 error testexceptionhandling:65 - java.lang.numberformatexception: for input string: "xyz"\nexception in thread "main" java.lang.numberformatexception: for input string: "xyz"\nat java.lang.numberformatexception.forinputstring(numberformatexception.java:65)\nat java.lang.long.parselong(long.java:589)\nat java.lang.long.(long.java:965)\nat com.stackify.example.testexceptionhandling.logandthrowexception(testexceptionhandling.java:63)\nat com.stackify.example.testexceptionhandling.main(testexceptionhandling.java:58)\n\n\n\n\npublic void wrapexception(string input) throws mybusinessexception {\n    try {\n        // do something\n    } catch (numberformatexception e) {\n        throw new mybusinessexception("a message that describes the error.", e);\n    }\n}\n\n\n\n\n\n# \n\n  numberformatexception e  e exception  throwable \n\npublic void wrapexception(string input) throws mybusinessexception {\n    try {\n        // do something\n    } catch (numberformatexception e) {\n        throw new mybusinessexception("a message that describes the error.", e);\n    }\n}\n\n\n\n# \n\nif\n\n\n# finallyreturn\n\ntryreturnfinallyreturntry\n\n\n\nprivate int x = 0;\npublic int checkreturn() {\n    try {\n        // x1\n        return ++x;\n    } finally {\n        // 2\n        return ++x;\n    }\n}\n\n\n\n# \n\n\n# jvm\n\njvmexception table java \n\npublic static void simpletrycatch() {\n   try {\n       testnpe();\n   } catch (exception e) {\n       e.printstacktrace();\n   }\n}\n\n\n\n\n\n\njavap,classjavacjdk\n\njavapjavac\n\n//javap -c main\n public static void simpletrycatch();\n    code:\n       0: invokestatic  #3                  // method testnpe:()v\n       3: goto          11\n       6: astore_0\n       7: aload_0\n       8: invokevirtual #5                  // method java/lang/exception.printstacktrace:()v\n      11: return\n    exception table:\n       from    to  target type\n           0     3     6   class java/lang/exception\n\n\nexception table\n\n(exception handler)\n\n * from \n * to \n * target fromto\n * type \n\n\n\n\n\n * 1.jvm\n * 2.fromtotypejvmtarget\n * 3.\n * 4.\n * 5.threadthread\n * 6.threadjvm\n\njvm\n\ntry catch -finally\n\ntry-catchfinally\n\npublic static void simpletrycatchfinally() {\n   try {\n       testnpe();\n   } catch (exception e) {\n       e.printstacktrace();\n   } finally {\n       system.out.println("finally");\n   }\n}\n\n\njavap\n\npublic static void simpletrycatchfinally();\n    code:\n       0: invokestatic  #3                  // method testnpe:()v\n       3: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n       6: ldc           #7                  // string finally\n       8: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      11: goto          41\n      14: astore_0\n      15: aload_0\n      16: invokevirtual #5                  // method java/lang/exception.printstacktrace:()v\n      19: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n      22: ldc           #7                  // string finally\n      24: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      27: goto          41\n      30: astore_1\n      31: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n      34: ldc           #7                  // string finally\n      36: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      39: aload_1\n      40: athrow\n      41: return\n    exception table:\n       from    to  target type\n           0     3    14   class java/lang/exception\n           0     3    30   any\n          14    19    30   any\n\n\nexception, itemtypeany; item:\n\n * 03exception14\n * 0330\n * 1419catch30\n\njavafinallytrycatch\n\npublic static void simpletrycatchfinally();\n    code:\n      //try finallyfinallygoto41  \n\n       0: invokestatic  #3                  // method testnpe:()v\n       3: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n       6: ldc           #7                  // string finally\n       8: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      11: goto          41\n\n      //catchfinallyfinallygot41\n      14: astore_0\n      15: aload_0\n      16: invokevirtual #5                  // method java/lang/exception.printstacktrace:()v\n      19: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n      22: ldc           #7                  // string finally\n      24: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      27: goto          41\n      //finallytrycatch\n      30: astore_1\n      31: getstatic     #6                  // field java/lang/system.out:ljava/io/printstream;\n      34: ldc           #7                  // string finally\n      36: invokevirtual #8                  // method java/io/printstream.println:(ljava/lang/string;)v\n      39: aload_1\n      40: athrow     //catchfinally\n      41: return\n\n\ncatch\n\ncatch\n\nprivate static void misusecatchexception() {\n   try {\n       testnpe();\n   } catch (throwable t) {\n       t.printstacktrace();\n   } catch (exception e) { //error occurs during compilings with tips exception java.lang.exception has already benn caught.\n       e.printstacktrace();\n   }\n}\n\n\nthrowableexceptioncatch\n\nreturn finally\n\nreturnfinallyfinally\n\npublic static string trycatchreturn() {\n   try {\n       testnpe();\n       return  "ok";\n   } catch (exception e) {\n       return "error";\n   } finally {\n       system.out.println("trycatchreturn");\n   }\n}\n\n\nfinallyfinally\n\npublic static java.lang.string trycatchreturn();\n    code:\n       0: invokestatic  #3                  // method testnpe:()v\n       3: ldc           #6                  // string ok\n       5: astore_0\n       6: getstatic     #7                  // field java/lang/system.out:ljava/io/printstream;\n       9: ldc           #8                  // string trycatchreturn\n      11: invokevirtual #9                  // method java/io/printstream.println:(ljava/lang/string;)v\n      14: aload_0\n      15: areturn       okareturnreturn a reference from a method\n      16: astore_0\n      17: ldc           #10                 // string error\n      19: astore_1\n      20: getstatic     #7                  // field java/lang/system.out:ljava/io/printstream;\n      23: ldc           #8                  // string trycatchreturn\n      25: invokevirtual #9                  // method java/io/printstream.println:(ljava/lang/string;)v\n      28: aload_1\n      29: areturn  //error\n      30: astore_2\n      31: getstatic     #7                  // field java/lang/system.out:ljava/io/printstream;\n      34: ldc           #8                  // string trycatchreturn\n      36: invokevirtual #9                  // method java/io/printstream.println:(ljava/lang/string;)v\n      39: aload_2\n      40: athrow  catch\n\n\n\n# \n\n\n\npublic class exceptiontest {  \n  \n    private int testtimes;  \n  \n    public exceptiontest(int testtimes) {  \n        this.testtimes = testtimes;  \n    }  \n  \n    public void newobject() {  \n        long l = system.nanotime();  \n        for (int i = 0; i < testtimes; i++) {  \n            new object();  \n        }  \n        system.out.println("" + (system.nanotime() - l));  \n    }  \n  \n    public void newexception() {  \n        long l = system.nanotime();  \n        for (int i = 0; i < testtimes; i++) {  \n            new exception();  \n        }  \n        system.out.println("" + (system.nanotime() - l));  \n    }  \n  \n    public void catchexception() {  \n        long l = system.nanotime();  \n        for (int i = 0; i < testtimes; i++) {  \n            try {  \n                throw new exception();  \n            } catch (exception e) {  \n            }  \n        }  \n        system.out.println("" + (system.nanotime() - l));  \n    }  \n  \n    public static void main(string[] args) {  \n        exceptiontest test = new exceptiontest(10000);  \n        test.newobject();  \n        test.newexception();  \n        test.catchexception();  \n    }  \n}  \n\n\n\n\n575817  \n9589080  \n47394475  \n\n\nobject204\n\n\n\n * https://www.iteye.com/blog/icyfenix-857722\n\n\n# \n\n * https://blog.csdn.net/macwx/article/details/90204111\n * https://blog.csdn.net/hguisu/article/details/6155636\n * https://blog.csdn.net/thinkwon/article/details/101681073\n * https://www.cnblogs.com/skywang12345/p/3544287.html\n * https://www.codercto.com/a/33350.html\n *  https://www.pdai.tech/md/java/basic/java-basic-x-exception.html',charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-x-generic.html",relativePath:"java/basic/java-basic-x-generic.md",key:"v-cdde13b0",path:"/java/basic/java-basic-x-generic.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:252},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:266},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:281},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:292},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:304},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:316},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:330},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:340},{level:3,title:"Java",slug:"java-",normalizedTitle:"java",charIndex:354},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:386},{level:3,title:"?",slug:"",normalizedTitle:"?",charIndex:405},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:430},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:451},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:476},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:501},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:523},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:554},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:582},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:609},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:629},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:647}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -          Java  ?          ",content:'# Java  - \n\n> JavaJDK 1.5JavaJavaType ErasureJava Java\n\n * Java  - \n   * \n   * \n     * \n     * \n     * \n     * \n     * \n   * \n     * Java\n     * \n     * ?\n     * \n     * \n     * \n     * \n     * \n     * \n     * \n     * \n     * \n   * \n\n\n# \n\n> \n\n\n\n * \n\n\n\nprivate static int add(int a, int b) {\n    System.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\nprivate static float add(float a, float b) {\n    System.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\nprivate static double add(double a, double b) {\n    System.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\n\nadd\n\nprivate static <T extends Number> double add(T a, T b) {\n    System.out.println(a + "+" + b + "=" + (a.doubleValue() + b.doubleValue()));\n    return a.doubleValue() + b.doubleValue();\n}\n\n\n * \n\n\n\nList list = new ArrayList();\nlist.add("xxString");\nlist.add(100d);\nlist.add(new Person());\n\n\nlistlistObjectjava.lang.ClassCastException\n\n\n\nList<String> list = new ArrayList<String>();\n\n// listString, \n\n\n\n# \n\n\n\n - Java\n\n\n# \n\n * \n\nclass Point<T>{         // Ttype  \n    private T var ;     // varT  \n    public T getVar(){  //   \n        return var ;  \n    }  \n    public void setVar(T var){  //   \n        this.var = var ;  \n    }  \n}  \npublic class GenericsDemo06{  \n    public static void main(String args[]){  \n        Point<String> p = new Point<String>() ;     // varString  \n        p.setVar("it") ;                            //   \n        System.out.println(p.getVar().length()) ;   //   \n    }  \n}\n\n\n * \n\nclass Notepad<K,V>{       //   \n    private K key ;     //   \n    private V value ;   //   \n    public K getKey(){  \n        return this.key ;  \n    }  \n    public V getValue(){  \n        return this.value ;  \n    }  \n    public void setKey(K key){  \n        this.key = key ;  \n    }  \n    public void setValue(V value){  \n        this.value = value ;  \n    }  \n} \npublic class GenericsDemo09{  \n    public static void main(String args[]){  \n        Notepad<String,Integer> t = null ;        //   \n        t = new Notepad<String,Integer>() ;       // keyStringvalueInteger  \n        t.setKey("") ;        //   \n        t.setValue(20) ;            //   \n        System.out.print("" + t.getKey()) ;      //   \n        System.out.print("" + t.getValue()) ;       //   \n  \n    }  \n}\n\n\n\n# \n\n * \n\ninterface Info<T>{        //   \n    public T getVar() ; //   \n}  \nclass InfoImpl<T> implements Info<T>{   //   \n    private T var ;             //   \n    public InfoImpl(T var){     //   \n        this.setVar(var) ;    \n    }  \n    public void setVar(T var){  \n        this.var = var ;  \n    }  \n    public T getVar(){  \n        return this.var ;  \n    }  \n} \npublic class GenericsDemo24{  \n    public static void main(String arsg[]){  \n        Info<String> i = null;        //   \n        i = new InfoImpl<String>("") ;  //   \n        System.out.println("" + i.getVar()) ;  \n    }  \n}  \n\n\n\n# \n\nhttps://www.cnblogs.com/iyangyuan/archive/2013/04/09/3011274.html\n\n * \n\n\n\n * \n\n\n\n<T>TT\n\nClass<T>Class<T>c\n\ncnewcnewInstance\n\nClass<T>Class.forName()Class<T>Class.forName()forName()Class<T>forName()UserClass<User>cClass<User>TUserobjUser\n\nClass<T>\n\nnew\n\n\n# \n\n *  \n\nclass A{}\nclass B extends A {}\n\n// \npublic static void funA(A a) {\n    // ...          \n}\npublic static void funB(B b) {\n    funA(b);\n    // ...             \n}\n\n// funD\npublic static void funC(List<A> listA) {\n    // ...          \n}\npublic static void funD(List<B> listB) {\n    funC(listB); // Unresolved compilation problem: The method doPrint(List<A>) in the type test is not applicable for the arguments (List<B>)\n    // ...             \n}\n\n\n\n\nJava<? extends A>A()AAABA\n\npublic static void funC(List<? extends A> listA) {\n    // ...          \n}\npublic static void funD(List<B> listB) {\n    funC(listB); // OK\n    // ...             \n}\n\n\n * \n\n\n\n\n\nclass Info<T extends Number>{    // \n    private T var ;        // \n    public void setVar(T var){\n        this.var = var ;\n    }\n    public T getVar(){\n        return this.var ;\n    }\n    public String toString(){    // \n        return this.var.toString() ;\n    }\n}\npublic class demo1{\n    public static void main(String args[]){\n        Info<Integer> i1 = new Info<Integer>() ;        // Integer\n    }\n}\n\n\n\n\nclass Info<T>{\n    private T var ;        // \n    public void setVar(T var){\n        this.var = var ;\n    }\n    public T getVar(){\n        return this.var ;\n    }\n    public String toString(){    // \n        return this.var.toString() ;\n    }\n}\npublic class GenericsDemo21{\n    public static void main(String args[]){\n        Info<String> i1 = new Info<String>() ;        // String\n        Info<Object> i2 = new Info<Object>() ;        // Object\n        i1.setVar("hello") ;\n        i2.setVar(new Object()) ;\n        fun(i1) ;\n        fun(i2) ;\n    }\n    public static void fun(Info<? super String> temp){    // StringObjectStringObject\n        System.out.print(temp + ", ") ;\n    }\n}\n\n\n\n\n<?> \n<? extends E> extends \n<? super E> super \n\n// Effictive Java\n//   \n1.  T  < ? extends T>;\n2.  T  < ? super T>\n3. \n\n\n * \n\nprivate  <E extends Comparable<? super E>> E max(List<? extends E> e1) {\n    if (e1 == null){\n        return null;\n    }\n    // E \n    Iterator<? extends E> iterator = e1.iterator();\n    E result = iterator.next();\n    while (iterator.hasNext()){\n        E next = iterator.next();\n        if (next.compareTo(result) > 0){\n            result = next;\n        }\n    }\n    return result;\n}\n\n\n E <E extends Comparable<? super E>>\n\n *  E  extends Comparable<> extends \n\n * Comparable< ? super E>  E  E  super\n\n *  List< ? extends E>  E \n\n * \n\n&\n\npublic class Client {\n    //25008\n    public static <T extends Staff & Passenger> void discount(T t){\n        if(t.getSalary()<2500 && t.isStanding()){\n            System.out.println("");\n        }\n    }\n    public static void main(String[] args) {\n        discount(new Me());\n    }\n}\n\n\n\n# \n\n> \n\n\n\nList<String>[] list11 = new ArrayList<String>[10]; // \nList<String>[] list12 = new ArrayList<?>[10]; // \nList<String>[] list13 = (List<String>[]) new ArrayList<?>[10]; //OK \nList<?>[] list14 = new ArrayList<String>[10]; // \nList<?>[] list15 = new ArrayList<?>[10]; //OK \nList<String>[] list6 = new ArrayList[10]; //OK\n\n\n\n\n * \n\npublic class GenericsDemo30{  \n    public static void main(String args[]){  \n        Integer i[] = fun1(1,2,3,4,5,6) ;   //   \n        fun2(i) ;  \n    }  \n    public static <T> T[] fun1(T...arg){  //   \n        return arg ;            //   \n    }  \n    public static <T> void fun2(T param[]){   //   \n        System.out.print("") ;  \n        for(T t:param){  \n            System.out.print(t + "") ;  \n        }  \n    }  \n}\n\n\n * \n\npublic ArrayWithTypeToken(Class<T> type, int size) {\n    array = (T[]) Array.newInstance(type, size);\n}\n\n\n\n\n\n# \n\n\n\n\n\n\n# Java\n\n> JavaJDK 1.5JavaJavaType Erasure\n\n\n\n * <>\n * Object\n * \n * \n\n\n\nhttp://softlab.sdut.edu.cn/blog/subaochen/2017/01/generics-type-erasure/\n\n *  - \n\nObject<T><?>Object\n\n\n\n *  - \n\n<T extends Number><? extends Number>Number<? super Number>Object\n\n\n\n * \n\n\n\n\n\n\n# \n\n> Java\n\n * \n\npublic class Test {\n\n    public static void main(String[] args) {\n\n        ArrayList<String> list1 = new ArrayList<String>();\n        list1.add("abc");\n\n        ArrayList<Integer> list2 = new ArrayList<Integer>();\n        list2.add(123);\n\n        System.out.println(list1.getClass() == list2.getClass()); // true\n    }\n}\n\n\nArrayListArrayList<String>ArrayList<Integer>list1list2getClass()trueStringInteger\n\n * \n\npublic class Test {\n\n    public static void main(String[] args) throws Exception {\n\n        ArrayList<Integer> list = new ArrayList<Integer>();\n\n        list.add(1);  // add  Integer\n\n        list.getClass().getMethod("add", Object.class).invoke(list, "asd");\n\n        for (int i = 0; i < list.size(); i++) {\n            System.out.println(list.get(i));\n        }\n    }\n\n}\n\n\nArrayListIntegeradd()add()Integer\n\n\n# ?\n\n> \n\n Object\n\n * Object\n\nclass Pair<T> {  \n    private T value;  \n    public T getValue() {  \n        return value;  \n    }  \n    public void setValue(T  value) {  \n        this.value = value;  \n    }  \n} \n\n\nPair:\n\nclass Pair {  \n    private Object value;  \n    public Object getValue() {  \n        return value;  \n    }  \n    public void setValue(Object  value) {  \n        this.value = value;  \n    }  \n}\n\n\nPair<T>T ObjectJavaPairPair<String>Pair<Integer>PairObject\n\nArrayListObject\n\n\n\n: Pair\n\npublic class Pair<T extends Comparable> {}\n\n\nComparable\n\n\n\n:\n\n * Object\n * \n\npublic class Test {  \n    public static void main(String[] args) {  \n\n        /***/  \n        int i = Test.add(1, 2); //IntegerTInteger  \n        Number f = Test.add(1, 1.2); //IntegerFloatNumber  \n        Object o = Test.add(1, "asd"); //IntegerStringObject  \n\n        /***/  \n        int a = Test.<Integer>add(1, 2); //IntegerInteger  \n        int b = Test.<Integer>add(1, 2.2); //IntegerFloat  \n        Number c = Test.<Number>add(1, 2.2); //NumberIntegerFloat  \n    }  \n\n    //  \n    public static <T> T add(T x,T y){  \n        return y;  \n    }  \n}\n\n\nObjectArrayListArrayList\n\n * Object\n\npublic static void main(String[] args) {  \n    ArrayList list = new ArrayList();  \n    list.add(1);  \n    list.add("121");  \n    list.add(new Date());  \n}  \n\n\n\n# \n\n>  ArrayList StringObject\n\nJava\n\n\n\npublic static  void main(String[] args) {  \n\n    ArrayList<String> list = new ArrayList<String>();  \n    list.add("123");  \n    list.add(123);//  \n}\n\n\naddIDEObject\n\n\n\n ArrayList:\n\nArrayList list = new ArrayList();  \n\n\n:\n\nArrayList<String> list = new ArrayList<String>();\n\n\n\n\nArrayList<String> list1 = new ArrayList(); // \nArrayList list2 = new ArrayList<String>(); // \n\n\n\n\n\n\nnew ArrayList()list1addlist1list2\n\n\n\npublic class Test {  \n\n    public static void main(String[] args) {  \n\n        ArrayList<String> list1 = new ArrayList();  \n        list1.add("1"); //  \n        list1.add(1); //  \n        String str1 = list1.get(0); //String  \n\n        ArrayList list2 = new ArrayList<String>();  \n        list2.add("1"); //  \n        list2.add(1); //  \n        Object object = list2.get(0); //Object  \n\n        new ArrayList<String>().add("11"); //  \n        new ArrayList<String>().add(22); //  \n\n        String str2 = new ArrayList<String>().get(0); //String  \n    }  \n} \n\n\n\n\n\n\nJava:\n\nArrayList<String> list1 = new ArrayList<Object>(); //  \nArrayList<Object> list2 = new ArrayList<String>(); //\n\n\n * \n\nArrayList<Object> list1 = new ArrayList<Object>();  \nlist1.add(new Object());  \nlist1.add(new Object());  \nArrayList<String> list2 = list1; //\n\n\n4list2get()StringObjectClassCastExceptionJava\n\n * \n\nArrayList<String> list1 = new ArrayList<String>();  \nlist1.add(new String());  \nlist1.add(new String());\n\nArrayList<Object> list2 = list1; //\n\n\nlist2ClassCastExceptionStringObject\n\njavalist2add()StringObject\n\n\n\n\n# \n\n> JVM\n\n\n\nclass Pair<T> {  \n\n    private T value;  \n\n    public T getValue() {  \n        return value;  \n    }  \n\n    public void setValue(T value) {  \n        this.value = value;  \n    }  \n}\n\n\n\n\nclass DateInter extends Pair<Date> {  \n\n    @Override  \n    public void setValue(Date value) {  \n        super.setValue(value);  \n    }  \n\n    @Override  \n    public Date getValue() {  \n        return super.getValue();  \n    }  \n}\n\n\nPair<Date>DateDate\n\npublic Date getValue() {  \n    return value;  \n}  \n\npublic void setValue(Date value) {  \n    this.value = value;  \n}\n\n\n@Override\n\nObject\n\nclass Pair {  \n    private Object value;  \n\n    public Object getValue() {  \n        return value;  \n    }  \n\n    public void setValue(Object  value) {  \n        this.value = value;  \n    }  \n} \n\n\n\n\n@Override  \npublic void setValue(Date value) {  \n    super.setValue(value);  \n}  \n@Override  \npublic Date getValue() {  \n    return super.getValue();  \n}\n\n\nsetValueObjectDate main\n\npublic static void main(String[] args) throws ClassNotFoundException {  \n        DateInter dateInter = new DateInter();  \n        dateInter.setValue(new Date());                  \n        dateInter.setValue(new Object()); //  \n}\n\n\nsetValueObjectDateObject\n\n\n\nDatePair<Date>\n\nclass Pair {  \n    private Date value;  \n    public Date getValue() {  \n        return value;  \n    }  \n    public void setValue(Date value) {  \n        this.value = value;  \n    }  \n}\n\n\nDate\n\nDateObjectJVMDate\n\n> JVM\n\njavap -c classNameDateInter\n\nclass com.tao.test.DateInter extends com.tao.test.Pair<java.util.Date> {  \n  com.tao.test.DateInter();  \n    Code:  \n       0: aload_0  \n       1: invokespecial #8                  // Method com/tao/test/Pair."<init>":()V  \n       4: return  \n\n  public void setValue(java.util.Date);  //setValue  \n    Code:  \n       0: aload_0  \n       1: aload_1  \n       2: invokespecial #16                 // Method com/tao/test/Pair.setValue:(Ljava/lang/Object;)V  \n       5: return  \n\n  public java.util.Date getValue();    //getValue  \n    Code:  \n       0: aload_0  \n       1: invokespecial #23                 // Method com/tao/test/Pair.getValue:()Ljava/lang/Object;  \n       4: checkcast     #26                 // class java/util/Date  \n       7: areturn  \n\n  public java.lang.Object getValue();     //  \n    Code:  \n       0: aload_0  \n       1: invokevirtual #28                 // Method getValue:()Ljava/util/Date getValue;  \n       4: areturn  \n\n  public void setValue(java.lang.Object);   //  \n    Code:  \n       0: aload_0  \n       1: aload_1  \n       2: checkcast     #26                 // class java/util/Date  \n       5: invokevirtual #30                 // Method setValue:(Ljava/util/Date; setValue)V  \n       8: return  \n}\n\n\nsetValuegetValue4ObjectsetvaluegetValue@Oveerride\n\n\n\nsetValuegetValue\n\nsetValue\n\ngetValue\n\ngetValue\n\npublic Object getValue() {  \n    return super.getValue();  \n}\n\n\n\n\npublic Date getValue() {  \n    return super.getValue();  \n}\n\n\n\n\nObject getValue()Date getValue()Java\n\n\n# \n\n> ArrayList<int>ArrayList<Integer>, \n\nArrayListObjectObjectintInteger\n\nlist.add(1)Java\n\n\n# \n\n> , \n\n\n\nT test = new T(); // ERROR\n\n\n Java T  Object new T()  new Object()  \n\nstatic <T> T newTclass (Class < T > clazz) throws InstantiationException, IllegalAccessException {\n    T obj = clazz.newInstance();\n    return obj;\n}\n\n\n\n# \n\nOracle\n\nList<String>[] lsa = new List<String>[10]; // Not really allowed.\nObject o = lsa;\nObject[] oa = (Object[]) o;\nList<Integer> li = new ArrayList<Integer>();\nli.add(new Integer(3));\noa[1] = li; // Unsound, but passes run time store check\nString s = lsa[1].get(0); // Run-time error ClassCastException.\n\n\n JVM  oa[1]  ArrayList  ClassCastException ClassCastException Java \n\n\n\nList<?>[] lsa = new List<?>[10]; // OK, array of unbounded wildcard type.\nObject o = lsa;\nObject[] oa = (Object[]) o;\nList<Integer> li = new ArrayList<Integer>();\nli.add(new Integer(3));\noa[1] = li; // Correct.\nInteger i = (Integer) lsa[1].get(0); // OK\n\n\nJava \n\nOracle https://docs.oracle.com/javase/tutorial/extra/generics/fineprint.html\n\n\n\nList<String>[] list11 = new ArrayList<String>[10]; // \nList<String>[] list12 = new ArrayList<?>[10]; // \nList<String>[] list13 = (List<String>[]) new ArrayList<?>[10]; //OK \nList<?>[] list14 = new ArrayList<String>[10]; // \nList<?>[] list15 = new ArrayList<?>[10]; //OK \nList<String>[] list6 = new ArrayList[10]; //OK\n\n\n Java \n\n\n# \n\n> new ArrayList[10] \n\n java.lang.reflect.Array.newInstance(Class<T> componentType, int length) \n\npublic class ArrayWithTypeToken<T> {\n    private T[] array;\n\n    public ArrayWithTypeToken(Class<T> type, int size) {\n        array = (T[]) Array.newInstance(type, size);\n    }\n\n    public void put(int index, T item) {\n        array[index] = item;\n    }\n\n    public T get(int index) {\n        return array[index];\n    }\n\n    public T[] create() {\n        return array;\n    }\n}\n//...\n\nArrayWithTypeToken<Integer> arrayToken = new ArrayWithTypeToken<Integer>(Integer.class, 100);\nInteger[] array = arrayToken.create();\n\n\n T Java \n\n\n# \n\n> \n\n\n\npublic class Test2<T> {    \n    public static T one;   //    \n    public static  T show(T one){ //    \n        return null;    \n    }    \n}\n\n\n\n\n\n\npublic class Test2<T> {    \n\n    public static <T >T show(T one){ //    \n        return null;    \n    }    \n}\n\n\nT TT\n\n\n# \n\n * Throwable\n\npublic class Problem<T> extends Exception {\n\n}\n\n\nThrowable\n\ntry{\n\n} catch(Problem<Integer> e1) {\n\n} catch(Problem<Number> e2) {\n\n} \n\n\ncatchObjectcatch,\n\ntry{\n\n} catch(Problem<Object> e1) {\n\n} catch(Problem<Object> e2) {\n\n}\n\n\n\n\n * catch\n\npublic static <T extends Throwable> void doWork(Class<T> t) {\n    try {\n        ...\n    } catch(T e) { //\n        ...\n    }\n}\n\n\nTThrowablecatch\n\npublic static <T extends Throwable> void doWork(Class<T> t){\n    try {\n\n    } catch(T e) { //\n\n    } catch(IndexOutOfBounds e) {\n\n    }                         \n}\n\n\nTArrayIndexOutofBoundsThrowableArrayIndexOutofBoundsIndexOutofBoundsjavacatch\n\n * \n\npublic static<T extends Throwable> void doWork(T t) throws T {\n    try{\n        ...\n    } catch(Throwable realCause) {\n        t.initCause(realCause);\n        throw t; \n    }\n}\n\n\n\n\n\n# \n\n> java.lang.reflect.Type\n\njava.lang.reflect.TypeJava, Java. Type(GenericArrayType)(ParameterizedType)(TypeVariable)(WildcardType)(Class)(Class), Type\n\npublic class GenericType<T> {\n    private T data;\n\n    public T getData() {\n        return data;\n    }\n\n    public void setData(T data) {\n        this.data = data;\n    }\n\n    public static void main(String[] args) {\n        GenericType<String> genericType = new GenericType<String>() {};\n        Type superclass = genericType.getClass().getGenericSuperclass();\n        //getActualTypeArguments , Map<String, Integer>[String, Integer]\n        Type type = ((ParameterizedType) superclass).getActualTypeArguments()[0]; \n        System.out.println(type);//class java.lang.String\n    }\n}\n\n\n ParameterizedType:\n\npublic interface ParameterizedType extends Type {\n    // , Map<String, Integer>[String, Integer]\n    Type[] getActualTypeArguments();\n    \n    //classinterface, List<?>List\n    Type getRawType();\n    \n    //. ,O<T>.I<S>, O<T>. null \n    Type getOwnerType();\n}\n\n\n\n# \n\n> Java\n\n * https://blog.csdn.net/sunxianghuang/article/details/51982979\n * https://blog.csdn.net/LonelyRoamer/article/details/7868820\n * https://docs.oracle.com/javase/tutorial/extra/generics/index.html\n * https://blog.csdn.net/s10461/article/details/53941091\n * https://www.cnblogs.com/iyangyuan/archive/2013/04/09/3011274.html\n * https://www.cnblogs.com/rudy-laura/articles/3391013.html\n * https://www.jianshu.com/p/986f732ed2f1\n * https://blog.csdn.net/u011240877/article/details/53545041\n *  https://www.pdai.tech/md/java/basic/java-basic-x-generic.html',normalizedContent:'# java  - \n\n> javajdk 1.5javajavatype erasurejava java\n\n * java  - \n   * \n   * \n     * \n     * \n     * \n     * \n     * \n   * \n     * java\n     * \n     * ?\n     * \n     * \n     * \n     * \n     * \n     * \n     * \n     * \n     * \n   * \n\n\n# \n\n> \n\n\n\n * \n\n\n\nprivate static int add(int a, int b) {\n    system.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\nprivate static float add(float a, float b) {\n    system.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\nprivate static double add(double a, double b) {\n    system.out.println(a + "+" + b + "=" + (a + b));\n    return a + b;\n}\n\n\nadd\n\nprivate static <t extends number> double add(t a, t b) {\n    system.out.println(a + "+" + b + "=" + (a.doublevalue() + b.doublevalue()));\n    return a.doublevalue() + b.doublevalue();\n}\n\n\n * \n\n\n\nlist list = new arraylist();\nlist.add("xxstring");\nlist.add(100d);\nlist.add(new person());\n\n\nlistlistobjectjava.lang.classcastexception\n\n\n\nlist<string> list = new arraylist<string>();\n\n// liststring, \n\n\n\n# \n\n\n\n - java\n\n\n# \n\n * \n\nclass point<t>{         // ttype  \n    private t var ;     // vart  \n    public t getvar(){  //   \n        return var ;  \n    }  \n    public void setvar(t var){  //   \n        this.var = var ;  \n    }  \n}  \npublic class genericsdemo06{  \n    public static void main(string args[]){  \n        point<string> p = new point<string>() ;     // varstring  \n        p.setvar("it") ;                            //   \n        system.out.println(p.getvar().length()) ;   //   \n    }  \n}\n\n\n * \n\nclass notepad<k,v>{       //   \n    private k key ;     //   \n    private v value ;   //   \n    public k getkey(){  \n        return this.key ;  \n    }  \n    public v getvalue(){  \n        return this.value ;  \n    }  \n    public void setkey(k key){  \n        this.key = key ;  \n    }  \n    public void setvalue(v value){  \n        this.value = value ;  \n    }  \n} \npublic class genericsdemo09{  \n    public static void main(string args[]){  \n        notepad<string,integer> t = null ;        //   \n        t = new notepad<string,integer>() ;       // keystringvalueinteger  \n        t.setkey("") ;        //   \n        t.setvalue(20) ;            //   \n        system.out.print("" + t.getkey()) ;      //   \n        system.out.print("" + t.getvalue()) ;       //   \n  \n    }  \n}\n\n\n\n# \n\n * \n\ninterface info<t>{        //   \n    public t getvar() ; //   \n}  \nclass infoimpl<t> implements info<t>{   //   \n    private t var ;             //   \n    public infoimpl(t var){     //   \n        this.setvar(var) ;    \n    }  \n    public void setvar(t var){  \n        this.var = var ;  \n    }  \n    public t getvar(){  \n        return this.var ;  \n    }  \n} \npublic class genericsdemo24{  \n    public static void main(string arsg[]){  \n        info<string> i = null;        //   \n        i = new infoimpl<string>("") ;  //   \n        system.out.println("" + i.getvar()) ;  \n    }  \n}  \n\n\n\n# \n\nhttps://www.cnblogs.com/iyangyuan/archive/2013/04/09/3011274.html\n\n * \n\n\n\n * \n\n\n\n<t>tt\n\nclass<t>class<t>c\n\ncnewcnewinstance\n\nclass<t>class.forname()class<t>class.forname()forname()class<t>forname()userclass<user>cclass<user>tuserobjuser\n\nclass<t>\n\nnew\n\n\n# \n\n *  \n\nclass a{}\nclass b extends a {}\n\n// \npublic static void funa(a a) {\n    // ...          \n}\npublic static void funb(b b) {\n    funa(b);\n    // ...             \n}\n\n// fund\npublic static void func(list<a> lista) {\n    // ...          \n}\npublic static void fund(list<b> listb) {\n    func(listb); // unresolved compilation problem: the method doprint(list<a>) in the type test is not applicable for the arguments (list<b>)\n    // ...             \n}\n\n\n\n\njava<? extends a>a()aaaba\n\npublic static void func(list<? extends a> lista) {\n    // ...          \n}\npublic static void fund(list<b> listb) {\n    func(listb); // ok\n    // ...             \n}\n\n\n * \n\n\n\n\n\nclass info<t extends number>{    // \n    private t var ;        // \n    public void setvar(t var){\n        this.var = var ;\n    }\n    public t getvar(){\n        return this.var ;\n    }\n    public string tostring(){    // \n        return this.var.tostring() ;\n    }\n}\npublic class demo1{\n    public static void main(string args[]){\n        info<integer> i1 = new info<integer>() ;        // integer\n    }\n}\n\n\n\n\nclass info<t>{\n    private t var ;        // \n    public void setvar(t var){\n        this.var = var ;\n    }\n    public t getvar(){\n        return this.var ;\n    }\n    public string tostring(){    // \n        return this.var.tostring() ;\n    }\n}\npublic class genericsdemo21{\n    public static void main(string args[]){\n        info<string> i1 = new info<string>() ;        // string\n        info<object> i2 = new info<object>() ;        // object\n        i1.setvar("hello") ;\n        i2.setvar(new object()) ;\n        fun(i1) ;\n        fun(i2) ;\n    }\n    public static void fun(info<? super string> temp){    // stringobjectstringobject\n        system.out.print(temp + ", ") ;\n    }\n}\n\n\n\n\n<?> \n<? extends e> extends \n<? super e> super \n\n// effictive java\n//   \n1.  t  < ? extends t>;\n2.  t  < ? super t>\n3. \n\n\n * \n\nprivate  <e extends comparable<? super e>> e max(list<? extends e> e1) {\n    if (e1 == null){\n        return null;\n    }\n    // e \n    iterator<? extends e> iterator = e1.iterator();\n    e result = iterator.next();\n    while (iterator.hasnext()){\n        e next = iterator.next();\n        if (next.compareto(result) > 0){\n            result = next;\n        }\n    }\n    return result;\n}\n\n\n e <e extends comparable<? super e>>\n\n *  e  extends comparable<> extends \n\n * comparable< ? super e>  e  e  super\n\n *  list< ? extends e>  e \n\n * \n\n&\n\npublic class client {\n    //25008\n    public static <t extends staff & passenger> void discount(t t){\n        if(t.getsalary()<2500 && t.isstanding()){\n            system.out.println("");\n        }\n    }\n    public static void main(string[] args) {\n        discount(new me());\n    }\n}\n\n\n\n# \n\n> \n\n\n\nlist<string>[] list11 = new arraylist<string>[10]; // \nlist<string>[] list12 = new arraylist<?>[10]; // \nlist<string>[] list13 = (list<string>[]) new arraylist<?>[10]; //ok \nlist<?>[] list14 = new arraylist<string>[10]; // \nlist<?>[] list15 = new arraylist<?>[10]; //ok \nlist<string>[] list6 = new arraylist[10]; //ok\n\n\n\n\n * \n\npublic class genericsdemo30{  \n    public static void main(string args[]){  \n        integer i[] = fun1(1,2,3,4,5,6) ;   //   \n        fun2(i) ;  \n    }  \n    public static <t> t[] fun1(t...arg){  //   \n        return arg ;            //   \n    }  \n    public static <t> void fun2(t param[]){   //   \n        system.out.print("") ;  \n        for(t t:param){  \n            system.out.print(t + "") ;  \n        }  \n    }  \n}\n\n\n * \n\npublic arraywithtypetoken(class<t> type, int size) {\n    array = (t[]) array.newinstance(type, size);\n}\n\n\n\n\n\n# \n\n\n\n\n\n\n# java\n\n> javajdk 1.5javajavatype erasure\n\n\n\n * <>\n * object\n * \n * \n\n\n\nhttp://softlab.sdut.edu.cn/blog/subaochen/2017/01/generics-type-erasure/\n\n *  - \n\nobject<t><?>object\n\n\n\n *  - \n\n<t extends number><? extends number>number<? super number>object\n\n\n\n * \n\n\n\n\n\n\n# \n\n> java\n\n * \n\npublic class test {\n\n    public static void main(string[] args) {\n\n        arraylist<string> list1 = new arraylist<string>();\n        list1.add("abc");\n\n        arraylist<integer> list2 = new arraylist<integer>();\n        list2.add(123);\n\n        system.out.println(list1.getclass() == list2.getclass()); // true\n    }\n}\n\n\narraylistarraylist<string>arraylist<integer>list1list2getclass()truestringinteger\n\n * \n\npublic class test {\n\n    public static void main(string[] args) throws exception {\n\n        arraylist<integer> list = new arraylist<integer>();\n\n        list.add(1);  // add  integer\n\n        list.getclass().getmethod("add", object.class).invoke(list, "asd");\n\n        for (int i = 0; i < list.size(); i++) {\n            system.out.println(list.get(i));\n        }\n    }\n\n}\n\n\narraylistintegeradd()add()integer\n\n\n# ?\n\n> \n\n object\n\n * object\n\nclass pair<t> {  \n    private t value;  \n    public t getvalue() {  \n        return value;  \n    }  \n    public void setvalue(t  value) {  \n        this.value = value;  \n    }  \n} \n\n\npair:\n\nclass pair {  \n    private object value;  \n    public object getvalue() {  \n        return value;  \n    }  \n    public void setvalue(object  value) {  \n        this.value = value;  \n    }  \n}\n\n\npair<t>t objectjavapairpair<string>pair<integer>pairobject\n\narraylistobject\n\n\n\n: pair\n\npublic class pair<t extends comparable> {}\n\n\ncomparable\n\n\n\n:\n\n * object\n * \n\npublic class test {  \n    public static void main(string[] args) {  \n\n        /***/  \n        int i = test.add(1, 2); //integertinteger  \n        number f = test.add(1, 1.2); //integerfloatnumber  \n        object o = test.add(1, "asd"); //integerstringobject  \n\n        /***/  \n        int a = test.<integer>add(1, 2); //integerinteger  \n        int b = test.<integer>add(1, 2.2); //integerfloat  \n        number c = test.<number>add(1, 2.2); //numberintegerfloat  \n    }  \n\n    //  \n    public static <t> t add(t x,t y){  \n        return y;  \n    }  \n}\n\n\nobjectarraylistarraylist\n\n * object\n\npublic static void main(string[] args) {  \n    arraylist list = new arraylist();  \n    list.add(1);  \n    list.add("121");  \n    list.add(new date());  \n}  \n\n\n\n# \n\n>  arraylist stringobject\n\njava\n\n\n\npublic static  void main(string[] args) {  \n\n    arraylist<string> list = new arraylist<string>();  \n    list.add("123");  \n    list.add(123);//  \n}\n\n\naddideobject\n\n\n\n arraylist:\n\narraylist list = new arraylist();  \n\n\n:\n\narraylist<string> list = new arraylist<string>();\n\n\n\n\narraylist<string> list1 = new arraylist(); // \narraylist list2 = new arraylist<string>(); // \n\n\n\n\n\n\nnew arraylist()list1addlist1list2\n\n\n\npublic class test {  \n\n    public static void main(string[] args) {  \n\n        arraylist<string> list1 = new arraylist();  \n        list1.add("1"); //  \n        list1.add(1); //  \n        string str1 = list1.get(0); //string  \n\n        arraylist list2 = new arraylist<string>();  \n        list2.add("1"); //  \n        list2.add(1); //  \n        object object = list2.get(0); //object  \n\n        new arraylist<string>().add("11"); //  \n        new arraylist<string>().add(22); //  \n\n        string str2 = new arraylist<string>().get(0); //string  \n    }  \n} \n\n\n\n\n\n\njava:\n\narraylist<string> list1 = new arraylist<object>(); //  \narraylist<object> list2 = new arraylist<string>(); //\n\n\n * \n\narraylist<object> list1 = new arraylist<object>();  \nlist1.add(new object());  \nlist1.add(new object());  \narraylist<string> list2 = list1; //\n\n\n4list2get()stringobjectclasscastexceptionjava\n\n * \n\narraylist<string> list1 = new arraylist<string>();  \nlist1.add(new string());  \nlist1.add(new string());\n\narraylist<object> list2 = list1; //\n\n\nlist2classcastexceptionstringobject\n\njavalist2add()stringobject\n\n\n\n\n# \n\n> jvm\n\n\n\nclass pair<t> {  \n\n    private t value;  \n\n    public t getvalue() {  \n        return value;  \n    }  \n\n    public void setvalue(t value) {  \n        this.value = value;  \n    }  \n}\n\n\n\n\nclass dateinter extends pair<date> {  \n\n    @override  \n    public void setvalue(date value) {  \n        super.setvalue(value);  \n    }  \n\n    @override  \n    public date getvalue() {  \n        return super.getvalue();  \n    }  \n}\n\n\npair<date>datedate\n\npublic date getvalue() {  \n    return value;  \n}  \n\npublic void setvalue(date value) {  \n    this.value = value;  \n}\n\n\n@override\n\nobject\n\nclass pair {  \n    private object value;  \n\n    public object getvalue() {  \n        return value;  \n    }  \n\n    public void setvalue(object  value) {  \n        this.value = value;  \n    }  \n} \n\n\n\n\n@override  \npublic void setvalue(date value) {  \n    super.setvalue(value);  \n}  \n@override  \npublic date getvalue() {  \n    return super.getvalue();  \n}\n\n\nsetvalueobjectdate main\n\npublic static void main(string[] args) throws classnotfoundexception {  \n        dateinter dateinter = new dateinter();  \n        dateinter.setvalue(new date());                  \n        dateinter.setvalue(new object()); //  \n}\n\n\nsetvalueobjectdateobject\n\n\n\ndatepair<date>\n\nclass pair {  \n    private date value;  \n    public date getvalue() {  \n        return value;  \n    }  \n    public void setvalue(date value) {  \n        this.value = value;  \n    }  \n}\n\n\ndate\n\ndateobjectjvmdate\n\n> jvm\n\njavap -c classnamedateinter\n\nclass com.tao.test.dateinter extends com.tao.test.pair<java.util.date> {  \n  com.tao.test.dateinter();  \n    code:  \n       0: aload_0  \n       1: invokespecial #8                  // method com/tao/test/pair."<init>":()v  \n       4: return  \n\n  public void setvalue(java.util.date);  //setvalue  \n    code:  \n       0: aload_0  \n       1: aload_1  \n       2: invokespecial #16                 // method com/tao/test/pair.setvalue:(ljava/lang/object;)v  \n       5: return  \n\n  public java.util.date getvalue();    //getvalue  \n    code:  \n       0: aload_0  \n       1: invokespecial #23                 // method com/tao/test/pair.getvalue:()ljava/lang/object;  \n       4: checkcast     #26                 // class java/util/date  \n       7: areturn  \n\n  public java.lang.object getvalue();     //  \n    code:  \n       0: aload_0  \n       1: invokevirtual #28                 // method getvalue:()ljava/util/date getvalue;  \n       4: areturn  \n\n  public void setvalue(java.lang.object);   //  \n    code:  \n       0: aload_0  \n       1: aload_1  \n       2: checkcast     #26                 // class java/util/date  \n       5: invokevirtual #30                 // method setvalue:(ljava/util/date; setvalue)v  \n       8: return  \n}\n\n\nsetvaluegetvalue4objectsetvaluegetvalue@oveerride\n\n\n\nsetvaluegetvalue\n\nsetvalue\n\ngetvalue\n\ngetvalue\n\npublic object getvalue() {  \n    return super.getvalue();  \n}\n\n\n\n\npublic date getvalue() {  \n    return super.getvalue();  \n}\n\n\n\n\nobject getvalue()date getvalue()java\n\n\n# \n\n> arraylist<int>arraylist<integer>, \n\narraylistobjectobjectintinteger\n\nlist.add(1)java\n\n\n# \n\n> , \n\n\n\nt test = new t(); // error\n\n\n java t  object new t()  new object()  \n\nstatic <t> t newtclass (class < t > clazz) throws instantiationexception, illegalaccessexception {\n    t obj = clazz.newinstance();\n    return obj;\n}\n\n\n\n# \n\noracle\n\nlist<string>[] lsa = new list<string>[10]; // not really allowed.\nobject o = lsa;\nobject[] oa = (object[]) o;\nlist<integer> li = new arraylist<integer>();\nli.add(new integer(3));\noa[1] = li; // unsound, but passes run time store check\nstring s = lsa[1].get(0); // run-time error classcastexception.\n\n\n jvm  oa[1]  arraylist  classcastexception classcastexception java \n\n\n\nlist<?>[] lsa = new list<?>[10]; // ok, array of unbounded wildcard type.\nobject o = lsa;\nobject[] oa = (object[]) o;\nlist<integer> li = new arraylist<integer>();\nli.add(new integer(3));\noa[1] = li; // correct.\ninteger i = (integer) lsa[1].get(0); // ok\n\n\njava \n\noracle https://docs.oracle.com/javase/tutorial/extra/generics/fineprint.html\n\n\n\nlist<string>[] list11 = new arraylist<string>[10]; // \nlist<string>[] list12 = new arraylist<?>[10]; // \nlist<string>[] list13 = (list<string>[]) new arraylist<?>[10]; //ok \nlist<?>[] list14 = new arraylist<string>[10]; // \nlist<?>[] list15 = new arraylist<?>[10]; //ok \nlist<string>[] list6 = new arraylist[10]; //ok\n\n\n java \n\n\n# \n\n> new arraylist[10] \n\n java.lang.reflect.array.newinstance(class<t> componenttype, int length) \n\npublic class arraywithtypetoken<t> {\n    private t[] array;\n\n    public arraywithtypetoken(class<t> type, int size) {\n        array = (t[]) array.newinstance(type, size);\n    }\n\n    public void put(int index, t item) {\n        array[index] = item;\n    }\n\n    public t get(int index) {\n        return array[index];\n    }\n\n    public t[] create() {\n        return array;\n    }\n}\n//...\n\narraywithtypetoken<integer> arraytoken = new arraywithtypetoken<integer>(integer.class, 100);\ninteger[] array = arraytoken.create();\n\n\n t java \n\n\n# \n\n> \n\n\n\npublic class test2<t> {    \n    public static t one;   //    \n    public static  t show(t one){ //    \n        return null;    \n    }    \n}\n\n\n\n\n\n\npublic class test2<t> {    \n\n    public static <t >t show(t one){ //    \n        return null;    \n    }    \n}\n\n\nt tt\n\n\n# \n\n * throwable\n\npublic class problem<t> extends exception {\n\n}\n\n\nthrowable\n\ntry{\n\n} catch(problem<integer> e1) {\n\n} catch(problem<number> e2) {\n\n} \n\n\ncatchobjectcatch,\n\ntry{\n\n} catch(problem<object> e1) {\n\n} catch(problem<object> e2) {\n\n}\n\n\n\n\n * catch\n\npublic static <t extends throwable> void dowork(class<t> t) {\n    try {\n        ...\n    } catch(t e) { //\n        ...\n    }\n}\n\n\ntthrowablecatch\n\npublic static <t extends throwable> void dowork(class<t> t){\n    try {\n\n    } catch(t e) { //\n\n    } catch(indexoutofbounds e) {\n\n    }                         \n}\n\n\ntarrayindexoutofboundsthrowablearrayindexoutofboundsindexoutofboundsjavacatch\n\n * \n\npublic static<t extends throwable> void dowork(t t) throws t {\n    try{\n        ...\n    } catch(throwable realcause) {\n        t.initcause(realcause);\n        throw t; \n    }\n}\n\n\n\n\n\n# \n\n> java.lang.reflect.type\n\njava.lang.reflect.typejava, java. type(genericarraytype)(parameterizedtype)(typevariable)(wildcardtype)(class)(class), type\n\npublic class generictype<t> {\n    private t data;\n\n    public t getdata() {\n        return data;\n    }\n\n    public void setdata(t data) {\n        this.data = data;\n    }\n\n    public static void main(string[] args) {\n        generictype<string> generictype = new generictype<string>() {};\n        type superclass = generictype.getclass().getgenericsuperclass();\n        //getactualtypearguments , map<string, integer>[string, integer]\n        type type = ((parameterizedtype) superclass).getactualtypearguments()[0]; \n        system.out.println(type);//class java.lang.string\n    }\n}\n\n\n parameterizedtype:\n\npublic interface parameterizedtype extends type {\n    // , map<string, integer>[string, integer]\n    type[] getactualtypearguments();\n    \n    //classinterface, list<?>list\n    type getrawtype();\n    \n    //. ,o<t>.i<s>, o<t>. null \n    type getownertype();\n}\n\n\n\n# \n\n> java\n\n * https://blog.csdn.net/sunxianghuang/article/details/51982979\n * https://blog.csdn.net/lonelyroamer/article/details/7868820\n * https://docs.oracle.com/javase/tutorial/extra/generics/index.html\n * https://blog.csdn.net/s10461/article/details/53941091\n * https://www.cnblogs.com/iyangyuan/archive/2013/04/09/3011274.html\n * https://www.cnblogs.com/rudy-laura/articles/3391013.html\n * https://www.jianshu.com/p/986f732ed2f1\n * https://blog.csdn.net/u011240877/article/details/53545041\n *  https://www.pdai.tech/md/java/basic/java-basic-x-generic.html',charsets:{cjk:!0}},{title:"Collection - LinkedList",frontmatter:{},regularPath:"/java/collection/java-collection-LinkedList.html",relativePath:"java/collection/java-collection-LinkedList.md",key:"v-a5a02d48",path:"/java/collection/java-collection-LinkedList.html",headers:[{level:2,title:"Collection - LinkedList",slug:"collection-linkedlist",normalizedTitle:"collection - linkedlist",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:106},{level:2,title:"LinkedList",slug:"linkedlist",normalizedTitle:"linkedlist",charIndex:114},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:134},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:148},{level:3,title:"getFirst(), getLast()",slug:"getfirst-getlast",normalizedTitle:"getfirst(), getlast()",charIndex:160},{level:3,title:"removeFirst(), removeLast(), remove(e), remove(index)",slug:"removefirst-removelast-remove-e-remove-index",normalizedTitle:"removefirst(), removelast(), remove(e), remove(index)",charIndex:189},{level:3,title:"add()",slug:"add",normalizedTitle:"add()",charIndex:250},{level:3,title:"addAll()",slug:"addall",normalizedTitle:"addall()",charIndex:263},{level:3,title:"clear()",slug:"clear",normalizedTitle:"clear()",charIndex:279},{level:3,title:"Positional Access ",slug:"positional-access-",normalizedTitle:"positional access ",charIndex:294},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:322},{level:3,title:"Queue ",slug:"queue-",normalizedTitle:"queue ",charIndex:334},{level:3,title:"Deque ",slug:"deque-",normalizedTitle:"deque ",charIndex:350},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:364}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Collection - LinkedList  LinkedList   getFirst(), getLast() removeFirst(), removeLast(), remove(e), remove(index) add() addAll() clear() Positional Access   Queue  Deque  ",content:'# Collection - LinkedList\n\n> Collection - LinkedList\n\n * Collection - LinkedList\n   * \n   * LinkedList\n     * \n     * \n     * getFirst(), getLast()\n     * removeFirst(), removeLast(), remove(e), remove(index)\n     * add()\n     * addAll()\n     * clear()\n     * Positional Access \n     * \n     * Queue \n     * Deque \n   * \n\n\n# \n\nLinkedList__List__Deque_(Queue)(Stack)LinkedList__LinkedListJava_Stack_Java_Queue_()_ArrayDeque_LinkedList_()\n\n\n\n_LinkedList__LinkedList_(synchronized)Collections.synchronizedList()\n\n\n# LinkedList\n\n\n# \n\n_LinkedList__List__Queue__Stack__Deque__Node__LinkedList_firstlastfirstlastnull\n\n    transient int size = 0;\n\n    /**\n     * Pointer to first node.\n     * Invariant: (first == null && last == null) ||\n     *            (first.prev == null && first.item != null)\n     */\n    transient Node<E> first;\n\n    /**\n     * Pointer to last node.\n     * Invariant: (first == null && last == null) ||\n     *            (last.next == null && last.item != null)\n     */\n    transient Node<E> last;\n\n\nNode:\n\n    private static class Node<E> {\n        E item;\n        Node<E> next;\n        Node<E> prev;\n\n        Node(Node<E> prev, E element, Node<E> next) {\n            this.item = element;\n            this.next = next;\n            this.prev = prev;\n        }\n    }\n\n\n\n# \n\n    /**\n     * Constructs an empty list.\n     */\n    public LinkedList() {\n    }\n\n    /**\n     * Constructs a list containing the elements of the specified\n     * collection, in the order they are returned by the collection\'s\n     * iterator.\n     *\n     * @param  c the collection whose elements are to be placed into this list\n     * @throws NullPointerException if the specified collection is null\n     */\n    public LinkedList(Collection<? extends E> c) {\n        this();\n        addAll(c);\n    }\n\n\n\n# getFirst(), getLast()\n\n :\n\n    /**\n     * Returns the first element in this list.\n     *\n     * @return the first element in this list\n     * @throws NoSuchElementException if this list is empty\n     */\n    public E getFirst() {\n        final Node<E> f = first;\n        if (f == null)\n            throw new NoSuchElementException();\n        return f.item;\n    }\n\n    /**\n     * Returns the last element in this list.\n     *\n     * @return the last element in this list\n     * @throws NoSuchElementException if this list is empty\n     */\n    public E getLast() {\n        final Node<E> l = last;\n        if (l == null)\n            throw new NoSuchElementException();\n        return l.item;\n    }\n\n\n\n# removeFirst(), removeLast(), remove(e), remove(index)\n\nremove()remove(Object o)remove(int index)\n\n\n\n - , falseequals equalsunlinknodeLinkedListnullnull\n\n    /**\n     * Removes the first occurrence of the specified element from this list,\n     * if it is present.  If this list does not contain the element, it is\n     * unchanged.  More formally, removes the element with the lowest index\n     * {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>\n     * (if such an element exists).  Returns {@code true} if this list\n     * contained the specified element (or equivalently, if this list\n     * changed as a result of the call).\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if this list contained the specified element\n     */\n    public boolean remove(Object o) {\n        if (o == null) {\n            for (Node<E> x = first; x != null; x = x.next) {\n                if (x.item == null) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        } else {\n            for (Node<E> x = first; x != null; x = x.next) {\n                if (o.equals(x.item)) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    \n    /**\n     * Unlinks non-null node x.\n     */\n    E unlink(Node<E> x) {\n        // assert x != null;\n        final E element = x.item;\n        final Node<E> next = x.next;\n        final Node<E> prev = x.prev;\n\n        if (prev == null) {// \n            first = next;\n        } else {\n            prev.next = next;\n            x.prev = null;\n        }\n\n        if (next == null) {// \n            last = prev;\n        } else {\n            next.prev = prev;\n            x.next = null;\n        }\n\n        x.item = null; // GC\n        size--;\n        modCount++;\n        return element;\n    }\n\n\nremove(int index) indexunlinknode\n\n    /**\n     * Removes the element at the specified position in this list.  Shifts any\n     * subsequent elements to the left (subtracts one from their indices).\n     * Returns the element that was removed from the list.\n     *\n     * @param index the index of the element to be removed\n     * @return the element previously at the specified position\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        checkElementIndex(index);\n        return unlink(node(index));\n    }\n\n\nhead:\n\n    /**\n     * Removes and returns the first element from this list.\n     *\n     * @return the first element from this list\n     * @throws NoSuchElementException if this list is empty\n     */\n    public E removeFirst() {\n        final Node<E> f = first;\n        if (f == null)\n            throw new NoSuchElementException();\n        return unlinkFirst(f);\n    }\n\n\n    /**\n     * Unlinks non-null first node f.\n     */\n    private E unlinkFirst(Node<E> f) {\n        // assert f == first && f != null;\n        final E element = f.item;\n        final Node<E> next = f.next;\n        f.item = null;\n        f.next = null; // help GC\n        first = next;\n        if (next == null)\n            last = null;\n        else\n            next.prev = null;\n        size--;\n        modCount++;\n        return element;\n    }\n\n\nlast:\n\n/**\n     * Removes and returns the last element from this list.\n     *\n     * @return the last element from this list\n     * @throws NoSuchElementException if this list is empty\n     */\n    public E removeLast() {\n        final Node<E> l = last;\n        if (l == null)\n            throw new NoSuchElementException();\n        return unlinkLast(l);\n    }\n    \n    /**\n     * Unlinks non-null last node l.\n     */\n    private E unlinkLast(Node<E> l) {\n        // assert l == last && l != null;\n        final E element = l.item;\n        final Node<E> prev = l.prev;\n        l.item = null;\n        l.prev = null; // help GC\n        last = prev;\n        if (prev == null)\n            first = null;\n        else\n            prev.next = null;\n        size--;\n        modCount++;\n        return element;\n    }\n\n\n\n\n\n# add()\n\n_add()_add(E e)_LinkedList_lastadd(int index, E element)\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * <p>This method is equivalent to {@link #addLast}.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        linkLast(e);\n        return true;\n    }\n    \n    /**\n     * Links e as last element.\n     */\n    void linkLast(E e) {\n        final Node<E> l = last;\n        final Node<E> newNode = new Node<>(l, e, null);\n        last = newNode;\n        if (l == null)\n            first = newNode;\n        else\n            l.next = newNode;\n        size++;\n        modCount++;\n    }\n\n\n\n\nadd(int index, E element), index==sizeadd(E e); : 1.index,node(index)2.\n\n    /**\n     * Inserts the specified element at the specified position in this list.\n     * Shifts the element currently at that position (if any) and any\n     * subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public void add(int index, E element) {\n        checkPositionIndex(index);\n\n        if (index == size)\n            linkLast(element);\n        else\n            linkBefore(element, node(index));\n    }\n\n\nnode(int index)trickindex < (size >> 1)indexlinkedListindexarrayList\n\n    /**\n     * Returns the (non-null) Node at the specified element index.\n     */\n    Node<E> node(int index) {\n        // assert isElementIndex(index);\n\n        if (index < (size >> 1)) {\n            Node<E> x = first;\n            for (int i = 0; i < index; i++)\n                x = x.next;\n            return x;\n        } else {\n            Node<E> x = last;\n            for (int i = size - 1; i > index; i--)\n                x = x.prev;\n            return x;\n        }\n    }\n\n\n\n# addAll()\n\naddAll(index, c) add(index,e)fail-fastmodCount1\n\n    /**\n     * Appends all of the elements in the specified collection to the end of\n     * this list, in the order that they are returned by the specified\n     * collection\'s iterator.  The behavior of this operation is undefined if\n     * the specified collection is modified while the operation is in\n     * progress.  (Note that this will occur if the specified collection is\n     * this list, and it\'s nonempty.)\n     *\n     * @param c collection containing elements to be added to this list\n     * @return {@code true} if this list changed as a result of the call\n     * @throws NullPointerException if the specified collection is null\n     */\n    public boolean addAll(Collection<? extends E> c) {\n        return addAll(size, c);\n    }\n\n    /**\n     * Inserts all of the elements in the specified collection into this\n     * list, starting at the specified position.  Shifts the element\n     * currently at that position (if any) and any subsequent elements to\n     * the right (increases their indices).  The new elements will appear\n     * in the list in the order that they are returned by the\n     * specified collection\'s iterator.\n     *\n     * @param index index at which to insert the first element\n     *              from the specified collection\n     * @param c collection containing elements to be added to this list\n     * @return {@code true} if this list changed as a result of the call\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     * @throws NullPointerException if the specified collection is null\n     */\n    public boolean addAll(int index, Collection<? extends E> c) {\n        checkPositionIndex(index);\n\n        Object[] a = c.toArray();\n        int numNew = a.length;\n        if (numNew == 0)\n            return false;\n\n        Node<E> pred, succ;\n        if (index == size) {\n            succ = null;\n            pred = last;\n        } else {\n            succ = node(index);\n            pred = succ.prev;\n        }\n\n        for (Object o : a) {\n            @SuppressWarnings("unchecked") E e = (E) o;\n            Node<E> newNode = new Node<>(pred, e, null);\n            if (pred == null)\n                first = newNode;\n            else\n                pred.next = newNode;\n            pred = newNode;\n        }\n\n        if (succ == null) {\n            last = pred;\n        } else {\n            pred.next = succ;\n            succ.prev = pred;\n        }\n\n        size += numNew;\n        modCount++;\n        return true;\n    }\n\n\n\n# clear()\n\nGCnode\n\n    /**\n     * Removes all of the elements from this list.\n     * The list will be empty after this call returns.\n     */\n    public void clear() {\n        // Clearing all of the links between nodes is "unnecessary", but:\n        // - helps a generational GC if the discarded nodes inhabit\n        //   more than one generation\n        // - is sure to free memory even if there is a reachable Iterator\n        for (Node<E> x = first; x != null; ) {\n            Node<E> next = x.next;\n            x.item = null;\n            x.next = null;\n            x.prev = null;\n            x = next;\n        }\n        first = last = null;\n        size = 0;\n        modCount++;\n    }\n\n\n\n# Positional Access \n\nindex\n\n    /**\n     * Returns the element at the specified position in this list.\n     *\n     * @param index index of the element to return\n     * @return the element at the specified position in this list\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E get(int index) {\n        checkElementIndex(index);\n        return node(index).item;\n    }\n\n\n:\n\n    /**\n     * Replaces the element at the specified position in this list with the\n     * specified element.\n     *\n     * @param index index of the element to replace\n     * @param element element to be stored at the specified position\n     * @return the element previously at the specified position\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E set(int index, E element) {\n        checkElementIndex(index);\n        Node<E> x = node(index);\n        E oldVal = x.item;\n        x.item = element;\n        return oldVal;\n    }\n\n\nindex:\n\n    /**\n     * Inserts the specified element at the specified position in this list.\n     * Shifts the element currently at that position (if any) and any\n     * subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public void add(int index, E element) {\n        checkPositionIndex(index);\n\n        if (index == size)\n            linkLast(element);\n        else\n            linkBefore(element, node(index));\n    }\n\n\n:\n\n    /**\n     * Removes the element at the specified position in this list.  Shifts any\n     * subsequent elements to the left (subtracts one from their indices).\n     * Returns the element that was removed from the list.\n     *\n     * @param index the index of the element to be removed\n     * @return the element previously at the specified position\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public E remove(int index) {\n        checkElementIndex(index);\n        return unlink(node(index));\n    }\n\n\n:\n\n\n\n    /**\n     * Tells if the argument is the index of an existing element.\n     */\n    private boolean isElementIndex(int index) {\n        return index >= 0 && index < size;\n    }\n\n    /**\n     * Tells if the argument is the index of a valid position for an\n     * iterator or an add operation.\n     */\n    private boolean isPositionIndex(int index) {\n        return index >= 0 && index <= size;\n    }\n\n    /**\n     * Constructs an IndexOutOfBoundsException detail message.\n     * Of the many possible refactorings of the error handling code,\n     * this "outlining" performs best with both server and client VMs.\n     */\n    private String outOfBoundsMsg(int index) {\n        return "Index: "+index+", Size: "+size;\n    }\n\n    private void checkElementIndex(int index) {\n        if (!isElementIndex(index))\n            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n    }\n\n    private void checkPositionIndex(int index) {\n        if (!isPositionIndex(index))\n            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n    }\n\n\n\n# \n\n:\n\nindex, -1\n\n    /**\n     * Returns the index of the first occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * More formally, returns the lowest index {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     *\n     * @param o element to search for\n     * @return the index of the first occurrence of the specified element in\n     *         this list, or -1 if this list does not contain the element\n     */\n    public int indexOf(Object o) {\n        int index = 0;\n        if (o == null) {\n            for (Node<E> x = first; x != null; x = x.next) {\n                if (x.item == null)\n                    return index;\n                index++;\n            }\n        } else {\n            for (Node<E> x = first; x != null; x = x.next) {\n                if (o.equals(x.item))\n                    return index;\n                index++;\n            }\n        }\n        return -1;\n    }\n\n\nindex, -1\n\n    /**\n     * Returns the index of the last occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * More formally, returns the highest index {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     *\n     * @param o element to search for\n     * @return the index of the last occurrence of the specified element in\n     *         this list, or -1 if this list does not contain the element\n     */\n    public int lastIndexOf(Object o) {\n        int index = size;\n        if (o == null) {\n            for (Node<E> x = last; x != null; x = x.prev) {\n                index--;\n                if (x.item == null)\n                    return index;\n            }\n        } else {\n            for (Node<E> x = last; x != null; x = x.prev) {\n                index--;\n                if (o.equals(x.item))\n                    return index;\n            }\n        }\n        return -1;\n    }\n\n\n\n# Queue \n\n   \n    /**\n     * Retrieves, but does not remove, the head (first element) of this list.\n     *\n     * @return the head of this list, or {@code null} if this list is empty\n     * @since 1.5\n     */\n    public E peek() {\n        final Node<E> f = first;\n        return (f == null) ? null : f.item;\n    }\n\n    /**\n     * Retrieves, but does not remove, the head (first element) of this list.\n     *\n     * @return the head of this list\n     * @throws NoSuchElementException if this list is empty\n     * @since 1.5\n     */\n    public E element() {\n        return getFirst();\n    }\n\n    /**\n     * Retrieves and removes the head (first element) of this list.\n     *\n     * @return the head of this list, or {@code null} if this list is empty\n     * @since 1.5\n     */\n    public E poll() {\n        final Node<E> f = first;\n        return (f == null) ? null : unlinkFirst(f);\n    }\n\n    /**\n     * Retrieves and removes the head (first element) of this list.\n     *\n     * @return the head of this list\n     * @throws NoSuchElementException if this list is empty\n     * @since 1.5\n     */\n    public E remove() {\n        return removeFirst();\n    }\n\n    /**\n     * Adds the specified element as the tail (last element) of this list.\n     *\n     * @param e the element to add\n     * @return {@code true} (as specified by {@link Queue#offer})\n     * @since 1.5\n     */\n    public boolean offer(E e) {\n        return add(e);\n    }\n\n\n\n# Deque \n\n    /**\n     * Inserts the specified element at the front of this list.\n     *\n     * @param e the element to insert\n     * @return {@code true} (as specified by {@link Deque#offerFirst})\n     * @since 1.6\n     */\n    public boolean offerFirst(E e) {\n        addFirst(e);\n        return true;\n    }\n\n    /**\n     * Inserts the specified element at the end of this list.\n     *\n     * @param e the element to insert\n     * @return {@code true} (as specified by {@link Deque#offerLast})\n     * @since 1.6\n     */\n    public boolean offerLast(E e) {\n        addLast(e);\n        return true;\n    }\n\n    /**\n     * Retrieves, but does not remove, the first element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the first element of this list, or {@code null}\n     *         if this list is empty\n     * @since 1.6\n     */\n    public E peekFirst() {\n        final Node<E> f = first;\n        return (f == null) ? null : f.item;\n     }\n\n    /**\n     * Retrieves, but does not remove, the last element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the last element of this list, or {@code null}\n     *         if this list is empty\n     * @since 1.6\n     */\n    public E peekLast() {\n        final Node<E> l = last;\n        return (l == null) ? null : l.item;\n    }\n\n    /**\n     * Retrieves and removes the first element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the first element of this list, or {@code null} if\n     *     this list is empty\n     * @since 1.6\n     */\n    public E pollFirst() {\n        final Node<E> f = first;\n        return (f == null) ? null : unlinkFirst(f);\n    }\n\n    /**\n     * Retrieves and removes the last element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the last element of this list, or {@code null} if\n     *     this list is empty\n     * @since 1.6\n     */\n    public E pollLast() {\n        final Node<E> l = last;\n        return (l == null) ? null : unlinkLast(l);\n    }\n\n    /**\n     * Pushes an element onto the stack represented by this list.  In other\n     * words, inserts the element at the front of this list.\n     *\n     * <p>This method is equivalent to {@link #addFirst}.\n     *\n     * @param e the element to push\n     * @since 1.6\n     */\n    public void push(E e) {\n        addFirst(e);\n    }\n\n    /**\n     * Pops an element from the stack represented by this list.  In other\n     * words, removes and returns the first element of this list.\n     *\n     * <p>This method is equivalent to {@link #removeFirst()}.\n     *\n     * @return the element at the front of this list (which is the top\n     *         of the stack represented by this list)\n     * @throws NoSuchElementException if this list is empty\n     * @since 1.6\n     */\n    public E pop() {\n        return removeFirst();\n    }\n\n    /**\n     * Removes the first occurrence of the specified element in this\n     * list (when traversing the list from head to tail).  If the list\n     * does not contain the element, it is unchanged.\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if the list contained the specified element\n     * @since 1.6\n     */\n    public boolean removeFirstOccurrence(Object o) {\n        return remove(o);\n    }\n\n    /**\n     * Removes the last occurrence of the specified element in this\n     * list (when traversing the list from head to tail).  If the list\n     * does not contain the element, it is unchanged.\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if the list contained the specified element\n     * @since 1.6\n     */\n    public boolean removeLastOccurrence(Object o) {\n        if (o == null) {\n            for (Node<E> x = last; x != null; x = x.prev) {\n                if (x.item == null) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        } else {\n            for (Node<E> x = last; x != null; x = x.prev) {\n                if (o.equals(x.item)) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n\n\n# \n\n * Java LinkedList LinkedList http://www.cnblogs.com/CarpenterLee/p/5457150.html\n *  https://www.pdai.tech/md/java/collection/java-collection-LinkedList.html',normalizedContent:'# collection - linkedlist\n\n> collection - linkedlist\n\n * collection - linkedlist\n   * \n   * linkedlist\n     * \n     * \n     * getfirst(), getlast()\n     * removefirst(), removelast(), remove(e), remove(index)\n     * add()\n     * addall()\n     * clear()\n     * positional access \n     * \n     * queue \n     * deque \n   * \n\n\n# \n\nlinkedlist__list__deque_(queue)(stack)linkedlist__linkedlistjava_stack_java_queue_()_arraydeque_linkedlist_()\n\n\n\n_linkedlist__linkedlist_(synchronized)collections.synchronizedlist()\n\n\n# linkedlist\n\n\n# \n\n_linkedlist__list__queue__stack__deque__node__linkedlist_firstlastfirstlastnull\n\n    transient int size = 0;\n\n    /**\n     * pointer to first node.\n     * invariant: (first == null && last == null) ||\n     *            (first.prev == null && first.item != null)\n     */\n    transient node<e> first;\n\n    /**\n     * pointer to last node.\n     * invariant: (first == null && last == null) ||\n     *            (last.next == null && last.item != null)\n     */\n    transient node<e> last;\n\n\nnode:\n\n    private static class node<e> {\n        e item;\n        node<e> next;\n        node<e> prev;\n\n        node(node<e> prev, e element, node<e> next) {\n            this.item = element;\n            this.next = next;\n            this.prev = prev;\n        }\n    }\n\n\n\n# \n\n    /**\n     * constructs an empty list.\n     */\n    public linkedlist() {\n    }\n\n    /**\n     * constructs a list containing the elements of the specified\n     * collection, in the order they are returned by the collection\'s\n     * iterator.\n     *\n     * @param  c the collection whose elements are to be placed into this list\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public linkedlist(collection<? extends e> c) {\n        this();\n        addall(c);\n    }\n\n\n\n# getfirst(), getlast()\n\n :\n\n    /**\n     * returns the first element in this list.\n     *\n     * @return the first element in this list\n     * @throws nosuchelementexception if this list is empty\n     */\n    public e getfirst() {\n        final node<e> f = first;\n        if (f == null)\n            throw new nosuchelementexception();\n        return f.item;\n    }\n\n    /**\n     * returns the last element in this list.\n     *\n     * @return the last element in this list\n     * @throws nosuchelementexception if this list is empty\n     */\n    public e getlast() {\n        final node<e> l = last;\n        if (l == null)\n            throw new nosuchelementexception();\n        return l.item;\n    }\n\n\n\n# removefirst(), removelast(), remove(e), remove(index)\n\nremove()remove(object o)remove(int index)\n\n\n\n - , falseequals equalsunlinknodelinkedlistnullnull\n\n    /**\n     * removes the first occurrence of the specified element from this list,\n     * if it is present.  if this list does not contain the element, it is\n     * unchanged.  more formally, removes the element with the lowest index\n     * {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>\n     * (if such an element exists).  returns {@code true} if this list\n     * contained the specified element (or equivalently, if this list\n     * changed as a result of the call).\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if this list contained the specified element\n     */\n    public boolean remove(object o) {\n        if (o == null) {\n            for (node<e> x = first; x != null; x = x.next) {\n                if (x.item == null) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        } else {\n            for (node<e> x = first; x != null; x = x.next) {\n                if (o.equals(x.item)) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    \n    /**\n     * unlinks non-null node x.\n     */\n    e unlink(node<e> x) {\n        // assert x != null;\n        final e element = x.item;\n        final node<e> next = x.next;\n        final node<e> prev = x.prev;\n\n        if (prev == null) {// \n            first = next;\n        } else {\n            prev.next = next;\n            x.prev = null;\n        }\n\n        if (next == null) {// \n            last = prev;\n        } else {\n            next.prev = prev;\n            x.next = null;\n        }\n\n        x.item = null; // gc\n        size--;\n        modcount++;\n        return element;\n    }\n\n\nremove(int index) indexunlinknode\n\n    /**\n     * removes the element at the specified position in this list.  shifts any\n     * subsequent elements to the left (subtracts one from their indices).\n     * returns the element that was removed from the list.\n     *\n     * @param index the index of the element to be removed\n     * @return the element previously at the specified position\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public e remove(int index) {\n        checkelementindex(index);\n        return unlink(node(index));\n    }\n\n\nhead:\n\n    /**\n     * removes and returns the first element from this list.\n     *\n     * @return the first element from this list\n     * @throws nosuchelementexception if this list is empty\n     */\n    public e removefirst() {\n        final node<e> f = first;\n        if (f == null)\n            throw new nosuchelementexception();\n        return unlinkfirst(f);\n    }\n\n\n    /**\n     * unlinks non-null first node f.\n     */\n    private e unlinkfirst(node<e> f) {\n        // assert f == first && f != null;\n        final e element = f.item;\n        final node<e> next = f.next;\n        f.item = null;\n        f.next = null; // help gc\n        first = next;\n        if (next == null)\n            last = null;\n        else\n            next.prev = null;\n        size--;\n        modcount++;\n        return element;\n    }\n\n\nlast:\n\n/**\n     * removes and returns the last element from this list.\n     *\n     * @return the last element from this list\n     * @throws nosuchelementexception if this list is empty\n     */\n    public e removelast() {\n        final node<e> l = last;\n        if (l == null)\n            throw new nosuchelementexception();\n        return unlinklast(l);\n    }\n    \n    /**\n     * unlinks non-null last node l.\n     */\n    private e unlinklast(node<e> l) {\n        // assert l == last && l != null;\n        final e element = l.item;\n        final node<e> prev = l.prev;\n        l.item = null;\n        l.prev = null; // help gc\n        last = prev;\n        if (prev == null)\n            first = null;\n        else\n            prev.next = null;\n        size--;\n        modcount++;\n        return element;\n    }\n\n\n\n\n\n# add()\n\n_add()_add(e e)_linkedlist_lastadd(int index, e element)\n\n    /**\n     * appends the specified element to the end of this list.\n     *\n     * <p>this method is equivalent to {@link #addlast}.\n     *\n     * @param e element to be appended to this list\n     * @return {@code true} (as specified by {@link collection#add})\n     */\n    public boolean add(e e) {\n        linklast(e);\n        return true;\n    }\n    \n    /**\n     * links e as last element.\n     */\n    void linklast(e e) {\n        final node<e> l = last;\n        final node<e> newnode = new node<>(l, e, null);\n        last = newnode;\n        if (l == null)\n            first = newnode;\n        else\n            l.next = newnode;\n        size++;\n        modcount++;\n    }\n\n\n\n\nadd(int index, e element), index==sizeadd(e e); : 1.index,node(index)2.\n\n    /**\n     * inserts the specified element at the specified position in this list.\n     * shifts the element currently at that position (if any) and any\n     * subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public void add(int index, e element) {\n        checkpositionindex(index);\n\n        if (index == size)\n            linklast(element);\n        else\n            linkbefore(element, node(index));\n    }\n\n\nnode(int index)trickindex < (size >> 1)indexlinkedlistindexarraylist\n\n    /**\n     * returns the (non-null) node at the specified element index.\n     */\n    node<e> node(int index) {\n        // assert iselementindex(index);\n\n        if (index < (size >> 1)) {\n            node<e> x = first;\n            for (int i = 0; i < index; i++)\n                x = x.next;\n            return x;\n        } else {\n            node<e> x = last;\n            for (int i = size - 1; i > index; i--)\n                x = x.prev;\n            return x;\n        }\n    }\n\n\n\n# addall()\n\naddall(index, c) add(index,e)fail-fastmodcount1\n\n    /**\n     * appends all of the elements in the specified collection to the end of\n     * this list, in the order that they are returned by the specified\n     * collection\'s iterator.  the behavior of this operation is undefined if\n     * the specified collection is modified while the operation is in\n     * progress.  (note that this will occur if the specified collection is\n     * this list, and it\'s nonempty.)\n     *\n     * @param c collection containing elements to be added to this list\n     * @return {@code true} if this list changed as a result of the call\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public boolean addall(collection<? extends e> c) {\n        return addall(size, c);\n    }\n\n    /**\n     * inserts all of the elements in the specified collection into this\n     * list, starting at the specified position.  shifts the element\n     * currently at that position (if any) and any subsequent elements to\n     * the right (increases their indices).  the new elements will appear\n     * in the list in the order that they are returned by the\n     * specified collection\'s iterator.\n     *\n     * @param index index at which to insert the first element\n     *              from the specified collection\n     * @param c collection containing elements to be added to this list\n     * @return {@code true} if this list changed as a result of the call\n     * @throws indexoutofboundsexception {@inheritdoc}\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public boolean addall(int index, collection<? extends e> c) {\n        checkpositionindex(index);\n\n        object[] a = c.toarray();\n        int numnew = a.length;\n        if (numnew == 0)\n            return false;\n\n        node<e> pred, succ;\n        if (index == size) {\n            succ = null;\n            pred = last;\n        } else {\n            succ = node(index);\n            pred = succ.prev;\n        }\n\n        for (object o : a) {\n            @suppresswarnings("unchecked") e e = (e) o;\n            node<e> newnode = new node<>(pred, e, null);\n            if (pred == null)\n                first = newnode;\n            else\n                pred.next = newnode;\n            pred = newnode;\n        }\n\n        if (succ == null) {\n            last = pred;\n        } else {\n            pred.next = succ;\n            succ.prev = pred;\n        }\n\n        size += numnew;\n        modcount++;\n        return true;\n    }\n\n\n\n# clear()\n\ngcnode\n\n    /**\n     * removes all of the elements from this list.\n     * the list will be empty after this call returns.\n     */\n    public void clear() {\n        // clearing all of the links between nodes is "unnecessary", but:\n        // - helps a generational gc if the discarded nodes inhabit\n        //   more than one generation\n        // - is sure to free memory even if there is a reachable iterator\n        for (node<e> x = first; x != null; ) {\n            node<e> next = x.next;\n            x.item = null;\n            x.next = null;\n            x.prev = null;\n            x = next;\n        }\n        first = last = null;\n        size = 0;\n        modcount++;\n    }\n\n\n\n# positional access \n\nindex\n\n    /**\n     * returns the element at the specified position in this list.\n     *\n     * @param index index of the element to return\n     * @return the element at the specified position in this list\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public e get(int index) {\n        checkelementindex(index);\n        return node(index).item;\n    }\n\n\n:\n\n    /**\n     * replaces the element at the specified position in this list with the\n     * specified element.\n     *\n     * @param index index of the element to replace\n     * @param element element to be stored at the specified position\n     * @return the element previously at the specified position\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public e set(int index, e element) {\n        checkelementindex(index);\n        node<e> x = node(index);\n        e oldval = x.item;\n        x.item = element;\n        return oldval;\n    }\n\n\nindex:\n\n    /**\n     * inserts the specified element at the specified position in this list.\n     * shifts the element currently at that position (if any) and any\n     * subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public void add(int index, e element) {\n        checkpositionindex(index);\n\n        if (index == size)\n            linklast(element);\n        else\n            linkbefore(element, node(index));\n    }\n\n\n:\n\n    /**\n     * removes the element at the specified position in this list.  shifts any\n     * subsequent elements to the left (subtracts one from their indices).\n     * returns the element that was removed from the list.\n     *\n     * @param index the index of the element to be removed\n     * @return the element previously at the specified position\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public e remove(int index) {\n        checkelementindex(index);\n        return unlink(node(index));\n    }\n\n\n:\n\n\n\n    /**\n     * tells if the argument is the index of an existing element.\n     */\n    private boolean iselementindex(int index) {\n        return index >= 0 && index < size;\n    }\n\n    /**\n     * tells if the argument is the index of a valid position for an\n     * iterator or an add operation.\n     */\n    private boolean ispositionindex(int index) {\n        return index >= 0 && index <= size;\n    }\n\n    /**\n     * constructs an indexoutofboundsexception detail message.\n     * of the many possible refactorings of the error handling code,\n     * this "outlining" performs best with both server and client vms.\n     */\n    private string outofboundsmsg(int index) {\n        return "index: "+index+", size: "+size;\n    }\n\n    private void checkelementindex(int index) {\n        if (!iselementindex(index))\n            throw new indexoutofboundsexception(outofboundsmsg(index));\n    }\n\n    private void checkpositionindex(int index) {\n        if (!ispositionindex(index))\n            throw new indexoutofboundsexception(outofboundsmsg(index));\n    }\n\n\n\n# \n\n:\n\nindex, -1\n\n    /**\n     * returns the index of the first occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * more formally, returns the lowest index {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     *\n     * @param o element to search for\n     * @return the index of the first occurrence of the specified element in\n     *         this list, or -1 if this list does not contain the element\n     */\n    public int indexof(object o) {\n        int index = 0;\n        if (o == null) {\n            for (node<e> x = first; x != null; x = x.next) {\n                if (x.item == null)\n                    return index;\n                index++;\n            }\n        } else {\n            for (node<e> x = first; x != null; x = x.next) {\n                if (o.equals(x.item))\n                    return index;\n                index++;\n            }\n        }\n        return -1;\n    }\n\n\nindex, -1\n\n    /**\n     * returns the index of the last occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * more formally, returns the highest index {@code i} such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     *\n     * @param o element to search for\n     * @return the index of the last occurrence of the specified element in\n     *         this list, or -1 if this list does not contain the element\n     */\n    public int lastindexof(object o) {\n        int index = size;\n        if (o == null) {\n            for (node<e> x = last; x != null; x = x.prev) {\n                index--;\n                if (x.item == null)\n                    return index;\n            }\n        } else {\n            for (node<e> x = last; x != null; x = x.prev) {\n                index--;\n                if (o.equals(x.item))\n                    return index;\n            }\n        }\n        return -1;\n    }\n\n\n\n# queue \n\n   \n    /**\n     * retrieves, but does not remove, the head (first element) of this list.\n     *\n     * @return the head of this list, or {@code null} if this list is empty\n     * @since 1.5\n     */\n    public e peek() {\n        final node<e> f = first;\n        return (f == null) ? null : f.item;\n    }\n\n    /**\n     * retrieves, but does not remove, the head (first element) of this list.\n     *\n     * @return the head of this list\n     * @throws nosuchelementexception if this list is empty\n     * @since 1.5\n     */\n    public e element() {\n        return getfirst();\n    }\n\n    /**\n     * retrieves and removes the head (first element) of this list.\n     *\n     * @return the head of this list, or {@code null} if this list is empty\n     * @since 1.5\n     */\n    public e poll() {\n        final node<e> f = first;\n        return (f == null) ? null : unlinkfirst(f);\n    }\n\n    /**\n     * retrieves and removes the head (first element) of this list.\n     *\n     * @return the head of this list\n     * @throws nosuchelementexception if this list is empty\n     * @since 1.5\n     */\n    public e remove() {\n        return removefirst();\n    }\n\n    /**\n     * adds the specified element as the tail (last element) of this list.\n     *\n     * @param e the element to add\n     * @return {@code true} (as specified by {@link queue#offer})\n     * @since 1.5\n     */\n    public boolean offer(e e) {\n        return add(e);\n    }\n\n\n\n# deque \n\n    /**\n     * inserts the specified element at the front of this list.\n     *\n     * @param e the element to insert\n     * @return {@code true} (as specified by {@link deque#offerfirst})\n     * @since 1.6\n     */\n    public boolean offerfirst(e e) {\n        addfirst(e);\n        return true;\n    }\n\n    /**\n     * inserts the specified element at the end of this list.\n     *\n     * @param e the element to insert\n     * @return {@code true} (as specified by {@link deque#offerlast})\n     * @since 1.6\n     */\n    public boolean offerlast(e e) {\n        addlast(e);\n        return true;\n    }\n\n    /**\n     * retrieves, but does not remove, the first element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the first element of this list, or {@code null}\n     *         if this list is empty\n     * @since 1.6\n     */\n    public e peekfirst() {\n        final node<e> f = first;\n        return (f == null) ? null : f.item;\n     }\n\n    /**\n     * retrieves, but does not remove, the last element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the last element of this list, or {@code null}\n     *         if this list is empty\n     * @since 1.6\n     */\n    public e peeklast() {\n        final node<e> l = last;\n        return (l == null) ? null : l.item;\n    }\n\n    /**\n     * retrieves and removes the first element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the first element of this list, or {@code null} if\n     *     this list is empty\n     * @since 1.6\n     */\n    public e pollfirst() {\n        final node<e> f = first;\n        return (f == null) ? null : unlinkfirst(f);\n    }\n\n    /**\n     * retrieves and removes the last element of this list,\n     * or returns {@code null} if this list is empty.\n     *\n     * @return the last element of this list, or {@code null} if\n     *     this list is empty\n     * @since 1.6\n     */\n    public e polllast() {\n        final node<e> l = last;\n        return (l == null) ? null : unlinklast(l);\n    }\n\n    /**\n     * pushes an element onto the stack represented by this list.  in other\n     * words, inserts the element at the front of this list.\n     *\n     * <p>this method is equivalent to {@link #addfirst}.\n     *\n     * @param e the element to push\n     * @since 1.6\n     */\n    public void push(e e) {\n        addfirst(e);\n    }\n\n    /**\n     * pops an element from the stack represented by this list.  in other\n     * words, removes and returns the first element of this list.\n     *\n     * <p>this method is equivalent to {@link #removefirst()}.\n     *\n     * @return the element at the front of this list (which is the top\n     *         of the stack represented by this list)\n     * @throws nosuchelementexception if this list is empty\n     * @since 1.6\n     */\n    public e pop() {\n        return removefirst();\n    }\n\n    /**\n     * removes the first occurrence of the specified element in this\n     * list (when traversing the list from head to tail).  if the list\n     * does not contain the element, it is unchanged.\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if the list contained the specified element\n     * @since 1.6\n     */\n    public boolean removefirstoccurrence(object o) {\n        return remove(o);\n    }\n\n    /**\n     * removes the last occurrence of the specified element in this\n     * list (when traversing the list from head to tail).  if the list\n     * does not contain the element, it is unchanged.\n     *\n     * @param o element to be removed from this list, if present\n     * @return {@code true} if the list contained the specified element\n     * @since 1.6\n     */\n    public boolean removelastoccurrence(object o) {\n        if (o == null) {\n            for (node<e> x = last; x != null; x = x.prev) {\n                if (x.item == null) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        } else {\n            for (node<e> x = last; x != null; x = x.prev) {\n                if (o.equals(x.item)) {\n                    unlink(x);\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n\n\n# \n\n * java linkedlist linkedlist http://www.cnblogs.com/carpenterlee/p/5457150.html\n *  https://www.pdai.tech/md/java/collection/java-collection-linkedlist.html',charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/basic/java-basic-x-reflection.html",relativePath:"java/basic/java-basic-x-reflection.md",key:"v-52bd9ac8",path:"/java/basic/java-basic-x-reflection.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:226},{level:3,title:"Class",slug:"class",normalizedTitle:"class",charIndex:238},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:252},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:261},{level:3,title:"Class",slug:"class",normalizedTitle:"class",charIndex:274},{level:3,title:"Constructor",slug:"constructor",normalizedTitle:"constructor",charIndex:293},{level:3,title:"Field",slug:"field",normalizedTitle:"field",charIndex:317},{level:3,title:"Method",slug:"method",normalizedTitle:"method",charIndex:335},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:352},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:369},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:384},{level:3,title:" method.invoke() ",slug:"-method-invoke-",normalizedTitle:" method.invoke() ",charIndex:398},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:427},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:441}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -   Class   Class Constructor Field Method     method.invoke()   ",content:'# Java  - \n\n> JAVAjavaJavaJava Java\n\n * Java  - \n   * \n     * Class\n     * \n   * \n     * Class\n     * Constructor\n     * Field\n     * Method\n   * \n     * \n     * \n     *  method.invoke() \n     * \n   * \n\n\n# \n\nRTTIRun-Time Type IdentificationThinking in JavaRTTI\n\njavaJava\n\n\n\n>  Class Class\n\n\n# Class\n\nClassClassJDKjava.langClassjava(class ans enum)(interface and annotation)javaJVMclass.class.getClass()Class.forName("")classclass  Class booleanbytecharshortintlongfloatdoublevoid class \n\npublic final class Class<T> implements java.io.Serializable,\n                              GenericDeclaration,\n                              Type,\n                              AnnotatedElement {\n    private static final int ANNOTATION= 0x00002000;\n    private static final int ENUM      = 0x00004000;\n    private static final int SYNTHETIC = 0x00001000;\n\n    private static native void registerNatives();\n    static {\n        registerNatives();\n    }\n\n    /*\n     * Private constructor. Only the Java Virtual Machine creates Class objects.   //JVMClass\n     * This constructor is not used and prevents the default constructor being\n     * generated.\n     */\n    private Class(ClassLoader loader) {\n        // Initialize final field for classLoader.  The initialization value of non-null\n        // prevents future JIT optimizations from assuming this final field is null.\n        classLoader = loader;\n    }\n\n\n\n\n * Classclass\n\n * ClassClass.class()\n\n * classClassClass\n\n * ClassClassJVM\n\n * Class()\n\n\n# \n\n\n\n * JVM - \n   * JVM\n * JVM - Java \n   * Java \n\n\n\n 1. \n\n\n\n 2. \n\n\n\n\n# \n\n\n\nClass\n\nJavaClassjava.lang.reflectConstructorClass FieldClass(private)MethodClass(private)\n\n\n# Class\n\njvmclass\n\nclassclass\n\n * .class\n * .getClass()\n * Class.forName()\n\n    @Test\n    public void classTest() throws Exception {\n        // Class\n        logger.info(":  \\t" + User.class);\n        logger.info(":  \\t" + new User().getClass());\n        logger.info(":\\t" + Class.forName("com.test.User"));\n        // \n        logger.info(":\\t" + userClass.getName());\n        logger.info(":\\t" + userClass.getSimpleName());\n        logger.info(":\\t" + userClass.newInstance());\n    }\n\n    // ...\n    package com.test;\n\n    public class User {\n        private String name = "init";\n        private int age;\n        public User() {}\n        public User(String name, int age) {\n            super();\n            this.name = name;\n            this.age = age;\n        }\n        private String getName() {\n            return name;\n        }\n        private void setName(String name) {\n            this.name = name;\n        }\n        public int getAge() {\n            return age;\n        }\n        public void setAge(int age) {\n            this.age = age;\n        }\n        @Override\n        public String toString() {\n            return "User [name=" + name + ", age=" + age + "]";\n        }\n    }\n\n\n\n\n:  \tclass com.test.User\n:  \tclass com.test.User\n:\tclass com.test.User\n:\tcom.test.User\n:\tUser\n:\tUser [name=init, age=0]\n\n\n *  Class\n\n                                  \nforName()                            (1)Class()\n(2)ClassforName()   \nObject-getClass()                    ClassClass\ngetName()                            ()\ngetSimpleName()                      ()\ngetCanonicalName()                   ()\nisInterface()                        Class\ngetInterfaces()                      ClassClass\ngetSupercalss()                      ClassClass\nnewInstance()                        Oject\ngetFields()                          public\n                                     getMethodsgetConstructors\ngetDeclaredFields                    publicprivateprotecedgetDeclaredMethodsgetDeclaredConstructors\n\nhttps://blog.csdn.net/mcryeasy/article/details/52344729\n\npackage com.cry;\nimport java.lang.reflect.Field;\ninterface I1 {\n}\ninterface I2 {\n}\nclass Cell{\n    public int mCellPublic;\n}\nclass Animal extends  Cell{\n    private int mAnimalPrivate;\n    protected int mAnimalProtected;\n    int mAnimalDefault;\n    public int mAnimalPublic;\n    private static int sAnimalPrivate;\n    protected static int sAnimalProtected;\n    static int sAnimalDefault;\n    public static int sAnimalPublic;\n}\nclass Dog extends Animal implements I1, I2 {\n    private int mDogPrivate;\n    public int mDogPublic;\n    protected int mDogProtected;\n    private int mDogDefault;\n    private static int sDogPrivate;\n    protected static int sDogProtected;\n    static int sDogDefault;\n    public static int sDogPublic;\n}\npublic class Test {\n    public static void main(String[] args) throws IllegalAccessException, InstantiationException {\n        Class<Dog> dog = Dog.class;\n        //\n        System.out.println(dog.getName()); //com.cry.Dog\n        System.out.println(dog.getSimpleName()); //Dog\n        System.out.println(dog.getCanonicalName());//com.cry.Dog\n        //\n        System.out.println(dog.isInterface()); //false\n        for (Class iI : dog.getInterfaces()) {\n            System.out.println(iI);\n        }\n         /*\n          interface com.cry.I1\n          interface com.cry.I2\n         */\n\n        //\n        System.out.println(dog.getSuperclass());//class com.cry.Animal\n        //\n        Dog d = dog.newInstance();\n        //\n        for (Field f : dog.getFields()) {\n            System.out.println(f.getName());\n        }\n        /*\n            mDogPublic\n            sDogPublic\n            mAnimalPublic\n            sAnimalPublic\n            mCellPublic  //\n         */\n        System.out.println("---------");\n        for (Field f : dog.getDeclaredFields()) {\n            System.out.println(f.getName());\n        }\n        /** \n         mDogPrivate\n         mDogPublic\n         mDogProtected\n         mDogDefault\n         sDogPrivate\n         sDogProtected\n         sDogDefault\n         sDogPublic\n         */\n    }\n}\n\n\ngetNamegetCanonicalNamegetSimpleName\n\n * getSimpleName\n * getNamejvmClassClassClass.forName\n * getCanonicalNametoStringloggetName\n\npackage com.cry;\npublic class Test {\n    private  class inner{\n    }\n    public static void main(String[] args) throws ClassNotFoundException {\n        //\n        System.out.println(Test.class.getSimpleName()); //Test\n        System.out.println(Test.class.getName()); //com.cry.Test\n        System.out.println(Test.class.getCanonicalName()); //com.cry.Test\n        //\n        System.out.println(inner.class.getSimpleName()); //inner\n        System.out.println(inner.class.getName()); //com.cry.Test$inner\n        System.out.println(inner.class.getCanonicalName()); //com.cry.Test.inner\n        //\n        System.out.println(args.getClass().getSimpleName()); //String[]\n        System.out.println(args.getClass().getName()); //[Ljava.lang.String;\n        System.out.println(args.getClass().getCanonicalName()); //java.lang.String[]\n        //getCanonicalNamegetName\n        //Class.forName(inner.class.getCanonicalName()); \n        Class.forName(inner.class.getName());\n    }\n}\n\n\n\n# Constructor\n\n> Constructor(java.lang.reflect)Class \n\nConstructorClassClassConstructor\n\n                                                               \nstatic Class<?>    forName(String className)                             Class \nConstructor        getConstructor(Class<?>... parameterTypes)           public\nConstructor<?>[]   getConstructors()                                    publicConstructor\nConstructor        getDeclaredConstructor(Class<?>... parameterTypes)   private\nConstructor<?>[]   getDeclaredConstructors()                            private\nT                  newInstance()                                         Class \n\nConstructor\n\npublic class ConstructionTest implements Serializable {\n    public static void main(String[] args) throws Exception {\n\n        Class<?> clazz = null;\n\n        //Class\n        clazz = Class.forName("com.example.javabase.User");\n\n        //User,\n        User user = (User) clazz.newInstance();\n        user.setAge(20);\n        user.setName("Jack");\n        System.out.println(user);\n\n        System.out.println("--------------------------------------------");\n\n        //Stringpublic\n        Constructor cs1 =clazz.getConstructor(String.class);\n        //User\n        User user1= (User) cs1.newInstance("hiway");\n        user1.setAge(22);\n        System.out.println("user1:"+user1.toString());\n\n        System.out.println("--------------------------------------------");\n\n        //intString,private\n        Constructor cs2=clazz.getDeclaredConstructor(int.class,String.class);\n        //private\n        cs2.setAccessible(true);\n        //user\n        User user2= (User) cs2.newInstance(25,"hiway2");\n        System.out.println("user2:"+user2.toString());\n\n        System.out.println("--------------------------------------------");\n\n        //private\n        Constructor<?> cons[] = clazz.getDeclaredConstructors();\n        // \n        for (int i = 0; i < cons.length; i++) {\n            //\n            Class<?> clazzs[] = cons[i].getParameterTypes();\n            System.out.println("["+i+"]:"+cons[i].toString() );\n            System.out.print("["+i+"]:(");\n            for (int j = 0; j < clazzs.length; j++) {\n                if (j == clazzs.length - 1)\n                    System.out.print(clazzs[j].getName());\n                else\n                    System.out.print(clazzs[j].getName() + ",");\n            }\n            System.out.println(")");\n        }\n    }\n}\n\n\nclass User {\n    private int age;\n    private String name;\n    public User() {\n        super();\n    }\n    public User(String name) {\n        super();\n        this.name = name;\n    }\n\n    /**\n     * \n     * @param age\n     * @param name\n     */\n    private User(int age, String name) {\n        super();\n        this.age = age;\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    @Override\n    public String toString() {\n        return "User{" +\n                "age=" + age +\n                ", name=\'" + name + \'\\\'\' +\n                \'}\';\n    }\n}\n\n\n\n\n/* output \nUser{age=20, name=\'Jack\'}\n--------------------------------------------\nuser1:User{age=22, name=\'hiway\'}\n--------------------------------------------\nuser2:User{age=25, name=\'hiway2\'}\n--------------------------------------------\n[0]:private com.example.javabase.User(int,java.lang.String)\n[0]:(int,java.lang.String)\n[1]:public com.example.javabase.User(java.lang.String)\n[1]:(java.lang.String)\n[2]:public com.example.javabase.User()\n[2]:()\n\n\nConstructor(API)\n\n                                      \nClass        getDeclaringClass()                Class  Constructor\n                                               ,\nType[]       getGenericParameterTypes()         Type  Constructor\nString       getName()                         \nClass<?>[]   getParameterTypes()                Class Constructor \nT            newInstance(Object... initargs)    Constructor\nString       toGenericString()                  Constructor \n\n\n\nConstructor cs3 = clazz.getDeclaredConstructor(int.class,String.class);\nSystem.out.println("-----getDeclaringClass-----");\nClass uclazz=cs3.getDeclaringClass();\n//Constructor\nSystem.out.println(":"+uclazz.getName());\n\nSystem.out.println("-----getGenericParameterTypes-----");\n// Constructor \nType[] tps=cs3.getGenericParameterTypes();\nfor (Type tp:tps) {\n    System.out.println("tp:"+tp);\n}\nSystem.out.println("-----getParameterTypes-----");\n//\nClass<?> clazzs[] = cs3.getParameterTypes();\nfor (Class claz:clazzs) {\n    System.out.println(":"+claz.getName());\n}\nSystem.out.println("-----getName-----");\n//\nSystem.out.println("getName:"+cs3.getName());\n\nSystem.out.println("-----getoGenericString-----");\n// Constructor \nSystem.out.println("getoGenericString():"+cs3.toGenericString());\n\n\n\n\n-----getDeclaringClass-----\n:com.example.javabase.User\n-----getGenericParameterTypes-----\ntp:int\ntp:class java.lang.String\n-----getParameterTypes-----\n:int\n:java.lang.String\n-----getName-----\ngetName:com.example.javabase.User\n-----getoGenericString-----\ngetoGenericString():private com.example.javabase.User(int,java.lang.String)\n\n\n\n# Field\n\n> Field \n\nClassFieldClassField\n\n                                 \nField     getDeclaredField(String name)   name(private)\nField[]   getDeclaredFields()             Class(private),\nField     getField(String name)           namepublic\nField[]   getFields()                     public\n\n\n\npublic class ReflectField {\n\n    public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException {\n        Class<?> clazz = Class.forName("reflect.Student");\n        //Field,public,\n        // NoSuchFieldException\n        Field field = clazz.getField("age");\n        System.out.println("field:"+field);\n\n        //public,,public\n        Field fields[] = clazz.getFields();\n        for (Field f:fields) {\n            System.out.println("f:"+f.getDeclaringClass());\n        }\n\n        System.out.println("================getDeclaredFields====================");\n        //(private),\n        Field fields2[] = clazz.getDeclaredFields();\n        for (Field f:fields2) {\n            System.out.println("f2:"+f.getDeclaringClass());\n        }\n        //Field,,\n        Field field2 = clazz.getDeclaredField("desc");\n        System.out.println("field2:"+field2);\n    }\n    /**\n      : \n     field:public int reflect.Person.age\n     f:public java.lang.String reflect.Student.desc\n     f:public int reflect.Person.age\n     f:public java.lang.String reflect.Person.name\n\n     ================getDeclaredFields====================\n     f2:public java.lang.String reflect.Student.desc\n     f2:private int reflect.Student.score\n     field2:public java.lang.String reflect.Student.desc\n     */\n}\n\nclass Person{\n    public int age;\n    public String name;\n    //setget\n}\n\nclass Student extends Person{\n    public String desc;\n    private int score;\n    //setget\n}\n\n\nClassgetDeclaredField/getDeclaredFieldsClassgetField/getFieldspublicField\n\n//Class\nClass<?> clazz = Class.forName("reflect.Student");\n\nStudent st= (Student) clazz.newInstance();\n//public\nField ageField = clazz.getField("age");\nageField.set(st,18);\nField nameField = clazz.getField("name");\nnameField.set(st,"Lily");\n\n//,\nField descField = clazz.getDeclaredField("desc");\ndescField.set(st,"I am student");\nField scoreField = clazz.getDeclaredField("score");\n//scoreprivate\nscoreField.setAccessible(true);\nscoreField.set(st,88);\nSystem.out.println(st.toString());\n\n//Student{age=18, name=\'Lily ,desc=\'I am student\', score=88} \n\n//\nSystem.out.println(scoreField.get(st));\n// 88\n\n\nset(Object obj, Object value)Fieldget(Object obj)Field\n\n                                  \nvoid       set(Object obj, Object value)    Field \nObject     get(Object obj)                  Field \nClass<?>   getType()                        Class Field \nboolean    isEnumConstant()                 true false\nString     toGenericString()                Field\nString     getName()                        Field \nClass<?>   getDeclaringClass()              Class  Field \nvoid       setAccessible(boolean flag)      accessible ,\n\nFieldsetInt()/getInt()setBoolean()/getBooleansetChar()/getChar()APIfinalField\n\n\n# Method\n\n> Method \n\nClassMethod\n\n                                                               \nMethod     getDeclaredMethod(String name, Class<?>... parameterTypes)   Method Class \nMethod[]   getDeclaredMethods()                                          Method  Class\n                                                                        \nMethod     getMethod(String name, Class<?>... parameterTypes)            Method  Class \nMethod[]   getMethods()                                                  Method  Class\n                                                                         member \n\n\n\nimport java.lang.reflect.Method;\n\npublic class ReflectMethod  {\n\n\n    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException {\n\n        Class clazz = Class.forName("reflect.Circle");\n\n        //publicMethod,\n        Method method = clazz.getMethod("draw",int.class,String.class);\n\n        System.out.println("method:"+method);\n\n        //public:\n        Method[] methods =clazz.getMethods();\n        for (Method m:methods){\n            System.out.println("m::"+m);\n        }\n\n        System.out.println("=========================================");\n\n        //private,method\n        Method method1 = clazz.getDeclaredMethod("drawCircle");\n        System.out.println("method1::"+method1);\n        //private,method\n        Method[] methods1=clazz.getDeclaredMethods();\n        for (Method m:methods1){\n            System.out.println("m1::"+m);\n        }\n    }\n}\n\nclass Shape {\n    public void draw(){\n        System.out.println("draw");\n    }\n\n    public void draw(int count , String name){\n        System.out.println("draw "+ name +",count="+count);\n    }\n\n}\nclass Circle extends Shape{\n\n    private void drawCircle(){\n        System.out.println("drawCircle");\n    }\n    public int getAllCount(){\n        return 100;\n    }\n}\n\n\n:\n\nmethod:public void reflect.Shape.draw(int,java.lang.String)\n\nm::public int reflect.Circle.getAllCount()\nm::public void reflect.Shape.draw()\nm::public void reflect.Shape.draw(int,java.lang.String)\nm::public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException\nm::public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException\nm::public final void java.lang.Object.wait() throws java.lang.InterruptedException\nm::public boolean java.lang.Object.equals(java.lang.Object)\nm::public java.lang.String java.lang.Object.toString()\nm::public native int java.lang.Object.hashCode()\nm::public final native java.lang.Class java.lang.Object.getClass()\nm::public final native void java.lang.Object.notify()\nm::public final native void java.lang.Object.notifyAll()\n\n=========================================\nmethod1::private void reflect.Circle.drawCircle()\n\nm1::public int reflect.Circle.getAllCount()\nm1::private void reflect.Circle.drawCircle()\n\n\ngetMethodsMethodObjectgetDeclaredMethod/getDeclaredMethodsMethod\n\nClass clazz = Class.forName("reflect.Circle");\n//\nCircle circle = (Circle) clazz.newInstance();\n\n//Method\nMethod method = clazz.getMethod("draw",int.class,String.class);\n\n//Methodinvoke(Object obj,Object... args)\nmethod.invoke(circle,15,"");\n\n//\nMethod method1 = clazz.getDeclaredMethod("drawCircle");\n//\nmethod1.setAccessible(true);\nmethod1.invoke(circle);\n\n//\nMethod method2 =clazz.getDeclaredMethod("getAllCount");\nInteger count = (Integer) method2.invoke(circle);\nSystem.out.println("count:"+count);\n\n\n\n\ndraw ,count=15\ndrawCircle\ncount:100\n\n\nMethodinvoke(Object obj,Object... args)\n\n                                         \nObject       invoke(Object obj, Object... args)    Method \nClass<?>     getReturnType()                       Class  Method ,\nType         getGenericReturnType()                Method  Type \nClass<?>[]   getParameterTypes()                   Class  Method\n                                                  \nType[]       getGenericParameterTypes()            Type  Method\n                                                  \nString       getName()                             String  Method \nboolean      isVarArgs()                           true false\nString       toGenericString()                     Method \n\ngetReturnType/getGenericReturnTypeMethodClassType()TypeJava8\n\npublic interface Type {\n    //1.8\n    default String getTypeName() {\n        return toString();\n    }\n}\n\n\ngetParameterTypes/getGenericParameterTypesMethodFieldConstructor\n\n\n# \n\n> https://www.cnblogs.com/yougewe/p/10125073.html\n\n\n\npublic class HelloReflect {\n    public static void main(String[] args) {\n        try {\n            // 1. \n            TempFunctionTest test = (TempFunctionTest)Class.forName("com.tester.HelloReflect").newInstance();\n            test.sayHello("call directly");\n            // 2. \n            Object t2 = new TempFunctionTest();\n            Method method = t2.getClass().getDeclaredMethod("sayHello", String.class);\n            method.invoke(test, "method invoke");\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        } catch (InstantiationException e) {\n            e.printStackTrace();\n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        } catch (NoSuchMethodException e ) {\n            e.printStackTrace();\n        } catch (InvocationTargetException e) {\n            e.printStackTrace();\n        }\n    }\n    \n    public void sayHello(String word) {\n        System.out.println("hello," + word);\n    }\n\n}\n\n\n\n\n\n\n\n# \n\n java.lang.Class \n\n    @CallerSensitive\n    public static Class<?> forName(String className)\n                throws ClassNotFoundException {\n        //  classLoader\n        Class<?> caller = Reflection.getCallerClass();\n        // nativeclass\n        return forName0(className, true, ClassLoader.getClassLoader(caller), caller);\n    }\n\n\nforName()java,jvm\n\n ClassLoader,  native  java.lang.ClassLoader.\n\njvm ClassLoader \n\n\n    // \n    public Class<?> loadClass(String name) throws ClassNotFoundException {\n        return loadClass(name, false);\n    }\n    \n        // sun.misc.Launcher\n        public Class<?> loadClass(String var1, boolean var2) throws ClassNotFoundException {\n            int var3 = var1.lastIndexOf(46);\n            if(var3 != -1) {\n                SecurityManager var4 = System.getSecurityManager();\n                if(var4 != null) {\n                    var4.checkPackageAccess(var1.substring(0, var3));\n                }\n            }\n\n            if(this.ucp.knownToNotExist(var1)) {\n                Class var5 = this.findLoadedClass(var1);\n                if(var5 != null) {\n                    if(var2) {\n                        this.resolveClass(var5);\n                    }\n\n                    return var5;\n                } else {\n                    throw new ClassNotFoundException(var1);\n                }\n            } else {\n                return super.loadClass(var1, var2);\n            }\n        }\n    // java.lang.ClassLoader\n    protected Class<?> loadClass(String name, boolean resolve)\n        throws ClassNotFoundException\n    {\n        // \n        synchronized (getClassLoadingLock(name)) {\n            // First, check if the class has already been loaded\n            // \n            Class<?> c = findLoadedClass(name);\n            if (c == null) {\n                long t0 = System.nanoTime();\n                try {\n                    // \n                    if (parent != null) {\n                        c = parent.loadClass(name, false);\n                    } else {\n                        c = findBootstrapClassOrNull(name);\n                    }\n                } catch (ClassNotFoundException e) {\n                    // ClassNotFoundException thrown if class not found\n                    // from the non-null parent class loader\n                }\n\n                // \n                if (c == null) {\n                    // If still not found, then invoke findClass in order\n                    // to find the class.\n                    long t1 = System.nanoTime();\n                    c = findClass(name);\n\n                    // this is the defining class loader; record the stats\n                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);\n                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);\n                    sun.misc.PerfCounter.getFindClasses().increment();\n                }\n            }\n            if (resolve) {\n                resolveClass(c);\n            }\n            return c;\n        }\n    }\n    \n    protected Object getClassLoadingLock(String className) {\n        Object lock = this;\n        if (parallelLockMap != null) {\n            //  ConcurrentHashMap\n            Object newLock = new Object();\n            lock = parallelLockMap.putIfAbsent(className, newLock);\n            if (lock == null) {\n                lock = newLock;\n            }\n        }\n        return lock;\n    }\n    \n    protected final Class<?> findLoadedClass(String name) {\n        if (!checkName(name))\n            return null;\n        return findLoadedClass0(name);\n    }\n\n\n\n newInstance() \n\n    //  Class.newInstance\n    @CallerSensitive\n    public T newInstance()\n        throws InstantiationException, IllegalAccessException\n    {\n        if (System.getSecurityManager() != null) {\n            checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), false);\n        }\n\n        // NOTE: the following code may not be strictly correct under\n        // the current Java memory model.\n\n        // Constructor lookup\n        // newInstance() \n        if (cachedConstructor == null) {\n            if (this == Class.class) {\n                //  Class  newInstance() \n                throw new IllegalAccessException(\n                    "Can not call newInstance() on the Class for java.lang.Class"\n                );\n            }\n            try {\n                // \n                Class<?>[] empty = {};\n                final Constructor<T> c = getConstructor0(empty, Member.DECLARED);\n                // Disable accessibility checks on the constructor\n                // since we have to do the security check here anyway\n                // (the stack depth is wrong for the Constructor\'s\n                // security check to work)\n                java.security.AccessController.doPrivileged(\n                    new java.security.PrivilegedAction<Void>() {\n                        public Void run() {\n                                c.setAccessible(true);\n                                return null;\n                            }\n                        });\n                cachedConstructor = c;\n            } catch (NoSuchMethodException e) {\n                throw (InstantiationException)\n                    new InstantiationException(getName()).initCause(e);\n            }\n        }\n        Constructor<T> tmpConstructor = cachedConstructor;\n        // Security check (same as in java.lang.reflect.Constructor)\n        int modifiers = tmpConstructor.getModifiers();\n        if (!Reflection.quickCheckMemberAccess(this, modifiers)) {\n            Class<?> caller = Reflection.getCallerClass();\n            if (newInstanceCallerCache != caller) {\n                Reflection.ensureMemberAccess(caller, this, null, modifiers);\n                newInstanceCallerCache = caller;\n            }\n        }\n        // Run constructor\n        try {\n            // \n            return tmpConstructor.newInstance((Object[])null);\n        } catch (InvocationTargetException e) {\n            Unsafe.getUnsafe().throwException(e.getTargetException());\n            // Not reached\n            return null;\n        }\n    }\n\n\nnewInstance() \n\n * 1. \n * 2. \n * 3. \n\n\n\n    private Constructor<T> getConstructor0(Class<?>[] parameterTypes,\n                                        int which) throws NoSuchMethodException\n    {\n        // \n        Constructor<T>[] constructors = privateGetDeclaredConstructors((which == Member.PUBLIC));\n        for (Constructor<T> constructor : constructors) {\n            if (arrayContentsEq(parameterTypes,\n                                constructor.getParameterTypes())) {\n                return getReflectionFactory().copyConstructor(constructor);\n            }\n        }\n        throw new NoSuchMethodException(getName() + ".<init>" + argumentTypesToString(parameterTypes));\n    }\n\n\ngetConstructor0() \n\n * 1. constructors, \n * 2.  ReflectionFactory copyconstructor\n * 3.  NoSuchMethodException;\n\n\n    // jvm\n    // Returns an array of "root" constructors. These Constructor\n    // objects must NOT be propagated to the outside world, but must\n    // instead be copied via ReflectionFactory.copyConstructor.\n    private Constructor<T>[] privateGetDeclaredConstructors(boolean publicOnly) {\n        checkInitted();\n        Constructor<T>[] res;\n        //  reflectionData(), \n        ReflectionData<T> rd = reflectionData();\n        if (rd != null) {\n            res = publicOnly ? rd.publicConstructors : rd.declaredConstructors;\n            // \n            if (res != null) return res;\n        }\n        // No cached value available; request value from VM\n        if (isInterface()) {\n            @SuppressWarnings("unchecked")\n            Constructor<T>[] temporaryRes = (Constructor<T>[]) new Constructor<?>[0];\n            res = temporaryRes;\n        } else {\n            // nativejvm\n            res = getDeclaredConstructors0(publicOnly);\n        }\n        if (rd != null) {\n            // jvm\n            if (publicOnly) {\n                rd.publicConstructors = res;\n            } else {\n                rd.declaredConstructors = res;\n            }\n        }\n        return res;\n    }\n    \n    // Lazily create and cache ReflectionData\n    private ReflectionData<T> reflectionData() {\n        SoftReference<ReflectionData<T>> reflectionData = this.reflectionData;\n        int classRedefinedCount = this.classRedefinedCount;\n        ReflectionData<T> rd;\n        if (useCaches &&\n            reflectionData != null &&\n            (rd = reflectionData.get()) != null &&\n            rd.redefinedCount == classRedefinedCount) {\n            return rd;\n        }\n        // else no SoftReference or cleared SoftReference or stale ReflectionData\n        // -> create and replace new instance\n        return newReflectionData(reflectionData, classRedefinedCount);\n    }\n    \n    // \n    private ReflectionData<T> newReflectionData(SoftReference<ReflectionData<T>> oldReflectionData,\n                                                int classRedefinedCount) {\n        if (!useCaches) return null;\n\n        // cas\n        while (true) {\n            ReflectionData<T> rd = new ReflectionData<>(classRedefinedCount);\n            // try to CAS it...\n            if (Atomic.casReflectionData(this, oldReflectionData, new SoftReference<>(rd))) {\n                return rd;\n            }\n            // CAS\n            oldReflectionData = this.reflectionData;\n            classRedefinedCount = this.classRedefinedCount;\n            if (oldReflectionData != null &&\n                (rd = oldReflectionData.get()) != null &&\n                rd.redefinedCount == classRedefinedCount) {\n                return rd;\n            }\n        }\n    }\n\n\nprivateGetDeclaredConstructors(), \n\n * 1. \n * 2. jvm\n\n relactionData() ReflectionData \n\n\n    // reflection data that might get invalidated when JVM TI RedefineClasses() is called\n    private static class ReflectionData<T> {\n        volatile Field[] declaredFields;\n        volatile Field[] publicFields;\n        volatile Method[] declaredMethods;\n        volatile Method[] publicMethods;\n        volatile Constructor<T>[] declaredConstructors;\n        volatile Constructor<T>[] publicConstructors;\n        // Intermediate results for getFields and getMethods\n        volatile Field[] declaredPublicFields;\n        volatile Method[] declaredPublicMethods;\n        volatile Class<?>[] interfaces;\n\n        // Value of classRedefinedCount when we created this ReflectionData instance\n        final int redefinedCount;\n\n        ReflectionData(int redefinedCount) {\n            this.redefinedCount = redefinedCount;\n        }\n    }\n\n\nfalse\n\n    private static boolean arrayContentsEq(Object[] a1, Object[] a2) {\n        if (a1 == null) {\n            return a2 == null || a2.length == 0;\n        }\n\n        if (a2 == null) {\n            return a1.length == 0;\n        }\n\n        if (a1.length != a2.length) {\n            return false;\n        }\n\n        for (int i = 0; i < a1.length; i++) {\n            if (a1[i] != a2[i]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n    // sun.reflect.ReflectionFactory\n    /** Makes a copy of the passed constructor. The returned\n        constructor is a "child" of the passed one; see the comments\n        in Constructor.java for details. */\n    public <T> Constructor<T> copyConstructor(Constructor<T> arg) {\n        return langReflectAccess().copyConstructor(arg);\n    }\n    \n    // java.lang.reflect.Constructor, copy new Constructor \n    Constructor<T> copy() {\n        // This routine enables sharing of ConstructorAccessor objects\n        // among Constructor objects which refer to the same underlying\n        // method in the VM. (All of this contortion is only necessary\n        // because of the "accessibility" bit in AccessibleObject,\n        // which implicitly requires that new java.lang.reflect\n        // objects be fabricated for each reflective call on Class\n        // objects.)\n        if (this.root != null)\n            throw new IllegalArgumentException("Can not copy a non-root Constructor");\n\n        Constructor<T> res = new Constructor<>(clazz,\n                                               parameterTypes,\n                                               exceptionTypes, modifiers, slot,\n                                               signature,\n                                               annotations,\n                                               parameterAnnotations);\n        // root  constructor\n        res.root = this;\n        // Might as well eagerly propagate this if already present\n        res.constructorAccessor = constructorAccessor;\n        return res;\n    }\n\n\n Constructor \n\n newInstance()\n\n    // return tmpConstructor.newInstance((Object[])null); \n    // java.lang.reflect.Constructor\n    @CallerSensitive\n    public T newInstance(Object ... initargs)\n        throws InstantiationException, IllegalAccessException,\n               IllegalArgumentException, InvocationTargetException\n    {\n        if (!override) {\n            if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) {\n                Class<?> caller = Reflection.getCallerClass();\n                checkAccess(caller, clazz, null, modifiers);\n            }\n        }\n        if ((clazz.getModifiers() & Modifier.ENUM) != 0)\n            throw new IllegalArgumentException("Cannot reflectively create enum objects");\n        ConstructorAccessor ca = constructorAccessor;   // read volatile\n        if (ca == null) {\n            ca = acquireConstructorAccessor();\n        }\n        @SuppressWarnings("unchecked")\n        T inst = (T) ca.newInstance(initargs);\n        return inst;\n    }\n    // sun.reflect.DelegatingConstructorAccessorImpl\n    public Object newInstance(Object[] args)\n      throws InstantiationException,\n             IllegalArgumentException,\n             InvocationTargetException\n    {\n        return delegate.newInstance(args);\n    }\n    // sun.reflect.NativeConstructorAccessorImpl\n    public Object newInstance(Object[] args)\n        throws InstantiationException,\n               IllegalArgumentException,\n               InvocationTargetException\n    {\n        // We can\'t inflate a constructor belonging to a vm-anonymous class\n        // because that kind of class can\'t be referred to by name, hence can\'t\n        // be found from the generated bytecode.\n        if (++numInvocations > ReflectionFactory.inflationThreshold()\n                && !ReflectUtil.isVMAnonymousClass(c.getDeclaringClass())) {\n            ConstructorAccessorImpl acc = (ConstructorAccessorImpl)\n                new MethodAccessorGenerator().\n                    generateConstructor(c.getDeclaringClass(),\n                                        c.getParameterTypes(),\n                                        c.getExceptionTypes(),\n                                        c.getModifiers());\n            parent.setDelegate(acc);\n        }\n\n        // native constructor\n        return newInstance0(c, args);\n    }\n\n\n\n\n\n# \n\n *  Method;\n\n    // java.lang.Class\n    @CallerSensitive\n    public Method getDeclaredMethod(String name, Class<?>... parameterTypes)\n        throws NoSuchMethodException, SecurityException {\n        checkMemberAccess(Member.DECLARED, Reflection.getCallerClass(), true);\n        Method method = searchMethods(privateGetDeclaredMethods(false), name, parameterTypes);\n        if (method == null) {\n            throw new NoSuchMethodException(getName() + "." + name + argumentTypesToString(parameterTypes));\n        }\n        return method;\n    }\n\n\n\n\n * 1. \n * 2. \n * 3. \n\n\n\n    // Returns an array of "root" methods. These Method objects must NOT\n    // be propagated to the outside world, but must instead be copied\n    // via ReflectionFactory.copyMethod.\n    private Method[] privateGetDeclaredMethods(boolean publicOnly) {\n        checkInitted();\n        Method[] res;\n        ReflectionData<T> rd = reflectionData();\n        if (rd != null) {\n            res = publicOnly ? rd.declaredPublicMethods : rd.declaredMethods;\n            if (res != null) return res;\n        }\n        // No cached value available; request value from VM\n        res = Reflection.filterMethods(this, getDeclaredMethods0(publicOnly));\n        if (rd != null) {\n            if (publicOnly) {\n                rd.declaredPublicMethods = res;\n            } else {\n                rd.declaredMethods = res;\n            }\n        }\n        return res;\n    }\n\n\njvm\n\n Reflection.filterMethods;\n\n\n    // sun.misc.Reflection\n    public static Method[] filterMethods(Class<?> containingClass, Method[] methods) {\n        if (methodFilterMap == null) {\n            // Bootstrapping\n            return methods;\n        }\n        return (Method[])filter(methods, methodFilterMap.get(containingClass));\n    }\n    //  registerMethodsToFilter(), ...\n    private static Member[] filter(Member[] members, String[] filteredNames) {\n        if ((filteredNames == null) || (members.length == 0)) {\n            return members;\n        }\n        int numNewMembers = 0;\n        for (Member member : members) {\n            boolean shouldSkip = false;\n            for (String filteredName : filteredNames) {\n                if (member.getName() == filteredName) {\n                    shouldSkip = true;\n                    break;\n                }\n            }\n            if (!shouldSkip) {\n                ++numNewMembers;\n            }\n        }\n        Member[] newMembers =\n            (Member[])Array.newInstance(members[0].getClass(), numNewMembers);\n        int destIdx = 0;\n        for (Member member : members) {\n            boolean shouldSkip = false;\n            for (String filteredName : filteredNames) {\n                if (member.getName() == filteredName) {\n                    shouldSkip = true;\n                    break;\n                }\n            }\n            if (!shouldSkip) {\n                newMembers[destIdx++] = member;\n            }\n        }\n        return newMembers;\n    }\n\n\n\n * \n\n    private static Method searchMethods(Method[] methods,\n                                        String name,\n                                        Class<?>[] parameterTypes)\n    {\n        Method res = null;\n        // String\n        String internedName = name.intern();\n        for (int i = 0; i < methods.length; i++) {\n            Method m = methods[i];\n            if (m.getName() == internedName\n                && arrayContentsEq(parameterTypes, m.getParameterTypes())\n                && (res == null\n                    || res.getReturnType().isAssignableFrom(m.getReturnType())))\n                res = m;\n        }\n\n        return (res == null ? res : getReflectionFactory().copyMethod(res));\n    }\n\n\n\n\n * for\n * \n *  ReflectionFactory, copy \n\n\n#  method.invoke() \n\n    @CallerSensitive\n    public Object invoke(Object obj, Object... args)\n        throws IllegalAccessException, IllegalArgumentException,\n           InvocationTargetException\n    {\n        if (!override) {\n            if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) {\n                Class<?> caller = Reflection.getCallerClass();\n                checkAccess(caller, clazz, obj, modifiers);\n            }\n        }\n        MethodAccessor ma = methodAccessor;             // read volatile\n        if (ma == null) {\n            ma = acquireMethodAccessor();\n        }\n        return ma.invoke(obj, args);\n    }\n\n\ninvoke MethodAccessor  MethodAccessor  acquireMethodAccessor() \n\n    // probably make the implementation more scalable.\n    private MethodAccessor acquireMethodAccessor() {\n        // First check to see if one has been created yet, and take it\n        // if so\n        MethodAccessor tmp = null;\n        if (root != null) tmp = root.getMethodAccessor();\n        if (tmp != null) {\n            //  methodAccessor ReflectionFactory  MethodAccessor\n            methodAccessor = tmp;\n        } else {\n            // Otherwise fabricate one and propagate it up to the root\n            tmp = reflectionFactory.newMethodAccessor(this);\n            setMethodAccessor(tmp);\n        }\n\n        return tmp;\n    }\n    // sun.reflect.ReflectionFactory\n    public MethodAccessor newMethodAccessor(Method method) {\n        checkInitted();\n\n        if (noInflation && !ReflectUtil.isVMAnonymousClass(method.getDeclaringClass())) {\n            return new MethodAccessorGenerator().\n                generateMethod(method.getDeclaringClass(),\n                               method.getName(),\n                               method.getParameterTypes(),\n                               method.getReturnType(),\n                               method.getExceptionTypes(),\n                               method.getModifiers());\n        } else {\n            NativeMethodAccessorImpl acc =\n                new NativeMethodAccessorImpl(method);\n            DelegatingMethodAccessorImpl res =\n                new DelegatingMethodAccessorImpl(acc);\n            acc.setParent(res);\n            return res;\n        }\n    }\n\n\nAccessor\n\n\n//     NativeMethodAccessorImpl / DelegatingMethodAccessorImpl\nclass NativeMethodAccessorImpl extends MethodAccessorImpl {\n    private final Method method;\n    private DelegatingMethodAccessorImpl parent;\n    private int numInvocations;\n\n    NativeMethodAccessorImpl(Method method) {\n        this.method = method;\n    }\n\n    public Object invoke(Object obj, Object[] args)\n        throws IllegalArgumentException, InvocationTargetException\n    {\n        // We can\'t inflate methods belonging to vm-anonymous classes because\n        // that kind of class can\'t be referred to by name, hence can\'t be\n        // found from the generated bytecode.\n        if (++numInvocations > ReflectionFactory.inflationThreshold()\n                && !ReflectUtil.isVMAnonymousClass(method.getDeclaringClass())) {\n            MethodAccessorImpl acc = (MethodAccessorImpl)\n                new MethodAccessorGenerator().\n                    generateMethod(method.getDeclaringClass(),\n                                   method.getName(),\n                                   method.getParameterTypes(),\n                                   method.getReturnType(),\n                                   method.getExceptionTypes(),\n                                   method.getModifiers());\n            parent.setDelegate(acc);\n        }\n\n        return invoke0(method, obj, args);\n    }\n\n    void setParent(DelegatingMethodAccessorImpl parent) {\n        this.parent = parent;\n    }\n\n    private static native Object invoke0(Method m, Object obj, Object[] args);\n}\nclass DelegatingMethodAccessorImpl extends MethodAccessorImpl {\n    private MethodAccessorImpl delegate;\n\n    DelegatingMethodAccessorImpl(MethodAccessorImpl delegate) {\n        setDelegate(delegate);\n    }\n\n    public Object invoke(Object obj, Object[] args)\n        throws IllegalArgumentException, InvocationTargetException\n    {\n        return delegate.invoke(obj, args);\n    }\n\n    void setDelegate(MethodAccessorImpl delegate) {\n        this.delegate = delegate;\n    }\n}\n\n\n ma.invoke(obj, args);  DelegatingMethodAccessorImpl.invoke();\n\n NativeMethodAccessorImpl.invoke(), \n\n    public Object invoke(Object obj, Object[] args)\n        throws IllegalArgumentException, InvocationTargetException\n    {\n        // We can\'t inflate methods belonging to vm-anonymous classes because\n        // that kind of class can\'t be referred to by name, hence can\'t be\n        // found from the generated bytecode.\n        if (++numInvocations > ReflectionFactory.inflationThreshold()\n                && !ReflectUtil.isVMAnonymousClass(method.getDeclaringClass())) {\n            MethodAccessorImpl acc = (MethodAccessorImpl)\n                new MethodAccessorGenerator().\n                    generateMethod(method.getDeclaringClass(),\n                                   method.getName(),\n                                   method.getParameterTypes(),\n                                   method.getReturnType(),\n                                   method.getExceptionTypes(),\n                                   method.getModifiers());\n            parent.setDelegate(acc);\n        }\n\n        // invoke0  native jvm\n        return invoke0(method, obj, args);\n    }\n\n\n generateMethod() \n\n    /** This routine is not thread-safe */\n    public MethodAccessor generateMethod(Class<?> declaringClass,\n                                         String   name,\n                                         Class<?>[] parameterTypes,\n                                         Class<?>   returnType,\n                                         Class<?>[] checkedExceptions,\n                                         int modifiers)\n    {\n        return (MethodAccessor) generate(declaringClass,\n                                         name,\n                                         parameterTypes,\n                                         returnType,\n                                         checkedExceptions,\n                                         modifiers,\n                                         false,\n                                         false,\n                                         null);\n    }\n\n\ngenerate() \n\n    /** This routine is not thread-safe */\n    private MagicAccessorImpl generate(final Class<?> declaringClass,\n                                       String name,\n                                       Class<?>[] parameterTypes,\n                                       Class<?>   returnType,\n                                       Class<?>[] checkedExceptions,\n                                       int modifiers,\n                                       boolean isConstructor,\n                                       boolean forSerialization,\n                                       Class<?> serializationTargetClass)\n    {\n        ByteVector vec = ByteVectorFactory.create();\n        asm = new ClassFileAssembler(vec);\n        this.declaringClass = declaringClass;\n        this.parameterTypes = parameterTypes;\n        this.returnType = returnType;\n        this.modifiers = modifiers;\n        this.isConstructor = isConstructor;\n        this.forSerialization = forSerialization;\n\n        asm.emitMagicAndVersion();\n\n        // Constant pool entries:\n        // ( * = Boxing information: optional)\n        // (+  = Shared entries provided by AccessorGenerator)\n        // (^  = Only present if generating SerializationConstructorAccessor)\n        //     [UTF-8] [This class\'s name]\n        //     [CONSTANT_Class_info] for above\n        //     [UTF-8] "sun/reflect/{MethodAccessorImpl,ConstructorAccessorImpl,SerializationConstructorAccessorImpl}"\n        //     [CONSTANT_Class_info] for above\n        //     [UTF-8] [Target class\'s name]\n        //     [CONSTANT_Class_info] for above\n        // ^   [UTF-8] [Serialization: Class\'s name in which to invoke constructor]\n        // ^   [CONSTANT_Class_info] for above\n        //     [UTF-8] target method or constructor name\n        //     [UTF-8] target method or constructor signature\n        //     [CONSTANT_NameAndType_info] for above\n        //     [CONSTANT_Methodref_info or CONSTANT_InterfaceMethodref_info] for target method\n        //     [UTF-8] "invoke" or "newInstance"\n        //     [UTF-8] invoke or newInstance descriptor\n        //     [UTF-8] descriptor for type of non-primitive parameter 1\n        //     [CONSTANT_Class_info] for type of non-primitive parameter 1\n        //     ...\n        //     [UTF-8] descriptor for type of non-primitive parameter n\n        //     [CONSTANT_Class_info] for type of non-primitive parameter n\n        // +   [UTF-8] "java/lang/Exception"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "java/lang/ClassCastException"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "java/lang/NullPointerException"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "java/lang/IllegalArgumentException"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "java/lang/InvocationTargetException"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "<init>"\n        // +   [UTF-8] "()V"\n        // +   [CONSTANT_NameAndType_info] for above\n        // +   [CONSTANT_Methodref_info] for NullPointerException\'s constructor\n        // +   [CONSTANT_Methodref_info] for IllegalArgumentException\'s constructor\n        // +   [UTF-8] "(Ljava/lang/String;)V"\n        // +   [CONSTANT_NameAndType_info] for "<init>(Ljava/lang/String;)V"\n        // +   [CONSTANT_Methodref_info] for IllegalArgumentException\'s constructor taking a String\n        // +   [UTF-8] "(Ljava/lang/Throwable;)V"\n        // +   [CONSTANT_NameAndType_info] for "<init>(Ljava/lang/Throwable;)V"\n        // +   [CONSTANT_Methodref_info] for InvocationTargetException\'s constructor\n        // +   [CONSTANT_Methodref_info] for "super()"\n        // +   [UTF-8] "java/lang/Object"\n        // +   [CONSTANT_Class_info] for above\n        // +   [UTF-8] "toString"\n        // +   [UTF-8] "()Ljava/lang/String;"\n        // +   [CONSTANT_NameAndType_info] for "toString()Ljava/lang/String;"\n        // +   [CONSTANT_Methodref_info] for Object\'s toString method\n        // +   [UTF-8] "Code"\n        // +   [UTF-8] "Exceptions"\n        //  *  [UTF-8] "java/lang/Boolean"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(Z)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "booleanValue"\n        //  *  [UTF-8] "()Z"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Byte"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(B)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "byteValue"\n        //  *  [UTF-8] "()B"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Character"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(C)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "charValue"\n        //  *  [UTF-8] "()C"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Double"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(D)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "doubleValue"\n        //  *  [UTF-8] "()D"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Float"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(F)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "floatValue"\n        //  *  [UTF-8] "()F"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Integer"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(I)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "intValue"\n        //  *  [UTF-8] "()I"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Long"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(J)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "longValue"\n        //  *  [UTF-8] "()J"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "java/lang/Short"\n        //  *  [CONSTANT_Class_info] for above\n        //  *  [UTF-8] "(S)V"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n        //  *  [UTF-8] "shortValue"\n        //  *  [UTF-8] "()S"\n        //  *  [CONSTANT_NameAndType_info] for above\n        //  *  [CONSTANT_Methodref_info] for above\n\n        short numCPEntries = NUM_BASE_CPOOL_ENTRIES + NUM_COMMON_CPOOL_ENTRIES;\n        boolean usesPrimitives = usesPrimitiveTypes();\n        if (usesPrimitives) {\n            numCPEntries += NUM_BOXING_CPOOL_ENTRIES;\n        }\n        if (forSerialization) {\n            numCPEntries += NUM_SERIALIZATION_CPOOL_ENTRIES;\n        }\n\n        // Add in variable-length number of entries to be able to describe\n        // non-primitive parameter types and checked exceptions.\n        numCPEntries += (short) (2 * numNonPrimitiveParameterTypes());\n\n        asm.emitShort(add(numCPEntries, S1));\n\n        final String generatedName = generateName(isConstructor, forSerialization);\n        asm.emitConstantPoolUTF8(generatedName);\n        asm.emitConstantPoolClass(asm.cpi());\n        thisClass = asm.cpi();\n        if (isConstructor) {\n            if (forSerialization) {\n                asm.emitConstantPoolUTF8\n                    ("sun/reflect/SerializationConstructorAccessorImpl");\n            } else {\n                asm.emitConstantPoolUTF8("sun/reflect/ConstructorAccessorImpl");\n            }\n        } else {\n            asm.emitConstantPoolUTF8("sun/reflect/MethodAccessorImpl");\n        }\n        asm.emitConstantPoolClass(asm.cpi());\n        superClass = asm.cpi();\n        asm.emitConstantPoolUTF8(getClassName(declaringClass, false));\n        asm.emitConstantPoolClass(asm.cpi());\n        targetClass = asm.cpi();\n        short serializationTargetClassIdx = (short) 0;\n        if (forSerialization) {\n            asm.emitConstantPoolUTF8(getClassName(serializationTargetClass, false));\n            asm.emitConstantPoolClass(asm.cpi());\n            serializationTargetClassIdx = asm.cpi();\n        }\n        asm.emitConstantPoolUTF8(name);\n        asm.emitConstantPoolUTF8(buildInternalSignature());\n        asm.emitConstantPoolNameAndType(sub(asm.cpi(), S1), asm.cpi());\n        if (isInterface()) {\n            asm.emitConstantPoolInterfaceMethodref(targetClass, asm.cpi());\n        } else {\n            if (forSerialization) {\n                asm.emitConstantPoolMethodref(serializationTargetClassIdx, asm.cpi());\n            } else {\n                asm.emitConstantPoolMethodref(targetClass, asm.cpi());\n            }\n        }\n        targetMethodRef = asm.cpi();\n        if (isConstructor) {\n            asm.emitConstantPoolUTF8("newInstance");\n        } else {\n            asm.emitConstantPoolUTF8("invoke");\n        }\n        invokeIdx = asm.cpi();\n        if (isConstructor) {\n            asm.emitConstantPoolUTF8("([Ljava/lang/Object;)Ljava/lang/Object;");\n        } else {\n            asm.emitConstantPoolUTF8\n                ("(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;");\n        }\n        invokeDescriptorIdx = asm.cpi();\n\n        // Output class information for non-primitive parameter types\n        nonPrimitiveParametersBaseIdx = add(asm.cpi(), S2);\n        for (int i = 0; i < parameterTypes.length; i++) {\n            Class<?> c = parameterTypes[i];\n            if (!isPrimitive(c)) {\n                asm.emitConstantPoolUTF8(getClassName(c, false));\n                asm.emitConstantPoolClass(asm.cpi());\n            }\n        }\n\n        // Entries common to FieldAccessor, MethodAccessor and ConstructorAccessor\n        emitCommonConstantPoolEntries();\n\n        // Boxing entries\n        if (usesPrimitives) {\n            emitBoxingContantPoolEntries();\n        }\n\n        if (asm.cpi() != numCPEntries) {\n            throw new InternalError("Adjust this code (cpi = " + asm.cpi() +\n                                    ", numCPEntries = " + numCPEntries + ")");\n        }\n\n        // Access flags\n        asm.emitShort(ACC_PUBLIC);\n\n        // This class\n        asm.emitShort(thisClass);\n\n        // Superclass\n        asm.emitShort(superClass);\n\n        // Interfaces count and interfaces\n        asm.emitShort(S0);\n\n        // Fields count and fields\n        asm.emitShort(S0);\n\n        // Methods count and methods\n        asm.emitShort(NUM_METHODS);\n\n        emitConstructor();\n        emitInvoke();\n\n        // Additional attributes (none)\n        asm.emitShort(S0);\n\n        // Load class\n        vec.trim();\n        final byte[] bytes = vec.getData();\n        // Note: the class loader is the only thing that really matters\n        // here -- it\'s important to get the generated code into the\n        // same namespace as the target class. Since the generated code\n        // is privileged anyway, the protection domain probably doesn\'t\n        // matter.\n        return AccessController.doPrivileged(\n            new PrivilegedAction<MagicAccessorImpl>() {\n                public MagicAccessorImpl run() {\n                        try {\n                        return (MagicAccessorImpl)\n                        ClassDefiner.defineClass\n                                (generatedName,\n                                 bytes,\n                                 0,\n                                 bytes.length,\n                                 declaringClass.getClassLoader()).newInstance();\n                        } catch (InstantiationException | IllegalAccessException e) {\n                            throw new InternalError(e);\n                        }\n                    }\n                });\n    }\n\n\nClassDefiner.defineClass(xx, declaringClass.getClassLoader()).newInstance();\n\nClassDefiner.defineClassDelegatingClassLoader \n\n\n\n\n# \n\n\n\n 1. \n\n 2. Classmethod\n\n 3. \n\n 4. relectionDataclassjvm\n\n 5. Accessor, \n\n 6. copy\n\n 7. jvminvoke0()\n\n\n# \n\n * https://www.codercto.com/a/46094.html\n * https://blog.csdn.net/sinat_38259539/article/details/71799078\n * https://blog.csdn.net/qq_40896997/article/details/94483820\n * https://www.cnblogs.com/zhaoguhong/p/6937364.html\n * https://juejin.im/post/5c160420e51d452a60684431\n * https://blog.csdn.net/mcryeasy/java/article/details/52344729\n *  https://www.pdai.tech/md/java/basic/java-basic-x-reflection.html',normalizedContent:'# java  - \n\n> javajavajavajava java\n\n * java  - \n   * \n     * class\n     * \n   * \n     * class\n     * constructor\n     * field\n     * method\n   * \n     * \n     * \n     *  method.invoke() \n     * \n   * \n\n\n# \n\nrttirun-time type identificationthinking in javartti\n\njavajava\n\n\n\n>  class class\n\n\n# class\n\nclassclassjdkjava.langclassjava(class ans enum)(interface and annotation)javajvmclass.class.getclass()class.forname("")classclass  class booleanbytecharshortintlongfloatdoublevoid class \n\npublic final class class<t> implements java.io.serializable,\n                              genericdeclaration,\n                              type,\n                              annotatedelement {\n    private static final int annotation= 0x00002000;\n    private static final int enum      = 0x00004000;\n    private static final int synthetic = 0x00001000;\n\n    private static native void registernatives();\n    static {\n        registernatives();\n    }\n\n    /*\n     * private constructor. only the java virtual machine creates class objects.   //jvmclass\n     * this constructor is not used and prevents the default constructor being\n     * generated.\n     */\n    private class(classloader loader) {\n        // initialize final field for classloader.  the initialization value of non-null\n        // prevents future jit optimizations from assuming this final field is null.\n        classloader = loader;\n    }\n\n\n\n\n * classclass\n\n * classclass.class()\n\n * classclassclass\n\n * classclassjvm\n\n * class()\n\n\n# \n\n\n\n * jvm - \n   * jvm\n * jvm - java \n   * java \n\n\n\n 1. \n\n\n\n 2. \n\n\n\n\n# \n\n\n\nclass\n\njavaclassjava.lang.reflectconstructorclass fieldclass(private)methodclass(private)\n\n\n# class\n\njvmclass\n\nclassclass\n\n * .class\n * .getclass()\n * class.forname()\n\n    @test\n    public void classtest() throws exception {\n        // class\n        logger.info(":  \\t" + user.class);\n        logger.info(":  \\t" + new user().getclass());\n        logger.info(":\\t" + class.forname("com.test.user"));\n        // \n        logger.info(":\\t" + userclass.getname());\n        logger.info(":\\t" + userclass.getsimplename());\n        logger.info(":\\t" + userclass.newinstance());\n    }\n\n    // ...\n    package com.test;\n\n    public class user {\n        private string name = "init";\n        private int age;\n        public user() {}\n        public user(string name, int age) {\n            super();\n            this.name = name;\n            this.age = age;\n        }\n        private string getname() {\n            return name;\n        }\n        private void setname(string name) {\n            this.name = name;\n        }\n        public int getage() {\n            return age;\n        }\n        public void setage(int age) {\n            this.age = age;\n        }\n        @override\n        public string tostring() {\n            return "user [name=" + name + ", age=" + age + "]";\n        }\n    }\n\n\n\n\n:  \tclass com.test.user\n:  \tclass com.test.user\n:\tclass com.test.user\n:\tcom.test.user\n:\tuser\n:\tuser [name=init, age=0]\n\n\n *  class\n\n                                  \nforname()                            (1)class()\n(2)classforname()   \nobject-getclass()                    classclass\ngetname()                            ()\ngetsimplename()                      ()\ngetcanonicalname()                   ()\nisinterface()                        class\ngetinterfaces()                      classclass\ngetsupercalss()                      classclass\nnewinstance()                        oject\ngetfields()                          public\n                                     getmethodsgetconstructors\ngetdeclaredfields                    publicprivateprotecedgetdeclaredmethodsgetdeclaredconstructors\n\nhttps://blog.csdn.net/mcryeasy/article/details/52344729\n\npackage com.cry;\nimport java.lang.reflect.field;\ninterface i1 {\n}\ninterface i2 {\n}\nclass cell{\n    public int mcellpublic;\n}\nclass animal extends  cell{\n    private int manimalprivate;\n    protected int manimalprotected;\n    int manimaldefault;\n    public int manimalpublic;\n    private static int sanimalprivate;\n    protected static int sanimalprotected;\n    static int sanimaldefault;\n    public static int sanimalpublic;\n}\nclass dog extends animal implements i1, i2 {\n    private int mdogprivate;\n    public int mdogpublic;\n    protected int mdogprotected;\n    private int mdogdefault;\n    private static int sdogprivate;\n    protected static int sdogprotected;\n    static int sdogdefault;\n    public static int sdogpublic;\n}\npublic class test {\n    public static void main(string[] args) throws illegalaccessexception, instantiationexception {\n        class<dog> dog = dog.class;\n        //\n        system.out.println(dog.getname()); //com.cry.dog\n        system.out.println(dog.getsimplename()); //dog\n        system.out.println(dog.getcanonicalname());//com.cry.dog\n        //\n        system.out.println(dog.isinterface()); //false\n        for (class ii : dog.getinterfaces()) {\n            system.out.println(ii);\n        }\n         /*\n          interface com.cry.i1\n          interface com.cry.i2\n         */\n\n        //\n        system.out.println(dog.getsuperclass());//class com.cry.animal\n        //\n        dog d = dog.newinstance();\n        //\n        for (field f : dog.getfields()) {\n            system.out.println(f.getname());\n        }\n        /*\n            mdogpublic\n            sdogpublic\n            manimalpublic\n            sanimalpublic\n            mcellpublic  //\n         */\n        system.out.println("---------");\n        for (field f : dog.getdeclaredfields()) {\n            system.out.println(f.getname());\n        }\n        /** \n         mdogprivate\n         mdogpublic\n         mdogprotected\n         mdogdefault\n         sdogprivate\n         sdogprotected\n         sdogdefault\n         sdogpublic\n         */\n    }\n}\n\n\ngetnamegetcanonicalnamegetsimplename\n\n * getsimplename\n * getnamejvmclassclassclass.forname\n * getcanonicalnametostringloggetname\n\npackage com.cry;\npublic class test {\n    private  class inner{\n    }\n    public static void main(string[] args) throws classnotfoundexception {\n        //\n        system.out.println(test.class.getsimplename()); //test\n        system.out.println(test.class.getname()); //com.cry.test\n        system.out.println(test.class.getcanonicalname()); //com.cry.test\n        //\n        system.out.println(inner.class.getsimplename()); //inner\n        system.out.println(inner.class.getname()); //com.cry.test$inner\n        system.out.println(inner.class.getcanonicalname()); //com.cry.test.inner\n        //\n        system.out.println(args.getclass().getsimplename()); //string[]\n        system.out.println(args.getclass().getname()); //[ljava.lang.string;\n        system.out.println(args.getclass().getcanonicalname()); //java.lang.string[]\n        //getcanonicalnamegetname\n        //class.forname(inner.class.getcanonicalname()); \n        class.forname(inner.class.getname());\n    }\n}\n\n\n\n# constructor\n\n> constructor(java.lang.reflect)class \n\nconstructorclassclassconstructor\n\n                                                               \nstatic class<?>    forname(string classname)                             class \nconstructor        getconstructor(class<?>... parametertypes)           public\nconstructor<?>[]   getconstructors()                                    publicconstructor\nconstructor        getdeclaredconstructor(class<?>... parametertypes)   private\nconstructor<?>[]   getdeclaredconstructors()                            private\nt                  newinstance()                                         class \n\nconstructor\n\npublic class constructiontest implements serializable {\n    public static void main(string[] args) throws exception {\n\n        class<?> clazz = null;\n\n        //class\n        clazz = class.forname("com.example.javabase.user");\n\n        //user,\n        user user = (user) clazz.newinstance();\n        user.setage(20);\n        user.setname("jack");\n        system.out.println(user);\n\n        system.out.println("--------------------------------------------");\n\n        //stringpublic\n        constructor cs1 =clazz.getconstructor(string.class);\n        //user\n        user user1= (user) cs1.newinstance("hiway");\n        user1.setage(22);\n        system.out.println("user1:"+user1.tostring());\n\n        system.out.println("--------------------------------------------");\n\n        //intstring,private\n        constructor cs2=clazz.getdeclaredconstructor(int.class,string.class);\n        //private\n        cs2.setaccessible(true);\n        //user\n        user user2= (user) cs2.newinstance(25,"hiway2");\n        system.out.println("user2:"+user2.tostring());\n\n        system.out.println("--------------------------------------------");\n\n        //private\n        constructor<?> cons[] = clazz.getdeclaredconstructors();\n        // \n        for (int i = 0; i < cons.length; i++) {\n            //\n            class<?> clazzs[] = cons[i].getparametertypes();\n            system.out.println("["+i+"]:"+cons[i].tostring() );\n            system.out.print("["+i+"]:(");\n            for (int j = 0; j < clazzs.length; j++) {\n                if (j == clazzs.length - 1)\n                    system.out.print(clazzs[j].getname());\n                else\n                    system.out.print(clazzs[j].getname() + ",");\n            }\n            system.out.println(")");\n        }\n    }\n}\n\n\nclass user {\n    private int age;\n    private string name;\n    public user() {\n        super();\n    }\n    public user(string name) {\n        super();\n        this.name = name;\n    }\n\n    /**\n     * \n     * @param age\n     * @param name\n     */\n    private user(int age, string name) {\n        super();\n        this.age = age;\n        this.name = name;\n    }\n\n    public int getage() {\n        return age;\n    }\n\n    public void setage(int age) {\n        this.age = age;\n    }\n\n    public string getname() {\n        return name;\n    }\n\n    public void setname(string name) {\n        this.name = name;\n    }\n\n    @override\n    public string tostring() {\n        return "user{" +\n                "age=" + age +\n                ", name=\'" + name + \'\\\'\' +\n                \'}\';\n    }\n}\n\n\n\n\n/* output \nuser{age=20, name=\'jack\'}\n--------------------------------------------\nuser1:user{age=22, name=\'hiway\'}\n--------------------------------------------\nuser2:user{age=25, name=\'hiway2\'}\n--------------------------------------------\n[0]:private com.example.javabase.user(int,java.lang.string)\n[0]:(int,java.lang.string)\n[1]:public com.example.javabase.user(java.lang.string)\n[1]:(java.lang.string)\n[2]:public com.example.javabase.user()\n[2]:()\n\n\nconstructor(api)\n\n                                      \nclass        getdeclaringclass()                class  constructor\n                                               ,\ntype[]       getgenericparametertypes()         type  constructor\nstring       getname()                         \nclass<?>[]   getparametertypes()                class constructor \nt            newinstance(object... initargs)    constructor\nstring       togenericstring()                  constructor \n\n\n\nconstructor cs3 = clazz.getdeclaredconstructor(int.class,string.class);\nsystem.out.println("-----getdeclaringclass-----");\nclass uclazz=cs3.getdeclaringclass();\n//constructor\nsystem.out.println(":"+uclazz.getname());\n\nsystem.out.println("-----getgenericparametertypes-----");\n// constructor \ntype[] tps=cs3.getgenericparametertypes();\nfor (type tp:tps) {\n    system.out.println("tp:"+tp);\n}\nsystem.out.println("-----getparametertypes-----");\n//\nclass<?> clazzs[] = cs3.getparametertypes();\nfor (class claz:clazzs) {\n    system.out.println(":"+claz.getname());\n}\nsystem.out.println("-----getname-----");\n//\nsystem.out.println("getname:"+cs3.getname());\n\nsystem.out.println("-----getogenericstring-----");\n// constructor \nsystem.out.println("getogenericstring():"+cs3.togenericstring());\n\n\n\n\n-----getdeclaringclass-----\n:com.example.javabase.user\n-----getgenericparametertypes-----\ntp:int\ntp:class java.lang.string\n-----getparametertypes-----\n:int\n:java.lang.string\n-----getname-----\ngetname:com.example.javabase.user\n-----getogenericstring-----\ngetogenericstring():private com.example.javabase.user(int,java.lang.string)\n\n\n\n# field\n\n> field \n\nclassfieldclassfield\n\n                                 \nfield     getdeclaredfield(string name)   name(private)\nfield[]   getdeclaredfields()             class(private),\nfield     getfield(string name)           namepublic\nfield[]   getfields()                     public\n\n\n\npublic class reflectfield {\n\n    public static void main(string[] args) throws classnotfoundexception, nosuchfieldexception {\n        class<?> clazz = class.forname("reflect.student");\n        //field,public,\n        // nosuchfieldexception\n        field field = clazz.getfield("age");\n        system.out.println("field:"+field);\n\n        //public,,public\n        field fields[] = clazz.getfields();\n        for (field f:fields) {\n            system.out.println("f:"+f.getdeclaringclass());\n        }\n\n        system.out.println("================getdeclaredfields====================");\n        //(private),\n        field fields2[] = clazz.getdeclaredfields();\n        for (field f:fields2) {\n            system.out.println("f2:"+f.getdeclaringclass());\n        }\n        //field,,\n        field field2 = clazz.getdeclaredfield("desc");\n        system.out.println("field2:"+field2);\n    }\n    /**\n      : \n     field:public int reflect.person.age\n     f:public java.lang.string reflect.student.desc\n     f:public int reflect.person.age\n     f:public java.lang.string reflect.person.name\n\n     ================getdeclaredfields====================\n     f2:public java.lang.string reflect.student.desc\n     f2:private int reflect.student.score\n     field2:public java.lang.string reflect.student.desc\n     */\n}\n\nclass person{\n    public int age;\n    public string name;\n    //setget\n}\n\nclass student extends person{\n    public string desc;\n    private int score;\n    //setget\n}\n\n\nclassgetdeclaredfield/getdeclaredfieldsclassgetfield/getfieldspublicfield\n\n//class\nclass<?> clazz = class.forname("reflect.student");\n\nstudent st= (student) clazz.newinstance();\n//public\nfield agefield = clazz.getfield("age");\nagefield.set(st,18);\nfield namefield = clazz.getfield("name");\nnamefield.set(st,"lily");\n\n//,\nfield descfield = clazz.getdeclaredfield("desc");\ndescfield.set(st,"i am student");\nfield scorefield = clazz.getdeclaredfield("score");\n//scoreprivate\nscorefield.setaccessible(true);\nscorefield.set(st,88);\nsystem.out.println(st.tostring());\n\n//student{age=18, name=\'lily ,desc=\'i am student\', score=88} \n\n//\nsystem.out.println(scorefield.get(st));\n// 88\n\n\nset(object obj, object value)fieldget(object obj)field\n\n                                  \nvoid       set(object obj, object value)    field \nobject     get(object obj)                  field \nclass<?>   gettype()                        class field \nboolean    isenumconstant()                 true false\nstring     togenericstring()                field\nstring     getname()                        field \nclass<?>   getdeclaringclass()              class  field \nvoid       setaccessible(boolean flag)      accessible ,\n\nfieldsetint()/getint()setboolean()/getbooleansetchar()/getchar()apifinalfield\n\n\n# method\n\n> method \n\nclassmethod\n\n                                                               \nmethod     getdeclaredmethod(string name, class<?>... parametertypes)   method class \nmethod[]   getdeclaredmethods()                                          method  class\n                                                                        \nmethod     getmethod(string name, class<?>... parametertypes)            method  class \nmethod[]   getmethods()                                                  method  class\n                                                                         member \n\n\n\nimport java.lang.reflect.method;\n\npublic class reflectmethod  {\n\n\n    public static void main(string[] args) throws classnotfoundexception, nosuchmethodexception {\n\n        class clazz = class.forname("reflect.circle");\n\n        //publicmethod,\n        method method = clazz.getmethod("draw",int.class,string.class);\n\n        system.out.println("method:"+method);\n\n        //public:\n        method[] methods =clazz.getmethods();\n        for (method m:methods){\n            system.out.println("m::"+m);\n        }\n\n        system.out.println("=========================================");\n\n        //private,method\n        method method1 = clazz.getdeclaredmethod("drawcircle");\n        system.out.println("method1::"+method1);\n        //private,method\n        method[] methods1=clazz.getdeclaredmethods();\n        for (method m:methods1){\n            system.out.println("m1::"+m);\n        }\n    }\n}\n\nclass shape {\n    public void draw(){\n        system.out.println("draw");\n    }\n\n    public void draw(int count , string name){\n        system.out.println("draw "+ name +",count="+count);\n    }\n\n}\nclass circle extends shape{\n\n    private void drawcircle(){\n        system.out.println("drawcircle");\n    }\n    public int getallcount(){\n        return 100;\n    }\n}\n\n\n:\n\nmethod:public void reflect.shape.draw(int,java.lang.string)\n\nm::public int reflect.circle.getallcount()\nm::public void reflect.shape.draw()\nm::public void reflect.shape.draw(int,java.lang.string)\nm::public final void java.lang.object.wait(long,int) throws java.lang.interruptedexception\nm::public final native void java.lang.object.wait(long) throws java.lang.interruptedexception\nm::public final void java.lang.object.wait() throws java.lang.interruptedexception\nm::public boolean java.lang.object.equals(java.lang.object)\nm::public java.lang.string java.lang.object.tostring()\nm::public native int java.lang.object.hashcode()\nm::public final native java.lang.class java.lang.object.getclass()\nm::public final native void java.lang.object.notify()\nm::public final native void java.lang.object.notifyall()\n\n=========================================\nmethod1::private void reflect.circle.drawcircle()\n\nm1::public int reflect.circle.getallcount()\nm1::private void reflect.circle.drawcircle()\n\n\ngetmethodsmethodobjectgetdeclaredmethod/getdeclaredmethodsmethod\n\nclass clazz = class.forname("reflect.circle");\n//\ncircle circle = (circle) clazz.newinstance();\n\n//method\nmethod method = clazz.getmethod("draw",int.class,string.class);\n\n//methodinvoke(object obj,object... args)\nmethod.invoke(circle,15,"");\n\n//\nmethod method1 = clazz.getdeclaredmethod("drawcircle");\n//\nmethod1.setaccessible(true);\nmethod1.invoke(circle);\n\n//\nmethod method2 =clazz.getdeclaredmethod("getallcount");\ninteger count = (integer) method2.invoke(circle);\nsystem.out.println("count:"+count);\n\n\n\n\ndraw ,count=15\ndrawcircle\ncount:100\n\n\nmethodinvoke(object obj,object... args)\n\n                                         \nobject       invoke(object obj, object... args)    method \nclass<?>     getreturntype()                       class  method ,\ntype         getgenericreturntype()                method  type \nclass<?>[]   getparametertypes()                   class  method\n                                                  \ntype[]       getgenericparametertypes()            type  method\n                                                  \nstring       getname()                             string  method \nboolean      isvarargs()                           true false\nstring       togenericstring()                     method \n\ngetreturntype/getgenericreturntypemethodclasstype()typejava8\n\npublic interface type {\n    //1.8\n    default string gettypename() {\n        return tostring();\n    }\n}\n\n\ngetparametertypes/getgenericparametertypesmethodfieldconstructor\n\n\n# \n\n> https://www.cnblogs.com/yougewe/p/10125073.html\n\n\n\npublic class helloreflect {\n    public static void main(string[] args) {\n        try {\n            // 1. \n            tempfunctiontest test = (tempfunctiontest)class.forname("com.tester.helloreflect").newinstance();\n            test.sayhello("call directly");\n            // 2. \n            object t2 = new tempfunctiontest();\n            method method = t2.getclass().getdeclaredmethod("sayhello", string.class);\n            method.invoke(test, "method invoke");\n        } catch (classnotfoundexception e) {\n            e.printstacktrace();\n        } catch (instantiationexception e) {\n            e.printstacktrace();\n        } catch (illegalaccessexception e) {\n            e.printstacktrace();\n        } catch (nosuchmethodexception e ) {\n            e.printstacktrace();\n        } catch (invocationtargetexception e) {\n            e.printstacktrace();\n        }\n    }\n    \n    public void sayhello(string word) {\n        system.out.println("hello," + word);\n    }\n\n}\n\n\n\n\n\n\n\n# \n\n java.lang.class \n\n    @callersensitive\n    public static class<?> forname(string classname)\n                throws classnotfoundexception {\n        //  classloader\n        class<?> caller = reflection.getcallerclass();\n        // nativeclass\n        return forname0(classname, true, classloader.getclassloader(caller), caller);\n    }\n\n\nforname()java,jvm\n\n classloader,  native  java.lang.classloader.\n\njvm classloader \n\n\n    // \n    public class<?> loadclass(string name) throws classnotfoundexception {\n        return loadclass(name, false);\n    }\n    \n        // sun.misc.launcher\n        public class<?> loadclass(string var1, boolean var2) throws classnotfoundexception {\n            int var3 = var1.lastindexof(46);\n            if(var3 != -1) {\n                securitymanager var4 = system.getsecuritymanager();\n                if(var4 != null) {\n                    var4.checkpackageaccess(var1.substring(0, var3));\n                }\n            }\n\n            if(this.ucp.knowntonotexist(var1)) {\n                class var5 = this.findloadedclass(var1);\n                if(var5 != null) {\n                    if(var2) {\n                        this.resolveclass(var5);\n                    }\n\n                    return var5;\n                } else {\n                    throw new classnotfoundexception(var1);\n                }\n            } else {\n                return super.loadclass(var1, var2);\n            }\n        }\n    // java.lang.classloader\n    protected class<?> loadclass(string name, boolean resolve)\n        throws classnotfoundexception\n    {\n        // \n        synchronized (getclassloadinglock(name)) {\n            // first, check if the class has already been loaded\n            // \n            class<?> c = findloadedclass(name);\n            if (c == null) {\n                long t0 = system.nanotime();\n                try {\n                    // \n                    if (parent != null) {\n                        c = parent.loadclass(name, false);\n                    } else {\n                        c = findbootstrapclassornull(name);\n                    }\n                } catch (classnotfoundexception e) {\n                    // classnotfoundexception thrown if class not found\n                    // from the non-null parent class loader\n                }\n\n                // \n                if (c == null) {\n                    // if still not found, then invoke findclass in order\n                    // to find the class.\n                    long t1 = system.nanotime();\n                    c = findclass(name);\n\n                    // this is the defining class loader; record the stats\n                    sun.misc.perfcounter.getparentdelegationtime().addtime(t1 - t0);\n                    sun.misc.perfcounter.getfindclasstime().addelapsedtimefrom(t1);\n                    sun.misc.perfcounter.getfindclasses().increment();\n                }\n            }\n            if (resolve) {\n                resolveclass(c);\n            }\n            return c;\n        }\n    }\n    \n    protected object getclassloadinglock(string classname) {\n        object lock = this;\n        if (parallellockmap != null) {\n            //  concurrenthashmap\n            object newlock = new object();\n            lock = parallellockmap.putifabsent(classname, newlock);\n            if (lock == null) {\n                lock = newlock;\n            }\n        }\n        return lock;\n    }\n    \n    protected final class<?> findloadedclass(string name) {\n        if (!checkname(name))\n            return null;\n        return findloadedclass0(name);\n    }\n\n\n\n newinstance() \n\n    //  class.newinstance\n    @callersensitive\n    public t newinstance()\n        throws instantiationexception, illegalaccessexception\n    {\n        if (system.getsecuritymanager() != null) {\n            checkmemberaccess(member.public, reflection.getcallerclass(), false);\n        }\n\n        // note: the following code may not be strictly correct under\n        // the current java memory model.\n\n        // constructor lookup\n        // newinstance() \n        if (cachedconstructor == null) {\n            if (this == class.class) {\n                //  class  newinstance() \n                throw new illegalaccessexception(\n                    "can not call newinstance() on the class for java.lang.class"\n                );\n            }\n            try {\n                // \n                class<?>[] empty = {};\n                final constructor<t> c = getconstructor0(empty, member.declared);\n                // disable accessibility checks on the constructor\n                // since we have to do the security check here anyway\n                // (the stack depth is wrong for the constructor\'s\n                // security check to work)\n                java.security.accesscontroller.doprivileged(\n                    new java.security.privilegedaction<void>() {\n                        public void run() {\n                                c.setaccessible(true);\n                                return null;\n                            }\n                        });\n                cachedconstructor = c;\n            } catch (nosuchmethodexception e) {\n                throw (instantiationexception)\n                    new instantiationexception(getname()).initcause(e);\n            }\n        }\n        constructor<t> tmpconstructor = cachedconstructor;\n        // security check (same as in java.lang.reflect.constructor)\n        int modifiers = tmpconstructor.getmodifiers();\n        if (!reflection.quickcheckmemberaccess(this, modifiers)) {\n            class<?> caller = reflection.getcallerclass();\n            if (newinstancecallercache != caller) {\n                reflection.ensurememberaccess(caller, this, null, modifiers);\n                newinstancecallercache = caller;\n            }\n        }\n        // run constructor\n        try {\n            // \n            return tmpconstructor.newinstance((object[])null);\n        } catch (invocationtargetexception e) {\n            unsafe.getunsafe().throwexception(e.gettargetexception());\n            // not reached\n            return null;\n        }\n    }\n\n\nnewinstance() \n\n * 1. \n * 2. \n * 3. \n\n\n\n    private constructor<t> getconstructor0(class<?>[] parametertypes,\n                                        int which) throws nosuchmethodexception\n    {\n        // \n        constructor<t>[] constructors = privategetdeclaredconstructors((which == member.public));\n        for (constructor<t> constructor : constructors) {\n            if (arraycontentseq(parametertypes,\n                                constructor.getparametertypes())) {\n                return getreflectionfactory().copyconstructor(constructor);\n            }\n        }\n        throw new nosuchmethodexception(getname() + ".<init>" + argumenttypestostring(parametertypes));\n    }\n\n\ngetconstructor0() \n\n * 1. constructors, \n * 2.  reflectionfactory copyconstructor\n * 3.  nosuchmethodexception;\n\n\n    // jvm\n    // returns an array of "root" constructors. these constructor\n    // objects must not be propagated to the outside world, but must\n    // instead be copied via reflectionfactory.copyconstructor.\n    private constructor<t>[] privategetdeclaredconstructors(boolean publiconly) {\n        checkinitted();\n        constructor<t>[] res;\n        //  reflectiondata(), \n        reflectiondata<t> rd = reflectiondata();\n        if (rd != null) {\n            res = publiconly ? rd.publicconstructors : rd.declaredconstructors;\n            // \n            if (res != null) return res;\n        }\n        // no cached value available; request value from vm\n        if (isinterface()) {\n            @suppresswarnings("unchecked")\n            constructor<t>[] temporaryres = (constructor<t>[]) new constructor<?>[0];\n            res = temporaryres;\n        } else {\n            // nativejvm\n            res = getdeclaredconstructors0(publiconly);\n        }\n        if (rd != null) {\n            // jvm\n            if (publiconly) {\n                rd.publicconstructors = res;\n            } else {\n                rd.declaredconstructors = res;\n            }\n        }\n        return res;\n    }\n    \n    // lazily create and cache reflectiondata\n    private reflectiondata<t> reflectiondata() {\n        softreference<reflectiondata<t>> reflectiondata = this.reflectiondata;\n        int classredefinedcount = this.classredefinedcount;\n        reflectiondata<t> rd;\n        if (usecaches &&\n            reflectiondata != null &&\n            (rd = reflectiondata.get()) != null &&\n            rd.redefinedcount == classredefinedcount) {\n            return rd;\n        }\n        // else no softreference or cleared softreference or stale reflectiondata\n        // -> create and replace new instance\n        return newreflectiondata(reflectiondata, classredefinedcount);\n    }\n    \n    // \n    private reflectiondata<t> newreflectiondata(softreference<reflectiondata<t>> oldreflectiondata,\n                                                int classredefinedcount) {\n        if (!usecaches) return null;\n\n        // cas\n        while (true) {\n            reflectiondata<t> rd = new reflectiondata<>(classredefinedcount);\n            // try to cas it...\n            if (atomic.casreflectiondata(this, oldreflectiondata, new softreference<>(rd))) {\n                return rd;\n            }\n            // cas\n            oldreflectiondata = this.reflectiondata;\n            classredefinedcount = this.classredefinedcount;\n            if (oldreflectiondata != null &&\n                (rd = oldreflectiondata.get()) != null &&\n                rd.redefinedcount == classredefinedcount) {\n                return rd;\n            }\n        }\n    }\n\n\nprivategetdeclaredconstructors(), \n\n * 1. \n * 2. jvm\n\n relactiondata() reflectiondata \n\n\n    // reflection data that might get invalidated when jvm ti redefineclasses() is called\n    private static class reflectiondata<t> {\n        volatile field[] declaredfields;\n        volatile field[] publicfields;\n        volatile method[] declaredmethods;\n        volatile method[] publicmethods;\n        volatile constructor<t>[] declaredconstructors;\n        volatile constructor<t>[] publicconstructors;\n        // intermediate results for getfields and getmethods\n        volatile field[] declaredpublicfields;\n        volatile method[] declaredpublicmethods;\n        volatile class<?>[] interfaces;\n\n        // value of classredefinedcount when we created this reflectiondata instance\n        final int redefinedcount;\n\n        reflectiondata(int redefinedcount) {\n            this.redefinedcount = redefinedcount;\n        }\n    }\n\n\nfalse\n\n    private static boolean arraycontentseq(object[] a1, object[] a2) {\n        if (a1 == null) {\n            return a2 == null || a2.length == 0;\n        }\n\n        if (a2 == null) {\n            return a1.length == 0;\n        }\n\n        if (a1.length != a2.length) {\n            return false;\n        }\n\n        for (int i = 0; i < a1.length; i++) {\n            if (a1[i] != a2[i]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n    // sun.reflect.reflectionfactory\n    /** makes a copy of the passed constructor. the returned\n        constructor is a "child" of the passed one; see the comments\n        in constructor.java for details. */\n    public <t> constructor<t> copyconstructor(constructor<t> arg) {\n        return langreflectaccess().copyconstructor(arg);\n    }\n    \n    // java.lang.reflect.constructor, copy new constructor \n    constructor<t> copy() {\n        // this routine enables sharing of constructoraccessor objects\n        // among constructor objects which refer to the same underlying\n        // method in the vm. (all of this contortion is only necessary\n        // because of the "accessibility" bit in accessibleobject,\n        // which implicitly requires that new java.lang.reflect\n        // objects be fabricated for each reflective call on class\n        // objects.)\n        if (this.root != null)\n            throw new illegalargumentexception("can not copy a non-root constructor");\n\n        constructor<t> res = new constructor<>(clazz,\n                                               parametertypes,\n                                               exceptiontypes, modifiers, slot,\n                                               signature,\n                                               annotations,\n                                               parameterannotations);\n        // root  constructor\n        res.root = this;\n        // might as well eagerly propagate this if already present\n        res.constructoraccessor = constructoraccessor;\n        return res;\n    }\n\n\n constructor \n\n newinstance()\n\n    // return tmpconstructor.newinstance((object[])null); \n    // java.lang.reflect.constructor\n    @callersensitive\n    public t newinstance(object ... initargs)\n        throws instantiationexception, illegalaccessexception,\n               illegalargumentexception, invocationtargetexception\n    {\n        if (!override) {\n            if (!reflection.quickcheckmemberaccess(clazz, modifiers)) {\n                class<?> caller = reflection.getcallerclass();\n                checkaccess(caller, clazz, null, modifiers);\n            }\n        }\n        if ((clazz.getmodifiers() & modifier.enum) != 0)\n            throw new illegalargumentexception("cannot reflectively create enum objects");\n        constructoraccessor ca = constructoraccessor;   // read volatile\n        if (ca == null) {\n            ca = acquireconstructoraccessor();\n        }\n        @suppresswarnings("unchecked")\n        t inst = (t) ca.newinstance(initargs);\n        return inst;\n    }\n    // sun.reflect.delegatingconstructoraccessorimpl\n    public object newinstance(object[] args)\n      throws instantiationexception,\n             illegalargumentexception,\n             invocationtargetexception\n    {\n        return delegate.newinstance(args);\n    }\n    // sun.reflect.nativeconstructoraccessorimpl\n    public object newinstance(object[] args)\n        throws instantiationexception,\n               illegalargumentexception,\n               invocationtargetexception\n    {\n        // we can\'t inflate a constructor belonging to a vm-anonymous class\n        // because that kind of class can\'t be referred to by name, hence can\'t\n        // be found from the generated bytecode.\n        if (++numinvocations > reflectionfactory.inflationthreshold()\n                && !reflectutil.isvmanonymousclass(c.getdeclaringclass())) {\n            constructoraccessorimpl acc = (constructoraccessorimpl)\n                new methodaccessorgenerator().\n                    generateconstructor(c.getdeclaringclass(),\n                                        c.getparametertypes(),\n                                        c.getexceptiontypes(),\n                                        c.getmodifiers());\n            parent.setdelegate(acc);\n        }\n\n        // native constructor\n        return newinstance0(c, args);\n    }\n\n\n\n\n\n# \n\n *  method;\n\n    // java.lang.class\n    @callersensitive\n    public method getdeclaredmethod(string name, class<?>... parametertypes)\n        throws nosuchmethodexception, securityexception {\n        checkmemberaccess(member.declared, reflection.getcallerclass(), true);\n        method method = searchmethods(privategetdeclaredmethods(false), name, parametertypes);\n        if (method == null) {\n            throw new nosuchmethodexception(getname() + "." + name + argumenttypestostring(parametertypes));\n        }\n        return method;\n    }\n\n\n\n\n * 1. \n * 2. \n * 3. \n\n\n\n    // returns an array of "root" methods. these method objects must not\n    // be propagated to the outside world, but must instead be copied\n    // via reflectionfactory.copymethod.\n    private method[] privategetdeclaredmethods(boolean publiconly) {\n        checkinitted();\n        method[] res;\n        reflectiondata<t> rd = reflectiondata();\n        if (rd != null) {\n            res = publiconly ? rd.declaredpublicmethods : rd.declaredmethods;\n            if (res != null) return res;\n        }\n        // no cached value available; request value from vm\n        res = reflection.filtermethods(this, getdeclaredmethods0(publiconly));\n        if (rd != null) {\n            if (publiconly) {\n                rd.declaredpublicmethods = res;\n            } else {\n                rd.declaredmethods = res;\n            }\n        }\n        return res;\n    }\n\n\njvm\n\n reflection.filtermethods;\n\n\n    // sun.misc.reflection\n    public static method[] filtermethods(class<?> containingclass, method[] methods) {\n        if (methodfiltermap == null) {\n            // bootstrapping\n            return methods;\n        }\n        return (method[])filter(methods, methodfiltermap.get(containingclass));\n    }\n    //  registermethodstofilter(), ...\n    private static member[] filter(member[] members, string[] filterednames) {\n        if ((filterednames == null) || (members.length == 0)) {\n            return members;\n        }\n        int numnewmembers = 0;\n        for (member member : members) {\n            boolean shouldskip = false;\n            for (string filteredname : filterednames) {\n                if (member.getname() == filteredname) {\n                    shouldskip = true;\n                    break;\n                }\n            }\n            if (!shouldskip) {\n                ++numnewmembers;\n            }\n        }\n        member[] newmembers =\n            (member[])array.newinstance(members[0].getclass(), numnewmembers);\n        int destidx = 0;\n        for (member member : members) {\n            boolean shouldskip = false;\n            for (string filteredname : filterednames) {\n                if (member.getname() == filteredname) {\n                    shouldskip = true;\n                    break;\n                }\n            }\n            if (!shouldskip) {\n                newmembers[destidx++] = member;\n            }\n        }\n        return newmembers;\n    }\n\n\n\n * \n\n    private static method searchmethods(method[] methods,\n                                        string name,\n                                        class<?>[] parametertypes)\n    {\n        method res = null;\n        // string\n        string internedname = name.intern();\n        for (int i = 0; i < methods.length; i++) {\n            method m = methods[i];\n            if (m.getname() == internedname\n                && arraycontentseq(parametertypes, m.getparametertypes())\n                && (res == null\n                    || res.getreturntype().isassignablefrom(m.getreturntype())))\n                res = m;\n        }\n\n        return (res == null ? res : getreflectionfactory().copymethod(res));\n    }\n\n\n\n\n * for\n * \n *  reflectionfactory, copy \n\n\n#  method.invoke() \n\n    @callersensitive\n    public object invoke(object obj, object... args)\n        throws illegalaccessexception, illegalargumentexception,\n           invocationtargetexception\n    {\n        if (!override) {\n            if (!reflection.quickcheckmemberaccess(clazz, modifiers)) {\n                class<?> caller = reflection.getcallerclass();\n                checkaccess(caller, clazz, obj, modifiers);\n            }\n        }\n        methodaccessor ma = methodaccessor;             // read volatile\n        if (ma == null) {\n            ma = acquiremethodaccessor();\n        }\n        return ma.invoke(obj, args);\n    }\n\n\ninvoke methodaccessor  methodaccessor  acquiremethodaccessor() \n\n    // probably make the implementation more scalable.\n    private methodaccessor acquiremethodaccessor() {\n        // first check to see if one has been created yet, and take it\n        // if so\n        methodaccessor tmp = null;\n        if (root != null) tmp = root.getmethodaccessor();\n        if (tmp != null) {\n            //  methodaccessor reflectionfactory  methodaccessor\n            methodaccessor = tmp;\n        } else {\n            // otherwise fabricate one and propagate it up to the root\n            tmp = reflectionfactory.newmethodaccessor(this);\n            setmethodaccessor(tmp);\n        }\n\n        return tmp;\n    }\n    // sun.reflect.reflectionfactory\n    public methodaccessor newmethodaccessor(method method) {\n        checkinitted();\n\n        if (noinflation && !reflectutil.isvmanonymousclass(method.getdeclaringclass())) {\n            return new methodaccessorgenerator().\n                generatemethod(method.getdeclaringclass(),\n                               method.getname(),\n                               method.getparametertypes(),\n                               method.getreturntype(),\n                               method.getexceptiontypes(),\n                               method.getmodifiers());\n        } else {\n            nativemethodaccessorimpl acc =\n                new nativemethodaccessorimpl(method);\n            delegatingmethodaccessorimpl res =\n                new delegatingmethodaccessorimpl(acc);\n            acc.setparent(res);\n            return res;\n        }\n    }\n\n\naccessor\n\n\n//     nativemethodaccessorimpl / delegatingmethodaccessorimpl\nclass nativemethodaccessorimpl extends methodaccessorimpl {\n    private final method method;\n    private delegatingmethodaccessorimpl parent;\n    private int numinvocations;\n\n    nativemethodaccessorimpl(method method) {\n        this.method = method;\n    }\n\n    public object invoke(object obj, object[] args)\n        throws illegalargumentexception, invocationtargetexception\n    {\n        // we can\'t inflate methods belonging to vm-anonymous classes because\n        // that kind of class can\'t be referred to by name, hence can\'t be\n        // found from the generated bytecode.\n        if (++numinvocations > reflectionfactory.inflationthreshold()\n                && !reflectutil.isvmanonymousclass(method.getdeclaringclass())) {\n            methodaccessorimpl acc = (methodaccessorimpl)\n                new methodaccessorgenerator().\n                    generatemethod(method.getdeclaringclass(),\n                                   method.getname(),\n                                   method.getparametertypes(),\n                                   method.getreturntype(),\n                                   method.getexceptiontypes(),\n                                   method.getmodifiers());\n            parent.setdelegate(acc);\n        }\n\n        return invoke0(method, obj, args);\n    }\n\n    void setparent(delegatingmethodaccessorimpl parent) {\n        this.parent = parent;\n    }\n\n    private static native object invoke0(method m, object obj, object[] args);\n}\nclass delegatingmethodaccessorimpl extends methodaccessorimpl {\n    private methodaccessorimpl delegate;\n\n    delegatingmethodaccessorimpl(methodaccessorimpl delegate) {\n        setdelegate(delegate);\n    }\n\n    public object invoke(object obj, object[] args)\n        throws illegalargumentexception, invocationtargetexception\n    {\n        return delegate.invoke(obj, args);\n    }\n\n    void setdelegate(methodaccessorimpl delegate) {\n        this.delegate = delegate;\n    }\n}\n\n\n ma.invoke(obj, args);  delegatingmethodaccessorimpl.invoke();\n\n nativemethodaccessorimpl.invoke(), \n\n    public object invoke(object obj, object[] args)\n        throws illegalargumentexception, invocationtargetexception\n    {\n        // we can\'t inflate methods belonging to vm-anonymous classes because\n        // that kind of class can\'t be referred to by name, hence can\'t be\n        // found from the generated bytecode.\n        if (++numinvocations > reflectionfactory.inflationthreshold()\n                && !reflectutil.isvmanonymousclass(method.getdeclaringclass())) {\n            methodaccessorimpl acc = (methodaccessorimpl)\n                new methodaccessorgenerator().\n                    generatemethod(method.getdeclaringclass(),\n                                   method.getname(),\n                                   method.getparametertypes(),\n                                   method.getreturntype(),\n                                   method.getexceptiontypes(),\n                                   method.getmodifiers());\n            parent.setdelegate(acc);\n        }\n\n        // invoke0  native jvm\n        return invoke0(method, obj, args);\n    }\n\n\n generatemethod() \n\n    /** this routine is not thread-safe */\n    public methodaccessor generatemethod(class<?> declaringclass,\n                                         string   name,\n                                         class<?>[] parametertypes,\n                                         class<?>   returntype,\n                                         class<?>[] checkedexceptions,\n                                         int modifiers)\n    {\n        return (methodaccessor) generate(declaringclass,\n                                         name,\n                                         parametertypes,\n                                         returntype,\n                                         checkedexceptions,\n                                         modifiers,\n                                         false,\n                                         false,\n                                         null);\n    }\n\n\ngenerate() \n\n    /** this routine is not thread-safe */\n    private magicaccessorimpl generate(final class<?> declaringclass,\n                                       string name,\n                                       class<?>[] parametertypes,\n                                       class<?>   returntype,\n                                       class<?>[] checkedexceptions,\n                                       int modifiers,\n                                       boolean isconstructor,\n                                       boolean forserialization,\n                                       class<?> serializationtargetclass)\n    {\n        bytevector vec = bytevectorfactory.create();\n        asm = new classfileassembler(vec);\n        this.declaringclass = declaringclass;\n        this.parametertypes = parametertypes;\n        this.returntype = returntype;\n        this.modifiers = modifiers;\n        this.isconstructor = isconstructor;\n        this.forserialization = forserialization;\n\n        asm.emitmagicandversion();\n\n        // constant pool entries:\n        // ( * = boxing information: optional)\n        // (+  = shared entries provided by accessorgenerator)\n        // (^  = only present if generating serializationconstructoraccessor)\n        //     [utf-8] [this class\'s name]\n        //     [constant_class_info] for above\n        //     [utf-8] "sun/reflect/{methodaccessorimpl,constructoraccessorimpl,serializationconstructoraccessorimpl}"\n        //     [constant_class_info] for above\n        //     [utf-8] [target class\'s name]\n        //     [constant_class_info] for above\n        // ^   [utf-8] [serialization: class\'s name in which to invoke constructor]\n        // ^   [constant_class_info] for above\n        //     [utf-8] target method or constructor name\n        //     [utf-8] target method or constructor signature\n        //     [constant_nameandtype_info] for above\n        //     [constant_methodref_info or constant_interfacemethodref_info] for target method\n        //     [utf-8] "invoke" or "newinstance"\n        //     [utf-8] invoke or newinstance descriptor\n        //     [utf-8] descriptor for type of non-primitive parameter 1\n        //     [constant_class_info] for type of non-primitive parameter 1\n        //     ...\n        //     [utf-8] descriptor for type of non-primitive parameter n\n        //     [constant_class_info] for type of non-primitive parameter n\n        // +   [utf-8] "java/lang/exception"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "java/lang/classcastexception"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "java/lang/nullpointerexception"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "java/lang/illegalargumentexception"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "java/lang/invocationtargetexception"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "<init>"\n        // +   [utf-8] "()v"\n        // +   [constant_nameandtype_info] for above\n        // +   [constant_methodref_info] for nullpointerexception\'s constructor\n        // +   [constant_methodref_info] for illegalargumentexception\'s constructor\n        // +   [utf-8] "(ljava/lang/string;)v"\n        // +   [constant_nameandtype_info] for "<init>(ljava/lang/string;)v"\n        // +   [constant_methodref_info] for illegalargumentexception\'s constructor taking a string\n        // +   [utf-8] "(ljava/lang/throwable;)v"\n        // +   [constant_nameandtype_info] for "<init>(ljava/lang/throwable;)v"\n        // +   [constant_methodref_info] for invocationtargetexception\'s constructor\n        // +   [constant_methodref_info] for "super()"\n        // +   [utf-8] "java/lang/object"\n        // +   [constant_class_info] for above\n        // +   [utf-8] "tostring"\n        // +   [utf-8] "()ljava/lang/string;"\n        // +   [constant_nameandtype_info] for "tostring()ljava/lang/string;"\n        // +   [constant_methodref_info] for object\'s tostring method\n        // +   [utf-8] "code"\n        // +   [utf-8] "exceptions"\n        //  *  [utf-8] "java/lang/boolean"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(z)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "booleanvalue"\n        //  *  [utf-8] "()z"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/byte"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(b)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "bytevalue"\n        //  *  [utf-8] "()b"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/character"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(c)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "charvalue"\n        //  *  [utf-8] "()c"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/double"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(d)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "doublevalue"\n        //  *  [utf-8] "()d"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/float"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(f)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "floatvalue"\n        //  *  [utf-8] "()f"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/integer"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(i)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "intvalue"\n        //  *  [utf-8] "()i"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/long"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(j)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "longvalue"\n        //  *  [utf-8] "()j"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "java/lang/short"\n        //  *  [constant_class_info] for above\n        //  *  [utf-8] "(s)v"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n        //  *  [utf-8] "shortvalue"\n        //  *  [utf-8] "()s"\n        //  *  [constant_nameandtype_info] for above\n        //  *  [constant_methodref_info] for above\n\n        short numcpentries = num_base_cpool_entries + num_common_cpool_entries;\n        boolean usesprimitives = usesprimitivetypes();\n        if (usesprimitives) {\n            numcpentries += num_boxing_cpool_entries;\n        }\n        if (forserialization) {\n            numcpentries += num_serialization_cpool_entries;\n        }\n\n        // add in variable-length number of entries to be able to describe\n        // non-primitive parameter types and checked exceptions.\n        numcpentries += (short) (2 * numnonprimitiveparametertypes());\n\n        asm.emitshort(add(numcpentries, s1));\n\n        final string generatedname = generatename(isconstructor, forserialization);\n        asm.emitconstantpoolutf8(generatedname);\n        asm.emitconstantpoolclass(asm.cpi());\n        thisclass = asm.cpi();\n        if (isconstructor) {\n            if (forserialization) {\n                asm.emitconstantpoolutf8\n                    ("sun/reflect/serializationconstructoraccessorimpl");\n            } else {\n                asm.emitconstantpoolutf8("sun/reflect/constructoraccessorimpl");\n            }\n        } else {\n            asm.emitconstantpoolutf8("sun/reflect/methodaccessorimpl");\n        }\n        asm.emitconstantpoolclass(asm.cpi());\n        superclass = asm.cpi();\n        asm.emitconstantpoolutf8(getclassname(declaringclass, false));\n        asm.emitconstantpoolclass(asm.cpi());\n        targetclass = asm.cpi();\n        short serializationtargetclassidx = (short) 0;\n        if (forserialization) {\n            asm.emitconstantpoolutf8(getclassname(serializationtargetclass, false));\n            asm.emitconstantpoolclass(asm.cpi());\n            serializationtargetclassidx = asm.cpi();\n        }\n        asm.emitconstantpoolutf8(name);\n        asm.emitconstantpoolutf8(buildinternalsignature());\n        asm.emitconstantpoolnameandtype(sub(asm.cpi(), s1), asm.cpi());\n        if (isinterface()) {\n            asm.emitconstantpoolinterfacemethodref(targetclass, asm.cpi());\n        } else {\n            if (forserialization) {\n                asm.emitconstantpoolmethodref(serializationtargetclassidx, asm.cpi());\n            } else {\n                asm.emitconstantpoolmethodref(targetclass, asm.cpi());\n            }\n        }\n        targetmethodref = asm.cpi();\n        if (isconstructor) {\n            asm.emitconstantpoolutf8("newinstance");\n        } else {\n            asm.emitconstantpoolutf8("invoke");\n        }\n        invokeidx = asm.cpi();\n        if (isconstructor) {\n            asm.emitconstantpoolutf8("([ljava/lang/object;)ljava/lang/object;");\n        } else {\n            asm.emitconstantpoolutf8\n                ("(ljava/lang/object;[ljava/lang/object;)ljava/lang/object;");\n        }\n        invokedescriptoridx = asm.cpi();\n\n        // output class information for non-primitive parameter types\n        nonprimitiveparametersbaseidx = add(asm.cpi(), s2);\n        for (int i = 0; i < parametertypes.length; i++) {\n            class<?> c = parametertypes[i];\n            if (!isprimitive(c)) {\n                asm.emitconstantpoolutf8(getclassname(c, false));\n                asm.emitconstantpoolclass(asm.cpi());\n            }\n        }\n\n        // entries common to fieldaccessor, methodaccessor and constructoraccessor\n        emitcommonconstantpoolentries();\n\n        // boxing entries\n        if (usesprimitives) {\n            emitboxingcontantpoolentries();\n        }\n\n        if (asm.cpi() != numcpentries) {\n            throw new internalerror("adjust this code (cpi = " + asm.cpi() +\n                                    ", numcpentries = " + numcpentries + ")");\n        }\n\n        // access flags\n        asm.emitshort(acc_public);\n\n        // this class\n        asm.emitshort(thisclass);\n\n        // superclass\n        asm.emitshort(superclass);\n\n        // interfaces count and interfaces\n        asm.emitshort(s0);\n\n        // fields count and fields\n        asm.emitshort(s0);\n\n        // methods count and methods\n        asm.emitshort(num_methods);\n\n        emitconstructor();\n        emitinvoke();\n\n        // additional attributes (none)\n        asm.emitshort(s0);\n\n        // load class\n        vec.trim();\n        final byte[] bytes = vec.getdata();\n        // note: the class loader is the only thing that really matters\n        // here -- it\'s important to get the generated code into the\n        // same namespace as the target class. since the generated code\n        // is privileged anyway, the protection domain probably doesn\'t\n        // matter.\n        return accesscontroller.doprivileged(\n            new privilegedaction<magicaccessorimpl>() {\n                public magicaccessorimpl run() {\n                        try {\n                        return (magicaccessorimpl)\n                        classdefiner.defineclass\n                                (generatedname,\n                                 bytes,\n                                 0,\n                                 bytes.length,\n                                 declaringclass.getclassloader()).newinstance();\n                        } catch (instantiationexception | illegalaccessexception e) {\n                            throw new internalerror(e);\n                        }\n                    }\n                });\n    }\n\n\nclassdefiner.defineclass(xx, declaringclass.getclassloader()).newinstance();\n\nclassdefiner.defineclassdelegatingclassloader \n\n\n\n\n# \n\n\n\n 1. \n\n 2. classmethod\n\n 3. \n\n 4. relectiondataclassjvm\n\n 5. accessor, \n\n 6. copy\n\n 7. jvminvoke0()\n\n\n# \n\n * https://www.codercto.com/a/46094.html\n * https://blog.csdn.net/sinat_38259539/article/details/71799078\n * https://blog.csdn.net/qq_40896997/article/details/94483820\n * https://www.cnblogs.com/zhaoguhong/p/6937364.html\n * https://juejin.im/post/5c160420e51d452a60684431\n * https://blog.csdn.net/mcryeasy/java/article/details/52344729\n *  https://www.pdai.tech/md/java/basic/java-basic-x-reflection.html',charsets:{cjk:!0}},{title:"Collection - ArrayList ",frontmatter:{},regularPath:"/java/collection/java-collection-ArrayList.html",relativePath:"java/collection/java-collection-ArrayList.md",key:"v-38eee2e4",path:"/java/collection/java-collection-ArrayList.html",headers:[{level:2,title:"Collection - ArrayList ",slug:"collection-arraylist-",normalizedTitle:"collection - arraylist ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:105},{level:2,title:"ArrayList",slug:"arraylist",normalizedTitle:"arraylist",charIndex:113},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:133},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:147},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:159},{level:3,title:"add(), addAll()",slug:"add-addall",normalizedTitle:"add(), addall()",charIndex:171},{level:3,title:"set()",slug:"set",normalizedTitle:"set()",charIndex:194},{level:3,title:"get()",slug:"get",normalizedTitle:"get()",charIndex:207},{level:3,title:"remove()",slug:"remove",normalizedTitle:"remove()",charIndex:220},{level:3,title:"trimToSize()",slug:"trimtosize",normalizedTitle:"trimtosize()",charIndex:236},{level:3,title:"indexOf(), lastIndexOf()",slug:"indexof-lastindexof",normalizedTitle:"indexof(), lastindexof()",charIndex:256},{level:3,title:"Fail-Fast:",slug:"fail-fast",normalizedTitle:"fail-fast:",charIndex:288},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:306}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Collection - ArrayList   ArrayList    add(), addAll() set() get() remove() trimToSize() indexOf(), lastIndexOf() Fail-Fast: ",content:"# Collection - ArrayList \n\n> Collection - ArrayList\n\n * Collection - ArrayList \n   * \n   * ArrayList\n     * \n     * \n     * \n     * add(), addAll()\n     * set()\n     * get()\n     * remove()\n     * trimToSize()\n     * indexOf(), lastIndexOf()\n     * Fail-Fast:\n   * \n\n\n# \n\n_ArrayList__List_null_Vector__ArrayList_(capacity)JavaObject\n\n\n\nsize(), isEmpty(), get(), set()add()addAll()\n\nArrayList(synchronized)Vector\n\n\n# ArrayList\n\n\n# \n\n/**\n     * The array buffer into which the elements of the ArrayList are stored.\n     * The capacity of the ArrayList is the length of this array buffer. Any\n     * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA\n     * will be expanded to DEFAULT_CAPACITY when the first element is added.\n     */\n    transient Object[] elementData; // non-private to simplify nested class access\n\n    /**\n     * The size of the ArrayList (the number of elements it contains).\n     *\n     * @serial\n     */\n    private int size;\n\n\n\n# \n\n/**\n     * Constructs an empty list with the specified initial capacity.\n     *\n     * @param  initialCapacity  the initial capacity of the list\n     * @throws IllegalArgumentException if the specified initial capacity\n     *         is negative\n     */\n    public ArrayList(int initialCapacity) {\n        if (initialCapacity > 0) {\n            this.elementData = new Object[initialCapacity];\n        } else if (initialCapacity == 0) {\n            this.elementData = EMPTY_ELEMENTDATA;\n        } else {\n            throw new IllegalArgumentException(\"Illegal Capacity: \"+\n                                               initialCapacity);\n        }\n    }\n\n    /**\n     * Constructs an empty list with an initial capacity of ten.\n     */\n    public ArrayList() {\n        this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n    }\n\n    /**\n     * Constructs a list containing the elements of the specified\n     * collection, in the order they are returned by the collection's\n     * iterator.\n     *\n     * @param c the collection whose elements are to be placed into this list\n     * @throws NullPointerException if the specified collection is null\n     */\n    public ArrayList(Collection<? extends E> c) {\n        elementData = c.toArray();\n        if ((size = elementData.length) != 0) {\n            // c.toArray might (incorrectly) not return Object[] (see 6260652)\n            if (elementData.getClass() != Object[].class)\n                elementData = Arrays.copyOf(elementData, size, Object[].class);\n        } else {\n            // replace with empty array.\n            this.elementData = EMPTY_ELEMENTDATA;\n        }\n    }\n\n\n\n# \n\nensureCapacity(int minCapacity)ensureCapacityArrayList\n\n1.5ArrayListensureCapacityArrayList\n\n    /**\n     * Increases the capacity of this <tt>ArrayList</tt> instance, if\n     * necessary, to ensure that it can hold at least the number of elements\n     * specified by the minimum capacity argument.\n     *\n     * @param   minCapacity   the desired minimum capacity\n     */\n    public void ensureCapacity(int minCapacity) {\n        int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)\n            // any size if not default element table\n            ? 0\n            // larger than default for default empty table. It's already\n            // supposed to be at default size.\n            : DEFAULT_CAPACITY;\n\n        if (minCapacity > minExpand) {\n            ensureExplicitCapacity(minCapacity);\n        }\n    }\n\n    private void ensureCapacityInternal(int minCapacity) {\n        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n        }\n\n        ensureExplicitCapacity(minCapacity);\n    }\n\n    private void ensureExplicitCapacity(int minCapacity) {\n        modCount++;\n\n        // overflow-conscious code\n        if (minCapacity - elementData.length > 0)\n            grow(minCapacity);\n    }\n\n    /**\n     * The maximum size of array to allocate.\n     * Some VMs reserve some header words in an array.\n     * Attempts to allocate larger arrays may result in\n     * OutOfMemoryError: Requested array size exceeds VM limit\n     */\n    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n\n    /**\n     * Increases the capacity to ensure that it can hold at least the\n     * number of elements specified by the minimum capacity argument.\n     *\n     * @param minCapacity the desired minimum capacity\n     */\n    private void grow(int minCapacity) {\n        // overflow-conscious code\n        int oldCapacity = elementData.length;\n        int newCapacity = oldCapacity + (oldCapacity >> 1);\n        if (newCapacity - minCapacity < 0)\n            newCapacity = minCapacity;\n        if (newCapacity - MAX_ARRAY_SIZE > 0)\n            newCapacity = hugeCapacity(minCapacity);\n        // minCapacity is usually close to size, so this is a win:\n        elementData = Arrays.copyOf(elementData, newCapacity);\n    }\n\n    private static int hugeCapacity(int minCapacity) {\n        if (minCapacity < 0) // overflow\n            throw new OutOfMemoryError();\n        return (minCapacity > MAX_ARRAY_SIZE) ?\n            Integer.MAX_VALUE :\n            MAX_ARRAY_SIZE;\n    }\n\n\n\n\n\n# add(), addAll()\n\nC++ _vector__ArrayList_push_back()add(E e)_ArrayList_insert()add(int index, E e)_capacity_grow()\n\n    /**\n     * Appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return <tt>true</tt> (as specified by {@link Collection#add})\n     */\n    public boolean add(E e) {\n        ensureCapacityInternal(size + 1);  // Increments modCount!!\n        elementData[size++] = e;\n        return true;\n    }\n\n    /**\n     * Inserts the specified element at the specified position in this\n     * list. Shifts the element currently at that position (if any) and\n     * any subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     */\n    public void add(int index, E element) {\n        rangeCheckForAdd(index);\n\n        ensureCapacityInternal(size + 1);  // Increments modCount!!\n        System.arraycopy(elementData, index, elementData, index + 1,\n                         size - index);\n        elementData[index] = element;\n        size++;\n    }\n\n\n\n\nadd(int index, E e)\n\naddAll()addAll(Collection<? extends E> c)addAll(int index, Collection<? extends E> c)add() addAll()\n\n    /**\n     * Appends all of the elements in the specified collection to the end of\n     * this list, in the order that they are returned by the\n     * specified collection's Iterator.  The behavior of this operation is\n     * undefined if the specified collection is modified while the operation\n     * is in progress.  (This implies that the behavior of this call is\n     * undefined if the specified collection is this list, and this\n     * list is nonempty.)\n     *\n     * @param c collection containing elements to be added to this list\n     * @return <tt>true</tt> if this list changed as a result of the call\n     * @throws NullPointerException if the specified collection is null\n     */\n    public boolean addAll(Collection<? extends E> c) {\n        Object[] a = c.toArray();\n        int numNew = a.length;\n        ensureCapacityInternal(size + numNew);  // Increments modCount\n        System.arraycopy(a, 0, elementData, size, numNew);\n        size += numNew;\n        return numNew != 0;\n    }\n\n    /**\n     * Inserts all of the elements in the specified collection into this\n     * list, starting at the specified position.  Shifts the element\n     * currently at that position (if any) and any subsequent elements to\n     * the right (increases their indices).  The new elements will appear\n     * in the list in the order that they are returned by the\n     * specified collection's iterator.\n     *\n     * @param index index at which to insert the first element from the\n     *              specified collection\n     * @param c collection containing elements to be added to this list\n     * @return <tt>true</tt> if this list changed as a result of the call\n     * @throws IndexOutOfBoundsException {@inheritDoc}\n     * @throws NullPointerException if the specified collection is null\n     */\n    public boolean addAll(int index, Collection<? extends E> c) {\n        rangeCheckForAdd(index);\n\n        Object[] a = c.toArray();\n        int numNew = a.length;\n        ensureCapacityInternal(size + numNew);  // Increments modCount\n\n        int numMoved = size - index;\n        if (numMoved > 0)\n            System.arraycopy(elementData, index, elementData, index + numNew,\n                             numMoved);\n\n        System.arraycopy(a, 0, elementData, index, numNew);\n        size += numNew;\n        return numNew != 0;\n    }\n\n\n\n# set()\n\n_ArrayList_set()\n\npublic E set(int index, E element) {\n    rangeCheck(index);//\n    E oldValue = elementData(index);\n    elementData[index] = element;//\n    return oldValue;\n}\n\n\n\n# get()\n\nget()Object[]\n\npublic E get(int index) {\n    rangeCheck(index);\n    return (E) elementData[index];//\n}\n\n\n\n# remove()\n\nremove()remove(int index)remove(Object o)o.equals(elementData[index])add()GCnull\n\npublic E remove(int index) {\n    rangeCheck(index);\n    modCount++;\n    E oldValue = elementData(index);\n    int numMoved = size - index - 1;\n    if (numMoved > 0)\n        System.arraycopy(elementData, index+1, elementData, index, numMoved);\n    elementData[--size] = null; //GC\n    return oldValue;\n}\n\n\nJava GCGCnull\n\n\n# trimToSize()\n\nArrayListtrimToSize:\n\n    /**\n     * Trims the capacity of this <tt>ArrayList</tt> instance to be the\n     * list's current size.  An application can use this operation to minimize\n     * the storage of an <tt>ArrayList</tt> instance.\n     */\n    public void trimToSize() {\n        modCount++;\n        if (size < elementData.length) {\n            elementData = (size == 0)\n              ? EMPTY_ELEMENTDATA\n              : Arrays.copyOf(elementData, size);\n        }\n    }\n\n\n\n# indexOf(), lastIndexOf()\n\nindex:\n\n/**\n     * Returns the index of the first occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * More formally, returns the lowest index <tt>i</tt> such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     */\n    public int indexOf(Object o) {\n        if (o == null) {\n            for (int i = 0; i < size; i++)\n                if (elementData[i]==null)\n                    return i;\n        } else {\n            for (int i = 0; i < size; i++)\n                if (o.equals(elementData[i]))\n                    return i;\n        }\n        return -1;\n    }\n\n\nindex:\n\n    /**\n     * Returns the index of the last occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * More formally, returns the highest index <tt>i</tt> such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     */\n    public int lastIndexOf(Object o) {\n        if (o == null) {\n            for (int i = size-1; i >= 0; i--)\n                if (elementData[i]==null)\n                    return i;\n        } else {\n            for (int i = size-1; i >= 0; i--)\n                if (o.equals(elementData[i]))\n                    return i;\n        }\n        return -1;\n    }\n\n\n\n# Fail-Fast:\n\nArrayListmodCount\n\n\n# \n\n * Java: ArrayList http://zhangshixi.iteye.com/blog/674856\n * Java ArrayList ArrayList http://www.cnblogs.com/CarpenterLee/p/5419880.html\n *  https://www.pdai.tech/md/java/collection/java-collection-ArrayList.html",normalizedContent:"# collection - arraylist \n\n> collection - arraylist\n\n * collection - arraylist \n   * \n   * arraylist\n     * \n     * \n     * \n     * add(), addall()\n     * set()\n     * get()\n     * remove()\n     * trimtosize()\n     * indexof(), lastindexof()\n     * fail-fast:\n   * \n\n\n# \n\n_arraylist__list_null_vector__arraylist_(capacity)javaobject\n\n\n\nsize(), isempty(), get(), set()add()addall()\n\narraylist(synchronized)vector\n\n\n# arraylist\n\n\n# \n\n/**\n     * the array buffer into which the elements of the arraylist are stored.\n     * the capacity of the arraylist is the length of this array buffer. any\n     * empty arraylist with elementdata == defaultcapacity_empty_elementdata\n     * will be expanded to default_capacity when the first element is added.\n     */\n    transient object[] elementdata; // non-private to simplify nested class access\n\n    /**\n     * the size of the arraylist (the number of elements it contains).\n     *\n     * @serial\n     */\n    private int size;\n\n\n\n# \n\n/**\n     * constructs an empty list with the specified initial capacity.\n     *\n     * @param  initialcapacity  the initial capacity of the list\n     * @throws illegalargumentexception if the specified initial capacity\n     *         is negative\n     */\n    public arraylist(int initialcapacity) {\n        if (initialcapacity > 0) {\n            this.elementdata = new object[initialcapacity];\n        } else if (initialcapacity == 0) {\n            this.elementdata = empty_elementdata;\n        } else {\n            throw new illegalargumentexception(\"illegal capacity: \"+\n                                               initialcapacity);\n        }\n    }\n\n    /**\n     * constructs an empty list with an initial capacity of ten.\n     */\n    public arraylist() {\n        this.elementdata = defaultcapacity_empty_elementdata;\n    }\n\n    /**\n     * constructs a list containing the elements of the specified\n     * collection, in the order they are returned by the collection's\n     * iterator.\n     *\n     * @param c the collection whose elements are to be placed into this list\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public arraylist(collection<? extends e> c) {\n        elementdata = c.toarray();\n        if ((size = elementdata.length) != 0) {\n            // c.toarray might (incorrectly) not return object[] (see 6260652)\n            if (elementdata.getclass() != object[].class)\n                elementdata = arrays.copyof(elementdata, size, object[].class);\n        } else {\n            // replace with empty array.\n            this.elementdata = empty_elementdata;\n        }\n    }\n\n\n\n# \n\nensurecapacity(int mincapacity)ensurecapacityarraylist\n\n1.5arraylistensurecapacityarraylist\n\n    /**\n     * increases the capacity of this <tt>arraylist</tt> instance, if\n     * necessary, to ensure that it can hold at least the number of elements\n     * specified by the minimum capacity argument.\n     *\n     * @param   mincapacity   the desired minimum capacity\n     */\n    public void ensurecapacity(int mincapacity) {\n        int minexpand = (elementdata != defaultcapacity_empty_elementdata)\n            // any size if not default element table\n            ? 0\n            // larger than default for default empty table. it's already\n            // supposed to be at default size.\n            : default_capacity;\n\n        if (mincapacity > minexpand) {\n            ensureexplicitcapacity(mincapacity);\n        }\n    }\n\n    private void ensurecapacityinternal(int mincapacity) {\n        if (elementdata == defaultcapacity_empty_elementdata) {\n            mincapacity = math.max(default_capacity, mincapacity);\n        }\n\n        ensureexplicitcapacity(mincapacity);\n    }\n\n    private void ensureexplicitcapacity(int mincapacity) {\n        modcount++;\n\n        // overflow-conscious code\n        if (mincapacity - elementdata.length > 0)\n            grow(mincapacity);\n    }\n\n    /**\n     * the maximum size of array to allocate.\n     * some vms reserve some header words in an array.\n     * attempts to allocate larger arrays may result in\n     * outofmemoryerror: requested array size exceeds vm limit\n     */\n    private static final int max_array_size = integer.max_value - 8;\n\n    /**\n     * increases the capacity to ensure that it can hold at least the\n     * number of elements specified by the minimum capacity argument.\n     *\n     * @param mincapacity the desired minimum capacity\n     */\n    private void grow(int mincapacity) {\n        // overflow-conscious code\n        int oldcapacity = elementdata.length;\n        int newcapacity = oldcapacity + (oldcapacity >> 1);\n        if (newcapacity - mincapacity < 0)\n            newcapacity = mincapacity;\n        if (newcapacity - max_array_size > 0)\n            newcapacity = hugecapacity(mincapacity);\n        // mincapacity is usually close to size, so this is a win:\n        elementdata = arrays.copyof(elementdata, newcapacity);\n    }\n\n    private static int hugecapacity(int mincapacity) {\n        if (mincapacity < 0) // overflow\n            throw new outofmemoryerror();\n        return (mincapacity > max_array_size) ?\n            integer.max_value :\n            max_array_size;\n    }\n\n\n\n\n\n# add(), addall()\n\nc++ _vector__arraylist_push_back()add(e e)_arraylist_insert()add(int index, e e)_capacity_grow()\n\n    /**\n     * appends the specified element to the end of this list.\n     *\n     * @param e element to be appended to this list\n     * @return <tt>true</tt> (as specified by {@link collection#add})\n     */\n    public boolean add(e e) {\n        ensurecapacityinternal(size + 1);  // increments modcount!!\n        elementdata[size++] = e;\n        return true;\n    }\n\n    /**\n     * inserts the specified element at the specified position in this\n     * list. shifts the element currently at that position (if any) and\n     * any subsequent elements to the right (adds one to their indices).\n     *\n     * @param index index at which the specified element is to be inserted\n     * @param element element to be inserted\n     * @throws indexoutofboundsexception {@inheritdoc}\n     */\n    public void add(int index, e element) {\n        rangecheckforadd(index);\n\n        ensurecapacityinternal(size + 1);  // increments modcount!!\n        system.arraycopy(elementdata, index, elementdata, index + 1,\n                         size - index);\n        elementdata[index] = element;\n        size++;\n    }\n\n\n\n\nadd(int index, e e)\n\naddall()addall(collection<? extends e> c)addall(int index, collection<? extends e> c)add() addall()\n\n    /**\n     * appends all of the elements in the specified collection to the end of\n     * this list, in the order that they are returned by the\n     * specified collection's iterator.  the behavior of this operation is\n     * undefined if the specified collection is modified while the operation\n     * is in progress.  (this implies that the behavior of this call is\n     * undefined if the specified collection is this list, and this\n     * list is nonempty.)\n     *\n     * @param c collection containing elements to be added to this list\n     * @return <tt>true</tt> if this list changed as a result of the call\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public boolean addall(collection<? extends e> c) {\n        object[] a = c.toarray();\n        int numnew = a.length;\n        ensurecapacityinternal(size + numnew);  // increments modcount\n        system.arraycopy(a, 0, elementdata, size, numnew);\n        size += numnew;\n        return numnew != 0;\n    }\n\n    /**\n     * inserts all of the elements in the specified collection into this\n     * list, starting at the specified position.  shifts the element\n     * currently at that position (if any) and any subsequent elements to\n     * the right (increases their indices).  the new elements will appear\n     * in the list in the order that they are returned by the\n     * specified collection's iterator.\n     *\n     * @param index index at which to insert the first element from the\n     *              specified collection\n     * @param c collection containing elements to be added to this list\n     * @return <tt>true</tt> if this list changed as a result of the call\n     * @throws indexoutofboundsexception {@inheritdoc}\n     * @throws nullpointerexception if the specified collection is null\n     */\n    public boolean addall(int index, collection<? extends e> c) {\n        rangecheckforadd(index);\n\n        object[] a = c.toarray();\n        int numnew = a.length;\n        ensurecapacityinternal(size + numnew);  // increments modcount\n\n        int nummoved = size - index;\n        if (nummoved > 0)\n            system.arraycopy(elementdata, index, elementdata, index + numnew,\n                             nummoved);\n\n        system.arraycopy(a, 0, elementdata, index, numnew);\n        size += numnew;\n        return numnew != 0;\n    }\n\n\n\n# set()\n\n_arraylist_set()\n\npublic e set(int index, e element) {\n    rangecheck(index);//\n    e oldvalue = elementdata(index);\n    elementdata[index] = element;//\n    return oldvalue;\n}\n\n\n\n# get()\n\nget()object[]\n\npublic e get(int index) {\n    rangecheck(index);\n    return (e) elementdata[index];//\n}\n\n\n\n# remove()\n\nremove()remove(int index)remove(object o)o.equals(elementdata[index])add()gcnull\n\npublic e remove(int index) {\n    rangecheck(index);\n    modcount++;\n    e oldvalue = elementdata(index);\n    int nummoved = size - index - 1;\n    if (nummoved > 0)\n        system.arraycopy(elementdata, index+1, elementdata, index, nummoved);\n    elementdata[--size] = null; //gc\n    return oldvalue;\n}\n\n\njava gcgcnull\n\n\n# trimtosize()\n\narraylisttrimtosize:\n\n    /**\n     * trims the capacity of this <tt>arraylist</tt> instance to be the\n     * list's current size.  an application can use this operation to minimize\n     * the storage of an <tt>arraylist</tt> instance.\n     */\n    public void trimtosize() {\n        modcount++;\n        if (size < elementdata.length) {\n            elementdata = (size == 0)\n              ? empty_elementdata\n              : arrays.copyof(elementdata, size);\n        }\n    }\n\n\n\n# indexof(), lastindexof()\n\nindex:\n\n/**\n     * returns the index of the first occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * more formally, returns the lowest index <tt>i</tt> such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     */\n    public int indexof(object o) {\n        if (o == null) {\n            for (int i = 0; i < size; i++)\n                if (elementdata[i]==null)\n                    return i;\n        } else {\n            for (int i = 0; i < size; i++)\n                if (o.equals(elementdata[i]))\n                    return i;\n        }\n        return -1;\n    }\n\n\nindex:\n\n    /**\n     * returns the index of the last occurrence of the specified element\n     * in this list, or -1 if this list does not contain the element.\n     * more formally, returns the highest index <tt>i</tt> such that\n     * <tt>(o==null&nbsp;?&nbsp;get(i)==null&nbsp;:&nbsp;o.equals(get(i)))</tt>,\n     * or -1 if there is no such index.\n     */\n    public int lastindexof(object o) {\n        if (o == null) {\n            for (int i = size-1; i >= 0; i--)\n                if (elementdata[i]==null)\n                    return i;\n        } else {\n            for (int i = size-1; i >= 0; i--)\n                if (o.equals(elementdata[i]))\n                    return i;\n        }\n        return -1;\n    }\n\n\n\n# fail-fast:\n\narraylistmodcount\n\n\n# \n\n * java: arraylist http://zhangshixi.iteye.com/blog/674856\n * java arraylist arraylist http://www.cnblogs.com/carpenterlee/p/5419880.html\n *  https://www.pdai.tech/md/java/collection/java-collection-arraylist.html",charsets:{cjk:!0}},{title:"Collection - PriorityQueue",frontmatter:{},regularPath:"/java/collection/java-collection-PriorityQueue.html",relativePath:"java/collection/java-collection-PriorityQueue.md",key:"v-1cc09c4e",path:"/java/collection/java-collection-PriorityQueue.html",headers:[{level:2,title:"Collection - PriorityQueue",slug:"collection-priorityqueue",normalizedTitle:"collection - priorityqueue",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:115},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:123},{level:3,title:"add()offer()",slug:"add-offer",normalizedTitle:"add()offer()",charIndex:135},{level:3,title:"element()peek()",slug:"element-peek",normalizedTitle:"element()peek()",charIndex:156},{level:3,title:"remove()poll()",slug:"remove-poll",normalizedTitle:"remove()poll()",charIndex:180},{level:3,title:"remove(Object o)",slug:"remove-object-o",normalizedTitle:"remove(object o)",charIndex:203},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:225}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Collection - PriorityQueue   add()offer() element()peek() remove()poll() remove(Object o) ",content:"# Collection - PriorityQueue\n\n> Collection - PriorityQueue\n\n * Collection - PriorityQueue\n   * \n   * \n     * add()offer()\n     * element()peek()\n     * remove()poll()\n     * remove(Object o)\n   * \n\n\n# \n\nJava ArrayDeque__Stack__Queue_PriorityQueue_(JavaC++)(natural ordering)(ComparatorC++)\n\nJava_PriorityQueue__Queue_null(complete binary tree)()_PriorityQueue_\n\n\n\n:\n\nleftNo = parentNo*2+1\n\nrightNo = parentNo*2+2\n\nparentNo = (nodeNo-1)/2\n\n\n\nPriorityQueue_peek()elementadd(), offer(), remove()poll()_log(N)\n\n\n# \n\n\n# add()offer()\n\nadd(E e)offer(E e)Queuefalse_PriorityQueue_\n\n\n\n\n\n//offer(E e)\npublic boolean offer(E e) {\n    if (e == null)//null\n        throw new NullPointerException();\n    modCount++;\n    int i = size;\n    if (i >= queue.length)\n        grow(i + 1);//\n    size = i + 1;\n    if (i == 0)//\n        queue[0] = e;\n    else\n        siftUp(i, e);//\n    return true;\n}\n\n\ngrow()ArrayListgrow()siftUp(int k, E x)x\n\n//siftUp()\nprivate void siftUp(int k, E x) {\n    while (k > 0) {\n        int parent = (k - 1) >>> 1;//parentNo = (nodeNo-1)/2\n        Object e = queue[parent];\n        if (comparator.compare(x, (E) e) >= 0)//\n            break;\n        queue[k] = e;\n        k = parent;\n    }\n    queue[k] = x;\n}\n\n\nx** : kxparentx >= queue[parent]**\n\n\n# element()peek()\n\nelement()peek()null00\n\n\n\n:\n\n//peek()\npublic E peek() {\n    if (size == 0)\n        return null;\n    return (E) queue[0];//0\n}\n\n\n\n# remove()poll()\n\nremove()poll()null\n\n:\n\npublic E poll() {\n    if (size == 0)\n        return null;\n    int s = --size;\n    modCount++;\n    E result = (E) queue[0];//0\n    E x = (E) queue[s];\n    queue[s] = null;\n    if (s != 0)\n        siftDown(0, x);//\n    return result;\n}\n\n\n00siftDown()0()siftDown(int k, E x)kxx\n\n//siftDown()\nprivate void siftDown(int k, E x) {\n    int half = size >>> 1;\n    while (k < half) {\n    //cchild\n        int child = (k << 1) + 1;//leftNo = parentNo*2+1\n        Object c = queue[child];\n        int right = child + 1;\n        if (right < size &&\n            comparator.compare((E) c, (E) queue[right]) > 0)\n            c = queue[child = right];\n        if (comparator.compare(x, (E) c) <= 0)\n            break;\n        queue[k] = c;//c\n        k = child;\n    }\n    queue[k] = x;\n}\n\n\n\n# remove(Object o)\n\nremove(Object o)o()_Queue__Collection_remove(Object o)2: 1. 2. siftDown()\n\n\n\n:\n\n//remove(Object o)\npublic boolean remove(Object o) {\n//o.equals(queue[i])\n    int i = indexOf(o);\n    if (i == -1)\n        return false;\n    int s = --size;\n    if (s == i) //1\n        queue[i] = null;\n    else {\n        E moved = (E) queue[s];\n        queue[s] = null;\n        siftDown(i, moved);//2\n        ......\n    }\n    return true;\n}\n\n\n\n# \n\n * Java PriorityQueue PriorityQueue http://www.cnblogs.com/CarpenterLee/p/5488070.html\n *  https://www.pdai.tech/md/java/collection/java-collection-PriorityQueue.html",normalizedContent:"# collection - priorityqueue\n\n> collection - priorityqueue\n\n * collection - priorityqueue\n   * \n   * \n     * add()offer()\n     * element()peek()\n     * remove()poll()\n     * remove(object o)\n   * \n\n\n# \n\njava arraydeque__stack__queue_priorityqueue_(javac++)(natural ordering)(comparatorc++)\n\njava_priorityqueue__queue_null(complete binary tree)()_priorityqueue_\n\n\n\n:\n\nleftno = parentno*2+1\n\nrightno = parentno*2+2\n\nparentno = (nodeno-1)/2\n\n\n\npriorityqueue_peek()elementadd(), offer(), remove()poll()_log(n)\n\n\n# \n\n\n# add()offer()\n\nadd(e e)offer(e e)queuefalse_priorityqueue_\n\n\n\n\n\n//offer(e e)\npublic boolean offer(e e) {\n    if (e == null)//null\n        throw new nullpointerexception();\n    modcount++;\n    int i = size;\n    if (i >= queue.length)\n        grow(i + 1);//\n    size = i + 1;\n    if (i == 0)//\n        queue[0] = e;\n    else\n        siftup(i, e);//\n    return true;\n}\n\n\ngrow()arraylistgrow()siftup(int k, e x)x\n\n//siftup()\nprivate void siftup(int k, e x) {\n    while (k > 0) {\n        int parent = (k - 1) >>> 1;//parentno = (nodeno-1)/2\n        object e = queue[parent];\n        if (comparator.compare(x, (e) e) >= 0)//\n            break;\n        queue[k] = e;\n        k = parent;\n    }\n    queue[k] = x;\n}\n\n\nx** : kxparentx >= queue[parent]**\n\n\n# element()peek()\n\nelement()peek()null00\n\n\n\n:\n\n//peek()\npublic e peek() {\n    if (size == 0)\n        return null;\n    return (e) queue[0];//0\n}\n\n\n\n# remove()poll()\n\nremove()poll()null\n\n:\n\npublic e poll() {\n    if (size == 0)\n        return null;\n    int s = --size;\n    modcount++;\n    e result = (e) queue[0];//0\n    e x = (e) queue[s];\n    queue[s] = null;\n    if (s != 0)\n        siftdown(0, x);//\n    return result;\n}\n\n\n00siftdown()0()siftdown(int k, e x)kxx\n\n//siftdown()\nprivate void siftdown(int k, e x) {\n    int half = size >>> 1;\n    while (k < half) {\n    //cchild\n        int child = (k << 1) + 1;//leftno = parentno*2+1\n        object c = queue[child];\n        int right = child + 1;\n        if (right < size &&\n            comparator.compare((e) c, (e) queue[right]) > 0)\n            c = queue[child = right];\n        if (comparator.compare(x, (e) c) <= 0)\n            break;\n        queue[k] = c;//c\n        k = child;\n    }\n    queue[k] = x;\n}\n\n\n\n# remove(object o)\n\nremove(object o)o()_queue__collection_remove(object o)2: 1. 2. siftdown()\n\n\n\n:\n\n//remove(object o)\npublic boolean remove(object o) {\n//o.equals(queue[i])\n    int i = indexof(o);\n    if (i == -1)\n        return false;\n    int s = --size;\n    if (s == i) //1\n        queue[i] = null;\n    else {\n        e moved = (e) queue[s];\n        queue[s] = null;\n        siftdown(i, moved);//2\n        ......\n    }\n    return true;\n}\n\n\n\n# \n\n * java priorityqueue priorityqueue http://www.cnblogs.com/carpenterlee/p/5488070.html\n *  https://www.pdai.tech/md/java/collection/java-collection-priorityqueue.html",charsets:{cjk:!0}},{title:"Collection - Stack & Queue ",frontmatter:{},regularPath:"/java/collection/java-collection-Queue&Stack.html",relativePath:"java/collection/java-collection-Queue&Stack.md",key:"v-b2e6d364",path:"/java/collection/java-collection-Queue&Stack.html",headers:[{level:2,title:"Collection - Stack & Queue ",slug:"collection-stack-queue-",normalizedTitle:"collection - stack &amp; queue ",charIndex:null},{level:2,title:"Stack & Queue",slug:"stack-queue",normalizedTitle:"stack &amp; queue",charIndex:null},{level:2,title:"Queue",slug:"queue",normalizedTitle:"queue",charIndex:23},{level:2,title:"Deque",slug:"deque",normalizedTitle:"deque",charIndex:149},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:160},{level:3,title:"addFirst()",slug:"addfirst",normalizedTitle:"addfirst()",charIndex:172},{level:3,title:"addLast()",slug:"addlast",normalizedTitle:"addlast()",charIndex:190},{level:3,title:"pollFirst()",slug:"pollfirst",normalizedTitle:"pollfirst()",charIndex:207},{level:3,title:"pollLast()",slug:"polllast",normalizedTitle:"polllast()",charIndex:226},{level:3,title:"peekFirst()",slug:"peekfirst",normalizedTitle:"peekfirst()",charIndex:244},{level:3,title:"peekLast()",slug:"peeklast",normalizedTitle:"peeklast()",charIndex:263},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:5995}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Collection - Stack & Queue  Stack & Queue Queue Deque  addFirst() addLast() pollFirst() pollLast() peekFirst() peekLast() ",content:'# Collection - Stack & Queue \n\n> Collection - Stack & Queue\n\n * Collection - Stack & Queue \n   * Stack & Queue\n   * Queue\n   * Deque\n   * \n     * addFirst()\n     * addLast()\n     * pollFirst()\n     * pollLast()\n     * peekFirst()\n     * peekLast()\n\n\n# Stack & Queue\n\nJavaStackQueue()JavaStackArrayDequeQueueArrayDeque(LinkedList)\n\n\n# Queue\n\nQueueCollectionCollectioninsertion, extractioninspection6(null)\n\n          THROWS EXCEPTION   RETURNS SPECIAL VALUE\nInsert    add(e)             offer(e)\nRemove    remove()           poll()\nExamine   element()          peek()\n\n\n# Deque\n\nDeque"double ended queue", "deck". Deque  QueueQueueinsert, removeexamineDeque(null)12:\n\n          FIRST ELEMENT - HEAD                   LAST ELEMENT - TAIL   \n          Throws exception       Special value   Throws exception      Special value\nInsert    addFirst(e)            offerFirst(e)   addLast(e)            offerLast(e)\nRemove    removeFirst()          pollFirst()     removeLast()          pollLast()\nExamine   getFirst()             peekFirst()     getLast()             peekLast()\n\nDequeFIFOqueuedeque dequequeue:\n\nQUEUE METHOD   EQUIVALENT DEQUE METHOD\nadd(e)         addLast(e)\noffer(e)       offerLast(e)\nremove()       removeFirst()\npoll()         pollFirst()\nelement()      getFirst()\npeek()         peekFirst()\n\nDequedouble ended queueDequeQueue:\n\nQUEUE METHOD   EQUIVALENT DEQUE METHOD   \nadd(e)         addLast(e)                \noffer(e)       offerLast(e)              false\nremove()       removeFirst()             \npoll()         pollFirst()               null\nelement()      getFirst()                \npeek()         peekFirst()               null\n\nDequeStack:\n\nSTACK METHOD   EQUIVALENT DEQUE METHOD   \npush(e)        addFirst(e)               \n              offerFirst(e)             false\npop()          removeFirst()             \n              pollFirst()               null\npeek()         getFirst()                \n              peekFirst()               null\n\nDeque12(falsenull)Deque12\n\nArrayDequeLinkedListDequeAarryDequeLinkedListArrayDeque\n\nArrayDeque(circular array)ArrayDeque(not thread-safe)null\n\n\n\nheadtailhead0tailhead\n\n\n# \n\n\n# addFirst()\n\naddFirst(E e)Dequeheadelements[--head] = e\n\n\n\n: 1.2.head0addFirst()head-1\n\n//addFirst(E e)\npublic void addFirst(E e) {\n    if (e == null)//null\n        throw new NullPointerException();\n    elements[head = (head - 1) & (elements.length - 1)] = e;//2.\n    if (head == tail)//1.\n        doubleCapacity();//\n}\n\n\ntailelements\n\nhead = (head - 1) & (elements.length - 1)headelements.length2elements - 11head - 1head - 1(-1)elements.length\n\ndoubleCapacity()():\n\n\n\nheadhead\n\n//doubleCapacity()\nprivate void doubleCapacity() {\n    assert head == tail;\n    int p = head;\n    int n = elements.length;\n    int r = n - p; // head\n    int newCapacity = n << 1;//2\n    if (newCapacity < 0)\n        throw new IllegalStateException("Sorry, deque too big");\n    Object[] a = new Object[newCapacity];\n    System.arraycopy(elements, p, a, 0, r);//\n    System.arraycopy(elements, 0, a, r, p);//\n    elements = (E[])a;\n    head = 0;\n    tail = n;\n}\n\n\n\n# addLast()\n\naddLast(E e)Dequetailtailelements[tail] = e;doubleCapacity()\n\n\n\npublic void addLast(E e) {\n    if (e == null)//null\n        throw new NullPointerException();\n    elements[tail] = e;//\n    if ( (tail = (tail + 1) & (elements.length - 1)) == head)//\n        doubleCapacity();//\n}\n\n\naddFirt()\n\n\n# pollFirst()\n\npollFirst()Dequeheadelements[head]ArrayDequenullelements[head] == null\n\npublic E pollFirst() {\n    int h = head;\n    E result = elements[head];\n    if (result == null)//nulldeque\n        return null;\n    elements[h] = null;//let GC work\n    head = (head + 1) & (elements.length - 1);//\n    return result;\n}\n\n\n\n# pollLast()\n\npollLast()Dequetail\n\npublic E pollLast() {\n    int t = (tail - 1) & (elements.length - 1);//tail\n    E result = elements[t];\n    if (result == null)//nulldeque\n        return null;\n    elements[t] = null;//let GC work\n    tail = t;\n    return result;\n}\n\n\n\n# peekFirst()\n\npeekFirst()Dequeheadelements[head]\n\npublic E peekFirst() {\n    return elements[head]; // elements[head] is null if deque empty\n}\n\n\n\n# peekLast()\n\npeekLast()Dequetail\n\npublic E peekLast() {\n    return elements[(tail - 1) & (elements.length - 1)];\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-collection-Queue&Stack.html',normalizedContent:'# collection - stack & queue \n\n> collection - stack & queue\n\n * collection - stack & queue \n   * stack & queue\n   * queue\n   * deque\n   * \n     * addfirst()\n     * addlast()\n     * pollfirst()\n     * polllast()\n     * peekfirst()\n     * peeklast()\n\n\n# stack & queue\n\njavastackqueue()javastackarraydequequeuearraydeque(linkedlist)\n\n\n# queue\n\nqueuecollectioncollectioninsertion, extractioninspection6(null)\n\n          throws exception   returns special value\ninsert    add(e)             offer(e)\nremove    remove()           poll()\nexamine   element()          peek()\n\n\n# deque\n\ndeque"double ended queue", "deck". deque  queuequeueinsert, removeexaminedeque(null)12:\n\n          first element - head                   last element - tail   \n          throws exception       special value   throws exception      special value\ninsert    addfirst(e)            offerfirst(e)   addlast(e)            offerlast(e)\nremove    removefirst()          pollfirst()     removelast()          polllast()\nexamine   getfirst()             peekfirst()     getlast()             peeklast()\n\ndequefifoqueuedeque dequequeue:\n\nqueue method   equivalent deque method\nadd(e)         addlast(e)\noffer(e)       offerlast(e)\nremove()       removefirst()\npoll()         pollfirst()\nelement()      getfirst()\npeek()         peekfirst()\n\ndequedouble ended queuedequequeue:\n\nqueue method   equivalent deque method   \nadd(e)         addlast(e)                \noffer(e)       offerlast(e)              false\nremove()       removefirst()             \npoll()         pollfirst()               null\nelement()      getfirst()                \npeek()         peekfirst()               null\n\ndequestack:\n\nstack method   equivalent deque method   \npush(e)        addfirst(e)               \n              offerfirst(e)             false\npop()          removefirst()             \n              pollfirst()               null\npeek()         getfirst()                \n              peekfirst()               null\n\ndeque12(falsenull)deque12\n\narraydequelinkedlistdequeaarrydequelinkedlistarraydeque\n\narraydeque(circular array)arraydeque(not thread-safe)null\n\n\n\nheadtailhead0tailhead\n\n\n# \n\n\n# addfirst()\n\naddfirst(e e)dequeheadelements[--head] = e\n\n\n\n: 1.2.head0addfirst()head-1\n\n//addfirst(e e)\npublic void addfirst(e e) {\n    if (e == null)//null\n        throw new nullpointerexception();\n    elements[head = (head - 1) & (elements.length - 1)] = e;//2.\n    if (head == tail)//1.\n        doublecapacity();//\n}\n\n\ntailelements\n\nhead = (head - 1) & (elements.length - 1)headelements.length2elements - 11head - 1head - 1(-1)elements.length\n\ndoublecapacity()():\n\n\n\nheadhead\n\n//doublecapacity()\nprivate void doublecapacity() {\n    assert head == tail;\n    int p = head;\n    int n = elements.length;\n    int r = n - p; // head\n    int newcapacity = n << 1;//2\n    if (newcapacity < 0)\n        throw new illegalstateexception("sorry, deque too big");\n    object[] a = new object[newcapacity];\n    system.arraycopy(elements, p, a, 0, r);//\n    system.arraycopy(elements, 0, a, r, p);//\n    elements = (e[])a;\n    head = 0;\n    tail = n;\n}\n\n\n\n# addlast()\n\naddlast(e e)dequetailtailelements[tail] = e;doublecapacity()\n\n\n\npublic void addlast(e e) {\n    if (e == null)//null\n        throw new nullpointerexception();\n    elements[tail] = e;//\n    if ( (tail = (tail + 1) & (elements.length - 1)) == head)//\n        doublecapacity();//\n}\n\n\naddfirt()\n\n\n# pollfirst()\n\npollfirst()dequeheadelements[head]arraydequenullelements[head] == null\n\npublic e pollfirst() {\n    int h = head;\n    e result = elements[head];\n    if (result == null)//nulldeque\n        return null;\n    elements[h] = null;//let gc work\n    head = (head + 1) & (elements.length - 1);//\n    return result;\n}\n\n\n\n# polllast()\n\npolllast()dequetail\n\npublic e polllast() {\n    int t = (tail - 1) & (elements.length - 1);//tail\n    e result = elements[t];\n    if (result == null)//nulldeque\n        return null;\n    elements[t] = null;//let gc work\n    tail = t;\n    return result;\n}\n\n\n\n# peekfirst()\n\npeekfirst()dequeheadelements[head]\n\npublic e peekfirst() {\n    return elements[head]; // elements[head] is null if deque empty\n}\n\n\n\n# peeklast()\n\npeeklast()dequetail\n\npublic e peeklast() {\n    return elements[(tail - 1) & (elements.length - 1)];\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-collection-queue&stack.html',charsets:{cjk:!0}},{title:"Map - HashSet & HashMap ",frontmatter:{},regularPath:"/java/collection/java-map-HashMap&HashSet.html",relativePath:"java/collection/java-map-HashMap&HashSet.md",key:"v-07a8195c",path:"/java/collection/java-map-HashMap&HashSet.html",headers:[{level:2,title:"Map - HashSet & HashMap ",slug:"map-hashset-hashmap-",normalizedTitle:"map - hashset &amp; hashmap ",charIndex:null},{level:2,title:"Java7 HashMap",slug:"java7-hashmap",normalizedTitle:"java7 hashmap",charIndex:108},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:129},{level:3,title:"get()",slug:"get",normalizedTitle:"get()",charIndex:139},{level:3,title:"put()",slug:"put",normalizedTitle:"put()",charIndex:152},{level:3,title:"remove()",slug:"remove",normalizedTitle:"remove()",charIndex:165},{level:2,title:"Java8 HashMap",slug:"java8-hashmap",normalizedTitle:"java8 hashmap",charIndex:179},{level:3,title:"put ",slug:"put-",normalizedTitle:"put ",charIndex:200},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:216},{level:3,title:"get ",slug:"get-",normalizedTitle:"get ",charIndex:228},{level:2,title:"HashSet",slug:"hashset",normalizedTitle:"hashset",charIndex:8},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:11400}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Map - HashSet & HashMap  Java7 HashMap  get() put() remove() Java8 HashMap put   get  HashSet ",content:'# Map - HashSet & HashMap \n\n> Map - HashSet & HashMap\n\n * Map - HashSet & HashMap \n   * Java7 HashMap\n     * \n     * get()\n     * put()\n     * remove()\n   * Java8 HashMap\n     * put \n     * \n     * get \n   * HashSet\n\n\n# Java7 HashMap\n\n\n# \n\n_HashSet__HashMap_Java_HashSet__HashMap_()_HashMap_\n\n_HashMap__Map_keynullvaluenullHashtable_TreeMap__HashMap_ (Open addressing)(Separate chaining with linked lists)Java7 _HashMap_\n\n\n\nput()get()_HashMap_table_HashMap_\n\n_HashMap_: (inital capacity)(load factor)tableentrycapacity*load_factor\n\n_HashMap__HashSet_: hashCode()equals()hashCode()bucketequals()HashMapHashSet**@Override** hashCode()equals()\n\n\n# get()\n\nget(Object key)keyvaluegetEntry(Object key)entryentry.getValue()getEntry() hash()bucketkey.equals(k)entry\n\n\n\nhash(k)&(table.length-1)hash(k)%table.length_HashMap_table.length2table.length-11hash(k)\n\n//getEntry()\nfinal Entry<K,V> getEntry(Object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    for (Entry<K,V> e = table[hash&(table.length-1)];//\n         e != null; e = e.next) {//entry\n        Object k;\n        //equals()\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k))))\n            return e;\n    }\n    return null;\n}\n\n\n\n# put()\n\nput(K key, V value)key, valuemapmapgetEntry()addEntry(int hash, K key, V value, int bucketIndex)entry\n\n\n\n//addEntry()\nvoid addEntry(int hash, K key, V value, int bucketIndex) {\n    if ((size >= threshold) && (null != table[bucketIndex])) {\n        resize(2 * table.length);//\n        hash = (null != key) ? hash(key) : 0;\n        bucketIndex = hash & (table.length-1);//hash%table.length\n    }\n    //entry\n    Entry<K,V> e = table[bucketIndex];\n    table[bucketIndex] = new Entry<>(hash, key, value, e);\n    size++;\n}\n\n\n\n# remove()\n\nremove(Object key)keyentryremoveEntryForKey(Object key)removeEntryForKey()keyentryentry()getEntry()\n\n\n\n//removeEntryForKey()\nfinal Entry<K,V> removeEntryForKey(Object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    int i = indexFor(hash, table.length);//hash&(table.length-1)\n    Entry<K,V> prev = table[i];//\n    Entry<K,V> e = prev;\n    while (e != null) {//\n        Entry<K,V> next = e.next;\n        Object k;\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k)))) {//entry\n            modCount++; size--;\n            if (prev == e) table[i] = next;//entry\n            else prev.next = next;\n            return e;\n        }\n        prev = e; e = next;\n    }\n    return e;\n}\n\n\n\n# Java8 HashMap\n\nJava8  HashMap  ++ \n\n Java7 HashMap  hash  O(n)\n\n Java8  8  O(logN)\n\n\n\n\n\n\n\nJava8 \n\nJava7  Entry  HashMap Java8  Node keyvaluehash  next Node  TreeNode\n\n Node  TreeNode \n\n\n# put \n\npublic V put(K key, V value) {\n    return putVal(hash(key), key, value, false, true);\n}\n\n//  onlyIfAbsent  true key  put \n//  evict \nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n               boolean evict) {\n    Node<K,V>[] tab; Node<K,V> p; int n, i;\n    //  put  resize() java7  put \n    //  resize  null  16 \n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    //  Node \n    if ((p = tab[i = (n - 1) & hash]) == null)\n        tab[i] = newNode(hash, key, value, null);\n\n    else {// \n        Node<K,V> e; K k;\n        // key ""\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            e = p;\n        // \n        else if (p instanceof TreeNode)\n            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n        else {\n            // \n            for (int binCount = 0; ; ++binCount) {\n                // (Java7 )\n                if ((e = p.next) == null) {\n                    p.next = newNode(hash, key, value, null);\n                    // TREEIFY_THRESHOLD  8 8 \n                    //  treeifyBin\n                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                        treeifyBin(tab, hash);\n                    break;\n                }\n                // "" key(==  equals)\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    //  break e [ key ""] node\n                    break;\n                p = e;\n            }\n        }\n        // e!=null keykey""\n        // put if  ""\n        if (e != null) {\n            V oldValue = e.value;\n            if (!onlyIfAbsent || oldValue == null)\n                e.value = value;\n            afterNodeAccess(e);\n            return oldValue;\n        }\n    }\n    ++modCount;\n    //  HashMap  size \n    if (++size > threshold)\n        resize();\n    afterNodeInsertion(evict);\n    return null;\n}\n\n\n Java7 Java7 Java8 \n\n\n# \n\nresize()  2 \n\nfinal Node<K,V>[] resize() {\n    Node<K,V>[] oldTab = table;\n    int oldCap = (oldTab == null) ? 0 : oldTab.length;\n    int oldThr = threshold;\n    int newCap, newThr = 0;\n    if (oldCap > 0) { // \n        if (oldCap >= MAXIMUM_CAPACITY) {\n            threshold = Integer.MAX_VALUE;\n            return oldTab;\n        }\n        // \n        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&\n                 oldCap >= DEFAULT_INITIAL_CAPACITY)\n            // \n            newThr = oldThr << 1; // double threshold\n    }\n    else if (oldThr > 0) //  new HashMap(int initialCapacity)  put \n        newCap = oldThr;\n    else {//  new HashMap()  put \n        newCap = DEFAULT_INITIAL_CAPACITY;\n        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n    }\n\n    if (newThr == 0) {\n        float ft = (float)newCap * loadFactor;\n        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?\n                  (int)ft : Integer.MAX_VALUE);\n    }\n    threshold = newThr;\n    \n    // \n    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];\n    table = newTab; //  newTab \n    \n    if (oldTab != null) {\n        // \n        for (int j = 0; j < oldCap; ++j) {\n            Node<K,V> e;\n            if ((e = oldTab[j]) != null) {\n                oldTab[j] = null;\n                // \n                if (e.next == null)\n                    newTab[e.hash & (newCap - 1)] = e;\n                // \n                else if (e instanceof TreeNode)\n                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);\n                else { \n                    // \n                    // \n                    // loHeadloTail hiHeadhiTail \n                    Node<K,V> loHead = null, loTail = null;\n                    Node<K,V> hiHead = null, hiTail = null;\n                    Node<K,V> next;\n                    do {\n                        next = e.next;\n                        if ((e.hash & oldCap) == 0) {\n                            if (loTail == null)\n                                loHead = e;\n                            else\n                                loTail.next = e;\n                            loTail = e;\n                        }\n                        else {\n                            if (hiTail == null)\n                                hiHead = e;\n                            else\n                                hiTail.next = e;\n                            hiTail = e;\n                        }\n                    } while ((e = next) != null);\n                    if (loTail != null) {\n                        loTail.next = null;\n                        // \n                        newTab[j] = loHead;\n                    }\n                    if (hiTail != null) {\n                        hiTail.next = null;\n                        //  j + oldCap\n                        newTab[j + oldCap] = hiHead;\n                    }\n                }\n            }\n        }\n    }\n    return newTab;\n}\n\n\n\n# get \n\n put get \n\n *  key  hash  hash : hash & (length-1)\n * \n *  TreeNode\n * (==equals) key\n\npublic V get(Object key) {\n    Node<K,V> e;\n    return (e = getNode(hash(key), key)) == null ? null : e.value;\n}\nfinal Node<K,V> getNode(int hash, Object key) {\n    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        // \n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            return first;\n        if ((e = first.next) != null) {\n            // \n            if (first instanceof TreeNode)\n                return ((TreeNode<K,V>)first).getTreeNode(hash, key);\n\n            // \n            do {\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    return null;\n}\n\n\n\n# HashSet\n\n_HashSet__HashMap__HashSet__HashMap__HashSet_300\n\n//HashSetHashMap\npublic class HashSet<E>\n{\n......\nprivate transient HashMap<E,Object> map;//HashSetHashMap\n    // Dummy value to associate with an Object in the backing Map\n    private static final Object PRESENT = new Object();\n    public HashSet() {\n        map = new HashMap<>();\n    }\n    ......\n    public boolean add(E e) {//\n        return map.put(e, PRESENT)==null;\n    }\n    ......\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-HashMap&HashSet.html',normalizedContent:'# map - hashset & hashmap \n\n> map - hashset & hashmap\n\n * map - hashset & hashmap \n   * java7 hashmap\n     * \n     * get()\n     * put()\n     * remove()\n   * java8 hashmap\n     * put \n     * \n     * get \n   * hashset\n\n\n# java7 hashmap\n\n\n# \n\n_hashset__hashmap_java_hashset__hashmap_()_hashmap_\n\n_hashmap__map_keynullvaluenullhashtable_treemap__hashmap_ (open addressing)(separate chaining with linked lists)java7 _hashmap_\n\n\n\nput()get()_hashmap_table_hashmap_\n\n_hashmap_: (inital capacity)(load factor)tableentrycapacity*load_factor\n\n_hashmap__hashset_: hashcode()equals()hashcode()bucketequals()hashmaphashset**@override** hashcode()equals()\n\n\n# get()\n\nget(object key)keyvaluegetentry(object key)entryentry.getvalue()getentry() hash()bucketkey.equals(k)entry\n\n\n\nhash(k)&(table.length-1)hash(k)%table.length_hashmap_table.length2table.length-11hash(k)\n\n//getentry()\nfinal entry<k,v> getentry(object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    for (entry<k,v> e = table[hash&(table.length-1)];//\n         e != null; e = e.next) {//entry\n        object k;\n        //equals()\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k))))\n            return e;\n    }\n    return null;\n}\n\n\n\n# put()\n\nput(k key, v value)key, valuemapmapgetentry()addentry(int hash, k key, v value, int bucketindex)entry\n\n\n\n//addentry()\nvoid addentry(int hash, k key, v value, int bucketindex) {\n    if ((size >= threshold) && (null != table[bucketindex])) {\n        resize(2 * table.length);//\n        hash = (null != key) ? hash(key) : 0;\n        bucketindex = hash & (table.length-1);//hash%table.length\n    }\n    //entry\n    entry<k,v> e = table[bucketindex];\n    table[bucketindex] = new entry<>(hash, key, value, e);\n    size++;\n}\n\n\n\n# remove()\n\nremove(object key)keyentryremoveentryforkey(object key)removeentryforkey()keyentryentry()getentry()\n\n\n\n//removeentryforkey()\nfinal entry<k,v> removeentryforkey(object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    int i = indexfor(hash, table.length);//hash&(table.length-1)\n    entry<k,v> prev = table[i];//\n    entry<k,v> e = prev;\n    while (e != null) {//\n        entry<k,v> next = e.next;\n        object k;\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k)))) {//entry\n            modcount++; size--;\n            if (prev == e) table[i] = next;//entry\n            else prev.next = next;\n            return e;\n        }\n        prev = e; e = next;\n    }\n    return e;\n}\n\n\n\n# java8 hashmap\n\njava8  hashmap  ++ \n\n java7 hashmap  hash  o(n)\n\n java8  8  o(logn)\n\n\n\n\n\n\n\njava8 \n\njava7  entry  hashmap java8  node keyvaluehash  next node  treenode\n\n node  treenode \n\n\n# put \n\npublic v put(k key, v value) {\n    return putval(hash(key), key, value, false, true);\n}\n\n//  onlyifabsent  true key  put \n//  evict \nfinal v putval(int hash, k key, v value, boolean onlyifabsent,\n               boolean evict) {\n    node<k,v>[] tab; node<k,v> p; int n, i;\n    //  put  resize() java7  put \n    //  resize  null  16 \n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    //  node \n    if ((p = tab[i = (n - 1) & hash]) == null)\n        tab[i] = newnode(hash, key, value, null);\n\n    else {// \n        node<k,v> e; k k;\n        // key ""\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            e = p;\n        // \n        else if (p instanceof treenode)\n            e = ((treenode<k,v>)p).puttreeval(this, tab, hash, key, value);\n        else {\n            // \n            for (int bincount = 0; ; ++bincount) {\n                // (java7 )\n                if ((e = p.next) == null) {\n                    p.next = newnode(hash, key, value, null);\n                    // treeify_threshold  8 8 \n                    //  treeifybin\n                    if (bincount >= treeify_threshold - 1) // -1 for 1st\n                        treeifybin(tab, hash);\n                    break;\n                }\n                // "" key(==  equals)\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    //  break e [ key ""] node\n                    break;\n                p = e;\n            }\n        }\n        // e!=null keykey""\n        // put if  ""\n        if (e != null) {\n            v oldvalue = e.value;\n            if (!onlyifabsent || oldvalue == null)\n                e.value = value;\n            afternodeaccess(e);\n            return oldvalue;\n        }\n    }\n    ++modcount;\n    //  hashmap  size \n    if (++size > threshold)\n        resize();\n    afternodeinsertion(evict);\n    return null;\n}\n\n\n java7 java7 java8 \n\n\n# \n\nresize()  2 \n\nfinal node<k,v>[] resize() {\n    node<k,v>[] oldtab = table;\n    int oldcap = (oldtab == null) ? 0 : oldtab.length;\n    int oldthr = threshold;\n    int newcap, newthr = 0;\n    if (oldcap > 0) { // \n        if (oldcap >= maximum_capacity) {\n            threshold = integer.max_value;\n            return oldtab;\n        }\n        // \n        else if ((newcap = oldcap << 1) < maximum_capacity &&\n                 oldcap >= default_initial_capacity)\n            // \n            newthr = oldthr << 1; // double threshold\n    }\n    else if (oldthr > 0) //  new hashmap(int initialcapacity)  put \n        newcap = oldthr;\n    else {//  new hashmap()  put \n        newcap = default_initial_capacity;\n        newthr = (int)(default_load_factor * default_initial_capacity);\n    }\n\n    if (newthr == 0) {\n        float ft = (float)newcap * loadfactor;\n        newthr = (newcap < maximum_capacity && ft < (float)maximum_capacity ?\n                  (int)ft : integer.max_value);\n    }\n    threshold = newthr;\n    \n    // \n    node<k,v>[] newtab = (node<k,v>[])new node[newcap];\n    table = newtab; //  newtab \n    \n    if (oldtab != null) {\n        // \n        for (int j = 0; j < oldcap; ++j) {\n            node<k,v> e;\n            if ((e = oldtab[j]) != null) {\n                oldtab[j] = null;\n                // \n                if (e.next == null)\n                    newtab[e.hash & (newcap - 1)] = e;\n                // \n                else if (e instanceof treenode)\n                    ((treenode<k,v>)e).split(this, newtab, j, oldcap);\n                else { \n                    // \n                    // \n                    // loheadlotail hiheadhitail \n                    node<k,v> lohead = null, lotail = null;\n                    node<k,v> hihead = null, hitail = null;\n                    node<k,v> next;\n                    do {\n                        next = e.next;\n                        if ((e.hash & oldcap) == 0) {\n                            if (lotail == null)\n                                lohead = e;\n                            else\n                                lotail.next = e;\n                            lotail = e;\n                        }\n                        else {\n                            if (hitail == null)\n                                hihead = e;\n                            else\n                                hitail.next = e;\n                            hitail = e;\n                        }\n                    } while ((e = next) != null);\n                    if (lotail != null) {\n                        lotail.next = null;\n                        // \n                        newtab[j] = lohead;\n                    }\n                    if (hitail != null) {\n                        hitail.next = null;\n                        //  j + oldcap\n                        newtab[j + oldcap] = hihead;\n                    }\n                }\n            }\n        }\n    }\n    return newtab;\n}\n\n\n\n# get \n\n put get \n\n *  key  hash  hash : hash & (length-1)\n * \n *  treenode\n * (==equals) key\n\npublic v get(object key) {\n    node<k,v> e;\n    return (e = getnode(hash(key), key)) == null ? null : e.value;\n}\nfinal node<k,v> getnode(int hash, object key) {\n    node<k,v>[] tab; node<k,v> first, e; int n; k k;\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        // \n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            return first;\n        if ((e = first.next) != null) {\n            // \n            if (first instanceof treenode)\n                return ((treenode<k,v>)first).gettreenode(hash, key);\n\n            // \n            do {\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    return null;\n}\n\n\n\n# hashset\n\n_hashset__hashmap__hashset__hashmap__hashset_300\n\n//hashsethashmap\npublic class hashset<e>\n{\n......\nprivate transient hashmap<e,object> map;//hashsethashmap\n    // dummy value to associate with an object in the backing map\n    private static final object present = new object();\n    public hashset() {\n        map = new hashmap<>();\n    }\n    ......\n    public boolean add(e e) {//\n        return map.put(e, present)==null;\n    }\n    ......\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-hashmap&hashset.html',charsets:{cjk:!0}},{title:"Collection ",frontmatter:{},regularPath:"/java/collection/java-collection-all.html",relativePath:"java/collection/java-collection-all.md",key:"v-b516cde4",path:"/java/collection/java-collection-all.html",headers:[{level:2,title:"Collection ",slug:"collection-",normalizedTitle:"collection ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:95},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:25},{level:2,title:"Collection",slug:"collection",normalizedTitle:"collection",charIndex:2},{level:3,title:"Set",slug:"set",normalizedTitle:"set",charIndex:133},{level:3,title:"List",slug:"list",normalizedTitle:"list",charIndex:201},{level:3,title:"Queue",slug:"queue",normalizedTitle:"queue",charIndex:268},{level:2,title:"Map",slug:"map",normalizedTitle:"map",charIndex:42},{level:3,title:"TreeMap",slug:"treemap",normalizedTitle:"treemap",charIndex:333},{level:3,title:"HashMap",slug:"hashmap",normalizedTitle:"hashmap",charIndex:348},{level:3,title:"HashTable",slug:"hashtable",normalizedTitle:"hashtable",charIndex:363},{level:3,title:"LinkedHashMap",slug:"linkedhashmap",normalizedTitle:"linkedhashmap",charIndex:380},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:399}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Collection    Collection Set List Queue Map TreeMap HashMap HashTable LinkedHashMap ",content:"# Collection \n\n> JDKCollectionMap\n\n * Collection \n   * \n   * \n   * Collection\n     * Set\n       * TreeSet\n       * HashSet\n       * LinkedHashSet\n     * List\n       * ArrayList\n       * Vector\n       * LinkedList\n     * Queue\n       * LinkedList\n       * PriorityQueue\n   * Map\n     * TreeMap\n     * HashMap\n     * HashTable\n     * LinkedHashMap\n   * \n\n\n# \n\n\n\n\n# \n\nJava*Java Collections Framework(JCF)*JavaJDK 1.2:\n\n * \n * \n * API\n * \n * API\n * \n\nJava(int, long, float, double)(Integer, Long, Float, Double)\n\n\n# Collection\n\n>  Collection  Map Collection  Map ()\n\n\n# Set\n\n# TreeSet\n\n HashSetHashSet  O(1)TreeSet  O(logN)\n\n# HashSet\n\n Iterator  HashSet \n\n# LinkedHashSet\n\n HashSet \n\n\n# List\n\n# ArrayList\n\n\n\n# Vector\n\n ArrayList \n\n# LinkedList\n\nLinkedList \n\n\n# Queue\n\n# LinkedList\n\n\n\n# PriorityQueue\n\n\n\n\n# Map\n\n\n# TreeMap\n\n\n\n\n# HashMap\n\n\n\n\n# HashTable\n\n HashMap  HashTable  ConcurrentHashMap  ConcurrentHashMap  ConcurrentHashMap \n\n\n# LinkedHashMap\n\n(LRU)\n\n\n# \n\n * CarpenterLee/JCFInternals https://github.com/CarpenterLee/JCFInternals\n *  https://www.pdai.tech/md/java/collection/java-collection-all.html",normalizedContent:"# collection \n\n> jdkcollectionmap\n\n * collection \n   * \n   * \n   * collection\n     * set\n       * treeset\n       * hashset\n       * linkedhashset\n     * list\n       * arraylist\n       * vector\n       * linkedlist\n     * queue\n       * linkedlist\n       * priorityqueue\n   * map\n     * treemap\n     * hashmap\n     * hashtable\n     * linkedhashmap\n   * \n\n\n# \n\n\n\n\n# \n\njava*java collections framework(jcf)*javajdk 1.2:\n\n * \n * \n * api\n * \n * api\n * \n\njava(int, long, float, double)(integer, long, float, double)\n\n\n# collection\n\n>  collection  map collection  map ()\n\n\n# set\n\n# treeset\n\n hashsethashset  o(1)treeset  o(logn)\n\n# hashset\n\n iterator  hashset \n\n# linkedhashset\n\n hashset \n\n\n# list\n\n# arraylist\n\n\n\n# vector\n\n arraylist \n\n# linkedlist\n\nlinkedlist \n\n\n# queue\n\n# linkedlist\n\n\n\n# priorityqueue\n\n\n\n\n# map\n\n\n# treemap\n\n\n\n\n# hashmap\n\n\n\n\n# hashtable\n\n hashmap  hashtable  concurrenthashmap  concurrenthashmap  concurrenthashmap \n\n\n# linkedhashmap\n\n(lru)\n\n\n# \n\n * carpenterlee/jcfinternals https://github.com/carpenterlee/jcfinternals\n *  https://www.pdai.tech/md/java/collection/java-collection-all.html",charsets:{cjk:!0}},{title:"Map - TreeSet & TreeMap ",frontmatter:{},regularPath:"/java/collection/java-map-TreeMap&TreeSet.html",relativePath:"java/collection/java-map-TreeMap&TreeSet.md",key:"v-7b0a2d92",path:"/java/collection/java-map-TreeMap&TreeSet.html",headers:[{level:2,title:"Map - TreeSet & TreeMap ",slug:"map-treeset-treemap-",normalizedTitle:"map - treeset &amp; treemap ",charIndex:null},{level:2,title:"Java 7 - TreeSet & TreeMap",slug:"java-7-treeset-treemap",normalizedTitle:"java 7 - treeset &amp; treemap",charIndex:null},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:105},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:115},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:125},{level:3,title:"TreeSet",slug:"treeset",normalizedTitle:"treeset",charIndex:8},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:12129}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Map - TreeSet & TreeMap  Java 7 - TreeSet & TreeMap    TreeSet ",content:"# Map - TreeSet & TreeMap \n\n> Map - TreeSet & TreeMap \n\n * Java 7 - TreeSet & TreeMap\n   * \n   * \n   * \n   * TreeSet\n\n\n# Java 7 - TreeSet & TreeMap\n\n\n# \n\n_TreeSet__TreeMap_Java___TreeSet__TreeMap_()**_TreeMap_\n\nJava _TreeMap__SortedMap_key_Map_key(natural ordering)(Comparator)\n\n_TreeMap_(Red-Black tree)containsKey(), get(), put(), remove()log(n)\n\n\n\n_TreeMap_(not synchronized)_TreeMap_(wrapped):\n\nSortedMap m = Collections.synchronizedSortedMap(new TreeMap(...));\n\n(binary search tree):\n\n 1. \n 2. \n 3. ()\n 4. null()\n\n()34\n\n\n# \n\n: ** : (Rotate Left)(RotateRight)**\n\n# \n\nxxxx\n\n\n\n_TreeMap_:\n\n//Rotate Left\nprivate void rotateLeft(Entry<K,V> p) {\n    if (p != null) {\n        Entry<K,V> r = p.right;\n        p.right = r.left;\n        if (r.left != null)\n            r.left.parent = p;\n        r.parent = p.parent;\n        if (p.parent == null)\n            root = r;\n        else if (p.parent.left == p)\n            p.parent.left = r;\n        else\n            p.parent.right = r;\n        r.left = p;\n        p.parent = r;\n    }\n}\n\n\n# \n\nxxxx\n\n\n\n_TreeMap_:\n\n//Rotate Right\nprivate void rotateRight(Entry<K,V> p) {\n    if (p != null) {\n        Entry<K,V> l = p.left;\n        p.left = l.right;\n        if (l.right != null) l.right.parent = p;\n        l.parent = p.parent;\n        if (p.parent == null)\n            root = l;\n        else if (p.parent.right == p)\n            p.parent.right = l;\n        else p.parent.left = l;\n        l.right = p;\n        p.parent = l;\n    }\n}\n\n\n# \n\nt(t):\n\n>  1. tt\n>  2. tt\n\n\n\n\n\n_TreeMap_:\n\n// successor()\nstatic <K,V> TreeMap.Entry<K,V> successor(Entry<K,V> t) {\n    if (t == null)\n        return null;\n    else if (t.right != null) {// 1. tt\n        Entry<K,V> p = t.right;\n        while (p.left != null)\n            p = p.left;\n        return p;\n    } else {// 2. tt\n        Entry<K,V> p = t.parent;\n        Entry<K,V> ch = t;\n        while (p != null && ch == p.right) {\n            ch = p;\n            p = p.parent;\n        }\n        return p;\n    }\n}\n\n\n\n# \n\n# get()\n\nget(Object key)keyvaluegetEntry(Object key)entryentry.valuegetEntry()key()k.compareTo(p.key) == 0entry\n\n\n\n:\n\n//getEntry()\nfinal Entry<K,V> getEntry(Object key) {\n    ......\n    if (key == null)//keynull\n        throw new NullPointerException();\n    Comparable<? super K> k = (Comparable<? super K>) key;//\n    Entry<K,V> p = root;\n    while (p != null) {\n        int cmp = k.compareTo(p.key);\n        if (cmp < 0)//\n            p = p.left;\n        else if (cmp > 0)//\n            p = p.right;\n        else\n            return p;\n    }\n    return null;\n}\n\n\n# put()\n\nput(K key, V value)key, valuemapmapgetEntry()entry()\n\npublic V put(K key, V value) {\n......\n    int cmp;\n    Entry<K,V> parent;\n    if (key == null)\n        throw new NullPointerException();\n    Comparable<? super K> k = (Comparable<? super K>) key;//\n    do {\n        parent = t;\n        cmp = k.compareTo(t.key);\n        if (cmp < 0) t = t.left;//\n        else if (cmp > 0) t = t.right;//\n        else return t.setValue(value);\n    } while (t != null);\n    Entry<K,V> e = new Entry<>(key, value, parent);//entry\n    if (cmp < 0) parent.left = e;\n    else parent.right = e;\n    fixAfterInsertion(e);//\n    size++;\n    return null;\n}\n\n\n: entry()fixAfterInsertion()1.2.\n\n\n\nfixAfterInsertion()rotateLeft()rotateRight()2346\n\n//fixAfterInsertion()\nprivate void fixAfterInsertion(Entry<K,V> x) {\n    x.color = RED;\n    while (x != null && x != root && x.parent.color == RED) {\n        if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {\n            Entry<K,V> y = rightOf(parentOf(parentOf(x)));\n            if (colorOf(y) == RED) {\n                setColor(parentOf(x), BLACK);              // 1\n                setColor(y, BLACK);                        // 1\n                setColor(parentOf(parentOf(x)), RED);      // 1\n                x = parentOf(parentOf(x));                 // 1\n            } else {\n                if (x == rightOf(parentOf(x))) {\n                    x = parentOf(x);                       // 2\n                    rotateLeft(x);                         // 2\n                }\n                setColor(parentOf(x), BLACK);              // 3\n                setColor(parentOf(parentOf(x)), RED);      // 3\n                rotateRight(parentOf(parentOf(x)));        // 3\n            }\n        } else {\n            Entry<K,V> y = leftOf(parentOf(parentOf(x)));\n            if (colorOf(y) == RED) {\n                setColor(parentOf(x), BLACK);              // 4\n                setColor(y, BLACK);                        // 4\n                setColor(parentOf(parentOf(x)), RED);      // 4\n                x = parentOf(parentOf(x));                 // 4\n            } else {\n                if (x == leftOf(parentOf(x))) {\n                    x = parentOf(x);                       // 5\n                    rotateRight(x);                        // 5\n                }\n                setColor(parentOf(x), BLACK);              // 6\n                setColor(parentOf(parentOf(x)), RED);      // 6\n                rotateLeft(parentOf(parentOf(x)));         // 6\n            }\n        }\n    }\n    root.color = BLACK;\n}\n\n\n# remove()\n\nremove(Object key)keyentrygetEntry(Object key)keyentrydeleteEntry(Entry<K,V> entry)entry\n\ngetEntry()deleteEntry()entryfixAfterDeletion(Entry<K,V> x)\n\n:\n\n>  1. p\n>  2. p\n\n1p()p()2ps(x)p1s(s1.)\n\ndeleteEntry():\n\n// entrydeleteEntry()\nprivate void deleteEntry(Entry<K,V> p) {\n    modCount++;\n    size--;\n    if (p.left != null && p.right != null) {// 2. p\n        Entry<K,V> s = successor(p);// \n        p.key = s.key;\n        p.value = s.value;\n        p = s;\n    }\n    Entry<K,V> replacement = (p.left != null ? p.left : p.right);\n    if (replacement != null) {// 1. p\n        replacement.parent = p.parent;\n        if (p.parent == null)\n            root = replacement;\n        else if (p == p.parent.left)\n            p.parent.left  = replacement;\n        else\n            p.parent.right = replacement;\n        p.left = p.right = p.parent = null;\n        if (p.color == BLACK)\n            fixAfterDeletion(replacement);// \n    } else if (p.parent == null) {\n        root = null;\n    } else { // 1. p\n        if (p.color == BLACK)\n            fixAfterDeletion(p);// \n        if (p.parent != null) {\n            if (p == p.parent.left)\n                p.parent.left = null;\n            else if (p == p.parent.right)\n                p.parent.right = null;\n            p.parent = null;\n        }\n    }\n}\n\n\nfixAfterDeletion()BLACKREDBLACK4\n\nfixAfterInsertion(): 1.2.\n\n\n\n: 12341: a).122(x)b).34(xroot)\n\nfixAfterDeletion()rotateLeft()rotateRight()3458\n\nprivate void fixAfterDeletion(Entry<K,V> x) {\n    while (x != root && colorOf(x) == BLACK) {\n        if (x == leftOf(parentOf(x))) {\n            Entry<K,V> sib = rightOf(parentOf(x));\n            if (colorOf(sib) == RED) {\n                setColor(sib, BLACK);                   // 1\n                setColor(parentOf(x), RED);             // 1\n                rotateLeft(parentOf(x));                // 1\n                sib = rightOf(parentOf(x));             // 1\n            }\n            if (colorOf(leftOf(sib))  == BLACK &&\n                colorOf(rightOf(sib)) == BLACK) {\n                setColor(sib, RED);                     // 2\n                x = parentOf(x);                        // 2\n            } else {\n                if (colorOf(rightOf(sib)) == BLACK) {\n                    setColor(leftOf(sib), BLACK);       // 3\n                    setColor(sib, RED);                 // 3\n                    rotateRight(sib);                   // 3\n                    sib = rightOf(parentOf(x));         // 3\n                }\n                setColor(sib, colorOf(parentOf(x)));    // 4\n                setColor(parentOf(x), BLACK);           // 4\n                setColor(rightOf(sib), BLACK);          // 4\n                rotateLeft(parentOf(x));                // 4\n                x = root;                               // 4\n            }\n        } else { // \n            Entry<K,V> sib = leftOf(parentOf(x));\n            if (colorOf(sib) == RED) {\n                setColor(sib, BLACK);                   // 5\n                setColor(parentOf(x), RED);             // 5\n                rotateRight(parentOf(x));               // 5\n                sib = leftOf(parentOf(x));              // 5\n            }\n            if (colorOf(rightOf(sib)) == BLACK &&\n                colorOf(leftOf(sib)) == BLACK) {\n                setColor(sib, RED);                     // 6\n                x = parentOf(x);                        // 6\n            } else {\n                if (colorOf(leftOf(sib)) == BLACK) {\n                    setColor(rightOf(sib), BLACK);      // 7\n                    setColor(sib, RED);                 // 7\n                    rotateLeft(sib);                    // 7\n                    sib = leftOf(parentOf(x));          // 7\n                }\n                setColor(sib, colorOf(parentOf(x)));    // 8\n                setColor(parentOf(x), BLACK);           // 8\n                setColor(leftOf(sib), BLACK);           // 8\n                rotateRight(parentOf(x));               // 8\n                x = root;                               // 8\n            }\n        }\n    }\n    setColor(x, BLACK);\n}\n\n\n\n# TreeSet\n\nTreeSetTreeMapTreeSetTreeMapTreeSet\n\n// TreeSetTreeMap\npublic class TreeSet<E> extends AbstractSet<E>\n    implements NavigableSet<E>, Cloneable, java.io.Serializable\n{\n......\n    private transient NavigableMap<E,Object> m;\n    // Dummy value to associate with an Object in the backing Map\n    private static final Object PRESENT = new Object();\n    public TreeSet() {\n        this.m = new TreeMap<E,Object>();// TreeSetTreeMap\n    }\n    ......\n    public boolean add(E e) {\n        return m.put(e, PRESENT)==null;\n    }\n    ......\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-TreeMap&TreeSet.html",normalizedContent:"# map - treeset & treemap \n\n> map - treeset & treemap \n\n * java 7 - treeset & treemap\n   * \n   * \n   * \n   * treeset\n\n\n# java 7 - treeset & treemap\n\n\n# \n\n_treeset__treemap_java___treeset__treemap_()**_treemap_\n\njava _treemap__sortedmap_key_map_key(natural ordering)(comparator)\n\n_treemap_(red-black tree)containskey(), get(), put(), remove()log(n)\n\n\n\n_treemap_(not synchronized)_treemap_(wrapped):\n\nsortedmap m = collections.synchronizedsortedmap(new treemap(...));\n\n(binary search tree):\n\n 1. \n 2. \n 3. ()\n 4. null()\n\n()34\n\n\n# \n\n: ** : (rotate left)(rotateright)**\n\n# \n\nxxxx\n\n\n\n_treemap_:\n\n//rotate left\nprivate void rotateleft(entry<k,v> p) {\n    if (p != null) {\n        entry<k,v> r = p.right;\n        p.right = r.left;\n        if (r.left != null)\n            r.left.parent = p;\n        r.parent = p.parent;\n        if (p.parent == null)\n            root = r;\n        else if (p.parent.left == p)\n            p.parent.left = r;\n        else\n            p.parent.right = r;\n        r.left = p;\n        p.parent = r;\n    }\n}\n\n\n# \n\nxxxx\n\n\n\n_treemap_:\n\n//rotate right\nprivate void rotateright(entry<k,v> p) {\n    if (p != null) {\n        entry<k,v> l = p.left;\n        p.left = l.right;\n        if (l.right != null) l.right.parent = p;\n        l.parent = p.parent;\n        if (p.parent == null)\n            root = l;\n        else if (p.parent.right == p)\n            p.parent.right = l;\n        else p.parent.left = l;\n        l.right = p;\n        p.parent = l;\n    }\n}\n\n\n# \n\nt(t):\n\n>  1. tt\n>  2. tt\n\n\n\n\n\n_treemap_:\n\n// successor()\nstatic <k,v> treemap.entry<k,v> successor(entry<k,v> t) {\n    if (t == null)\n        return null;\n    else if (t.right != null) {// 1. tt\n        entry<k,v> p = t.right;\n        while (p.left != null)\n            p = p.left;\n        return p;\n    } else {// 2. tt\n        entry<k,v> p = t.parent;\n        entry<k,v> ch = t;\n        while (p != null && ch == p.right) {\n            ch = p;\n            p = p.parent;\n        }\n        return p;\n    }\n}\n\n\n\n# \n\n# get()\n\nget(object key)keyvaluegetentry(object key)entryentry.valuegetentry()key()k.compareto(p.key) == 0entry\n\n\n\n:\n\n//getentry()\nfinal entry<k,v> getentry(object key) {\n    ......\n    if (key == null)//keynull\n        throw new nullpointerexception();\n    comparable<? super k> k = (comparable<? super k>) key;//\n    entry<k,v> p = root;\n    while (p != null) {\n        int cmp = k.compareto(p.key);\n        if (cmp < 0)//\n            p = p.left;\n        else if (cmp > 0)//\n            p = p.right;\n        else\n            return p;\n    }\n    return null;\n}\n\n\n# put()\n\nput(k key, v value)key, valuemapmapgetentry()entry()\n\npublic v put(k key, v value) {\n......\n    int cmp;\n    entry<k,v> parent;\n    if (key == null)\n        throw new nullpointerexception();\n    comparable<? super k> k = (comparable<? super k>) key;//\n    do {\n        parent = t;\n        cmp = k.compareto(t.key);\n        if (cmp < 0) t = t.left;//\n        else if (cmp > 0) t = t.right;//\n        else return t.setvalue(value);\n    } while (t != null);\n    entry<k,v> e = new entry<>(key, value, parent);//entry\n    if (cmp < 0) parent.left = e;\n    else parent.right = e;\n    fixafterinsertion(e);//\n    size++;\n    return null;\n}\n\n\n: entry()fixafterinsertion()1.2.\n\n\n\nfixafterinsertion()rotateleft()rotateright()2346\n\n//fixafterinsertion()\nprivate void fixafterinsertion(entry<k,v> x) {\n    x.color = red;\n    while (x != null && x != root && x.parent.color == red) {\n        if (parentof(x) == leftof(parentof(parentof(x)))) {\n            entry<k,v> y = rightof(parentof(parentof(x)));\n            if (colorof(y) == red) {\n                setcolor(parentof(x), black);              // 1\n                setcolor(y, black);                        // 1\n                setcolor(parentof(parentof(x)), red);      // 1\n                x = parentof(parentof(x));                 // 1\n            } else {\n                if (x == rightof(parentof(x))) {\n                    x = parentof(x);                       // 2\n                    rotateleft(x);                         // 2\n                }\n                setcolor(parentof(x), black);              // 3\n                setcolor(parentof(parentof(x)), red);      // 3\n                rotateright(parentof(parentof(x)));        // 3\n            }\n        } else {\n            entry<k,v> y = leftof(parentof(parentof(x)));\n            if (colorof(y) == red) {\n                setcolor(parentof(x), black);              // 4\n                setcolor(y, black);                        // 4\n                setcolor(parentof(parentof(x)), red);      // 4\n                x = parentof(parentof(x));                 // 4\n            } else {\n                if (x == leftof(parentof(x))) {\n                    x = parentof(x);                       // 5\n                    rotateright(x);                        // 5\n                }\n                setcolor(parentof(x), black);              // 6\n                setcolor(parentof(parentof(x)), red);      // 6\n                rotateleft(parentof(parentof(x)));         // 6\n            }\n        }\n    }\n    root.color = black;\n}\n\n\n# remove()\n\nremove(object key)keyentrygetentry(object key)keyentrydeleteentry(entry<k,v> entry)entry\n\ngetentry()deleteentry()entryfixafterdeletion(entry<k,v> x)\n\n:\n\n>  1. p\n>  2. p\n\n1p()p()2ps(x)p1s(s1.)\n\ndeleteentry():\n\n// entrydeleteentry()\nprivate void deleteentry(entry<k,v> p) {\n    modcount++;\n    size--;\n    if (p.left != null && p.right != null) {// 2. p\n        entry<k,v> s = successor(p);// \n        p.key = s.key;\n        p.value = s.value;\n        p = s;\n    }\n    entry<k,v> replacement = (p.left != null ? p.left : p.right);\n    if (replacement != null) {// 1. p\n        replacement.parent = p.parent;\n        if (p.parent == null)\n            root = replacement;\n        else if (p == p.parent.left)\n            p.parent.left  = replacement;\n        else\n            p.parent.right = replacement;\n        p.left = p.right = p.parent = null;\n        if (p.color == black)\n            fixafterdeletion(replacement);// \n    } else if (p.parent == null) {\n        root = null;\n    } else { // 1. p\n        if (p.color == black)\n            fixafterdeletion(p);// \n        if (p.parent != null) {\n            if (p == p.parent.left)\n                p.parent.left = null;\n            else if (p == p.parent.right)\n                p.parent.right = null;\n            p.parent = null;\n        }\n    }\n}\n\n\nfixafterdeletion()blackredblack4\n\nfixafterinsertion(): 1.2.\n\n\n\n: 12341: a).122(x)b).34(xroot)\n\nfixafterdeletion()rotateleft()rotateright()3458\n\nprivate void fixafterdeletion(entry<k,v> x) {\n    while (x != root && colorof(x) == black) {\n        if (x == leftof(parentof(x))) {\n            entry<k,v> sib = rightof(parentof(x));\n            if (colorof(sib) == red) {\n                setcolor(sib, black);                   // 1\n                setcolor(parentof(x), red);             // 1\n                rotateleft(parentof(x));                // 1\n                sib = rightof(parentof(x));             // 1\n            }\n            if (colorof(leftof(sib))  == black &&\n                colorof(rightof(sib)) == black) {\n                setcolor(sib, red);                     // 2\n                x = parentof(x);                        // 2\n            } else {\n                if (colorof(rightof(sib)) == black) {\n                    setcolor(leftof(sib), black);       // 3\n                    setcolor(sib, red);                 // 3\n                    rotateright(sib);                   // 3\n                    sib = rightof(parentof(x));         // 3\n                }\n                setcolor(sib, colorof(parentof(x)));    // 4\n                setcolor(parentof(x), black);           // 4\n                setcolor(rightof(sib), black);          // 4\n                rotateleft(parentof(x));                // 4\n                x = root;                               // 4\n            }\n        } else { // \n            entry<k,v> sib = leftof(parentof(x));\n            if (colorof(sib) == red) {\n                setcolor(sib, black);                   // 5\n                setcolor(parentof(x), red);             // 5\n                rotateright(parentof(x));               // 5\n                sib = leftof(parentof(x));              // 5\n            }\n            if (colorof(rightof(sib)) == black &&\n                colorof(leftof(sib)) == black) {\n                setcolor(sib, red);                     // 6\n                x = parentof(x);                        // 6\n            } else {\n                if (colorof(leftof(sib)) == black) {\n                    setcolor(rightof(sib), black);      // 7\n                    setcolor(sib, red);                 // 7\n                    rotateleft(sib);                    // 7\n                    sib = leftof(parentof(x));          // 7\n                }\n                setcolor(sib, colorof(parentof(x)));    // 8\n                setcolor(parentof(x), black);           // 8\n                setcolor(leftof(sib), black);           // 8\n                rotateright(parentof(x));               // 8\n                x = root;                               // 8\n            }\n        }\n    }\n    setcolor(x, black);\n}\n\n\n\n# treeset\n\ntreesettreemaptreesettreemaptreeset\n\n// treesettreemap\npublic class treeset<e> extends abstractset<e>\n    implements navigableset<e>, cloneable, java.io.serializable\n{\n......\n    private transient navigablemap<e,object> m;\n    // dummy value to associate with an object in the backing map\n    private static final object present = new object();\n    public treeset() {\n        this.m = new treemap<e,object>();// treesettreemap\n    }\n    ......\n    public boolean add(e e) {\n        return m.put(e, present)==null;\n    }\n    ......\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-treemap&treeset.html",charsets:{cjk:!0}},{title:"Map - LinkedHashSet&Map",frontmatter:{},regularPath:"/java/collection/java-map-LinkedHashMap&LinkedHashSet.html",relativePath:"java/collection/java-map-LinkedHashMap&LinkedHashSet.md",key:"v-6c3f60b6",path:"/java/collection/java-map-LinkedHashMap&LinkedHashSet.html",headers:[{level:2,title:"Map - LinkedHashSet&Map",slug:"map-linkedhashset-map",normalizedTitle:"map - linkedhashset&amp;map",charIndex:null},{level:2,title:"Java 7 - LinkedHashSet&Map",slug:"java-7-linkedhashset-map",normalizedTitle:"java 7 - linkedhashset&amp;map",charIndex:null},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:139},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:151},{level:3,title:"LinkedHashSet",slug:"linkedhashset",normalizedTitle:"linkedhashset",charIndex:8},{level:3,title:"LinkedHashMap",slug:"linkedhashmap",normalizedTitle:"linkedhashmap",charIndex:232},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:5566}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Map - LinkedHashSet&Map Java 7 - LinkedHashSet&Map   LinkedHashSet LinkedHashMap ",content:"# Map - LinkedHashSet&Map\n\n> Map - LinkedHashSet&Map \n\n * Map - LinkedHashSet&Map\n   * Java 7 - LinkedHashSet&Map\n     * \n     * \n       * get()\n       * put()\n       * remove()\n     * LinkedHashSet\n     * LinkedHashMap\n\n\n# Java 7 - LinkedHashSet&Map\n\n\n# \n\n_HashSet__HashMap__TreeSet__TreeMap__LinkedHashSet__LinkedHashMap_LinkedHashSet__LinkedHashMap_JavaLinkedHashSetLinkedHashMap()_LinkedHashMap\n\nLinkedHashMap__Map_keynullvaluenull_linked list__HashMap__HashMap__linked list_**_LinkedHashMap__linked list__HashMap**\n\n\n\n_LinkedHashMap__HashMap__LinkedHashMap__HashMap_(doubly-linked list)entry_LinkedHashMap__HashMap_header()entry\n\n : _LinkedHashMap__HashMap_tableheader_LinkedHashMap_entrytable\n\n_LinkedHashMap_: (inital capacity)(load factor)tableentrycapacity*load_factor\n\n_LinkedHashMap__LinkedHashSet_: hashCode()equals()hashCode()bucketequals()LinkedHashMapLinkedHashSet@Override hashCode()equals()\n\n_Map_ _LinkedHashMap_:\n\nvoid foo(Map m) {\n    Map copy = new LinkedHashMap(m);\n    ...\n}\n\n\n_LinkedHashMap_(not synchronized)_LinkedHashMap_(wrapped):\n\nMap m = Collections.synchronizedMap(new LinkedHashMap(...));\n\n\n# \n\n# get()\n\nget(Object key)keyvalueHashMap.get()\n\n# put()\n\nput(K key, V value)key, valuemapmapget()addEntry(int hash, K key, V value, int bucketIndex)entry\n\n:\n\n>  1. tableentrybucketentry\n>  2. headerentry\n\n\n\naddEntry():\n\n// LinkedHashMap.addEntry()\nvoid addEntry(int hash, K key, V value, int bucketIndex) {\n    if ((size >= threshold) && (null != table[bucketIndex])) {\n        resize(2 * table.length);// \n        hash = (null != key) ? hash(key) : 0;\n        bucketIndex = hash & (table.length-1);// hash%table.length\n    }\n    // 1.entry\n    HashMap.Entry<K,V> old = table[bucketIndex];\n    Entry<K,V> e = new Entry<>(hash, key, value, old);\n    table[bucketIndex] = e;\n    // 2.entry\n    e.addBefore(header);\n    size++;\n}\n\n\naddBefore()entry eheadereaddBefore():\n\n// LinkedHashMap.Entry.addBefor()thisexistingEntry\nprivate void addBefore(Entry<K,V> existingEntry) {\n    after  = existingEntry;\n    before = existingEntry.before;\n    before.after = this;\n    after.before = this;\n}\n\n\nentry\n\n# remove()\n\nremove(Object key)keyentryremoveEntryForKey(Object key)removeEntryForKey()keyentryentry()get()\n\n:\n\n>  1. tableentrybucket\n>  2. headerentry\n\n\n\nremoveEntryForKey():\n\n// LinkedHashMap.removeEntryForKey()keyentry\nfinal Entry<K,V> removeEntryForKey(Object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    int i = indexFor(hash, table.length);// hash&(table.length-1)\n    Entry<K,V> prev = table[i];// \n    Entry<K,V> e = prev;\n    while (e != null) {// \n        Entry<K,V> next = e.next;\n        Object k;\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k)))) {// entry\n            modCount++; size--;\n            // 1. ebucket\n            if (prev == e) table[i] = next;\n            else prev.next = next;\n            // 2. e\n            e.before.after = e.after;\n            e.after.before = e.before;\n            return e;\n        }\n        prev = e; e = next;\n    }\n    return e;\n}\n\n\n\n# LinkedHashSet\n\n_LinkedHashSet__LinkedHashMap__LinkedHashSet__LinkedHashMap__LinkedHashSet_\n\npublic class LinkedHashSet<E>\n    extends HashSet<E>\n    implements Set<E>, Cloneable, java.io.Serializable {\n    ......\n    // LinkedHashSetLinkedHashMap\n    public LinkedHashSet(int initialCapacity, float loadFactor) {\n        map = new LinkedHashMap<>(initialCapacity, loadFactor);\n    }\n......\n    public boolean add(E e) {//\n        return map.put(e, PRESENT)==null;\n    }\n    ......\n}\n\n\n\n# LinkedHashMap\n\n_LinkedHashMap_: FIFOLinkedHashMapprotected boolean removeEldestEntry(Map.Entry<K,V> eldest)MapEntryMapEntrytrueLinkedHashMapremoveEldestEntry()removeEldestEntry()trueFIFO:\n\n/** FIFO */\nclass FIFOCache<K, V> extends LinkedHashMap<K, V>{\n    private final int cacheSize;\n    public FIFOCache(int cacheSize){\n        this.cacheSize = cacheSize;\n    }\n\n    // EntrycacheSizeEntry\n    @Override\n    protected boolean removeEldestEntry(Map.Entry<K,V> eldest) {\n       return size() > cacheSize;\n    }\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-LinkedHashMap&LinkedHashSet.html",normalizedContent:"# map - linkedhashset&map\n\n> map - linkedhashset&map \n\n * map - linkedhashset&map\n   * java 7 - linkedhashset&map\n     * \n     * \n       * get()\n       * put()\n       * remove()\n     * linkedhashset\n     * linkedhashmap\n\n\n# java 7 - linkedhashset&map\n\n\n# \n\n_hashset__hashmap__treeset__treemap__linkedhashset__linkedhashmap_linkedhashset__linkedhashmap_javalinkedhashsetlinkedhashmap()_linkedhashmap\n\nlinkedhashmap__map_keynullvaluenull_linked list__hashmap__hashmap__linked list_**_linkedhashmap__linked list__hashmap**\n\n\n\n_linkedhashmap__hashmap__linkedhashmap__hashmap_(doubly-linked list)entry_linkedhashmap__hashmap_header()entry\n\n : _linkedhashmap__hashmap_tableheader_linkedhashmap_entrytable\n\n_linkedhashmap_: (inital capacity)(load factor)tableentrycapacity*load_factor\n\n_linkedhashmap__linkedhashset_: hashcode()equals()hashcode()bucketequals()linkedhashmaplinkedhashset@override hashcode()equals()\n\n_map_ _linkedhashmap_:\n\nvoid foo(map m) {\n    map copy = new linkedhashmap(m);\n    ...\n}\n\n\n_linkedhashmap_(not synchronized)_linkedhashmap_(wrapped):\n\nmap m = collections.synchronizedmap(new linkedhashmap(...));\n\n\n# \n\n# get()\n\nget(object key)keyvaluehashmap.get()\n\n# put()\n\nput(k key, v value)key, valuemapmapget()addentry(int hash, k key, v value, int bucketindex)entry\n\n:\n\n>  1. tableentrybucketentry\n>  2. headerentry\n\n\n\naddentry():\n\n// linkedhashmap.addentry()\nvoid addentry(int hash, k key, v value, int bucketindex) {\n    if ((size >= threshold) && (null != table[bucketindex])) {\n        resize(2 * table.length);// \n        hash = (null != key) ? hash(key) : 0;\n        bucketindex = hash & (table.length-1);// hash%table.length\n    }\n    // 1.entry\n    hashmap.entry<k,v> old = table[bucketindex];\n    entry<k,v> e = new entry<>(hash, key, value, old);\n    table[bucketindex] = e;\n    // 2.entry\n    e.addbefore(header);\n    size++;\n}\n\n\naddbefore()entry eheadereaddbefore():\n\n// linkedhashmap.entry.addbefor()thisexistingentry\nprivate void addbefore(entry<k,v> existingentry) {\n    after  = existingentry;\n    before = existingentry.before;\n    before.after = this;\n    after.before = this;\n}\n\n\nentry\n\n# remove()\n\nremove(object key)keyentryremoveentryforkey(object key)removeentryforkey()keyentryentry()get()\n\n:\n\n>  1. tableentrybucket\n>  2. headerentry\n\n\n\nremoveentryforkey():\n\n// linkedhashmap.removeentryforkey()keyentry\nfinal entry<k,v> removeentryforkey(object key) {\n......\nint hash = (key == null) ? 0 : hash(key);\n    int i = indexfor(hash, table.length);// hash&(table.length-1)\n    entry<k,v> prev = table[i];// \n    entry<k,v> e = prev;\n    while (e != null) {// \n        entry<k,v> next = e.next;\n        object k;\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k)))) {// entry\n            modcount++; size--;\n            // 1. ebucket\n            if (prev == e) table[i] = next;\n            else prev.next = next;\n            // 2. e\n            e.before.after = e.after;\n            e.after.before = e.before;\n            return e;\n        }\n        prev = e; e = next;\n    }\n    return e;\n}\n\n\n\n# linkedhashset\n\n_linkedhashset__linkedhashmap__linkedhashset__linkedhashmap__linkedhashset_\n\npublic class linkedhashset<e>\n    extends hashset<e>\n    implements set<e>, cloneable, java.io.serializable {\n    ......\n    // linkedhashsetlinkedhashmap\n    public linkedhashset(int initialcapacity, float loadfactor) {\n        map = new linkedhashmap<>(initialcapacity, loadfactor);\n    }\n......\n    public boolean add(e e) {//\n        return map.put(e, present)==null;\n    }\n    ......\n}\n\n\n\n# linkedhashmap\n\n_linkedhashmap_: fifolinkedhashmapprotected boolean removeeldestentry(map.entry<k,v> eldest)mapentrymapentrytruelinkedhashmapremoveeldestentry()removeeldestentry()truefifo:\n\n/** fifo */\nclass fifocache<k, v> extends linkedhashmap<k, v>{\n    private final int cachesize;\n    public fifocache(int cachesize){\n        this.cachesize = cachesize;\n    }\n\n    // entrycachesizeentry\n    @override\n    protected boolean removeeldestentry(map.entry<k,v> eldest) {\n       return size() > cachesize;\n    }\n}\n\n\n\n# \n\n *  https://www.pdai.tech/md/java/collection/java-map-linkedhashmap&linkedhashset.html",charsets:{cjk:!0}},{title:"Map - WeakHashMap",frontmatter:{},regularPath:"/java/collection/java-map-WeakHashMap.html",relativePath:"java/collection/java-map-WeakHashMap.md",key:"v-7b44edde",path:"/java/collection/java-map-WeakHashMap.html",headers:[{level:2,title:"Map - WeakHashMap",slug:"map-weakhashmap",normalizedTitle:"map - weakhashmap",charIndex:2},{level:2,title:"Java 7- WeakHashMap",slug:"java-7-weakhashmap",normalizedTitle:"java 7- weakhashmap",charIndex:91},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:118},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:130},{level:3,title:"Weak HashSet?",slug:"weak-hashset",normalizedTitle:"weak hashset?",charIndex:142},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:163}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Map - WeakHashMap Java 7- WeakHashMap   Weak HashSet? ",content:'# Map - WeakHashMap\n\n> Map - WeakHashMap \n\n * Map - WeakHashMap\n   * Java 7- WeakHashMap\n     * \n     * \n     * Weak HashSet?\n     * \n\n\n# Java 7- WeakHashMap\n\n\n# \n\nJava: WeakHashMap Map WeakHashMap entryGCremove()clear()\n\n WeakHashMap :\n\n>  * size()\n>  * isEmpty()falsetrue\n>  * containsKey()truefalsekey\n>  * get()valuenull\n\n? WeakHashMap MISS\n\n WeakHashMap  : (WeakReference)JavaGCGCGC() GC\n\nWeakHashMap entry WeakHashMap key, value WeakHashMap keyGC WeakHashMap key\n\nJavaGC\n\n\n# \n\nWeakHashMapMap - HashSet & HashMap \n\n\n\n\n# Weak HashSet?\n\n Map  Set :  WeakHashMap WeekHashSet ? :( Java _Collections_Collections.newSetFromMap(Map<E,Boolean> map) Map__Set Weak HashSet:\n\n// WeakHashMapSet\nSet<Object> weakHashSet = Collections.newSetFromMap(\n        new WeakHashMap<Object, Boolean>());\n\n\nnewSetFromMap() _Map_:\n\n// Collections.newSetFromMap()MapSet\npublic static <E> Set<E> newSetFromMap(Map<E, Boolean> map) {\n    return new SetFromMap<>(map);\n}\n\nprivate static class SetFromMap<E> extends AbstractSet<E>\n    implements Set<E>, Serializable\n{\n    private final Map<E, Boolean> m;  // The backing map\n    private transient Set<E> s;       // Its keySet\n    SetFromMap(Map<E, Boolean> map) {\n        if (!map.isEmpty())\n            throw new IllegalArgumentException("Map is non-empty");\n        m = map;\n        s = map.keySet();\n    }\n    public void clear()               {        m.clear(); }\n    public int size()                 { return m.size(); }\n    public boolean isEmpty()          { return m.isEmpty(); }\n    public boolean contains(Object o) { return m.containsKey(o); }\n    public boolean remove(Object o)   { return m.remove(o) != null; }\n    public boolean add(E e) { return m.put(e, Boolean.TRUE) == null; }\n    public Iterator<E> iterator()     { return s.iterator(); }\n    public Object[] toArray()         { return s.toArray(); }\n    public <T> T[] toArray(T[] a)     { return s.toArray(a); }\n    public String toString()          { return s.toString(); }\n    public int hashCode()             { return s.hashCode(); }\n    public boolean equals(Object o)   { return o == this || s.equals(o); }\n    public boolean containsAll(Collection<?> c) {return s.containsAll(c);}\n    public boolean removeAll(Collection<?> c)   {return s.removeAll(c);}\n    public boolean retainAll(Collection<?> c)   {return s.retainAll(c);}\n    // addAll is the only inherited implementation\n    ......\n}\n\n\n\n\n# \n\n * WeakHashMap https://www.cnblogs.com/CarpenterLee/p/5544598.html\n *  https://www.pdai.tech/md/java/collection/java-map-WeakHashMap.html',normalizedContent:'# map - weakhashmap\n\n> map - weakhashmap \n\n * map - weakhashmap\n   * java 7- weakhashmap\n     * \n     * \n     * weak hashset?\n     * \n\n\n# java 7- weakhashmap\n\n\n# \n\njava: weakhashmap map weakhashmap entrygcremove()clear()\n\n weakhashmap :\n\n>  * size()\n>  * isempty()falsetrue\n>  * containskey()truefalsekey\n>  * get()valuenull\n\n? weakhashmap miss\n\n weakhashmap  : (weakreference)javagcgcgc() gc\n\nweakhashmap entry weakhashmap key, value weakhashmap keygc weakhashmap key\n\njavagc\n\n\n# \n\nweakhashmapmap - hashset & hashmap \n\n\n\n\n# weak hashset?\n\n map  set :  weakhashmap weekhashset ? :( java _collections_collections.newsetfrommap(map<e,boolean> map) map__set weak hashset:\n\n// weakhashmapset\nset<object> weakhashset = collections.newsetfrommap(\n        new weakhashmap<object, boolean>());\n\n\nnewsetfrommap() _map_:\n\n// collections.newsetfrommap()mapset\npublic static <e> set<e> newsetfrommap(map<e, boolean> map) {\n    return new setfrommap<>(map);\n}\n\nprivate static class setfrommap<e> extends abstractset<e>\n    implements set<e>, serializable\n{\n    private final map<e, boolean> m;  // the backing map\n    private transient set<e> s;       // its keyset\n    setfrommap(map<e, boolean> map) {\n        if (!map.isempty())\n            throw new illegalargumentexception("map is non-empty");\n        m = map;\n        s = map.keyset();\n    }\n    public void clear()               {        m.clear(); }\n    public int size()                 { return m.size(); }\n    public boolean isempty()          { return m.isempty(); }\n    public boolean contains(object o) { return m.containskey(o); }\n    public boolean remove(object o)   { return m.remove(o) != null; }\n    public boolean add(e e) { return m.put(e, boolean.true) == null; }\n    public iterator<e> iterator()     { return s.iterator(); }\n    public object[] toarray()         { return s.toarray(); }\n    public <t> t[] toarray(t[] a)     { return s.toarray(a); }\n    public string tostring()          { return s.tostring(); }\n    public int hashcode()             { return s.hashcode(); }\n    public boolean equals(object o)   { return o == this || s.equals(o); }\n    public boolean containsall(collection<?> c) {return s.containsall(c);}\n    public boolean removeall(collection<?> c)   {return s.removeall(c);}\n    public boolean retainall(collection<?> c)   {return s.retainall(c);}\n    // addall is the only inherited implementation\n    ......\n}\n\n\n\n\n# \n\n * weakhashmap https://www.cnblogs.com/carpenterlee/p/5544598.html\n *  https://www.pdai.tech/md/java/collection/java-map-weakhashmap.html',charsets:{cjk:!0}},{title:"Java AIO - IO",frontmatter:{},regularPath:"/java/io/java-io-aio.html",relativePath:"java/io/java-io-aio.md",key:"v-3d73bcce",path:"/java/io/java-io-aio.html",headers:[{level:2,title:"Java AIO - IO",slug:"java-aio-io",normalizedTitle:"java aio - io",charIndex:2},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:13},{level:2,title:"JAVAAIO",slug:"javaaio",normalizedTitle:"javaaio",charIndex:91},{level:3,title:"JAVA AIO",slug:"java-aio",normalizedTitle:"java aio",charIndex:110},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:130},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:142},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:154},{level:2,title:"Netty",slug:"netty",normalizedTitle:"netty",charIndex:166},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:182}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java AIO - IO IO JAVAAIO JAVA AIO    Netty ",content:'# Java AIO - IO\n\n> IOJavaAIO@pdai\n\n * Java AIO - IO\n   * IO\n   * JAVAAIO\n     * JAVA AIO\n     * \n     * \n     * \n   * Netty\n   * \n\n\n# IO\n\nIOIOIO IOJAVAIOIOIOIO\n\nIO-: IOIO:\n\n\n\nIOIOwindowsIO: IOCP(I/O Completion PortI/O)\n\nLinuxIOepoll(IO)IO\n\n\n# JAVAAIO\n\n\n# JAVA AIO\n\n\n\nJAVA AIO\n\nJAVA AIOwindowswindows IOCPLinuxepollIOIOJAVA AIOWindowssun.nio.ch.WindowsAsynchronousSocketChannelImplIOCP:\n\n/** \n* Windows implementation of AsynchronousChannelGroup encapsulating an I/O \n* completion port. \n*/\n\n\n(java.nio.channels.spi.AsynchronousChannelProvider)\n\njava.nio.channels.NetworkChannelJAVA NIO:\n\n\n\n\n# \n\nJAVA AIO:\n\npackage testASocket;\n\nimport java.io.IOException;\nimport java.io.UnsupportedEncodingException;\nimport java.net.InetSocketAddress;\nimport java.nio.ByteBuffer;\nimport java.nio.channels.AsynchronousChannelGroup;\nimport java.nio.channels.AsynchronousServerSocketChannel;\nimport java.nio.channels.AsynchronousSocketChannel;\nimport java.nio.channels.CompletionHandler;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\n/**\n * @author yinwenjie\n */\npublic class SocketServer {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    private static final Object waitObject = new Object();\n\n    /**\n     * @param args\n     * @throws Exception\n     */\n    public static void main(String[] args) throws Exception {\n        /*\n         * \n         * 1ExecutorsAPI Doc\n         * 2ThreadPoolExecutor\n         * 3IOIO()\n         * 4()AsynchronousServerSocketChannel.open()\n         * */\n        ExecutorService threadPool = Executors.newFixedThreadPool(20);\n        AsynchronousChannelGroup group = AsynchronousChannelGroup.withThreadPool(threadPool);\n        final AsynchronousServerSocketChannel serverSocket = AsynchronousServerSocketChannel.open(group);\n\n        //0.0.0.0IP\n        serverSocket.bind(new InetSocketAddress("0.0.0.0", 83));\n        //AsynchronousServerSocketChannelAsynchronousServerSocketChannel\n        //  socketchannel\n        serverSocket.accept(null, new ServerSocketChannelHandle(serverSocket));\n\n        //()\n        synchronized(waitObject) {\n            waitObject.wait();\n        }\n    }\n}\n\n/**\n *  ServerSocketChannel \n * @author yinwenjie\n */\nclass ServerSocketChannelHandle implements CompletionHandler<AsynchronousSocketChannel, Void> {\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(ServerSocketChannelHandle.class);\n\n    private AsynchronousServerSocketChannel serverSocketChannel;\n\n    /**\n     * @param serverSocketChannel\n     */\n    public ServerSocketChannelHandle(AsynchronousServerSocketChannel serverSocketChannel) {\n        this.serverSocketChannel = serverSocketChannel;\n    }\n\n    /**\n     *  thissocketChannelattachmentid\n     * ServerSocketChannelHandle\n     */\n    @Override\n    public void completed(AsynchronousSocketChannel socketChannel, Void attachment) {\n        ServerSocketChannelHandle.LOGGER.info("completed(AsynchronousSocketChannel result, ByteBuffer attachment)");\n        //()\n        this.serverSocketChannel.accept(attachment, this);\n\n        //socketChannelread\n        //stringbufferchannel\n        //\n        ByteBuffer readBuffer = ByteBuffer.allocate(50);\n        socketChannel.read(readBuffer, new StringBuffer(), new SocketChannelReadHandle(socketChannel , readBuffer));\n    }\n\n    /* (non-Javadoc)\n     * @see java.nio.channels.CompletionHandler#failed(java.lang.Throwable, java.lang.Object)\n     */\n    @Override\n    public void failed(Throwable exc, Void attachment) {\n        ServerSocketChannelHandle.LOGGER.info("failed(Throwable exc, ByteBuffer attachment)");\n    }\n}\n\n/**\n * socketChannel<p>\n * \n * : socketchannelSocketChannelReadHandle(CompletionHandler)\n * FileDescriptor\n * Buffer(ByteBuffer)\n * JAVA AIO<p>\n * \n * channel: AsynchronousChannelProvidersocketchannel\n * (AsynchronousChannelProvider)\n * @author yinwenjie\n */\nclass SocketChannelReadHandle implements CompletionHandler<Integer, StringBuffer> {\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketChannelReadHandle.class);\n\n    private AsynchronousSocketChannel socketChannel;\n\n    /**\n     * ByteBuffer<br>\n     * CompletionHandlerattachment<br>\n     * attachmentStringbuffer\n     */\n    private ByteBuffer byteBuffer;\n\n    public SocketChannelReadHandle(AsynchronousSocketChannel socketChannel , ByteBuffer byteBuffer) {\n        this.socketChannel = socketChannel;\n        this.byteBuffer = byteBuffer;\n    }\n\n    /* (non-Javadoc)\n     * @see java.nio.channels.CompletionHandler#completed(java.lang.Object, java.lang.Object)\n     */\n    @Override\n    public void completed(Integer result, StringBuffer historyContext) {\n        //TCP\n        if(result == -1) {\n            try {\n                this.socketChannel.close();\n            } catch (IOException e) {\n                SocketChannelReadHandle.LOGGER.error(e);\n            }\n            return;\n        }\n\n        SocketChannelReadHandle.LOGGER.info("completed(Integer result, Void attachment) : ");\n        /*\n         * Integer resultchannel\n         * \n         * \n         * JAVA AIOJAVA NIObuffer\n         * JAVA AIOJAVA AIO()\n         * */\n        this.byteBuffer.flip();\n        byte[] contexts = new byte[1024];\n        this.byteBuffer.get(contexts, 0, result);\n        this.byteBuffer.clear();\n        try {\n            String nowContent = new String(contexts , 0 , result , "UTF-8");\n            historyContext.append(nowContent);\n            SocketChannelReadHandle.LOGGER.info("================: " + historyContext);\n        } catch (UnsupportedEncodingException e) {\n            SocketChannelReadHandle.LOGGER.error(e);\n        }\n\n        //\n        if(historyContext.indexOf("over") == -1) {\n            return;\n        }\n\n        //=========================================================================\n        //          over\n        //=========================================================================\n        SocketChannelReadHandle.LOGGER.info("================");\n        historyContext = new StringBuffer();\n\n        //()\n        this.socketChannel.read(this.byteBuffer, historyContext, this);\n    }\n\n    /* (non-Javadoc)\n     * @see java.nio.channels.CompletionHandler#failed(java.lang.Throwable, java.lang.Object)\n     */\n    @Override\n    public void failed(Throwable exc, StringBuffer historyContext) {\n        SocketChannelReadHandle.LOGGER.info("=====TCP");\n        try {\n            this.socketChannel.close();\n        } catch (IOException e) {\n            SocketChannelReadHandle.LOGGER.error(e);\n        }\n    }\n}\n\n\n\n# \n\nJAVA NIOselector()IOJAVA AIO-selector()channel\n\nJAVA AIOIOAsynchronousServerSocketChannel()AsynchronousSocketChannel(socket)fileDescriptor()attachment()SocketChannelReadHandledebug:\n\n( TCP Socket:\n\n\n\n12WindowsAsynchronousSocketChannelImpl:\n\n\n\n1: WindowsAsynchronousSocketChannelImpl: 760 | FileDescriptor: 762\n\n2: WindowsAsynchronousSocketChannelImpl: 792 | FileDescriptor: 797\n\n12:\n\n\n\n1: WindowsAsynchronousSocketChannelImpl: 760 | FileDescriptor: 762 | SocketChannelReadHandle: 803 | HeapByteBuffer: 808\n\n2: WindowsAsynchronousSocketChannelImpl: 792 | FileDescriptor: 797 | SocketChannelReadHandle: 828 | HeapByteBuffer: 833\n\nSocketChannelReadHandle()SocketChannel\n\nJAVA NIOJAVA AIOSelectorChannelBufferJAVA NIOJAVA AIOIO\n\n\n# \n\nJAVA AIO:\n\nJAVA AIO\n\nJAVA AIO  JAVA NIO ()()JAVA AIOJAVA AIO-_\n\nNettyMina\n\n\n# Netty\n\n * JAVA NIO / JAVA AIOJAVA NIONettyMINA? : :\n\n * JAVA NIO  JAVA AIO IO/IO Protocol BufferJSONNetty()\n\n * ()NIO/AIO : Netty\n\n * JAVA NIOpoll/epoll bug: Selector doesnt block on Selector.select(timeout)blockCPU100%(JNI)bugLinux\n\n * JDK 1.7: http://bugs.java.com/bugdatabase/view_bug.do?bug_id=2147719Netty 4.0JAVA NIO(NettyNioServerSocketChannel)Nettybug\n\n * Netty\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48784375',normalizedContent:'# java aio - io\n\n> iojavaaio@pdai\n\n * java aio - io\n   * io\n   * javaaio\n     * java aio\n     * \n     * \n     * \n   * netty\n   * \n\n\n# io\n\nioioio iojavaioioioio\n\nio-: ioio:\n\n\n\nioiowindowsio: iocp(i/o completion porti/o)\n\nlinuxioepoll(io)io\n\n\n# javaaio\n\n\n# java aio\n\n\n\njava aio\n\njava aiowindowswindows iocplinuxepollioiojava aiowindowssun.nio.ch.windowsasynchronoussocketchannelimpliocp:\n\n/** \n* windows implementation of asynchronouschannelgroup encapsulating an i/o \n* completion port. \n*/\n\n\n(java.nio.channels.spi.asynchronouschannelprovider)\n\njava.nio.channels.networkchanneljava nio:\n\n\n\n\n# \n\njava aio:\n\npackage testasocket;\n\nimport java.io.ioexception;\nimport java.io.unsupportedencodingexception;\nimport java.net.inetsocketaddress;\nimport java.nio.bytebuffer;\nimport java.nio.channels.asynchronouschannelgroup;\nimport java.nio.channels.asynchronousserversocketchannel;\nimport java.nio.channels.asynchronoussocketchannel;\nimport java.nio.channels.completionhandler;\nimport java.util.concurrent.executorservice;\nimport java.util.concurrent.executors;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\n/**\n * @author yinwenjie\n */\npublic class socketserver {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    private static final object waitobject = new object();\n\n    /**\n     * @param args\n     * @throws exception\n     */\n    public static void main(string[] args) throws exception {\n        /*\n         * \n         * 1executorsapi doc\n         * 2threadpoolexecutor\n         * 3ioio()\n         * 4()asynchronousserversocketchannel.open()\n         * */\n        executorservice threadpool = executors.newfixedthreadpool(20);\n        asynchronouschannelgroup group = asynchronouschannelgroup.withthreadpool(threadpool);\n        final asynchronousserversocketchannel serversocket = asynchronousserversocketchannel.open(group);\n\n        //0.0.0.0ip\n        serversocket.bind(new inetsocketaddress("0.0.0.0", 83));\n        //asynchronousserversocketchannelasynchronousserversocketchannel\n        //  socketchannel\n        serversocket.accept(null, new serversocketchannelhandle(serversocket));\n\n        //()\n        synchronized(waitobject) {\n            waitobject.wait();\n        }\n    }\n}\n\n/**\n *  serversocketchannel \n * @author yinwenjie\n */\nclass serversocketchannelhandle implements completionhandler<asynchronoussocketchannel, void> {\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(serversocketchannelhandle.class);\n\n    private asynchronousserversocketchannel serversocketchannel;\n\n    /**\n     * @param serversocketchannel\n     */\n    public serversocketchannelhandle(asynchronousserversocketchannel serversocketchannel) {\n        this.serversocketchannel = serversocketchannel;\n    }\n\n    /**\n     *  thissocketchannelattachmentid\n     * serversocketchannelhandle\n     */\n    @override\n    public void completed(asynchronoussocketchannel socketchannel, void attachment) {\n        serversocketchannelhandle.logger.info("completed(asynchronoussocketchannel result, bytebuffer attachment)");\n        //()\n        this.serversocketchannel.accept(attachment, this);\n\n        //socketchannelread\n        //stringbufferchannel\n        //\n        bytebuffer readbuffer = bytebuffer.allocate(50);\n        socketchannel.read(readbuffer, new stringbuffer(), new socketchannelreadhandle(socketchannel , readbuffer));\n    }\n\n    /* (non-javadoc)\n     * @see java.nio.channels.completionhandler#failed(java.lang.throwable, java.lang.object)\n     */\n    @override\n    public void failed(throwable exc, void attachment) {\n        serversocketchannelhandle.logger.info("failed(throwable exc, bytebuffer attachment)");\n    }\n}\n\n/**\n * socketchannel<p>\n * \n * : socketchannelsocketchannelreadhandle(completionhandler)\n * filedescriptor\n * buffer(bytebuffer)\n * java aio<p>\n * \n * channel: asynchronouschannelprovidersocketchannel\n * (asynchronouschannelprovider)\n * @author yinwenjie\n */\nclass socketchannelreadhandle implements completionhandler<integer, stringbuffer> {\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketchannelreadhandle.class);\n\n    private asynchronoussocketchannel socketchannel;\n\n    /**\n     * bytebuffer<br>\n     * completionhandlerattachment<br>\n     * attachmentstringbuffer\n     */\n    private bytebuffer bytebuffer;\n\n    public socketchannelreadhandle(asynchronoussocketchannel socketchannel , bytebuffer bytebuffer) {\n        this.socketchannel = socketchannel;\n        this.bytebuffer = bytebuffer;\n    }\n\n    /* (non-javadoc)\n     * @see java.nio.channels.completionhandler#completed(java.lang.object, java.lang.object)\n     */\n    @override\n    public void completed(integer result, stringbuffer historycontext) {\n        //tcp\n        if(result == -1) {\n            try {\n                this.socketchannel.close();\n            } catch (ioexception e) {\n                socketchannelreadhandle.logger.error(e);\n            }\n            return;\n        }\n\n        socketchannelreadhandle.logger.info("completed(integer result, void attachment) : ");\n        /*\n         * integer resultchannel\n         * \n         * \n         * java aiojava niobuffer\n         * java aiojava aio()\n         * */\n        this.bytebuffer.flip();\n        byte[] contexts = new byte[1024];\n        this.bytebuffer.get(contexts, 0, result);\n        this.bytebuffer.clear();\n        try {\n            string nowcontent = new string(contexts , 0 , result , "utf-8");\n            historycontext.append(nowcontent);\n            socketchannelreadhandle.logger.info("================: " + historycontext);\n        } catch (unsupportedencodingexception e) {\n            socketchannelreadhandle.logger.error(e);\n        }\n\n        //\n        if(historycontext.indexof("over") == -1) {\n            return;\n        }\n\n        //=========================================================================\n        //          over\n        //=========================================================================\n        socketchannelreadhandle.logger.info("================");\n        historycontext = new stringbuffer();\n\n        //()\n        this.socketchannel.read(this.bytebuffer, historycontext, this);\n    }\n\n    /* (non-javadoc)\n     * @see java.nio.channels.completionhandler#failed(java.lang.throwable, java.lang.object)\n     */\n    @override\n    public void failed(throwable exc, stringbuffer historycontext) {\n        socketchannelreadhandle.logger.info("=====tcp");\n        try {\n            this.socketchannel.close();\n        } catch (ioexception e) {\n            socketchannelreadhandle.logger.error(e);\n        }\n    }\n}\n\n\n\n# \n\njava nioselector()iojava aio-selector()channel\n\njava aioioasynchronousserversocketchannel()asynchronoussocketchannel(socket)filedescriptor()attachment()socketchannelreadhandledebug:\n\n( tcp socket:\n\n\n\n12windowsasynchronoussocketchannelimpl:\n\n\n\n1: windowsasynchronoussocketchannelimpl: 760 | filedescriptor: 762\n\n2: windowsasynchronoussocketchannelimpl: 792 | filedescriptor: 797\n\n12:\n\n\n\n1: windowsasynchronoussocketchannelimpl: 760 | filedescriptor: 762 | socketchannelreadhandle: 803 | heapbytebuffer: 808\n\n2: windowsasynchronoussocketchannelimpl: 792 | filedescriptor: 797 | socketchannelreadhandle: 828 | heapbytebuffer: 833\n\nsocketchannelreadhandle()socketchannel\n\njava niojava aioselectorchannelbufferjava niojava aioio\n\n\n# \n\njava aio:\n\njava aio\n\njava aio  java nio ()()java aiojava aio-_\n\nnettymina\n\n\n# netty\n\n * java nio / java aiojava nionettymina? : :\n\n * java nio  java aio io/io protocol bufferjsonnetty()\n\n * ()nio/aio : netty\n\n * java niopoll/epoll bug: selector doesnt block on selector.select(timeout)blockcpu100%(jni)buglinux\n\n * jdk 1.7: http://bugs.java.com/bugdatabase/view_bug.do?bug_id=2147719netty 4.0java nio(nettynioserversocketchannel)nettybug\n\n * netty\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48784375',charsets:{cjk:!0}},{title:"Java IO - ()",frontmatter:{},regularPath:"/java/io/java-io-basic-category.html",relativePath:"java/io/java-io-basic-category.md",key:"v-5764f320",path:"/java/io/java-io-basic-category.html",headers:[{level:2,title:"Java IO - ()",slug:"java-io---",normalizedTitle:"java io - ()",charIndex:2},{level:2,title:"IO - ",slug:"io-",normalizedTitle:"io - ",charIndex:91},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:114},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:125},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:136},{level:3,title:"Input/OutputStreamReader/Writer",slug:"input-outputstreamreader-writer",normalizedTitle:"input/outputstreamreader/writer",charIndex:154},{level:2,title:"IO - ",slug:"io-",normalizedTitle:"io - ",charIndex:196},{level:3,title:"(file)",slug:"-file",normalizedTitle:"(file)",charIndex:219},{level:3,title:"(\\[\\])",slug:"",normalizedTitle:"([])",charIndex:235},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:249},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:261},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:275},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:287},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:297},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:314}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO - () IO -     Input/OutputStreamReader/Writer IO -  (file) (\\[\\])      ",content:"# Java IO - ()\n\n> Java IO@pdai\n\n * Java IO - ()\n   * IO - \n     * \n     * \n     * \n     * Input/OutputStreamReader/Writer\n   * IO - \n     * (file)\n     * ([])\n     * \n     * \n     * \n     * \n     * \n     * \n\n\n# IO - \n\n IO :\n\n * \n * \n\n\n\n\n# \n\n()\n\n\n\n\n# \n\n()\n\n\n\n\n# \n\n * ( UTF-8  3 GBK 2 )\n * (MP3)()\n\n> \n\n\n# Input/OutputStreamReader/Writer\n\n\n\n\n\n * GBK  2  1 \n * UTF-8  3  1 \n * UTF-16be  2 \n\nUTF-16be  be  Big Endian UTF-16lele  Little Endian\n\nJava  UTF-16be Java  char  UTF-16be char  16 Java  char \n\n\n\n\n# IO - \n\nIO :\n\n\n\n\n# (file)\n\nFileInputStreamFileOutputStreamFileReaderFileWriter\n\n\n# ([])\n\n * (byte[]): ByteArrayInputStreamByteArrayOutputStream\n * (char[]): CharArrayReaderCharArrayWriter\n\n\n# \n\nPipedInputStreamPipedOutputStreamPipedReaderPipedWriter\n\n\n# \n\nDataInputStreamDataOutputStream\n\n\n# \n\nBufferedInputStreamBufferedOutputStreamBufferedReaderBufferedWriter\n\n\n# \n\nPrintStreamPrintWriter\n\n\n# \n\nObjectInputStreamObjectOutputStream\n\n\n# \n\nInputStreamReaderOutputStreamWriter",normalizedContent:"# java io - ()\n\n> java io@pdai\n\n * java io - ()\n   * io - \n     * \n     * \n     * \n     * input/outputstreamreader/writer\n   * io - \n     * (file)\n     * ([])\n     * \n     * \n     * \n     * \n     * \n     * \n\n\n# io - \n\n io :\n\n * \n * \n\n\n\n\n# \n\n()\n\n\n\n\n# \n\n()\n\n\n\n\n# \n\n * ( utf-8  3 gbk 2 )\n * (mp3)()\n\n> \n\n\n# input/outputstreamreader/writer\n\n\n\n\n\n * gbk  2  1 \n * utf-8  3  1 \n * utf-16be  2 \n\nutf-16be  be  big endian utf-16lele  little endian\n\njava  utf-16be java  char  utf-16be char  16 java  char \n\n\n\n\n# io - \n\nio :\n\n\n\n\n# (file)\n\nfileinputstreamfileoutputstreamfilereaderfilewriter\n\n\n# ([])\n\n * (byte[]): bytearrayinputstreambytearrayoutputstream\n * (char[]): chararrayreaderchararraywriter\n\n\n# \n\npipedinputstreampipedoutputstreampipedreaderpipedwriter\n\n\n# \n\ndatainputstreamdataoutputstream\n\n\n# \n\nbufferedinputstreambufferedoutputstreambufferedreaderbufferedwriter\n\n\n# \n\nprintstreamprintwriter\n\n\n# \n\nobjectinputstreamobjectoutputstream\n\n\n# \n\ninputstreamreaderoutputstreamwriter",charsets:{cjk:!0}},{title:"Java IO - : InputStream",frontmatter:{},regularPath:"/java/io/java-io-basic-code-inputstream.html",relativePath:"java/io/java-io-basic-code-inputstream.md",key:"v-4eee7d98",path:"/java/io/java-io-basic-code-inputstream.html",headers:[{level:2,title:"Java IO - : InputStream",slug:"java-io--inputstream",normalizedTitle:"java io - : inputstream",charIndex:2},{level:2,title:"InputStream ",slug:"inputstream-",normalizedTitle:"inputstream ",charIndex:103},{level:2,title:"InputStream ",slug:"inputstream-",normalizedTitle:"inputstream ",charIndex:126},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:147},{level:3,title:"InputStream",slug:"inputstream",normalizedTitle:"inputstream",charIndex:16},{level:3,title:"FilterInputStream",slug:"filterinputstream",normalizedTitle:"filterinputstream",charIndex:178},{level:3,title:"ByteArrayInputStream",slug:"bytearrayinputstream",normalizedTitle:"bytearrayinputstream",charIndex:203},{level:3,title:"BufferedInputStream",slug:"bufferedinputstream",normalizedTitle:"bufferedinputstream",charIndex:231},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:256}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO - : InputStream InputStream  InputStream   InputStream FilterInputStream ByteArrayInputStream BufferedInputStream ",content:'# Java IO - : InputStream\n\n> JDK 11 InputStream @pdai\n\n * Java IO - : InputStream\n   * InputStream \n   * InputStream \n   * \n     * InputStream\n     * FilterInputStream\n     * ByteArrayInputStream\n     * BufferedInputStream\n   * \n\n\n# InputStream \n\n> InputStream\n\n\n\n\n# InputStream \n\nInputStream \n\n// -1\npublic abstract int read() \n\n//  byte read(byte b[], int off, int len)\npublic int read(byte b[]) \n\n//  off <b>()</b> len  byte  -1 ; stream\npublic int read(byte b[], int off, int len) \n\n// JDK9 InputStream readNBytes(Integer.MAX_VALUE)\npublic byte[] readAllBytes()\n\n// JDK11 InputStream \npublic byte[] readNBytes(int len)\n\n// JDK9byte \npublic int readNBytes(byte[] b, int off, int len)\n\n// \npublic long skip(long n) \n\n// \npublic int available() \n\n// \npublic void close() \n\n//  markSupport() \npublic synchronized void mark(int readlimit) \n\n//  mark \npublic synchronized void reset() \n\n// \npublic boolean markSupported() \n\n// JDK9 InputStream  OutputStream \npublic long transferTo(OutputStream out)\n\n\n\n\n# \n\n> InputStream\n\n\n# InputStream\n\nInputStream\n\npublic abstract class InputStream implements Closeable {\n    \n    // skipbuffer size\n    private static final int MAX_SKIP_BUFFER_SIZE = 2048;\n\n    // buffer size\n    private static final int DEFAULT_BUFFER_SIZE = 8192;\n\n    // JDK11nullInputStream\n    public static InputStream nullInputStream() {\n        return new InputStream() {\n            private volatile boolean closed;\n\n            private void ensureOpen() throws IOException {\n                if (closed) {\n                    throw new IOException("Stream closed");\n                }\n            }\n\n            @Override\n            public int available () throws IOException {\n                ensureOpen();\n                return 0;\n            }\n\n            @Override\n            public int read() throws IOException {\n                ensureOpen();\n                return -1;\n            }\n\n            @Override\n            public int read(byte[] b, int off, int len) throws IOException {\n                Objects.checkFromIndexSize(off, len, b.length);\n                if (len == 0) {\n                    return 0;\n                }\n                ensureOpen();\n                return -1;\n            }\n\n            @Override\n            public byte[] readAllBytes() throws IOException {\n                ensureOpen();\n                return new byte[0];\n            }\n\n            @Override\n            public int readNBytes(byte[] b, int off, int len)\n                throws IOException {\n                Objects.checkFromIndexSize(off, len, b.length);\n                ensureOpen();\n                return 0;\n            }\n\n            @Override\n            public byte[] readNBytes(int len) throws IOException {\n                if (len < 0) {\n                    throw new IllegalArgumentException("len < 0");\n                }\n                ensureOpen();\n                return new byte[0];\n            }\n\n            @Override\n            public long skip(long n) throws IOException {\n                ensureOpen();\n                return 0L;\n            }\n\n            @Override\n            public long transferTo(OutputStream out) throws IOException {\n                Objects.requireNonNull(out);\n                ensureOpen();\n                return 0L;\n            }\n\n            @Override\n            public void close() throws IOException {\n                closed = true;\n            }\n        };\n    }\n    \n    // -1\n    public abstract int read() throws IOException;\n\n    //  byte read(byte b[], int off, int len)\n    public int read(byte b[]) throws IOException {\n        return read(b, 0, b.length);\n    }\n\n    //  off <b>()</b> len  byte  -1 ; stream\n    public int read(byte b[], int off, int len) throws IOException {\n        // \n        Objects.checkFromIndexSize(off, len, b.length);\n        if (len == 0) {\n            return 0;\n        }\n\n        // \n        int c = read();\n        if (c == -1) { // stream-1\n            return -1;\n        }\n        b[off] = (byte)c;\n\n        // i\n        int i = 1;\n        try {\n            // \n            for (; i < len ; i++) {\n                c = read();\n                if (c == -1) {// streambreak\n                    break;\n                }\n                b[off + i] = (byte)c;\n            }\n        } catch (IOException ee) {\n        }\n        // \n        return i;\n    }\n\n    // \n    // VMOutOfMemoryErrorVM\n    private static final int MAX_BUFFER_SIZE = Integer.MAX_VALUE - 8;\n\n    // JDK9 InputStream readNBytes(Integer.MAX_VALUE)\n    public byte[] readAllBytes() throws IOException {\n        return readNBytes(Integer.MAX_VALUE);\n    }\n\n    // JDK11 InputStream \n    public byte[] readNBytes(int len) throws IOException {\n        // \n        if (len < 0) {\n            throw new IllegalArgumentException("len < 0");\n        }\n\n        List<byte[]> bufs = null; // bufsresult\n        byte[] result = null; // \n        int total = 0;\n        int remaining = len; // \n        int n;\n        do {\n            byte[] buf = new byte[Math.min(remaining, DEFAULT_BUFFER_SIZE)];\n            int nread = 0;\n\n            // n\n            while ((n = read(buf, nread,\n                    Math.min(buf.length - nread, remaining))) > 0) {\n                nread += n; \n                remaining -= n;\n            }\n\n            if (nread > 0) {\n                if (MAX_BUFFER_SIZE - total < nread) {\n                    throw new OutOfMemoryError("Required array size too large");\n                }\n                total += nread;\n                if (result == null) {\n                    result = buf;\n                } else {\n                    if (bufs == null) {\n                        bufs = new ArrayList<>();\n                        bufs.add(result);\n                    }\n                    bufs.add(buf);\n                }\n            }\n            // -1\n        } while (n >= 0 && remaining > 0);\n\n        if (bufs == null) {\n            if (result == null) {\n                return new byte[0];\n            }\n            return result.length == total ?\n                result : Arrays.copyOf(result, total);\n        }\n\n        // result\n        result = new byte[total];\n        int offset = 0;\n        remaining = total;\n        for (byte[] b : bufs) {\n            int count = Math.min(b.length, remaining);\n            System.arraycopy(b, 0, result, offset, count);\n            offset += count;\n            remaining -= count;\n        }\n\n        return result;\n    }\n\n    // JDK9byte \n    public int readNBytes(byte[] b, int off, int len) throws IOException {\n        Objects.checkFromIndexSize(off, len, b.length);\n\n        int n = 0;\n        while (n < len) {\n            int count = read(b, off + n, len - n);\n            if (count < 0)\n                break;\n            n += count;\n        }\n        return n;\n    }\n\n    // \n    public long skip(long n) throws IOException {\n\n        long remaining = n;\n        int nr;\n\n        if (n <= 0) {\n            return 0;\n        }\n\n        int size = (int)Math.min(MAX_SKIP_BUFFER_SIZE, remaining);\n        byte[] skipBuffer = new byte[size];\n        while (remaining > 0) {\n            nr = read(skipBuffer, 0, (int)Math.min(size, remaining));\n            if (nr < 0) {\n                break;\n            }\n            remaining -= nr;\n        }\n\n        return n - remaining;\n    }\n\n    // \n    public int available() throws IOException {\n        return 0;\n    }\n\n    // \n    public void close() throws IOException {}\n\n    //  markSupport() \n    public synchronized void mark(int readlimit) {}\n\n    //  mark \n    public synchronized void reset() throws IOException {\n        throw new IOException("mark/reset not supported");\n    }\n\n    // false\n    public boolean markSupported() {\n        return false;\n    }\n\n    // JDK9 InputStream  OutputStream \n    public long transferTo(OutputStream out) throws IOException {\n        Objects.requireNonNull(out, "out");\n        long transferred = 0;\n        byte[] buffer = new byte[DEFAULT_BUFFER_SIZE];\n        int read;\n        while ((read = this.read(buffer, 0, DEFAULT_BUFFER_SIZE)) >= 0) {\n            out.write(buffer, 0, read);\n            transferred += read;\n        }\n        return transferred;\n    }\n\n\n> JDK9\n\n java.io.InputStream  InputStream \n\n * readAllBytes InputStream \n * readNBytes  InputStream \n * transferTo InputStream  OutputStream  \n\npublic class TestInputStream {\n    private InputStream inputStream;\n    private static final String CONTENT = "Hello World";\n    @Before\n    public void setUp() throws Exception {\n        this.inputStream =\n            TestInputStream.class.getResourceAsStream("/input.txt");\n    }\n    @Test\n    public void testReadAllBytes() throws Exception {\n        final String content = new String(this.inputStream.readAllBytes());\n        assertEquals(CONTENT, content);\n    }\n    @Test\n    public void testReadNBytes() throws Exception {\n        final byte[] data = new byte[5];\n        this.inputStream.readNBytes(data, 0, 5);\n        assertEquals("Hello", new String(data));\n    }\n    @Test\n    public void testTransferTo() throws Exception {\n        final ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n        this.inputStream.transferTo(outputStream);\n        assertEquals(CONTENT, outputStream.toString());\n    }\n}\n\n\n * read(byte[], int, int)  readNBytes(byte[], int, int)readNBytes\n\n\n\n 1. read(byte[], int, int)lenbyteslen\n 2. readNBytes(byte[], int, int) whilestream\n\n12345<end>, read(s,0,10)123, readNbytes(s,0,10)whilestream12345.\n\n> JDK11nullInputStream\n\n * \n\n\n\npublic class MyParser implements Parser {\n  private static Action NO_ACTION = new Action() {\n    public void doSomething() { /* do nothing */ }\n  };\n\n  public Action findAction(String userInput) {\n    // ...\n    if ( /* we can\'t find any actions */ ) {\n      return NO_ACTION;\n    }\n  }\n}\n\n\n\n\nParserFactory.getParser().findAction(someInput).doSomething();\n\n\n\n# FilterInputStream\n\nFilterInputStream \n\npublic class FilterInputStream extends InputStream {\n    \n    // inputStream\n    protected volatile InputStream in;\n    \n    // inputStream\n    protected FilterInputStream(InputStream in) {\n        this.in = in;\n    }\n\n    // inputStream\n    public int read() throws IOException {\n        return in.read();\n    }\n    public int read(byte b[]) throws IOException {\n        return read(b, 0, b.length);\n     }\n    public int read(byte b[], int off, int len) throws IOException {\n        return in.read(b, off, len);\n     }\n    public long skip(long n) throws IOException {\n        return in.skip(n);\n    }\n    public int available() throws IOException {\n        return in.available();\n    }\n    public void close() throws IOException {\n        in.close();\n    }\n    public synchronized void mark(int readlimit) {\n        in.mark(readlimit);\n     }\n    public synchronized void reset() throws IOException {\n        in.reset();\n    }\n    public boolean markSupported() {\n        return in.markSupported();\n    }\n}\n\n\ninputStreamvolatile\n\n : volatile\n\n\n# ByteArrayInputStream\n\nByteArrayInputStream\n\npublic class ByteArrayInputStream extends InputStream {\n    \n    // byte \n    protected byte buf[];\n    \n    // byte[pos]read\n    protected int pos;\n    \n    // mark\n    protected int mark = 0;\n    \n    // byte\n    protected int count;\n\n    // \n    public ByteArrayInputStream(byte buf[]) {\n        this.buf = buf;              \n        this.pos = 0;\n        this.count = buf.length;\n     }\n    \n    // offset\n     public ByteArrayInputStream(byte buf[], int offset, int length) {                \n        this.buf = buf;\n        this.pos = offset;\n        this.count = Math.min(offset + length, buf.length);\n        this.mark = offset;\n    }\n    \n    //  -1\n    public synchronized int read() {\n        return (pos < count) ? (buf[pos++] & 0xff) : -1;\n    }\n    \n    //  off <b>()</b> len  byte  -1 \n    public synchronized int read(byte b[], int off, int len) {\n        // \n        if (b == null) {\n            throw new NullPointerException();\n        } else if (off < 0 || len < 0 || len > b.length - off) {\n            throw new IndexOutOfBoundsException();\n        }\n\n        if (pos >= count) {\n            return -1;\n        }\n\n        int avail = count - pos;\n        if (len > avail) {\n            len = avail;\n        }\n        if (len <= 0) {\n            return 0;\n        }\n\n        // bufbyte b\n        System.arraycopy(buf, pos, b, off, len);\n        pos += len;\n        return len;\n    }\n\n    // \n    public synchronized long skip(long n) {\n        long k = count - pos;\n        if (n < k) {\n            k = n < 0 ? 0 : n;\n        }\n\n        pos += k;\n        return k;\n    }\n\n    // bytebuffercount  byte\n    public synchronized int available() {\n        return count - pos;\n    }\n\n    // marktrue\n    public boolean markSupported() { \n        return true;\n    }  \n\n    // mark, readAheadLimit    \n    public void mark(int readAheadLimit) {            \n        mark = pos;\n    }\n\n    // mark\n    public synchronized void reset() {\n        pos = mark;\n    }\n\n    // ByteArrayInputStream\n    public void close() throws IOException { \n\n    }\n}\n\n\n\n# BufferedInputStream\n\nBufferedInputStream\n\npublic class BufferedInputStream extends FilterInputStream {\n\n    // buffer\n    private static int DEFAULT_BUFFER_SIZE = 8192;\n\n    // \n    // VMOutOfMemoryErrorVM\n    private static int MAX_BUFFER_SIZE = Integer.MAX_VALUE - 8;\n\n    // byte \n    protected volatile byte buf[];\n\n    // AtomicReferenceFieldUpdaterCASCASABA\n    private static final AtomicReferenceFieldUpdater<BufferedInputStream, byte[]> bufUpdater =\n        AtomicReferenceFieldUpdater.newUpdater(BufferedInputStream.class,  byte[].class, "buf");\n\n    // byte\n    protected int count;\n\n    // \n    protected int pos;\n\n    // mark\n    protected int markpos = -1;\n\n    /**\n     * mark(int readLimit)mark(1024)\n     * 1024markmark\n     * BufferedInputStreammarkmarkpos-1\n     */\n    protected int marklimit;\n\n    // stream\n    private InputStream getInIfOpen() throws IOException {\n        InputStream input = in;\n        if (input == null)\n            throw new IOException("Stream closed");\n        return input;\n    }\n\n    // buffer\n    private byte[] getBufIfOpen() throws IOException {\n        byte[] buffer = buf;\n        if (buffer == null)\n            throw new IOException("Stream closed");\n        return buffer;\n    }\n\n    // buffer8kb\n    public BufferedInputStream(InputStream in) {\n        this(in, DEFAULT_BUFFER_SIZE);\n    }\n\n    // buffer\n    public BufferedInputStream(InputStream in, int size) {\n        super(in);\n        if (size <= 0) {\n            throw new IllegalArgumentException("Buffer size <= 0");\n        }\n        buf = new byte[size];\n    }\n\n    /**\n     * ,shuffling\n     * pos >count\n     */\n    private void fill() throws IOException {\n    \t// buffer\n        byte[] buffer = getBufIfOpen();\n        // mark pos0\n        if (markpos < 0)\n            pos = 0;            /* no mark: throw away the buffer */\n        // pos >= buffer.length  buffer \n        else if (pos >= buffer.length)  /* no room left in buffer */\n        \t// markpos > 0  \n            if (markpos > 0) {  /* can throw away early part of the buffer */\n            \t// buffermarkpospos0-szposszmarkpos0\n                int sz = pos - markpos;\n                System.arraycopy(buffer, markpos, buffer, 0, sz);\n                pos = sz;\n                markpos = 0;\n                // markpos0marklimitbuffer.lengthbuffer\n            } else if (buffer.length >= marklimit) {\n            \t// markpos-1pos0\n                markpos = -1;   /* buffer got too big, invalidate mark */\n                pos = 0;        /* drop buffer contents */\n                // markpos0marklimitbuffer.lengthbuffer.length\n            } else if (buffer.length >= MAX_BUFFER_SIZE) {\n                throw new OutOfMemoryError("Required array size too large");\n               // markpos0marklimitbuffer.length\n            } else {            /* grow buffer */\n            \t// min(2*pos,marklimit,MAX_BUFFER_SIZE),0-pos0-pos\n                int nsz = (pos <= MAX_BUFFER_SIZE - pos) ?\n                        pos * 2 : MAX_BUFFER_SIZE;\n                if (nsz > marklimit)\n                    nsz = marklimit;\n                byte nbuf[] = new byte[nsz];\n                System.arraycopy(buffer, 0, nbuf, 0, pos);\n                // bufUpdaterbuffer\n                if (!bufUpdater.compareAndSet(this, buffer, nbuf)) {\n                    // Can\'t replace buf if there was an async close.\n                    // Note: This would need to be changed if fill()\n                    // is ever made accessible to multiple threads.\n                    // But for now, the only way CAS can fail is via close.\n                    // assert buf == null;\n                    throw new IOException("Stream closed");\n                }\n                buffer = nbuf;\n            }\n        // countpos\n        count = pos;\n        // posbuffer.lengthcount\n        int n = getInIfOpen().read(buffer, pos, buffer.length - pos);\n        if (n > 0)\n            count = n + pos;\n    }\n\n    // byte\n    public synchronized int read() throws IOException {\n        // buf[]fill()\n        if (pos >= count) {\n            fill();\n            // \n            if (pos >= count)\n                return -1;\n        }\n        return getBufIfOpen()[pos++] & 0xff;\n    }\n\n    /**\n     * Read characters into a portion of an array, reading from the underlying\n     * stream at most once if necessary.\n     */\n    private int read1(byte[] b, int off, int len) throws IOException {\n        int avail = count - pos;\n        if (avail <= 0) {\n            // bBufferedInputStreambuf[] markpos < 0bbuf[]buf[]\n            if (len >= getBufIfOpen().length && markpos < 0) {\n                return getInIfOpen().read(b, off, len);\n            }\n            fill();\n            avail = count - pos;\n            if (avail <= 0) return -1;\n        }\n        int cnt = (avail < len) ? avail : len;\n        System.arraycopy(getBufIfOpen(), pos, b, off, cnt);\n        pos += cnt;\n        return cnt;\n    }\n\n    // byteb\n    public synchronized int read(byte b[], int off, int len)\n        throws IOException\n    {\n        getBufIfOpen(); // Check for closed stream\n        if ((off | len | (off + len) | (b.length - (off + len))) < 0) {\n            throw new IndexOutOfBoundsException();\n        } else if (len == 0) {\n            return 0;\n        }\n\n        int n = 0;\n        for (;;) {\n            int nread = read1(b, off + n, len - n);\n            if (nread <= 0)\n                return (n == 0) ? nread : n;\n            n += nread;\n            if (n >= len)\n                return n;\n            // if not closed but no bytes available, return\n            InputStream input = in;\n            if (input != null && input.available() <= 0)\n                return n;\n        }\n    }\n\n    // n\n    public synchronized long skip(long n) throws IOException {\n        getBufIfOpen(); // Check for closed stream\n        if (n <= 0) {\n            return 0;\n        }\n        long avail = count - pos;\n\n        if (avail <= 0) {\n            // If no mark position set then don\'t keep in buffer\n            if (markpos <0)\n                return getInIfOpen().skip(n);\n\n            // Fill in buffer to save bytes for reset\n            fill();\n            avail = count - pos;\n            if (avail <= 0)\n                return 0;\n        }\n\n        long skipped = (avail < n) ? avail : n;\n        pos += skipped;\n        return skipped;\n    }\n\n    // buf[]+\n    public synchronized int available() throws IOException {\n        int n = count - pos;\n        int avail = getInIfOpen().available();\n        return n > (Integer.MAX_VALUE - avail)\n                    ? Integer.MAX_VALUE\n                    : n + avail;\n    }\n\n    \n    // marklimitreadlimitmark()\n    // fill()mark() markpos = -1pos = 0\n    public synchronized void mark(int readlimit) {\n        marklimit = readlimit;\n        markpos = pos;\n    }\n\n    // \n    public synchronized void reset() throws IOException {\n        getBufIfOpen(); // close, \n        if (markpos < 0)\n            throw new IOException("Resetting to invalid mark");\n        pos = markpos;\n    }\n\n    // mark, true\n    public boolean markSupported() {\n        return true;\n    }\n\n    // AtomicReferenceFieldUpdaterCASclose\n    public void close() throws IOException {\n        byte[] buffer;\n        while ( (buffer = buf) != null) {\n            if (bufUpdater.compareAndSet(this, buffer, null)) {\n                InputStream input = in;\n                in = null;\n                if (input != null)\n                    input.close();\n                return;\n            }\n            // Else retry in case a new buf was CASed in fill()\n        }\n    }\n}\n\n\nAtomicReferenceFieldUpdaterJUC: CAS, Unsafe\n\n\n# \n\n * JDK 11 \n * https://www.cnblogs.com/winterfells/p/8745297.html\n * https://www.cnblogs.com/AdaiCoffee/p/11369699.html',normalizedContent:'# java io - : inputstream\n\n> jdk 11 inputstream @pdai\n\n * java io - : inputstream\n   * inputstream \n   * inputstream \n   * \n     * inputstream\n     * filterinputstream\n     * bytearrayinputstream\n     * bufferedinputstream\n   * \n\n\n# inputstream \n\n> inputstream\n\n\n\n\n# inputstream \n\ninputstream \n\n// -1\npublic abstract int read() \n\n//  byte read(byte b[], int off, int len)\npublic int read(byte b[]) \n\n//  off <b>()</b> len  byte  -1 ; stream\npublic int read(byte b[], int off, int len) \n\n// jdk9 inputstream readnbytes(integer.max_value)\npublic byte[] readallbytes()\n\n// jdk11 inputstream \npublic byte[] readnbytes(int len)\n\n// jdk9byte \npublic int readnbytes(byte[] b, int off, int len)\n\n// \npublic long skip(long n) \n\n// \npublic int available() \n\n// \npublic void close() \n\n//  marksupport() \npublic synchronized void mark(int readlimit) \n\n//  mark \npublic synchronized void reset() \n\n// \npublic boolean marksupported() \n\n// jdk9 inputstream  outputstream \npublic long transferto(outputstream out)\n\n\n\n\n# \n\n> inputstream\n\n\n# inputstream\n\ninputstream\n\npublic abstract class inputstream implements closeable {\n    \n    // skipbuffer size\n    private static final int max_skip_buffer_size = 2048;\n\n    // buffer size\n    private static final int default_buffer_size = 8192;\n\n    // jdk11nullinputstream\n    public static inputstream nullinputstream() {\n        return new inputstream() {\n            private volatile boolean closed;\n\n            private void ensureopen() throws ioexception {\n                if (closed) {\n                    throw new ioexception("stream closed");\n                }\n            }\n\n            @override\n            public int available () throws ioexception {\n                ensureopen();\n                return 0;\n            }\n\n            @override\n            public int read() throws ioexception {\n                ensureopen();\n                return -1;\n            }\n\n            @override\n            public int read(byte[] b, int off, int len) throws ioexception {\n                objects.checkfromindexsize(off, len, b.length);\n                if (len == 0) {\n                    return 0;\n                }\n                ensureopen();\n                return -1;\n            }\n\n            @override\n            public byte[] readallbytes() throws ioexception {\n                ensureopen();\n                return new byte[0];\n            }\n\n            @override\n            public int readnbytes(byte[] b, int off, int len)\n                throws ioexception {\n                objects.checkfromindexsize(off, len, b.length);\n                ensureopen();\n                return 0;\n            }\n\n            @override\n            public byte[] readnbytes(int len) throws ioexception {\n                if (len < 0) {\n                    throw new illegalargumentexception("len < 0");\n                }\n                ensureopen();\n                return new byte[0];\n            }\n\n            @override\n            public long skip(long n) throws ioexception {\n                ensureopen();\n                return 0l;\n            }\n\n            @override\n            public long transferto(outputstream out) throws ioexception {\n                objects.requirenonnull(out);\n                ensureopen();\n                return 0l;\n            }\n\n            @override\n            public void close() throws ioexception {\n                closed = true;\n            }\n        };\n    }\n    \n    // -1\n    public abstract int read() throws ioexception;\n\n    //  byte read(byte b[], int off, int len)\n    public int read(byte b[]) throws ioexception {\n        return read(b, 0, b.length);\n    }\n\n    //  off <b>()</b> len  byte  -1 ; stream\n    public int read(byte b[], int off, int len) throws ioexception {\n        // \n        objects.checkfromindexsize(off, len, b.length);\n        if (len == 0) {\n            return 0;\n        }\n\n        // \n        int c = read();\n        if (c == -1) { // stream-1\n            return -1;\n        }\n        b[off] = (byte)c;\n\n        // i\n        int i = 1;\n        try {\n            // \n            for (; i < len ; i++) {\n                c = read();\n                if (c == -1) {// streambreak\n                    break;\n                }\n                b[off + i] = (byte)c;\n            }\n        } catch (ioexception ee) {\n        }\n        // \n        return i;\n    }\n\n    // \n    // vmoutofmemoryerrorvm\n    private static final int max_buffer_size = integer.max_value - 8;\n\n    // jdk9 inputstream readnbytes(integer.max_value)\n    public byte[] readallbytes() throws ioexception {\n        return readnbytes(integer.max_value);\n    }\n\n    // jdk11 inputstream \n    public byte[] readnbytes(int len) throws ioexception {\n        // \n        if (len < 0) {\n            throw new illegalargumentexception("len < 0");\n        }\n\n        list<byte[]> bufs = null; // bufsresult\n        byte[] result = null; // \n        int total = 0;\n        int remaining = len; // \n        int n;\n        do {\n            byte[] buf = new byte[math.min(remaining, default_buffer_size)];\n            int nread = 0;\n\n            // n\n            while ((n = read(buf, nread,\n                    math.min(buf.length - nread, remaining))) > 0) {\n                nread += n; \n                remaining -= n;\n            }\n\n            if (nread > 0) {\n                if (max_buffer_size - total < nread) {\n                    throw new outofmemoryerror("required array size too large");\n                }\n                total += nread;\n                if (result == null) {\n                    result = buf;\n                } else {\n                    if (bufs == null) {\n                        bufs = new arraylist<>();\n                        bufs.add(result);\n                    }\n                    bufs.add(buf);\n                }\n            }\n            // -1\n        } while (n >= 0 && remaining > 0);\n\n        if (bufs == null) {\n            if (result == null) {\n                return new byte[0];\n            }\n            return result.length == total ?\n                result : arrays.copyof(result, total);\n        }\n\n        // result\n        result = new byte[total];\n        int offset = 0;\n        remaining = total;\n        for (byte[] b : bufs) {\n            int count = math.min(b.length, remaining);\n            system.arraycopy(b, 0, result, offset, count);\n            offset += count;\n            remaining -= count;\n        }\n\n        return result;\n    }\n\n    // jdk9byte \n    public int readnbytes(byte[] b, int off, int len) throws ioexception {\n        objects.checkfromindexsize(off, len, b.length);\n\n        int n = 0;\n        while (n < len) {\n            int count = read(b, off + n, len - n);\n            if (count < 0)\n                break;\n            n += count;\n        }\n        return n;\n    }\n\n    // \n    public long skip(long n) throws ioexception {\n\n        long remaining = n;\n        int nr;\n\n        if (n <= 0) {\n            return 0;\n        }\n\n        int size = (int)math.min(max_skip_buffer_size, remaining);\n        byte[] skipbuffer = new byte[size];\n        while (remaining > 0) {\n            nr = read(skipbuffer, 0, (int)math.min(size, remaining));\n            if (nr < 0) {\n                break;\n            }\n            remaining -= nr;\n        }\n\n        return n - remaining;\n    }\n\n    // \n    public int available() throws ioexception {\n        return 0;\n    }\n\n    // \n    public void close() throws ioexception {}\n\n    //  marksupport() \n    public synchronized void mark(int readlimit) {}\n\n    //  mark \n    public synchronized void reset() throws ioexception {\n        throw new ioexception("mark/reset not supported");\n    }\n\n    // false\n    public boolean marksupported() {\n        return false;\n    }\n\n    // jdk9 inputstream  outputstream \n    public long transferto(outputstream out) throws ioexception {\n        objects.requirenonnull(out, "out");\n        long transferred = 0;\n        byte[] buffer = new byte[default_buffer_size];\n        int read;\n        while ((read = this.read(buffer, 0, default_buffer_size)) >= 0) {\n            out.write(buffer, 0, read);\n            transferred += read;\n        }\n        return transferred;\n    }\n\n\n> jdk9\n\n java.io.inputstream  inputstream \n\n * readallbytes inputstream \n * readnbytes  inputstream \n * transferto inputstream  outputstream  \n\npublic class testinputstream {\n    private inputstream inputstream;\n    private static final string content = "hello world";\n    @before\n    public void setup() throws exception {\n        this.inputstream =\n            testinputstream.class.getresourceasstream("/input.txt");\n    }\n    @test\n    public void testreadallbytes() throws exception {\n        final string content = new string(this.inputstream.readallbytes());\n        assertequals(content, content);\n    }\n    @test\n    public void testreadnbytes() throws exception {\n        final byte[] data = new byte[5];\n        this.inputstream.readnbytes(data, 0, 5);\n        assertequals("hello", new string(data));\n    }\n    @test\n    public void testtransferto() throws exception {\n        final bytearrayoutputstream outputstream = new bytearrayoutputstream();\n        this.inputstream.transferto(outputstream);\n        assertequals(content, outputstream.tostring());\n    }\n}\n\n\n * read(byte[], int, int)  readnbytes(byte[], int, int)readnbytes\n\n\n\n 1. read(byte[], int, int)lenbyteslen\n 2. readnbytes(byte[], int, int) whilestream\n\n12345<end>, read(s,0,10)123, readnbytes(s,0,10)whilestream12345.\n\n> jdk11nullinputstream\n\n * \n\n\n\npublic class myparser implements parser {\n  private static action no_action = new action() {\n    public void dosomething() { /* do nothing */ }\n  };\n\n  public action findaction(string userinput) {\n    // ...\n    if ( /* we can\'t find any actions */ ) {\n      return no_action;\n    }\n  }\n}\n\n\n\n\nparserfactory.getparser().findaction(someinput).dosomething();\n\n\n\n# filterinputstream\n\nfilterinputstream \n\npublic class filterinputstream extends inputstream {\n    \n    // inputstream\n    protected volatile inputstream in;\n    \n    // inputstream\n    protected filterinputstream(inputstream in) {\n        this.in = in;\n    }\n\n    // inputstream\n    public int read() throws ioexception {\n        return in.read();\n    }\n    public int read(byte b[]) throws ioexception {\n        return read(b, 0, b.length);\n     }\n    public int read(byte b[], int off, int len) throws ioexception {\n        return in.read(b, off, len);\n     }\n    public long skip(long n) throws ioexception {\n        return in.skip(n);\n    }\n    public int available() throws ioexception {\n        return in.available();\n    }\n    public void close() throws ioexception {\n        in.close();\n    }\n    public synchronized void mark(int readlimit) {\n        in.mark(readlimit);\n     }\n    public synchronized void reset() throws ioexception {\n        in.reset();\n    }\n    public boolean marksupported() {\n        return in.marksupported();\n    }\n}\n\n\ninputstreamvolatile\n\n : volatile\n\n\n# bytearrayinputstream\n\nbytearrayinputstream\n\npublic class bytearrayinputstream extends inputstream {\n    \n    // byte \n    protected byte buf[];\n    \n    // byte[pos]read\n    protected int pos;\n    \n    // mark\n    protected int mark = 0;\n    \n    // byte\n    protected int count;\n\n    // \n    public bytearrayinputstream(byte buf[]) {\n        this.buf = buf;              \n        this.pos = 0;\n        this.count = buf.length;\n     }\n    \n    // offset\n     public bytearrayinputstream(byte buf[], int offset, int length) {                \n        this.buf = buf;\n        this.pos = offset;\n        this.count = math.min(offset + length, buf.length);\n        this.mark = offset;\n    }\n    \n    //  -1\n    public synchronized int read() {\n        return (pos < count) ? (buf[pos++] & 0xff) : -1;\n    }\n    \n    //  off <b>()</b> len  byte  -1 \n    public synchronized int read(byte b[], int off, int len) {\n        // \n        if (b == null) {\n            throw new nullpointerexception();\n        } else if (off < 0 || len < 0 || len > b.length - off) {\n            throw new indexoutofboundsexception();\n        }\n\n        if (pos >= count) {\n            return -1;\n        }\n\n        int avail = count - pos;\n        if (len > avail) {\n            len = avail;\n        }\n        if (len <= 0) {\n            return 0;\n        }\n\n        // bufbyte b\n        system.arraycopy(buf, pos, b, off, len);\n        pos += len;\n        return len;\n    }\n\n    // \n    public synchronized long skip(long n) {\n        long k = count - pos;\n        if (n < k) {\n            k = n < 0 ? 0 : n;\n        }\n\n        pos += k;\n        return k;\n    }\n\n    // bytebuffercount  byte\n    public synchronized int available() {\n        return count - pos;\n    }\n\n    // marktrue\n    public boolean marksupported() { \n        return true;\n    }  \n\n    // mark, readaheadlimit    \n    public void mark(int readaheadlimit) {            \n        mark = pos;\n    }\n\n    // mark\n    public synchronized void reset() {\n        pos = mark;\n    }\n\n    // bytearrayinputstream\n    public void close() throws ioexception { \n\n    }\n}\n\n\n\n# bufferedinputstream\n\nbufferedinputstream\n\npublic class bufferedinputstream extends filterinputstream {\n\n    // buffer\n    private static int default_buffer_size = 8192;\n\n    // \n    // vmoutofmemoryerrorvm\n    private static int max_buffer_size = integer.max_value - 8;\n\n    // byte \n    protected volatile byte buf[];\n\n    // atomicreferencefieldupdatercascasaba\n    private static final atomicreferencefieldupdater<bufferedinputstream, byte[]> bufupdater =\n        atomicreferencefieldupdater.newupdater(bufferedinputstream.class,  byte[].class, "buf");\n\n    // byte\n    protected int count;\n\n    // \n    protected int pos;\n\n    // mark\n    protected int markpos = -1;\n\n    /**\n     * mark(int readlimit)mark(1024)\n     * 1024markmark\n     * bufferedinputstreammarkmarkpos-1\n     */\n    protected int marklimit;\n\n    // stream\n    private inputstream getinifopen() throws ioexception {\n        inputstream input = in;\n        if (input == null)\n            throw new ioexception("stream closed");\n        return input;\n    }\n\n    // buffer\n    private byte[] getbufifopen() throws ioexception {\n        byte[] buffer = buf;\n        if (buffer == null)\n            throw new ioexception("stream closed");\n        return buffer;\n    }\n\n    // buffer8kb\n    public bufferedinputstream(inputstream in) {\n        this(in, default_buffer_size);\n    }\n\n    // buffer\n    public bufferedinputstream(inputstream in, int size) {\n        super(in);\n        if (size <= 0) {\n            throw new illegalargumentexception("buffer size <= 0");\n        }\n        buf = new byte[size];\n    }\n\n    /**\n     * ,shuffling\n     * pos >count\n     */\n    private void fill() throws ioexception {\n    \t// buffer\n        byte[] buffer = getbufifopen();\n        // mark pos0\n        if (markpos < 0)\n            pos = 0;            /* no mark: throw away the buffer */\n        // pos >= buffer.length  buffer \n        else if (pos >= buffer.length)  /* no room left in buffer */\n        \t// markpos > 0  \n            if (markpos > 0) {  /* can throw away early part of the buffer */\n            \t// buffermarkpospos0-szposszmarkpos0\n                int sz = pos - markpos;\n                system.arraycopy(buffer, markpos, buffer, 0, sz);\n                pos = sz;\n                markpos = 0;\n                // markpos0marklimitbuffer.lengthbuffer\n            } else if (buffer.length >= marklimit) {\n            \t// markpos-1pos0\n                markpos = -1;   /* buffer got too big, invalidate mark */\n                pos = 0;        /* drop buffer contents */\n                // markpos0marklimitbuffer.lengthbuffer.length\n            } else if (buffer.length >= max_buffer_size) {\n                throw new outofmemoryerror("required array size too large");\n               // markpos0marklimitbuffer.length\n            } else {            /* grow buffer */\n            \t// min(2*pos,marklimit,max_buffer_size),0-pos0-pos\n                int nsz = (pos <= max_buffer_size - pos) ?\n                        pos * 2 : max_buffer_size;\n                if (nsz > marklimit)\n                    nsz = marklimit;\n                byte nbuf[] = new byte[nsz];\n                system.arraycopy(buffer, 0, nbuf, 0, pos);\n                // bufupdaterbuffer\n                if (!bufupdater.compareandset(this, buffer, nbuf)) {\n                    // can\'t replace buf if there was an async close.\n                    // note: this would need to be changed if fill()\n                    // is ever made accessible to multiple threads.\n                    // but for now, the only way cas can fail is via close.\n                    // assert buf == null;\n                    throw new ioexception("stream closed");\n                }\n                buffer = nbuf;\n            }\n        // countpos\n        count = pos;\n        // posbuffer.lengthcount\n        int n = getinifopen().read(buffer, pos, buffer.length - pos);\n        if (n > 0)\n            count = n + pos;\n    }\n\n    // byte\n    public synchronized int read() throws ioexception {\n        // buf[]fill()\n        if (pos >= count) {\n            fill();\n            // \n            if (pos >= count)\n                return -1;\n        }\n        return getbufifopen()[pos++] & 0xff;\n    }\n\n    /**\n     * read characters into a portion of an array, reading from the underlying\n     * stream at most once if necessary.\n     */\n    private int read1(byte[] b, int off, int len) throws ioexception {\n        int avail = count - pos;\n        if (avail <= 0) {\n            // bbufferedinputstreambuf[] markpos < 0bbuf[]buf[]\n            if (len >= getbufifopen().length && markpos < 0) {\n                return getinifopen().read(b, off, len);\n            }\n            fill();\n            avail = count - pos;\n            if (avail <= 0) return -1;\n        }\n        int cnt = (avail < len) ? avail : len;\n        system.arraycopy(getbufifopen(), pos, b, off, cnt);\n        pos += cnt;\n        return cnt;\n    }\n\n    // byteb\n    public synchronized int read(byte b[], int off, int len)\n        throws ioexception\n    {\n        getbufifopen(); // check for closed stream\n        if ((off | len | (off + len) | (b.length - (off + len))) < 0) {\n            throw new indexoutofboundsexception();\n        } else if (len == 0) {\n            return 0;\n        }\n\n        int n = 0;\n        for (;;) {\n            int nread = read1(b, off + n, len - n);\n            if (nread <= 0)\n                return (n == 0) ? nread : n;\n            n += nread;\n            if (n >= len)\n                return n;\n            // if not closed but no bytes available, return\n            inputstream input = in;\n            if (input != null && input.available() <= 0)\n                return n;\n        }\n    }\n\n    // n\n    public synchronized long skip(long n) throws ioexception {\n        getbufifopen(); // check for closed stream\n        if (n <= 0) {\n            return 0;\n        }\n        long avail = count - pos;\n\n        if (avail <= 0) {\n            // if no mark position set then don\'t keep in buffer\n            if (markpos <0)\n                return getinifopen().skip(n);\n\n            // fill in buffer to save bytes for reset\n            fill();\n            avail = count - pos;\n            if (avail <= 0)\n                return 0;\n        }\n\n        long skipped = (avail < n) ? avail : n;\n        pos += skipped;\n        return skipped;\n    }\n\n    // buf[]+\n    public synchronized int available() throws ioexception {\n        int n = count - pos;\n        int avail = getinifopen().available();\n        return n > (integer.max_value - avail)\n                    ? integer.max_value\n                    : n + avail;\n    }\n\n    \n    // marklimitreadlimitmark()\n    // fill()mark() markpos = -1pos = 0\n    public synchronized void mark(int readlimit) {\n        marklimit = readlimit;\n        markpos = pos;\n    }\n\n    // \n    public synchronized void reset() throws ioexception {\n        getbufifopen(); // close, \n        if (markpos < 0)\n            throw new ioexception("resetting to invalid mark");\n        pos = markpos;\n    }\n\n    // mark, true\n    public boolean marksupported() {\n        return true;\n    }\n\n    // atomicreferencefieldupdatercasclose\n    public void close() throws ioexception {\n        byte[] buffer;\n        while ( (buffer = buf) != null) {\n            if (bufupdater.compareandset(this, buffer, null)) {\n                inputstream input = in;\n                in = null;\n                if (input != null)\n                    input.close();\n                return;\n            }\n            // else retry in case a new buf was cased in fill()\n        }\n    }\n}\n\n\natomicreferencefieldupdaterjuc: cas, unsafe\n\n\n# \n\n * jdk 11 \n * https://www.cnblogs.com/winterfells/p/8745297.html\n * https://www.cnblogs.com/adaicoffee/p/11369699.html',charsets:{cjk:!0}},{title:"Java IO - : OutputStream",frontmatter:{},regularPath:"/java/io/java-io-basic-code-outputstream.html",relativePath:"java/io/java-io-basic-code-outputstream.md",key:"v-b4527ba4",path:"/java/io/java-io-basic-code-outputstream.html",headers:[{level:2,title:"Java IO - : OutputStream",slug:"java-io--outputstream",normalizedTitle:"java io - : outputstream",charIndex:2},{level:2,title:"OutputStream ",slug:"outputstream-",normalizedTitle:"outputstream ",charIndex:106},{level:2,title:"OutputStream ",slug:"outputstream-",normalizedTitle:"outputstream ",charIndex:130},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:152},{level:3,title:"OutputStream",slug:"outputstream",normalizedTitle:"outputstream",charIndex:16},{level:3,title:"FilterOutputStream",slug:"filteroutputstream",normalizedTitle:"filteroutputstream",charIndex:184},{level:3,title:"ByteArrayOutputStream",slug:"bytearrayoutputstream",normalizedTitle:"bytearrayoutputstream",charIndex:210},{level:3,title:"BufferedOutputStream",slug:"bufferedoutputstream",normalizedTitle:"bufferedoutputstream",charIndex:239},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:265}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO - : OutputStream OutputStream  OutputStream   OutputStream FilterOutputStream ByteArrayOutputStream BufferedOutputStream ",content:'# Java IO - : OutputStream\n\n> JDK 11 OutputStream @pdai\n\n * Java IO - : OutputStream\n   * OutputStream \n   * OutputStream \n   * \n     * OutputStream\n     * FilterOutputStream\n     * ByteArrayOutputStream\n     * BufferedOutputStream\n   * \n\n\n# OutputStream \n\n> OutputStream\n\n\n\n\n# OutputStream \n\nOutputStream \n\n//  int int  32  8  24 \npublic abstract void write(int b)\n\n// write(byte b[], int off, int len)\npublic void write(byte b[])\n\n//  byte  off len \npublic void write(byte b[], int off, int len)\n\n// ; \npublic void flush()\n\n// ; \npublic void close()\n\n\n\n\n# \n\n> OutputStream\n\n\n# OutputStream\n\nOutputStream\n\npublic abstract class OutputStream implements Closeable, Flushable {\n    \n    // JDK11nullOutputStream\n    public static OutputStream nullOutputStream() {\n        return new OutputStream() {\n            private volatile boolean closed;\n\n            private void ensureOpen() throws IOException {\n                if (closed) {\n                    throw new IOException("Stream closed");\n                }\n            }\n\n            @Override\n            public void write(int b) throws IOException {\n                ensureOpen();\n            }\n\n            @Override\n            public void write(byte b[], int off, int len) throws IOException {\n                Objects.checkFromIndexSize(off, len, b.length);\n                ensureOpen();\n            }\n\n            @Override\n            public void close() {\n                closed = true;\n            }\n        };\n    }\n\n    //  int int  32  8  24 \n    public abstract void write(int b) throws IOException;\n\n    // write(byte b[], int off, int len)\n    public void write(byte b[]) throws IOException {\n        write(b, 0, b.length);\n    }\n\n    //  byte  off len \n    public void write(byte b[], int off, int len) throws IOException {\n        // \n        Objects.checkFromIndexSize(off, len, b.length);\n        // len == 0 for\n        for (int i = 0 ; i < len ; i++) {\n            write(b[off + i]);\n        }\n    }\n\n    // ; \n    public void flush() throws IOException {\n    }\n\n    // ; \n    public void close() throws IOException {\n    }\n\n}\n\n\n> JDK11nullOutputStream\n\n * \n\n\n\npublic class MyParser implements Parser {\n  private static Action NO_ACTION = new Action() {\n    public void doSomething() { /* do nothing */ }\n  };\n\n  public Action findAction(String userInput) {\n    // ...\n    if ( /* we can\'t find any actions */ ) {\n      return NO_ACTION;\n    }\n  }\n}\n\n\n\n\nParserFactory.getParser().findAction(someInput).doSomething();\n\n\n\n# FilterOutputStream\n\nFilterOutputStream \n\npublic class FilterOutputStream extends OutputStream {\n    \n    // outputStream\n    protected OutputStream out;\n\n    // streamclose\n    private volatile boolean closed;\n\n    // close streamclose\n    private final Object closeLock = new Object();\n\n    // outputStream\n    public FilterOutputStream(OutputStream out) {\n        this.out = out;\n    }\n\n    // outputStream\n    @Override\n    public void write(int b) throws IOException {\n        out.write(b);\n    }\n\n    // \n    @Override\n    public void write(byte b[]) throws IOException {\n        write(b, 0, b.length);\n    }\n\n    // \n    @Override\n    public void write(byte b[], int off, int len) throws IOException {\n        if ((off | len | (b.length - (len + off)) | (off + len)) < 0)\n            throw new IndexOutOfBoundsException();\n\n        for (int i = 0 ; i < len ; i++) {\n            write(b[off + i]);\n        }\n    }\n\n     // ; outputStream\n    @Override\n    public void flush() throws IOException {\n        out.flush();\n    }\n\n    // Stream\n    @Override\n    public void close() throws IOException {\n        // close, \n        if (closed) {\n            return;\n        }\n        // closing\n        synchronized (closeLock) {\n            if (closed) {\n                return;\n            }\n            closed = true;\n        }\n\n        // closeflush\n        Throwable flushException = null;\n        try {\n            flush();\n        } catch (Throwable e) {\n            flushException = e;\n            throw e;\n        } finally {\n            if (flushException == null) {\n                out.close();\n            } else {\n                try {\n                    out.close();\n                } catch (Throwable closeException) {\n                   // evaluate possible precedence of flushException over closeException\n                   if ((flushException instanceof ThreadDeath) &&\n                       !(closeException instanceof ThreadDeath)) {\n                       flushException.addSuppressed(closeException);\n                       throw (ThreadDeath) flushException;\n                   }\n\n                    if (flushException != closeException) {\n                        closeException.addSuppressed(flushException);\n                    }\n\n                    throw closeException;\n                }\n            }\n        }\n    }\n}\n\n\n@pdai: JDK8closeJDK8java7try with resourcesflushout\n\npublic void close() throws IOException {\n    try (OutputStream ostream = out) {\n        flush();\n    }\n}\n\n\n\n# ByteArrayOutputStream\n\nByteArrayOutputStream \n\npublic class ByteArrayOutputStream extends OutputStream {\n\n    // byte\n    protected byte buf[];\n\n    // byte\n    protected int count;\n\n    // byte32\n    public ByteArrayOutputStream() {\n        this(32);\n    }\n\n    // byte\n    public ByteArrayOutputStream(int size) {\n        if (size < 0) {\n            throw new IllegalArgumentException("Negative initial size: "\n                                               + size);\n        }\n        buf = new byte[size];\n    }\n\n    // \n    private void ensureCapacity(int minCapacity) {\n        // overflow-conscious code\n        if (minCapacity - buf.length > 0)\n            grow(minCapacity);\n    }\n\n    // \n    // VMOutOfMemoryErrorVM\n    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n\n    // \n    private void grow(int minCapacity) {\n        // overflow-conscious code\n        int oldCapacity = buf.length;\n        int newCapacity = oldCapacity << 1;\n        if (newCapacity - minCapacity < 0)\n            newCapacity = minCapacity;\n        if (newCapacity - MAX_ARRAY_SIZE > 0)\n            newCapacity = hugeCapacity(minCapacity);\n        buf = Arrays.copyOf(buf, newCapacity);\n    }\n\n    private static int hugeCapacity(int minCapacity) {\n        if (minCapacity < 0) // overflow\n            throw new OutOfMemoryError();\n        return (minCapacity > MAX_ARRAY_SIZE) ?\n            Integer.MAX_VALUE :\n            MAX_ARRAY_SIZE;\n    }\n\n    // byte\n    public synchronized void write(int b) {\n        ensureCapacity(count + 1);\n        buf[count] = (byte) b;\n        count += 1;\n    }\n\n    \n    public synchronized void write(byte b[], int off, int len) {\n        Objects.checkFromIndexSize(off, len, b.length);\n        ensureCapacity(count + len);\n        System.arraycopy(b, off, buf, count, len);\n        count += len;\n    }\n\n    public void writeBytes(byte b[]) {\n        write(b, 0, b.length);\n    }\n\n    public synchronized void writeTo(OutputStream out) throws IOException {\n        out.write(buf, 0, count);\n    }\n\n    // byte0\n    public synchronized void reset() {\n        count = 0;\n    }\n\n    \n    public synchronized byte[] toByteArray() {\n        return Arrays.copyOf(buf, count);\n    }\n\n    // count\n    public synchronized int size() {\n        return count;\n    }\n\n    // string\n    public synchronized String toString() {\n        return new String(buf, 0, count);\n    }\n\n    // string\n    public synchronized String toString(String charsetName)\n        throws UnsupportedEncodingException\n    {\n        return new String(buf, 0, count, charsetName);\n    }\n\n    public synchronized String toString(Charset charset) {\n        return new String(buf, 0, count, charset);\n    }\n\n    // \n    @Deprecated\n    public synchronized String toString(int hibyte) {\n        return new String(buf, hibyte, 0, count);\n    }\n\n    // byte close\n    public void close() throws IOException {\n    }\n\n}\n\n\n\n# BufferedOutputStream\n\nBufferedOutputStream \n\npublic class BufferedOutputStream extends FilterOutputStream {\n    \n    // Buffered outputStreambyte\n    protected byte buf[];\n\n    // buf[0]buf[count-1]bytes\n    protected int count;\n\n    // outputStreambuf8192\n    public BufferedOutputStream(OutputStream out) {\n        this(out, 8192);\n    }\n\n    public BufferedOutputStream(OutputStream out, int size) {\n        super(out);\n        if (size <= 0) {\n            throw new IllegalArgumentException("Buffer size <= 0");\n        }\n        buf = new byte[size];\n    }\n\n    /** Flush the internal buffer */\n    // flushbufferbytes(countbytes)outputStream\n    private void flushBuffer() throws IOException {\n        if (count > 0) {\n            out.write(buf, 0, count);\n            count = 0;\n        }\n    }\n\n    // byte\n    @Override\n    public synchronized void write(int b) throws IOException {\n        // bufferflush buffer\n        if (count >= buf.length) {\n            flushBuffer();\n        }\n        buf[count++] = (byte)b;\n    }\n\n    //  byte  off len \n    @Override\n    public synchronized void write(byte b[], int off, int len) throws IOException {\n        if (len >= buf.length) {\n            // \n            flushBuffer();\n            out.write(b, off, len);\n            return;\n        }\n        if (len > buf.length - count) {\n            flushBuffer();\n        }\n        System.arraycopy(b, off, buf, count, len);\n        count += len;\n    }\n\n    // flushbufferoutputStreamflush\n    @Override\n    public synchronized void flush() throws IOException {\n        flushBuffer();\n        out.flush();\n    }\n}\n\n\n\n# \n\n * JDK 11',normalizedContent:'# java io - : outputstream\n\n> jdk 11 outputstream @pdai\n\n * java io - : outputstream\n   * outputstream \n   * outputstream \n   * \n     * outputstream\n     * filteroutputstream\n     * bytearrayoutputstream\n     * bufferedoutputstream\n   * \n\n\n# outputstream \n\n> outputstream\n\n\n\n\n# outputstream \n\noutputstream \n\n//  int int  32  8  24 \npublic abstract void write(int b)\n\n// write(byte b[], int off, int len)\npublic void write(byte b[])\n\n//  byte  off len \npublic void write(byte b[], int off, int len)\n\n// ; \npublic void flush()\n\n// ; \npublic void close()\n\n\n\n\n# \n\n> outputstream\n\n\n# outputstream\n\noutputstream\n\npublic abstract class outputstream implements closeable, flushable {\n    \n    // jdk11nulloutputstream\n    public static outputstream nulloutputstream() {\n        return new outputstream() {\n            private volatile boolean closed;\n\n            private void ensureopen() throws ioexception {\n                if (closed) {\n                    throw new ioexception("stream closed");\n                }\n            }\n\n            @override\n            public void write(int b) throws ioexception {\n                ensureopen();\n            }\n\n            @override\n            public void write(byte b[], int off, int len) throws ioexception {\n                objects.checkfromindexsize(off, len, b.length);\n                ensureopen();\n            }\n\n            @override\n            public void close() {\n                closed = true;\n            }\n        };\n    }\n\n    //  int int  32  8  24 \n    public abstract void write(int b) throws ioexception;\n\n    // write(byte b[], int off, int len)\n    public void write(byte b[]) throws ioexception {\n        write(b, 0, b.length);\n    }\n\n    //  byte  off len \n    public void write(byte b[], int off, int len) throws ioexception {\n        // \n        objects.checkfromindexsize(off, len, b.length);\n        // len == 0 for\n        for (int i = 0 ; i < len ; i++) {\n            write(b[off + i]);\n        }\n    }\n\n    // ; \n    public void flush() throws ioexception {\n    }\n\n    // ; \n    public void close() throws ioexception {\n    }\n\n}\n\n\n> jdk11nulloutputstream\n\n * \n\n\n\npublic class myparser implements parser {\n  private static action no_action = new action() {\n    public void dosomething() { /* do nothing */ }\n  };\n\n  public action findaction(string userinput) {\n    // ...\n    if ( /* we can\'t find any actions */ ) {\n      return no_action;\n    }\n  }\n}\n\n\n\n\nparserfactory.getparser().findaction(someinput).dosomething();\n\n\n\n# filteroutputstream\n\nfilteroutputstream \n\npublic class filteroutputstream extends outputstream {\n    \n    // outputstream\n    protected outputstream out;\n\n    // streamclose\n    private volatile boolean closed;\n\n    // close streamclose\n    private final object closelock = new object();\n\n    // outputstream\n    public filteroutputstream(outputstream out) {\n        this.out = out;\n    }\n\n    // outputstream\n    @override\n    public void write(int b) throws ioexception {\n        out.write(b);\n    }\n\n    // \n    @override\n    public void write(byte b[]) throws ioexception {\n        write(b, 0, b.length);\n    }\n\n    // \n    @override\n    public void write(byte b[], int off, int len) throws ioexception {\n        if ((off | len | (b.length - (len + off)) | (off + len)) < 0)\n            throw new indexoutofboundsexception();\n\n        for (int i = 0 ; i < len ; i++) {\n            write(b[off + i]);\n        }\n    }\n\n     // ; outputstream\n    @override\n    public void flush() throws ioexception {\n        out.flush();\n    }\n\n    // stream\n    @override\n    public void close() throws ioexception {\n        // close, \n        if (closed) {\n            return;\n        }\n        // closing\n        synchronized (closelock) {\n            if (closed) {\n                return;\n            }\n            closed = true;\n        }\n\n        // closeflush\n        throwable flushexception = null;\n        try {\n            flush();\n        } catch (throwable e) {\n            flushexception = e;\n            throw e;\n        } finally {\n            if (flushexception == null) {\n                out.close();\n            } else {\n                try {\n                    out.close();\n                } catch (throwable closeexception) {\n                   // evaluate possible precedence of flushexception over closeexception\n                   if ((flushexception instanceof threaddeath) &&\n                       !(closeexception instanceof threaddeath)) {\n                       flushexception.addsuppressed(closeexception);\n                       throw (threaddeath) flushexception;\n                   }\n\n                    if (flushexception != closeexception) {\n                        closeexception.addsuppressed(flushexception);\n                    }\n\n                    throw closeexception;\n                }\n            }\n        }\n    }\n}\n\n\n@pdai: jdk8closejdk8java7try with resourcesflushout\n\npublic void close() throws ioexception {\n    try (outputstream ostream = out) {\n        flush();\n    }\n}\n\n\n\n# bytearrayoutputstream\n\nbytearrayoutputstream \n\npublic class bytearrayoutputstream extends outputstream {\n\n    // byte\n    protected byte buf[];\n\n    // byte\n    protected int count;\n\n    // byte32\n    public bytearrayoutputstream() {\n        this(32);\n    }\n\n    // byte\n    public bytearrayoutputstream(int size) {\n        if (size < 0) {\n            throw new illegalargumentexception("negative initial size: "\n                                               + size);\n        }\n        buf = new byte[size];\n    }\n\n    // \n    private void ensurecapacity(int mincapacity) {\n        // overflow-conscious code\n        if (mincapacity - buf.length > 0)\n            grow(mincapacity);\n    }\n\n    // \n    // vmoutofmemoryerrorvm\n    private static final int max_array_size = integer.max_value - 8;\n\n    // \n    private void grow(int mincapacity) {\n        // overflow-conscious code\n        int oldcapacity = buf.length;\n        int newcapacity = oldcapacity << 1;\n        if (newcapacity - mincapacity < 0)\n            newcapacity = mincapacity;\n        if (newcapacity - max_array_size > 0)\n            newcapacity = hugecapacity(mincapacity);\n        buf = arrays.copyof(buf, newcapacity);\n    }\n\n    private static int hugecapacity(int mincapacity) {\n        if (mincapacity < 0) // overflow\n            throw new outofmemoryerror();\n        return (mincapacity > max_array_size) ?\n            integer.max_value :\n            max_array_size;\n    }\n\n    // byte\n    public synchronized void write(int b) {\n        ensurecapacity(count + 1);\n        buf[count] = (byte) b;\n        count += 1;\n    }\n\n    \n    public synchronized void write(byte b[], int off, int len) {\n        objects.checkfromindexsize(off, len, b.length);\n        ensurecapacity(count + len);\n        system.arraycopy(b, off, buf, count, len);\n        count += len;\n    }\n\n    public void writebytes(byte b[]) {\n        write(b, 0, b.length);\n    }\n\n    public synchronized void writeto(outputstream out) throws ioexception {\n        out.write(buf, 0, count);\n    }\n\n    // byte0\n    public synchronized void reset() {\n        count = 0;\n    }\n\n    \n    public synchronized byte[] tobytearray() {\n        return arrays.copyof(buf, count);\n    }\n\n    // count\n    public synchronized int size() {\n        return count;\n    }\n\n    // string\n    public synchronized string tostring() {\n        return new string(buf, 0, count);\n    }\n\n    // string\n    public synchronized string tostring(string charsetname)\n        throws unsupportedencodingexception\n    {\n        return new string(buf, 0, count, charsetname);\n    }\n\n    public synchronized string tostring(charset charset) {\n        return new string(buf, 0, count, charset);\n    }\n\n    // \n    @deprecated\n    public synchronized string tostring(int hibyte) {\n        return new string(buf, hibyte, 0, count);\n    }\n\n    // byte close\n    public void close() throws ioexception {\n    }\n\n}\n\n\n\n# bufferedoutputstream\n\nbufferedoutputstream \n\npublic class bufferedoutputstream extends filteroutputstream {\n    \n    // buffered outputstreambyte\n    protected byte buf[];\n\n    // buf[0]buf[count-1]bytes\n    protected int count;\n\n    // outputstreambuf8192\n    public bufferedoutputstream(outputstream out) {\n        this(out, 8192);\n    }\n\n    public bufferedoutputstream(outputstream out, int size) {\n        super(out);\n        if (size <= 0) {\n            throw new illegalargumentexception("buffer size <= 0");\n        }\n        buf = new byte[size];\n    }\n\n    /** flush the internal buffer */\n    // flushbufferbytes(countbytes)outputstream\n    private void flushbuffer() throws ioexception {\n        if (count > 0) {\n            out.write(buf, 0, count);\n            count = 0;\n        }\n    }\n\n    // byte\n    @override\n    public synchronized void write(int b) throws ioexception {\n        // bufferflush buffer\n        if (count >= buf.length) {\n            flushbuffer();\n        }\n        buf[count++] = (byte)b;\n    }\n\n    //  byte  off len \n    @override\n    public synchronized void write(byte b[], int off, int len) throws ioexception {\n        if (len >= buf.length) {\n            // \n            flushbuffer();\n            out.write(b, off, len);\n            return;\n        }\n        if (len > buf.length - count) {\n            flushbuffer();\n        }\n        system.arraycopy(b, off, buf, count, len);\n        count += len;\n    }\n\n    // flushbufferoutputstreamflush\n    @override\n    public synchronized void flush() throws ioexception {\n        flushbuffer();\n        out.flush();\n    }\n}\n\n\n\n# \n\n * jdk 11',charsets:{cjk:!0}},{title:"Java IO - ()",frontmatter:{},regularPath:"/java/io/java-io-basic-design-pattern.html",relativePath:"java/io/java-io-basic-design-pattern.md",key:"v-e0f7392c",path:"/java/io/java-io-basic-design-pattern.html",headers:[{level:2,title:"Java IO - ()",slug:"java-io--",normalizedTitle:"java io - ()",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:17},{level:2,title:"IO ",slug:"io-",normalizedTitle:"io ",charIndex:323}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO - ()  IO ",content:"# Java IO - ()\n\n> Java I/O @pdai\n\n\n# \n\n\n\n(Decorator)(ConcreteComponent)(Component)\n\n\n\n\n# IO \n\n InputStream \n\n * InputStream \n * FileInputStream  InputStream \n * FilterInputStream  BufferedInputStream  FileInputStream \n\n\n\n FileInputStream  BufferedInputStream \n\nFileInputStream fileInputStream = new FileInputStream(filePath);\nBufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream);\n\n\nDataInputStream  intdouble ",normalizedContent:"# java io - ()\n\n> java i/o @pdai\n\n\n# \n\n\n\n(decorator)(concretecomponent)(component)\n\n\n\n\n# io \n\n inputstream \n\n * inputstream \n * fileinputstream  inputstream \n * filterinputstream  bufferedinputstream  fileinputstream \n\n\n\n fileinputstream  bufferedinputstream \n\nfileinputstream fileinputstream = new fileinputstream(filepath);\nbufferedinputstream bufferedinputstream = new bufferedinputstream(fileinputstream);\n\n\ndatainputstream  intdouble ",charsets:{cjk:!0}},{title:"Java IO - BIO ",frontmatter:{},regularPath:"/java/io/java-io-bio.html",relativePath:"java/io/java-io-bio.md",key:"v-8b849c24",path:"/java/io/java-io-bio.html",headers:[{level:2,title:"Java IO - BIO ",slug:"java-io-bio-",normalizedTitle:"java io - bio ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:199},{level:2,title:"BIO",slug:"bio",normalizedTitle:"bio",charIndex:211},{level:3,title:"BIO",slug:"bio",normalizedTitle:"bio",charIndex:231},{level:3,title:" - ",slug:"-",normalizedTitle:" - ",charIndex:248},{level:2,title:"BIO",slug:"bio",normalizedTitle:"bio",charIndex:267},{level:3,title:"20:",slug:"20-",normalizedTitle:"20:",charIndex:286},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:317},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:335},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:354},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:364}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO - BIO   BIO BIO  -  BIO 20:    ",content:'# Java IO - BIO \n\n> BIO: blocking IOIOIO@pdai\n\n * Java IO - BIO \n   * \n   * BIO\n     * BIO\n     *  - \n   * BIO\n     * 20:\n     * \n     * \n     * \n   * \n\n\n# \n\n * IO  IO\n\nIOIO: (IO)\n\n * IO  IO\n\nIOIO: IO()IO\n\n\n# BIO\n\n:\n\n * ()\n\n * AB\n\n\n\n\n# BIO\n\n * AABBA\n\n * ()\n\n\n#  - \n\n:\n\n * X()Y\n\n *  /()\n\n:\n\n\n\n:\n\n * accept()(debug)\n\n * linuxcat /proc/sys/kernel/threads-max CPU\n\n * JVMJVM128K-XssThreadPoolExecutorBlockingQueue\n\n *  \n\n\n# BIO\n\nBIO()accept()read()20(20)JAVACountDownLatch20Server\n\n\n# 20:\n\n(SocketClientDaemon)\n\npackage testBSocket;\n\nimport java.util.concurrent.CountDownLatch;\n\npublic class SocketClientDaemon {\n    public static void main(String[] args) throws Exception {\n        Integer clientNumber = 20;\n        CountDownLatch countDownLatch = new CountDownLatch(clientNumber);\n\n        //20\n        for(int index = 0 ; index < clientNumber ; index++ , countDownLatch.countDown()) {\n            SocketClientRequestThread client = new SocketClientRequestThread(countDownLatch, index);\n            new Thread(client).start();\n        }\n\n        //wait\n        synchronized (SocketClientDaemon.class) {\n            SocketClientDaemon.class.wait();\n        }\n    }\n}\n\n\n(SocketClientRequestThread)\n\npackage testBSocket;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.Socket;\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\n/**\n * SocketClientRequestThread\n * @author yinwenjie\n */\npublic class SocketClientRequestThread implements Runnable {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketClientRequestThread.class);\n\n    private CountDownLatch countDownLatch;\n\n    /**\n     * \n     * @param countDownLatch\n     */\n    private Integer clientIndex;\n\n    /**\n     * countDownLatchjava\n     * 0\n     * @param countDownLatch\n     */\n    public SocketClientRequestThread(CountDownLatch countDownLatch , Integer clientIndex) {\n        this.countDownLatch = countDownLatch;\n        this.clientIndex = clientIndex;\n    }\n\n    @Override\n    public void run() {\n        Socket socket = null;\n        OutputStream clientRequest = null;\n        InputStream clientResponse = null;\n\n        try {\n            socket = new Socket("localhost",83);\n            clientRequest = socket.getOutputStream();\n            clientResponse = socket.getInputStream();\n\n            //SocketClientDaemon\n            this.countDownLatch.await();\n\n            //\n            clientRequest.write(("" + this.clientIndex + " ").getBytes());\n            clientRequest.flush();\n\n            //\n            SocketClientRequestThread.LOGGER.info("" + this.clientIndex + "");\n            int maxLen = 1024;\n            byte[] contextBytes = new byte[maxLen];\n            int realLen;\n            String message = "";\n            //(inoutcloseclose)\n            while((realLen = clientResponse.read(contextBytes, 0, maxLen)) != -1) {\n                message += new String(contextBytes , 0 , realLen);\n            }\n            SocketClientRequestThread.LOGGER.info(":" + message);\n        } catch (Exception e) {\n            SocketClientRequestThread.LOGGER.error(e.getMessage(), e);\n        } finally {\n            try {\n                if(clientRequest != null) {\n                    clientRequest.close();\n                }\n                if(clientResponse != null) {\n                    clientResponse.close();\n                }\n            } catch (IOException e) {\n                SocketClientRequestThread.LOGGER.error(e.getMessage(), e);\n            }\n        }\n    }\n}\n\n\n(SocketServer1)\n\npackage testBSocket;\n\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.ServerSocket;\nimport java.net.Socket;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\npublic class SocketServer1 {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketServer1.class);\n\n    public static void main(String[] args) throws Exception{\n        ServerSocket serverSocket = new ServerSocket(83);\n\n        try {\n            while(true) {\n                Socket socket = serverSocket.accept();\n\n                //\n                InputStream in = socket.getInputStream();\n                OutputStream out = socket.getOutputStream();\n                Integer sourcePort = socket.getPort();\n                int maxLen = 2048;\n                byte[] contextBytes = new byte[maxLen];\n                //\n                int realLen = in.read(contextBytes, 0, maxLen);\n                //\n                String message = new String(contextBytes , 0 , realLen);\n\n                //\n                SocketServer1.LOGGER.info(": " + sourcePort + ": " + message);\n\n                //\n                out.write("".getBytes());\n\n                //\n                out.close();\n                in.close();\n                socket.close();\n            }\n        } catch(Exception e) {\n            SocketServer1.LOGGER.error(e.getMessage(), e);\n        } finally {\n            if(serverSocket != null) {\n                serverSocket.close();\n            }\n        }\n    }\n}\n\n\n\n# \n\n:\n\npackage testBSocket;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.ServerSocket;\nimport java.net.Socket;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\npublic class SocketServer2 {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    private static final Log LOGGER = LogFactory.getLog(SocketServer2.class);\n\n    public static void main(String[] args) throws Exception{\n        ServerSocket serverSocket = new ServerSocket(83);\n\n        try {\n            while(true) {\n                Socket socket = serverSocket.accept();\n                //(),\n                //.accept()socket,\n                SocketServerThread socketServerThread = new SocketServerThread(socket);\n                new Thread(socketServerThread).start();\n            }\n        } catch(Exception e) {\n            SocketServer2.LOGGER.error(e.getMessage(), e);\n        } finally {\n            if(serverSocket != null) {\n                serverSocket.close();\n            }\n        }\n    }\n}\n\n/**\n * socket\n * socketaccept()\n * @author yinwenjie\n */\nclass SocketServerThread implements Runnable {\n\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketServerThread.class);\n\n    private Socket socket;\n\n    public SocketServerThread (Socket socket) {\n        this.socket = socket;\n    }\n\n    @Override\n    public void run() {\n        InputStream in = null;\n        OutputStream out = null;\n        try {\n            //\n            in = socket.getInputStream();\n            out = socket.getOutputStream();\n            Integer sourcePort = socket.getPort();\n            int maxLen = 1024;\n            byte[] contextBytes = new byte[maxLen];\n            //read\n            //read\n            int realLen = in.read(contextBytes, 0, maxLen);\n            //\n            String message = new String(contextBytes , 0 , realLen);\n\n            //\n            SocketServerThread.LOGGER.info(": " + sourcePort + ": " + message);\n\n            //\n            out.write("".getBytes());\n        } catch(Exception e) {\n            SocketServerThread.LOGGER.error(e.getMessage(), e);\n        } finally {\n            //\n            try {\n                if(in != null) {\n                    in.close();\n                }\n                if(out != null) {\n                    out.close();\n                }\n                if(this.socket != null) {\n                    this.socket.close();\n                }\n            } catch (IOException e) {\n                SocketServerThread.LOGGER.error(e.getMessage(), e);\n            }\n        }\n    }\n}\n\n\n\n# \n\n:\n\n\n\n\n# \n\naccept()read(): IO IOIO \n\nAPI serverSocket.accept() :\n\n> Listens for a connection to be made to this socket and accepts it. The method blocks until a connection is made.\n\nserverSocket.accept()? IO:\n\n * accept socketX\n\n\n\n * socketIOIO/IO:\n\n\n\n\n\nXserverSocket.accept()accept(): IO\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48274255',normalizedContent:'# java io - bio \n\n> bio: blocking ioioio@pdai\n\n * java io - bio \n   * \n   * bio\n     * bio\n     *  - \n   * bio\n     * 20:\n     * \n     * \n     * \n   * \n\n\n# \n\n * io  io\n\nioio: (io)\n\n * io  io\n\nioio: io()io\n\n\n# bio\n\n:\n\n * ()\n\n * ab\n\n\n\n\n# bio\n\n * aabba\n\n * ()\n\n\n#  - \n\n:\n\n * x()y\n\n *  /()\n\n:\n\n\n\n:\n\n * accept()(debug)\n\n * linuxcat /proc/sys/kernel/threads-max cpu\n\n * jvmjvm128k-xssthreadpoolexecutorblockingqueue\n\n *  \n\n\n# bio\n\nbio()accept()read()20(20)javacountdownlatch20server\n\n\n# 20:\n\n(socketclientdaemon)\n\npackage testbsocket;\n\nimport java.util.concurrent.countdownlatch;\n\npublic class socketclientdaemon {\n    public static void main(string[] args) throws exception {\n        integer clientnumber = 20;\n        countdownlatch countdownlatch = new countdownlatch(clientnumber);\n\n        //20\n        for(int index = 0 ; index < clientnumber ; index++ , countdownlatch.countdown()) {\n            socketclientrequestthread client = new socketclientrequestthread(countdownlatch, index);\n            new thread(client).start();\n        }\n\n        //wait\n        synchronized (socketclientdaemon.class) {\n            socketclientdaemon.class.wait();\n        }\n    }\n}\n\n\n(socketclientrequestthread)\n\npackage testbsocket;\n\nimport java.io.ioexception;\nimport java.io.inputstream;\nimport java.io.outputstream;\nimport java.net.socket;\nimport java.util.concurrent.countdownlatch;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\n/**\n * socketclientrequestthread\n * @author yinwenjie\n */\npublic class socketclientrequestthread implements runnable {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketclientrequestthread.class);\n\n    private countdownlatch countdownlatch;\n\n    /**\n     * \n     * @param countdownlatch\n     */\n    private integer clientindex;\n\n    /**\n     * countdownlatchjava\n     * 0\n     * @param countdownlatch\n     */\n    public socketclientrequestthread(countdownlatch countdownlatch , integer clientindex) {\n        this.countdownlatch = countdownlatch;\n        this.clientindex = clientindex;\n    }\n\n    @override\n    public void run() {\n        socket socket = null;\n        outputstream clientrequest = null;\n        inputstream clientresponse = null;\n\n        try {\n            socket = new socket("localhost",83);\n            clientrequest = socket.getoutputstream();\n            clientresponse = socket.getinputstream();\n\n            //socketclientdaemon\n            this.countdownlatch.await();\n\n            //\n            clientrequest.write(("" + this.clientindex + " ").getbytes());\n            clientrequest.flush();\n\n            //\n            socketclientrequestthread.logger.info("" + this.clientindex + "");\n            int maxlen = 1024;\n            byte[] contextbytes = new byte[maxlen];\n            int reallen;\n            string message = "";\n            //(inoutcloseclose)\n            while((reallen = clientresponse.read(contextbytes, 0, maxlen)) != -1) {\n                message += new string(contextbytes , 0 , reallen);\n            }\n            socketclientrequestthread.logger.info(":" + message);\n        } catch (exception e) {\n            socketclientrequestthread.logger.error(e.getmessage(), e);\n        } finally {\n            try {\n                if(clientrequest != null) {\n                    clientrequest.close();\n                }\n                if(clientresponse != null) {\n                    clientresponse.close();\n                }\n            } catch (ioexception e) {\n                socketclientrequestthread.logger.error(e.getmessage(), e);\n            }\n        }\n    }\n}\n\n\n(socketserver1)\n\npackage testbsocket;\n\nimport java.io.inputstream;\nimport java.io.outputstream;\nimport java.net.serversocket;\nimport java.net.socket;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\npublic class socketserver1 {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketserver1.class);\n\n    public static void main(string[] args) throws exception{\n        serversocket serversocket = new serversocket(83);\n\n        try {\n            while(true) {\n                socket socket = serversocket.accept();\n\n                //\n                inputstream in = socket.getinputstream();\n                outputstream out = socket.getoutputstream();\n                integer sourceport = socket.getport();\n                int maxlen = 2048;\n                byte[] contextbytes = new byte[maxlen];\n                //\n                int reallen = in.read(contextbytes, 0, maxlen);\n                //\n                string message = new string(contextbytes , 0 , reallen);\n\n                //\n                socketserver1.logger.info(": " + sourceport + ": " + message);\n\n                //\n                out.write("".getbytes());\n\n                //\n                out.close();\n                in.close();\n                socket.close();\n            }\n        } catch(exception e) {\n            socketserver1.logger.error(e.getmessage(), e);\n        } finally {\n            if(serversocket != null) {\n                serversocket.close();\n            }\n        }\n    }\n}\n\n\n\n# \n\n:\n\npackage testbsocket;\n\nimport java.io.ioexception;\nimport java.io.inputstream;\nimport java.io.outputstream;\nimport java.net.serversocket;\nimport java.net.socket;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\npublic class socketserver2 {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    private static final log logger = logfactory.getlog(socketserver2.class);\n\n    public static void main(string[] args) throws exception{\n        serversocket serversocket = new serversocket(83);\n\n        try {\n            while(true) {\n                socket socket = serversocket.accept();\n                //(),\n                //.accept()socket,\n                socketserverthread socketserverthread = new socketserverthread(socket);\n                new thread(socketserverthread).start();\n            }\n        } catch(exception e) {\n            socketserver2.logger.error(e.getmessage(), e);\n        } finally {\n            if(serversocket != null) {\n                serversocket.close();\n            }\n        }\n    }\n}\n\n/**\n * socket\n * socketaccept()\n * @author yinwenjie\n */\nclass socketserverthread implements runnable {\n\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketserverthread.class);\n\n    private socket socket;\n\n    public socketserverthread (socket socket) {\n        this.socket = socket;\n    }\n\n    @override\n    public void run() {\n        inputstream in = null;\n        outputstream out = null;\n        try {\n            //\n            in = socket.getinputstream();\n            out = socket.getoutputstream();\n            integer sourceport = socket.getport();\n            int maxlen = 1024;\n            byte[] contextbytes = new byte[maxlen];\n            //read\n            //read\n            int reallen = in.read(contextbytes, 0, maxlen);\n            //\n            string message = new string(contextbytes , 0 , reallen);\n\n            //\n            socketserverthread.logger.info(": " + sourceport + ": " + message);\n\n            //\n            out.write("".getbytes());\n        } catch(exception e) {\n            socketserverthread.logger.error(e.getmessage(), e);\n        } finally {\n            //\n            try {\n                if(in != null) {\n                    in.close();\n                }\n                if(out != null) {\n                    out.close();\n                }\n                if(this.socket != null) {\n                    this.socket.close();\n                }\n            } catch (ioexception e) {\n                socketserverthread.logger.error(e.getmessage(), e);\n            }\n        }\n    }\n}\n\n\n\n# \n\n:\n\n\n\n\n# \n\naccept()read(): io ioio \n\napi serversocket.accept() :\n\n> listens for a connection to be made to this socket and accepts it. the method blocks until a connection is made.\n\nserversocket.accept()? io:\n\n * accept socketx\n\n\n\n * socketioio/io:\n\n\n\n\n\nxserversocket.accept()accept(): io\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48274255',charsets:{cjk:!0}},{title:"Java IO - ",frontmatter:{},regularPath:"/java/io/java-io-basic-usage.html",relativePath:"java/io/java-io-basic-usage.md",key:"v-3ff5c12e",path:"/java/io/java-io-basic-usage.html",headers:[{level:2,title:"Java IO - ",slug:"java-io-",normalizedTitle:"java io - ",charIndex:2},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:32},{level:3,title:"File",slug:"file",normalizedTitle:"file",charIndex:117},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:131},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:144},{level:3,title:" & Serializable & transient",slug:"-serializable-transient",normalizedTitle:" &amp; serializable &amp; transient",charIndex:null},{level:3,title:"Java :",slug:"java-",normalizedTitle:"java :",charIndex:203},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:290},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:300}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO -  IO File    & Serializable & transient Java :  ",content:'# Java IO - \n\n> Java IO @pdai\n\n * Java IO - \n   * IO\n     * File\n     * \n     * \n     *  & Serializable & transient\n     * Java :\n       * InetAddress\n       * URL\n       * Sockets\n       * Datagram\n   * \n   * \n\n\n# IO\n\nJava  I/O :\n\n * : File\n * : InputStream  OutputStream\n * : Reader  Writer\n * : Serializable\n * : Socket\n\n\n# File\n\nFile \n\n:\n\npublic static void listAllFiles(File dir) {\n    if (dir == null || !dir.exists()) {\n        return;\n    }\n    if (dir.isFile()) {\n        System.out.println(dir.getName());\n        return;\n    }\n    for (File file : dir.listFiles()) {\n        listAllFiles(file);\n    }\n}\n\n\n\n# \n\npublic static void copyFile(String src, String dist) throws IOException {\n\n    FileInputStream in = new FileInputStream(src);\n    FileOutputStream out = new FileOutputStream(dist);\n    byte[] buffer = new byte[20 * 1024];\n\n    // read()  buffer.length \n    // \n    //  -1  eof\n    while (in.read(buffer, 0, buffer.length) != -1) {\n        out.write(buffer);\n    }\n\n    in.close();\n    out.close();\n}\n\n\n\n# \n\npublic static void readFileContent(String filePath) throws IOException {\n\n    FileReader fileReader = new FileReader(filePath);\n    BufferedReader bufferedReader = new BufferedReader(fileReader);\n\n    String line;\n    while ((line = bufferedReader.readLine()) != null) {\n        System.out.println(line);\n    }\n\n    //  BufferedReader  Reader \n    //  BufferedReader  close()  Reader  close() \n    //  close() \n    bufferedReader.close();\n}\n\n\n\n#  & Serializable & transient\n\n\n\n * : ObjectOutputStream.writeObject()\n * : ObjectInputStream.readObject()\n\n\n\nSerializable\n\n Serializable \n\npublic static void main(String[] args) throws IOException, ClassNotFoundException {\n    A a1 = new A(123, "abc");\n    String objectFile = "file/a1";\n    ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(objectFile));\n    objectOutputStream.writeObject(a1);\n    objectOutputStream.close();\n\n    ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(objectFile));\n    A a2 = (A) objectInputStream.readObject();\n    objectInputStream.close();\n    System.out.println(a2);\n}\n\nprivate static class A implements Serializable {\n    private int x;\n    private String y;\n\n    A(int x, String y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    @Override\n    public String toString() {\n        return "x = " + x + "  " + "y = " + y;\n    }\n}\n\n\ntransient\n\ntransient \n\nArrayList  elementData  transient \n\nprivate transient Object[] elementData;\n\n\n\n# Java :\n\n * InetAddress:  IP \n * URL: \n * Sockets:  TCP \n * Datagram:  UDP \n\n# InetAddress\n\n\n\nInetAddress.getByName(String host);\nInetAddress.getByAddress(byte[] address);\n\n\n# URL\n\n URL \n\npublic static void main(String[] args) throws IOException {\n\n    URL url = new URL("http://www.baidu.com");\n\n    /*  */\n    InputStream is = url.openStream();\n\n    /*  */\n    InputStreamReader isr = new InputStreamReader(is, "utf-8");\n\n    /*  */\n    BufferedReader br = new BufferedReader(isr);\n\n    String line;\n    while ((line = br.readLine()) != null) {\n        System.out.println(line);\n    }\n\n    br.close();\n}\n\n\n# Sockets\n\n * ServerSocket: \n * Socket: \n *  InputStream  OutputStream \n\n\n\n# Datagram\n\n * DatagramSocket: \n * DatagramPacket: \n\n\n# \n\n * Java readint\n\nhttps://blog.csdn.net/congwiny/article/details/18922847\n\n\n# ',normalizedContent:'# java io - \n\n> java io @pdai\n\n * java io - \n   * io\n     * file\n     * \n     * \n     *  & serializable & transient\n     * java :\n       * inetaddress\n       * url\n       * sockets\n       * datagram\n   * \n   * \n\n\n# io\n\njava  i/o :\n\n * : file\n * : inputstream  outputstream\n * : reader  writer\n * : serializable\n * : socket\n\n\n# file\n\nfile \n\n:\n\npublic static void listallfiles(file dir) {\n    if (dir == null || !dir.exists()) {\n        return;\n    }\n    if (dir.isfile()) {\n        system.out.println(dir.getname());\n        return;\n    }\n    for (file file : dir.listfiles()) {\n        listallfiles(file);\n    }\n}\n\n\n\n# \n\npublic static void copyfile(string src, string dist) throws ioexception {\n\n    fileinputstream in = new fileinputstream(src);\n    fileoutputstream out = new fileoutputstream(dist);\n    byte[] buffer = new byte[20 * 1024];\n\n    // read()  buffer.length \n    // \n    //  -1  eof\n    while (in.read(buffer, 0, buffer.length) != -1) {\n        out.write(buffer);\n    }\n\n    in.close();\n    out.close();\n}\n\n\n\n# \n\npublic static void readfilecontent(string filepath) throws ioexception {\n\n    filereader filereader = new filereader(filepath);\n    bufferedreader bufferedreader = new bufferedreader(filereader);\n\n    string line;\n    while ((line = bufferedreader.readline()) != null) {\n        system.out.println(line);\n    }\n\n    //  bufferedreader  reader \n    //  bufferedreader  close()  reader  close() \n    //  close() \n    bufferedreader.close();\n}\n\n\n\n#  & serializable & transient\n\n\n\n * : objectoutputstream.writeobject()\n * : objectinputstream.readobject()\n\n\n\nserializable\n\n serializable \n\npublic static void main(string[] args) throws ioexception, classnotfoundexception {\n    a a1 = new a(123, "abc");\n    string objectfile = "file/a1";\n    objectoutputstream objectoutputstream = new objectoutputstream(new fileoutputstream(objectfile));\n    objectoutputstream.writeobject(a1);\n    objectoutputstream.close();\n\n    objectinputstream objectinputstream = new objectinputstream(new fileinputstream(objectfile));\n    a a2 = (a) objectinputstream.readobject();\n    objectinputstream.close();\n    system.out.println(a2);\n}\n\nprivate static class a implements serializable {\n    private int x;\n    private string y;\n\n    a(int x, string y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    @override\n    public string tostring() {\n        return "x = " + x + "  " + "y = " + y;\n    }\n}\n\n\ntransient\n\ntransient \n\narraylist  elementdata  transient \n\nprivate transient object[] elementdata;\n\n\n\n# java :\n\n * inetaddress:  ip \n * url: \n * sockets:  tcp \n * datagram:  udp \n\n# inetaddress\n\n\n\ninetaddress.getbyname(string host);\ninetaddress.getbyaddress(byte[] address);\n\n\n# url\n\n url \n\npublic static void main(string[] args) throws ioexception {\n\n    url url = new url("http://www.baidu.com");\n\n    /*  */\n    inputstream is = url.openstream();\n\n    /*  */\n    inputstreamreader isr = new inputstreamreader(is, "utf-8");\n\n    /*  */\n    bufferedreader br = new bufferedreader(isr);\n\n    string line;\n    while ((line = br.readline()) != null) {\n        system.out.println(line);\n    }\n\n    br.close();\n}\n\n\n# sockets\n\n * serversocket: \n * socket: \n *  inputstream  outputstream \n\n\n\n# datagram\n\n * datagramsocket: \n * datagrampacket: \n\n\n# \n\n * java readint\n\nhttps://blog.csdn.net/congwiny/article/details/18922847\n\n\n# ',charsets:{cjk:!0}},{title:"IO  - Unix IO ",frontmatter:{},regularPath:"/java/io/java-io-model.html",relativePath:"java/io/java-io-model.md",key:"v-4b0b72ce",path:"/java/io/java-io-model.html",headers:[{level:2,title:"IO  - Unix IO ",slug:"io--unix-io-",normalizedTitle:"io  - unix io ",charIndex:2},{level:2,title:"Unix IO ",slug:"unix-io-",normalizedTitle:"unix io ",charIndex:110},{level:3,title:" I/O",slug:"-i-o",normalizedTitle:" i/o",charIndex:130},{level:3,title:" I/O",slug:"-i-o",normalizedTitle:" i/o",charIndex:145},{level:3,title:"I/O ",slug:"i-o-",normalizedTitle:"i/o ",charIndex:161},{level:3,title:" I/O",slug:"-i-o",normalizedTitle:" i/o",charIndex:175},{level:3,title:" I/O",slug:"-i-o",normalizedTitle:" i/o",charIndex:191},{level:2,title:"I/O ",slug:"i-o-",normalizedTitle:"i/o ",charIndex:203},{level:3,title:" I/O  I/O",slug:"-i-o--i-o",normalizedTitle:" i/o  i/o",charIndex:219},{level:3,title:" I/O ",slug:"-i-o-",normalizedTitle:" i/o ",charIndex:241},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:66},{level:3,title:"IO",slug:"io",normalizedTitle:"io",charIndex:272},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:326},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:405}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"IO  - Unix IO  Unix IO   I/O  I/O I/O   I/O  I/O I/O   I/O  I/O  I/O  IO IO  ",content:"# IO  - Unix IO \n\n>  Unix I/O 55IO@pdai\n\n * IO  - Unix IO \n   * Unix IO \n     *  I/O\n     *  I/O\n     * I/O \n     *  I/O\n     *  I/O\n   * I/O \n     *  I/O  I/O\n     *  I/O \n   * IO\n     * IO\n       * 1. LT \n       * 2. ET \n     * \n       * 1. select \n       * 2. poll \n       * 3. epoll \n   * \n\n\n# Unix IO \n\n:\n\n * \n * \n\n\n\nUnix  I/O :\n\n *  I/O\n *  I/O\n * I/O (select  poll)\n *  I/O(SIGIO)\n *  I/O(AIO)\n\n\n#  I/O\n\n\n\n CPU \n\nrecvfrom  Socket  buf  recvfrom() \n\nssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);\n\n\n\n\n\n\n\n\n\n#  I/O\n\n I/O (polling)\n\n CPU \n\n\n\n\n\n\n\n\n# I/O \n\n select  poll  recvfrom \n\n I/O  Event Driven I/O I/O\n\n Web  I/O  Socket I/O \n\n\n\n\n\n\n\n\n#  I/O\n\n sigaction  SIGIO  recvfrom \n\n I/O  I/O  CPU \n\n\n\n\n\n\n\n\n#  I/O\n\n aio_read \n\n I/O  I/O  I/O  I/O  I/O  I/O\n\n\n\n\n\n\n\n\n# I/O \n\n\n#  I/O  I/O\n\n *  I/O:  recvfrom \n *  I/O: \n\n I/O I/OI/O  I/O  I/O I/O  I/O \n\n\n#  I/O \n\n I/O : \n\n\n\n\n# IO\n\n> IOJava NIO - IOIORactorJava NIO\n\n: IO\n\n\n# IO\n\nepoll : LT(level trigger) ET(edge trigger)\n\n# 1. LT \n\n epoll_wait()  epoll_wait()  Blocking  No-Blocking\n\n# 2. ET \n\n LT  epoll_wait() \n\n epoll  LT  No-Blocking/\n\n\n# \n\n epoll select  poll \n\n# 1. select \n\nselect  timeout  1ns poll  epoll  1ms select \n\nselect \n\n# 2. poll \n\npoll  poll  select\n\n 1000  epoll epoll \n\n epoll epoll  epoll_ctl() epoll \n\n# 3. epoll \n\n Linux \n\n\n# \n\n * Stevens W R, Fenner B, Rudoff A M. UNIX network programming[M]. Addison-Wesley Professional, 2004.\n * Boost application performance using asynchronous I/O\n * Synchronous and Asynchronous I/O\n * Linux IO  selectpollepoll \n * poll vs select vs event-based\n * select / poll / epoll: practical difference for system architects\n * Browse the source code of userspace/glibc/sysdeps/unix/sysv/linux/ online",normalizedContent:"# io  - unix io \n\n>  unix i/o 55io@pdai\n\n * io  - unix io \n   * unix io \n     *  i/o\n     *  i/o\n     * i/o \n     *  i/o\n     *  i/o\n   * i/o \n     *  i/o  i/o\n     *  i/o \n   * io\n     * io\n       * 1. lt \n       * 2. et \n     * \n       * 1. select \n       * 2. poll \n       * 3. epoll \n   * \n\n\n# unix io \n\n:\n\n * \n * \n\n\n\nunix  i/o :\n\n *  i/o\n *  i/o\n * i/o (select  poll)\n *  i/o(sigio)\n *  i/o(aio)\n\n\n#  i/o\n\n\n\n cpu \n\nrecvfrom  socket  buf  recvfrom() \n\nssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);\n\n\n\n\n\n\n\n\n\n#  i/o\n\n i/o (polling)\n\n cpu \n\n\n\n\n\n\n\n\n# i/o \n\n select  poll  recvfrom \n\n i/o  event driven i/o i/o\n\n web  i/o  socket i/o \n\n\n\n\n\n\n\n\n#  i/o\n\n sigaction  sigio  recvfrom \n\n i/o  i/o  cpu \n\n\n\n\n\n\n\n\n#  i/o\n\n aio_read \n\n i/o  i/o  i/o  i/o  i/o  i/o\n\n\n\n\n\n\n\n\n# i/o \n\n\n#  i/o  i/o\n\n *  i/o:  recvfrom \n *  i/o: \n\n i/o i/oi/o  i/o  i/o i/o  i/o \n\n\n#  i/o \n\n i/o : \n\n\n\n\n# io\n\n> iojava nio - ioioractorjava nio\n\n: io\n\n\n# io\n\nepoll : lt(level trigger) et(edge trigger)\n\n# 1. lt \n\n epoll_wait()  epoll_wait()  blocking  no-blocking\n\n# 2. et \n\n lt  epoll_wait() \n\n epoll  lt  no-blocking/\n\n\n# \n\n epoll select  poll \n\n# 1. select \n\nselect  timeout  1ns poll  epoll  1ms select \n\nselect \n\n# 2. poll \n\npoll  poll  select\n\n 1000  epoll epoll \n\n epoll epoll  epoll_ctl() epoll \n\n# 3. epoll \n\n linux \n\n\n# \n\n * stevens w r, fenner b, rudoff a m. unix network programming[m]. addison-wesley professional, 2004.\n * boost application performance using asynchronous i/o\n * synchronous and asynchronous i/o\n * linux io  selectpollepoll \n * poll vs select vs event-based\n * select / poll / epoll: practical difference for system architects\n * browse the source code of userspace/glibc/sysdeps/unix/sysv/linux/ online",charsets:{cjk:!0}},{title:"Java NIO - ",frontmatter:{},regularPath:"/java/io/java-io-nio-zerocopy.html",relativePath:"java/io/java-io-nio-zerocopy.md",key:"v-5391637e",path:"/java/io/java-io-nio-zerocopy.html",headers:[{level:2,title:"Java NIO - ",slug:"java-nio-",normalizedTitle:"java nio - ",charIndex:2},{level:2,title:"Java NIO",slug:"java-nio",normalizedTitle:"java nio",charIndex:270},{level:3,title:"MappedByteBuffer",slug:"mappedbytebuffer",normalizedTitle:"mappedbytebuffer",charIndex:124},{level:3,title:"DirectByteBuffer",slug:"directbytebuffer",normalizedTitle:"directbytebuffer",charIndex:313},{level:3,title:"FileChannel",slug:"filechannel",normalizedTitle:"filechannel",charIndex:159},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:354},{level:3,title:"Netty",slug:"netty",normalizedTitle:"netty",charIndex:370},{level:3,title:"RocketMQKafka",slug:"rocketmqkafka",normalizedTitle:"rocketmqkafka",charIndex:386},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:408}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java NIO -  Java NIO MappedByteBuffer DirectByteBuffer FileChannel  Netty RocketMQKafka ",content:'# Java NIO - \n\n> Java NIO Linux Java NIO mmap MappedByteBuffer  sendfile  FileChannel Netty  RocketMQ  Kafka @pdai\n\n * Java NIO - \n   * Java NIO\n     * MappedByteBuffer\n     * DirectByteBuffer\n     * FileChannel\n   * \n     * Netty\n     * RocketMQKafka\n   * \n\n\n# Java NIO\n\n Java NIO Channelkernel spaceBufferuser spaceuser buffer\n\n * Channelread buffersocket buffer\n * BufferHeapBufferDirectBuffer malloc() \n\nDirectBufferHeapBuffer GC  HeapBuffer  GC NIO  HeapBuffer  DirectBuffer native memory sun.misc.Unsafe.copyMemory()  memcpy()   DirectBuffer  I/O  Java  I/O \n\n\n# MappedByteBuffer\n\nMappedByteBuffer  NIO **mmap** ByteBufferFileChannel  map()  position  size  map()  FileChannel \n\npublic abstract MappedByteBuffer map(MapMode mode, long position, long size)\n        throws IOException;\n\n\n * modeMappedByteBufferREAD_ONLYREAD_WRITEPRIVATE\n * positionMappedByteBuffer\n * size position MappedByteBuffer\n\nMappedByteBuffer  ByteBuffer  fore()load()  isLoad() \n\n * fore() READ_WRITE \n * load()\n * isLoaded() true false\n\n MappedByteBuffer \n\nprivate final static String CONTENT = "Zero copy implemented by MappedByteBuffer";\nprivate final static String FILE_NAME = "/mmap.txt";\nprivate final static String CHARSET = "UTF-8";\n\n\n *  fileChannel  fileChannel  mappedByteBuffer mappedByteBuffer force() \n\n@Test\npublic void writeToFileByMappedByteBuffer() {\n    Path path = Paths.get(getClass().getResource(FILE_NAME).getPath());\n    byte[] bytes = CONTENT.getBytes(Charset.forName(CHARSET));\n    try (FileChannel fileChannel = FileChannel.open(path, StandardOpenOption.READ,\n            StandardOpenOption.WRITE, StandardOpenOption.TRUNCATE_EXISTING)) {\n        MappedByteBuffer mappedByteBuffer = fileChannel.map(READ_WRITE, 0, bytes.length);\n        if (mappedByteBuffer != null) {\n            mappedByteBuffer.put(bytes);\n            mappedByteBuffer.force();\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\n\n\n *  fileChannel  fileChannel  mappedByteBuffer mappedByteBuffer \n\n@Test\npublic void readFromFileByMappedByteBuffer() {\n    Path path = Paths.get(getClass().getResource(FILE_NAME).getPath());\n    int length = CONTENT.getBytes(Charset.forName(CHARSET)).length;\n    try (FileChannel fileChannel = FileChannel.open(path, StandardOpenOption.READ)) {\n        MappedByteBuffer mappedByteBuffer = fileChannel.map(READ_ONLY, 0, length);\n        if (mappedByteBuffer != null) {\n            byte[] bytes = new byte[length];\n            mappedByteBuffer.get(bytes);\n            String content = new String(bytes, StandardCharsets.UTF_8);\n            assertEquals(content, "Zero copy implemented by MappedByteBuffer");\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\n\n\n map() map()  java.nio.channels.FileChannel  sun.nio.ch.FileChannelImpl.java \n\npublic MappedByteBuffer map(MapMode mode, long position, long size) throws IOException {\n    int pagePosition = (int)(position % allocationGranularity);\n    long mapPosition = position - pagePosition;\n    long mapSize = size + pagePosition;\n    try {\n        addr = map0(imode, mapPosition, mapSize);\n    } catch (OutOfMemoryError x) {\n        System.gc();\n        try {\n            Thread.sleep(100);\n        } catch (InterruptedException y) {\n            Thread.currentThread().interrupt();\n        }\n        try {\n            addr = map0(imode, mapPosition, mapSize);\n        } catch (OutOfMemoryError y) {\n            throw new IOException("Map failed", y);\n        }\n    }\n\n    int isize = (int)size;\n    Unmapper um = new Unmapper(addr, mapSize, isize, mfd);\n    if ((!writable) || (imode == MAP_RO)) {\n        return Util.newMappedByteBufferR(isize, addr + pagePosition, mfd, um);\n    } else {\n        return Util.newMappedByteBuffer(isize, addr + pagePosition, mfd, um);\n    }\n}\n\n\nmap()  map0() \n\n *  Java  MappedByteBuffer  OOM 100ms \n *  Util  newMappedByteBuffer  newMappedByteBufferR  DirectByteBuffer  DirectByteBuffer  MappedByteBuffer \n\nmap()  +  read()  write()  sun.misc.Unsafe getByte()  putByte() \n\nprivate native long map0(int prot, long position, long mapSize) throws IOException;\n\n\nnative methodmap0  JNIJava Native Interface C  native Java_sun_nio_ch_FileChannelImpl_map0 JDK  native/sun/nio/ch/FileChannelImpl.c\n\nJNIEXPORT jlong JNICALL\nJava_sun_nio_ch_FileChannelImpl_map0(JNIEnv *env, jobject this,\n                                     jint prot, jlong off, jlong len)\n{\n    void *mapAddress = 0;\n    jobject fdo = (*env)->GetObjectField(env, this, chan_fd);\n    jint fd = fdval(env, fdo);\n    int protections = 0;\n    int flags = 0;\n\n    if (prot == sun_nio_ch_FileChannelImpl_MAP_RO) {\n        protections = PROT_READ;\n        flags = MAP_SHARED;\n    } else if (prot == sun_nio_ch_FileChannelImpl_MAP_RW) {\n        protections = PROT_WRITE | PROT_READ;\n        flags = MAP_SHARED;\n    } else if (prot == sun_nio_ch_FileChannelImpl_MAP_PV) {\n        protections =  PROT_WRITE | PROT_READ;\n        flags = MAP_PRIVATE;\n    }\n\n    mapAddress = mmap64(\n        0,                    /* Let OS decide location */\n        len,                  /* Number of bytes to map */\n        protections,          /* File permissions */\n        flags,                /* Changes are shared */\n        fd,                   /* File descriptor of mapped file */\n        off);                 /* Offset into file */\n\n    if (mapAddress == MAP_FAILED) {\n        if (errno == ENOMEM) {\n            JNU_ThrowOutOfMemoryError(env, "Map failed");\n            return IOS_THROWN;\n        }\n        return handle(env, -1, "Map failed");\n    }\n\n    return ((jlong) (unsigned long) mapAddress);\n}\n\n\n map0()  mmap64()  Linux  mmap64() \n\n#include <sys/mman.h>\n\nvoid *mmap64(void *addr, size_t len, int prot, int flags, int fd, off64_t offset);\n\n\n mmap64() \n\n * addr 0  NULL + flags  MAP_FIXED addr \n * len\n * prot\n   * PROT_READ\n   * PROT_WRITE\n   * PROT_EXEC\n   * PROT_NONE\n * flags\n   * MAP_PRIVATE\n   * MAP_SHARED\n   * MAP_FIXED addr  addr \n * fd map  1 unmap  1\n * offset\n\n MappedByteBuffer \n\n * MappedByteBuffer map JVM  -Xmx   Integer.MAX_VALUE  position  map \n * MappedByteBuffer \n * MappedByteBuffer  mmap()  unmap()  unmap()  FileChannelImpl  Java  sun.misc.Cleaner  clean() \n\npublic static void clean(final Object buffer) throws Exception {\n    AccessController.doPrivileged((PrivilegedAction<Void>) () -> {\n        try {\n            Method getCleanerMethod = buffer.getClass().getMethod("cleaner", new Class[0]);\n            getCleanerMethod.setAccessible(true);\n            Cleaner cleaner = (Cleaner) getCleanerMethod.invoke(buffer, new Object[0]);\n            cleaner.clean();\n        } catch(Exception e) {\n            e.printStackTrace();\n        }\n    });\n}\n\n\n\n# DirectByteBuffer\n\nDirectByteBuffer  Java JVM  DirectByteBuffer  DirectByteBuffer  allocateDirect()  DirectByteBuffer \n\npublic static ByteBuffer allocateDirect(int capacity) {\n    return new DirectByteBuffer(capacity);\n}\n\n\nDirectByteBuffer  Unsafe  allocateMemory()  malloc() \n\nDirectByteBuffer(int cap) {\n    super(-1, 0, cap, cap);\n    boolean pa = VM.isDirectMemoryPageAligned();\n    int ps = Bits.pageSize();\n    long size = Math.max(1L, (long)cap + (pa ? ps : 0));\n    Bits.reserveMemory(size, cap);\n\n    long base = 0;\n    try {\n        base = unsafe.allocateMemory(size);\n    } catch (OutOfMemoryError x) {\n        Bits.unreserveMemory(size, cap);\n        throw x;\n    }\n    unsafe.setMemory(base, size, (byte) 0);\n    if (pa && (base % ps != 0)) {\n        address = base + ps - (base & (ps - 1));\n    } else {\n        address = base;\n    }\n    cleaner = Cleaner.create(this, new Deallocator(base, size, cap));\n    att = null;\n}\n\n\n DirectByteBuffer  Deallocator  Cleaner  freeMemory() freeMemory()  free() \n\nprivate static class Deallocator implements Runnable {\n    private static Unsafe unsafe = Unsafe.getUnsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private Deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            return;\n        }\n        unsafe.freeMemory(address);\n        address = 0;\n        Bits.unreserveMemory(size, capacity);\n    }\n}\n\n\n DirectByteBuffer  JVM  OutOfMemoryError\n\n DirectByteBuffer  MappedByteBuffer  map()  Util.newMappedByteBuffer() \n\nstatic MappedByteBuffer newMappedByteBuffer(int size, long addr, FileDescriptor fd,\n                                            Runnable unmapper) {\n    MappedByteBuffer dbb;\n    if (directByteBufferConstructor == null)\n        initDBBConstructor();\n    try {\n        dbb = (MappedByteBuffer)directByteBufferConstructor.newInstance(\n            new Object[] { new Integer(size), new Long(addr), fd, unmapper });\n    } catch (InstantiationException | IllegalAccessException | InvocationTargetException e) {\n        throw new InternalError(e);\n    }\n    return dbb;\n}\n\nprivate static void initDBBRConstructor() {\n    AccessController.doPrivileged(new PrivilegedAction<Void>() {\n        public Void run() {\n            try {\n                Class<?> cl = Class.forName("java.nio.DirectByteBufferR");\n                Constructor<?> ctor = cl.getDeclaredConstructor(\n                    new Class<?>[] { int.class, long.class, FileDescriptor.class,\n                                    Runnable.class });\n                ctor.setAccessible(true);\n                directByteBufferRConstructor = ctor;\n            } catch (ClassNotFoundException | NoSuchMethodException |\n                     IllegalArgumentException | ClassCastException x) {\n                throw new InternalError(x);\n            }\n            return null;\n        }});\n}\n\n\nDirectByteBuffer  MappedByteBuffer Util.newMappedByteBuffer()  DirectByteBuffer  DirectByteBuffer \n\nprotected DirectByteBuffer(int cap, long addr, FileDescriptor fd, Runnable unmapper) {\n    super(-1, 0, cap, cap, fd);\n    address = addr;\n    cleaner = Cleaner.create(this, unmapper);\n    att = null;\n}\n\n\nDirectByteBuffer DirectByteBuffer  MappedByteBuffer  get()  write() \n\n * \n\npublic byte get() {\n    return ((unsafe.getByte(ix(nextGetIndex()))));\n}\n\npublic byte get(int i) {\n    return ((unsafe.getByte(ix(checkIndex(i)))));\n}\n\n\n * \n\npublic ByteBuffer put(byte x) {\n    unsafe.putByte(ix(nextPutIndex()), ((x)));\n    return this;\n}\n\npublic ByteBuffer put(int i, byte x) {\n    unsafe.putByte(ix(checkIndex(i)), ((x)));\n    return this;\n}\n\n\n ix()  ix() address i  unsafe  get()  put() \n\nprivate long ix(int i) {\n    return address + ((long)i << 0);\n}\n\n\n\n# FileChannel\n\nFileChannel  FileInputStreamFileOutputStream  RandomAccessFile  getChannel() FileChannel  transferFrom()  transferTo() \n\n * transferTo() FileChannel  WritableByteChannel \n\npublic abstract long transferTo(long position, long count, WritableByteChannel target)\n        throws IOException;\n\n\n * transferFrom() ReadableByteChannel  FileChannel \n\npublic abstract long transferFrom(ReadableByteChannel src, long position, long count)\n        throws IOException;\n\n\n FileChannel  transferTo()  transferFrom() \n\nprivate static final String CONTENT = "Zero copy implemented by FileChannel";\nprivate static final String SOURCE_FILE = "/source.txt";\nprivate static final String TARGET_FILE = "/target.txt";\nprivate static final String CHARSET = "UTF-8";\n\n\n source.txt  target.txt  source.txt \n\n@Before\npublic void setup() {\n    Path source = Paths.get(getClassPath(SOURCE_FILE));\n    byte[] bytes = CONTENT.getBytes(Charset.forName(CHARSET));\n    try (FileChannel fromChannel = FileChannel.open(source, StandardOpenOption.READ,\n            StandardOpenOption.WRITE, StandardOpenOption.TRUNCATE_EXISTING)) {\n        fromChannel.write(ByteBuffer.wrap(bytes));\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\n\n\n transferTo()  toChannel  WritableByteChannel transferFrom()  fromChannel  ReadableByteChannelFileChannelSocketChannel  DatagramChannel  WritableByteChannel  ReadableByteChannel  FileChannel  channel-to-channel \n\n transferTo()  fromChannel  toChannel\n\n@Test\npublic void transferTo() throws Exception {\n    try (FileChannel fromChannel = new RandomAccessFile(\n             getClassPath(SOURCE_FILE), "rw").getChannel();\n         FileChannel toChannel = new RandomAccessFile(\n             getClassPath(TARGET_FILE), "rw").getChannel()) {\n        long position = 0L;\n        long offset = fromChannel.size();\n        fromChannel.transferTo(position, offset, toChannel);\n    }\n}\n\n\n transferFrom()  fromChannel  toChannel\n\n@Test\npublic void transferFrom() throws Exception {\n    try (FileChannel fromChannel = new RandomAccessFile(\n             getClassPath(SOURCE_FILE), "rw").getChannel();\n         FileChannel toChannel = new RandomAccessFile(\n             getClassPath(TARGET_FILE), "rw").getChannel()) {\n        long position = 0L;\n        long offset = fromChannel.size();\n        toChannel.transferFrom(fromChannel, position, offset);\n    }\n}\n\n\n transferTo()  transferFrom()  java.nio.channels.FileChannel  sun.nio.ch.FileChannelImpl.java transferTo()  transferFrom()  sendfile  FileChannelImpl.java  3  sendfile  sendfile \n\nprivate static volatile boolean transferSupported = true;\nprivate static volatile boolean pipeSupported = true;\nprivate static volatile boolean fileSupported = true;\n\n\n * transferSupported sendfile()  true\n * pipeSupportedfdpipe sendfile()  true\n * fileSupportedfdfile sendfile()  true\n\n transferTo() FileChannelImpl  transferToDirectly()  sendfile  sendfile transferToTrustedChannel()  mmap  FileChannelImpl  SelChImpl  transferToArbitraryChannel()  I/O  DirectBuffer FileChannel  DirectBuffer WritableByteChannel \n\npublic long transferTo(long position, long count, WritableByteChannel target)\n        throws IOException {\n    // \n    long sz = size();\n    // \n    if (position > sz)\n        return 0;\n    int icount = (int)Math.min(count, Integer.MAX_VALUE);\n    // \n    if ((sz - position) < icount)\n        icount = (int)(sz - position);\n\n    long n;\n\n    if ((n = transferToDirectly(position, icount, target)) >= 0)\n        return n;\n\n    if ((n = transferToTrustedChannel(position, icount, target)) >= 0)\n        return n;\n\n    return transferToArbitraryChannel(position, icount, target);\n}\n\n\n transferToDirectly()  transferTo()  sendfile transferToDirectlyInternal()  WritableByteChannel  targetFD transferToDirectlyInternal() \n\nprivate long transferToDirectly(long position, int icount, WritableByteChannel target)\n        throws IOException {\n    // targettargetFD\n    if (nd.transferToDirectlyNeedsPositionLock()) {\n        synchronized (positionLock) {\n            long pos = position();\n            try {\n                return transferToDirectlyInternal(position, icount,\n                        target, targetFD);\n            } finally {\n                position(pos);\n            }\n        }\n    } else {\n        return transferToDirectlyInternal(position, icount, target, targetFD);\n    }\n}\n\n\n transferToDirectlyInternal()  transferTo0()  sendfile  sendfile Windows  UNSUPPORTED  transferSupported  false sendfile  Linux  DMA gather copy  UNSUPPORTED_CASE  pipeSupported  fileSupported  false\n\nprivate long transferToDirectlyInternal(long position, int icount,\n                                        WritableByteChannel target,\n                                        FileDescriptor targetFD) throws IOException {\n    assert !nd.transferToDirectlyNeedsPositionLock() ||\n            Thread.holdsLock(positionLock);\n\n    long n = -1;\n    int ti = -1;\n    try {\n        begin();\n        ti = threads.add();\n        if (!isOpen())\n            return -1;\n        do {\n            n = transferTo0(fd, position, icount, targetFD);\n        } while ((n == IOStatus.INTERRUPTED) && isOpen());\n        if (n == IOStatus.UNSUPPORTED_CASE) {\n            if (target instanceof SinkChannelImpl)\n                pipeSupported = false;\n            if (target instanceof FileChannelImpl)\n                fileSupported = false;\n            return IOStatus.UNSUPPORTED_CASE;\n        }\n        if (n == IOStatus.UNSUPPORTED) {\n            transferSupported = false;\n            return IOStatus.UNSUPPORTED;\n        }\n        return IOStatus.normalize(n);\n    } finally {\n        threads.remove(ti);\n        end (n > -1);\n    }\n}\n\n\nnative methodtransferTo0()  JNIJava Native Interface C  native Java_sun_nio_ch_FileChannelImpl_transferTo0 JDK  native/sun/nio/ch/FileChannelImpl.c JNI  Java_sun_nio_ch_FileChannelImpl_transferTo0()  JDK  Linux  transferTo() \n\n#if defined(__linux__) || defined(__solaris__)\n#include <sys/sendfile.h>\n#elif defined(_AIX)\n#include <sys/socket.h>\n#elif defined(_ALLBSD_SOURCE)\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <sys/uio.h>\n\n#define lseek64 lseek\n#define mmap64 mmap\n#endif\n\nJNIEXPORT jlong JNICALL\nJava_sun_nio_ch_FileChannelImpl_transferTo0(JNIEnv *env, jobject this,\n                                            jobject srcFDO,\n                                            jlong position, jlong count,\n                                            jobject dstFDO)\n{\n    jint srcFD = fdval(env, srcFDO);\n    jint dstFD = fdval(env, dstFDO);\n\n#if defined(__linux__)\n    off64_t offset = (off64_t)position;\n    jlong n = sendfile64(dstFD, srcFD, &offset, (size_t)count);\n    return n;\n#elif defined(__solaris__)\n    result = sendfilev64(dstFD, &sfv, 1, &numBytes);    \n    return result;\n#elif defined(__APPLE__)\n    result = sendfile(srcFD, dstFD, position, &numBytes, NULL, 0);\n    return result;\n#endif\n}\n\n\n LinuxSolaris  Apple transferTo0()  sendfile64 sendfile64() \n\n#include <sys/sendfile.h>\n\nssize_t sendfile64(int out_fd, int in_fd, off_t *offset, size_t count);\n\n\n sendfile64() \n\n * out_fd\n * in_fd\n * offset in_fd \n * count in_fd  out_fd \n\n Linux 2.6.3 out_fd  socket Linux 2.6.3 out_fd sendfile64() \n\n\n# \n\n\n# Netty\n\nNetty ,  Netty Java \n\nNetty  DefaultFileRegion  java.nio.channels.FileChannel  tranferTo() Channel\n\nByteBuf  wrap ByteBufByteBuffer  ByteBuf ,  ByteBuf  slice ,  ByteBuf  ByteBuf Netty  CompositeByteBuf  ByteBuf  ByteBuf ByteBuf   1  3 \n\n\n# RocketMQKafka\n\nRocketMQ  mmap + write  Kafka  sendfile Kafka  mmap + write  sendfile \n\n\n\n\n# \n\n *  https://zhuanlan.zhihu.com/p/83398714\n * ',normalizedContent:'# java nio - \n\n> java nio linux java nio mmap mappedbytebuffer  sendfile  filechannel netty  rocketmq  kafka @pdai\n\n * java nio - \n   * java nio\n     * mappedbytebuffer\n     * directbytebuffer\n     * filechannel\n   * \n     * netty\n     * rocketmqkafka\n   * \n\n\n# java nio\n\n java nio channelkernel spacebufferuser spaceuser buffer\n\n * channelread buffersocket buffer\n * bufferheapbufferdirectbuffer malloc() \n\ndirectbufferheapbuffer gc  heapbuffer  gc nio  heapbuffer  directbuffer native memory sun.misc.unsafe.copymemory()  memcpy()   directbuffer  i/o  java  i/o \n\n\n# mappedbytebuffer\n\nmappedbytebuffer  nio **mmap** bytebufferfilechannel  map()  position  size  map()  filechannel \n\npublic abstract mappedbytebuffer map(mapmode mode, long position, long size)\n        throws ioexception;\n\n\n * modemappedbytebufferread_onlyread_writeprivate\n * positionmappedbytebuffer\n * size position mappedbytebuffer\n\nmappedbytebuffer  bytebuffer  fore()load()  isload() \n\n * fore() read_write \n * load()\n * isloaded() true false\n\n mappedbytebuffer \n\nprivate final static string content = "zero copy implemented by mappedbytebuffer";\nprivate final static string file_name = "/mmap.txt";\nprivate final static string charset = "utf-8";\n\n\n *  filechannel  filechannel  mappedbytebuffer mappedbytebuffer force() \n\n@test\npublic void writetofilebymappedbytebuffer() {\n    path path = paths.get(getclass().getresource(file_name).getpath());\n    byte[] bytes = content.getbytes(charset.forname(charset));\n    try (filechannel filechannel = filechannel.open(path, standardopenoption.read,\n            standardopenoption.write, standardopenoption.truncate_existing)) {\n        mappedbytebuffer mappedbytebuffer = filechannel.map(read_write, 0, bytes.length);\n        if (mappedbytebuffer != null) {\n            mappedbytebuffer.put(bytes);\n            mappedbytebuffer.force();\n        }\n    } catch (ioexception e) {\n        e.printstacktrace();\n    }\n}\n\n\n *  filechannel  filechannel  mappedbytebuffer mappedbytebuffer \n\n@test\npublic void readfromfilebymappedbytebuffer() {\n    path path = paths.get(getclass().getresource(file_name).getpath());\n    int length = content.getbytes(charset.forname(charset)).length;\n    try (filechannel filechannel = filechannel.open(path, standardopenoption.read)) {\n        mappedbytebuffer mappedbytebuffer = filechannel.map(read_only, 0, length);\n        if (mappedbytebuffer != null) {\n            byte[] bytes = new byte[length];\n            mappedbytebuffer.get(bytes);\n            string content = new string(bytes, standardcharsets.utf_8);\n            assertequals(content, "zero copy implemented by mappedbytebuffer");\n        }\n    } catch (ioexception e) {\n        e.printstacktrace();\n    }\n}\n\n\n map() map()  java.nio.channels.filechannel  sun.nio.ch.filechannelimpl.java \n\npublic mappedbytebuffer map(mapmode mode, long position, long size) throws ioexception {\n    int pageposition = (int)(position % allocationgranularity);\n    long mapposition = position - pageposition;\n    long mapsize = size + pageposition;\n    try {\n        addr = map0(imode, mapposition, mapsize);\n    } catch (outofmemoryerror x) {\n        system.gc();\n        try {\n            thread.sleep(100);\n        } catch (interruptedexception y) {\n            thread.currentthread().interrupt();\n        }\n        try {\n            addr = map0(imode, mapposition, mapsize);\n        } catch (outofmemoryerror y) {\n            throw new ioexception("map failed", y);\n        }\n    }\n\n    int isize = (int)size;\n    unmapper um = new unmapper(addr, mapsize, isize, mfd);\n    if ((!writable) || (imode == map_ro)) {\n        return util.newmappedbytebufferr(isize, addr + pageposition, mfd, um);\n    } else {\n        return util.newmappedbytebuffer(isize, addr + pageposition, mfd, um);\n    }\n}\n\n\nmap()  map0() \n\n *  java  mappedbytebuffer  oom 100ms \n *  util  newmappedbytebuffer  newmappedbytebufferr  directbytebuffer  directbytebuffer  mappedbytebuffer \n\nmap()  +  read()  write()  sun.misc.unsafe getbyte()  putbyte() \n\nprivate native long map0(int prot, long position, long mapsize) throws ioexception;\n\n\nnative methodmap0  jnijava native interface c  native java_sun_nio_ch_filechannelimpl_map0 jdk  native/sun/nio/ch/filechannelimpl.c\n\njniexport jlong jnicall\njava_sun_nio_ch_filechannelimpl_map0(jnienv *env, jobject this,\n                                     jint prot, jlong off, jlong len)\n{\n    void *mapaddress = 0;\n    jobject fdo = (*env)->getobjectfield(env, this, chan_fd);\n    jint fd = fdval(env, fdo);\n    int protections = 0;\n    int flags = 0;\n\n    if (prot == sun_nio_ch_filechannelimpl_map_ro) {\n        protections = prot_read;\n        flags = map_shared;\n    } else if (prot == sun_nio_ch_filechannelimpl_map_rw) {\n        protections = prot_write | prot_read;\n        flags = map_shared;\n    } else if (prot == sun_nio_ch_filechannelimpl_map_pv) {\n        protections =  prot_write | prot_read;\n        flags = map_private;\n    }\n\n    mapaddress = mmap64(\n        0,                    /* let os decide location */\n        len,                  /* number of bytes to map */\n        protections,          /* file permissions */\n        flags,                /* changes are shared */\n        fd,                   /* file descriptor of mapped file */\n        off);                 /* offset into file */\n\n    if (mapaddress == map_failed) {\n        if (errno == enomem) {\n            jnu_throwoutofmemoryerror(env, "map failed");\n            return ios_thrown;\n        }\n        return handle(env, -1, "map failed");\n    }\n\n    return ((jlong) (unsigned long) mapaddress);\n}\n\n\n map0()  mmap64()  linux  mmap64() \n\n#include <sys/mman.h>\n\nvoid *mmap64(void *addr, size_t len, int prot, int flags, int fd, off64_t offset);\n\n\n mmap64() \n\n * addr 0  null + flags  map_fixed addr \n * len\n * prot\n   * prot_read\n   * prot_write\n   * prot_exec\n   * prot_none\n * flags\n   * map_private\n   * map_shared\n   * map_fixed addr  addr \n * fd map  1 unmap  1\n * offset\n\n mappedbytebuffer \n\n * mappedbytebuffer map jvm  -xmx   integer.max_value  position  map \n * mappedbytebuffer \n * mappedbytebuffer  mmap()  unmap()  unmap()  filechannelimpl  java  sun.misc.cleaner  clean() \n\npublic static void clean(final object buffer) throws exception {\n    accesscontroller.doprivileged((privilegedaction<void>) () -> {\n        try {\n            method getcleanermethod = buffer.getclass().getmethod("cleaner", new class[0]);\n            getcleanermethod.setaccessible(true);\n            cleaner cleaner = (cleaner) getcleanermethod.invoke(buffer, new object[0]);\n            cleaner.clean();\n        } catch(exception e) {\n            e.printstacktrace();\n        }\n    });\n}\n\n\n\n# directbytebuffer\n\ndirectbytebuffer  java jvm  directbytebuffer  directbytebuffer  allocatedirect()  directbytebuffer \n\npublic static bytebuffer allocatedirect(int capacity) {\n    return new directbytebuffer(capacity);\n}\n\n\ndirectbytebuffer  unsafe  allocatememory()  malloc() \n\ndirectbytebuffer(int cap) {\n    super(-1, 0, cap, cap);\n    boolean pa = vm.isdirectmemorypagealigned();\n    int ps = bits.pagesize();\n    long size = math.max(1l, (long)cap + (pa ? ps : 0));\n    bits.reservememory(size, cap);\n\n    long base = 0;\n    try {\n        base = unsafe.allocatememory(size);\n    } catch (outofmemoryerror x) {\n        bits.unreservememory(size, cap);\n        throw x;\n    }\n    unsafe.setmemory(base, size, (byte) 0);\n    if (pa && (base % ps != 0)) {\n        address = base + ps - (base & (ps - 1));\n    } else {\n        address = base;\n    }\n    cleaner = cleaner.create(this, new deallocator(base, size, cap));\n    att = null;\n}\n\n\n directbytebuffer  deallocator  cleaner  freememory() freememory()  free() \n\nprivate static class deallocator implements runnable {\n    private static unsafe unsafe = unsafe.getunsafe();\n\n    private long address;\n    private long size;\n    private int capacity;\n\n    private deallocator(long address, long size, int capacity) {\n        assert (address != 0);\n        this.address = address;\n        this.size = size;\n        this.capacity = capacity;\n    }\n\n    public void run() {\n        if (address == 0) {\n            return;\n        }\n        unsafe.freememory(address);\n        address = 0;\n        bits.unreservememory(size, capacity);\n    }\n}\n\n\n directbytebuffer  jvm  outofmemoryerror\n\n directbytebuffer  mappedbytebuffer  map()  util.newmappedbytebuffer() \n\nstatic mappedbytebuffer newmappedbytebuffer(int size, long addr, filedescriptor fd,\n                                            runnable unmapper) {\n    mappedbytebuffer dbb;\n    if (directbytebufferconstructor == null)\n        initdbbconstructor();\n    try {\n        dbb = (mappedbytebuffer)directbytebufferconstructor.newinstance(\n            new object[] { new integer(size), new long(addr), fd, unmapper });\n    } catch (instantiationexception | illegalaccessexception | invocationtargetexception e) {\n        throw new internalerror(e);\n    }\n    return dbb;\n}\n\nprivate static void initdbbrconstructor() {\n    accesscontroller.doprivileged(new privilegedaction<void>() {\n        public void run() {\n            try {\n                class<?> cl = class.forname("java.nio.directbytebufferr");\n                constructor<?> ctor = cl.getdeclaredconstructor(\n                    new class<?>[] { int.class, long.class, filedescriptor.class,\n                                    runnable.class });\n                ctor.setaccessible(true);\n                directbytebufferrconstructor = ctor;\n            } catch (classnotfoundexception | nosuchmethodexception |\n                     illegalargumentexception | classcastexception x) {\n                throw new internalerror(x);\n            }\n            return null;\n        }});\n}\n\n\ndirectbytebuffer  mappedbytebuffer util.newmappedbytebuffer()  directbytebuffer  directbytebuffer \n\nprotected directbytebuffer(int cap, long addr, filedescriptor fd, runnable unmapper) {\n    super(-1, 0, cap, cap, fd);\n    address = addr;\n    cleaner = cleaner.create(this, unmapper);\n    att = null;\n}\n\n\ndirectbytebuffer directbytebuffer  mappedbytebuffer  get()  write() \n\n * \n\npublic byte get() {\n    return ((unsafe.getbyte(ix(nextgetindex()))));\n}\n\npublic byte get(int i) {\n    return ((unsafe.getbyte(ix(checkindex(i)))));\n}\n\n\n * \n\npublic bytebuffer put(byte x) {\n    unsafe.putbyte(ix(nextputindex()), ((x)));\n    return this;\n}\n\npublic bytebuffer put(int i, byte x) {\n    unsafe.putbyte(ix(checkindex(i)), ((x)));\n    return this;\n}\n\n\n ix()  ix() address i  unsafe  get()  put() \n\nprivate long ix(int i) {\n    return address + ((long)i << 0);\n}\n\n\n\n# filechannel\n\nfilechannel  fileinputstreamfileoutputstream  randomaccessfile  getchannel() filechannel  transferfrom()  transferto() \n\n * transferto() filechannel  writablebytechannel \n\npublic abstract long transferto(long position, long count, writablebytechannel target)\n        throws ioexception;\n\n\n * transferfrom() readablebytechannel  filechannel \n\npublic abstract long transferfrom(readablebytechannel src, long position, long count)\n        throws ioexception;\n\n\n filechannel  transferto()  transferfrom() \n\nprivate static final string content = "zero copy implemented by filechannel";\nprivate static final string source_file = "/source.txt";\nprivate static final string target_file = "/target.txt";\nprivate static final string charset = "utf-8";\n\n\n source.txt  target.txt  source.txt \n\n@before\npublic void setup() {\n    path source = paths.get(getclasspath(source_file));\n    byte[] bytes = content.getbytes(charset.forname(charset));\n    try (filechannel fromchannel = filechannel.open(source, standardopenoption.read,\n            standardopenoption.write, standardopenoption.truncate_existing)) {\n        fromchannel.write(bytebuffer.wrap(bytes));\n    } catch (ioexception e) {\n        e.printstacktrace();\n    }\n}\n\n\n transferto()  tochannel  writablebytechannel transferfrom()  fromchannel  readablebytechannelfilechannelsocketchannel  datagramchannel  writablebytechannel  readablebytechannel  filechannel  channel-to-channel \n\n transferto()  fromchannel  tochannel\n\n@test\npublic void transferto() throws exception {\n    try (filechannel fromchannel = new randomaccessfile(\n             getclasspath(source_file), "rw").getchannel();\n         filechannel tochannel = new randomaccessfile(\n             getclasspath(target_file), "rw").getchannel()) {\n        long position = 0l;\n        long offset = fromchannel.size();\n        fromchannel.transferto(position, offset, tochannel);\n    }\n}\n\n\n transferfrom()  fromchannel  tochannel\n\n@test\npublic void transferfrom() throws exception {\n    try (filechannel fromchannel = new randomaccessfile(\n             getclasspath(source_file), "rw").getchannel();\n         filechannel tochannel = new randomaccessfile(\n             getclasspath(target_file), "rw").getchannel()) {\n        long position = 0l;\n        long offset = fromchannel.size();\n        tochannel.transferfrom(fromchannel, position, offset);\n    }\n}\n\n\n transferto()  transferfrom()  java.nio.channels.filechannel  sun.nio.ch.filechannelimpl.java transferto()  transferfrom()  sendfile  filechannelimpl.java  3  sendfile  sendfile \n\nprivate static volatile boolean transfersupported = true;\nprivate static volatile boolean pipesupported = true;\nprivate static volatile boolean filesupported = true;\n\n\n * transfersupported sendfile()  true\n * pipesupportedfdpipe sendfile()  true\n * filesupportedfdfile sendfile()  true\n\n transferto() filechannelimpl  transfertodirectly()  sendfile  sendfile transfertotrustedchannel()  mmap  filechannelimpl  selchimpl  transfertoarbitrarychannel()  i/o  directbuffer filechannel  directbuffer writablebytechannel \n\npublic long transferto(long position, long count, writablebytechannel target)\n        throws ioexception {\n    // \n    long sz = size();\n    // \n    if (position > sz)\n        return 0;\n    int icount = (int)math.min(count, integer.max_value);\n    // \n    if ((sz - position) < icount)\n        icount = (int)(sz - position);\n\n    long n;\n\n    if ((n = transfertodirectly(position, icount, target)) >= 0)\n        return n;\n\n    if ((n = transfertotrustedchannel(position, icount, target)) >= 0)\n        return n;\n\n    return transfertoarbitrarychannel(position, icount, target);\n}\n\n\n transfertodirectly()  transferto()  sendfile transfertodirectlyinternal()  writablebytechannel  targetfd transfertodirectlyinternal() \n\nprivate long transfertodirectly(long position, int icount, writablebytechannel target)\n        throws ioexception {\n    // targettargetfd\n    if (nd.transfertodirectlyneedspositionlock()) {\n        synchronized (positionlock) {\n            long pos = position();\n            try {\n                return transfertodirectlyinternal(position, icount,\n                        target, targetfd);\n            } finally {\n                position(pos);\n            }\n        }\n    } else {\n        return transfertodirectlyinternal(position, icount, target, targetfd);\n    }\n}\n\n\n transfertodirectlyinternal()  transferto0()  sendfile  sendfile windows  unsupported  transfersupported  false sendfile  linux  dma gather copy  unsupported_case  pipesupported  filesupported  false\n\nprivate long transfertodirectlyinternal(long position, int icount,\n                                        writablebytechannel target,\n                                        filedescriptor targetfd) throws ioexception {\n    assert !nd.transfertodirectlyneedspositionlock() ||\n            thread.holdslock(positionlock);\n\n    long n = -1;\n    int ti = -1;\n    try {\n        begin();\n        ti = threads.add();\n        if (!isopen())\n            return -1;\n        do {\n            n = transferto0(fd, position, icount, targetfd);\n        } while ((n == iostatus.interrupted) && isopen());\n        if (n == iostatus.unsupported_case) {\n            if (target instanceof sinkchannelimpl)\n                pipesupported = false;\n            if (target instanceof filechannelimpl)\n                filesupported = false;\n            return iostatus.unsupported_case;\n        }\n        if (n == iostatus.unsupported) {\n            transfersupported = false;\n            return iostatus.unsupported;\n        }\n        return iostatus.normalize(n);\n    } finally {\n        threads.remove(ti);\n        end (n > -1);\n    }\n}\n\n\nnative methodtransferto0()  jnijava native interface c  native java_sun_nio_ch_filechannelimpl_transferto0 jdk  native/sun/nio/ch/filechannelimpl.c jni  java_sun_nio_ch_filechannelimpl_transferto0()  jdk  linux  transferto() \n\n#if defined(__linux__) || defined(__solaris__)\n#include <sys/sendfile.h>\n#elif defined(_aix)\n#include <sys/socket.h>\n#elif defined(_allbsd_source)\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <sys/uio.h>\n\n#define lseek64 lseek\n#define mmap64 mmap\n#endif\n\njniexport jlong jnicall\njava_sun_nio_ch_filechannelimpl_transferto0(jnienv *env, jobject this,\n                                            jobject srcfdo,\n                                            jlong position, jlong count,\n                                            jobject dstfdo)\n{\n    jint srcfd = fdval(env, srcfdo);\n    jint dstfd = fdval(env, dstfdo);\n\n#if defined(__linux__)\n    off64_t offset = (off64_t)position;\n    jlong n = sendfile64(dstfd, srcfd, &offset, (size_t)count);\n    return n;\n#elif defined(__solaris__)\n    result = sendfilev64(dstfd, &sfv, 1, &numbytes);    \n    return result;\n#elif defined(__apple__)\n    result = sendfile(srcfd, dstfd, position, &numbytes, null, 0);\n    return result;\n#endif\n}\n\n\n linuxsolaris  apple transferto0()  sendfile64 sendfile64() \n\n#include <sys/sendfile.h>\n\nssize_t sendfile64(int out_fd, int in_fd, off_t *offset, size_t count);\n\n\n sendfile64() \n\n * out_fd\n * in_fd\n * offset in_fd \n * count in_fd  out_fd \n\n linux 2.6.3 out_fd  socket linux 2.6.3 out_fd sendfile64() \n\n\n# \n\n\n# netty\n\nnetty ,  netty java \n\nnetty  defaultfileregion  java.nio.channels.filechannel  tranferto() channel\n\nbytebuf  wrap bytebufbytebuffer  bytebuf ,  bytebuf  slice ,  bytebuf  bytebuf netty  compositebytebuf  bytebuf  bytebuf bytebuf   1  3 \n\n\n# rocketmqkafka\n\nrocketmq  mmap + write  kafka  sendfile kafka  mmap + write  sendfile \n\n\n\n\n# \n\n *  https://zhuanlan.zhihu.com/p/83398714\n * ',charsets:{cjk:!0}},{title:"Java NIO - ",frontmatter:{},regularPath:"/java/io/java-io-nio.html",relativePath:"java/io/java-io-nio.md",key:"v-d895a124",path:"/java/io/java-io-nio.html",headers:[{level:2,title:"Java NIO - ",slug:"java-nio-",normalizedTitle:"java nio - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:114},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:123},{level:3,title:"1\\. ",slug:"_1-",normalizedTitle:"1. ",charIndex:137},{level:3,title:"2\\. ",slug:"_2-",normalizedTitle:"2. ",charIndex:150},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:162},{level:2,title:" NIO ",slug:"-nio-",normalizedTitle:" nio ",charIndex:175},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:190},{level:3,title:"1\\. ",slug:"_1-",normalizedTitle:"1. ",charIndex:201},{level:3,title:"2\\. ",slug:"_2-",normalizedTitle:"2. ",charIndex:217},{level:3,title:"3\\. ",slug:"_3-",normalizedTitle:"3. ",charIndex:238},{level:3,title:"4\\. ",slug:"_4-",normalizedTitle:"4. ",charIndex:253},{level:3,title:"5\\. ",slug:"_5-",normalizedTitle:"5. ",charIndex:271},{level:2,title:" NIO ",slug:"-nio-",normalizedTitle:" nio ",charIndex:284},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:300},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:312},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:320}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java NIO -    1\\.  2\\.    NIO   1\\.  2\\.  3\\.  4\\.  5\\.   NIO    ",content:'# Java NIO - \n\n> / (NIO)  JDK 1.4  I/O  I/O@pdai\n\n * Java NIO - \n   * \n   * \n     * 1. \n     * 2. \n   * \n   *  NIO \n   * \n     * 1. \n     * 2. \n     * 3. \n     * 4. \n     * 5. \n   *  NIO \n   * \n   * \n   * \n\nStandard IOIO NIOIOIObyte[]NIO\n\n\n# \n\nI/O  NIO I/O  NIO \n\n I/O :  I/O \n\n I/O  I/O  I/O \n\nI/O  NIO java.io.*  NIO  NIO java.io.* \n\n\n# \n\n\n# 1. \n\n Channel  I/O \n\n( InputStream  OutputStream )\n\n:\n\n * FileChannel: \n * DatagramChannel:  UDP \n * SocketChannel:  TCP \n * ServerSocketChannel:  TCP  SocketChannel\n\n\n# 2. \n\n\n\n/\n\n:\n\n * ByteBuffer\n * CharBuffer\n * ShortBuffer\n * IntBuffer\n * LongBuffer\n * FloatBuffer\n * DoubleBuffer\n\n\n# \n\n * capacity: \n * position: \n * limit: \n\n:\n\n  8  position  0 limit = capacity = 8capacity \n\n\n\n  5  position  5limit \n\n\n\n  flip()  limit  position position  0\n\n\n\n  4  position  4\n\n\n\n  clear()  position  limit \n\n\n\n\n#  NIO \n\n NIO :\n\npublic static void fastCopy(String src, String dist) throws IOException {\n\n    /*  */\n    FileInputStream fin = new FileInputStream(src);\n\n    /*  */\n    FileChannel fcin = fin.getChannel();\n\n    /*  */\n    FileOutputStream fout = new FileOutputStream(dist);\n\n    /*  */\n    FileChannel fcout = fout.getChannel();\n\n    /*  1024  */\n    ByteBuffer buffer = ByteBuffer.allocateDirect(1024);\n\n    while (true) {\n\n        /*  */\n        int r = fcin.read(buffer);\n\n        /* read()  -1  EOF */\n        if (r == -1) {\n            break;\n        }\n\n        /*  */\n        buffer.flip();\n\n        /*  */\n        fcout.write(buffer);\n        \n        /*  */\n        buffer.clear();\n    }\n}\n\n\n\n# \n\nNIO  IO NIO \n\nNIO  IO  Reactor  Thread  Selector  Channel \n\n Channel  Channel  IO  Channel IO  Channel \n\n\n\n Channel  FileChannel  FileChannel \n\n\n\n\n# 1. \n\nSelector selector = Selector.open();\n\n\n\n# 2. \n\nServerSocketChannel ssChannel = ServerSocketChannel.open();\nssChannel.configureBlocking(false);\nssChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n\n\n\n:\n\n * SelectionKey.OP_CONNECT\n * SelectionKey.OP_ACCEPT\n * SelectionKey.OP_READ\n * SelectionKey.OP_WRITE\n\n SelectionKey :\n\npublic static final int OP_READ = 1 << 0;\npublic static final int OP_WRITE = 1 << 2;\npublic static final int OP_CONNECT = 1 << 3;\npublic static final int OP_ACCEPT = 1 << 4;\n\n\n:\n\nint interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;\n\n\n\n# 3. \n\nint num = selector.select();\n\n\n select() \n\n\n# 4. \n\nSet<SelectionKey> keys = selector.selectedKeys();\nIterator<SelectionKey> keyIterator = keys.iterator();\nwhile (keyIterator.hasNext()) {\n    SelectionKey key = keyIterator.next();\n    if (key.isAcceptable()) {\n        // ...\n    } else if (key.isReadable()) {\n        // ...\n    }\n    keyIterator.remove();\n}\n\n\n\n# 5. \n\n select() \n\nwhile (true) {\n    int num = selector.select();\n    Set<SelectionKey> keys = selector.selectedKeys();\n    Iterator<SelectionKey> keyIterator = keys.iterator();\n    while (keyIterator.hasNext()) {\n        SelectionKey key = keyIterator.next();\n        if (key.isAcceptable()) {\n            // ...\n        } else if (key.isReadable()) {\n            // ...\n        }\n        keyIterator.remove();\n    }\n}\n\n\n\n#  NIO \n\npublic class NIOServer {\n\n    public static void main(String[] args) throws IOException {\n\n        Selector selector = Selector.open();\n\n        ServerSocketChannel ssChannel = ServerSocketChannel.open();\n        ssChannel.configureBlocking(false);\n        ssChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n        ServerSocket serverSocket = ssChannel.socket();\n        InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888);\n        serverSocket.bind(address);\n\n        while (true) {\n\n            selector.select();\n            Set<SelectionKey> keys = selector.selectedKeys();\n            Iterator<SelectionKey> keyIterator = keys.iterator();\n\n            while (keyIterator.hasNext()) {\n\n                SelectionKey key = keyIterator.next();\n\n                if (key.isAcceptable()) {\n\n                    ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel();\n\n                    //  SocketChannel\n                    SocketChannel sChannel = ssChannel1.accept();\n                    sChannel.configureBlocking(false);\n\n                    // \n                    sChannel.register(selector, SelectionKey.OP_READ);\n\n                } else if (key.isReadable()) {\n\n                    SocketChannel sChannel = (SocketChannel) key.channel();\n                    System.out.println(readDataFromSocketChannel(sChannel));\n                    sChannel.close();\n                }\n\n                keyIterator.remove();\n            }\n        }\n    }\n\n    private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException {\n\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        StringBuilder data = new StringBuilder();\n\n        while (true) {\n\n            buffer.clear();\n            int n = sChannel.read(buffer);\n            if (n == -1) {\n                break;\n            }\n            buffer.flip();\n            int limit = buffer.limit();\n            char[] dst = new char[limit];\n            for (int i = 0; i < limit; i++) {\n                dst[i] = (char) buffer.get(i);\n            }\n            data.append(dst);\n            buffer.clear();\n        }\n        return data.toString();\n    }\n}\n\n\npublic class NIOClient {\n\n    public static void main(String[] args) throws IOException {\n        Socket socket = new Socket("127.0.0.1", 8888);\n        OutputStream out = socket.getOutputStream();\n        String s = "hello world";\n        out.write(s.getBytes());\n        out.close();\n    }\n}\n\n\n\n# \n\n I/O  I/O \n\n\n\n 1024 map()  MappedByteBuffer ByteBuffer  ByteBuffer \n\nMappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, 0, 1024);\n\n\n\n# \n\nNIO  I/O :\n\n * NIO \n * NIO I/O \n\n\n# \n\n * Java NIO Tutorial\n * Java NIO \n * IBM: NIO \n * Eckel B, , , . Java  [M]. , 2002.\n * IBM: NIO \n * IBM:  Java I/O \n * IBM:  Java \n * IBM: Java \n * NIO  IO \n * Decorator Design Pattern\n * Socket Multicast',normalizedContent:'# java nio - \n\n> / (nio)  jdk 1.4  i/o  i/o@pdai\n\n * java nio - \n   * \n   * \n     * 1. \n     * 2. \n   * \n   *  nio \n   * \n     * 1. \n     * 2. \n     * 3. \n     * 4. \n     * 5. \n   *  nio \n   * \n   * \n   * \n\nstandard ioio nioioiobyte[]nio\n\n\n# \n\ni/o  nio i/o  nio \n\n i/o :  i/o \n\n i/o  i/o  i/o \n\ni/o  nio java.io.*  nio  nio java.io.* \n\n\n# \n\n\n# 1. \n\n channel  i/o \n\n( inputstream  outputstream )\n\n:\n\n * filechannel: \n * datagramchannel:  udp \n * socketchannel:  tcp \n * serversocketchannel:  tcp  socketchannel\n\n\n# 2. \n\n\n\n/\n\n:\n\n * bytebuffer\n * charbuffer\n * shortbuffer\n * intbuffer\n * longbuffer\n * floatbuffer\n * doublebuffer\n\n\n# \n\n * capacity: \n * position: \n * limit: \n\n:\n\n  8  position  0 limit = capacity = 8capacity \n\n\n\n  5  position  5limit \n\n\n\n  flip()  limit  position position  0\n\n\n\n  4  position  4\n\n\n\n  clear()  position  limit \n\n\n\n\n#  nio \n\n nio :\n\npublic static void fastcopy(string src, string dist) throws ioexception {\n\n    /*  */\n    fileinputstream fin = new fileinputstream(src);\n\n    /*  */\n    filechannel fcin = fin.getchannel();\n\n    /*  */\n    fileoutputstream fout = new fileoutputstream(dist);\n\n    /*  */\n    filechannel fcout = fout.getchannel();\n\n    /*  1024  */\n    bytebuffer buffer = bytebuffer.allocatedirect(1024);\n\n    while (true) {\n\n        /*  */\n        int r = fcin.read(buffer);\n\n        /* read()  -1  eof */\n        if (r == -1) {\n            break;\n        }\n\n        /*  */\n        buffer.flip();\n\n        /*  */\n        fcout.write(buffer);\n        \n        /*  */\n        buffer.clear();\n    }\n}\n\n\n\n# \n\nnio  io nio \n\nnio  io  reactor  thread  selector  channel \n\n channel  channel  io  channel io  channel \n\n\n\n channel  filechannel  filechannel \n\n\n\n\n# 1. \n\nselector selector = selector.open();\n\n\n\n# 2. \n\nserversocketchannel sschannel = serversocketchannel.open();\nsschannel.configureblocking(false);\nsschannel.register(selector, selectionkey.op_accept);\n\n\n\n\n:\n\n * selectionkey.op_connect\n * selectionkey.op_accept\n * selectionkey.op_read\n * selectionkey.op_write\n\n selectionkey :\n\npublic static final int op_read = 1 << 0;\npublic static final int op_write = 1 << 2;\npublic static final int op_connect = 1 << 3;\npublic static final int op_accept = 1 << 4;\n\n\n:\n\nint interestset = selectionkey.op_read | selectionkey.op_write;\n\n\n\n# 3. \n\nint num = selector.select();\n\n\n select() \n\n\n# 4. \n\nset<selectionkey> keys = selector.selectedkeys();\niterator<selectionkey> keyiterator = keys.iterator();\nwhile (keyiterator.hasnext()) {\n    selectionkey key = keyiterator.next();\n    if (key.isacceptable()) {\n        // ...\n    } else if (key.isreadable()) {\n        // ...\n    }\n    keyiterator.remove();\n}\n\n\n\n# 5. \n\n select() \n\nwhile (true) {\n    int num = selector.select();\n    set<selectionkey> keys = selector.selectedkeys();\n    iterator<selectionkey> keyiterator = keys.iterator();\n    while (keyiterator.hasnext()) {\n        selectionkey key = keyiterator.next();\n        if (key.isacceptable()) {\n            // ...\n        } else if (key.isreadable()) {\n            // ...\n        }\n        keyiterator.remove();\n    }\n}\n\n\n\n#  nio \n\npublic class nioserver {\n\n    public static void main(string[] args) throws ioexception {\n\n        selector selector = selector.open();\n\n        serversocketchannel sschannel = serversocketchannel.open();\n        sschannel.configureblocking(false);\n        sschannel.register(selector, selectionkey.op_accept);\n\n        serversocket serversocket = sschannel.socket();\n        inetsocketaddress address = new inetsocketaddress("127.0.0.1", 8888);\n        serversocket.bind(address);\n\n        while (true) {\n\n            selector.select();\n            set<selectionkey> keys = selector.selectedkeys();\n            iterator<selectionkey> keyiterator = keys.iterator();\n\n            while (keyiterator.hasnext()) {\n\n                selectionkey key = keyiterator.next();\n\n                if (key.isacceptable()) {\n\n                    serversocketchannel sschannel1 = (serversocketchannel) key.channel();\n\n                    //  socketchannel\n                    socketchannel schannel = sschannel1.accept();\n                    schannel.configureblocking(false);\n\n                    // \n                    schannel.register(selector, selectionkey.op_read);\n\n                } else if (key.isreadable()) {\n\n                    socketchannel schannel = (socketchannel) key.channel();\n                    system.out.println(readdatafromsocketchannel(schannel));\n                    schannel.close();\n                }\n\n                keyiterator.remove();\n            }\n        }\n    }\n\n    private static string readdatafromsocketchannel(socketchannel schannel) throws ioexception {\n\n        bytebuffer buffer = bytebuffer.allocate(1024);\n        stringbuilder data = new stringbuilder();\n\n        while (true) {\n\n            buffer.clear();\n            int n = schannel.read(buffer);\n            if (n == -1) {\n                break;\n            }\n            buffer.flip();\n            int limit = buffer.limit();\n            char[] dst = new char[limit];\n            for (int i = 0; i < limit; i++) {\n                dst[i] = (char) buffer.get(i);\n            }\n            data.append(dst);\n            buffer.clear();\n        }\n        return data.tostring();\n    }\n}\n\n\npublic class nioclient {\n\n    public static void main(string[] args) throws ioexception {\n        socket socket = new socket("127.0.0.1", 8888);\n        outputstream out = socket.getoutputstream();\n        string s = "hello world";\n        out.write(s.getbytes());\n        out.close();\n    }\n}\n\n\n\n# \n\n i/o  i/o \n\n\n\n 1024 map()  mappedbytebuffer bytebuffer  bytebuffer \n\nmappedbytebuffer mbb = fc.map(filechannel.mapmode.read_write, 0, 1024);\n\n\n\n# \n\nnio  i/o :\n\n * nio \n * nio i/o \n\n\n# \n\n * java nio tutorial\n * java nio \n * ibm: nio \n * eckel b, , , . java  [m]. , 2002.\n * ibm: nio \n * ibm:  java i/o \n * ibm:  java \n * ibm: java \n * nio  io \n * decorator design pattern\n * socket multicast',charsets:{cjk:!0}},{title:"Java N(A)IO - : Netty",frontmatter:{},regularPath:"/java/io/java-io-nio-netty.html",relativePath:"java/io/java-io-nio-netty.md",key:"v-bf576b64",path:"/java/io/java-io-nio-netty.html",headers:[{level:2,title:"Java N(A)IO - : Netty",slug:"java-n-a-io--netty",normalizedTitle:"java n(a)io - : netty",charIndex:2},{level:2,title:"NIO",slug:"nio",normalizedTitle:"nio",charIndex:48},{level:2,title:"NIO(Netty)",slug:"nio-netty",normalizedTitle:"nio(netty)",charIndex:221},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:250},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:260},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:268}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java N(A)IO - : Netty NIO NIO(Netty)   ",content:'# Java N(A)IO - : Netty\n\n> NettyNIOTCPUDPNIONettyNettyRPCzookeeper@pdai\n\n * Java N(A)IO - : Netty\n   * NIO\n   * NIO(Netty)\n     * \n     * \n   * \n\n\n# NIO\n\nNIO:\n\n * JAVA NIO:\n\nJAVA NIOIO\n\n * APACHE MINA 2:\n\nJava NIOTCP/IPUDP/IPAPI\n\n * NETTY 4/5:\n\nNettyJBOSSjavaNettyNETTY 4 : MINANETTYTrustin Lee\n\n * Grizzly:\n\nGrizzlyJAVA NIO\n\n\n# NIO(Netty)\n\n\n# \n\n * api\n * \n * NIOnetty\n * \n * \n\n\n# \n\n<dependency>\n     <groupId>org.jboss.netty</groupId>\n     <artifactId>netty</artifactId>\n     <version>3.2.5.Final</version>\n</dependency>\n\n\n * \n\npublic class NettyServer {\n\n    private static int HEADER_LENGTH = 4;\n\n    public void bind(int port) throws Exception {\n\n        ServerBootstrap b = new ServerBootstrap(new NioServerSocketChannelFactory(Executors.newCachedThreadPool(),\n                                                                                  Executors.newCachedThreadPool()));\n\n        // pipeline\n        b.setPipelineFactory(new ChannelPipelineFactory() {\n\n            public ChannelPipeline getPipeline() throws Exception {\n                ChannelPipeline pipelines = Channels.pipeline();\n                pipelines.addLast(MessageHandler.class.getName(), new MessageHandler());\n                return pipelines;\n            }\n        });\n        // \n        b.bind(new InetSocketAddress(port));\n    }\n\n    // \n    static class MessageHandler extends SimpleChannelHandler {\n\n        public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception {\n            // \n            ChannelBuffer buffer = (ChannelBuffer) e.getMessage();\n            String message = new String(buffer.readBytes(buffer.readableBytes()).array(), "UTF-8");\n            System.out.println("<>=" + message);\n\n            // \n            byte[] body = "".getBytes();\n            byte[] header = ByteBuffer.allocate(HEADER_LENGTH).order(ByteOrder.BIG_ENDIAN).putInt(body.length).array();\n            Channels.write(ctx.getChannel(), ChannelBuffers.wrappedBuffer(header, body));\n            System.out.println("<>,time=" + System.currentTimeMillis());\n\n        }\n    }\n\n    public static void main(String[] args) {\n        try {\n            new NettyServer().bind(1088);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        ;\n    }\n}\n\n\n * \n\npublic class NettyClient {\n\n    private final ByteBuffer readHeader  = ByteBuffer.allocate(4).order(ByteOrder.BIG_ENDIAN);\n    private final ByteBuffer writeHeader = ByteBuffer.allocate(4).order(ByteOrder.BIG_ENDIAN);\n    private SocketChannel    channel;\n\n    public void sendMessage(byte[] body) throws Exception {\n        // \n        channel = SocketChannel.open();\n        channel.socket().setSoTimeout(60000);\n        channel.connect(new InetSocketAddress(AddressUtils.getHostIp(), 1088));\n\n        // \n        writeWithHeader(channel, body);\n\n        // \n        readHeader.clear();\n        read(channel, readHeader);\n        int bodyLen = readHeader.getInt(0);\n        ByteBuffer bodyBuf = ByteBuffer.allocate(bodyLen).order(ByteOrder.BIG_ENDIAN);\n        read(channel, bodyBuf);\n        System.out.println("<>: " + new String(bodyBuf.array(), "UTF-8") + ",:" + bodyLen);\n    }\n\n    private void writeWithHeader(SocketChannel channel, byte[] body) throws IOException {\n        writeHeader.clear();\n        writeHeader.putInt(body.length);\n        writeHeader.flip();\n        // channel.write(writeHeader);\n        channel.write(ByteBuffer.wrap(body));\n    }\n\n    private void read(SocketChannel channel, ByteBuffer buffer) throws IOException {\n        while (buffer.hasRemaining()) {\n            int r = channel.read(buffer);\n            if (r == -1) {\n                throw new IOException("end of stream when reading header");\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        String body = "";\n        try {\n            new NettyClient().sendMessage(body.getBytes());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n\n\n# \n\n * https://blog.csdn.net/yinwenjie/article/details/48829419\n * https://blog.csdn.net/yinwenjie/article/details/48969853\n * Netty',normalizedContent:'# java n(a)io - : netty\n\n> nettyniotcpudpnionettynettyrpczookeeper@pdai\n\n * java n(a)io - : netty\n   * nio\n   * nio(netty)\n     * \n     * \n   * \n\n\n# nio\n\nnio:\n\n * java nio:\n\njava nioio\n\n * apache mina 2:\n\njava niotcp/ipudp/ipapi\n\n * netty 4/5:\n\nnettyjbossjavanettynetty 4 : minanettytrustin lee\n\n * grizzly:\n\ngrizzlyjava nio\n\n\n# nio(netty)\n\n\n# \n\n * api\n * \n * nionetty\n * \n * \n\n\n# \n\n<dependency>\n     <groupid>org.jboss.netty</groupid>\n     <artifactid>netty</artifactid>\n     <version>3.2.5.final</version>\n</dependency>\n\n\n * \n\npublic class nettyserver {\n\n    private static int header_length = 4;\n\n    public void bind(int port) throws exception {\n\n        serverbootstrap b = new serverbootstrap(new nioserversocketchannelfactory(executors.newcachedthreadpool(),\n                                                                                  executors.newcachedthreadpool()));\n\n        // pipeline\n        b.setpipelinefactory(new channelpipelinefactory() {\n\n            public channelpipeline getpipeline() throws exception {\n                channelpipeline pipelines = channels.pipeline();\n                pipelines.addlast(messagehandler.class.getname(), new messagehandler());\n                return pipelines;\n            }\n        });\n        // \n        b.bind(new inetsocketaddress(port));\n    }\n\n    // \n    static class messagehandler extends simplechannelhandler {\n\n        public void messagereceived(channelhandlercontext ctx, messageevent e) throws exception {\n            // \n            channelbuffer buffer = (channelbuffer) e.getmessage();\n            string message = new string(buffer.readbytes(buffer.readablebytes()).array(), "utf-8");\n            system.out.println("<>=" + message);\n\n            // \n            byte[] body = "".getbytes();\n            byte[] header = bytebuffer.allocate(header_length).order(byteorder.big_endian).putint(body.length).array();\n            channels.write(ctx.getchannel(), channelbuffers.wrappedbuffer(header, body));\n            system.out.println("<>,time=" + system.currenttimemillis());\n\n        }\n    }\n\n    public static void main(string[] args) {\n        try {\n            new nettyserver().bind(1088);\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n        ;\n    }\n}\n\n\n * \n\npublic class nettyclient {\n\n    private final bytebuffer readheader  = bytebuffer.allocate(4).order(byteorder.big_endian);\n    private final bytebuffer writeheader = bytebuffer.allocate(4).order(byteorder.big_endian);\n    private socketchannel    channel;\n\n    public void sendmessage(byte[] body) throws exception {\n        // \n        channel = socketchannel.open();\n        channel.socket().setsotimeout(60000);\n        channel.connect(new inetsocketaddress(addressutils.gethostip(), 1088));\n\n        // \n        writewithheader(channel, body);\n\n        // \n        readheader.clear();\n        read(channel, readheader);\n        int bodylen = readheader.getint(0);\n        bytebuffer bodybuf = bytebuffer.allocate(bodylen).order(byteorder.big_endian);\n        read(channel, bodybuf);\n        system.out.println("<>: " + new string(bodybuf.array(), "utf-8") + ",:" + bodylen);\n    }\n\n    private void writewithheader(socketchannel channel, byte[] body) throws ioexception {\n        writeheader.clear();\n        writeheader.putint(body.length);\n        writeheader.flip();\n        // channel.write(writeheader);\n        channel.write(bytebuffer.wrap(body));\n    }\n\n    private void read(socketchannel channel, bytebuffer buffer) throws ioexception {\n        while (buffer.hasremaining()) {\n            int r = channel.read(buffer);\n            if (r == -1) {\n                throw new ioexception("end of stream when reading header");\n            }\n        }\n    }\n\n    public static void main(string[] args) {\n        string body = "";\n        try {\n            new nettyclient().sendmessage(body.getbytes());\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\n\n\n# \n\n * https://blog.csdn.net/yinwenjie/article/details/48829419\n * https://blog.csdn.net/yinwenjie/article/details/48969853\n * netty',charsets:{cjk:!0}},{title:"Java NIO - IO",frontmatter:{},regularPath:"/java/io/java-io-nio-select-epoll.html",relativePath:"java/io/java-io-nio-select-epoll.md",key:"v-2d139d12",path:"/java/io/java-io-nio-select-epoll.html",headers:[{level:2,title:"Java NIO - IO",slug:"java-nio-io",normalizedTitle:"java nio - io",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:96},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:106},{level:2,title:"ReactorProactor",slug:"reactorproactor",normalizedTitle:"reactorproactor",charIndex:123},{level:3,title:"IO",slug:"io",normalizedTitle:"io",charIndex:151},{level:3,title:"Reactor",slug:"reactor",normalizedTitle:"reactor",charIndex:165},{level:3,title:"Reactor----IO",slug:"reactor-io",normalizedTitle:"reactor----io",charIndex:186},{level:3,title:"Reactor----",slug:"reactor-",normalizedTitle:"reactor----",charIndex:216},{level:3,title:"Reactor",slug:"reactor",normalizedTitle:"reactor",charIndex:241},{level:2,title:"JAVAIO",slug:"javaio",normalizedTitle:"javaio",charIndex:258},{level:3,title:": Channel",slug:"-channel",normalizedTitle:": channel",charIndex:280},{level:3,title:": Buffer",slug:"-buffer",normalizedTitle:": buffer",charIndex:301},{level:3,title:": Selector",slug:"-selector",normalizedTitle:": selector",charIndex:321},{level:3,title:"JAVA NIO ",slug:"java-nio-",normalizedTitle:"java nio ",charIndex:343},{level:3,title:"JAVA",slug:"java",normalizedTitle:"java",charIndex:368},{level:3,title:"JAVA",slug:"java",normalizedTitle:"java",charIndex:382},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:396},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:412}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java NIO - IO  IO ReactorProactor IO Reactor Reactor----IO Reactor---- Reactor JAVAIO : Channel : Buffer : Selector JAVA NIO  JAVA JAVA IO ",content:'# Java NIO - IO\n\n> IORactorJava NIO@pdai\n\n * Java NIO - IO\n   * \n   * IO\n   * ReactorProactor\n     * IO\n     * Reactor\n     * Reactor----IO\n     * Reactor----\n     * Reactor\n   * JAVAIO\n     * : Channel\n     * : Buffer\n     * : Selector\n     * JAVA NIO \n     * JAVA\n     * JAVA\n   * IO\n   * \n\n\n# \n\n:\n\n100\n\n * ()(A)80()\n\n * (B)9999()(100)VIP()\n\n * (C)VIP\n\n?\n\n: \n\n * : \n * : \n * : \n * : \n * : linux$ulimit -n()\n * : IO()\n * : ()\n * : \n   * A: / IO\n   * B:  / IO\n   * C: / IO\n\n\n# IO\n\nIO: selectpollepollkqueue:\n\nIO                                   JAVA\nselect        Reactor            windows/Linux   ,Reactor()Linux kernels\n                                                   2.4selectwindowsIOselect\npoll          Reactor            Linux           LinuxJAVA NIOLinux kernels\n                                                   2.6pollReactor\nepoll          Reactor/Proactor   Linux           Linux kernels 2.6epollLinux kernels\n                                                   2.6pollLinuxWindowsIOCP\n                                                   IO LinuxepollIO\nkqueue         Proactor           Linux           JAVA\n\nIO1IOJAVA NIOSocket\n\n\n# ReactorProactor\n\n\n# IO\n\nIOServerN\n\n\n\nIO\n\n * \n * \n\n\n\n * \n * IO\n * \n\n\n# Reactor\n\nIOIOjdk 1.4IOAPIAPIReactorAPIIOReactor\n\n\n\nReactorReactorAcceptorHandlerAcceptorReactorHandlerReactorIO\n\n * ReactorIOReactor+ \n * ReactorIO\n\n\n# Reactor----IO\n\nReactor\n\n * \n * \n\nReactor\n\n\n\n\n\n * \n * \n\n\n\n * CPU\n\n\n# Reactor----\n\n\n\n\n\nReactorReactormainReactorsubReactormainReactorsubReactorsubReactor\n\n\n# Reactor\n\nReactorReactorAcceptorHandlerDoug LeaReactor\n\npublic class Reactor implements Runnable {\n  private final Selector selector;\n  private final ServerSocketChannel serverSocket;\n\n  public Reactor(int port) throws IOException {\n    serverSocket = ServerSocketChannel.open();  // ServerSocketChannel\n    serverSocket.configureBlocking(false);  // \n    selector = Selector.open();  // Selector\n    SelectionKey key = serverSocket.register(selector, SelectionKey.OP_ACCEPT);\n    serverSocket.bind(new InetSocketAddress(port));  // \n    key.attach(new Acceptor(serverSocket));  // ChannelAcceptor\n  }\n\n  @Override\n  public void run() {\n    try {\n      while (!Thread.interrupted()) {\n        selector.select();  // \n        Set<SelectionKey> keys = selector.selectedKeys();\n        Iterator<SelectionKey> iterator = keys.iterator();\n        while (iterator.hasNext()) {\n          dispatch(iterator.next());  // Acceptor\n          iterator.remove();\n        }\n\n        selector.selectNow();\n      }\n    } catch (IOException e) {\n      e.printStackTrace();\n    }\n  }\n\n  private void dispatch(SelectionKey key) throws IOException {\n    // attachementChannelAcceptorrun()\n    // \n    Runnable attachment = (Runnable) key.attachment();\n    attachment.run();\n  }\n}\n\n\nReactorServerSocketChannelReactorAcceptorAcceptorAcceptor\n\npublic class Acceptor implements Runnable {\n  private final ExecutorService executor = Executors.newFixedThreadPool(20);\n\n  private final ServerSocketChannel serverSocket;\n\n  public Acceptor(ServerSocketChannel serverSocket) {\n    this.serverSocket = serverSocket;\n  }\n\n  @Override\n  public void run() {\n    try {\n      SocketChannel channel = serverSocket.accept();  // \n      if (null != channel) {\n        executor.execute(new Handler(channel));  // \n      }\n    } catch (IOException e) {\n      e.printStackTrace();\n    }\n  }\n}\n\n\nAcceptorHandler\n\npublic class Handler implements Runnable {\n  private volatile static Selector selector;\n  private final SocketChannel channel;\n  private SelectionKey key;\n  private volatile ByteBuffer input = ByteBuffer.allocate(1024);\n  private volatile ByteBuffer output = ByteBuffer.allocate(1024);\n\n  public Handler(SocketChannel channel) throws IOException {\n    this.channel = channel;\n    channel.configureBlocking(false);  // \n    selector = Selector.open();  // \n    key = channel.register(selector, SelectionKey.OP_READ);  // Channel\n  }\n\n  @Override\n  public void run() {\n    try {\n      while (selector.isOpen() && channel.isOpen()) {\n        Set<SelectionKey> keys = select();  // \n        Iterator<SelectionKey> iterator = keys.iterator();\n        while (iterator.hasNext()) {\n          SelectionKey key = iterator.next();\n          iterator.remove();\n\n          // \n          if (key.isReadable()) {\n            read(key);\n          } else if (key.isWritable()) {\n           // \n            write(key);\n          }\n        }\n      }\n    } catch (Exception e) {\n      e.printStackTrace();\n    }\n  }\n\n  // JdkbugbugSelector\n  // SelectorChannelSelector\n  private Set<SelectionKey> select() throws IOException {\n    selector.select();\n    Set<SelectionKey> keys = selector.selectedKeys();\n    if (keys.isEmpty()) {\n      int interestOps = key.interestOps();\n      selector = Selector.open();\n      key = channel.register(selector, interestOps);\n      return select();\n    }\n\n    return keys;\n  }\n\n  // \n  private void read(SelectionKey key) throws IOException {\n    channel.read(input);\n    if (input.position() == 0) {\n      return;\n    }\n\n    input.flip();\n    process();  // \n    input.clear();\n    key.interestOps(SelectionKey.OP_WRITE);  // \n  }\n\n  private void write(SelectionKey key) throws IOException {\n    output.flip();\n    if (channel.isOpen()) {\n      channel.write(output);  // Channel\n      key.channel();\n      channel.close();\n      output.clear();\n    }\n  }\n    \n  // Reactor\n  // FutureChannel\n  private void process() {\n    byte[] bytes = new byte[input.remaining()];\n    input.get(bytes);\n    String message = new String(bytes, CharsetUtil.UTF_8);\n    System.out.println("receive message from client: \\n" + message);\n\n    output.put("hello client".getBytes());\n  }\n}\n\n\nHandlerChannelSelectorChannel\n\n\n# JAVAIO\n\n\n\n\n# : Channel\n\n()\n\nJDK APIChannel:\n\n> A channel represents an open connection to an entity such as a hardware device, a file, a network socket, or a program component that is capable of performing one or more distinct I/O operations, for example reading or writing.\n\n> A channel is either open or closed. A channel is open upon creation, and once closed it remains closed. Once a channel is closed, any attempt to invoke an I/O operation upon it will cause a ClosedChannelException to be thrown. Whether or not a channel is open may be tested by invoking its isOpen method.\n\nJAVA NIO Channel:\n\n\n\nSelector()SelectableChannel\n\n * ServerSocketChannel: IOUDPTCP\n\n * ScoketChannel: TCP SocketSocketIP:   IP: \n\n * DatagramChannel: UDP \n\n\n# : Buffer\n\n: JAVA NIO JAVA NIO Buffer\n\n? ServerSocketChannelOP_ACCEPTServerSocketChannelBuffer\n\nBuffer: BufferBufferBuffer\n\n:\n\n\n\n * position: \n * limit: \n * capacity: \n\nJAVA NIOBuffer\n\n\n# : Selector\n\nSelectorSelectorchannel\n\n * Channel\n\nSelectorChannelChannelIOSelectorChannelWindowsSelectorImplChannel:\n\n// Initial capacity of the poll array\nprivate final int INIT_CAP = 8;\n// Maximum number of sockets for select().\n// Should be INIT_CAP times a power of 2\nprivate final static int MAX_SELECTABLE_FDS = 1024;\n\n// The list of SelectableChannels serviced by this Selector. Every mod\n// MAX_SELECTABLE_FDS entry is bogus, to align this array with the poll\n// array,  where the corresponding entry is occupied by the wakeupSocket\nprivate SelectionKeyImpl[] channelArray = new SelectionKeyImpl[INIT_CAP];\n\n\n * \n\nSelector\n\n * \n\nIO JVM IO Windowssun.nio.ch.WindowsSelectorImpl:\n\n\n\n\n# JAVA NIO \n\nIOIOJAVA JVMIO? : IOJAVA NIOIOjava.nio.channels.spi.SelectorProvider:\n\n * public abstract DatagramChannel openDatagramChannel(): UDP \n\n * public abstract AbstractSelector openSelector(): NIONIO\n\n * public abstract ServerSocketChannel openServerSocketChannel(): NIO\n\n * public abstract SocketChannel openSocketChannel(): NIOTCP Socket(TCP)\n\nJAVA NIOJAVA NIOIO :\n\n\n\nSelectorProvider SelectorProvidernettyNIONettyNetty 4.0NioServerSocketChannel:\n\nprivate static ServerSocketChannel newSocket(SelectorProvider provider) {\n    try {\n        /**\n            *  Use the {@link SelectorProvider} to open {@link SocketChannel} and so remove condition in\n            *  {@link SelectorProvider#provider()} which is called by each ServerSocketChannel.open() otherwise.\n            *\n            *  See <a href="See https://github.com/netty/netty/issues/2308">#2308</a>.\n            */\n        return provider.openServerSocketChannel();\n    } catch (IOException e) {\n        throw new ChannelException(\n                "Failed to open a server socket.", e);\n    }\n}\n\n\n\n# JAVA\n\nJAVA NIOIO(IO):\n\npackage testNSocket;\n\nimport java.net.InetSocketAddress;\nimport java.net.ServerSocket;\nimport java.net.URLDecoder;\nimport java.net.URLEncoder;\nimport java.nio.ByteBuffer;\nimport java.nio.channels.SelectableChannel;\nimport java.nio.channels.SelectionKey;\nimport java.nio.channels.Selector;\nimport java.nio.channels.ServerSocketChannel;\nimport java.nio.channels.SocketChannel;\nimport java.util.Iterator;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\npublic class SocketServer1 {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketServer1.class);\n\n    public static void main(String[] args) throws Exception {\n        ServerSocketChannel serverChannel = ServerSocketChannel.open();\n        serverChannel.configureBlocking(false);\n        ServerSocket serverSocket = serverChannel.socket();\n        serverSocket.setReuseAddress(true);\n        serverSocket.bind(new InetSocketAddress(83));\n\n        Selector selector = Selector.open();\n        //SelectionKey.OP_ACCEPT\n        serverChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n        try {\n            while(true) {\n                //selector\n                //javaIO \n                if(selector.select(100) == 0) {\n                    //================================================\n                    //      \n                    //================================================\n                    continue;\n                }\n                //()\n                Iterator<SelectionKey> selecionKeys = selector.selectedKeys().iterator();\n\n                while(selecionKeys.hasNext()) {\n                    SelectionKey readyKey = selecionKeys.next();\n                    //readyKeyselector.selectedKeys\n                    //selector.select() > 0readyKey\n                    selecionKeys.remove();\n\n                    SelectableChannel selectableChannel = readyKey.channel();\n                    if(readyKey.isValid() && readyKey.isAcceptable()) {\n                        SocketServer1.LOGGER.info("======channel=======");\n                        /*\n                         * server socket channelserver socket channelsocketchannel\n                         * socket channelselectorsocket channel\n                         * socket channel\n                         * */\n                        ServerSocketChannel serverSocketChannel = (ServerSocketChannel)selectableChannel;\n                        SocketChannel socketChannel = serverSocketChannel.accept();\n                        registerSocketChannel(socketChannel , selector);\n\n                    } else if(readyKey.isValid() && readyKey.isConnectable()) {\n                        SocketServer1.LOGGER.info("======socket channel =======");\n                    } else if(readyKey.isValid() && readyKey.isReadable()) {\n                        SocketServer1.LOGGER.info("======socket channel =========");\n                        readSocketChannel(readyKey);\n                    }\n                }\n            }\n        } catch(Exception e) {\n            SocketServer1.LOGGER.error(e.getMessage() , e);\n        } finally {\n            serverSocket.close();\n        }\n    }\n\n    /**\n     * server socket channel/  TCP\n     * socketChannel<br>\n     * socket channelselector/\n     * selectorsocket channel\n     * socket channelselector/\n     * socket channel\n     * @param socketChannel socket channel\n     * @param selector selector/\n     * @throws Exception\n     */\n    private static void registerSocketChannel(SocketChannel socketChannel , Selector selector) throws Exception {\n        socketChannel.configureBlocking(false);\n        //socketSelectionKey.OP_READ | SelectionKey.OP_WRITE | SelectionKey.OP_CONNECT\n        socketChannel.register(selector, SelectionKey.OP_READ , ByteBuffer.allocate(2048));\n    }\n\n    /**\n     * \n     * socket channel\n     * true\n     * @param socketChannel\n     * @throws Exception\n     */\n    private static void readSocketChannel(SelectionKey readyKey) throws Exception {\n        SocketChannel clientSocketChannel = (SocketChannel)readyKey.channel();\n        //\n        InetSocketAddress sourceSocketAddress = (InetSocketAddress)clientSocketChannel.getRemoteAddress();\n        Integer resoucePort = sourceSocketAddress.getPort();\n\n        //socket channel\n        //capacity,positionlimit\n        ByteBuffer contextBytes = (ByteBuffer)readyKey.attachment();\n        //\n        //ByteBuffer2048 byte\n        //\n        int realLen = -1;\n        try {\n            realLen = clientSocketChannel.read(contextBytes);\n        } catch(Exception e) {\n            //channel\n            SocketServer1.LOGGER.error(e.getMessage());\n            clientSocketChannel.close();\n            return;\n        }\n\n        //(OP_READ)\n        if(realLen == -1) {\n            SocketServer1.LOGGER.warn("====? ====");\n            return;\n        }\n\n        //()\n        //java niosocket channel\n        contextBytes.flip();\n        //URLDecoder/URLEncoder\n        //java nio\n        byte[] messageBytes = contextBytes.array();\n        String messageEncode = new String(messageBytes , "UTF-8");\n        String message = URLDecoder.decode(messageEncode, "UTF-8");\n\n        //overbuffer\n        //buffer\n        if(message.indexOf("over") != -1) {\n            //(clear()capacity())\n            contextBytes.clear();\n            SocketServer1.LOGGER.info(":" + resoucePort + "======message : " + message);\n\n            //======================================================\n            //                  \n            //======================================================\n\n            //channel\n            ByteBuffer sendBuffer = ByteBuffer.wrap(URLEncoder.encode("", "UTF-8").getBytes());\n            clientSocketChannel.write(sendBuffer);\n            clientSocketChannel.close();\n        } else {\n            SocketServer1.LOGGER.info(":" + resoucePort + "======message : " + message);\n            //limitcapacitypositionrealLen\n            contextBytes.position(realLen);\n            contextBytes.limit(contextBytes.capacity());\n        }\n    }\n}\n\n\n:\n\n * serverChannel.register(Selector sel, int ops, Object att): register(Selector sel, int ops, Object att)ServerSocketChannelAbstractSelectableChannelAbstractSelectableChannelAbstractSelectableChannel:\n\n\n\n * SelectionKey.OP_ACCEPT: ChannelServerSocketChannelOP_ACCEPT()AbstractSelectableChannel:\n\n                         \nServerSocketChannel       SelectionKey.OP_ACCEPT\nDatagramChannel       UDP   SelectionKey.OP_READSelectionKey.OP_WRITE\nSocketChannel         TCP   SelectionKey.OP_READSelectionKey.OP_WRITESelectionKey.OP_CONNECT\n\nAbstractSelectableChannelpublic final int validOps()IO\n\nselector.selectedKeys().iterator(): SelectorIOselectedKeys(channel)\n\n> Returns this selectors selected-key set. Keys may be removed from, but not directly added to, the selected-key set. Any attempt to add an object to the key set will cause an UnsupportedOperationException to be thrown. The selected-key set is not thread-safe.\n\n\n# JAVA\n\nselector:\n\npackage testNSocket;\n\nimport java.net.InetSocketAddress;\nimport java.net.ServerSocket;\nimport java.net.URLDecoder;\nimport java.net.URLEncoder;\n\nimport java.nio.ByteBuffer;\nimport java.nio.channels.SelectableChannel;\nimport java.nio.channels.SelectionKey;\nimport java.nio.channels.Selector;\nimport java.nio.channels.ServerSocketChannel;\nimport java.nio.channels.SocketChannel;\n\nimport java.util.Iterator;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.apache.log4j.BasicConfigurator;\n\npublic class SocketServer2 {\n\n    static {\n        BasicConfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final Log LOGGER = LogFactory.getLog(SocketServer2.class);\n\n    /**\n     * java nio serverbuffer\n     * clientsocket channelbeff()<br>\n     * socketchanelhashcodekey(id)stringbuffervalueMESSAGEHASHCONTEXT\n     * \n     * ConcurrentHashMap/Google\n     */\n    private static final ConcurrentMap<Integer, StringBuffer> MESSAGEHASHCONTEXT = new ConcurrentHashMap<Integer , StringBuffer>();\n\n    public static void main(String[] args) throws Exception {\n        ServerSocketChannel serverChannel = ServerSocketChannel.open();\n        serverChannel.configureBlocking(false);\n        ServerSocket serverSocket = serverChannel.socket();\n        serverSocket.setReuseAddress(true);\n        serverSocket.bind(new InetSocketAddress(83));\n\n        Selector selector = Selector.open();\n        //SelectionKey.OP_ACCEPT\n        serverChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n        try {\n            while(true) {\n                //selector\n                //javaIO \n                if(selector.select(100) == 0) {\n                    //================================================\n                    //      \n                    //================================================\n                    continue;\n                }\n                //()\n                Iterator<SelectionKey> selecionKeys = selector.selectedKeys().iterator();\n\n                while(selecionKeys.hasNext()) {\n                    SelectionKey readyKey = selecionKeys.next();\n                    //readyKeyselector.selectedKeys\n                    //selector.select() > 0readyKey\n                    selecionKeys.remove();\n\n                    SelectableChannel selectableChannel = readyKey.channel();\n                    if(readyKey.isValid() && readyKey.isAcceptable()) {\n                        SocketServer2.LOGGER.info("======channel=======");\n                        /*\n                         * server socket channelserver socket channelsocketchannel\n                         * socket channelselectorsocket channel\n                         * socket channel\n                         * */\n                        ServerSocketChannel serverSocketChannel = (ServerSocketChannel)selectableChannel;\n                        SocketChannel socketChannel = serverSocketChannel.accept();\n                        registerSocketChannel(socketChannel , selector);\n\n                    } else if(readyKey.isValid() && readyKey.isConnectable()) {\n                        SocketServer2.LOGGER.info("======socket channel =======");\n                    } else if(readyKey.isValid() && readyKey.isReadable()) {\n                        SocketServer2.LOGGER.info("======socket channel =========");\n                        readSocketChannel(readyKey);\n                    }\n                }\n            }\n        } catch(Exception e) {\n            SocketServer2.LOGGER.error(e.getMessage() , e);\n        } finally {\n            serverSocket.close();\n        }\n    }\n\n    /**\n     * server socket channel/  TCP\n     * socketChannel<br>\n     * socket channelselector/\n     * selectorsocket channel\n     * socket channelselector/\n     * socket channel\n     * @param socketChannel socket channel\n     * @param selector selector/\n     * @throws Exception\n     */\n    private static void registerSocketChannel(SocketChannel socketChannel , Selector selector) throws Exception {\n        socketChannel.configureBlocking(false);\n        //socketSelectionKey.OP_READ | SelectionKey.OP_WRITE | SelectionKey.OP_CONNECT\n        // socketchanne\n        socketChannel.register(selector, SelectionKey.OP_READ , ByteBuffer.allocate(50));\n    }\n\n    /**\n     * \n     * socket channel\n     * true\n     * @param socketChannel\n     * @throws Exception\n     */\n    private static void readSocketChannel(SelectionKey readyKey) throws Exception {\n        SocketChannel clientSocketChannel = (SocketChannel)readyKey.channel();\n        //\n        InetSocketAddress sourceSocketAddress = (InetSocketAddress)clientSocketChannel.getRemoteAddress();\n        Integer resoucePort = sourceSocketAddress.getPort();\n\n        //socket channel\n        //capacity,positionlimit\n        ByteBuffer contextBytes = (ByteBuffer)readyKey.attachment();\n        //\n        //buffbuff50byte\n        //channelbuff\n        int realLen = 0;\n        StringBuffer message = new StringBuffer();\n        //\n        //buff\n        while((realLen = clientSocketChannel.read(contextBytes)) != 0) {\n\n            //bufferlimit = capacity\n            //read\n            contextBytes.flip();\n            int position = contextBytes.position();\n            int capacity = contextBytes.capacity();\n            byte[] messageBytes = new byte[capacity];\n            contextBytes.get(messageBytes, position, realLen);\n\n            //position\n            //contextBytesbyte\n            //(realLen)\n            //byte[] messageBytes = contextBytes.array();\n\n            //URLDecoder/URLEncoder\n            //java nio\n            String messageEncode = new String(messageBytes , 0 , realLen , "UTF-8");\n            message.append(messageEncode);\n\n            //\n            contextBytes.clear();\n        }\n\n        //over\n        if(URLDecoder.decode(message.toString(), "UTF-8").indexOf("over") != -1) {\n            //messageHashContext\n            Integer channelUUID = clientSocketChannel.hashCode();\n            SocketServer2.LOGGER.info(":" + resoucePort + "======message : " + message);\n            StringBuffer completeMessage;\n            //MESSAGEHASHCONTEXT\n            StringBuffer historyMessage = MESSAGEHASHCONTEXT.remove(channelUUID);\n            if(historyMessage == null) {\n                completeMessage = message;\n            } else {\n                completeMessage = historyMessage.append(message);\n            }\n            SocketServer2.LOGGER.info(":" + resoucePort + "======completeMessage : " + URLDecoder.decode(completeMessage.toString(), "UTF-8"));\n\n            //======================================================\n            //                  \n            //======================================================\n\n            //channel\n            ByteBuffer sendBuffer = ByteBuffer.wrap(URLEncoder.encode("", "UTF-8").getBytes());\n            clientSocketChannel.write(sendBuffer);\n            clientSocketChannel.close();\n        } else {\n            //overmessageHashContext\n            SocketServer2.LOGGER.info(":" + resoucePort + "======message : " + URLDecoder.decode(message.toString(), "UTF-8"));\n            //channelhash\n            Integer channelUUID = clientSocketChannel.hashCode();\n\n            //channelmessage\n            StringBuffer historyMessage = MESSAGEHASHCONTEXT.get(channelUUID);\n            if(historyMessage == null) {\n                historyMessage = new StringBuffer();\n                MESSAGEHASHCONTEXT.put(channelUUID, historyMessage.append(message));\n            }\n        }\n    }\n}\n\n\n\n\n\n# IO\n\n * IO(IO)\n\n * ServerSocketChannelTCPUDP\n\n * : IOIOIOIOSelector\n\n * IO:  IOIOIOIOIOIO: ():\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48522403',normalizedContent:'# java nio - io\n\n> ioractorjava nio@pdai\n\n * java nio - io\n   * \n   * io\n   * reactorproactor\n     * io\n     * reactor\n     * reactor----io\n     * reactor----\n     * reactor\n   * javaio\n     * : channel\n     * : buffer\n     * : selector\n     * java nio \n     * java\n     * java\n   * io\n   * \n\n\n# \n\n:\n\n100\n\n * ()(a)80()\n\n * (b)9999()(100)vip()\n\n * (c)vip\n\n?\n\n: \n\n * : \n * : \n * : \n * : \n * : linux$ulimit -n()\n * : io()\n * : ()\n * : \n   * a: / io\n   * b:  / io\n   * c: / io\n\n\n# io\n\nio: selectpollepollkqueue:\n\nio                                   java\nselect        reactor            windows/linux   ,reactor()linux kernels\n                                                   2.4selectwindowsioselect\npoll          reactor            linux           linuxjava niolinux kernels\n                                                   2.6pollreactor\nepoll          reactor/proactor   linux           linux kernels 2.6epolllinux kernels\n                                                   2.6polllinuxwindowsiocp\n                                                   io linuxepollio\nkqueue         proactor           linux           java\n\nio1iojava niosocket\n\n\n# reactorproactor\n\n\n# io\n\nioservern\n\n\n\nio\n\n * \n * \n\n\n\n * \n * io\n * \n\n\n# reactor\n\nioiojdk 1.4ioapiapireactorapiioreactor\n\n\n\nreactorreactoracceptorhandleracceptorreactorhandlerreactorio\n\n * reactorioreactor+ \n * reactorio\n\n\n# reactor----io\n\nreactor\n\n * \n * \n\nreactor\n\n\n\n\n\n * \n * \n\n\n\n * cpu\n\n\n# reactor----\n\n\n\n\n\nreactorreactormainreactorsubreactormainreactorsubreactorsubreactor\n\n\n# reactor\n\nreactorreactoracceptorhandlerdoug leareactor\n\npublic class reactor implements runnable {\n  private final selector selector;\n  private final serversocketchannel serversocket;\n\n  public reactor(int port) throws ioexception {\n    serversocket = serversocketchannel.open();  // serversocketchannel\n    serversocket.configureblocking(false);  // \n    selector = selector.open();  // selector\n    selectionkey key = serversocket.register(selector, selectionkey.op_accept);\n    serversocket.bind(new inetsocketaddress(port));  // \n    key.attach(new acceptor(serversocket));  // channelacceptor\n  }\n\n  @override\n  public void run() {\n    try {\n      while (!thread.interrupted()) {\n        selector.select();  // \n        set<selectionkey> keys = selector.selectedkeys();\n        iterator<selectionkey> iterator = keys.iterator();\n        while (iterator.hasnext()) {\n          dispatch(iterator.next());  // acceptor\n          iterator.remove();\n        }\n\n        selector.selectnow();\n      }\n    } catch (ioexception e) {\n      e.printstacktrace();\n    }\n  }\n\n  private void dispatch(selectionkey key) throws ioexception {\n    // attachementchannelacceptorrun()\n    // \n    runnable attachment = (runnable) key.attachment();\n    attachment.run();\n  }\n}\n\n\nreactorserversocketchannelreactoracceptoracceptoracceptor\n\npublic class acceptor implements runnable {\n  private final executorservice executor = executors.newfixedthreadpool(20);\n\n  private final serversocketchannel serversocket;\n\n  public acceptor(serversocketchannel serversocket) {\n    this.serversocket = serversocket;\n  }\n\n  @override\n  public void run() {\n    try {\n      socketchannel channel = serversocket.accept();  // \n      if (null != channel) {\n        executor.execute(new handler(channel));  // \n      }\n    } catch (ioexception e) {\n      e.printstacktrace();\n    }\n  }\n}\n\n\nacceptorhandler\n\npublic class handler implements runnable {\n  private volatile static selector selector;\n  private final socketchannel channel;\n  private selectionkey key;\n  private volatile bytebuffer input = bytebuffer.allocate(1024);\n  private volatile bytebuffer output = bytebuffer.allocate(1024);\n\n  public handler(socketchannel channel) throws ioexception {\n    this.channel = channel;\n    channel.configureblocking(false);  // \n    selector = selector.open();  // \n    key = channel.register(selector, selectionkey.op_read);  // channel\n  }\n\n  @override\n  public void run() {\n    try {\n      while (selector.isopen() && channel.isopen()) {\n        set<selectionkey> keys = select();  // \n        iterator<selectionkey> iterator = keys.iterator();\n        while (iterator.hasnext()) {\n          selectionkey key = iterator.next();\n          iterator.remove();\n\n          // \n          if (key.isreadable()) {\n            read(key);\n          } else if (key.iswritable()) {\n           // \n            write(key);\n          }\n        }\n      }\n    } catch (exception e) {\n      e.printstacktrace();\n    }\n  }\n\n  // jdkbugbugselector\n  // selectorchannelselector\n  private set<selectionkey> select() throws ioexception {\n    selector.select();\n    set<selectionkey> keys = selector.selectedkeys();\n    if (keys.isempty()) {\n      int interestops = key.interestops();\n      selector = selector.open();\n      key = channel.register(selector, interestops);\n      return select();\n    }\n\n    return keys;\n  }\n\n  // \n  private void read(selectionkey key) throws ioexception {\n    channel.read(input);\n    if (input.position() == 0) {\n      return;\n    }\n\n    input.flip();\n    process();  // \n    input.clear();\n    key.interestops(selectionkey.op_write);  // \n  }\n\n  private void write(selectionkey key) throws ioexception {\n    output.flip();\n    if (channel.isopen()) {\n      channel.write(output);  // channel\n      key.channel();\n      channel.close();\n      output.clear();\n    }\n  }\n    \n  // reactor\n  // futurechannel\n  private void process() {\n    byte[] bytes = new byte[input.remaining()];\n    input.get(bytes);\n    string message = new string(bytes, charsetutil.utf_8);\n    system.out.println("receive message from client: \\n" + message);\n\n    output.put("hello client".getbytes());\n  }\n}\n\n\nhandlerchannelselectorchannel\n\n\n# javaio\n\n\n\n\n# : channel\n\n()\n\njdk apichannel:\n\n> a channel represents an open connection to an entity such as a hardware device, a file, a network socket, or a program component that is capable of performing one or more distinct i/o operations, for example reading or writing.\n\n> a channel is either open or closed. a channel is open upon creation, and once closed it remains closed. once a channel is closed, any attempt to invoke an i/o operation upon it will cause a closedchannelexception to be thrown. whether or not a channel is open may be tested by invoking its isopen method.\n\njava nio channel:\n\n\n\nselector()selectablechannel\n\n * serversocketchannel: ioudptcp\n\n * scoketchannel: tcp socketsocketip:   ip: \n\n * datagramchannel: udp \n\n\n# : buffer\n\n: java nio java nio buffer\n\n? serversocketchannelop_acceptserversocketchannelbuffer\n\nbuffer: bufferbufferbuffer\n\n:\n\n\n\n * position: \n * limit: \n * capacity: \n\njava niobuffer\n\n\n# : selector\n\nselectorselectorchannel\n\n * channel\n\nselectorchannelchannelioselectorchannelwindowsselectorimplchannel:\n\n// initial capacity of the poll array\nprivate final int init_cap = 8;\n// maximum number of sockets for select().\n// should be init_cap times a power of 2\nprivate final static int max_selectable_fds = 1024;\n\n// the list of selectablechannels serviced by this selector. every mod\n// max_selectable_fds entry is bogus, to align this array with the poll\n// array,  where the corresponding entry is occupied by the wakeupsocket\nprivate selectionkeyimpl[] channelarray = new selectionkeyimpl[init_cap];\n\n\n * \n\nselector\n\n * \n\nio jvm io windowssun.nio.ch.windowsselectorimpl:\n\n\n\n\n# java nio \n\nioiojava jvmio? : iojava nioiojava.nio.channels.spi.selectorprovider:\n\n * public abstract datagramchannel opendatagramchannel(): udp \n\n * public abstract abstractselector openselector(): nionio\n\n * public abstract serversocketchannel openserversocketchannel(): nio\n\n * public abstract socketchannel opensocketchannel(): niotcp socket(tcp)\n\njava niojava nioio :\n\n\n\nselectorprovider selectorprovidernettynionettynetty 4.0nioserversocketchannel:\n\nprivate static serversocketchannel newsocket(selectorprovider provider) {\n    try {\n        /**\n            *  use the {@link selectorprovider} to open {@link socketchannel} and so remove condition in\n            *  {@link selectorprovider#provider()} which is called by each serversocketchannel.open() otherwise.\n            *\n            *  see <a href="see https://github.com/netty/netty/issues/2308">#2308</a>.\n            */\n        return provider.openserversocketchannel();\n    } catch (ioexception e) {\n        throw new channelexception(\n                "failed to open a server socket.", e);\n    }\n}\n\n\n\n# java\n\njava nioio(io):\n\npackage testnsocket;\n\nimport java.net.inetsocketaddress;\nimport java.net.serversocket;\nimport java.net.urldecoder;\nimport java.net.urlencoder;\nimport java.nio.bytebuffer;\nimport java.nio.channels.selectablechannel;\nimport java.nio.channels.selectionkey;\nimport java.nio.channels.selector;\nimport java.nio.channels.serversocketchannel;\nimport java.nio.channels.socketchannel;\nimport java.util.iterator;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\npublic class socketserver1 {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketserver1.class);\n\n    public static void main(string[] args) throws exception {\n        serversocketchannel serverchannel = serversocketchannel.open();\n        serverchannel.configureblocking(false);\n        serversocket serversocket = serverchannel.socket();\n        serversocket.setreuseaddress(true);\n        serversocket.bind(new inetsocketaddress(83));\n\n        selector selector = selector.open();\n        //selectionkey.op_accept\n        serverchannel.register(selector, selectionkey.op_accept);\n\n        try {\n            while(true) {\n                //selector\n                //javaio \n                if(selector.select(100) == 0) {\n                    //================================================\n                    //      \n                    //================================================\n                    continue;\n                }\n                //()\n                iterator<selectionkey> selecionkeys = selector.selectedkeys().iterator();\n\n                while(selecionkeys.hasnext()) {\n                    selectionkey readykey = selecionkeys.next();\n                    //readykeyselector.selectedkeys\n                    //selector.select() > 0readykey\n                    selecionkeys.remove();\n\n                    selectablechannel selectablechannel = readykey.channel();\n                    if(readykey.isvalid() && readykey.isacceptable()) {\n                        socketserver1.logger.info("======channel=======");\n                        /*\n                         * server socket channelserver socket channelsocketchannel\n                         * socket channelselectorsocket channel\n                         * socket channel\n                         * */\n                        serversocketchannel serversocketchannel = (serversocketchannel)selectablechannel;\n                        socketchannel socketchannel = serversocketchannel.accept();\n                        registersocketchannel(socketchannel , selector);\n\n                    } else if(readykey.isvalid() && readykey.isconnectable()) {\n                        socketserver1.logger.info("======socket channel =======");\n                    } else if(readykey.isvalid() && readykey.isreadable()) {\n                        socketserver1.logger.info("======socket channel =========");\n                        readsocketchannel(readykey);\n                    }\n                }\n            }\n        } catch(exception e) {\n            socketserver1.logger.error(e.getmessage() , e);\n        } finally {\n            serversocket.close();\n        }\n    }\n\n    /**\n     * server socket channel/  tcp\n     * socketchannel<br>\n     * socket channelselector/\n     * selectorsocket channel\n     * socket channelselector/\n     * socket channel\n     * @param socketchannel socket channel\n     * @param selector selector/\n     * @throws exception\n     */\n    private static void registersocketchannel(socketchannel socketchannel , selector selector) throws exception {\n        socketchannel.configureblocking(false);\n        //socketselectionkey.op_read | selectionkey.op_write | selectionkey.op_connect\n        socketchannel.register(selector, selectionkey.op_read , bytebuffer.allocate(2048));\n    }\n\n    /**\n     * \n     * socket channel\n     * true\n     * @param socketchannel\n     * @throws exception\n     */\n    private static void readsocketchannel(selectionkey readykey) throws exception {\n        socketchannel clientsocketchannel = (socketchannel)readykey.channel();\n        //\n        inetsocketaddress sourcesocketaddress = (inetsocketaddress)clientsocketchannel.getremoteaddress();\n        integer resouceport = sourcesocketaddress.getport();\n\n        //socket channel\n        //capacity,positionlimit\n        bytebuffer contextbytes = (bytebuffer)readykey.attachment();\n        //\n        //bytebuffer2048 byte\n        //\n        int reallen = -1;\n        try {\n            reallen = clientsocketchannel.read(contextbytes);\n        } catch(exception e) {\n            //channel\n            socketserver1.logger.error(e.getmessage());\n            clientsocketchannel.close();\n            return;\n        }\n\n        //(op_read)\n        if(reallen == -1) {\n            socketserver1.logger.warn("====? ====");\n            return;\n        }\n\n        //()\n        //java niosocket channel\n        contextbytes.flip();\n        //urldecoder/urlencoder\n        //java nio\n        byte[] messagebytes = contextbytes.array();\n        string messageencode = new string(messagebytes , "utf-8");\n        string message = urldecoder.decode(messageencode, "utf-8");\n\n        //overbuffer\n        //buffer\n        if(message.indexof("over") != -1) {\n            //(clear()capacity())\n            contextbytes.clear();\n            socketserver1.logger.info(":" + resouceport + "======message : " + message);\n\n            //======================================================\n            //                  \n            //======================================================\n\n            //channel\n            bytebuffer sendbuffer = bytebuffer.wrap(urlencoder.encode("", "utf-8").getbytes());\n            clientsocketchannel.write(sendbuffer);\n            clientsocketchannel.close();\n        } else {\n            socketserver1.logger.info(":" + resouceport + "======message : " + message);\n            //limitcapacitypositionreallen\n            contextbytes.position(reallen);\n            contextbytes.limit(contextbytes.capacity());\n        }\n    }\n}\n\n\n:\n\n * serverchannel.register(selector sel, int ops, object att): register(selector sel, int ops, object att)serversocketchannelabstractselectablechannelabstractselectablechannelabstractselectablechannel:\n\n\n\n * selectionkey.op_accept: channelserversocketchannelop_accept()abstractselectablechannel:\n\n                         \nserversocketchannel       selectionkey.op_accept\ndatagramchannel       udp   selectionkey.op_readselectionkey.op_write\nsocketchannel         tcp   selectionkey.op_readselectionkey.op_writeselectionkey.op_connect\n\nabstractselectablechannelpublic final int validops()io\n\nselector.selectedkeys().iterator(): selectorioselectedkeys(channel)\n\n> returns this selectors selected-key set. keys may be removed from, but not directly added to, the selected-key set. any attempt to add an object to the key set will cause an unsupportedoperationexception to be thrown. the selected-key set is not thread-safe.\n\n\n# java\n\nselector:\n\npackage testnsocket;\n\nimport java.net.inetsocketaddress;\nimport java.net.serversocket;\nimport java.net.urldecoder;\nimport java.net.urlencoder;\n\nimport java.nio.bytebuffer;\nimport java.nio.channels.selectablechannel;\nimport java.nio.channels.selectionkey;\nimport java.nio.channels.selector;\nimport java.nio.channels.serversocketchannel;\nimport java.nio.channels.socketchannel;\n\nimport java.util.iterator;\nimport java.util.concurrent.concurrenthashmap;\nimport java.util.concurrent.concurrentmap;\n\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.apache.log4j.basicconfigurator;\n\npublic class socketserver2 {\n\n    static {\n        basicconfigurator.configure();\n    }\n\n    /**\n     * \n     */\n    private static final log logger = logfactory.getlog(socketserver2.class);\n\n    /**\n     * java nio serverbuffer\n     * clientsocket channelbeff()<br>\n     * socketchanelhashcodekey(id)stringbuffervaluemessagehashcontext\n     * \n     * concurrenthashmap/google\n     */\n    private static final concurrentmap<integer, stringbuffer> messagehashcontext = new concurrenthashmap<integer , stringbuffer>();\n\n    public static void main(string[] args) throws exception {\n        serversocketchannel serverchannel = serversocketchannel.open();\n        serverchannel.configureblocking(false);\n        serversocket serversocket = serverchannel.socket();\n        serversocket.setreuseaddress(true);\n        serversocket.bind(new inetsocketaddress(83));\n\n        selector selector = selector.open();\n        //selectionkey.op_accept\n        serverchannel.register(selector, selectionkey.op_accept);\n\n        try {\n            while(true) {\n                //selector\n                //javaio \n                if(selector.select(100) == 0) {\n                    //================================================\n                    //      \n                    //================================================\n                    continue;\n                }\n                //()\n                iterator<selectionkey> selecionkeys = selector.selectedkeys().iterator();\n\n                while(selecionkeys.hasnext()) {\n                    selectionkey readykey = selecionkeys.next();\n                    //readykeyselector.selectedkeys\n                    //selector.select() > 0readykey\n                    selecionkeys.remove();\n\n                    selectablechannel selectablechannel = readykey.channel();\n                    if(readykey.isvalid() && readykey.isacceptable()) {\n                        socketserver2.logger.info("======channel=======");\n                        /*\n                         * server socket channelserver socket channelsocketchannel\n                         * socket channelselectorsocket channel\n                         * socket channel\n                         * */\n                        serversocketchannel serversocketchannel = (serversocketchannel)selectablechannel;\n                        socketchannel socketchannel = serversocketchannel.accept();\n                        registersocketchannel(socketchannel , selector);\n\n                    } else if(readykey.isvalid() && readykey.isconnectable()) {\n                        socketserver2.logger.info("======socket channel =======");\n                    } else if(readykey.isvalid() && readykey.isreadable()) {\n                        socketserver2.logger.info("======socket channel =========");\n                        readsocketchannel(readykey);\n                    }\n                }\n            }\n        } catch(exception e) {\n            socketserver2.logger.error(e.getmessage() , e);\n        } finally {\n            serversocket.close();\n        }\n    }\n\n    /**\n     * server socket channel/  tcp\n     * socketchannel<br>\n     * socket channelselector/\n     * selectorsocket channel\n     * socket channelselector/\n     * socket channel\n     * @param socketchannel socket channel\n     * @param selector selector/\n     * @throws exception\n     */\n    private static void registersocketchannel(socketchannel socketchannel , selector selector) throws exception {\n        socketchannel.configureblocking(false);\n        //socketselectionkey.op_read | selectionkey.op_write | selectionkey.op_connect\n        // socketchanne\n        socketchannel.register(selector, selectionkey.op_read , bytebuffer.allocate(50));\n    }\n\n    /**\n     * \n     * socket channel\n     * true\n     * @param socketchannel\n     * @throws exception\n     */\n    private static void readsocketchannel(selectionkey readykey) throws exception {\n        socketchannel clientsocketchannel = (socketchannel)readykey.channel();\n        //\n        inetsocketaddress sourcesocketaddress = (inetsocketaddress)clientsocketchannel.getremoteaddress();\n        integer resouceport = sourcesocketaddress.getport();\n\n        //socket channel\n        //capacity,positionlimit\n        bytebuffer contextbytes = (bytebuffer)readykey.attachment();\n        //\n        //buffbuff50byte\n        //channelbuff\n        int reallen = 0;\n        stringbuffer message = new stringbuffer();\n        //\n        //buff\n        while((reallen = clientsocketchannel.read(contextbytes)) != 0) {\n\n            //bufferlimit = capacity\n            //read\n            contextbytes.flip();\n            int position = contextbytes.position();\n            int capacity = contextbytes.capacity();\n            byte[] messagebytes = new byte[capacity];\n            contextbytes.get(messagebytes, position, reallen);\n\n            //position\n            //contextbytesbyte\n            //(reallen)\n            //byte[] messagebytes = contextbytes.array();\n\n            //urldecoder/urlencoder\n            //java nio\n            string messageencode = new string(messagebytes , 0 , reallen , "utf-8");\n            message.append(messageencode);\n\n            //\n            contextbytes.clear();\n        }\n\n        //over\n        if(urldecoder.decode(message.tostring(), "utf-8").indexof("over") != -1) {\n            //messagehashcontext\n            integer channeluuid = clientsocketchannel.hashcode();\n            socketserver2.logger.info(":" + resouceport + "======message : " + message);\n            stringbuffer completemessage;\n            //messagehashcontext\n            stringbuffer historymessage = messagehashcontext.remove(channeluuid);\n            if(historymessage == null) {\n                completemessage = message;\n            } else {\n                completemessage = historymessage.append(message);\n            }\n            socketserver2.logger.info(":" + resouceport + "======completemessage : " + urldecoder.decode(completemessage.tostring(), "utf-8"));\n\n            //======================================================\n            //                  \n            //======================================================\n\n            //channel\n            bytebuffer sendbuffer = bytebuffer.wrap(urlencoder.encode("", "utf-8").getbytes());\n            clientsocketchannel.write(sendbuffer);\n            clientsocketchannel.close();\n        } else {\n            //overmessagehashcontext\n            socketserver2.logger.info(":" + resouceport + "======message : " + urldecoder.decode(message.tostring(), "utf-8"));\n            //channelhash\n            integer channeluuid = clientsocketchannel.hashcode();\n\n            //channelmessage\n            stringbuffer historymessage = messagehashcontext.get(channeluuid);\n            if(historymessage == null) {\n                historymessage = new stringbuffer();\n                messagehashcontext.put(channeluuid, historymessage.append(message));\n            }\n        }\n    }\n}\n\n\n\n\n\n# io\n\n * io(io)\n\n * serversocketchanneltcpudp\n\n * : ioioioioselector\n\n * io:  ioioioioioio: ():\n\n\n# \n\n * : \n * https://blog.csdn.net/yinwenjie/article/details/48522403',charsets:{cjk:!0}},{title:"Java IO",frontmatter:{},regularPath:"/java/io/java-io-overview.html",relativePath:"java/io/java-io-overview.md",key:"v-2c08e938",path:"/java/io/java-io-overview.html",headers:[{level:2,title:"Java IO",slug:"java-io",normalizedTitle:"java io",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:10},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:89},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:99}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java IO   ",content:"# Java IO\n\n> Java IO/NIO/AIO@pdai\n\n * Java IO\n   * \n   * \n   * \n\n\n# \n\n\n\n\n# \n\n> A. Java - IOJava IOIO@pdai\n\n * Java IO/NIO/AIO - Overview\n   * Java IO/NIO/AIO\n\n> B. Java - IOIOJavaIO@pdai\n\n * Java IO - ()\n   * Java IO\n * Java IO - ()\n   * Java I/O \n * Java IO - : InputStream\n   * JDKInputStream\n * Java IO - : OutputStream\n   * JDK OutputStream\n * Java IO - \n   * Java IO\n\n> C. Java - IONIO/AIOUnix IOJava BIO/NIO/AIO@pdai\n\n * IO  - Unix IO \n   *  Unix I/O 55IO\n * Java IO - BIO \n   * BIO: blocking IOIOIO\n * Java NIO - \n   * / (NIO)  JDK 1.4  I/O  I/O\n * Java NIO - IO\n   * IORactorJava NIO\n * Java AIO - IO\n   * IOJavaAIO@pdai\n\n> D. Java - IO@pdai\n\n * Java NIO - Java NIO Linux Java NIO mmap MappedByteBuffer  sendfile  FileChannel Netty  RocketMQ  Kafka \n\n * Java N(A)IO - : Netty\n   \n   * NettyNIOTCPUDPNIONettyNettyRPCzookeeper\n\n\n# \n\n * Java IO https://blog.csdn.net/panweiwei1994/article/details/78046000\n * Linux  I/O ()https://blog.csdn.net/anxpp/article/details/51503329\n * Java IO(BIONIOAIO) https://blog.csdn.net/anxpp/article/details/51512200\n * Java ()BIO/NIO/AIO https://blog.csdn.net/KingCat666/article/details/77689627\n\nJava IO\n\n * : (1) https://blog.csdn.net/yinwenjie/article/list/6?\n * https://blog.csdn.net/yinwenjie/article/details/48274255\n * https://blog.csdn.net/yinwenjie/article/details/48344989\n * https://blog.csdn.net/yinwenjie/article/details/48472237\n * https://blog.csdn.net/yinwenjie/article/details/48522403\n * https://blog.csdn.net/yinwenjie/article/details/48784375\n\nNetty\n\n * https://blog.csdn.net/yinwenjie/article/details/48829419\n * https://blog.csdn.net/yinwenjie/article/details/48969853\n * https://blog.csdn.net/woaixiaopangniu521/article/details/70279143",normalizedContent:"# java io\n\n> java io/nio/aio@pdai\n\n * java io\n   * \n   * \n   * \n\n\n# \n\n\n\n\n# \n\n> a. java - iojava ioio@pdai\n\n * java io/nio/aio - overview\n   * java io/nio/aio\n\n> b. java - ioiojavaio@pdai\n\n * java io - ()\n   * java io\n * java io - ()\n   * java i/o \n * java io - : inputstream\n   * jdkinputstream\n * java io - : outputstream\n   * jdk outputstream\n * java io - \n   * java io\n\n> c. java - ionio/aiounix iojava bio/nio/aio@pdai\n\n * io  - unix io \n   *  unix i/o 55io\n * java io - bio \n   * bio: blocking ioioio\n * java nio - \n   * / (nio)  jdk 1.4  i/o  i/o\n * java nio - io\n   * ioractorjava nio\n * java aio - io\n   * iojavaaio@pdai\n\n> d. java - io@pdai\n\n * java nio - java nio linux java nio mmap mappedbytebuffer  sendfile  filechannel netty  rocketmq  kafka \n\n * java n(a)io - : netty\n   \n   * nettyniotcpudpnionettynettyrpczookeeper\n\n\n# \n\n * java io https://blog.csdn.net/panweiwei1994/article/details/78046000\n * linux  i/o ()https://blog.csdn.net/anxpp/article/details/51503329\n * java io(bionioaio) https://blog.csdn.net/anxpp/article/details/51512200\n * java ()bio/nio/aio https://blog.csdn.net/kingcat666/article/details/77689627\n\njava io\n\n * : (1) https://blog.csdn.net/yinwenjie/article/list/6?\n * https://blog.csdn.net/yinwenjie/article/details/48274255\n * https://blog.csdn.net/yinwenjie/article/details/48344989\n * https://blog.csdn.net/yinwenjie/article/details/48472237\n * https://blog.csdn.net/yinwenjie/article/details/48522403\n * https://blog.csdn.net/yinwenjie/article/details/48784375\n\nnetty\n\n * https://blog.csdn.net/yinwenjie/article/details/48829419\n * https://blog.csdn.net/yinwenjie/article/details/48969853\n * https://blog.csdn.net/woaixiaopangniu521/article/details/70279143",charsets:{cjk:!0}},{title:"Java 8 - ",frontmatter:{},regularPath:"/java/java8/java8-anno-repeat.html",relativePath:"java/java8/java8-anno-repeat.md",key:"v-681ae11a",path:"/java/java8/java8-anno-repeat.html",headers:[{level:2,title:"Java 8 - ",slug:"java-8-",normalizedTitle:"java 8 - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:119},{level:3,title:"JDK8",slug:"jdk8",normalizedTitle:"jdk8",charIndex:134},{level:3,title:"Jdk8",slug:"jdk8",normalizedTitle:"jdk8",charIndex:148},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:162}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 -   JDK8 Jdk8 ",content:'# Java 8 - \n\n> Java 8 : @pdai\n> \n>  * Jdk8?\n>  * Jdk8?\n\n * Java 8 - \n   * \n     * JDK8\n     * Jdk8\n   * \n\n\n# \n\n()\n\n\n# JDK8\n\njava 8:\n\npublic @interface Authority {\n     String role();\n}\n\npublic @interface Authorities {\n    Authority[] value();\n}\n\npublic class RepeatAnnotationUseOldVersion {\n\n    @Authorities({@Authority(role="Admin"),@Authority(role="Manager")})\n    public void doSomeThing(){\n    }\n}\n\n\nAuthorities\n\n\n# Jdk8\n\njava 8:\n\n@Repeatable(Authorities.class)\npublic @interface Authority {\n     String role();\n}\n\npublic @interface Authorities {\n    Authority[] value();\n}\n\npublic class RepeatAnnotationUseNewVersion {\n    @Authority(role="Admin")\n    @Authority(role="Manager")\n    public void doSomeThing(){ }\n}\n\n\nAuthority@Repeatable,AuthoritiesAuthorityjava 8\n\n\n# \n\nJEP120java 82(JEP 104,JEP120)',normalizedContent:'# java 8 - \n\n> java 8 : @pdai\n> \n>  * jdk8?\n>  * jdk8?\n\n * java 8 - \n   * \n     * jdk8\n     * jdk8\n   * \n\n\n# \n\n()\n\n\n# jdk8\n\njava 8:\n\npublic @interface authority {\n     string role();\n}\n\npublic @interface authorities {\n    authority[] value();\n}\n\npublic class repeatannotationuseoldversion {\n\n    @authorities({@authority(role="admin"),@authority(role="manager")})\n    public void dosomething(){\n    }\n}\n\n\nauthorities\n\n\n# jdk8\n\njava 8:\n\n@repeatable(authorities.class)\npublic @interface authority {\n     string role();\n}\n\npublic @interface authorities {\n    authority[] value();\n}\n\npublic class repeatannotationusenewversion {\n    @authority(role="admin")\n    @authority(role="manager")\n    public void dosomething(){ }\n}\n\n\nauthority@repeatable,authoritiesauthorityjava 8\n\n\n# \n\njep120java 82(jep 104,jep120)',charsets:{cjk:!0}},{title:"Java 8 - ",frontmatter:{},regularPath:"/java/java8/java8-default.html",relativePath:"java/java8/java8-default.md",key:"v-79b9f78c",path:"/java/java8/java8-default.html",headers:[{level:2,title:"Java 8 - ",slug:"java-8-",normalizedTitle:"java 8 - ",charIndex:2},{level:2,title:"",slug:"-",normalizedTitle:"",charIndex:148},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:173},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:148},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:200},{level:2,title:"java 8",slug:"java-8",normalizedTitle:"java 8",charIndex:215},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:235},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:250},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:259}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 -      java 8   ",content:'# Java 8 - \n\n> Java 8 : @pdai\n> \n>  * ?\n>  * ?\n>  * ?\n\n * Java 8 - \n   * \n     * \n     * \n     * \n   * java 8\n   * \n     * \n   * \n\n\n# \n\n\n# \n\nAClazzA\n\npublic interface A {\n    default void foo(){\n       System.out.println("Calling A.foo()");\n    }\n}\n\npublic class Clazz implements A {\n    public static void main(String[] args){\n       Clazz clazz = new Clazz();\n       clazz.foo();//A.foo()\n    }\n}\n\n\nClazzfoo()Afoo()\n\n\n# \n\ndefault\n\n\n# \n\n? java 8foreachJDK\n\n\n# java 8\n\njava 8? \n\n                                              \n                                           ()\n()                                 is-alike-a\n()   public static final\n                                                  friendly\n                                                 \n\n\n# \n\n:\n\n1.(classes always win)\n\n2.\n\n\n# \n\n * Case 1\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic interface B{\n\tdefault void aa() {\n\t\tSystem.out.println("B\'s aa");\n\t}\n}\npublic static class D implements A,B{\n\t\n}\n\n\n Duplicate default methods named aa with the parameters () and () are inherited from the types DocApplication.B and DocApplication.A\n\nA,BAaa? :\n\npublic static class D implements A,B{\n    @Override\n    public void aa(){\n        A.super.aa();\n    }\n}\n\n\n * Case 2\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic interface B{\n\tdefault void aa() {\n\t\tSystem.out.println("B\'s aa");\n\t}\n}\npublic interface C extends A, B{\n\tdefault void aa() {\n\t\tSystem.out.println("C\'s aa");\n\t}\n}\npublic static class D implements A,B,C{\n\t\n}\n\n\n C\'s aa\n\n * Case 3\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic interface C extends A{\n\tdefault void aa() {\n\t\tSystem.out.println("C\'s aa");\n\t}\n}\npublic static class D implements C{\n\t\n}\n\n\n C\'s aa\n\n> Case1-3default\n\n * Case 4 AX.super.m(),CAhello:\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic class X implements A{\n    @Override\n    public void aa(){\n        A.super.aa();\n    }\n}\n\n\n: A\'s aa\n\n * Case 5\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic interface B{\n\tdefault void aa() {\n\t\tSystem.out.println("B\'s aa");\n\t}\n}\npublic interface C extends A,B{\n\tdefault void aa() {\n\t\tSystem.out.println("C\'s aa");\n\t}\n}\npublic static class D implements C{\n\t@Override\n    public void aa(){\n        C.super.aa();\n    }\n}\n\n\n C\'s aa C.superCDA,Baa\n\n> Case 5Caa, aa; case 6 \n\n * Case 6\n\npublic interface A{\n\tdefault void aa() {\n\t\tSystem.out.println("A\'s aa");\n\t}\n}\npublic interface B{\n\tdefault void aa() {\n\t\tSystem.out.println("B\'s aa");\n\t}\n}\npublic interface C extends A,B{\n}\n\n\n\n\n\n# \n\njava 8Java 8lambdasAPI',normalizedContent:'# java 8 - \n\n> java 8 : @pdai\n> \n>  * ?\n>  * ?\n>  * ?\n\n * java 8 - \n   * \n     * \n     * \n     * \n   * java 8\n   * \n     * \n   * \n\n\n# \n\n\n# \n\naclazza\n\npublic interface a {\n    default void foo(){\n       system.out.println("calling a.foo()");\n    }\n}\n\npublic class clazz implements a {\n    public static void main(string[] args){\n       clazz clazz = new clazz();\n       clazz.foo();//a.foo()\n    }\n}\n\n\nclazzfoo()afoo()\n\n\n# \n\ndefault\n\n\n# \n\n? java 8foreachjdk\n\n\n# java 8\n\njava 8? \n\n                                              \n                                           ()\n()                                 is-alike-a\n()   public static final\n                                                  friendly\n                                                 \n\n\n# \n\n:\n\n1.(classes always win)\n\n2.\n\n\n# \n\n * case 1\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic interface b{\n\tdefault void aa() {\n\t\tsystem.out.println("b\'s aa");\n\t}\n}\npublic static class d implements a,b{\n\t\n}\n\n\n duplicate default methods named aa with the parameters () and () are inherited from the types docapplication.b and docapplication.a\n\na,baaa? :\n\npublic static class d implements a,b{\n    @override\n    public void aa(){\n        a.super.aa();\n    }\n}\n\n\n * case 2\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic interface b{\n\tdefault void aa() {\n\t\tsystem.out.println("b\'s aa");\n\t}\n}\npublic interface c extends a, b{\n\tdefault void aa() {\n\t\tsystem.out.println("c\'s aa");\n\t}\n}\npublic static class d implements a,b,c{\n\t\n}\n\n\n c\'s aa\n\n * case 3\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic interface c extends a{\n\tdefault void aa() {\n\t\tsystem.out.println("c\'s aa");\n\t}\n}\npublic static class d implements c{\n\t\n}\n\n\n c\'s aa\n\n> case1-3default\n\n * case 4 ax.super.m(),cahello:\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic class x implements a{\n    @override\n    public void aa(){\n        a.super.aa();\n    }\n}\n\n\n: a\'s aa\n\n * case 5\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic interface b{\n\tdefault void aa() {\n\t\tsystem.out.println("b\'s aa");\n\t}\n}\npublic interface c extends a,b{\n\tdefault void aa() {\n\t\tsystem.out.println("c\'s aa");\n\t}\n}\npublic static class d implements c{\n\t@override\n    public void aa(){\n        c.super.aa();\n    }\n}\n\n\n c\'s aa c.supercda,baa\n\n> case 5caa, aa; case 6 \n\n * case 6\n\npublic interface a{\n\tdefault void aa() {\n\t\tsystem.out.println("a\'s aa");\n\t}\n}\npublic interface b{\n\tdefault void aa() {\n\t\tsystem.out.println("b\'s aa");\n\t}\n}\npublic interface c extends a,b{\n}\n\n\n\n\n\n# \n\njava 8java 8lambdasapi',charsets:{cjk:!0}},{title:"Java 8 - JavaFx 2.0",frontmatter:{},regularPath:"/java/java8/java8-javafx.html",relativePath:"java/java8/java8-javafx.md",key:"v-428b51f0",path:"/java/java8/java8-javafx.html",headers:[{level:2,title:"Java 8 - JavaFx 2.0",slug:"java-8-javafx-2-0",normalizedTitle:"java 8 - javafx 2.0",charIndex:2},{level:2,title:"JavaFX",slug:"javafx",normalizedTitle:"javafx",charIndex:215},{level:2,title:"JavaFx8",slug:"javafx8",normalizedTitle:"javafx8",charIndex:229},{level:2,title:"JavaFX 82048",slug:"javafx-82048",normalizedTitle:"javafx 82048",charIndex:415},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:437},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:445}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - JavaFx 2.0 JavaFX JavaFx8 JavaFX 82048  ",content:"# Java 8 - JavaFx 2.0\n\n> JavaFXswingmediaaudio,video,graphics,animation,3DcssXUIXMLUIandroid@pdai\n\n * Java 8 - JavaFx 2.0\n   * JavaFX\n   * JavaFx8\n     * : Modena\n     * JavaFX 3D\n     * \n     * TreeTableView\n     * DatePicker\n     *  CSS  API\n     * WebView \n     * JavaFX Scene Builder 2.0\n   * JavaFX 82048\n   * \n   * \n\n\n# JavaFX\n\njavawebjavaSun2008JavaFXJavaFX\n\n\n\nJavaFX ScriptJavaFXJavaFX ScriptJava bytecodeJava\n\nJavaFX 2.0JavaFX ScriptJava APIJavaFXJava\n\nJavaFX 2.0  UI WebView 2.0  FXML  UI  XML \n\nJDK 7u6JavaFxJDKJavaFX8.08.0JavaFXJava 8Java 8\n\n\n# JavaFx8\n\n# : Modena\n\nModenaCaspianApplicationstart()setUserAgentStylesheet(STYLESHEET_CASPIAN)Caspian\n\nhttp://fxexperience.com/2013/03/modena-theme-update/\n\n# JavaFX 3D\n\nJavaFX83DAPIShape3D (Box, Cylinder, MeshView, Sphere),SubScene, Material, PickResult, LightBase (AmbientLight PointLight),SceneAntialiasingCameraJavaDoc\n\n# \n\n\n\n# TreeTableView\n\n# DatePicker\n\n\n\n#  CSS  API\n\nCSS  JavaFX \nCSS  API (com.sun.javafx.css )\n( Scene Builder) CSS  API\n CSS \n\n\n# WebView \n\n * Nashorn JavaScript  https://blogs.oracle.com/nashorn/entry/open_for_business\n * WebSocket http://javafx-jira.kenai.com/browse/RT-14947\n * Web Workers http://javafx-jira.kenai.com/browse/RT-9782\n\n# JavaFX Scene Builder 2.0\n\nJavaFX\n\nJavaFX Scene BuilderNetBeansFXMLXMLJavaFXJavaFX\n\nJavaFX Scene Builder 2.0JavaFX ThemePreviewJavaFX Theme:\n\nModena (FX8).\nModena Touch (FX8).\nModena High Contrast  Black on White (FX8).\nModena High Contrast  White on Black (FX8).\nModena High Contrast  Yellow on Black (FX8).\nCaspian (FX2).\nCaspian Embedded (FX2).\nCaspian Embedded QVGA (FX2).\n\n\n\n# JavaFX 82048\n\n20482048 Gabriele Cirulli  ()2048MIT2048JavaFX 82048\n\n\n\nLambda expressions\nStream API\nJavaFX 8\nJavaFX CSS basics\nJavaFX animationsfx2048\nGame2048,\nGameManager,(Board)Grid(GridOperator)\nBoard,labels grid Tile\nTile,\nGridOperator,Grid\nLocation,Direction \nRecordManagerSessionManager\n\n\ngit.oschina.net/benhail/javase8-sample/tree/master/src/main/java/javase8sample/chapter13/javafx8/fx2048\n\n\n# \n\nAWTSWINGJavaFXIDEJavaFXNetBeanslambdaJavaFXJavaFXJavaFX: ControlsFXJRebirthDataFX FlowmvvmFXTestFX JavaFXAndroidios\n\nRIAHTML5FlexSliverlightJavaFXJavaFXJavaFX, THE END .\n\n\n# \n\n * https://github.com/oimchat/oim-fx\n\n * https://github.com/goxr3plus/FX-BorderlessScene\n\n * https://github.com/topics/material-ui\n\n * https://github.com/in-sideFX/Undecorator\n\n * https://github.com/brunoborges/webfx\n\n * https://blog.csdn.net/loongshawn/article/details/52805751\n\n * https://docs.oracle.com/javafx/2/ui_controls/overview.htm#BABJACHC\n\n * https://www.oracle.com/technetwork/cn/articles/java/layoutfx-1536156-zhs.html",normalizedContent:"# java 8 - javafx 2.0\n\n> javafxswingmediaaudio,video,graphics,animation,3dcssxuixmluiandroid@pdai\n\n * java 8 - javafx 2.0\n   * javafx\n   * javafx8\n     * : modena\n     * javafx 3d\n     * \n     * treetableview\n     * datepicker\n     *  css  api\n     * webview \n     * javafx scene builder 2.0\n   * javafx 82048\n   * \n   * \n\n\n# javafx\n\njavawebjavasun2008javafxjavafx\n\n\n\njavafx scriptjavafxjavafx scriptjava bytecodejava\n\njavafx 2.0javafx scriptjava apijavafxjava\n\njavafx 2.0  ui webview 2.0  fxml  ui  xml \n\njdk 7u6javafxjdkjavafx8.08.0javafxjava 8java 8\n\n\n# javafx8\n\n# : modena\n\nmodenacaspianapplicationstart()setuseragentstylesheet(stylesheet_caspian)caspian\n\nhttp://fxexperience.com/2013/03/modena-theme-update/\n\n# javafx 3d\n\njavafx83dapishape3d (box, cylinder, meshview, sphere),subscene, material, pickresult, lightbase (ambientlight pointlight),sceneantialiasingcamerajavadoc\n\n# \n\n\n\n# treetableview\n\n# datepicker\n\n\n\n#  css  api\n\ncss  javafx \ncss  api (com.sun.javafx.css )\n( scene builder) css  api\n css \n\n\n# webview \n\n * nashorn javascript  https://blogs.oracle.com/nashorn/entry/open_for_business\n * websocket http://javafx-jira.kenai.com/browse/rt-14947\n * web workers http://javafx-jira.kenai.com/browse/rt-9782\n\n# javafx scene builder 2.0\n\njavafx\n\njavafx scene buildernetbeansfxmlxmljavafxjavafx\n\njavafx scene builder 2.0javafx themepreviewjavafx theme:\n\nmodena (fx8).\nmodena touch (fx8).\nmodena high contrast  black on white (fx8).\nmodena high contrast  white on black (fx8).\nmodena high contrast  yellow on black (fx8).\ncaspian (fx2).\ncaspian embedded (fx2).\ncaspian embedded qvga (fx2).\n\n\n\n# javafx 82048\n\n20482048 gabriele cirulli  ()2048mit2048javafx 82048\n\n\n\nlambda expressions\nstream api\njavafx 8\njavafx css basics\njavafx animationsfx2048\ngame2048,\ngamemanager,(board)grid(gridoperator)\nboard,labels grid tile\ntile,\ngridoperator,grid\nlocation,direction \nrecordmanagersessionmanager\n\n\ngit.oschina.net/benhail/javase8-sample/tree/master/src/main/java/javase8sample/chapter13/javafx8/fx2048\n\n\n# \n\nawtswingjavafxidejavafxnetbeanslambdajavafxjavafxjavafx: controlsfxjrebirthdatafx flowmvvmfxtestfx javafxandroidios\n\nriahtml5flexsliverlightjavafxjavafxjavafx, the end .\n\n\n# \n\n * https://github.com/oimchat/oim-fx\n\n * https://github.com/goxr3plus/fx-borderlessscene\n\n * https://github.com/topics/material-ui\n\n * https://github.com/in-sidefx/undecorator\n\n * https://github.com/brunoborges/webfx\n\n * https://blog.csdn.net/loongshawn/article/details/52805751\n\n * https://docs.oracle.com/javafx/2/ui_controls/overview.htm#babjachc\n\n * https://www.oracle.com/technetwork/cn/articles/java/layoutfx-1536156-zhs.html",charsets:{cjk:!0}},{title:"Java 8 - JRE",frontmatter:{},regularPath:"/java/java8/java8-jre.html",relativePath:"java/java8/java8-jre.md",key:"v-46722458",path:"/java/java8/java8-jre.html",headers:[{level:2,title:"Java 8 - JRE",slug:"java-8-jre",normalizedTitle:"java 8 - jre",charIndex:2},{level:2,title:"JRE",slug:"jre",normalizedTitle:"jre",charIndex:120},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:133},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:141},{level:3,title:"JDEPS",slug:"jdeps",normalizedTitle:"jdeps",charIndex:158},{level:3,title:"linuxprofile",slug:"linuxprofile",normalizedTitle:"linuxprofile",charIndex:175},{level:3,title:"compact",slug:"compact",normalizedTitle:"compact",charIndex:199},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:222}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - JRE JRE   JDEPS linuxprofile compact ",content:"# Java 8 - JRE\n\n> Java8 JRE: @pdai\n> \n>  * Java8 JRE?\n>  * ?\n\n * Java 8 - JRE\n   * JRE\n   * \n   * \n     * JDEPS\n     * linuxprofile\n     * compact\n   * \n\nOracleJava 8javaer18java18java8lambdaStream APIDate time apijavajavajava8JEP161(http://openjdk.java.net/jeps/161 ),Java SEjavaJREJRE\n\n\n# JRE\n\n * Java\n * \n * \n * \n\n\n# \n\nJRE3compact1compact2compact3compact1<compact2<compact3,API\n\njavacprofile\n\njavac bootclasspath, or javac profile\n\n\ncompactapi\n\n$ javac -profile compact2 Test.java\nTest.java:7: error: ThreadMXBean is not available in profile 'compact2'\n ThreadMXBean bean = ManagementFactory.getThreadMXBean();\n ^\nTest.java:7: error: ManagementFactory is not available in profile 'compact2'\n ThreadMXBean bean = ManagementFactory.getThreadMXBean();\n                     ^\n2 errors\n\n\n\n\n\n# \n\n\n\n\n# JDEPS\n\njava8profile -p-v-r\n\nimport java.util.Set;\nimport java.util.HashSet;\n\npublic class Deps {\n  public static void main(String[] args) {\n    System.out.println(Math.random());\n    Set<String> set = new HashSet<>();\n  }\n}\n\n\n************** PROFILE ********************\njdeps -P Deps.class \nDeps.class -> /Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/rt.jar\n   <unnamed> (Deps.class)\n      -> java.io                                            compact1\n      -> java.lang                                          compact1\n      -> java.util                                          compact1\n\n************** VERBOSE ********************\njdeps -v Deps.class \nDeps.class -> /Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/rt.jar\n   Deps (Deps.class)\n      -> java.io.PrintStream                                \n      -> java.lang.Math                                     \n      -> java.lang.Object                                   \n      -> java.lang.String                                   \n      -> java.lang.System                                   \n      -> java.util.HashSet  \n\n************** RECURSIVE ********************\njdeps -R Deps.class \nDeps.class -> /Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/rt.jar\n   <unnamed> (Deps.class)\n      -> java.io                                            \n      -> java.lang                                          \n      -> java.util                                          \n/Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/jce.jar -> /Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/rt.jar\n   javax.crypto (jce.jar)\n      -> java.io                                            \n      -> java.lang                                          \n      -> java.lang.reflect                                  \n      -> java.net                                           \n      -> java.nio                                           \n      -> java.security                                      \n      -> java.security.cert                                 \n      -> java.security.spec                                 \n      -> java.util                                          \n      -> java.util.concurrent                               \n      -> java.util.jar                                      \n      -> java.util.regex                                    \n      -> java.util.zip                                      \n      -> javax.security.auth                                \n      -> sun.security.jca                                   JDK internal API (rt.jar)\n      -> sun.security.util                                  JDK internal API (rt.jar)\n      -> sun.security.validator                             JDK internal API (rt.jar)\n   javax.crypto.interfaces (jce.jar)\n      -> java.lang                                          \n      -> java.math                                          \n      -> java.security                                      \n   javax.crypto.spec (jce.jar)\n      -> java.lang                                          \n      -> java.math                                          \n      -> java.security.spec                                 \n      -> java.util                                          \n/Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/rt.jar -> /Library/Java/JavaVirtualMachines/jdk1.8.0.jdk/Contents/Home/jre/lib/jce.jar\n   java.security (rt.jar)\n      -> javax.crypto                                       JDK internal API (jce.jar)\n   sun.security.util (rt.jar)\n      -> javax.crypto                                       JDK internal API (jce.jar)\n      -> javax.crypto.interfaces                            JDK internal API (jce.jar)\n      -> javax.crypto.spec                                  JDK internal API (jce.jar)\n\n\n\n# linuxprofile\n\n$ hg clone http://hg.openjdk.java.net/jdk8/jdk8/\n$ cd jdk8\n$ make images profiles : \n# Finished profiles (build time 00:00:27)\n----- Build times -------\nStart 2013-03-17 14:47:35\nEnd 2013-03-17 14:58:26\n00:00:25 corba\n00:00:15 demos\n00:01:50 hotspot\n00:00:24 images\n00:00:21 jaxp\n00:00:31 jaxws\n00:05:37 jdk\n00:00:43 langtools\n00:00:18 nashorn\n00:00:27 profiles\n00:10:51 TOTAL\n-------------------------\nFinished building Java(TM) for target 'images profiles'\n$ cd images\n$ ls -d *image\nj2re-compact1-image j2re-compact2-image j2re-compact3-image j2re-image j2sdk-image\n\n\n\n# compact\n\n\n\n\n# \n\njavaJREJREjavaoracleraspberry piJRE\n\njava9javaerOSGIosgi",normalizedContent:"# java 8 - jre\n\n> java8 jre: @pdai\n> \n>  * java8 jre?\n>  * ?\n\n * java 8 - jre\n   * jre\n   * \n   * \n     * jdeps\n     * linuxprofile\n     * compact\n   * \n\noraclejava 8javaer18java18java8lambdastream apidate time apijavajavajava8jep161(http://openjdk.java.net/jeps/161 ),java sejavajrejre\n\n\n# jre\n\n * java\n * \n * \n * \n\n\n# \n\njre3compact1compact2compact3compact1<compact2<compact3,api\n\njavacprofile\n\njavac bootclasspath, or javac profile\n\n\ncompactapi\n\n$ javac -profile compact2 test.java\ntest.java:7: error: threadmxbean is not available in profile 'compact2'\n threadmxbean bean = managementfactory.getthreadmxbean();\n ^\ntest.java:7: error: managementfactory is not available in profile 'compact2'\n threadmxbean bean = managementfactory.getthreadmxbean();\n                     ^\n2 errors\n\n\n\n\n\n# \n\n\n\n\n# jdeps\n\njava8profile -p-v-r\n\nimport java.util.set;\nimport java.util.hashset;\n\npublic class deps {\n  public static void main(string[] args) {\n    system.out.println(math.random());\n    set<string> set = new hashset<>();\n  }\n}\n\n\n************** profile ********************\njdeps -p deps.class \ndeps.class -> /library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/rt.jar\n   <unnamed> (deps.class)\n      -> java.io                                            compact1\n      -> java.lang                                          compact1\n      -> java.util                                          compact1\n\n************** verbose ********************\njdeps -v deps.class \ndeps.class -> /library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/rt.jar\n   deps (deps.class)\n      -> java.io.printstream                                \n      -> java.lang.math                                     \n      -> java.lang.object                                   \n      -> java.lang.string                                   \n      -> java.lang.system                                   \n      -> java.util.hashset  \n\n************** recursive ********************\njdeps -r deps.class \ndeps.class -> /library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/rt.jar\n   <unnamed> (deps.class)\n      -> java.io                                            \n      -> java.lang                                          \n      -> java.util                                          \n/library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/jce.jar -> /library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/rt.jar\n   javax.crypto (jce.jar)\n      -> java.io                                            \n      -> java.lang                                          \n      -> java.lang.reflect                                  \n      -> java.net                                           \n      -> java.nio                                           \n      -> java.security                                      \n      -> java.security.cert                                 \n      -> java.security.spec                                 \n      -> java.util                                          \n      -> java.util.concurrent                               \n      -> java.util.jar                                      \n      -> java.util.regex                                    \n      -> java.util.zip                                      \n      -> javax.security.auth                                \n      -> sun.security.jca                                   jdk internal api (rt.jar)\n      -> sun.security.util                                  jdk internal api (rt.jar)\n      -> sun.security.validator                             jdk internal api (rt.jar)\n   javax.crypto.interfaces (jce.jar)\n      -> java.lang                                          \n      -> java.math                                          \n      -> java.security                                      \n   javax.crypto.spec (jce.jar)\n      -> java.lang                                          \n      -> java.math                                          \n      -> java.security.spec                                 \n      -> java.util                                          \n/library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/rt.jar -> /library/java/javavirtualmachines/jdk1.8.0.jdk/contents/home/jre/lib/jce.jar\n   java.security (rt.jar)\n      -> javax.crypto                                       jdk internal api (jce.jar)\n   sun.security.util (rt.jar)\n      -> javax.crypto                                       jdk internal api (jce.jar)\n      -> javax.crypto.interfaces                            jdk internal api (jce.jar)\n      -> javax.crypto.spec                                  jdk internal api (jce.jar)\n\n\n\n# linuxprofile\n\n$ hg clone http://hg.openjdk.java.net/jdk8/jdk8/\n$ cd jdk8\n$ make images profiles : \n# finished profiles (build time 00:00:27)\n----- build times -------\nstart 2013-03-17 14:47:35\nend 2013-03-17 14:58:26\n00:00:25 corba\n00:00:15 demos\n00:01:50 hotspot\n00:00:24 images\n00:00:21 jaxp\n00:00:31 jaxws\n00:05:37 jdk\n00:00:43 langtools\n00:00:18 nashorn\n00:00:27 profiles\n00:10:51 total\n-------------------------\nfinished building java(tm) for target 'images profiles'\n$ cd images\n$ ls -d *image\nj2re-compact1-image j2re-compact2-image j2re-compact3-image j2re-image j2sdk-image\n\n\n\n# compact\n\n\n\n\n# \n\njavajrejrejavaoracleraspberry pijre\n\njava9javaerosgiosgi",charsets:{cjk:!0}},{title:"Java 8 - LocalDate/LocalDateTime",frontmatter:{},regularPath:"/java/java8/java8-localdatetime.html",relativePath:"java/java8/java8-localdatetime.md",key:"v-c5de697c",path:"/java/java8/java8-localdatetime.html",headers:[{level:2,title:"Java 8 - LocalDate/LocalDateTime",slug:"java-8-localdate-localdatetime",normalizedTitle:"java 8 - localdate/localdatetime",charIndex:2},{level:2,title:"Java8Date",slug:"java8date",normalizedTitle:"java8date",charIndex:70},{level:2,title:"Java8",slug:"java8",normalizedTitle:"java8",charIndex:282},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:300},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:311},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:321},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:164},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:343}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - LocalDate/LocalDateTime Java8Date Java8     ",content:'# Java 8 - LocalDate/LocalDateTime\n\n> : @pdai\n> \n>  * Java8Date?\n>  * Java8?\n>  * Java8Java8?\n>  * ?\n\n * Java 8 - LocalDate/LocalDateTime\n   * Java8Date\n     * \n     * \n     * \n     * \n   * Java8\n     * \n     * \n   * \n   * \n   * \n\n\n# Java8Date\n\n> Tiago FernandezJAVA APIEJB2.XAPI\n\n# \n\nDate(? ~)\n\nJDK 1.1 :\n\nCalendar\nDateFormat\nDate\n\n\nDateDateCalendarAPI\n\n# \n\nyearmonth\n\nDate date = new Date(2012,1,1);\nSystem.out.println(date);\nThu Feb 01 00:00:00 CST 3912\n\n\nyear2012+1900month1? (Feb)?\n\n java.util.Calendar\n\nCalendar calendar = Calendar.getInstance();\ncalendar.set(2013, 8, 2);\n\n\ncalendarmonth087\n\ncalendar.set(2013, Calendar.AUGUST, 2);\n\n\nCalendar1900(Date)\n\nCalendarAPIIBM\n\n# \n\njava.util.Datejava.util.Calendar\n\n.\n\npublic static void main(String[] args) {\n    Calendar birth = Calendar.getInstance();\n    birth.set(1975, Calendar.MAY, 26);\n    Calendar now = Calendar.getInstance();\n    System.out.println(daysBetween(birth, now));\n    System.out.println(daysBetween(birth, now)); //  0? \n }  \n\npublic static long daysBetween(Calendar begin, Calendar end) {\n    long daysBetween = 0;\n    while(begin.before(end)) {\n        begin.add(Calendar.DAY_OF_MONTH, 1);\n        daysBetween++;\n    }\n    return daysBetween;\n}\n\n\ndaysBetweenDate0CalendarCalendar\n\npublic static long daysBetween(Calendar begin, Calendar end) {\n    Calendar calendar = (Calendar) begin.clone(); // \n    long daysBetween = 0;\n    while(calendar.before(end)) {\n        calendar.add(Calendar.DAY_OF_MONTH, 1);\n        daysBetween++;\n    }\n    return daysBetween;\n}\n\n\n# \n\nSimpleDateTimeFormat\n\n\n# Java8\n\n\n# \n\nJava 8ISOjava.timeAPIjava.time:\n\n * Instant\n * LocalDate2014-01-14\n * LocalTime\n * LocalDateTime\n * ZonedDateTimeUTC/\n\nZoneOffsetZonedDateTimeFormatter\n\n\n# \n\nAPI:\n\n * of: \n * parse: \n * get: \n * is: true\n * with: setter\n * plus: \n * minus: \n * to: \n * at: : date.atTime(time)\n\n\n# \n\npublic class TimeIntroduction {\n    public static void testClock() throws InterruptedException {\n        //      \n        Clock c1 = Clock.systemUTC(); //UTC( System.currentTimeMillis())  \n        System.out.println(c1.millis()); //(UTC)  \n        Clock c2 = Clock.systemDefaultZone(); //()  \n        Clock c31 = Clock.system(ZoneId.of("Europe/Paris")); //  \n        System.out.println(c31.millis()); //(UTC)  \n        Clock c32 = Clock.system(ZoneId.of("Asia/Shanghai"));//  \n        System.out.println(c32.millis());//(UTC)  \n        Clock c4 = Clock.fixed(Instant.now(), ZoneId.of("Asia/Shanghai"));//  \n        System.out.println(c4.millis());\n        Thread.sleep(1000);\n        System.out.println(c4.millis()); //   \n        Clock c5 = Clock.offset(c1, Duration.ofSeconds(2)); //  \n        System.out.println(c1.millis());\n        System.out.println(c5.millis());\n    }\n    public static void testInstant() {\n        // System.currentTimeMillis()  \n        Instant instant1 = Instant.now();\n        System.out.println(instant1.getEpochSecond());// 1970-01-01 00:00:00 UTC  \n        System.out.println(instant1.toEpochMilli()); //  \n        Clock clock1 = Clock.systemUTC(); //UTC  \n        Instant instant2 = Instant.now(clock1);//  \n        System.out.println(instant2.toEpochMilli());\n        Clock clock2 = Clock.fixed(instant1, ZoneId.systemDefault()); //  \n        Instant instant3 = Instant.now(clock2);//  \n        System.out.println(instant3.toEpochMilli());//equals instant1  \n    }\n    public static void testLocalDateTime() {\n        // Clock.systemDefaultZone() --\x3e ZoneId.systemDefault()  \n        LocalDateTime now = LocalDateTime.now();\n        System.out.println(now);\n\t\t//  \n        LocalDateTime now2 = LocalDateTime.now(ZoneId.of("Europe/Paris"));\n        System.out.println(now2);//  \n\t\t//  \n        Clock clock = Clock.system(ZoneId.of("Asia/Dhaka"));\n        LocalDateTime now3 = LocalDateTime.now(clock);\n        System.out.println(now3);//  \n\t\t// java.util.Date 1900 0  \n\t\t//2013-12-31 23:59  \n\t\t\n        LocalDateTime d1 = LocalDateTime.of(2013, 12, 31, 23, 59);\n\t\t//    \n        LocalDateTime d2 = LocalDateTime.of(2013, 12, 31, 23, 59, 59, 11);\n\t\t// +   \n        Instant instant = Instant.now();\n        LocalDateTime d3 = LocalDateTime.ofInstant(Instant.now(), ZoneId.systemDefault());\n        System.out.println(d3);\n        \n\t\t//String---\x3eLocalDateTime  \n        LocalDateTime d4 = LocalDateTime.parse("2013-12-31T23:59");\n        System.out.println(d4);\n        LocalDateTime d5 = LocalDateTime.parse("2013-12-31T23:59:59.999");//999 999000000  \n        System.out.println(d5);\n        \n\t\t//DateTimeFormatter API     \n        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss");\n        LocalDateTime d6 = LocalDateTime.parse("2013/12/31 23:59:59", formatter);\n        System.out.println(formatter.format(d6));\n        \n\t\t//  \n        System.out.println(d6.getYear());\n        System.out.println(d6.getMonth());\n        System.out.println(d6.getDayOfYear());\n        System.out.println(d6.getDayOfMonth());\n        System.out.println(d6.getDayOfWeek());\n        System.out.println(d6.getHour());\n        System.out.println(d6.getMinute());\n        System.out.println(d6.getSecond());\n        System.out.println(d6.getNano());\n        \n\t\t//  \n        LocalDateTime d7 = d6.minusDays(1);\n        LocalDateTime d8 = d7.plus(1, IsoFields.QUARTER_YEARS);\n\t\t//LocalDate    \n\t\t//LocalTime   \n\t\t//APILocalDateTime  \n\t\t\n\t\t// \n\t\tSystem.out.println(d1.equals(d2));\n\t\t\n\t\t// MonthDay - \n\t\tLocalDate dateOfBirth = LocalDate.of(2010, 01, 14); \n\t\tMonthDay birthday = MonthDay.of(dateOfBirth.getMonth(), dateOfBirth.getDayOfMonth()); \n\t\tMonthDay currentMonthDay = MonthDay.from(today); \n\t\tSystem.out.println(currentMonthDay.equals(birthday));\n\t\t\n\t\t// YearMonth - \n\t\tYearMonth currentYearMonth = YearMonth.now(); System.out.printf("Days in month year %s: %d%n", currentYearMonth, currentYearMonth.lengthOfMonth()); \n\t\tYearMonth creditCardExpiry = YearMonth.of(2018, Month.FEBRUARY); \n\t\tSystem.out.printf("Your credit card expires on %s %n", creditCardExpiry); \n\t\t\n\t\t//  - LocalDateisLeapYear()\n\t\tSystem.out.println(dateOfBirth.isLeapYear());\n    }\n    public static void testZonedDateTime() {\n        //date-time (date-time)  \n\t\t//APILocalDateTime(2013-12-20T10:35:50.711+08:00[Asia/Shanghai])  \n        ZonedDateTime now = ZonedDateTime.now();\n        System.out.println(now);\n        ZonedDateTime now2 = ZonedDateTime.now(ZoneId.of("Europe/Paris"));\n        System.out.println(now2);\n\t\t//   \n        ZonedDateTime z1 = ZonedDateTime.parse("2013-12-31T23:59:59Z[Europe/Paris]");\n        System.out.println(z1);\n    }\n    public static void testDuration() {\n        //  \n        Duration d1 = Duration.between(Instant.ofEpochMilli(System.currentTimeMillis() - 12323123), Instant.now());\n\t\t//  \n        System.out.println(d1.toDays());\n        System.out.println(d1.toHours());\n        System.out.println(d1.toMinutes());\n        System.out.println(d1.toMillis());\n        System.out.println(d1.toNanos());\n\t\t//1 ofHours()  \n        Duration d2 = Duration.ofDays(1);\n        System.out.println(d2.toDays());\n    }\n    public static void testChronology() {\n        //java.util.Calendar  \n        Chronology c = HijrahChronology.INSTANCE;\n        ChronoLocalDateTime d = c.localDateTime(LocalDateTime.now());\n        System.out.println(d);\n    }\n    /**\n     * \n     */\n    public static void testNewOldDateConversion(){\n        Instant instant=new Date().toInstant();\n        Date date=Date.from(instant);\n        System.out.println(instant);\n        System.out.println(date);\n    }\n    public static void main(String[] args) throws InterruptedException {\n        testClock();\n        testInstant();\n        testLocalDateTime();\n        testZonedDateTime();\n        testDuration();\n        testChronology();\n        testNewOldDateConversion();\n    }\n}\n\n\n\n# \n\nAPIAPIAPIJSR310(java8310)Joda-Time\n\njava\n\nArrow: Python \n\nMoment.js: JavaScript \n\nNoda-Time: .NET  Joda-Time \n\n\n# \n\nJava 8APIAPI\n\n * javax.time.ZoneId\n\n * LocalDateLocalTime Java 8APIDateCalendar APIjava.util.DateSimpleDateFormat\n\n * APIISO\n\n * JavaAPI: Instant 2014-01-14T02:20:13.592Zjava.time.Clock: Instant current = Clock.system(ZoneId.of(Asia/Tokyo)).instant(); LocalDate 2014-01-14 LocalTime   LocalDateTime   ZonedDateTime  UTC/\n\n * java.timepackagejava.time.foramtjava.time.temporal\n\n * /(Asia/Tokyo)+09:00 OffsetDateTimeLocalDateTimeZoneOffset(+/-: +06:00 -08: 00)()() DateTimeFormatterJavaSimpleDateFormatDateTimeFormatterparse()DateTimeParseExceptionDateFormatterformat()DateTimeException\n\n * MMM d yyyyMMm dd yyyyJan 2 2014Jan 14 2014Jan 2 20140Jan 2 2014Jan 02 2014',normalizedContent:'# java 8 - localdate/localdatetime\n\n> : @pdai\n> \n>  * java8date?\n>  * java8?\n>  * java8java8?\n>  * ?\n\n * java 8 - localdate/localdatetime\n   * java8date\n     * \n     * \n     * \n     * \n   * java8\n     * \n     * \n   * \n   * \n   * \n\n\n# java8date\n\n> tiago fernandezjava apiejb2.xapi\n\n# \n\ndate(? ~)\n\njdk 1.1 :\n\ncalendar\ndateformat\ndate\n\n\ndatedatecalendarapi\n\n# \n\nyearmonth\n\ndate date = new date(2012,1,1);\nsystem.out.println(date);\nthu feb 01 00:00:00 cst 3912\n\n\nyear2012+1900month1? (feb)?\n\n java.util.calendar\n\ncalendar calendar = calendar.getinstance();\ncalendar.set(2013, 8, 2);\n\n\ncalendarmonth087\n\ncalendar.set(2013, calendar.august, 2);\n\n\ncalendar1900(date)\n\ncalendarapiibm\n\n# \n\njava.util.datejava.util.calendar\n\n.\n\npublic static void main(string[] args) {\n    calendar birth = calendar.getinstance();\n    birth.set(1975, calendar.may, 26);\n    calendar now = calendar.getinstance();\n    system.out.println(daysbetween(birth, now));\n    system.out.println(daysbetween(birth, now)); //  0? \n }  \n\npublic static long daysbetween(calendar begin, calendar end) {\n    long daysbetween = 0;\n    while(begin.before(end)) {\n        begin.add(calendar.day_of_month, 1);\n        daysbetween++;\n    }\n    return daysbetween;\n}\n\n\ndaysbetweendate0calendarcalendar\n\npublic static long daysbetween(calendar begin, calendar end) {\n    calendar calendar = (calendar) begin.clone(); // \n    long daysbetween = 0;\n    while(calendar.before(end)) {\n        calendar.add(calendar.day_of_month, 1);\n        daysbetween++;\n    }\n    return daysbetween;\n}\n\n\n# \n\nsimpledatetimeformat\n\n\n# java8\n\n\n# \n\njava 8isojava.timeapijava.time:\n\n * instant\n * localdate2014-01-14\n * localtime\n * localdatetime\n * zoneddatetimeutc/\n\nzoneoffsetzoneddatetimeformatter\n\n\n# \n\napi:\n\n * of: \n * parse: \n * get: \n * is: true\n * with: setter\n * plus: \n * minus: \n * to: \n * at: : date.attime(time)\n\n\n# \n\npublic class timeintroduction {\n    public static void testclock() throws interruptedexception {\n        //      \n        clock c1 = clock.systemutc(); //utc( system.currenttimemillis())  \n        system.out.println(c1.millis()); //(utc)  \n        clock c2 = clock.systemdefaultzone(); //()  \n        clock c31 = clock.system(zoneid.of("europe/paris")); //  \n        system.out.println(c31.millis()); //(utc)  \n        clock c32 = clock.system(zoneid.of("asia/shanghai"));//  \n        system.out.println(c32.millis());//(utc)  \n        clock c4 = clock.fixed(instant.now(), zoneid.of("asia/shanghai"));//  \n        system.out.println(c4.millis());\n        thread.sleep(1000);\n        system.out.println(c4.millis()); //   \n        clock c5 = clock.offset(c1, duration.ofseconds(2)); //  \n        system.out.println(c1.millis());\n        system.out.println(c5.millis());\n    }\n    public static void testinstant() {\n        // system.currenttimemillis()  \n        instant instant1 = instant.now();\n        system.out.println(instant1.getepochsecond());// 1970-01-01 00:00:00 utc  \n        system.out.println(instant1.toepochmilli()); //  \n        clock clock1 = clock.systemutc(); //utc  \n        instant instant2 = instant.now(clock1);//  \n        system.out.println(instant2.toepochmilli());\n        clock clock2 = clock.fixed(instant1, zoneid.systemdefault()); //  \n        instant instant3 = instant.now(clock2);//  \n        system.out.println(instant3.toepochmilli());//equals instant1  \n    }\n    public static void testlocaldatetime() {\n        // clock.systemdefaultzone() --\x3e zoneid.systemdefault()  \n        localdatetime now = localdatetime.now();\n        system.out.println(now);\n\t\t//  \n        localdatetime now2 = localdatetime.now(zoneid.of("europe/paris"));\n        system.out.println(now2);//  \n\t\t//  \n        clock clock = clock.system(zoneid.of("asia/dhaka"));\n        localdatetime now3 = localdatetime.now(clock);\n        system.out.println(now3);//  \n\t\t// java.util.date 1900 0  \n\t\t//2013-12-31 23:59  \n\t\t\n        localdatetime d1 = localdatetime.of(2013, 12, 31, 23, 59);\n\t\t//    \n        localdatetime d2 = localdatetime.of(2013, 12, 31, 23, 59, 59, 11);\n\t\t// +   \n        instant instant = instant.now();\n        localdatetime d3 = localdatetime.ofinstant(instant.now(), zoneid.systemdefault());\n        system.out.println(d3);\n        \n\t\t//string---\x3elocaldatetime  \n        localdatetime d4 = localdatetime.parse("2013-12-31t23:59");\n        system.out.println(d4);\n        localdatetime d5 = localdatetime.parse("2013-12-31t23:59:59.999");//999 999000000  \n        system.out.println(d5);\n        \n\t\t//datetimeformatter api     \n        datetimeformatter formatter = datetimeformatter.ofpattern("yyyy/mm/dd hh:mm:ss");\n        localdatetime d6 = localdatetime.parse("2013/12/31 23:59:59", formatter);\n        system.out.println(formatter.format(d6));\n        \n\t\t//  \n        system.out.println(d6.getyear());\n        system.out.println(d6.getmonth());\n        system.out.println(d6.getdayofyear());\n        system.out.println(d6.getdayofmonth());\n        system.out.println(d6.getdayofweek());\n        system.out.println(d6.gethour());\n        system.out.println(d6.getminute());\n        system.out.println(d6.getsecond());\n        system.out.println(d6.getnano());\n        \n\t\t//  \n        localdatetime d7 = d6.minusdays(1);\n        localdatetime d8 = d7.plus(1, isofields.quarter_years);\n\t\t//localdate    \n\t\t//localtime   \n\t\t//apilocaldatetime  \n\t\t\n\t\t// \n\t\tsystem.out.println(d1.equals(d2));\n\t\t\n\t\t// monthday - \n\t\tlocaldate dateofbirth = localdate.of(2010, 01, 14); \n\t\tmonthday birthday = monthday.of(dateofbirth.getmonth(), dateofbirth.getdayofmonth()); \n\t\tmonthday currentmonthday = monthday.from(today); \n\t\tsystem.out.println(currentmonthday.equals(birthday));\n\t\t\n\t\t// yearmonth - \n\t\tyearmonth currentyearmonth = yearmonth.now(); system.out.printf("days in month year %s: %d%n", currentyearmonth, currentyearmonth.lengthofmonth()); \n\t\tyearmonth creditcardexpiry = yearmonth.of(2018, month.february); \n\t\tsystem.out.printf("your credit card expires on %s %n", creditcardexpiry); \n\t\t\n\t\t//  - localdateisleapyear()\n\t\tsystem.out.println(dateofbirth.isleapyear());\n    }\n    public static void testzoneddatetime() {\n        //date-time (date-time)  \n\t\t//apilocaldatetime(2013-12-20t10:35:50.711+08:00[asia/shanghai])  \n        zoneddatetime now = zoneddatetime.now();\n        system.out.println(now);\n        zoneddatetime now2 = zoneddatetime.now(zoneid.of("europe/paris"));\n        system.out.println(now2);\n\t\t//   \n        zoneddatetime z1 = zoneddatetime.parse("2013-12-31t23:59:59z[europe/paris]");\n        system.out.println(z1);\n    }\n    public static void testduration() {\n        //  \n        duration d1 = duration.between(instant.ofepochmilli(system.currenttimemillis() - 12323123), instant.now());\n\t\t//  \n        system.out.println(d1.todays());\n        system.out.println(d1.tohours());\n        system.out.println(d1.tominutes());\n        system.out.println(d1.tomillis());\n        system.out.println(d1.tonanos());\n\t\t//1 ofhours()  \n        duration d2 = duration.ofdays(1);\n        system.out.println(d2.todays());\n    }\n    public static void testchronology() {\n        //java.util.calendar  \n        chronology c = hijrahchronology.instance;\n        chronolocaldatetime d = c.localdatetime(localdatetime.now());\n        system.out.println(d);\n    }\n    /**\n     * \n     */\n    public static void testnewolddateconversion(){\n        instant instant=new date().toinstant();\n        date date=date.from(instant);\n        system.out.println(instant);\n        system.out.println(date);\n    }\n    public static void main(string[] args) throws interruptedexception {\n        testclock();\n        testinstant();\n        testlocaldatetime();\n        testzoneddatetime();\n        testduration();\n        testchronology();\n        testnewolddateconversion();\n    }\n}\n\n\n\n# \n\napiapiapijsr310(java8310)joda-time\n\njava\n\narrow: python \n\nmoment.js: javascript \n\nnoda-time: .net  joda-time \n\n\n# \n\njava 8apiapi\n\n * javax.time.zoneid\n\n * localdatelocaltime java 8apidatecalendar apijava.util.datesimpledateformat\n\n * apiiso\n\n * javaapi: instant 2014-01-14t02:20:13.592zjava.time.clock: instant current = clock.system(zoneid.of(asia/tokyo)).instant(); localdate 2014-01-14 localtime   localdatetime   zoneddatetime  utc/\n\n * java.timepackagejava.time.foramtjava.time.temporal\n\n * /(asia/tokyo)+09:00 offsetdatetimelocaldatetimezoneoffset(+/-: +06:00 -08: 00)()() datetimeformatterjavasimpledateformatdatetimeformatterparse()datetimeparseexceptiondateformatterformat()datetimeexception\n\n * mmm d yyyymmm dd yyyyjan 2 2014jan 14 2014jan 2 20140jan 2 2014jan 02 2014',charsets:{cjk:!0}},{title:"Java 8 - Optional",frontmatter:{},regularPath:"/java/java8/java8-optional.html",relativePath:"java/java8/java8-optional.md",key:"v-57df1a48",path:"/java/java8/java8-optional.html",headers:[{level:2,title:"Java 8 - Optional",slug:"java-8-optional",normalizedTitle:"java 8 - optional",charIndex:2},{level:2,title:"Optional",slug:"optional",normalizedTitle:"optional",charIndex:91},{level:3,title:"of",slug:"of",normalizedTitle:"of",charIndex:113},{level:3,title:"ofNullable",slug:"ofnullable",normalizedTitle:"ofnullable",charIndex:123},{level:3,title:"isPresent",slug:"ispresent",normalizedTitle:"ispresent",charIndex:141},{level:3,title:"get",slug:"get",normalizedTitle:"get",charIndex:158},{level:3,title:"ifPresent",slug:"ifpresent",normalizedTitle:"ifpresent",charIndex:169},{level:3,title:"orElse",slug:"orelse",normalizedTitle:"orelse",charIndex:186},{level:3,title:"orElseGet",slug:"orelseget",normalizedTitle:"orelseget",charIndex:200},{level:3,title:"orElseThrow",slug:"orelsethrow",normalizedTitle:"orelsethrow",charIndex:217},{level:3,title:"map",slug:"map",normalizedTitle:"map",charIndex:236},{level:3,title:"flatMap",slug:"flatmap",normalizedTitle:"flatmap",charIndex:247},{level:3,title:"filter",slug:"filter",normalizedTitle:"filter",charIndex:262},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:274},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:284}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - Optional Optional of ofNullable isPresent get ifPresent orElse orElseGet orElseThrow map flatMap filter  ",content:'# Java 8 - Optional\n\n> Java 8 Optional @pdai\n\n * Java 8 - Optional\n   * Optional\n     * of\n     * ofNullable\n     * isPresent\n     * get\n     * ifPresent\n     * orElse\n     * orElseGet\n     * orElseThrow\n     * map\n     * flatMap\n     * filter\n   * \n   * \n\n> Java: nullGuavaAPIJVMScalaCeylonAPIScala\n\nJavaJava 8OptionalOptionalJavadoc:\n\n> nullisPresent()trueget()\n\n\n# Optional\n\n\n# of\n\n> nullOptional\n\nofOptionalnullnullNullPointerException \n\n//Optional\nOptional<String> name = Optional.of("Sanaulla");\n//nullNullPointerException.\nOptional<String> someNull = Optional.of(null);\n\n\n\n# ofNullable\n\n> OptionalnullOptional\n\nofNullableofnull:\n\n//Optional\n//\'null\'\nOptional empty = Optional.ofNullable(null);\n\n\n\n# isPresent\n\n\n\n> truefalse\n\n:\n\n//isPresentOptional\nif (name.isPresent()) {\n  //Optionalget()\n  System.out.println(name.get());//Sanaulla\n}\n\n\n\n# get\n\n> OptionalNoSuchElementException\n\ngetOptionalNoSuchElementException:\n\n//: No value present \ntry {\n  //Optionalget()NoSuchElementException\n  System.out.println(empty.get());\n} catch (NoSuchElementException ex) {\n  System.out.println(ex.getMessage());\n}\n\n\n\n# ifPresent\n\n> Optionalconsumer\n\nifPresentConsumerConsumerJava8lambda\n\nOptionalifPresent()lambda:\n\n//ifPresentlambda\n//lambdaOptionalconsumer\nname.ifPresent((value) -> {\n  System.out.println("The length of the value is: " + value.length());\n});\n\n\n\n# orElse\n\n> \n\nOptionalorElse:\n\n//nullorElseOptional\n//null\n//: There is no value present!\nSystem.out.println(empty.orElse("There is no value present!"));\n//: Sanaulla\nSystem.out.println(name.orElse("There is some value!"));\n\n\n\n# orElseGet\n\n> orElseGetorElseorElseorElseGetSupplier:\n\n//orElseGetorElseorElse\n//orElseGetlambda\n//: Default Value\nSystem.out.println(empty.orElseGet(() -> "Default Value"));\n//: Sanaulla\nSystem.out.println(name.orElseGet(() -> "Default Value"));\n\n\n\n# orElseThrow\n\n> supplier\n\norElseGetSupplierorElseThrowlambda:\n\ntry {\n  //orElseThroworElse\n  //orElseThrowlambda \n\n  empty.orElseThrow(ValueAbsentException::new);\n} catch (Throwable ex) {\n  //: No value present in the Optional instance\n  System.out.println(ex.getMessage());\n}\n\n\nValueAbsentException:\n\nclass ValueAbsentException extends Throwable {\n\n  public ValueAbsentException() {\n    super();\n  }\n\n  public ValueAbsentException(String msg) {\n    super(msg);\n  }\n\n  @Override\n  public String getMessage() {\n    return "No value present in the Optional instance";\n  }\n}\n\n\n\n# map\n\nmap:\n\n> mappingnullmappingOptionalmapOptional\n\nmapOptionalFunctionlambdaFunctionmap:\n\n//maplambdaOptional\n//lambdaOptionalmap\nOptional<String> upperName = name.map((value) -> value.toUpperCase());\nSystem.out.println(upperName.orElse("No value found"));\n\n\n\n# flatMap\n\n> mappingOptionalOptionalflatMapmap(Funtion)flatMapmapperOptionalflatMapOptional\n\nflatMapmapmappingmapmappingTflatMapmappingOptional\n\nmapflatMap:\n\n//flatMapmap(Function)lambda\n//maplambdamapOptional \n//flatMaplambdaOptionl \nupperName = name.flatMap((value) -> Optional.of(value.toUpperCase()));\nSystem.out.println(upperName.orElse("No value found"));//SANAULLA\n\n\n\n# filter\n\nfilterOptional:\n\n> OptionalOptional\n\nfilterlambdafilterPredicatelambdaPredicate\n\nfilter:\n\n//filterOption\n//OptionOptional\nOptional<String> longName = name.filter((value) -> value.length() > 6);\nSystem.out.println(longName.orElse("The name is less than 6 characters"));//Sanaulla\n\n//Optionalfilter\nOptional<String> anotherName = Optional.of("Sana");\nOptional<String> shortName = anotherName.filter((value) -> value.length() > 6);\n//: name6\nSystem.out.println(shortName.orElse("The name is less than 6 characters"));\n\n\n\n# \n\n * \n\npublic class OptionalDemo {\n\n  public static void main(String[] args) {\n    //Optional\n    Optional<String> name = Optional.of("Sanaulla");\n\n    //Optional\'null\'\n    Optional empty = Optional.ofNullable(null);\n\n    //isPresentOptional\n    if (name.isPresent()) {\n      //get()Optional\n      System.out.println(name.get());\n    }\n\n    try {\n      //Optionalget()NoSuchElementException\n      System.out.println(empty.get());\n    } catch (NoSuchElementException ex) {\n      System.out.println(ex.getMessage());\n    }\n\n    //ifPresentlambda\n    //Optionallambda\n    name.ifPresent((value) -> {\n      System.out.println("The length of the value is: " + value.length());\n    });\n\n    //orElseOptional\n    System.out.println(empty.orElse("There is no value present!"));\n    System.out.println(name.orElse("There is some value!"));\n\n    //orElseGetorElse\n    //orElseGetlambda\n    System.out.println(empty.orElseGet(() -> "Default Value"));\n    System.out.println(name.orElseGet(() -> "Default Value"));\n\n    try {\n      //orElseThroworElse\n      //orElseThrowlambda/\n      empty.orElseThrow(ValueAbsentException::new);\n    } catch (Throwable ex) {\n      System.out.println(ex.getMessage());\n    }\n\n    //maplambdaOptonal \n    //lambdaOptional\n    Optional<String> upperName = name.map((value) -> value.toUpperCase());\n    System.out.println(upperName.orElse("No value found"));\n\n    //flatMapmap(Funtion)lambda\n    //maplambdaOptional\n    //flatMaplambdaOptional\n    upperName = name.flatMap((value) -> Optional.of(value.toUpperCase()));\n    System.out.println(upperName.orElse("No value found"));\n\n    //filterOptiona\n    //OptionalOptional\n    Optional<String> longName = name.filter((value) -> value.length() > 6);\n    System.out.println(longName.orElse("The name is less than 6 characters"));\n\n    //Optional\n    Optional<String> anotherName = Optional.of("Sana");\n    Optional<String> shortName = anotherName.filter((value) -> value.length() > 6);\n    System.out.println(shortName.orElse("The name is less than 6 characters"));\n\n  }\n}\n\n\n:\n\nSanaulla\nNo value present\nThe length of the value is: 8\nThere is no value present!\nSanaulla\nDefault Value\nSanaulla\nNo value present in the Optional instance\nSANAULLA\nSANAULLA\nSanaulla\nThe name is less than 6 characters\n\n\n *  Java 8  Null \n\n:\n\nclass Outer {\n    Nested nested;\n    Nested getNested() {\n        return nested;\n    }\n}\nclass Nested {\n    Inner inner;\n    Inner getInner() {\n        return inner;\n    }\n}\nclass Inner {\n    String foo;\n    String getFoo() {\n        return foo;\n    }\n}\n\n\n null  NullPointerException:\n\nOuter outer = new Outer();\nif (outer != null && outer.nested != null && outer.nested.inner != null) {\n    System.out.println(outer.nested.inner.foo);\n}\n\n\n Java 8  Optional  null map  Function  lambda  function  Optional  map Null \n\nOptional.of(new Outer())\n    .map(Outer::getNested)\n    .map(Nested::getInner)\n    .map(Inner::getFoo)\n    .ifPresent(System.out::println);\n\n\n supplier :\n\nOuter obj = new Outer();\nresolve(() -> obj.getNested().getInner().getFoo())\n    .ifPresent(System.out::println);\n\n\n obj.getNested().getInner().getFoo())  NullPointerException  Optional.empty()\n\npublic static <T> Optional<T> resolve(Supplier<T> resolver) {\n    try {\n        T result = resolver.get();\n        return Optional.ofNullable(result);\n    }\n    catch (NullPointerException e) {\n        return Optional.empty();\n    }\n}\n\n\n null \n\n\n# \n\n: javacodegeeks\n\n: ImportNew.com - \n\n: http://www.importnew.com/6675.html\n\n',normalizedContent:'# java 8 - optional\n\n> java 8 optional @pdai\n\n * java 8 - optional\n   * optional\n     * of\n     * ofnullable\n     * ispresent\n     * get\n     * ifpresent\n     * orelse\n     * orelseget\n     * orelsethrow\n     * map\n     * flatmap\n     * filter\n   * \n   * \n\n> java: nullguavaapijvmscalaceylonapiscala\n\njavajava 8optionaloptionaljavadoc:\n\n> nullispresent()trueget()\n\n\n# optional\n\n\n# of\n\n> nulloptional\n\nofoptionalnullnullnullpointerexception \n\n//optional\noptional<string> name = optional.of("sanaulla");\n//nullnullpointerexception.\noptional<string> somenull = optional.of(null);\n\n\n\n# ofnullable\n\n> optionalnulloptional\n\nofnullableofnull:\n\n//optional\n//\'null\'\noptional empty = optional.ofnullable(null);\n\n\n\n# ispresent\n\n\n\n> truefalse\n\n:\n\n//ispresentoptional\nif (name.ispresent()) {\n  //optionalget()\n  system.out.println(name.get());//sanaulla\n}\n\n\n\n# get\n\n> optionalnosuchelementexception\n\ngetoptionalnosuchelementexception:\n\n//: no value present \ntry {\n  //optionalget()nosuchelementexception\n  system.out.println(empty.get());\n} catch (nosuchelementexception ex) {\n  system.out.println(ex.getmessage());\n}\n\n\n\n# ifpresent\n\n> optionalconsumer\n\nifpresentconsumerconsumerjava8lambda\n\noptionalifpresent()lambda:\n\n//ifpresentlambda\n//lambdaoptionalconsumer\nname.ifpresent((value) -> {\n  system.out.println("the length of the value is: " + value.length());\n});\n\n\n\n# orelse\n\n> \n\noptionalorelse:\n\n//nullorelseoptional\n//null\n//: there is no value present!\nsystem.out.println(empty.orelse("there is no value present!"));\n//: sanaulla\nsystem.out.println(name.orelse("there is some value!"));\n\n\n\n# orelseget\n\n> orelsegetorelseorelseorelsegetsupplier:\n\n//orelsegetorelseorelse\n//orelsegetlambda\n//: default value\nsystem.out.println(empty.orelseget(() -> "default value"));\n//: sanaulla\nsystem.out.println(name.orelseget(() -> "default value"));\n\n\n\n# orelsethrow\n\n> supplier\n\norelsegetsupplierorelsethrowlambda:\n\ntry {\n  //orelsethroworelse\n  //orelsethrowlambda \n\n  empty.orelsethrow(valueabsentexception::new);\n} catch (throwable ex) {\n  //: no value present in the optional instance\n  system.out.println(ex.getmessage());\n}\n\n\nvalueabsentexception:\n\nclass valueabsentexception extends throwable {\n\n  public valueabsentexception() {\n    super();\n  }\n\n  public valueabsentexception(string msg) {\n    super(msg);\n  }\n\n  @override\n  public string getmessage() {\n    return "no value present in the optional instance";\n  }\n}\n\n\n\n# map\n\nmap:\n\n> mappingnullmappingoptionalmapoptional\n\nmapoptionalfunctionlambdafunctionmap:\n\n//maplambdaoptional\n//lambdaoptionalmap\noptional<string> uppername = name.map((value) -> value.touppercase());\nsystem.out.println(uppername.orelse("no value found"));\n\n\n\n# flatmap\n\n> mappingoptionaloptionalflatmapmap(funtion)flatmapmapperoptionalflatmapoptional\n\nflatmapmapmappingmapmappingtflatmapmappingoptional\n\nmapflatmap:\n\n//flatmapmap(function)lambda\n//maplambdamapoptional \n//flatmaplambdaoptionl \nuppername = name.flatmap((value) -> optional.of(value.touppercase()));\nsystem.out.println(uppername.orelse("no value found"));//sanaulla\n\n\n\n# filter\n\nfilteroptional:\n\n> optionaloptional\n\nfilterlambdafilterpredicatelambdapredicate\n\nfilter:\n\n//filteroption\n//optionoptional\noptional<string> longname = name.filter((value) -> value.length() > 6);\nsystem.out.println(longname.orelse("the name is less than 6 characters"));//sanaulla\n\n//optionalfilter\noptional<string> anothername = optional.of("sana");\noptional<string> shortname = anothername.filter((value) -> value.length() > 6);\n//: name6\nsystem.out.println(shortname.orelse("the name is less than 6 characters"));\n\n\n\n# \n\n * \n\npublic class optionaldemo {\n\n  public static void main(string[] args) {\n    //optional\n    optional<string> name = optional.of("sanaulla");\n\n    //optional\'null\'\n    optional empty = optional.ofnullable(null);\n\n    //ispresentoptional\n    if (name.ispresent()) {\n      //get()optional\n      system.out.println(name.get());\n    }\n\n    try {\n      //optionalget()nosuchelementexception\n      system.out.println(empty.get());\n    } catch (nosuchelementexception ex) {\n      system.out.println(ex.getmessage());\n    }\n\n    //ifpresentlambda\n    //optionallambda\n    name.ifpresent((value) -> {\n      system.out.println("the length of the value is: " + value.length());\n    });\n\n    //orelseoptional\n    system.out.println(empty.orelse("there is no value present!"));\n    system.out.println(name.orelse("there is some value!"));\n\n    //orelsegetorelse\n    //orelsegetlambda\n    system.out.println(empty.orelseget(() -> "default value"));\n    system.out.println(name.orelseget(() -> "default value"));\n\n    try {\n      //orelsethroworelse\n      //orelsethrowlambda/\n      empty.orelsethrow(valueabsentexception::new);\n    } catch (throwable ex) {\n      system.out.println(ex.getmessage());\n    }\n\n    //maplambdaoptonal \n    //lambdaoptional\n    optional<string> uppername = name.map((value) -> value.touppercase());\n    system.out.println(uppername.orelse("no value found"));\n\n    //flatmapmap(funtion)lambda\n    //maplambdaoptional\n    //flatmaplambdaoptional\n    uppername = name.flatmap((value) -> optional.of(value.touppercase()));\n    system.out.println(uppername.orelse("no value found"));\n\n    //filteroptiona\n    //optionaloptional\n    optional<string> longname = name.filter((value) -> value.length() > 6);\n    system.out.println(longname.orelse("the name is less than 6 characters"));\n\n    //optional\n    optional<string> anothername = optional.of("sana");\n    optional<string> shortname = anothername.filter((value) -> value.length() > 6);\n    system.out.println(shortname.orelse("the name is less than 6 characters"));\n\n  }\n}\n\n\n:\n\nsanaulla\nno value present\nthe length of the value is: 8\nthere is no value present!\nsanaulla\ndefault value\nsanaulla\nno value present in the optional instance\nsanaulla\nsanaulla\nsanaulla\nthe name is less than 6 characters\n\n\n *  java 8  null \n\n:\n\nclass outer {\n    nested nested;\n    nested getnested() {\n        return nested;\n    }\n}\nclass nested {\n    inner inner;\n    inner getinner() {\n        return inner;\n    }\n}\nclass inner {\n    string foo;\n    string getfoo() {\n        return foo;\n    }\n}\n\n\n null  nullpointerexception:\n\nouter outer = new outer();\nif (outer != null && outer.nested != null && outer.nested.inner != null) {\n    system.out.println(outer.nested.inner.foo);\n}\n\n\n java 8  optional  null map  function  lambda  function  optional  map null \n\noptional.of(new outer())\n    .map(outer::getnested)\n    .map(nested::getinner)\n    .map(inner::getfoo)\n    .ifpresent(system.out::println);\n\n\n supplier :\n\nouter obj = new outer();\nresolve(() -> obj.getnested().getinner().getfoo())\n    .ifpresent(system.out::println);\n\n\n obj.getnested().getinner().getfoo())  nullpointerexception  optional.empty()\n\npublic static <t> optional<t> resolve(supplier<t> resolver) {\n    try {\n        t result = resolver.get();\n        return optional.ofnullable(result);\n    }\n    catch (nullpointerexception e) {\n        return optional.empty();\n    }\n}\n\n\n null \n\n\n# \n\n: javacodegeeks\n\n: importnew.com - \n\n: http://www.importnew.com/6675.html\n\n',charsets:{cjk:!0}},{title:"Java 8 - Permgen",frontmatter:{},regularPath:"/java/java8/java8-permgen.html",relativePath:"java/java8/java8-permgen.md",key:"v-08deb28e",path:"/java/java8/java8-permgen.html",headers:[{level:2,title:"Java 8 - Permgen",slug:"java-8-permgen",normalizedTitle:"java 8 - permgen",charIndex:2},{level:2,title:"PermGen space",slug:"permgen-space",normalizedTitle:"permgen space",charIndex:98},{level:2,title:"(MetaSpace)",slug:"-metaspace-",normalizedTitle:"(metaspace)",charIndex:121},{level:2,title:"PermGen vs. Metaspace ",slug:"permgen-vs-metaspace-",normalizedTitle:"permgen vs. metaspace ",charIndex:151},{level:3,title:"JDK 1.7 @64-bit  PermGen ",slug:"jdk-1-7-64-bit-permgen-",normalizedTitle:"jdk 1.7 @64-bit  permgen ",charIndex:186},{level:3,title:"JDK 1.8 @64-bit  Metaspace",slug:"jdk-1-8-64-bit-metaspace",normalizedTitle:"jdk 1.8 @64-bit  metaspace",charIndex:224},{level:3,title:"JDK 1.8 @64-bit  Metaspace ",slug:"jdk-1-8-64-bit-metaspace-",normalizedTitle:"jdk 1.8 @64-bit  metaspace ",charIndex:267},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:305},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:313}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - Permgen PermGen space (MetaSpace) PermGen vs. Metaspace  JDK 1.7 @64-bit  PermGen  JDK 1.8 @64-bit  Metaspace JDK 1.8 @64-bit  Metaspace   ",content:'# Java 8 - Permgen\n\n> PermGen spaceJava 8 - Permgen@pdai\n\n * Java 8 - Permgen\n   * PermGen space\n   * (MetaSpace)\n   * PermGen vs. Metaspace \n     * JDK 1.7 @64-bit  PermGen \n     * JDK 1.8 @64-bit  Metaspace\n     * JDK 1.8 @64-bit  Metaspace \n   * \n   * \n\n> java.lang.OutOfMemoryError: PermGen space256MB\n\n\n# PermGen space\n\nPermGen spacePermanent Generation space,: ClassMeta,Class LoadPermGen spaceInstanceHeap,APPLOADCLASS,PermGen spacewebJSPpre compile\n\nJVM  Oralce-Sun Hotspot, Oralce JRockit, IBM J9, Taobao JVM()HotspotPermGen spaceOracle-Sun HotspotJRockitJ9\n\n\n# (MetaSpace)\n\nJDK8 HotSpot JVM : (Metaspace)Oracle JRockit IBM JVMs\n\n\n\njava.lang.OutOfMemoryError: PermGen\n\njava8metaspace:\n\n * PermGen \n\n\n\nJVM: PermSize  MaxPermSize ()\n\n * Metaspace \n\n\n\nklasses\n\n * Metaspace \n\n(3264)\n\n(MaxMetaspaceSize)\n\n * Metaspace \n\nMaxMetaspaceSize\n\n\n\n * Java \n\nJavaJDK8Java \n\n * Metaspace \n\nHotSpot1.8GC\n\nJstat  JVisualVMb75PermGen\n\n\n\n\n# PermGen vs. Metaspace \n\nMetaspace\n\n:\n\n * JDK1.7Java85MBPermGen\n * JDK1.8JavaMetaspace\n * JDK1.8JavaMaxMetaspaceSize128MBMetaspace\n\nPermGen OOM\n\npublic class ClassA {\n public void method(String name) {\n  // do nothing\n }\n}\n\n\nClassAclassD: /classesURLClassLoaderclass\n\n/**\n * PermGen OOM\n * @author benhail\n */\npublic class OOMTest {\n    public static void main(String[] args) {\n        try {\n            //url\n            URL url = new File("D:/classes").toURI().toURL();\n            URL[] urls = {url};\n            //JMX\n            ClassLoadingMXBean loadingBean = ManagementFactory.getClassLoadingMXBean();\n            //\n            List<ClassLoader> classLoaders = new ArrayList<ClassLoader>();\n            while (true) {\n                //\n                ClassLoader classLoader = new URLClassLoader(urls);\n                classLoaders.add(classLoader);\n                classLoader.loadClass("ClassA");\n                //()\n                System.out.println("total: " + loadingBean.getTotalLoadedClassCount());\n                System.out.println("active: " + loadingBean.getLoadedClassCount());\n                System.out.println("unloaded: " + loadingBean.getUnloadedClassCount());\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n: -verbose -verbose:gc\n\n-verbose\n\n-verbose:gc\n\n\n# JDK 1.7 @64-bit  PermGen \n\nJava1.7PermGen85 MB(-XX:MaxPermSize=XXXm)\n\n\n\nJVisualVM: 6PermGenGC\n\n()\n\n......\n[Loaded ClassA from file:/D:/classes/]\ntotal: 64887\nactive: 64887\nunloaded: 0\n[GC 245041K->213978K(536768K), 0.0597188 secs]\n[Full GC 213978K->211425K(644992K), 0.6456638 secs]\n[GC 211425K->211425K(656448K), 0.0086696 secs]\n[Full GC 211425K->211411K(731008K), 0.6924754 secs]\n[GC 211411K->211411K(726528K), 0.0088992 secs]\n...............\njava.lang.OutOfMemoryError: PermGen space\n\n\n\n# JDK 1.8 @64-bit  Metaspace\n\nJavaMetaspace:  ()\n\n\n\nJVM Metaspace20MB646MBJVMJVMMetaspace10OOM\n\n\n# JDK 1.8 @64-bit  Metaspace \n\nJavaMetaspace: 128MB(-XX:MaxMetaspaceSize=128m)\n\n\n\nJVisualVM: 2MetaspaceJDK1.7GC\n\nJava\n\n[Loaded ClassA from file:/D:/classes/]\ntotal: 21393\nactive: 21393\nunloaded: 0\n[GC (Metadata GC Threshold) 64306K->57010K(111616K), 0.0145502 secs]\n[Full GC (Metadata GC Threshold) 57010K->56810K(122368K), 0.1068084 secs]\njava.lang.OutOfMemoryError: Metaspace\n\n\nMaxMetaspaceSizejava.lang.OutOfMemoryError: Metadata spaceJavaMaxPermSize\n\n\n# \n\n * JVMJVMJVMJVM\n\n * Full GCFull GCMetadataMetadata pointers\n\n * OOMTestmetaspace\n\n\n# \n\nhttps://wizardforcel.gitbooks.io/java8-new-features/content/9.html',normalizedContent:'# java 8 - permgen\n\n> permgen spacejava 8 - permgen@pdai\n\n * java 8 - permgen\n   * permgen space\n   * (metaspace)\n   * permgen vs. metaspace \n     * jdk 1.7 @64-bit  permgen \n     * jdk 1.8 @64-bit  metaspace\n     * jdk 1.8 @64-bit  metaspace \n   * \n   * \n\n> java.lang.outofmemoryerror: permgen space256mb\n\n\n# permgen space\n\npermgen spacepermanent generation space,: classmeta,class loadpermgen spaceinstanceheap,apploadclass,permgen spacewebjsppre compile\n\njvm  oralce-sun hotspot, oralce jrockit, ibm j9, taobao jvm()hotspotpermgen spaceoracle-sun hotspotjrockitj9\n\n\n# (metaspace)\n\njdk8 hotspot jvm : (metaspace)oracle jrockit ibm jvms\n\n\n\njava.lang.outofmemoryerror: permgen\n\njava8metaspace:\n\n * permgen \n\n\n\njvm: permsize  maxpermsize ()\n\n * metaspace \n\n\n\nklasses\n\n * metaspace \n\n(3264)\n\n(maxmetaspacesize)\n\n * metaspace \n\nmaxmetaspacesize\n\n\n\n * java \n\njavajdk8java \n\n * metaspace \n\nhotspot1.8gc\n\njstat  jvisualvmb75permgen\n\n\n\n\n# permgen vs. metaspace \n\nmetaspace\n\n:\n\n * jdk1.7java85mbpermgen\n * jdk1.8javametaspace\n * jdk1.8javamaxmetaspacesize128mbmetaspace\n\npermgen oom\n\npublic class classa {\n public void method(string name) {\n  // do nothing\n }\n}\n\n\nclassaclassd: /classesurlclassloaderclass\n\n/**\n * permgen oom\n * @author benhail\n */\npublic class oomtest {\n    public static void main(string[] args) {\n        try {\n            //url\n            url url = new file("d:/classes").touri().tourl();\n            url[] urls = {url};\n            //jmx\n            classloadingmxbean loadingbean = managementfactory.getclassloadingmxbean();\n            //\n            list<classloader> classloaders = new arraylist<classloader>();\n            while (true) {\n                //\n                classloader classloader = new urlclassloader(urls);\n                classloaders.add(classloader);\n                classloader.loadclass("classa");\n                //()\n                system.out.println("total: " + loadingbean.gettotalloadedclasscount());\n                system.out.println("active: " + loadingbean.getloadedclasscount());\n                system.out.println("unloaded: " + loadingbean.getunloadedclasscount());\n            }\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\n: -verbose -verbose:gc\n\n-verbose\n\n-verbose:gc\n\n\n# jdk 1.7 @64-bit  permgen \n\njava1.7permgen85 mb(-xx:maxpermsize=xxxm)\n\n\n\njvisualvm: 6permgengc\n\n()\n\n......\n[loaded classa from file:/d:/classes/]\ntotal: 64887\nactive: 64887\nunloaded: 0\n[gc 245041k->213978k(536768k), 0.0597188 secs]\n[full gc 213978k->211425k(644992k), 0.6456638 secs]\n[gc 211425k->211425k(656448k), 0.0086696 secs]\n[full gc 211425k->211411k(731008k), 0.6924754 secs]\n[gc 211411k->211411k(726528k), 0.0088992 secs]\n...............\njava.lang.outofmemoryerror: permgen space\n\n\n\n# jdk 1.8 @64-bit  metaspace\n\njavametaspace:  ()\n\n\n\njvm metaspace20mb646mbjvmjvmmetaspace10oom\n\n\n# jdk 1.8 @64-bit  metaspace \n\njavametaspace: 128mb(-xx:maxmetaspacesize=128m)\n\n\n\njvisualvm: 2metaspacejdk1.7gc\n\njava\n\n[loaded classa from file:/d:/classes/]\ntotal: 21393\nactive: 21393\nunloaded: 0\n[gc (metadata gc threshold) 64306k->57010k(111616k), 0.0145502 secs]\n[full gc (metadata gc threshold) 57010k->56810k(122368k), 0.1068084 secs]\njava.lang.outofmemoryerror: metaspace\n\n\nmaxmetaspacesizejava.lang.outofmemoryerror: metadata spacejavamaxpermsize\n\n\n# \n\n * jvmjvmjvmjvm\n\n * full gcfull gcmetadatametadata pointers\n\n * oomtestmetaspace\n\n\n# \n\nhttps://wizardforcel.gitbooks.io/java8-new-features/content/9.html',charsets:{cjk:!0}},{title:"Java 8 - StampedLock",frontmatter:{},regularPath:"/java/java8/java8-stampedlock.html",relativePath:"java/java8/java8-stampedlock.md",key:"v-f4a06f18",path:"/java/java8/java8-stampedlock.html",headers:[{level:2,title:"Java 8 - StampedLock",slug:"java-8-stampedlock",normalizedTitle:"java 8 - stampedlock",charIndex:2},{level:2,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:30},{level:2,title:"Lock",slug:"lock",normalizedTitle:"lock",charIndex:18},{level:2,title:"StampedLock",slug:"stampedlock",normalizedTitle:"stampedlock",charIndex:11},{level:2,title:"StampedLockReadWriteLock",slug:"stampedlockreadwritelock",normalizedTitle:"stampedlockreadwritelock",charIndex:176},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:211},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:219}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - StampedLock synchronized Lock StampedLock StampedLockReadWriteLock  ",content:"# Java 8 - StampedLock\n\n> synchronizedLockJava8StampedLockStampedLock@pdai\n\n * Java 8 - StampedLock\n   * synchronized\n   * Lock\n   * StampedLock\n   * StampedLockReadWriteLock\n   * \n   * \n\n\n# synchronized\n\njava5synchronizedJava\n\n:\n\n\n\n\n\n\n\n\n\nsynchronized(this)\n// do operation\n}\n\n\n: SynchronizedJava SE1.6Synchronized\n\n\n# Lock\n\nrwlock.writeLock().lock();\ntry {\n\t// do operation\n} finally {\n\trwlock.writeLock().unlock();\n}\n\n\nJava 5java.util.concurrent.locksAPI\n\nLocklock()unlock()tryLock()ReentrantLock, ReentrantReadWriteLock.ReadLock, ReentrantReadWriteLock.WriteLock\n\nReentrantReadWriteLock, ReentrantLock synchronized\n\nsynchronizedLockJavajavaJVMLocksynchronized lockunLock()finally{}\n\nLock\n\nclass Point {\n   private double x, y;\n   private final StampedLock sl = new StampedLock();\n   void move(double deltaX, double deltaY) { // an exclusively locked method\n     long stamp = sl.writeLock();\n     try {\n       x += deltaX;\n       y += deltaY;\n     } finally {\n       sl.unlockWrite(stamp);\n     }\n   }\n  \t//\n   double distanceFromOrigin() { // A read-only method\n     long stamp = sl.tryOptimisticRead(); //\n     double currentX = x, currentY = y; //\n     if (!sl.validate(stamp)) { //? \n        stamp = sl.readLock(); //\n        try {\n          currentX = x; // \n          currentY = y; // \n        } finally {\n           sl.unlockRead(stamp);\n        }\n     }\n     return Math.sqrt(currentX * currentX + currentY * currentY);\n   }\n\t//\n   void moveIfAtOrigin(double newX, double newY) { // upgrade\n     // Could instead start with optimistic, not read mode\n     long stamp = sl.readLock();\n     try {\n       while (x == 0.0 && y == 0.0) { //\n         long ws = sl.tryConvertToWriteLock(stamp); //\n         if (ws != 0L) { //\n           stamp = ws; // \n           x = newX; //\n           y = newY; //\n           break;\n         }\n         else { //\n           sl.unlockRead(stamp); //\n           stamp = sl.writeLock(); // \n         }\n       }\n     } finally {\n       sl.unlock(stamp); //\n     }\n   }\n }\n\n\n: synchronizedsynchronized\n\n\n# StampedLock\n\njava8java.util.concurrent.locksAPI\n\nReentrantReadWriteLock (Pessimistic Reading)ReentrantReadWriteLock \n\n ReentrantReadWriteLock (Starvation)\n\nStampedLock()StampedLockstamp0\n\n() \n\njava docStampedLock\n\nclass Point {\n   private double x, y;\n   private final StampedLock sl = new StampedLock();\n   void move(double deltaX, double deltaY) { // an exclusively locked method\n     long stamp = sl.writeLock();\n     try {\n       x += deltaX;\n       y += deltaY;\n     } finally {\n       sl.unlockWrite(stamp);\n     }\n   }\n  //\n   double distanceFromOrigin() { // A read-only method\n     long stamp = sl.tryOptimisticRead(); //\n     double currentX = x, currentY = y; //\n     if (!sl.validate(stamp)) { //? \n        stamp = sl.readLock(); //\n        try {\n          currentX = x; // \n          currentY = y; // \n        } finally {\n           sl.unlockRead(stamp);\n        }\n     }\n     return Math.sqrt(currentX * currentX + currentY * currentY);\n   }\n\t//\n   void moveIfAtOrigin(double newX, double newY) { // upgrade\n     // Could instead start with optimistic, not read mode\n     long stamp = sl.readLock();\n     try {\n       while (x == 0.0 && y == 0.0) { //\n         long ws = sl.tryConvertToWriteLock(stamp); //\n         if (ws != 0L) { //\n           stamp = ws; // \n           x = newX; //\n           y = newY; //\n           break;\n         }\n         else { //\n           sl.unlockRead(stamp); //\n           stamp = sl.writeLock(); // \n         }\n       }\n     } finally {\n       sl.unlock(stamp); //\n     }\n   }\n }\n\n\n:\n\nStampedLockReentrantReadWriteLock\n\n\n# StampedLockReadWriteLock\n\nReadWritLock41\n\n10:\n\n\n\n\n# \n\n * synchronizedJVMsynchronizedJVM\n * ReentrantLockReentrantReadWriteLock,StampedLockunLock()finally{}\n * StampedLock \n * StampedLockAPI;\n * synchronized;\n * ReentrantLock;\n\nStampedLock LockLockAPIStampedLock\n\n\n# \n\n * https://wizardforcel.gitbooks.io/java8-tutorials/content/Java%208%20%E5%B9%B6%E5%8F%91%E6%95%99%E7%A8%8B%20Threads%20%E5%92%8C%20Executors.html\n\n * https://wizardforcel.gitbooks.io/java8-new-features/content/10.html",normalizedContent:"# java 8 - stampedlock\n\n> synchronizedlockjava8stampedlockstampedlock@pdai\n\n * java 8 - stampedlock\n   * synchronized\n   * lock\n   * stampedlock\n   * stampedlockreadwritelock\n   * \n   * \n\n\n# synchronized\n\njava5synchronizedjava\n\n:\n\n\n\n\n\n\n\n\n\nsynchronized(this)\n// do operation\n}\n\n\n: synchronizedjava se1.6synchronized\n\n\n# lock\n\nrwlock.writelock().lock();\ntry {\n\t// do operation\n} finally {\n\trwlock.writelock().unlock();\n}\n\n\njava 5java.util.concurrent.locksapi\n\nlocklock()unlock()trylock()reentrantlock, reentrantreadwritelock.readlock, reentrantreadwritelock.writelock\n\nreentrantreadwritelock, reentrantlock synchronized\n\nsynchronizedlockjavajavajvmlocksynchronized lockunlock()finally{}\n\nlock\n\nclass point {\n   private double x, y;\n   private final stampedlock sl = new stampedlock();\n   void move(double deltax, double deltay) { // an exclusively locked method\n     long stamp = sl.writelock();\n     try {\n       x += deltax;\n       y += deltay;\n     } finally {\n       sl.unlockwrite(stamp);\n     }\n   }\n  \t//\n   double distancefromorigin() { // a read-only method\n     long stamp = sl.tryoptimisticread(); //\n     double currentx = x, currenty = y; //\n     if (!sl.validate(stamp)) { //? \n        stamp = sl.readlock(); //\n        try {\n          currentx = x; // \n          currenty = y; // \n        } finally {\n           sl.unlockread(stamp);\n        }\n     }\n     return math.sqrt(currentx * currentx + currenty * currenty);\n   }\n\t//\n   void moveifatorigin(double newx, double newy) { // upgrade\n     // could instead start with optimistic, not read mode\n     long stamp = sl.readlock();\n     try {\n       while (x == 0.0 && y == 0.0) { //\n         long ws = sl.tryconverttowritelock(stamp); //\n         if (ws != 0l) { //\n           stamp = ws; // \n           x = newx; //\n           y = newy; //\n           break;\n         }\n         else { //\n           sl.unlockread(stamp); //\n           stamp = sl.writelock(); // \n         }\n       }\n     } finally {\n       sl.unlock(stamp); //\n     }\n   }\n }\n\n\n: synchronizedsynchronized\n\n\n# stampedlock\n\njava8java.util.concurrent.locksapi\n\nreentrantreadwritelock (pessimistic reading)reentrantreadwritelock \n\n reentrantreadwritelock (starvation)\n\nstampedlock()stampedlockstamp0\n\n() \n\njava docstampedlock\n\nclass point {\n   private double x, y;\n   private final stampedlock sl = new stampedlock();\n   void move(double deltax, double deltay) { // an exclusively locked method\n     long stamp = sl.writelock();\n     try {\n       x += deltax;\n       y += deltay;\n     } finally {\n       sl.unlockwrite(stamp);\n     }\n   }\n  //\n   double distancefromorigin() { // a read-only method\n     long stamp = sl.tryoptimisticread(); //\n     double currentx = x, currenty = y; //\n     if (!sl.validate(stamp)) { //? \n        stamp = sl.readlock(); //\n        try {\n          currentx = x; // \n          currenty = y; // \n        } finally {\n           sl.unlockread(stamp);\n        }\n     }\n     return math.sqrt(currentx * currentx + currenty * currenty);\n   }\n\t//\n   void moveifatorigin(double newx, double newy) { // upgrade\n     // could instead start with optimistic, not read mode\n     long stamp = sl.readlock();\n     try {\n       while (x == 0.0 && y == 0.0) { //\n         long ws = sl.tryconverttowritelock(stamp); //\n         if (ws != 0l) { //\n           stamp = ws; // \n           x = newx; //\n           y = newy; //\n           break;\n         }\n         else { //\n           sl.unlockread(stamp); //\n           stamp = sl.writelock(); // \n         }\n       }\n     } finally {\n       sl.unlock(stamp); //\n     }\n   }\n }\n\n\n:\n\nstampedlockreentrantreadwritelock\n\n\n# stampedlockreadwritelock\n\nreadwritlock41\n\n10:\n\n\n\n\n# \n\n * synchronizedjvmsynchronizedjvm\n * reentrantlockreentrantreadwritelock,stampedlockunlock()finally{}\n * stampedlock \n * stampedlockapi;\n * synchronized;\n * reentrantlock;\n\nstampedlock locklockapistampedlock\n\n\n# \n\n * https://wizardforcel.gitbooks.io/java8-tutorials/content/java%208%20%e5%b9%b6%e5%8f%91%e6%95%99%e7%a8%8b%20threads%20%e5%92%8c%20executors.html\n\n * https://wizardforcel.gitbooks.io/java8-new-features/content/10.html",charsets:{cjk:!0}},{title:"Java 8 - : base64,...",frontmatter:{},regularPath:"/java/java8/java8-others.html",relativePath:"java/java8/java8-others.md",key:"v-3a16cf30",path:"/java/java8/java8-others.html",headers:[{level:2,title:"Java 8 - : base64,...",slug:"java-8---base64",normalizedTitle:"java 8 - : base64,...",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:156},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:166},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:176},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:186},{level:2,title:"java.util.Random",slug:"java-util-random",normalizedTitle:"java.util.random",charIndex:196},{level:2,title:"java.util.Base64",slug:"java-util-base64",normalizedTitle:"java.util.base64",charIndex:218},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:240}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 - : base64,...     java.util.Random java.util.Base64 ",content:'# Java 8 - : base64,...\n\n> Java 8 @pdai https://www.pdai.tech/md/java/java8/java8-others.html\n\n * Java 8 - : base64,...\n   * \n   * \n   * \n   * \n   * java.util.Random\n   * java.util.Base64\n   * \n\n\n# \n\nJava8JavaInteger:\n\nint2 ** 32Java(01)02 ** 31 - 1\n\nInteger.MAX_VALUE:\n\nSystem.out.println(Integer.MAX_VALUE);      // 2147483647\nSystem.out.println(Integer.MAX_VALUE + 1);  // -2147483648\n\n\nJava8:\n\nlong maxUnsignedInt = (1l << 32) - 1;\nString string = String.valueOf(maxUnsignedInt);\nint unsignedInt = Integer.parseUnsignedInt(string, 10);\nString string2 = Integer.toUnsignedString(unsignedInt, 10);\n\n\n2 ** 32 - 1\n\nparseInt:\n\ntry {\n    Integer.parseInt(string, 10);\n}\ncatch (NumberFormatException e) {\n    System.err.println("could not parse signed int of " + maxUnsignedInt);\n}\n\n\n2 ** 31 - 1 \n\nMath? ?\n\nSystem.out.println(Integer.MAX_VALUE);      // 2147483647\nSystem.out.println(Integer.MAX_VALUE + 1);  // -2147483648\n\n\n\n\nJava8MathexactaddExactArithmeticException\n\ntry {\n    Math.addExact(Integer.MAX_VALUE, 1);\n}\ncatch (ArithmeticException e) {\n    System.err.println(e.getMessage());\n    // => integer overflow\n}\n\n\ntoIntExact:\n\ntry {\n    Math.toIntExact(Long.MAX_VALUE);\n}\ncatch (ArithmeticException e) {\n    System.err.println(e.getMessage());\n    // => integer overflow\n}\n\n\n\n# \n\nFilesJava7NIOJDK8 API \n\nFiles.listfiltersorted\n\ntry (Stream<Path> stream = Files.list(Paths.get(""))) {\n    String joined = stream\n        .map(String::valueOf)\n        .filter(path -> !path.startsWith("."))\n        .sorted()\n        .collect(Collectors.joining("; "));\n    System.out.println("List: " + joined);\n}\n\n\nJava8\n\ntry-withAutoCloseableIO\n\n> DirectoryStreamtry-withclose\n\n\n# \n\n:\n\nPath start = Paths.get("");\nint maxDepth = 5;\ntry (Stream<Path> stream = Files.find(start, maxDepth, (path, attr) ->\n        String.valueOf(path).endsWith(".js"))) {\n    String joined = stream\n        .sorted()\n        .map(String::valueOf)\n        .collect(Collectors.joining("; "));\n    System.out.println("Found: " + joined);\n}\n\n\nfind: startmaxDepthJavaScirpt(.js)\n\nFiles.walk\n\nPath start = Paths.get("");\nint maxDepth = 5;\ntry (Stream<Path> stream = Files.walk(start, maxDepth)) {\n    String joined = stream\n        .map(String::valueOf)\n        .filter(path -> path.endsWith(".js"))\n        .sorted()\n        .collect(Collectors.joining("; "));\n    System.out.println("walk(): " + joined);\n}\n\n\nfilter\n\n\n# \n\nJava 8 Files.readAllLinesFiles.write:\n\nList<String> lines = Files.readAllLines(Paths.get("res/nashorn1.js"));\nlines.add("print(\'foobar\');");\nFiles.write(Paths.get("res/nashorn1-modified.js"), lines);\n\n\n\n\nFiles.lines\n\ntry (Stream<String> stream = Files.lines(Paths.get("res/nashorn1.js"))) {\n    stream\n        .filter(line -> line.contains("print"))\n        .map(String::trim)\n        .forEach(System.out::println);\n}\n\n\nBufferedReader:\n\nPath path = Paths.get("res/nashorn1.js");\ntry (BufferedReader reader = Files.newBufferedReader(path)) {\n    System.out.println(reader.readLine());\n}\n\n\nBufferedWriter:\n\nPath path = Paths.get("res/output.js");\ntry (BufferedWriter writer = Files.newBufferedWriter(path)) {\n    writer.write("print(\'Hello World\');");\n}\n\n\nBufferedReaderlines:\n\nPath path = Paths.get("res/nashorn1.js");\ntry (BufferedReader reader = Files.newBufferedReader(path)) {\n    long countPrints = reader\n        .lines()\n        .filter(line -> line.contains("print"))\n        .count();\n    System.out.println(countPrints);\n}\n\n\nJava8\n\ntry-withcountcollect\n\n\n# java.util.Random\n\nJava8java.util.Random(random Stream of numbers)\n\ndouble0(0)1(1)\n\nRandom random = new Random();\nDoubleStream doubleStream = random.doubles();\n\n\nint0(0)100(100)\n\nRandom random = new Random();\nIntStream intStream = random.ints(0, 100);\n\n\n? (limited)\n\n1: 10:\n\nintStream.limit(10).forEach(System.out::println);\n\n\n2: 100:\n\n    List<Integer> randomBetween0And99 = intStream\n                                       .limit(100)\n                                       .boxed()\n                                       .collect(Collectors.toList());\n\n\n(gaussian pseudo-random values)random.doubles()java8\n\nRandom random = new Random();\nDoubleStream gaussianStream = Stream.generate(random::nextGaussian).mapToDouble(e -> e);\n\n\nStream.generate apiSupplier Random nextGaussian()\n\ndoubledouble: doubledouble\n\njava8api:\n\nRandom random = new Random();\nDoubleStream doubleStream = random.doubles(-1.0, 1.0);\nLinkedHashMap<Range, Integer> rangeCountMap = doubleStream.limit(1000000)\n    .boxed()\n    .map(Ranges::of)\n    .collect(Ranges::emptyRangeCountMap, (m, e) -> m.put(e, m.get(e) + 1), Ranges::mergeRangeCountMaps);\n\nrangeCountMap.forEach((k, v) -> System.out.println(k.from() + "\\t" + v));\n\n\n:\n\n    -1      49730\n    -0.9    49931\n    -0.8    50057\n    -0.7    50060\n    -0.6    49963\n    -0.5    50159\n    -0.4    49921\n    -0.3    49962\n    -0.2    50231\n    -0.1    49658\n    0       50177\n    0.1     49861\n    0.2     49947\n    0.3     50157\n    0.4     50414\n    0.5     50006\n    0.6     50038\n    0.7     49962\n    0.8     50071\n    0.9     49695\n\n\n:\n\nRandom random = new Random();\nDoubleStream gaussianStream = Stream.generate(random::nextGaussian).mapToDouble(e -> e);\nLinkedHashMap<Range, Integer> gaussianRangeCountMap =\n    gaussianStream\n            .filter(e -> (e >= -1.0 && e < 1.0))\n            .limit(1000000)\n            .boxed()\n            .map(Ranges::of)\n            .collect(Ranges::emptyRangeCountMap, (m, e) -> m.put(e, m.get(e) + 1), Ranges::mergeRangeCountMaps);\n\ngaussianRangeCountMap.forEach((k, v) -> System.out.println(k.from() + "\\t" + v));\n\n\n: doubledouble\n\n:  https://gist.github.com/bijukunjummen/8129250\n\n: http://www.importnew.com/9672.html\n\n\n# java.util.Base64\n\n> Java8java.util.Base64:\n\n * : https://wizardforcel.gitbooks.io/java8-new-features/content/11.html\n * : http://git.oschina.net/benhail/javase8-sample\n\nBASE64:\n\n1)Basic: BASE64\n\n// \nString asB64 = Base64.getEncoder().encodeToString("some string".getBytes("utf-8"));\nSystem.out.println(asB64); // : c29tZSBzdHJpbmc=\n// \nbyte[] asBytes = Base64.getDecoder().decode("c29tZSBzdHJpbmc=");\nSystem.out.println(new String(asBytes, "utf-8")); // : some string\n\n\n2)URL: URL/\n\nString urlEncoded = Base64.getUrlEncoder().encodeToString("subjects?abcd".getBytes("utf-8"));\nSystem.out.println("Using URL Alphabet: " + urlEncoded);\n// :\nUsing URL Alphabet: c3ViamVjdHM_YWJjZA==\n\n\n3)MIME: BASE64MIME: 76\\r\\n\n\nStringBuilder sb = new StringBuilder();\nfor (int t = 0; t < 10; ++t) {\n  sb.append(UUID.randomUUID().toString());\n}\nbyte[] toEncode = sb.toString().getBytes("utf-8");\nString mimeEncoded = Base64.getMimeEncoder().encodeToString(toEncode);\nSystem.out.println(mimeEncoded);\n\n\n\n# \n\n * https://wizardforcel.gitbooks.io/modern-java/ch7.html\n\n * http://www.importnew.com/9672.html',normalizedContent:'# java 8 - : base64,...\n\n> java 8 @pdai https://www.pdai.tech/md/java/java8/java8-others.html\n\n * java 8 - : base64,...\n   * \n   * \n   * \n   * \n   * java.util.random\n   * java.util.base64\n   * \n\n\n# \n\njava8javainteger:\n\nint2 ** 32java(01)02 ** 31 - 1\n\ninteger.max_value:\n\nsystem.out.println(integer.max_value);      // 2147483647\nsystem.out.println(integer.max_value + 1);  // -2147483648\n\n\njava8:\n\nlong maxunsignedint = (1l << 32) - 1;\nstring string = string.valueof(maxunsignedint);\nint unsignedint = integer.parseunsignedint(string, 10);\nstring string2 = integer.tounsignedstring(unsignedint, 10);\n\n\n2 ** 32 - 1\n\nparseint:\n\ntry {\n    integer.parseint(string, 10);\n}\ncatch (numberformatexception e) {\n    system.err.println("could not parse signed int of " + maxunsignedint);\n}\n\n\n2 ** 31 - 1 \n\nmath? ?\n\nsystem.out.println(integer.max_value);      // 2147483647\nsystem.out.println(integer.max_value + 1);  // -2147483648\n\n\n\n\njava8mathexactaddexactarithmeticexception\n\ntry {\n    math.addexact(integer.max_value, 1);\n}\ncatch (arithmeticexception e) {\n    system.err.println(e.getmessage());\n    // => integer overflow\n}\n\n\ntointexact:\n\ntry {\n    math.tointexact(long.max_value);\n}\ncatch (arithmeticexception e) {\n    system.err.println(e.getmessage());\n    // => integer overflow\n}\n\n\n\n# \n\nfilesjava7niojdk8 api \n\nfiles.listfiltersorted\n\ntry (stream<path> stream = files.list(paths.get(""))) {\n    string joined = stream\n        .map(string::valueof)\n        .filter(path -> !path.startswith("."))\n        .sorted()\n        .collect(collectors.joining("; "));\n    system.out.println("list: " + joined);\n}\n\n\njava8\n\ntry-withautocloseableio\n\n> directorystreamtry-withclose\n\n\n# \n\n:\n\npath start = paths.get("");\nint maxdepth = 5;\ntry (stream<path> stream = files.find(start, maxdepth, (path, attr) ->\n        string.valueof(path).endswith(".js"))) {\n    string joined = stream\n        .sorted()\n        .map(string::valueof)\n        .collect(collectors.joining("; "));\n    system.out.println("found: " + joined);\n}\n\n\nfind: startmaxdepthjavascirpt(.js)\n\nfiles.walk\n\npath start = paths.get("");\nint maxdepth = 5;\ntry (stream<path> stream = files.walk(start, maxdepth)) {\n    string joined = stream\n        .map(string::valueof)\n        .filter(path -> path.endswith(".js"))\n        .sorted()\n        .collect(collectors.joining("; "));\n    system.out.println("walk(): " + joined);\n}\n\n\nfilter\n\n\n# \n\njava 8 files.readalllinesfiles.write:\n\nlist<string> lines = files.readalllines(paths.get("res/nashorn1.js"));\nlines.add("print(\'foobar\');");\nfiles.write(paths.get("res/nashorn1-modified.js"), lines);\n\n\n\n\nfiles.lines\n\ntry (stream<string> stream = files.lines(paths.get("res/nashorn1.js"))) {\n    stream\n        .filter(line -> line.contains("print"))\n        .map(string::trim)\n        .foreach(system.out::println);\n}\n\n\nbufferedreader:\n\npath path = paths.get("res/nashorn1.js");\ntry (bufferedreader reader = files.newbufferedreader(path)) {\n    system.out.println(reader.readline());\n}\n\n\nbufferedwriter:\n\npath path = paths.get("res/output.js");\ntry (bufferedwriter writer = files.newbufferedwriter(path)) {\n    writer.write("print(\'hello world\');");\n}\n\n\nbufferedreaderlines:\n\npath path = paths.get("res/nashorn1.js");\ntry (bufferedreader reader = files.newbufferedreader(path)) {\n    long countprints = reader\n        .lines()\n        .filter(line -> line.contains("print"))\n        .count();\n    system.out.println(countprints);\n}\n\n\njava8\n\ntry-withcountcollect\n\n\n# java.util.random\n\njava8java.util.random(random stream of numbers)\n\ndouble0(0)1(1)\n\nrandom random = new random();\ndoublestream doublestream = random.doubles();\n\n\nint0(0)100(100)\n\nrandom random = new random();\nintstream intstream = random.ints(0, 100);\n\n\n? (limited)\n\n1: 10:\n\nintstream.limit(10).foreach(system.out::println);\n\n\n2: 100:\n\n    list<integer> randombetween0and99 = intstream\n                                       .limit(100)\n                                       .boxed()\n                                       .collect(collectors.tolist());\n\n\n(gaussian pseudo-random values)random.doubles()java8\n\nrandom random = new random();\ndoublestream gaussianstream = stream.generate(random::nextgaussian).maptodouble(e -> e);\n\n\nstream.generate apisupplier random nextgaussian()\n\ndoubledouble: doubledouble\n\njava8api:\n\nrandom random = new random();\ndoublestream doublestream = random.doubles(-1.0, 1.0);\nlinkedhashmap<range, integer> rangecountmap = doublestream.limit(1000000)\n    .boxed()\n    .map(ranges::of)\n    .collect(ranges::emptyrangecountmap, (m, e) -> m.put(e, m.get(e) + 1), ranges::mergerangecountmaps);\n\nrangecountmap.foreach((k, v) -> system.out.println(k.from() + "\\t" + v));\n\n\n:\n\n    -1      49730\n    -0.9    49931\n    -0.8    50057\n    -0.7    50060\n    -0.6    49963\n    -0.5    50159\n    -0.4    49921\n    -0.3    49962\n    -0.2    50231\n    -0.1    49658\n    0       50177\n    0.1     49861\n    0.2     49947\n    0.3     50157\n    0.4     50414\n    0.5     50006\n    0.6     50038\n    0.7     49962\n    0.8     50071\n    0.9     49695\n\n\n:\n\nrandom random = new random();\ndoublestream gaussianstream = stream.generate(random::nextgaussian).maptodouble(e -> e);\nlinkedhashmap<range, integer> gaussianrangecountmap =\n    gaussianstream\n            .filter(e -> (e >= -1.0 && e < 1.0))\n            .limit(1000000)\n            .boxed()\n            .map(ranges::of)\n            .collect(ranges::emptyrangecountmap, (m, e) -> m.put(e, m.get(e) + 1), ranges::mergerangecountmaps);\n\ngaussianrangecountmap.foreach((k, v) -> system.out.println(k.from() + "\\t" + v));\n\n\n: doubledouble\n\n:  https://gist.github.com/bijukunjummen/8129250\n\n: http://www.importnew.com/9672.html\n\n\n# java.util.base64\n\n> java8java.util.base64:\n\n * : https://wizardforcel.gitbooks.io/java8-new-features/content/11.html\n * : http://git.oschina.net/benhail/javase8-sample\n\nbase64:\n\n1)basic: base64\n\n// \nstring asb64 = base64.getencoder().encodetostring("some string".getbytes("utf-8"));\nsystem.out.println(asb64); // : c29tzsbzdhjpbmc=\n// \nbyte[] asbytes = base64.getdecoder().decode("c29tzsbzdhjpbmc=");\nsystem.out.println(new string(asbytes, "utf-8")); // : some string\n\n\n2)url: url/\n\nstring urlencoded = base64.geturlencoder().encodetostring("subjects?abcd".getbytes("utf-8"));\nsystem.out.println("using url alphabet: " + urlencoded);\n// :\nusing url alphabet: c3viamvjdhm_ywjjza==\n\n\n3)mime: base64mime: 76\\r\\n\n\nstringbuilder sb = new stringbuilder();\nfor (int t = 0; t < 10; ++t) {\n  sb.append(uuid.randomuuid().tostring());\n}\nbyte[] toencode = sb.tostring().getbytes("utf-8");\nstring mimeencoded = base64.getmimeencoder().encodetostring(toencode);\nsystem.out.println(mimeencoded);\n\n\n\n# \n\n * https://wizardforcel.gitbooks.io/modern-java/ch7.html\n\n * http://www.importnew.com/9672.html',charsets:{cjk:!0}},{title:"Java 8 - (lambda)",frontmatter:{},regularPath:"/java/java8/java8-stream.html",relativePath:"java/java8/java8-stream.md",key:"v-fd7622f0",path:"/java/java8/java8-stream.html",headers:[{level:2,title:"Java 8 - (lambda)",slug:"java-8--lambda",normalizedTitle:"java 8 - (lambda)",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:100},{level:2,title:"lambda",slug:"lambda",normalizedTitle:"lambda",charIndex:16},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:123},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:133},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:147},{level:2,title:"stream & parallelStream",slug:"stream-parallelstream",normalizedTitle:"stream &amp; parallelstream",charIndex:null},{level:3,title:"stream & parallelStream",slug:"stream-parallelstream-2",normalizedTitle:"stream &amp; parallelstream",charIndex:null},{level:3,title:"parallelStream:",slug:"parallelstream",normalizedTitle:"parallelstream:",charIndex:221},{level:3,title:"streamparallelStream",slug:"streamparallelstream",normalizedTitle:"streamparallelstream",charIndex:246},{level:3,title:"Stream:",slug:"stream",normalizedTitle:"stream:",charIndex:281},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:301},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:313},{level:3,title:"forEach",slug:"foreach",normalizedTitle:"foreach",charIndex:326},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:341},{level:3,title:"Filter & Predicate",slug:"filter-predicate",normalizedTitle:"filter &amp; predicate",charIndex:null},{level:3,title:"Map&Reduce",slug:"map-reduce",normalizedTitle:"map&amp;reduce",charIndex:null},{level:3,title:"Collectors",slug:"collectors",normalizedTitle:"collectors",charIndex:397},{level:3,title:"flatMap",slug:"flatmap",normalizedTitle:"flatmap",charIndex:415},{level:3,title:"distinct",slug:"distinct",normalizedTitle:"distinct",charIndex:430},{level:3,title:"count",slug:"count",normalizedTitle:"count",charIndex:446},{level:3,title:"Match",slug:"match",normalizedTitle:"match",charIndex:459},{level:3,title:"min,max,summaryStatistics",slug:"min-max-summarystatistics",normalizedTitle:"min,max,summarystatistics",charIndex:472},{level:3,title:"peek",slug:"peek",normalizedTitle:"peek",charIndex:505},{level:2,title:"FunctionalInterface",slug:"functionalinterface",normalizedTitle:"functionalinterface",charIndex:515},{level:3,title:" @FunctionInterface",slug:"-functioninterface",normalizedTitle:" @functioninterface",charIndex:542},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:573},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:588},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:602},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:612}],lastUpdated:"2023/4/10 01:17:23",lastUpdatedTimestamp:1681060643e3,headersStr:"Java 8 - (lambda)  lambda    stream & parallelStream stream & parallelStream parallelStream: streamparallelStream Stream:   forEach  Filter & Predicate Map&Reduce Collectors flatMap distinct count Match min,max,summaryStatistics peek FunctionalInterface  @FunctionInterface    ",content:'# Java 8 - (lambda)\n\n>  @pdai\n\n * Java 8 - (lambda)\n   * \n   * lambda\n   * \n     * \n     * \n   * stream & parallelStream\n     * stream & parallelStream\n     * parallelStream:\n     * streamparallelStream\n     * Stream:\n   * \n     * \n     * forEach\n     * \n     * Filter & Predicate\n     * Map&Reduce\n     * Collectors\n     * flatMap\n     * distinct\n     * count\n     * Match\n     * min,max,summaryStatistics\n     * peek\n   * FunctionalInterface\n     *  @FunctionInterface\n     * \n     * \n   * \n   * \n\n\n# \n\n> Java\n\n> \n\n> \n\n\n\n: \n\nAPIStream\n\n\n# lambda\n\n * lambda:  @Functional SAM(Single Abstract Method )lambdalambdaRunnableComparable Callable lambda java.util.function  PredicateFunctionConsumer  Supplierlambda\n\n * lambdalambdalambda\n\nlist.forEach(n -> System.out.println(n)); \nlist.forEach(System.out::println);  // \n\n\nlambda:\n\nlist.forEach((String s) -> System.out.println("*" + s + "*"));\n\n\nlambda\n\n * lambdalambda\n\n * LambdaJava\n\n * Lambda invokedynamic JDK javap class javap -p  javap -c -v lambda:\n\nprivate static java.lang.Object lambda$0(java.lang.String);\n\n\n * lambda final  final lambda\n\nList<Integer> primes = Arrays.asList(new Integer[]{2, 3,5,7});\nint factor = 2;\nprimes.forEach(element -> { factor++; });\n\n\nCompile time error : "local variables referenced from a lambda expression must be final or effectively final" :\n\nList<Integer> primes = Arrays.asList(new Integer[]{2, 3,5,7});\nint factor = 2;\nprimes.forEach(element -> { System.out.println(factor*element); });\n\n\n\n# \n\n\n# \n\nlists.stream().filter(f -> f.getName().equals("p1"))\n\n\nfilterStream\n\n{}\n\n\n# \n\nList<Person> list2 = lists.stream().filter(f -> f.getName().equals("p1")).collect(Collectors.toList());\n\n\ncollectStream\n\nbuild\n\n\n# stream & parallelStream\n\n\n# stream & parallelStream\n\nStream: \n\n:\n\nList <Person> people = list.getStream.collect(Collectors.toList());\n\n\n:\n\nList <Person> people = list.getStream.parallel().collect(Collectors.toList());\n\n\nitemitem\n\n\n# parallelStream:\n\nList originalList = someData;\nsplit1 = originalList(0, mid);//\nsplit2 = originalList(mid,end);\nnew Runnable(split1.process());//\nnew Runnable(split2.process());\nList revisedList = split1 + split2;//\n\n\nhadoop MapReduce  mapreduceMapReduceStreamMapReduce\n\n\n# streamparallelStream\n\n\n\nlong t0 = System.nanoTime();\n\n//100,2toArray()\n\nint a[]=IntStream.range(0, 1_000_000).filter(p -> p % 2==0).toArray();\n\nlong t1 = System.nanoTime();\n\n//\n\nint b[]=IntStream.range(0, 1_000_000).parallel().filter(p -> p % 2==0).toArray();\n\nlong t2 = System.nanoTime();\n\n//serial: 0.06s, parallel 0.02s\n\nSystem.out.printf("serial: %.2fs, parallel %.2fs%n", (t1 - t0) * 1e-9, (t2 - t1) * 1e-9);\n\n\n\n# Stream:\n\n * stream(), parallelStream()\n * filter()\n * findAny() findFirst()\n * sort\n * forEach void\n * map(), reduce()\n * flatMap() - StreamStream\n * collect(Collectors.toList())\n * distinct, limit\n * count\n * min, max, summaryStatistics\n\nAPI:\n\n\n\n\n# \n\n\n# \n\nnew Thread( () -> System.out.println("In Java8, Lambda expression rocks !!") ).start();\n\n// \n(params) -> expression\n(params) -> statement\n(params) -> { statements }\n\n\n\n# forEach\n\n// forEach\nList features = Arrays.asList("Lambdas", "Default Method", "Stream API", "Date and Time API");\nfeatures.forEach(n -> System.out.println(n));\n \n// Java 8::\nfeatures.forEach(System.out::println);\n\n\n\n# \n\n\n\n// Supplier<Student> s = () -> new Student();\nSupplier<Student> s = Student::new;\n\n\n:: Lambda()()\n\n// set.forEach(t -> System.out.println(t));\nset.forEach(System.out::println);\n\n\n::\n\n// Stream<Double> stream = Stream.generate(() -> Math.random());\nStream<Double> stream = Stream.generate(Math::random);\n\n\n::\n\n//  TreeSet<String> set = new TreeSet<>((s1,s2) -> s1.compareTo(s2));\n/*  : Can be replaced with Comparator.naturalOrder\n  StringcompareTo()\n  : Lambda can be replaced with method reference: \n*/\nTreeSet<String> set = new TreeSet<>(String::compareTo);\n\n\n\n# Filter & Predicate\n\n\n\npublic static void main(args[]){\n    List languages = Arrays.asList("Java", "Scala", "C++", "Haskell", "Lisp");\n \n    System.out.println("Languages which starts with J :");\n    filter(languages, (str)->str.startsWith("J"));\n \n    System.out.println("Languages which ends with a ");\n    filter(languages, (str)->str.endsWith("a"));\n \n    System.out.println("Print all languages :");\n    filter(languages, (str)->true);\n \n    System.out.println("Print no language : ");\n    filter(languages, (str)->false);\n \n    System.out.println("Print language whose length greater than 4:");\n    filter(languages, (str)->str.length() > 4);\n}\n \npublic static void filter(List names, Predicate condition) {\n    names.stream().filter((name) -> (condition.test(name))).forEach((name) -> {\n        System.out.println(name + " ");\n    });\n}\n\n\nPredicatefilter\n\n// and()or()xor()Predicate\n// JPredicate\nPredicate<String> startsWithJ = (n) -> n.startsWith("J");\nPredicate<String> fourLetterLong = (n) -> n.length() == 4;\nnames.stream()\n    .filter(startsWithJ.and(fourLetterLong))\n    .forEach((n) -> System.out.print("nName, which starts with \'J\' and four letter long is : " + n));\n\n\n\n# Map&Reduce\n\nmap() reduce() \n\nList costBeforeTax = Arrays.asList(100, 200, 300, 400, 500);\ndouble bill = costBeforeTax.stream().map((cost) -> cost + .12*cost).reduce((sum, cost) -> sum + cost).get();\nSystem.out.println("Total : " + bill);\n\n\n\n# Collectors\n\n// \nList<String> G7 = Arrays.asList("USA", "Japan", "France", "Germany", "Italy", "U.K.","Canada");\nString G7Countries = G7.stream().map(x -> x.toUpperCase()).collect(Collectors.joining(", "));\nSystem.out.println(G7Countries);\n\n\n * Collectors.joining(", ")\n * Collectors.toList()\n * Collectors.toSet() set\n * Collectors.toMap(MemberModel::getUid, Function.identity())\n * Collectors.toMap(ImageModel::getAid, o -> IMAGE_ADDRESS_PREFIX + o.getUrl())\n\n\n# flatMap\n\nStreamStream\n\nList<Integer> result= Stream.of(Arrays.asList(1,3),Arrays.asList(5,6)).flatMap(a->a.stream()).collect(Collectors.toList());\n\n\n: [1, 3, 5, 6]\n\n\n# distinct\n\n\n\nList<LikeDO> likeDOs=new ArrayList<LikeDO>();\nList<Long> likeTidList = likeDOs.stream().map(LikeDO::getTid)\n                .distinct().collect(Collectors.toList());\n\n\n\n# count\n\n\n\nint countOfAdult=persons.stream()\n                       .filter(p -> p.getAge() > 18)\n                       .map(person -> new Adult(person))\n                       .count();\n\n\n\n# Match\n\nboolean anyStartsWithA =\n    stringCollection\n        .stream()\n        .anyMatch((s) -> s.startsWith("a"));\n\nSystem.out.println(anyStartsWithA);      // true\n\nboolean allStartsWithA =\n    stringCollection\n        .stream()\n        .allMatch((s) -> s.startsWith("a"));\n\nSystem.out.println(allStartsWithA);      // false\n\nboolean noneStartsWithZ =\n    stringCollection\n        .stream()\n        .noneMatch((s) -> s.startsWith("z"));\n\nSystem.out.println(noneStartsWithZ);      // true\n\n\n\n# min,max,summaryStatistics\n\n\n\nList<Person> lists = new ArrayList<Person>();\nlists.add(new Person(1L, "p1"));\nlists.add(new Person(2L, "p2"));\nlists.add(new Person(3L, "p3"));\nlists.add(new Person(4L, "p4"));\nPerson a = lists.stream().max(Comparator.comparing(t -> t.getId())).get();\nSystem.out.println(a.getId());\n\n\n\n\n Person a = lists.stream().min(new Comparator<Person>() {\n\n      @Override\n      public int compare(Person o1, Person o2) {\n           if (o1.getId() > o2.getId()) return -1;\n           if (o1.getId() < o2.getId()) return 1;\n           return 0;\n       }\n }).get();\n\n\nsummaryStatistics\n\n//\nList<Integer> primes = Arrays.asList(2, 3, 5, 7, 11, 13, 17, 19, 23, 29);\nIntSummaryStatistics stats = primes.stream().mapToInt((x) -> x).summaryStatistics();\nSystem.out.println("Highest prime number in List : " + stats.getMax());\nSystem.out.println("Lowest prime number in List : " + stats.getMin());\nSystem.out.println("Sum of all prime numbers : " + stats.getSum());\nSystem.out.println("Average of all prime numbers : " + stats.getAverage());\n\n\n\n# peek\n\npeekpeekIDE\n\n\n\nList<Person> lists = new ArrayList<Person>();\nlists.add(new Person(1L, "p1"));\nlists.add(new Person(2L, "p2"));\nlists.add(new Person(3L, "p3"));\nlists.add(new Person(4L, "p4"));\nSystem.out.println(lists);\n\nList<Person> list2 = lists.stream()\n\t\t\t\t .filter(f -> f.getName().startsWith("p"))\n                .peek(t -> {\n                    System.out.println(t.getName());\n                })\n                .collect(Collectors.toList());\nSystem.out.println(list2);\n\n\n\n# FunctionalInterface\n\n\n#  @FunctionInterface\n\n/**\n * An informative annotation type used to indicate that an interface\n * type declaration is intended to be a <i>functional interface</i> as\n * defined by the Java Language Specification.\n *\n * Conceptually, a functional interface has exactly one abstract\n * method.  Since {@linkplain java.lang.reflect.Method#isDefault()\n * default methods} have an implementation, they are not abstract.  If\n * an interface declares an abstract method overriding one of the\n * public methods of {@code java.lang.Object}, that also does\n * <em>not</em> count toward the interface\'s abstract method count\n * since any implementation of the interface will have an\n * implementation from {@code java.lang.Object} or elsewhere.\n *\n * <p>Note that instances of functional interfaces can be created with\n * lambda expressions, method references, or constructor references.\n *\n * <p>If a type is annotated with this annotation type, compilers are\n * required to generate an error message unless:\n *\n * <ul>\n * <li> The type is an interface type and not an annotation type, enum, or class.\n * <li> The annotated type satisfies the requirements of a functional interface.\n * </ul>\n *\n * <p>However, the compiler will treat any interface meeting the\n * definition of a functional interface as a functional interface\n * regardless of whether or not a {@code FunctionalInterface}\n * annotation is present on the interface declaration.\n *\n * @jls 4.3.2. The Class Object\n * @jls 9.8 Functional Interfaces\n * @jls 9.4.3 Interface Method Body\n * @since 1.8\n */\n@Documented\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE)\npublic @interface FunctionalInterface{}\n\n\n * interfacejava\n\n * \n\n * default(javajava.lang.reflect.Method#isDefault()default)\n\n * java.lang.Object: , :\n\njava public interface Comparator<T> { \n\tint compare(T o1, T o2); \n\tboolean equals(Object obj); \n}\n\n\n * :\n   \n   * interfaceenumclass\n   * function interface\n\n * function interfacefunction interface ITest@FunctionInterface\n\n\n# \n\n@FunctionalInterface\npublic interface IMyInterface {\n    void study();\n}\n\npackage com.isea.java;\npublic class TestIMyInterface {\n    public static void main(String[] args) {\n        IMyInterface iMyInterface = () -> System.out.println("I like study");\n        iMyInterface.study();\n    }\n}\n\n\n\n# \n\n * : Consumer<T> void accept(T t)\n\n> : map.forEach(BiConsumer<A, T>)\n\nConsumer<Person> greeter = (p) -> System.out.println("Hello, " + p.firstName);\ngreeter.accept(new Person("Luke", "Skywalker"));\n\n\n * : Supplier <T> T get() \n\n> stream().collect(Collector<? super T, A, R> collector):\n\n:\n\nSupplier<Person> personSupplier = Person::new;\npersonSupplier.get();   // new Person\n\n\n:\n\n// \n<R, A> R collect(Collector<? super T, A, R> collector)\n\n// Collectors.toSet\npublic static <T>\n\tCollector<T, ?, Set<T>> toSet() {\n    \treturn new CollectorImpl<>((Supplier<Set<T>>) HashSet::new, Set::add,\n                               (left, right) -> { left.addAll(right); return left; },\n                               CH_UNORDERED_ID);\n}\n\n// CollectorImpl\nprivate final Supplier<A> supplier;\nprivate final BiConsumer<A, T> accumulator;\nprivate final BinaryOperator<A> combiner;\nprivate final Function<A, R> finisher;\nprivate final Set<Characteristics> characteristics;\n\nCollectorImpl(Supplier<A> supplier,\n              BiConsumer<A, T> accumulator,\n              BinaryOperator<A> combiner,\n              Function<A,R> finisher,\n              Set<Characteristics> characteristics) {\n    this.supplier = supplier;\n    this.accumulator = accumulator;\n    this.combiner = combiner;\n    this.finisher = finisher;\n    this.characteristics = characteristics;\n}\n\nCollectorImpl(Supplier<A> supplier,\n              BiConsumer<A, T> accumulator,\n              BinaryOperator<A> combiner,\n              Set<Characteristics> characteristics) {\n    this(supplier, accumulator, combiner, castingIdentity(), characteristics);\n}\n\n// collect()\npublic final <R, A> R collect(Collector<? super P_OUT, A, R> collector) {\n    A container;\n    if (isParallel()\n            && (collector.characteristics().contains(Collector.Characteristics.CONCURRENT))\n            && (!isOrdered() || collector.characteristics().contains(Collector.Characteristics.UNORDERED))) {\n        container = collector.supplier().get();\n        BiConsumer<A, ? super P_OUT> accumulator = collector.accumulator();\n        forEach(u -> accumulator.accept(container, u));\n    }\n    else {\n        container = evaluate(ReduceOps.makeRef(collector));\n    }\n    return collector.characteristics().contains(Collector.Characteristics.IDENTITY_FINISH)\n           ? (R) container\n           : collector.finisher().apply(container);\n}\n\n\n * : Predicate<T> boolean test(T t):boolean\n\n> : steam().filter()Predicate\n\nPredicate<String> predicate = (s) -> s.length() > 0;\n\npredicate.test("foo");              // true\npredicate.negate().test("foo");     // false\n\nPredicate<Boolean> nonNull = Objects::nonNull;\nPredicate<Boolean> isNull = Objects::isNull;\n\nPredicate<String> isEmpty = String::isEmpty;\nPredicate<String> isNotEmpty = isEmpty.negate();\n\n\n * : Function<T,R> R apply(T t)\n\n> : steam().map() Function<? super T, ? extends R>reduce()BinaryOperator<T> (ps: BinaryOperator<T> extends BiFunction<T,T,T>)\n\nFunction<String, Integer> toInteger = Integer::valueOf;\nFunction<String, String> backToString = toInteger.andThen(String::valueOf);\n\nbackToString.apply("123");     // "123"\n\n\n\n# \n\n *  >253\n\njavaProgrammers.stream()\n          .filter((p) -> (p.getAge() > 25))\n          .filter((p) -> ("female".equals(p.getGender())))\n          .sorted((p, p2) -> (p.getFirstName().compareTo(p2.getFirstName())))\n          .limit(3)\n          //.forEach(e -> e.setSalary(e.getSalary() / 100 * 5 + e.getSalary()))//\n          .forEach((p) -> System.out.printf("%s %s; ", p.getFirstName(), p.getLastName()));\n\n\n *  Java programmer\n\nPerson person = javaProgrammers\n          .stream()\n          .max((p, p2) -> (p.getSalary() - p2.getSalary()))\n          .get()\n\n\n *  Java programmers  first name  TreeSet\n\nTreeSet<String> javaDevLastName = javaProgrammers\n          .stream()\n          .map(Person::getLastName)\n          .collect(toCollection(TreeSet::new))\n\n\n *  Java programmers money\n\nint totalSalary = javaProgrammers\n          .parallelStream()\n          .mapToInt(p -> p.getSalary())\n          .sum();\n\n\n * Comparator: GID\n\npublic static void main(String[] args) {\n\tList<Person> personList = getTestList();\n\tpersonList.sort(Comparator.comparing(Person::getName, String.CASE_INSENSITIVE_ORDER)\n\t\t\t.thenComparing(Person::getGid, (a, b) -> b.compareTo(a))\n\t\t\t.thenComparingInt(Person::getAge));\n\tpersonList.stream().forEach(System.out::println);\n}\n\npublic static List<Person> getTestList() {\n\treturn Lists.newArrayList(new Person("dai", "301", 10), new Person("dai", "303", 10),\n\t\t\tnew Person("dai", "303", 8), new Person("dai", "303", 6), new Person("dai", "303", 11),\n\t\t\tnew Person("dai", "302", 9), new Person("zhang", "302", 9), new Person("zhang", "301", 9),\n\t\t\tnew Person("Li", "301", 8));\n}\n\n// \n// Person [name=dai, gid=303, age=6]\n// Person [name=dai, gid=303, age=8]\n// Person [name=dai, gid=303, age=10]\n// Person [name=dai, gid=303, age=11]\n// Person [name=dai, gid=302, age=9]\n// Person [name=dai, gid=301, age=10]\n// Person [name=Li, gid=301, age=8]\n// Person [name=zhang, gid=302, age=9]\n// Person [name=zhang, gid=301, age=9]\n\n\n * \n\n: joinchars\n\nString.join(":", "foobar", "foo", "bar");\n// => foobar:foo:bar\n\n\nchars\n\n"foobar:foo:bar"\n    .chars()\n    .distinct()\n    .mapToObj(c -> String.valueOf((char)c))\n    .sorted()\n    .collect(Collectors.joining());\n// => :abfor\n\n\n:\n\nPattern.compile(":")\n    .splitAsStream("foobar:foo:bar")\n    .filter(s -> s.contains("bar"))\n    .sorted()\n    .collect(Collectors.joining(":"));\n// => bar:foobar\n\n\n:\n\nPattern pattern = Pattern.compile(".*@gmail\\\\.com");\nStream.of("bob@gmail.com", "alice@hotmail.com")\n    .filter(pattern.asPredicate())\n    .count();\n// => 1\n\n\n@gmail.comJava8Predicate\n\n * Local Cache\n\npublic class TestLocalCache {\n\n\tprivate static ConcurrentHashMap<Integer, Long> cache = new ConcurrentHashMap<>();\n\n\tstatic long fibonacci(int i) {\n\t\tif (i == 0)\n\t\t\treturn i;\n\n\t\tif (i == 1)\n\t\t\treturn 1;\n\n\t\treturn cache.computeIfAbsent(i, (key) -> {\n\t\t\tSystem.out.println("Slow calculation of " + key);\n\n\t\t\treturn fibonacci(i - 2) + fibonacci(i - 1);\n\t\t});\n\t}\n\t\n\tpublic static void main(String[] args) {\n\t\t// warm up\n\t\tfor (int i = 0; i < 101; i++)\n\t        System.out.println(\n\t            "f(" + i + ") = " + fibonacci(i));\n\t\t\n\t\t// read -> cal\n\t\tlong current = System.currentTimeMillis();\n\t\tSystem.out.println(fibonacci(100));\n\t\tSystem.out.println(System.currentTimeMillis()-current);\n\t}\n}\n\n\n * -------List--\n\nList<LikeDO> likeDOs=new ArrayList<LikeDO>();\nList<Long> likeTidList = likeDOs.stream().map(LikeDO::getTid)\n                .distinct().collect(Collectors.toList());\n\n\n * ------\n\n  Map<String, StkProduct> newStockName2Product = Maps.newConcurrentMap();\n        stockProducts.stream().filter(stkProduct -> stkProduct.enabled).forEach(stkProduct -> {\n            String newName = BCConvert.bj2qj(StringUtils.replace(stkProduct.name, " ", ""));\n            newStockName2Product.put(newName, stkProduct);\n        });\n\n\n Set<String> qjStockNames;\n qjStockNames.stream().filter(name -> !acAutomaton.getKey2link().containsKey(name)).forEach(name -> {\n            String value = "";\n            StkProduct stkProduct = stockNameQj2Product.get(name);\n            if (stkProduct != null) {\n                value = stkProduct.name;\n            }\n            acAutomaton.getKey2link().put(name, value);\n        });\n\n\n * --map\n\nList<ImageModel> imageModelList = null;\nMap<Long, String> imagesMap = null;\nimagesMap = imageModelList.stream().collect(Collectors.toMap(ImageModel::getAid, o -> IMAGE_ADDRESS_PREFIX + o.getUrl()));\n              \n             \n\nMap<String, String> kvMap = postDetailCacheList.stream().collect(Collectors.toMap((detailCache) ->\n                getBbsSimplePostKey(detailCache.getTid()), JSON::toJSONString));\n\n\nMap<Long, Long> pidToTid\nList<String> pidKeyList = pidToTid.entrySet().stream().map((o) -> getKeyBbsReplyPid(o.getValue(), o.getKey())).collect(Collectors.toList());\n\n\n\n * DO---Model\n\nList<AdDO> adDOList;\nadDOList.stream().map(adDo -> convertAdModel(adDo))\n                .collect(Collectors.toList());\n\n\n * phones List<String>\n\nList<String> phones=new ArrayList<String>();\n        phones.add("a");\n        phones.add("b");\n        phones.add("a");\n        phones.add("a");\n        phones.add("c");\n        phones.add("b");\n        Map<String, List<String>> phoneClassify = phones.stream().collect(Collectors.groupingBy(item -> item));\n        System.out.println(phoneClassify);\n: \n{a=[a, a, a], b=[b, b], c=[c]}\n\n\n\n# \n\n * Lambda  10 \n * learn-java8\n * java8-tutorial\n * lambda\n * http://blog.csdn.net/renfufei/article/details/24600507\n * http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/Lambda-QuickStart/index.html\n * Java8 Lambda https://blog.csdn.net/ioriogami/article/details/12782141\n * Java8 6 https://wizardforcel.gitbooks.io/java8-tutorials/content/Java%208%20%E7%9A%846%E4%B8%AA%E9%97%AE%E9%A2%98.html',normalizedContent:'# java 8 - (lambda)\n\n>  @pdai\n\n * java 8 - (lambda)\n   * \n   * lambda\n   * \n     * \n     * \n   * stream & parallelstream\n     * stream & parallelstream\n     * parallelstream:\n     * streamparallelstream\n     * stream:\n   * \n     * \n     * foreach\n     * \n     * filter & predicate\n     * map&reduce\n     * collectors\n     * flatmap\n     * distinct\n     * count\n     * match\n     * min,max,summarystatistics\n     * peek\n   * functionalinterface\n     *  @functioninterface\n     * \n     * \n   * \n   * \n\n\n# \n\n> java\n\n> \n\n> \n\n\n\n: \n\napistream\n\n\n# lambda\n\n * lambda:  @functional sam(single abstract method )lambdalambdarunnablecomparable callable lambda java.util.function  predicatefunctionconsumer  supplierlambda\n\n * lambdalambdalambda\n\nlist.foreach(n -> system.out.println(n)); \nlist.foreach(system.out::println);  // \n\n\nlambda:\n\nlist.foreach((string s) -> system.out.println("*" + s + "*"));\n\n\nlambda\n\n * lambdalambda\n\n * lambdajava\n\n * lambda invokedynamic jdk javap class javap -p  javap -c -v lambda:\n\nprivate static java.lang.object lambda$0(java.lang.string);\n\n\n * lambda final  final lambda\n\nlist<integer> primes = arrays.aslist(new integer[]{2, 3,5,7});\nint factor = 2;\nprimes.foreach(element -> { factor++; });\n\n\ncompile time error : "local variables referenced from a lambda expression must be final or effectively final" :\n\nlist<integer> primes = arrays.aslist(new integer[]{2, 3,5,7});\nint factor = 2;\nprimes.foreach(element -> { system.out.println(factor*element); });\n\n\n\n# \n\n\n# \n\nlists.stream().filter(f -> f.getname().equals("p1"))\n\n\nfilterstream\n\n{}\n\n\n# \n\nlist<person> list2 = lists.stream().filter(f -> f.getname().equals("p1")).collect(collectors.tolist());\n\n\ncollectstream\n\nbuild\n\n\n# stream & parallelstream\n\n\n# stream & parallelstream\n\nstream: \n\n:\n\nlist <person> people = list.getstream.collect(collectors.tolist());\n\n\n:\n\nlist <person> people = list.getstream.parallel().collect(collectors.tolist());\n\n\nitemitem\n\n\n# parallelstream:\n\nlist originallist = somedata;\nsplit1 = originallist(0, mid);//\nsplit2 = originallist(mid,end);\nnew runnable(split1.process());//\nnew runnable(split2.process());\nlist revisedlist = split1 + split2;//\n\n\nhadoop mapreduce  mapreducemapreducestreammapreduce\n\n\n# streamparallelstream\n\n\n\nlong t0 = system.nanotime();\n\n//100,2toarray()\n\nint a[]=intstream.range(0, 1_000_000).filter(p -> p % 2==0).toarray();\n\nlong t1 = system.nanotime();\n\n//\n\nint b[]=intstream.range(0, 1_000_000).parallel().filter(p -> p % 2==0).toarray();\n\nlong t2 = system.nanotime();\n\n//serial: 0.06s, parallel 0.02s\n\nsystem.out.printf("serial: %.2fs, parallel %.2fs%n", (t1 - t0) * 1e-9, (t2 - t1) * 1e-9);\n\n\n\n# stream:\n\n * stream(), parallelstream()\n * filter()\n * findany() findfirst()\n * sort\n * foreach void\n * map(), reduce()\n * flatmap() - streamstream\n * collect(collectors.tolist())\n * distinct, limit\n * count\n * min, max, summarystatistics\n\napi:\n\n\n\n\n# \n\n\n# \n\nnew thread( () -> system.out.println("in java8, lambda expression rocks !!") ).start();\n\n// \n(params) -> expression\n(params) -> statement\n(params) -> { statements }\n\n\n\n# foreach\n\n// foreach\nlist features = arrays.aslist("lambdas", "default method", "stream api", "date and time api");\nfeatures.foreach(n -> system.out.println(n));\n \n// java 8::\nfeatures.foreach(system.out::println);\n\n\n\n# \n\n\n\n// supplier<student> s = () -> new student();\nsupplier<student> s = student::new;\n\n\n:: lambda()()\n\n// set.foreach(t -> system.out.println(t));\nset.foreach(system.out::println);\n\n\n::\n\n// stream<double> stream = stream.generate(() -> math.random());\nstream<double> stream = stream.generate(math::random);\n\n\n::\n\n//  treeset<string> set = new treeset<>((s1,s2) -> s1.compareto(s2));\n/*  : can be replaced with comparator.naturalorder\n  stringcompareto()\n  : lambda can be replaced with method reference: \n*/\ntreeset<string> set = new treeset<>(string::compareto);\n\n\n\n# filter & predicate\n\n\n\npublic static void main(args[]){\n    list languages = arrays.aslist("java", "scala", "c++", "haskell", "lisp");\n \n    system.out.println("languages which starts with j :");\n    filter(languages, (str)->str.startswith("j"));\n \n    system.out.println("languages which ends with a ");\n    filter(languages, (str)->str.endswith("a"));\n \n    system.out.println("print all languages :");\n    filter(languages, (str)->true);\n \n    system.out.println("print no language : ");\n    filter(languages, (str)->false);\n \n    system.out.println("print language whose length greater than 4:");\n    filter(languages, (str)->str.length() > 4);\n}\n \npublic static void filter(list names, predicate condition) {\n    names.stream().filter((name) -> (condition.test(name))).foreach((name) -> {\n        system.out.println(name + " ");\n    });\n}\n\n\npredicatefilter\n\n// and()or()xor()predicate\n// jpredicate\npredicate<string> startswithj = (n) -> n.startswith("j");\npredicate<string> fourletterlong = (n) -> n.length() == 4;\nnames.stream()\n    .filter(startswithj.and(fourletterlong))\n    .foreach((n) -> system.out.print("nname, which starts with \'j\' and four letter long is : " + n));\n\n\n\n# map&reduce\n\nmap() reduce() \n\nlist costbeforetax = arrays.aslist(100, 200, 300, 400, 500);\ndouble bill = costbeforetax.stream().map((cost) -> cost + .12*cost).reduce((sum, cost) -> sum + cost).get();\nsystem.out.println("total : " + bill);\n\n\n\n# collectors\n\n// \nlist<string> g7 = arrays.aslist("usa", "japan", "france", "germany", "italy", "u.k.","canada");\nstring g7countries = g7.stream().map(x -> x.touppercase()).collect(collectors.joining(", "));\nsystem.out.println(g7countries);\n\n\n * collectors.joining(", ")\n * collectors.tolist()\n * collectors.toset() set\n * collectors.tomap(membermodel::getuid, function.identity())\n * collectors.tomap(imagemodel::getaid, o -> image_address_prefix + o.geturl())\n\n\n# flatmap\n\nstreamstream\n\nlist<integer> result= stream.of(arrays.aslist(1,3),arrays.aslist(5,6)).flatmap(a->a.stream()).collect(collectors.tolist());\n\n\n: [1, 3, 5, 6]\n\n\n# distinct\n\n\n\nlist<likedo> likedos=new arraylist<likedo>();\nlist<long> liketidlist = likedos.stream().map(likedo::gettid)\n                .distinct().collect(collectors.tolist());\n\n\n\n# count\n\n\n\nint countofadult=persons.stream()\n                       .filter(p -> p.getage() > 18)\n                       .map(person -> new adult(person))\n                       .count();\n\n\n\n# match\n\nboolean anystartswitha =\n    stringcollection\n        .stream()\n        .anymatch((s) -> s.startswith("a"));\n\nsystem.out.println(anystartswitha);      // true\n\nboolean allstartswitha =\n    stringcollection\n        .stream()\n        .allmatch((s) -> s.startswith("a"));\n\nsystem.out.println(allstartswitha);      // false\n\nboolean nonestartswithz =\n    stringcollection\n        .stream()\n        .nonematch((s) -> s.startswith("z"));\n\nsystem.out.println(nonestartswithz);      // true\n\n\n\n# min,max,summarystatistics\n\n\n\nlist<person> lists = new arraylist<person>();\nlists.add(new person(1l, "p1"));\nlists.add(new person(2l, "p2"));\nlists.add(new person(3l, "p3"));\nlists.add(new person(4l, "p4"));\nperson a = lists.stream().max(comparator.comparing(t -> t.getid())).get();\nsystem.out.println(a.getid());\n\n\n\n\n person a = lists.stream().min(new comparator<person>() {\n\n      @override\n      public int compare(person o1, person o2) {\n           if (o1.getid() > o2.getid()) return -1;\n           if (o1.getid() < o2.getid()) return 1;\n           return 0;\n       }\n }).get();\n\n\nsummarystatistics\n\n//\nlist<integer> primes = arrays.aslist(2, 3, 5, 7, 11, 13, 17, 19, 23, 29);\nintsummarystatistics stats = primes.stream().maptoint((x) -> x).summarystatistics();\nsystem.out.println("highest prime number in list : " + stats.getmax());\nsystem.out.println("lowest prime number in list : " + stats.getmin());\nsystem.out.println("sum of all prime numbers : " + stats.getsum());\nsystem.out.println("average of all prime numbers : " + stats.getaverage());\n\n\n\n# peek\n\npeekpeekide\n\n\n\nlist<person> lists = new arraylist<person>();\nlists.add(new person(1l, "p1"));\nlists.add(new person(2l, "p2"));\nlists.add(new person(3l, "p3"));\nlists.add(new person(4l, "p4"));\nsystem.out.println(lists);\n\nlist<person> list2 = lists.stream()\n\t\t\t\t .filter(f -> f.getname().startswith("p"))\n                .peek(t -> {\n                    system.out.println(t.getname());\n                })\n                .collect(collectors.tolist());\nsystem.out.println(list2);\n\n\n\n# functionalinterface\n\n\n#  @functioninterface\n\n/**\n * an informative annotation type used to indicate that an interface\n * type declaration is intended to be a <i>functional interface</i> as\n * defined by the java language specification.\n *\n * conceptually, a functional interface has exactly one abstract\n * method.  since {@linkplain java.lang.reflect.method#isdefault()\n * default methods} have an implementation, they are not abstract.  if\n * an interface declares an abstract method overriding one of the\n * public methods of {@code java.lang.object}, that also does\n * <em>not</em> count toward the interface\'s abstract method count\n * since any implementation of the interface will have an\n * implementation from {@code java.lang.object} or elsewhere.\n *\n * <p>note that instances of functional interfaces can be created with\n * lambda expressions, method references, or constructor references.\n *\n * <p>if a type is annotated with this annotation type, compilers are\n * required to generate an error message unless:\n *\n * <ul>\n * <li> the type is an interface type and not an annotation type, enum, or class.\n * <li> the annotated type satisfies the requirements of a functional interface.\n * </ul>\n *\n * <p>however, the compiler will treat any interface meeting the\n * definition of a functional interface as a functional interface\n * regardless of whether or not a {@code functionalinterface}\n * annotation is present on the interface declaration.\n *\n * @jls 4.3.2. the class object\n * @jls 9.8 functional interfaces\n * @jls 9.4.3 interface method body\n * @since 1.8\n */\n@documented\n@retention(retentionpolicy.runtime)\n@target(elementtype.type)\npublic @interface functionalinterface{}\n\n\n * interfacejava\n\n * \n\n * default(javajava.lang.reflect.method#isdefault()default)\n\n * java.lang.object: , :\n\njava public interface comparator<t> { \n\tint compare(t o1, t o2); \n\tboolean equals(object obj); \n}\n\n\n * :\n   \n   * interfaceenumclass\n   * function interface\n\n * function interfacefunction interface itest@functioninterface\n\n\n# \n\n@functionalinterface\npublic interface imyinterface {\n    void study();\n}\n\npackage com.isea.java;\npublic class testimyinterface {\n    public static void main(string[] args) {\n        imyinterface imyinterface = () -> system.out.println("i like study");\n        imyinterface.study();\n    }\n}\n\n\n\n# \n\n * : consumer<t> void accept(t t)\n\n> : map.foreach(biconsumer<a, t>)\n\nconsumer<person> greeter = (p) -> system.out.println("hello, " + p.firstname);\ngreeter.accept(new person("luke", "skywalker"));\n\n\n * : supplier <t> t get() \n\n> stream().collect(collector<? super t, a, r> collector):\n\n:\n\nsupplier<person> personsupplier = person::new;\npersonsupplier.get();   // new person\n\n\n:\n\n// \n<r, a> r collect(collector<? super t, a, r> collector)\n\n// collectors.toset\npublic static <t>\n\tcollector<t, ?, set<t>> toset() {\n    \treturn new collectorimpl<>((supplier<set<t>>) hashset::new, set::add,\n                               (left, right) -> { left.addall(right); return left; },\n                               ch_unordered_id);\n}\n\n// collectorimpl\nprivate final supplier<a> supplier;\nprivate final biconsumer<a, t> accumulator;\nprivate final binaryoperator<a> combiner;\nprivate final function<a, r> finisher;\nprivate final set<characteristics> characteristics;\n\ncollectorimpl(supplier<a> supplier,\n              biconsumer<a, t> accumulator,\n              binaryoperator<a> combiner,\n              function<a,r> finisher,\n              set<characteristics> characteristics) {\n    this.supplier = supplier;\n    this.accumulator = accumulator;\n    this.combiner = combiner;\n    this.finisher = finisher;\n    this.characteristics = characteristics;\n}\n\ncollectorimpl(supplier<a> supplier,\n              biconsumer<a, t> accumulator,\n              binaryoperator<a> combiner,\n              set<characteristics> characteristics) {\n    this(supplier, accumulator, combiner, castingidentity(), characteristics);\n}\n\n// collect()\npublic final <r, a> r collect(collector<? super p_out, a, r> collector) {\n    a container;\n    if (isparallel()\n            && (collector.characteristics().contains(collector.characteristics.concurrent))\n            && (!isordered() || collector.characteristics().contains(collector.characteristics.unordered))) {\n        container = collector.supplier().get();\n        biconsumer<a, ? super p_out> accumulator = collector.accumulator();\n        foreach(u -> accumulator.accept(container, u));\n    }\n    else {\n        container = evaluate(reduceops.makeref(collector));\n    }\n    return collector.characteristics().contains(collector.characteristics.identity_finish)\n           ? (r) container\n           : collector.finisher().apply(container);\n}\n\n\n * : predicate<t> boolean test(t t):boolean\n\n> : steam().filter()predicate\n\npredicate<string> predicate = (s) -> s.length() > 0;\n\npredicate.test("foo");              // true\npredicate.negate().test("foo");     // false\n\npredicate<boolean> nonnull = objects::nonnull;\npredicate<boolean> isnull = objects::isnull;\n\npredicate<string> isempty = string::isempty;\npredicate<string> isnotempty = isempty.negate();\n\n\n * : function<t,r> r apply(t t)\n\n> : steam().map() function<? super t, ? extends r>reduce()binaryoperator<t> (ps: binaryoperator<t> extends bifunction<t,t,t>)\n\nfunction<string, integer> tointeger = integer::valueof;\nfunction<string, string> backtostring = tointeger.andthen(string::valueof);\n\nbacktostring.apply("123");     // "123"\n\n\n\n# \n\n *  >253\n\njavaprogrammers.stream()\n          .filter((p) -> (p.getage() > 25))\n          .filter((p) -> ("female".equals(p.getgender())))\n          .sorted((p, p2) -> (p.getfirstname().compareto(p2.getfirstname())))\n          .limit(3)\n          //.foreach(e -> e.setsalary(e.getsalary() / 100 * 5 + e.getsalary()))//\n          .foreach((p) -> system.out.printf("%s %s; ", p.getfirstname(), p.getlastname()));\n\n\n *  java programmer\n\nperson person = javaprogrammers\n          .stream()\n          .max((p, p2) -> (p.getsalary() - p2.getsalary()))\n          .get()\n\n\n *  java programmers  first name  treeset\n\ntreeset<string> javadevlastname = javaprogrammers\n          .stream()\n          .map(person::getlastname)\n          .collect(tocollection(treeset::new))\n\n\n *  java programmers money\n\nint totalsalary = javaprogrammers\n          .parallelstream()\n          .maptoint(p -> p.getsalary())\n          .sum();\n\n\n * comparator: gid\n\npublic static void main(string[] args) {\n\tlist<person> personlist = gettestlist();\n\tpersonlist.sort(comparator.comparing(person::getname, string.case_insensitive_order)\n\t\t\t.thencomparing(person::getgid, (a, b) -> b.compareto(a))\n\t\t\t.thencomparingint(person::getage));\n\tpersonlist.stream().foreach(system.out::println);\n}\n\npublic static list<person> gettestlist() {\n\treturn lists.newarraylist(new person("dai", "301", 10), new person("dai", "303", 10),\n\t\t\tnew person("dai", "303", 8), new person("dai", "303", 6), new person("dai", "303", 11),\n\t\t\tnew person("dai", "302", 9), new person("zhang", "302", 9), new person("zhang", "301", 9),\n\t\t\tnew person("li", "301", 8));\n}\n\n// \n// person [name=dai, gid=303, age=6]\n// person [name=dai, gid=303, age=8]\n// person [name=dai, gid=303, age=10]\n// person [name=dai, gid=303, age=11]\n// person [name=dai, gid=302, age=9]\n// person [name=dai, gid=301, age=10]\n// person [name=li, gid=301, age=8]\n// person [name=zhang, gid=302, age=9]\n// person [name=zhang, gid=301, age=9]\n\n\n * \n\n: joinchars\n\nstring.join(":", "foobar", "foo", "bar");\n// => foobar:foo:bar\n\n\nchars\n\n"foobar:foo:bar"\n    .chars()\n    .distinct()\n    .maptoobj(c -> string.valueof((char)c))\n    .sorted()\n    .collect(collectors.joining());\n// => :abfor\n\n\n:\n\npattern.compile(":")\n    .splitasstream("foobar:foo:bar")\n    .filter(s -> s.contains("bar"))\n    .sorted()\n    .collect(collectors.joining(":"));\n// => bar:foobar\n\n\n:\n\npattern pattern = pattern.compile(".*@gmail\\\\.com");\nstream.of("bob@gmail.com", "alice@hotmail.com")\n    .filter(pattern.aspredicate())\n    .count();\n// => 1\n\n\n@gmail.comjava8predicate\n\n * local cache\n\npublic class testlocalcache {\n\n\tprivate static concurrenthashmap<integer, long> cache = new concurrenthashmap<>();\n\n\tstatic long fibonacci(int i) {\n\t\tif (i == 0)\n\t\t\treturn i;\n\n\t\tif (i == 1)\n\t\t\treturn 1;\n\n\t\treturn cache.computeifabsent(i, (key) -> {\n\t\t\tsystem.out.println("slow calculation of " + key);\n\n\t\t\treturn fibonacci(i - 2) + fibonacci(i - 1);\n\t\t});\n\t}\n\t\n\tpublic static void main(string[] args) {\n\t\t// warm up\n\t\tfor (int i = 0; i < 101; i++)\n\t        system.out.println(\n\t            "f(" + i + ") = " + fibonacci(i));\n\t\t\n\t\t// read -> cal\n\t\tlong current = system.currenttimemillis();\n\t\tsystem.out.println(fibonacci(100));\n\t\tsystem.out.println(system.currenttimemillis()-current);\n\t}\n}\n\n\n * -------list--\n\nlist<likedo> likedos=new arraylist<likedo>();\nlist<long> liketidlist = likedos.stream().map(likedo::gettid)\n                .distinct().collect(collectors.tolist());\n\n\n * ------\n\n  map<string, stkproduct> newstockname2product = maps.newconcurrentmap();\n        stockproducts.stream().filter(stkproduct -> stkproduct.enabled).foreach(stkproduct -> {\n            string newname = bcconvert.bj2qj(stringutils.replace(stkproduct.name, " ", ""));\n            newstockname2product.put(newname, stkproduct);\n        });\n\n\n set<string> qjstocknames;\n qjstocknames.stream().filter(name -> !acautomaton.getkey2link().containskey(name)).foreach(name -> {\n            string value = "";\n            stkproduct stkproduct = stocknameqj2product.get(name);\n            if (stkproduct != null) {\n                value = stkproduct.name;\n            }\n            acautomaton.getkey2link().put(name, value);\n        });\n\n\n * --map\n\nlist<imagemodel> imagemodellist = null;\nmap<long, string> imagesmap = null;\nimagesmap = imagemodellist.stream().collect(collectors.tomap(imagemodel::getaid, o -> image_address_prefix + o.geturl()));\n              \n             \n\nmap<string, string> kvmap = postdetailcachelist.stream().collect(collectors.tomap((detailcache) ->\n                getbbssimplepostkey(detailcache.gettid()), json::tojsonstring));\n\n\nmap<long, long> pidtotid\nlist<string> pidkeylist = pidtotid.entryset().stream().map((o) -> getkeybbsreplypid(o.getvalue(), o.getkey())).collect(collectors.tolist());\n\n\n\n * do---model\n\nlist<addo> addolist;\naddolist.stream().map(addo -> convertadmodel(addo))\n                .collect(collectors.tolist());\n\n\n * phones list<string>\n\nlist<string> phones=new arraylist<string>();\n        phones.add("a");\n        phones.add("b");\n        phones.add("a");\n        phones.add("a");\n        phones.add("c");\n        phones.add("b");\n        map<string, list<string>> phoneclassify = phones.stream().collect(collectors.groupingby(item -> item));\n        system.out.println(phoneclassify);\n: \n{a=[a, a, a], b=[b, b], c=[c]}\n\n\n\n# \n\n * lambda  10 \n * learn-java8\n * java8-tutorial\n * lambda\n * http://blog.csdn.net/renfufei/article/details/24600507\n * http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/lambda-quickstart/index.html\n * java8 lambda https://blog.csdn.net/ioriogami/article/details/12782141\n * java8 6 https://wizardforcel.gitbooks.io/java8-tutorials/content/java%208%20%e7%9a%846%e4%b8%aa%e9%97%ae%e9%a2%98.html',charsets:{cjk:!0}},{title:"Java 8 - ",frontmatter:{},regularPath:"/java/java8/java8-type.html",relativePath:"java/java8/java8-type.md",key:"v-66e98988",path:"/java/java8/java8-type.html",headers:[{level:2,title:"Java 8 - ",slug:"java-8-",normalizedTitle:"java 8 - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:130},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:142},{level:2,title:"java7",slug:"java7",normalizedTitle:"java7",charIndex:153},{level:2,title:"Java8",slug:"java8",normalizedTitle:"java8",charIndex:173},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:193}],lastUpdated:"2023/4/10 01:17:23",lastUpdatedTimestamp:1681060643e3,headersStr:"Java 8 -    java7 Java8 ",content:'# Java 8 - \n\n> Java 8 : @pdai\n> \n>  * \n>  * Java7\n>  * Java8\n\n * Java 8 - \n   * \n   * \n   * java7\n   * Java8\n   * \n\n\n# \n\nJava SE 1.5\n\nJavaJava(casting):\n\nList<Apple> box = new ArrayList<Apple>();\nbox.add(new Apple());\nApple apple =box.get(0);\n\n\n: boxAppleListgetApple:\n\nApple apple = (Apple)box.get(0);\n\n\n\n# \n\n\n\n\n# java7\n\n:\n\nMap<String, String> myMap = new HashMap<String, String>();\n\n\n:? Java SE 7:\n\nMap<String, String> myMap = new HashMap<>(); //"<>"\n\n\nHashMapnew HashMap<><>HashMap\n\n: Java SE 7: : java 7(java8):\n\nList<String> list = new ArrayList<>();\nlist.add("A");// addAllCollection<? extends String>\nlist.addAll(new ArrayList<>());\n\n\n\n# Java8\n\njava82:\n\n1.\n\n2.\n\n\n\nclass List<E> {\n   static <Z> List<Z> nil() { ... };\n   static <Z> List<Z> cons(Z head, List<Z> tail) { ... };\n   E head() { ... }\n}\n\n\nJEP101\n\n//\nList<String> l = List.nil();\n//\n//List<String> l = List.<String>nil();\n//\nList.cons(42, List.nil());\n//\n//List.cons(42, List.<Integer>nil());\n\n\n\n# \n\nJEP101Javajava ',normalizedContent:'# java 8 - \n\n> java 8 : @pdai\n> \n>  * \n>  * java7\n>  * java8\n\n * java 8 - \n   * \n   * \n   * java7\n   * java8\n   * \n\n\n# \n\njava se 1.5\n\njavajava(casting):\n\nlist<apple> box = new arraylist<apple>();\nbox.add(new apple());\napple apple =box.get(0);\n\n\n: boxapplelistgetapple:\n\napple apple = (apple)box.get(0);\n\n\n\n# \n\n\n\n\n# java7\n\n:\n\nmap<string, string> mymap = new hashmap<string, string>();\n\n\n:? java se 7:\n\nmap<string, string> mymap = new hashmap<>(); //"<>"\n\n\nhashmapnew hashmap<><>hashmap\n\n: java se 7: : java 7(java8):\n\nlist<string> list = new arraylist<>();\nlist.add("a");// addallcollection<? extends string>\nlist.addall(new arraylist<>());\n\n\n\n# java8\n\njava82:\n\n1.\n\n2.\n\n\n\nclass list<e> {\n   static <z> list<z> nil() { ... };\n   static <z> list<z> cons(z head, list<z> tail) { ... };\n   e head() { ... }\n}\n\n\njep101\n\n//\nlist<string> l = list.nil();\n//\n//list<string> l = list.<string>nil();\n//\nlist.cons(42, list.nil());\n//\n//list.cons(42, list.<integer>nil());\n\n\n\n# \n\njep101javajava ',charsets:{cjk:!0}},{title:"Java 8 - ",frontmatter:{},regularPath:"/java/java8/java8-type-anno.html",relativePath:"java/java8/java8-type-anno.md",key:"v-58b25868",path:"/java/java8/java8-type-anno.html",headers:[{level:2,title:"Java 8 - ",slug:"java-8-",normalizedTitle:"java 8 - ",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:87},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:101},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:187},{level:2,title:"JSR 308",slug:"jsr-308",normalizedTitle:"jsr 308",charIndex:206},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:221}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java 8 -     JSR 308 ",content:'# Java 8 - \n\n> Java 8 : @pdai\n> \n>  * JDK?\n>  * ?\n>  * ?\n>  * (JSR308)?\n\n * Java 8 - \n   * \n   * \n   * \n   * JSR 308\n   * \n\n\n# \n\n> java5? ?\n\n 1. java 8\n\n 2. java 8:\n\n\n\nnew @Interned MyObject();\n\n\n\n\nmyString = (@NonNull String) str;\n\n\nimplements \n\nclass UnmodifiableList<T> implements @Readonly List<@Readonly T> {  }\n\n\nthrow exception\n\nvoid monitorTemperature() throws @Critical TemperatureException {  }\n\n\njavaclass\n\n\n# \n\n\n\nCollections.emptyList().add("One");\nint i=Integer.parseInt("hello");\nSystem.console().readLine();\n\n\nUnsupportedOperationException NumberFormatExceptionNullPointerExceptionruntime error\n\nJavacheck frameworkruntime error\n\ncheck frameworkJava1+1>2javacantmaven, http://types.cs.washington.edu/checker-framework/ check framework:\n\nimport checkers.nullness.quals.*;\npublic class GetStarted {\n    void sample() {\n        @NonNull Object ref = new Object();\n    }\n}\n\n\njavac\n\njavac -processor checkers.nullness.NullnessChecker GetStarted.java\n\n\n\n\n@NonNull Object ref = null;\n\n\n\n\nGetStarted.java:5: incompatible types.\nfound   : @Nullable <nulltype>\nrequired: @NonNull Object\n        @NonNull Object ref = null;\n                              ^\n1 error\n\n\n\n# \n\nprocessorjavac GetStarted.javajava 8 with Type Annotation Supportjava 5,6,7javac@NonNullcheck framework nonnull/**/\n\nimport checkers.nullness.quals.*;\npublic class GetStarted {\n    void sample() {\n        /*@NonNull*/ Object ref = null;\n    }\n}\n\n\njavaccheck frameworkjavacnonnull +check frameworkruntime error\n\n\n# JSR 308\n\nJSR 308Java 1.5:\n\n * : \n * : bug\n\nJSR 308 :\n\n * Java: (method receivers: public int size() @Readonly {  })throwsjava 8\n * (pluggable type systems)check framework\n\nJSR308\n\n@NotEmpty List<@NonNull String> strings = new ArrayList<@NonNull String>()>\n\n\n\n\nvar strings = ["one", "two"];\n\n\nbug\n\n\n# \n\njava 8JSR 308',normalizedContent:'# java 8 - \n\n> java 8 : @pdai\n> \n>  * jdk?\n>  * ?\n>  * ?\n>  * (jsr308)?\n\n * java 8 - \n   * \n   * \n   * \n   * jsr 308\n   * \n\n\n# \n\n> java5? ?\n\n 1. java 8\n\n 2. java 8:\n\n\n\nnew @interned myobject();\n\n\n\n\nmystring = (@nonnull string) str;\n\n\nimplements \n\nclass unmodifiablelist<t> implements @readonly list<@readonly t> {  }\n\n\nthrow exception\n\nvoid monitortemperature() throws @critical temperatureexception {  }\n\n\njavaclass\n\n\n# \n\n\n\ncollections.emptylist().add("one");\nint i=integer.parseint("hello");\nsystem.console().readline();\n\n\nunsupportedoperationexception numberformatexceptionnullpointerexceptionruntime error\n\njavacheck frameworkruntime error\n\ncheck frameworkjava1+1>2javacantmaven, http://types.cs.washington.edu/checker-framework/ check framework:\n\nimport checkers.nullness.quals.*;\npublic class getstarted {\n    void sample() {\n        @nonnull object ref = new object();\n    }\n}\n\n\njavac\n\njavac -processor checkers.nullness.nullnesschecker getstarted.java\n\n\n\n\n@nonnull object ref = null;\n\n\n\n\ngetstarted.java:5: incompatible types.\nfound   : @nullable <nulltype>\nrequired: @nonnull object\n        @nonnull object ref = null;\n                              ^\n1 error\n\n\n\n# \n\nprocessorjavac getstarted.javajava 8 with type annotation supportjava 5,6,7javac@nonnullcheck framework nonnull/**/\n\nimport checkers.nullness.quals.*;\npublic class getstarted {\n    void sample() {\n        /*@nonnull*/ object ref = null;\n    }\n}\n\n\njavaccheck frameworkjavacnonnull +check frameworkruntime error\n\n\n# jsr 308\n\njsr 308java 1.5:\n\n * : \n * : bug\n\njsr 308 :\n\n * java: (method receivers: public int size() @readonly {  })throwsjava 8\n * (pluggable type systems)check framework\n\njsr308\n\n@notempty list<@nonnull string> strings = new arraylist<@nonnull string>()>\n\n\n\n\nvar strings = ["one", "two"];\n\n\nbug\n\n\n# \n\njava 8jsr 308',charsets:{cjk:!0}},{title:"Java8",frontmatter:{},regularPath:"/java/java8/java8.html",relativePath:"java/java8/java8.md",key:"v-6b101374",path:"/java/java8/java8.html",headers:[{level:2,title:"Java8",slug:"java8",normalizedTitle:"java8",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:10},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:160},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:172},{level:3,title:"Optional",slug:"optional",normalizedTitle:"optional",charIndex:184},{level:3,title:"default",slug:"default",normalizedTitle:"default",charIndex:201},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:218},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:230},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:242},{level:3,title:"JRE ",slug:"jre-",normalizedTitle:"jre ",charIndex:254},{level:3,title:"LocalDate/LocalDateTime",slug:"localdate-localdatetime",normalizedTitle:"localdate/localdatetime",charIndex:268},{level:3,title:"JavaFX",slug:"javafx",normalizedTitle:"javafx",charIndex:299},{level:3,title:"PermGen",slug:"permgen",normalizedTitle:"permgen",charIndex:313},{level:3,title:"StampedLock",slug:"stampedlock",normalizedTitle:"stampedlock",charIndex:330},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:349},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:359}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java8    Optional default    JRE  LocalDate/LocalDateTime JavaFX PermGen StampedLock  ",content:"# Java8\n\n> Java 8 @pdai\n> \n>  * Java  JSRJEP\n>  * JSR: https://jcp.org/en/jsr/detail?id=335\n\n * Java8\n   * \n   * \n     * \n     * Optional\n     * default\n     * \n     * \n     * \n     * JRE \n     * LocalDate/LocalDateTime\n     * JavaFX\n     * PermGen\n     * StampedLock\n     * \n   * \n\n\n# \n\n\n\n\n# \n\n\n# \n\n> \n\n * Lambda \n * Lambda Stream\n * ConsumerFunctionSupplier, Predicate.\n * Comparator\n\n: Java 8 - \n\n\n# Optional\n\n> nullisPresent()trueget()\n\n * Optional\n * Optional\n * Optional\n * Null\n\n: Java 8 - Optional\n\n\n# default\n\n> java 8Java 8lambdas\n\n * ?\n * ?\n * ?\n\n: Java 8 - default\n\n\n# \n\n> ? ?\n\n * JDK?\n * ?\n * ?\n * (JSR308)?\n\n: Java 8 - \n\n\n# \n\n * Java8?\n * Java8?\n\n: Java 8 - \n\n\n# \n\n> java\n\n * ?\n * Java7?\n * Java8?\n\n: Java 8 - \n\n\n# JRE \n\n> javaer, JREJREjava\n\n * Java8 JRE?\n * JRE3compact1compact2compact3?\n * ?\n\n: Java 8 - JRE\n\n\n# LocalDate/LocalDateTime\n\n> Date/Calendar, java8\n\n * Java8Date? (CalendarSimpleDateFormat)\n * Java8?\n * Java8Java8?\n * ?\n\n: Java 8 - LocalDate/LocalDateTime\n\n\n# JavaFX\n\n> JavaFXswingmediaaudio,video,graphics,animation,3DcssXUIXMLUI\n\n * javaFX?\n * Java8?\n\n: Java 8 - JavaFX\n\n\n# PermGen\n\n> PermGen spacePermanent Generation space,PermGen spaceOracle-Sun HotspotJRockitJ9\n\n * Java8 java.lang.OutOfMemoryError: PermGen space?\n * (Metaspace)\n * (Metaspace)PermGen\n\n: Java 8 - Permgen\n\n\n# StampedLock\n\n * StampedLock\n * Lock\n * StampedLock\n * \n\n: Java 8 - StampedLock\n\n\n# \n\n * Java8 \n   * \n   * Base64\n   * Random\n   * Nashorn\n   * ...\n\n: Java 8 - \n\n\n# \n\n> :\n\n * Java 8  https://wizardforcel.gitbooks.io/java8-tutorials/content/index.html\n\n * Java8gitbook https://wizardforcel.gitbooks.io/modern-java\n\n * Java8 https://github.com/wizardforcel/modern-java-zh\n\n * Java8 https://wizardforcel.gitbooks.io/java8-new-features/content/",normalizedContent:"# java8\n\n> java 8 @pdai\n> \n>  * java  jsrjep\n>  * jsr: https://jcp.org/en/jsr/detail?id=335\n\n * java8\n   * \n   * \n     * \n     * optional\n     * default\n     * \n     * \n     * \n     * jre \n     * localdate/localdatetime\n     * javafx\n     * permgen\n     * stampedlock\n     * \n   * \n\n\n# \n\n\n\n\n# \n\n\n# \n\n> \n\n * lambda \n * lambda stream\n * consumerfunctionsupplier, predicate.\n * comparator\n\n: java 8 - \n\n\n# optional\n\n> nullispresent()trueget()\n\n * optional\n * optional\n * optional\n * null\n\n: java 8 - optional\n\n\n# default\n\n> java 8java 8lambdas\n\n * ?\n * ?\n * ?\n\n: java 8 - default\n\n\n# \n\n> ? ?\n\n * jdk?\n * ?\n * ?\n * (jsr308)?\n\n: java 8 - \n\n\n# \n\n * java8?\n * java8?\n\n: java 8 - \n\n\n# \n\n> java\n\n * ?\n * java7?\n * java8?\n\n: java 8 - \n\n\n# jre \n\n> javaer, jrejrejava\n\n * java8 jre?\n * jre3compact1compact2compact3?\n * ?\n\n: java 8 - jre\n\n\n# localdate/localdatetime\n\n> date/calendar, java8\n\n * java8date? (calendarsimpledateformat)\n * java8?\n * java8java8?\n * ?\n\n: java 8 - localdate/localdatetime\n\n\n# javafx\n\n> javafxswingmediaaudio,video,graphics,animation,3dcssxuixmlui\n\n * javafx?\n * java8?\n\n: java 8 - javafx\n\n\n# permgen\n\n> permgen spacepermanent generation space,permgen spaceoracle-sun hotspotjrockitj9\n\n * java8 java.lang.outofmemoryerror: permgen space?\n * (metaspace)\n * (metaspace)permgen\n\n: java 8 - permgen\n\n\n# stampedlock\n\n * stampedlock\n * lock\n * stampedlock\n * \n\n: java 8 - stampedlock\n\n\n# \n\n * java8 \n   * \n   * base64\n   * random\n   * nashorn\n   * ...\n\n: java 8 - \n\n\n# \n\n> :\n\n * java 8  https://wizardforcel.gitbooks.io/java8-tutorials/content/index.html\n\n * java8gitbook https://wizardforcel.gitbooks.io/modern-java\n\n * java8 https://github.com/wizardforcel/modern-java-zh\n\n * java8 https://wizardforcel.gitbooks.io/java8-new-features/content/",charsets:{cjk:!0}},{title:"JUC: CAS, Unsafe",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-AtomicInteger.html",relativePath:"java/thread/java-thread-x-juc-AtomicInteger.md",key:"v-4a34de8e",path:"/java/thread/java-thread-x-juc-AtomicInteger.html",headers:[{level:2,title:"JUC: CAS, Unsafe",slug:"juc-cas-unsafe",normalizedTitle:"juc: cas, unsafe",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:199},{level:2,title:"CAS",slug:"cas",normalizedTitle:"cas",charIndex:10},{level:3,title:"CAS",slug:"cas",normalizedTitle:"cas",charIndex:231},{level:3,title:"CAS",slug:"cas",normalizedTitle:"cas",charIndex:245},{level:3,title:"CAS ",slug:"cas-",normalizedTitle:"cas ",charIndex:260},{level:2,title:"UnSafe",slug:"unsafe",normalizedTitle:"unsafe",charIndex:330},{level:3,title:"UnsafeCAS",slug:"unsafecas",normalizedTitle:"unsafecas",charIndex:347},{level:3,title:"Unsafe",slug:"unsafe",normalizedTitle:"unsafe",charIndex:365},{level:3,title:"Unsafe",slug:"unsafe",normalizedTitle:"unsafe",charIndex:381},{level:2,title:"AtomicInteger",slug:"atomicinteger",normalizedTitle:"atomicinteger",charIndex:397},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:418},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:430},{level:2,title:"12",slug:"-12",normalizedTitle:"12",charIndex:9745},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:461},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:477},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:491},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:507},{level:2,title:"AtomicStampedReferenceCASABA",slug:"atomicstampedreferencecasaba",normalizedTitle:"atomicstampedreferencecasaba",charIndex:520},{level:3,title:"AtomicStampedReferenceABA",slug:"atomicstampedreferenceaba",normalizedTitle:"atomicstampedreferenceaba",charIndex:564},{level:3,title:"",slug:"-2",normalizedTitle:"",charIndex:418},{level:3,title:"javaABA?",slug:"javaaba",normalizedTitle:"javaaba?",charIndex:613},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:640}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: CAS, Unsafe BAT CAS CAS CAS CAS  UnSafe UnsafeCAS Unsafe Unsafe AtomicInteger   12     AtomicStampedReferenceCASABA AtomicStampedReferenceABA  javaABA? ",content:'# JUC: CAS, Unsafe\n\n> JUCvolatileCASCASSynchronizedLock; javaCASCASUnsafeCAS, Unsafe\n\n * JUC: CAS, Unsafe\n   * BAT\n   * CAS\n     * CAS\n     * CAS\n     * CAS \n       * ABA\n       * \n       * \n   * UnSafe\n     * UnsafeCAS\n     * Unsafe\n     * Unsafe\n   * AtomicInteger\n     * \n     * \n   * 13\n     * \n     * \n     * \n     * \n   * AtomicStampedReferenceCASABA\n     * AtomicStampedReferenceABA\n     * \n     * javaABA?\n   * \n\n\n# BAT\n\n\n\n\n\n * ?\n * CAS?\n * CASAtomicInteger?\n * CAS?\n * Java?\n * AtomicInteger? CAS+volatile\n * Unsafe?\n * Java? 134\n * AtomicStampedReference?\n * AtomicStampedReferenceABA? Pair\n * javaABA? AtomicMarkableReference\n\n\n# CAS\n\n:\n\n * : synchronized  ReentrantLock\n * : CAS, AtomicXXXX\n * : Thread Local\n\nCAS\n\n\n# CAS\n\nCASCompare-And-SwapCPUCPUCASJVMAtomicInteger  CAS()\n\nCASCASJDKCAS(synchronized )\n\nsqlsqlupdate set id=3 from table where id=2sqlsql\n\n\n# CAS\n\nCASsynchronized(LockLockAQSCAS)\n\npublic class Test {\n    private int i=0;\n    public synchronized int add(){\n        return i++;\n    }\n}\n\n\njavaAtomicInteger (CAS)\n\npublic class Test {\n    private  AtomicInteger i = new AtomicInteger(0);\n    public int add(){\n        return i.addAndGet(1);\n    }\n}\n\n\n\n# CAS \n\nCAS synchronized  CAS \n\n CAS \n\n# ABA\n\nCASABACAS\n\nABA1A->B->A1A->2B->3A\n\nJava 1.5JDKAtomicAtomicStampedReferenceABAcompareAndSet\n\n# \n\nCASCPUJVMpausepause(de-pipeline)CPU(Memory Order Violation)CPU(CPU Pipeline Flush)CPU\n\n# \n\nCASCAS\n\ni = 2j = aij = 2aCASij\n\nJava 1.5JDKAtomicReferenceCAS\n\n\n# UnSafe\n\n> JavaUnSafeUnSafeUnSafeJ.U.CCAS\n\nUnsafesun.miscJavaJavaUnsafeJavaCUnsafeJavaUnsafe\n\n public JDK API  Unsafe  JDK \n\nUnSafe\n\n\n\nUnsafeAPICASClass\n\n\n# UnsafeCAS\n\n\n\npublic final int getAndAddInt(Object paramObject, long paramLong, int paramInt)\n  {\n    int i;\n    do\n      i = getIntVolatile(paramObject, paramLong);\n    while (!compareAndSwapInt(paramObject, paramLong, i, i + paramInt));\n    return i;\n  }\n\n  public final long getAndAddLong(Object paramObject, long paramLong1, long paramLong2)\n  {\n    long l;\n    do\n      l = getLongVolatile(paramObject, paramLong1);\n    while (!compareAndSwapLong(paramObject, paramLong1, l, l + paramLong2));\n    return l;\n  }\n\n  public final int getAndSetInt(Object paramObject, long paramLong, int paramInt)\n  {\n    int i;\n    do\n      i = getIntVolatile(paramObject, paramLong);\n    while (!compareAndSwapInt(paramObject, paramLong, i, paramInt));\n    return i;\n  }\n\n  public final long getAndSetLong(Object paramObject, long paramLong1, long paramLong2)\n  {\n    long l;\n    do\n      l = getLongVolatile(paramObject, paramLong1);\n    while (!compareAndSwapLong(paramObject, paramLong1, l, paramLong2));\n    return l;\n  }\n\n  public final Object getAndSetObject(Object paramObject1, long paramLong, Object paramObject2)\n  {\n    Object localObject;\n    do\n      localObject = getObjectVolatile(paramObject1, paramLong);\n    while (!compareAndSwapObject(paramObject1, paramLong, localObject, paramObject2));\n    return localObject;\n  }\n\n\nCAS(whileCAS)\n\nUnsafe\n\npublic final native boolean compareAndSwapObject(Object paramObject1, long paramLong, Object paramObject2, Object paramObject3);\n\npublic final native boolean compareAndSwapInt(Object paramObject, long paramLong, int paramInt1, int paramInt2);\n\npublic final native boolean compareAndSwapLong(Object paramObject, long paramLong1, long paramLong2, long paramLong3);\n\n\nUnsafe3CAScompareAndSwapObjectcompareAndSwapIntcompareAndSwapLongnative\n\n\n# Unsafe\n\nUnsafecompareAndSwap*CASunsafe.cpp\n\nUNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))\n  UnsafeWrapper("Unsafe_CompareAndSwapInt");\n  oop p = JNIHandles::resolve(obj);\n  jint* addr = (jint *) index_oop_from_field_offset_long(p, offset);\n  return (jint)(Atomic::cmpxchg(x, addr, e)) == e;\nUNSAFE_END\n\n\n Atomic::cmpxchg xe\n\nLinuxx86Atomic::cmpxchg\n\ninline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {\n  int mp = os::is_MP();\n  __asm__ volatile (LOCK_IF_MP(%4) "cmpxchgl %1,(%3)"\n                    : "=a" (exchange_value)\n                    : "r" (exchange_value), "a" (compare_value), "r" (dest), "r" (mp)\n                    : "cc", "memory");\n  return exchange_value;\n}\n\n\nwindowsx86\n\ninline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {\n    int mp = os::isMP(); //\n    _asm {\n        mov edx, dest\n        mov ecx, exchange_value\n        mov eax, compare_value\n        LOCK_IF_MP(mp)\n        cmpxchg dword ptr [edx], ecx\n    }\n}\n\n// Adding a lock prefix to an instruction on MP machine\n// VC++ doesn\'t like the lock prefix to be on a single line\n// so we can\'t insert a label after the lock prefix.\n// By emitting a lock prefix, we can define a label after it.\n#define LOCK_IF_MP(mp) __asm cmp mp, 0  \\\n                       __asm je L0      \\\n                       __asm _emit 0xF0 \\\n                       __asm L0:\n\n\ncmpxchglocklock(lock)lock()\n\n> cmpxchg(void* ptr, int old, int new)ptroldnewptrptrIntellock cmpxchglockptrblock\n\n\n# Unsafe\n\nUnsafe  Java \n\n\n\npublic native long staticFieldOffset(Field paramField);\n\n\n paramField  field \n\n\n\npublic native int arrayBaseOffset(Class paramClass);\npublic native int arrayIndexScale(Class paramClass);\n\n\n\n\n\n\npublic native long allocateMemory(long paramLong);\npublic native long reallocateMemory(long paramLong1, long paramLong2);\npublic native void freeMemory(long paramLong);\n\n\n\n\n> JavaUnsafe\n\n\n# AtomicInteger\n\n\n# \n\n AtomicInteger  API\n\npublic final int get()\npublic final int getAndSet(int newValue)\npublic final int getAndIncrement()\npublic final int getAndDecrement()\npublic final int getAndAdd(int delta)\nvoid lazySet(int newValue): newValue,lazySet\n\n\n Integer \n\nprivate volatile int count = 0;\n//  count++\npublic synchronized void increment() {\n    count++;\n}\npublic int getCount() {\n    return count;\n}\n\n\n AtomicInteger \n\nprivate AtomicInteger count = new AtomicInteger();\npublic void increment() {\n    count.incrementAndGet();\n}\n//  AtomicInteger \npublic int getCount() {\n    return count.get();\n}\n\n\n\n# \n\npublic class AtomicInteger extends Number implements java.io.Serializable {\n    private static final Unsafe unsafe = Unsafe.getUnsafe();\n    private static final long valueOffset;\n    static {\n        try {\n            //value\n            valueOffset = unsafe.objectFieldOffset(AtomicInteger.class.getDeclaredField("value"));\n        } catch (Exception ex) { throw new Error(ex); }\n    }\n\n    private volatile int value;\n\n    //\n    public final int get() {\n        return value;\n    }\n\n    //detla\n    public final int getAndAdd(int delta) {\n        //1 2value 3value(value+delta)\n        return unsafe.getAndAddInt(this, valueOffset, delta);\n    }\n\n    //1\n    public final int incrementAndGet() {\n        return unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n    }\n...\n}\n\n\n AtomicInteger volatileCAS\n\n * volatile\n * CAS \n\n\n# 12\n\n> JDK12\n\n\n# \n\nAtomic3\n\n * AtomicBoolean: \n * AtomicInteger: \n * AtomicLong: \n\n3AtomicInteger\n\n\n# \n\nAtomic3\n\n * AtomicIntegerArray: \n * AtomicLongArray: \n * AtomicReferenceArray: \n\n\n\n * get(int index)index\n * compareAndSet(int i,E expect,E update): iupdate\n\nAtomicIntegerArray\n\nimport java.util.concurrent.atomic.AtomicIntegerArray;\n\npublic class Demo5 {\n    public static void main(String[] args) throws InterruptedException {\n        AtomicIntegerArray array = new AtomicIntegerArray(new int[] { 0, 0 });\n        System.out.println(array);\n        System.out.println(array.getAndAdd(1, 2));\n        System.out.println(array);\n    }\n}\n\n\n\n\n\n# \n\nAtomic\n\n * AtomicReference: \n * AtomicStampedReference: , Pair\n * AtomicMarkableReferce: \n\nsetAtomiccompareAndSetUnsafeAtomicReferenceFieldUpdatervolatile\n\nAtomicReference\n\nimport java.util.concurrent.atomic.AtomicReference;\n\npublic class AtomicReferenceTest {\n    \n    public static void main(String[] args){\n\n        // Personid101102\n        Person p1 = new Person(101);\n        Person p2 = new Person(102);\n        // AtomicReferencep1\n        AtomicReference ar = new AtomicReference(p1);\n        // CASararp1p2\n        ar.compareAndSet(p1, p2);\n\n        Person p3 = (Person)ar.get();\n        System.out.println("p3 is "+p3);\n        System.out.println("p3.equals(p1)="+p3.equals(p1));\n    }\n}\n\nclass Person {\n    volatile long id;\n    public Person(long id) {\n        this.id = id;\n    }\n    public String toString() {\n        return "id:"+id;\n    }\n}\n\n\n\n\np3 is id:102\np3.equals(p1)=false\n\n\n\n\n * AtomicReferencearp1\n * CASarp1p2\n * arp3.equals(p1)falsePersonequals()Object.javaequals()Object.javaequals()"=="\n\n\n# \n\nAtomic\n\n * AtomicIntegerFieldUpdater: \n * AtomicLongFieldUpdater: \n * AtomicReferenceFieldUpdater: \n\n:\n\n * newUpdater()\n * public volatile\n\n\n\npublic class TestAtomicIntegerFieldUpdater {\n\n    public static void main(String[] args){\n        TestAtomicIntegerFieldUpdater tIA = new TestAtomicIntegerFieldUpdater();\n        tIA.doIt();\n    }\n\n    public AtomicIntegerFieldUpdater<DataDemo> updater(String name){\n        return AtomicIntegerFieldUpdater.newUpdater(DataDemo.class,name);\n\n    }\n\n    public void doIt(){\n        DataDemo data = new DataDemo();\n        System.out.println("publicVar = "+updater("publicVar").getAndAdd(data, 2));\n        /*\n            * DataDemovalue2/value3,TestAtomicIntegerFieldUpdater\n            * */\n        //System.out.println("protectedVar = "+updater("protectedVar").getAndAdd(data,2));\n        //System.out.println("privateVar = "+updater("privateVar").getAndAdd(data,2));\n\n        //System.out.println("staticVar = "+updater("staticVar").getAndIncrement(data));//java.lang.IllegalArgumentException\n        /*\n            * must be integer\n            * */\n        //System.out.println("integerVar = "+updater("integerVar").getAndIncrement(data));\n        //System.out.println("longVar = "+updater("longVar").getAndIncrement(data));\n    }\n\n}\n\nclass DataDemo{\n    public volatile int publicVar=3;\n    protected volatile int protectedVar=4;\n    private volatile  int privateVar=5;\n\n    public volatile static int staticVar = 10;\n    //public  final int finalVar = 11;\n\n    public volatile Integer integerVar = 19;\n    public volatile Long longVar = 18L;\n\n}\n\n\nAtomicIntegerFieldUpdater \n\n * volatile.eg:volatile int value = 3\n\n * (public/protected/default/private)\n\n * static\n\n * finalfinalfinalvolatile\n\n * AtomicIntegerFieldUpdaterAtomicLongFieldUpdaterint/long(Integer/Long)AtomicReferenceFieldUpdater\n\n\n# AtomicStampedReferenceCASABA\n\n\n# AtomicStampedReferenceABA\n\nAtomicStampedReference"stamp"pairABA\n\npublic class AtomicStampedReference<V> {\n    private static class Pair<T> {\n        final T reference;  //\n        final int stamp;  //\n        private Pair(T reference, int stamp) {\n            this.reference = reference;\n            this.stamp = stamp;\n        }\n        static <T> Pair<T> of(T reference, int stamp) {\n            return new Pair<T>(reference, stamp);\n        }\n    }\n    private volatile Pair<V> pair;\n    ....\n    \n    /**\n      * expectedReference \n      * newReference : \n      * expectedStamp : \n      * newStamp : \n      */\n    public boolean compareAndSet(V   expectedReference,\n                             V   newReference,\n                             int expectedStamp,\n                             int newStamp) {\n        // ()\n        Pair<V> current = pair;\n        return\n            // \n            expectedReference == current.reference &&\n            // \n            expectedStamp == current.stamp &&\n            // \n            ((newReference == current.reference &&\n            // \n            newStamp == current.stamp) ||\n            // PairCAS\n            casPair(current, Pair.of(newReference, newStamp)));\n    }\n\n    private boolean casPair(Pair<V> cmp, Pair<V> val) {\n        // UnsafecompareAndSwapObject()CASpair\n        return UNSAFE.compareAndSwapObject(this, pairOffset, cmp, val);\n    }\n\n\n * true\n\n * PairCASpair\n\njavaABA\n\n * \n\n * (Pair)PairCAS\n\n * (Pair)\n\n\n# \n\npublic class AtomicTester {\n\n    private static AtomicStampedReference<Integer> atomicStampedRef =\n            new AtomicStampedReference<>(1, 0);\n\n    public static void main(String[] args){\n        first().start();\n        second().start();\n    }\n\n    private static Thread first() {\n        return new Thread(() -> {\n            System.out.println("" + Thread.currentThread() +", a = " + atomicStampedRef.getReference());\n            int stamp = atomicStampedRef.getStamp(); //\n            try {\n                Thread.sleep(1000); //1 \n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            boolean isCASSuccess = atomicStampedRef.compareAndSet(1,2,stamp,stamp +1);  //expectedReferencestamp,CAS\n            System.out.println("" + Thread.currentThread() +",CAS: " + isCASSuccess);\n        },"");\n    }\n\n    private static Thread second() {\n        return new Thread(() -> {\n            Thread.yield(); // thread-first \n            atomicStampedRef.compareAndSet(1,2,atomicStampedRef.getStamp(),atomicStampedRef.getStamp() +1);\n            System.out.println("" + Thread.currentThread() +",increment , = "+ atomicStampedRef.getReference());\n            atomicStampedRef.compareAndSet(2,1,atomicStampedRef.getStamp(),atomicStampedRef.getStamp() +1);\n            System.out.println("" + Thread.currentThread() +",decrement , = "+ atomicStampedRef.getReference());\n        },"");\n    }\n}\n\n\n\n\nThread[,5,main], a = 1\nThread[,5,main],increment , = 2\nThread[,5,main],decrement , = 1\nThread[,5,main],CAS: false\n\n\n\n# javaABA?\n\nAtomicMarkableReferenceboolean\n\n\n# \n\n * https://benjaminwhx.com/2018/05/03/%E3%80%90%E7%BB%86%E8%B0%88Java%E5%B9%B6%E5%8F%91%E3%80%91%E8%B0%88%E8%B0%88CAS/\n * https://www.jianshu.com/p/9a1e6940987a\n * https://www.jianshu.com/p/a533cbb740c6\n * https://blog.csdn.net/qq_36236890/article/details/81914871\n * https://www.cnblogs.com/lodor/p/7492805.html\n * https://blog.csdn.net/u010412719/article/details/52068888\n * https://www.jianshu.com/p/18dfc5fa0171\n * https://www.jianshu.com/p/8b227a8adbc1\n * https://www.jianshu.com/p/77f75b398be9\n * https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-AtomicInteger.html',normalizedContent:'# juc: cas, unsafe\n\n> jucvolatilecascassynchronizedlock; javacascasunsafecas, unsafe\n\n * juc: cas, unsafe\n   * bat\n   * cas\n     * cas\n     * cas\n     * cas \n       * aba\n       * \n       * \n   * unsafe\n     * unsafecas\n     * unsafe\n     * unsafe\n   * atomicinteger\n     * \n     * \n   * 13\n     * \n     * \n     * \n     * \n   * atomicstampedreferencecasaba\n     * atomicstampedreferenceaba\n     * \n     * javaaba?\n   * \n\n\n# bat\n\n\n\n\n\n * ?\n * cas?\n * casatomicinteger?\n * cas?\n * java?\n * atomicinteger? cas+volatile\n * unsafe?\n * java? 134\n * atomicstampedreference?\n * atomicstampedreferenceaba? pair\n * javaaba? atomicmarkablereference\n\n\n# cas\n\n:\n\n * : synchronized  reentrantlock\n * : cas, atomicxxxx\n * : thread local\n\ncas\n\n\n# cas\n\ncascompare-and-swapcpucpucasjvmatomicinteger  cas()\n\ncascasjdkcas(synchronized )\n\nsqlsqlupdate set id=3 from table where id=2sqlsql\n\n\n# cas\n\ncassynchronized(locklockaqscas)\n\npublic class test {\n    private int i=0;\n    public synchronized int add(){\n        return i++;\n    }\n}\n\n\njavaatomicinteger (cas)\n\npublic class test {\n    private  atomicinteger i = new atomicinteger(0);\n    public int add(){\n        return i.addandget(1);\n    }\n}\n\n\n\n# cas \n\ncas synchronized  cas \n\n cas \n\n# aba\n\ncasabacas\n\naba1a->b->a1a->2b->3a\n\njava 1.5jdkatomicatomicstampedreferenceabacompareandset\n\n# \n\ncascpujvmpausepause(de-pipeline)cpu(memory order violation)cpu(cpu pipeline flush)cpu\n\n# \n\ncascas\n\ni = 2j = aij = 2acasij\n\njava 1.5jdkatomicreferencecas\n\n\n# unsafe\n\n> javaunsafeunsafeunsafej.u.ccas\n\nunsafesun.miscjavajavaunsafejavacunsafejavaunsafe\n\n public jdk api  unsafe  jdk \n\nunsafe\n\n\n\nunsafeapicasclass\n\n\n# unsafecas\n\n\n\npublic final int getandaddint(object paramobject, long paramlong, int paramint)\n  {\n    int i;\n    do\n      i = getintvolatile(paramobject, paramlong);\n    while (!compareandswapint(paramobject, paramlong, i, i + paramint));\n    return i;\n  }\n\n  public final long getandaddlong(object paramobject, long paramlong1, long paramlong2)\n  {\n    long l;\n    do\n      l = getlongvolatile(paramobject, paramlong1);\n    while (!compareandswaplong(paramobject, paramlong1, l, l + paramlong2));\n    return l;\n  }\n\n  public final int getandsetint(object paramobject, long paramlong, int paramint)\n  {\n    int i;\n    do\n      i = getintvolatile(paramobject, paramlong);\n    while (!compareandswapint(paramobject, paramlong, i, paramint));\n    return i;\n  }\n\n  public final long getandsetlong(object paramobject, long paramlong1, long paramlong2)\n  {\n    long l;\n    do\n      l = getlongvolatile(paramobject, paramlong1);\n    while (!compareandswaplong(paramobject, paramlong1, l, paramlong2));\n    return l;\n  }\n\n  public final object getandsetobject(object paramobject1, long paramlong, object paramobject2)\n  {\n    object localobject;\n    do\n      localobject = getobjectvolatile(paramobject1, paramlong);\n    while (!compareandswapobject(paramobject1, paramlong, localobject, paramobject2));\n    return localobject;\n  }\n\n\ncas(whilecas)\n\nunsafe\n\npublic final native boolean compareandswapobject(object paramobject1, long paramlong, object paramobject2, object paramobject3);\n\npublic final native boolean compareandswapint(object paramobject, long paramlong, int paramint1, int paramint2);\n\npublic final native boolean compareandswaplong(object paramobject, long paramlong1, long paramlong2, long paramlong3);\n\n\nunsafe3cascompareandswapobjectcompareandswapintcompareandswaplongnative\n\n\n# unsafe\n\nunsafecompareandswap*casunsafe.cpp\n\nunsafe_entry(jboolean, unsafe_compareandswapint(jnienv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))\n  unsafewrapper("unsafe_compareandswapint");\n  oop p = jnihandles::resolve(obj);\n  jint* addr = (jint *) index_oop_from_field_offset_long(p, offset);\n  return (jint)(atomic::cmpxchg(x, addr, e)) == e;\nunsafe_end\n\n\n atomic::cmpxchg xe\n\nlinuxx86atomic::cmpxchg\n\ninline jint atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {\n  int mp = os::is_mp();\n  __asm__ volatile (lock_if_mp(%4) "cmpxchgl %1,(%3)"\n                    : "=a" (exchange_value)\n                    : "r" (exchange_value), "a" (compare_value), "r" (dest), "r" (mp)\n                    : "cc", "memory");\n  return exchange_value;\n}\n\n\nwindowsx86\n\ninline jint atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {\n    int mp = os::ismp(); //\n    _asm {\n        mov edx, dest\n        mov ecx, exchange_value\n        mov eax, compare_value\n        lock_if_mp(mp)\n        cmpxchg dword ptr [edx], ecx\n    }\n}\n\n// adding a lock prefix to an instruction on mp machine\n// vc++ doesn\'t like the lock prefix to be on a single line\n// so we can\'t insert a label after the lock prefix.\n// by emitting a lock prefix, we can define a label after it.\n#define lock_if_mp(mp) __asm cmp mp, 0  \\\n                       __asm je l0      \\\n                       __asm _emit 0xf0 \\\n                       __asm l0:\n\n\ncmpxchglocklock(lock)lock()\n\n> cmpxchg(void* ptr, int old, int new)ptroldnewptrptrintellock cmpxchglockptrblock\n\n\n# unsafe\n\nunsafe  java \n\n\n\npublic native long staticfieldoffset(field paramfield);\n\n\n paramfield  field \n\n\n\npublic native int arraybaseoffset(class paramclass);\npublic native int arrayindexscale(class paramclass);\n\n\n\n\n\n\npublic native long allocatememory(long paramlong);\npublic native long reallocatememory(long paramlong1, long paramlong2);\npublic native void freememory(long paramlong);\n\n\n\n\n> javaunsafe\n\n\n# atomicinteger\n\n\n# \n\n atomicinteger  api\n\npublic final int get()\npublic final int getandset(int newvalue)\npublic final int getandincrement()\npublic final int getanddecrement()\npublic final int getandadd(int delta)\nvoid lazyset(int newvalue): newvalue,lazyset\n\n\n integer \n\nprivate volatile int count = 0;\n//  count++\npublic synchronized void increment() {\n    count++;\n}\npublic int getcount() {\n    return count;\n}\n\n\n atomicinteger \n\nprivate atomicinteger count = new atomicinteger();\npublic void increment() {\n    count.incrementandget();\n}\n//  atomicinteger \npublic int getcount() {\n    return count.get();\n}\n\n\n\n# \n\npublic class atomicinteger extends number implements java.io.serializable {\n    private static final unsafe unsafe = unsafe.getunsafe();\n    private static final long valueoffset;\n    static {\n        try {\n            //value\n            valueoffset = unsafe.objectfieldoffset(atomicinteger.class.getdeclaredfield("value"));\n        } catch (exception ex) { throw new error(ex); }\n    }\n\n    private volatile int value;\n\n    //\n    public final int get() {\n        return value;\n    }\n\n    //detla\n    public final int getandadd(int delta) {\n        //1 2value 3value(value+delta)\n        return unsafe.getandaddint(this, valueoffset, delta);\n    }\n\n    //1\n    public final int incrementandget() {\n        return unsafe.getandaddint(this, valueoffset, 1) + 1;\n    }\n...\n}\n\n\n atomicinteger volatilecas\n\n * volatile\n * cas \n\n\n# 12\n\n> jdk12\n\n\n# \n\natomic3\n\n * atomicboolean: \n * atomicinteger: \n * atomiclong: \n\n3atomicinteger\n\n\n# \n\natomic3\n\n * atomicintegerarray: \n * atomiclongarray: \n * atomicreferencearray: \n\n\n\n * get(int index)index\n * compareandset(int i,e expect,e update): iupdate\n\natomicintegerarray\n\nimport java.util.concurrent.atomic.atomicintegerarray;\n\npublic class demo5 {\n    public static void main(string[] args) throws interruptedexception {\n        atomicintegerarray array = new atomicintegerarray(new int[] { 0, 0 });\n        system.out.println(array);\n        system.out.println(array.getandadd(1, 2));\n        system.out.println(array);\n    }\n}\n\n\n\n\n\n# \n\natomic\n\n * atomicreference: \n * atomicstampedreference: , pair\n * atomicmarkablereferce: \n\nsetatomiccompareandsetunsafeatomicreferencefieldupdatervolatile\n\natomicreference\n\nimport java.util.concurrent.atomic.atomicreference;\n\npublic class atomicreferencetest {\n    \n    public static void main(string[] args){\n\n        // personid101102\n        person p1 = new person(101);\n        person p2 = new person(102);\n        // atomicreferencep1\n        atomicreference ar = new atomicreference(p1);\n        // casararp1p2\n        ar.compareandset(p1, p2);\n\n        person p3 = (person)ar.get();\n        system.out.println("p3 is "+p3);\n        system.out.println("p3.equals(p1)="+p3.equals(p1));\n    }\n}\n\nclass person {\n    volatile long id;\n    public person(long id) {\n        this.id = id;\n    }\n    public string tostring() {\n        return "id:"+id;\n    }\n}\n\n\n\n\np3 is id:102\np3.equals(p1)=false\n\n\n\n\n * atomicreferencearp1\n * casarp1p2\n * arp3.equals(p1)falsepersonequals()object.javaequals()object.javaequals()"=="\n\n\n# \n\natomic\n\n * atomicintegerfieldupdater: \n * atomiclongfieldupdater: \n * atomicreferencefieldupdater: \n\n:\n\n * newupdater()\n * public volatile\n\n\n\npublic class testatomicintegerfieldupdater {\n\n    public static void main(string[] args){\n        testatomicintegerfieldupdater tia = new testatomicintegerfieldupdater();\n        tia.doit();\n    }\n\n    public atomicintegerfieldupdater<datademo> updater(string name){\n        return atomicintegerfieldupdater.newupdater(datademo.class,name);\n\n    }\n\n    public void doit(){\n        datademo data = new datademo();\n        system.out.println("publicvar = "+updater("publicvar").getandadd(data, 2));\n        /*\n            * datademovalue2/value3,testatomicintegerfieldupdater\n            * */\n        //system.out.println("protectedvar = "+updater("protectedvar").getandadd(data,2));\n        //system.out.println("privatevar = "+updater("privatevar").getandadd(data,2));\n\n        //system.out.println("staticvar = "+updater("staticvar").getandincrement(data));//java.lang.illegalargumentexception\n        /*\n            * must be integer\n            * */\n        //system.out.println("integervar = "+updater("integervar").getandincrement(data));\n        //system.out.println("longvar = "+updater("longvar").getandincrement(data));\n    }\n\n}\n\nclass datademo{\n    public volatile int publicvar=3;\n    protected volatile int protectedvar=4;\n    private volatile  int privatevar=5;\n\n    public volatile static int staticvar = 10;\n    //public  final int finalvar = 11;\n\n    public volatile integer integervar = 19;\n    public volatile long longvar = 18l;\n\n}\n\n\natomicintegerfieldupdater \n\n * volatile.eg:volatile int value = 3\n\n * (public/protected/default/private)\n\n * static\n\n * finalfinalfinalvolatile\n\n * atomicintegerfieldupdateratomiclongfieldupdaterint/long(integer/long)atomicreferencefieldupdater\n\n\n# atomicstampedreferencecasaba\n\n\n# atomicstampedreferenceaba\n\natomicstampedreference"stamp"pairaba\n\npublic class atomicstampedreference<v> {\n    private static class pair<t> {\n        final t reference;  //\n        final int stamp;  //\n        private pair(t reference, int stamp) {\n            this.reference = reference;\n            this.stamp = stamp;\n        }\n        static <t> pair<t> of(t reference, int stamp) {\n            return new pair<t>(reference, stamp);\n        }\n    }\n    private volatile pair<v> pair;\n    ....\n    \n    /**\n      * expectedreference \n      * newreference : \n      * expectedstamp : \n      * newstamp : \n      */\n    public boolean compareandset(v   expectedreference,\n                             v   newreference,\n                             int expectedstamp,\n                             int newstamp) {\n        // ()\n        pair<v> current = pair;\n        return\n            // \n            expectedreference == current.reference &&\n            // \n            expectedstamp == current.stamp &&\n            // \n            ((newreference == current.reference &&\n            // \n            newstamp == current.stamp) ||\n            // paircas\n            caspair(current, pair.of(newreference, newstamp)));\n    }\n\n    private boolean caspair(pair<v> cmp, pair<v> val) {\n        // unsafecompareandswapobject()caspair\n        return unsafe.compareandswapobject(this, pairoffset, cmp, val);\n    }\n\n\n * true\n\n * paircaspair\n\njavaaba\n\n * \n\n * (pair)paircas\n\n * (pair)\n\n\n# \n\npublic class atomictester {\n\n    private static atomicstampedreference<integer> atomicstampedref =\n            new atomicstampedreference<>(1, 0);\n\n    public static void main(string[] args){\n        first().start();\n        second().start();\n    }\n\n    private static thread first() {\n        return new thread(() -> {\n            system.out.println("" + thread.currentthread() +", a = " + atomicstampedref.getreference());\n            int stamp = atomicstampedref.getstamp(); //\n            try {\n                thread.sleep(1000); //1 \n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            boolean iscassuccess = atomicstampedref.compareandset(1,2,stamp,stamp +1);  //expectedreferencestamp,cas\n            system.out.println("" + thread.currentthread() +",cas: " + iscassuccess);\n        },"");\n    }\n\n    private static thread second() {\n        return new thread(() -> {\n            thread.yield(); // thread-first \n            atomicstampedref.compareandset(1,2,atomicstampedref.getstamp(),atomicstampedref.getstamp() +1);\n            system.out.println("" + thread.currentthread() +",increment , = "+ atomicstampedref.getreference());\n            atomicstampedref.compareandset(2,1,atomicstampedref.getstamp(),atomicstampedref.getstamp() +1);\n            system.out.println("" + thread.currentthread() +",decrement , = "+ atomicstampedref.getreference());\n        },"");\n    }\n}\n\n\n\n\nthread[,5,main], a = 1\nthread[,5,main],increment , = 2\nthread[,5,main],decrement , = 1\nthread[,5,main],cas: false\n\n\n\n# javaaba?\n\natomicmarkablereferenceboolean\n\n\n# \n\n * https://benjaminwhx.com/2018/05/03/%e3%80%90%e7%bb%86%e8%b0%88java%e5%b9%b6%e5%8f%91%e3%80%91%e8%b0%88%e8%b0%88cas/\n * https://www.jianshu.com/p/9a1e6940987a\n * https://www.jianshu.com/p/a533cbb740c6\n * https://blog.csdn.net/qq_36236890/article/details/81914871\n * https://www.cnblogs.com/lodor/p/7492805.html\n * https://blog.csdn.net/u010412719/article/details/52068888\n * https://www.jianshu.com/p/18dfc5fa0171\n * https://www.jianshu.com/p/8b227a8adbc1\n * https://www.jianshu.com/p/77f75b398be9\n * https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-atomicinteger.html',charsets:{cjk:!0}},{title:"JUC: BlockingQueue",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-collection-BlockingQueue.html",relativePath:"java/thread/java-thread-x-juc-collection-BlockingQueue.md",key:"v-4c4bcd8c",path:"/java/thread/java-thread-x-juc-collection-BlockingQueue.html",headers:[{level:2,title:"JUC: BlockingQueue",slug:"juc-blockingqueue",normalizedTitle:"juc: blockingqueue",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:166},{level:2,title:"BlockingQueueBlockingDeque",slug:"blockingqueueblockingdeque",normalizedTitle:"blockingqueueblockingdeque",charIndex:187},{level:3,title:"BlockingQueue",slug:"blockingqueue",normalizedTitle:"blockingqueue",charIndex:9},{level:3,title:"BlockingQueue ",slug:"blockingqueue-",normalizedTitle:"blockingqueue ",charIndex:243},{level:3,title:"BlockingDeque",slug:"blockingdeque",normalizedTitle:"blockingdeque",charIndex:201},{level:3,title:"BlockingDeque ",slug:"blockingdeque-",normalizedTitle:"blockingdeque ",charIndex:289},{level:3,title:"BlockingDeque BlockingQueue",slug:"blockingdeque-blockingqueue",normalizedTitle:"blockingdeque blockingqueue",charIndex:314},{level:2,title:"BlockingQueue ",slug:"blockingqueue-",normalizedTitle:"blockingqueue ",charIndex:350},{level:3,title:" ArrayBlockingQueue",slug:"-arrayblockingqueue",normalizedTitle:" arrayblockingqueue",charIndex:375},{level:3,title:" DelayQueue",slug:"-delayqueue",normalizedTitle:" delayqueue",charIndex:408},{level:3,title:" LinkedBlockingQueue",slug:"-linkedblockingqueue",normalizedTitle:" linkedblockingqueue",charIndex:431},{level:3,title:" PriorityBlockingQueue",slug:"-priorityblockingqueue",normalizedTitle:" priorityblockingqueue",charIndex:464},{level:3,title:" SynchronousQueue",slug:"-synchronousqueue",normalizedTitle:" synchronousqueue",charIndex:504},{level:2,title:"BlockingDeque ",slug:"blockingdeque-",normalizedTitle:"blockingdeque ",charIndex:531},{level:3,title:" LinkedBlockingDeque",slug:"-linkedblockingdeque",normalizedTitle:" linkedblockingdeque",charIndex:556},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:589}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: BlockingQueue BAT BlockingQueueBlockingDeque BlockingQueue BlockingQueue  BlockingDeque BlockingDeque  BlockingDeque BlockingQueue BlockingQueue   ArrayBlockingQueue  DelayQueue  LinkedBlockingQueue  PriorityBlockingQueue  SynchronousQueue BlockingDeque   LinkedBlockingDeque ",content:'# JUC: BlockingQueue\n\n> JUC BlockingQueue  BlockingQueue Java  BlockingQueue\n\n * JUC: BlockingQueue\n   * BAT\n   * BlockingQueueBlockingDeque\n     * BlockingQueue\n     * BlockingQueue \n     * BlockingDeque\n     * BlockingDeque \n     * BlockingDeque BlockingQueue\n   * BlockingQueue \n     *  ArrayBlockingQueue\n     *  DelayQueue\n     *  LinkedBlockingQueue\n     *  PriorityBlockingQueue\n     *  SynchronousQueue\n   * BlockingDeque \n     *  LinkedBlockingDeque\n   * \n\n\n# BAT\n\n\n\n\n\n * BlockingDeque?\n * BlockingQueue? ArrayBlockingQueue, DelayQueue, LinkedBlockingQueue, SynchronousQueue...\n * BlockingQueue?\n * BlockingQueue?\n * BlockingQueue? (add(o),offer(o),put(o),offer(o, timeout, timeunit))?\n * BlockingDeque BlockingQueue?\n * BlockingDeque?\n * BlockingDeque?\n * BlockingDeque BlockingQueue?\n\n\n# BlockingQueueBlockingDeque\n\n\n# BlockingQueue\n\nBlockingQueue :\n\n\n\n BlockingQueue\n\n \n\n\n# BlockingQueue \n\nBlockingQueue  4 :\n\n                             \n   add(o)      offer(o)   put(o)   offer(o, timeout, timeunit)\n   remove()    poll()     take()   poll(timeout, timeunit)\n   element()   peek()              \n\n:\n\n * : \n * : ( true / false)\n * : \n * : ( true / false)\n\n BlockingQueue  null nullBlockingQueue  NullPointerException  BlockingQueue  remove(o) (: )\n\n\n# BlockingDeque\n\njava.util.concurrent  BlockingDeque \n\nBlockingDeque  deque()  "Double Ended Queue" \n\n BlockingDeque BlockingDequeBlockingDeque :\n\n\n\n\n# BlockingDeque \n\n BlockingDeque -  \n\nBlockingDeque  4 :\n\n                                             \n   addFirst(o)      offerFirst(o)   putFirst(o)    offerFirst(o, timeout, timeunit)\n   removeFirst(o)   pollFirst(o)    takeFirst(o)   pollFirst(timeout, timeunit)\n   getFirst(o)      peekFirst(o)                   \n\n                                          \n   addLast(o)      offerLast(o)   putLast(o)    offerLast(o, timeout, timeunit)\n   removeLast(o)   pollLast(o)    takeLast(o)   pollLast(timeout, timeunit)\n   getLast(o)      peekLast(o)                  \n\n:\n\n * : \n * : ( true / false)\n * : \n * : ( true / false)\n\n\n# BlockingDeque BlockingQueue\n\nBlockingDeque  BlockingQueue  BlockingQueue  BlockingDeque BlockingQueue \n\n BlockingDeque  BlockingQueue :\n\nBLOCKINGQUEUE   BLOCKINGDEQUE\nadd()           addLast()\noffer() x 2     offerLast() x 2\nput()           putLast()\nremove()        removeFirst()\npoll() x 2      pollFirst()\ntake()          takeFirst()\nelement()       getFirst()\npeek()          peekFirst()\n\n\n# BlockingQueue \n\n Java  BlockingQueue  BlockingQueue  ArrayBlockingQueue  BlockingQueueExample  Producer   ConsumerProducer  BlockingQueue  Consumer \n\npublic class BlockingQueueExample {\n \n    public static void main(String[] args) throws Exception {\n \n        BlockingQueue queue = new ArrayBlockingQueue(1024);\n \n        Producer producer = new Producer(queue);\n        Consumer consumer = new Consumer(queue);\n \n        new Thread(producer).start();\n        new Thread(consumer).start();\n \n        Thread.sleep(4000);\n    }\n}\n\n\n Producer  put()  Consumer \n\npublic class Producer implements Runnable{\n \n    protected BlockingQueue queue = null;\n \n    public Producer(BlockingQueue queue) {\n        this.queue = queue;\n    }\n \n    public void run() {\n        try {\n            queue.put("1");\n            Thread.sleep(1000);\n            queue.put("2");\n            Thread.sleep(1000);\n            queue.put("3");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n Consumer  System.out\n\npublic class Consumer implements Runnable{\n \n    protected BlockingQueue queue = null;\n \n    public Consumer(BlockingQueue queue) {\n        this.queue = queue;\n    }\n \n    public void run() {\n        try {\n            System.out.println(queue.take());\n            System.out.println(queue.take());\n            System.out.println(queue.take());\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n\n#  ArrayBlockingQueue\n\nArrayBlockingQueue  BlockingQueue \n\nArrayBlockingQueue (: : ) ArrayBlockingQueue  FIFO()  ArrayBlockingQueue :\n\nBlockingQueue queue = new ArrayBlockingQueue(1024);\nqueue.put("1");\nObject object = queue.take();\n\n\n Java  BlockingQueue  String :\n\nBlockingQueue<String> queue = new ArrayBlockingQueue<String>(1024);\nqueue.put("1");\nString string = queue.take();\n\n\n\n#  DelayQueue\n\nDelayQueue  BlockingQueue \n\nDelayQueue  java.util.concurrent.Delayed :\n\npublic interface Delayed extends Comparable<Delayed< {\n    public long getDelay(TimeUnit timeUnit);\n}\n\n\nDelayQueue  getDelay()  0  DelayQueue  take \n\n getDelay  getDelay TimeUnit :\n\n * DAYS\n * HOURS\n * INUTES\n * SECONDS\n * MILLISECONDS\n * MICROSECONDS\n * NANOSECONDS\n\nDelayed  java.lang.Comparable  Delayed  DelayQueue   DelayQueue :\n\npublic class DelayQueueExample {\n \n    public static void main(String[] args) {\n        DelayQueue queue = new DelayQueue();\n        Delayed element1 = new DelayedElement();\n        queue.put(element1);\n        Delayed element2 = queue.take();\n    }\n}\n\n\nDelayedElement  DelayedElement  java.util.concurrent  Delayed  DelayQueue \n\n\n#  LinkedBlockingQueue\n\nLinkedBlockingQueue  BlockingQueue \n\nLinkedBlockingQueue () Integer.MAX_VALUE \n\nLinkedBlockingQueue  FIFO()  LinkedBlockingQueue :\n\nBlockingQueue<String> unbounded = new LinkedBlockingQueue<String>();\nBlockingQueue<String> bounded   = new LinkedBlockingQueue<String>(1024);\nbounded.put("Value");\nString value = bounded.take();\n\n\n\n#  PriorityBlockingQueue\n\nPriorityBlockingQueue  BlockingQueue \n\nPriorityBlockingQueue  java.util.PriorityQueue  null   PriorityBlockingQueue  java.lang.Comparable  Comparable   PriorityBlockingQueue (compare() == 0)\n\n PriorityBlockingQueue  Iterator  Iterator   PriorityBlockingQueue :\n\nBlockingQueue queue   = new PriorityBlockingQueue();\n//String implements java.lang.Comparable\nqueue.put("Value");\nString value = queue.take();\n\n\n\n#  SynchronousQueue\n\nSynchronousQueue  BlockingQueue \n\nSynchronousQueue  \n\n\n# BlockingDeque \n\n BlockingDeque java.util.concurrent  BlockingDeque : LinkedBlockingDeque\n\n BlockingDeque :\n\nBlockingDeque<String> deque = new LinkedBlockingDeque<String>();\ndeque.addFirst("1");\ndeque.addLast("2");\n \nString two = deque.takeLast();\nString one = deque.takeFirst();\n\n\n\n#  LinkedBlockingDeque\n\nLinkedBlockingDeque  BlockingDeque \n\ndeque()  "Double Ended Queue" \n\nLinkedBlockingDeque \n\n LinkedBlockingDeque :\n\nBlockingDeque<String> deque = new LinkedBlockingDeque<String>();\ndeque.addFirst("1");\ndeque.addLast("2");\n \nString two = deque.takeLast();\nString one = deque.takeFirst();\n\n\n\n# \n\n * https://blog.csdn.net/defonds/article/details/44021605#t7\n * http://tutorials.jenkov.com/java-concurrency/index.html\n * https://github.com/CL0610/Java-concurrency/blob/master/19.%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8%E4%B9%8BBlockingQueue/%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8%E4%B9%8BBlockingQueue.md\n * https://www.javadoop.com/post/java-concurrent-queue\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-BlockingQueue.html',normalizedContent:'# juc: blockingqueue\n\n> juc blockingqueue  blockingqueue java  blockingqueue\n\n * juc: blockingqueue\n   * bat\n   * blockingqueueblockingdeque\n     * blockingqueue\n     * blockingqueue \n     * blockingdeque\n     * blockingdeque \n     * blockingdeque blockingqueue\n   * blockingqueue \n     *  arrayblockingqueue\n     *  delayqueue\n     *  linkedblockingqueue\n     *  priorityblockingqueue\n     *  synchronousqueue\n   * blockingdeque \n     *  linkedblockingdeque\n   * \n\n\n# bat\n\n\n\n\n\n * blockingdeque?\n * blockingqueue? arrayblockingqueue, delayqueue, linkedblockingqueue, synchronousqueue...\n * blockingqueue?\n * blockingqueue?\n * blockingqueue? (add(o),offer(o),put(o),offer(o, timeout, timeunit))?\n * blockingdeque blockingqueue?\n * blockingdeque?\n * blockingdeque?\n * blockingdeque blockingqueue?\n\n\n# blockingqueueblockingdeque\n\n\n# blockingqueue\n\nblockingqueue :\n\n\n\n blockingqueue\n\n \n\n\n# blockingqueue \n\nblockingqueue  4 :\n\n                             \n   add(o)      offer(o)   put(o)   offer(o, timeout, timeunit)\n   remove()    poll()     take()   poll(timeout, timeunit)\n   element()   peek()              \n\n:\n\n * : \n * : ( true / false)\n * : \n * : ( true / false)\n\n blockingqueue  null nullblockingqueue  nullpointerexception  blockingqueue  remove(o) (: )\n\n\n# blockingdeque\n\njava.util.concurrent  blockingdeque \n\nblockingdeque  deque()  "double ended queue" \n\n blockingdeque blockingdequeblockingdeque :\n\n\n\n\n# blockingdeque \n\n blockingdeque -  \n\nblockingdeque  4 :\n\n                                             \n   addfirst(o)      offerfirst(o)   putfirst(o)    offerfirst(o, timeout, timeunit)\n   removefirst(o)   pollfirst(o)    takefirst(o)   pollfirst(timeout, timeunit)\n   getfirst(o)      peekfirst(o)                   \n\n                                          \n   addlast(o)      offerlast(o)   putlast(o)    offerlast(o, timeout, timeunit)\n   removelast(o)   polllast(o)    takelast(o)   polllast(timeout, timeunit)\n   getlast(o)      peeklast(o)                  \n\n:\n\n * : \n * : ( true / false)\n * : \n * : ( true / false)\n\n\n# blockingdeque blockingqueue\n\nblockingdeque  blockingqueue  blockingqueue  blockingdeque blockingqueue \n\n blockingdeque  blockingqueue :\n\nblockingqueue   blockingdeque\nadd()           addlast()\noffer() x 2     offerlast() x 2\nput()           putlast()\nremove()        removefirst()\npoll() x 2      pollfirst()\ntake()          takefirst()\nelement()       getfirst()\npeek()          peekfirst()\n\n\n# blockingqueue \n\n java  blockingqueue  blockingqueue  arrayblockingqueue  blockingqueueexample  producer   consumerproducer  blockingqueue  consumer \n\npublic class blockingqueueexample {\n \n    public static void main(string[] args) throws exception {\n \n        blockingqueue queue = new arrayblockingqueue(1024);\n \n        producer producer = new producer(queue);\n        consumer consumer = new consumer(queue);\n \n        new thread(producer).start();\n        new thread(consumer).start();\n \n        thread.sleep(4000);\n    }\n}\n\n\n producer  put()  consumer \n\npublic class producer implements runnable{\n \n    protected blockingqueue queue = null;\n \n    public producer(blockingqueue queue) {\n        this.queue = queue;\n    }\n \n    public void run() {\n        try {\n            queue.put("1");\n            thread.sleep(1000);\n            queue.put("2");\n            thread.sleep(1000);\n            queue.put("3");\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\n consumer  system.out\n\npublic class consumer implements runnable{\n \n    protected blockingqueue queue = null;\n \n    public consumer(blockingqueue queue) {\n        this.queue = queue;\n    }\n \n    public void run() {\n        try {\n            system.out.println(queue.take());\n            system.out.println(queue.take());\n            system.out.println(queue.take());\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\n\n#  arrayblockingqueue\n\narrayblockingqueue  blockingqueue \n\narrayblockingqueue (: : ) arrayblockingqueue  fifo()  arrayblockingqueue :\n\nblockingqueue queue = new arrayblockingqueue(1024);\nqueue.put("1");\nobject object = queue.take();\n\n\n java  blockingqueue  string :\n\nblockingqueue<string> queue = new arrayblockingqueue<string>(1024);\nqueue.put("1");\nstring string = queue.take();\n\n\n\n#  delayqueue\n\ndelayqueue  blockingqueue \n\ndelayqueue  java.util.concurrent.delayed :\n\npublic interface delayed extends comparable<delayed< {\n    public long getdelay(timeunit timeunit);\n}\n\n\ndelayqueue  getdelay()  0  delayqueue  take \n\n getdelay  getdelay timeunit :\n\n * days\n * hours\n * inutes\n * seconds\n * milliseconds\n * microseconds\n * nanoseconds\n\ndelayed  java.lang.comparable  delayed  delayqueue   delayqueue :\n\npublic class delayqueueexample {\n \n    public static void main(string[] args) {\n        delayqueue queue = new delayqueue();\n        delayed element1 = new delayedelement();\n        queue.put(element1);\n        delayed element2 = queue.take();\n    }\n}\n\n\ndelayedelement  delayedelement  java.util.concurrent  delayed  delayqueue \n\n\n#  linkedblockingqueue\n\nlinkedblockingqueue  blockingqueue \n\nlinkedblockingqueue () integer.max_value \n\nlinkedblockingqueue  fifo()  linkedblockingqueue :\n\nblockingqueue<string> unbounded = new linkedblockingqueue<string>();\nblockingqueue<string> bounded   = new linkedblockingqueue<string>(1024);\nbounded.put("value");\nstring value = bounded.take();\n\n\n\n#  priorityblockingqueue\n\npriorityblockingqueue  blockingqueue \n\npriorityblockingqueue  java.util.priorityqueue  null   priorityblockingqueue  java.lang.comparable  comparable   priorityblockingqueue (compare() == 0)\n\n priorityblockingqueue  iterator  iterator   priorityblockingqueue :\n\nblockingqueue queue   = new priorityblockingqueue();\n//string implements java.lang.comparable\nqueue.put("value");\nstring value = queue.take();\n\n\n\n#  synchronousqueue\n\nsynchronousqueue  blockingqueue \n\nsynchronousqueue  \n\n\n# blockingdeque \n\n blockingdeque java.util.concurrent  blockingdeque : linkedblockingdeque\n\n blockingdeque :\n\nblockingdeque<string> deque = new linkedblockingdeque<string>();\ndeque.addfirst("1");\ndeque.addlast("2");\n \nstring two = deque.takelast();\nstring one = deque.takefirst();\n\n\n\n#  linkedblockingdeque\n\nlinkedblockingdeque  blockingdeque \n\ndeque()  "double ended queue" \n\nlinkedblockingdeque \n\n linkedblockingdeque :\n\nblockingdeque<string> deque = new linkedblockingdeque<string>();\ndeque.addfirst("1");\ndeque.addlast("2");\n \nstring two = deque.takelast();\nstring one = deque.takefirst();\n\n\n\n# \n\n * https://blog.csdn.net/defonds/article/details/44021605#t7\n * http://tutorials.jenkov.com/java-concurrency/index.html\n * https://github.com/cl0610/java-concurrency/blob/master/19.%e5%b9%b6%e5%8f%91%e5%ae%b9%e5%99%a8%e4%b9%8bblockingqueue/%e5%b9%b6%e5%8f%91%e5%ae%b9%e5%99%a8%e4%b9%8bblockingqueue.md\n * https://www.javadoop.com/post/java-concurrent-queue\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-blockingqueue.html',charsets:{cjk:!0}},{title:"JUC: ConcurrentHashMap",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html",relativePath:"java/thread/java-thread-x-juc-collection-ConcurrentHashMap.md",key:"v-781a7d54",path:"/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html",headers:[{level:2,title:"JUC: ConcurrentHashMap",slug:"juc-concurrenthashmap",normalizedTitle:"juc: concurrenthashmap",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:177},{level:2,title:"HashTable",slug:"hashtable",normalizedTitle:"hashtable",charIndex:198},{level:2,title:"ConcurrentHashMap - JDK 1.7",slug:"concurrenthashmap-jdk-1-7",normalizedTitle:"concurrenthashmap - jdk 1.7",charIndex:217},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:86},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:264},{level:3,title:"put ",slug:"put-",normalizedTitle:"put ",charIndex:275},{level:3,title:": ensureSegment",slug:"-ensuresegment",normalizedTitle:": ensuresegment",charIndex:291},{level:3,title:": scanAndLockForPut",slug:"-scanandlockforput",normalizedTitle:": scanandlockforput",charIndex:318},{level:3,title:": rehash",slug:"-rehash",normalizedTitle:": rehash",charIndex:350},{level:3,title:"get ",slug:"get-",normalizedTitle:"get ",charIndex:368},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:384},{level:2,title:"ConcurrentHashMap - JDK 1.8",slug:"concurrenthashmap-jdk-1-8",normalizedTitle:"concurrenthashmap - jdk 1.8",charIndex:396},{level:3,title:"",slug:"-2",normalizedTitle:"",charIndex:86},{level:3,title:"",slug:"-2",normalizedTitle:"",charIndex:264},{level:3,title:"put ",slug:"put--2",normalizedTitle:"put ",charIndex:275},{level:3,title:": initTable",slug:"-inittable",normalizedTitle:": inittable",charIndex:470},{level:3,title:": treeifyBin",slug:"-treeifybin",normalizedTitle:": treeifybin",charIndex:494},{level:3,title:": tryPresize",slug:"-trypresize",normalizedTitle:": trypresize",charIndex:520},{level:3,title:": transfer",slug:"-transfer",normalizedTitle:": transfer",charIndex:542},{level:3,title:"get ",slug:"get--2",normalizedTitle:"get ",charIndex:368},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:578},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:588}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ConcurrentHashMap BAT HashTable ConcurrentHashMap - JDK 1.7   put  : ensureSegment : scanAndLockForPut : rehash get   ConcurrentHashMap - JDK 1.8   put  : initTable : treeifyBin : tryPresize : transfer get   ",content:'# JUC: ConcurrentHashMap\n\n> JDK1.7ConcurrentHashMapJDK1.8++CASConcurrentHashMap\n\n * JUC: ConcurrentHashMap\n   * BAT\n   * HashTable\n   * ConcurrentHashMap - JDK 1.7\n     * \n     * \n     * put \n     * : ensureSegment\n     * : scanAndLockForPut\n     * : rehash\n     * get \n     * \n   * ConcurrentHashMap - JDK 1.8\n     * \n     * \n     * put \n     * : initTable\n     * : treeifyBin\n     * : tryPresize\n     * : transfer\n     * get \n   * \n   * \n\n\n# BAT\n\n\n\n\n\n * HashTable? ? ConcurrentHashMap?\n * ConcurrentHashMapJDK1.7JDK1.8? JDK1.8JDK1.7\n * ConcurrentHashMap JDK1.7? \n * ConcurrentHashMap JDK1.8? ++CAS\n * ConcurrentHashMap JDK1.7Segment(concurrencyLevel)? ?\n * ConcurrentHashMap JDK1.7put?\n * ConcurrentHashMap JDK1.7? rehash(segment  segment  HashEntry<K,V>[] )\n * ConcurrentHashMap JDK1.8? tryPresize\n * ConcurrentHashMap JDK1.8? 8?\n * ConcurrentHashMap JDK1.8? transfer\n\n\n# HashTable\n\nHashtablesynchronizedputsynchronizedputHashHash\n\n\n# ConcurrentHashMap - JDK 1.7\n\nJDK1.5~1.7JavaConcurrentHashMap.\n\nConcurrentHashMapSegmentHashSegmentHashtableputhashSegmentSegmentConcurrentHashMapputJDK1.7ConcurrentHashMap\n\n\n# \n\n ConcurrentHashMap  Segment Segment  segment\n\nConcurrentHashMap  Segment Segment  ReentrantLock  segment Segment \n\n\n\nconcurrencyLevel: Segment  16 ConcurrentHashMap  16  Segments 16  Segment \n\n Segment  Segment  HashMap\n\n\n# \n\n * initialCapacity:  ConcurrentHashMap  Segment\n\n * loadFactor: Segment  Segment \n\npublic ConcurrentHashMap(int initialCapacity,\n                         float loadFactor, int concurrencyLevel) {\n    if (!(loadFactor > 0) || initialCapacity < 0 || concurrencyLevel <= 0)\n        throw new IllegalArgumentException();\n    if (concurrencyLevel > MAX_SEGMENTS)\n        concurrencyLevel = MAX_SEGMENTS;\n    // Find power-of-two sizes best matching arguments\n    int sshift = 0;\n    int ssize = 1;\n    //  ssize 2  n \n    while (ssize < concurrencyLevel) {\n        ++sshift;\n        ssize <<= 1;\n    }\n    // concurrencyLevel  16sshift  4\n    //  segmentShift  28segmentMask  15\n    this.segmentShift = 32 - sshift;\n    this.segmentMask = ssize - 1;\n\n    if (initialCapacity > MAXIMUM_CAPACITY)\n        initialCapacity = MAXIMUM_CAPACITY;\n\n    // initialCapacity  map \n    //  initialCapacity  Segment \n    //  initialCapacity  64 Segment "" 4 \n    int c = initialCapacity / ssize;\n    if (c * ssize < initialCapacity)\n        ++c;\n    //  MIN_SEGMENT_TABLE_CAPACITY  2\n    // \n    int cap = MIN_SEGMENT_TABLE_CAPACITY; \n    while (cap < c)\n        cap <<= 1;\n\n    //  Segment \n    //  segment[0]\n    Segment<K,V> s0 =\n        new Segment<K,V>(loadFactor, (int)(cap * loadFactor),\n                         (HashEntry<K,V>[])new HashEntry[cap]);\n    Segment<K,V>[] ss = (Segment<K,V>[])new Segment[ssize];\n    //  segment[0]\n    UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0]\n    this.segments = ss;\n}\n\n\n Segment \n\n new ConcurrentHashMap() :\n\n * Segment  16\n * Segment[i]  2 0.75 1.5\n *  segment[0] null segment[0]\n *  segmentShift  32 - 4 = 28segmentMask  16 - 1 = 15\n\n\n# put \n\n put \n\npublic V put(K key, V value) {\n    Segment<K,V> s;\n    if (value == null)\n        throw new NullPointerException();\n    // 1.  key  hash \n    int hash = hash(key);\n    // 2.  hash  Segment  j\n    //    hash  32  segmentShift(28)  4 \n    //     segmentMask(15)  j  hash  4 \n    int j = (hash >>> segmentShift) & segmentMask;\n    //  segment[0] null\n    // ensureSegment(j)  segment[j] \n    if ((s = (Segment<K,V>)UNSAFE.getObject          // nonvolatile; recheck\n         (segments, (j << SSHIFT) + SBASE)) == null) //  in ensureSegment\n        s = ensureSegment(j);\n    // 3.   s \n    return s.put(key, hash, value, false);\n}\n\n\n hash  Segment Segment  put \n\nSegment  + \n\nfinal V put(K key, int hash, V value, boolean onlyIfAbsent) {\n    //  segment  segment \n    //    \n    HashEntry<K,V> node = tryLock() ? null :\n        scanAndLockForPut(key, hash, value);\n    V oldValue;\n    try {\n        //  segment \n        HashEntry<K,V>[] tab = table;\n        //  hash \n        int index = (tab.length - 1) & hash;\n        // first \n        HashEntry<K,V> first = entryAt(tab, index);\n\n        //  for \n        for (HashEntry<K,V> e = first;;) {\n            if (e != null) {\n                K k;\n                if ((k = e.key) == key ||\n                    (e.hash == hash && key.equals(k))) {\n                    oldValue = e.value;\n                    if (!onlyIfAbsent) {\n                        // \n                        e.value = value;\n                        ++modCount;\n                    }\n                    break;\n                }\n                // \n                e = e.next;\n            }\n            else {\n                // node  null\n                //  nullnull\n                if (node != null)\n                    node.setNext(first);\n                else\n                    node = new HashEntry<K,V>(hash, key, value, first);\n\n                int c = count + 1;\n                //  segment  segment \n                if (c > threshold && tab.length < MAXIMUM_CAPACITY)\n                    rehash(node); // \n                else\n                    //  node  tab  index \n                    // \n                    setEntryAt(tab, index, node);\n                ++modCount;\n                count = c;\n                oldValue = null;\n                break;\n            }\n        }\n    } finally {\n        // \n        unlock();\n    }\n    return oldValue;\n}\n\n\n segment \n\n put \n\n\n# : ensureSegment\n\nConcurrentHashMap  segment[0]\n\n segment[k]\n\nprivate Segment<K,V> ensureSegment(int k) {\n    final Segment<K,V>[] ss = this.segments;\n    long u = (k << SSHIFT) + SBASE; // raw offset\n    Segment<K,V> seg;\n    if ((seg = (Segment<K,V>)UNSAFE.getObjectVolatile(ss, u)) == null) {\n        //  segment[0] \n        //  segment[0]  segment[k]\n        //  segment[0] \n        Segment<K,V> proto = ss[0];\n        int cap = proto.table.length;\n        float lf = proto.loadFactor;\n        int threshold = (int)(cap * lf);\n\n        //  segment[k] \n        HashEntry<K,V>[] tab = (HashEntry<K,V>[])new HashEntry[cap];\n        if ((seg = (Segment<K,V>)UNSAFE.getObjectVolatile(ss, u))\n            == null) { // \n\n            Segment<K,V> s = new Segment<K,V>(lf, threshold, tab);\n            //  while  CAS\n            while ((seg = (Segment<K,V>)UNSAFE.getObjectVolatile(ss, u))\n                   == null) {\n                if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s))\n                    break;\n            }\n        }\n    }\n    return seg;\n}\n\n\nensureSegment(int k)  CAS \n\n\n# : scanAndLockForPut\n\n segment  put  node = tryLock() ? null : scanAndLockForPut(key, hash, value) tryLock()  segment  scanAndLockForPut \n\n\n\nprivate HashEntry<K,V> scanAndLockForPut(K key, int hash, V value) {\n    HashEntry<K,V> first = entryForHash(this, hash);\n    HashEntry<K,V> e = first;\n    HashEntry<K,V> node = null;\n    int retries = -1; // negative while locating node\n\n    // \n    while (!tryLock()) {\n        HashEntry<K,V> f; // to recheck first below\n        if (retries < 0) {\n            if (e == null) {\n                if (node == null) // speculatively create node\n                    // \n                    //  tryLock() \n                    node = new HashEntry<K,V>(hash, key, value, null);\n                retries = 0;\n            }\n            else if (key.equals(e.key))\n                retries = 0;\n            else\n                // \n                e = e.next;\n        }\n        //  MAX_SCAN_RETRIES(164)\n        //    lock() \n        else if (++retries > MAX_SCAN_RETRIES) {\n            lock();\n            break;\n        }\n        else if ((retries & 1) == 0 &&\n                 // \n                 //      scanAndLockForPut \n                 (f = entryForHash(this, hash)) != first) {\n            e = first = f; // re-traverse if entry changed\n            retries = -1;\n        }\n    }\n    return node;\n}\n\n\n tryLock()  MAX_SCAN_RETRIES lock() \n\n segment  node\n\n\n# : rehash\n\nsegment  segment  HashEntry<K,V>[]  2 \n\nput  segment  put \n\n segment \n\n//  node \nprivate void rehash(HashEntry<K,V> node) {\n    HashEntry<K,V>[] oldTable = table;\n    int oldCapacity = oldTable.length;\n    // 2 \n    int newCapacity = oldCapacity << 1;\n    threshold = (int)(newCapacity * loadFactor);\n    // \n    HashEntry<K,V>[] newTable =\n        (HashEntry<K,V>[]) new HashEntry[newCapacity];\n    //  16  32 sizeMask  31 000...00011111\n    int sizeMask = newCapacity - 1;\n\n    //  i   i  i+oldCap \n    for (int i = 0; i < oldCapacity ; i++) {\n        // e \n        HashEntry<K,V> e = oldTable[i];\n        if (e != null) {\n            HashEntry<K,V> next = e.next;\n            // \n            //  16e  oldTable[3]  idx  3  3 + 16 = 19\n            int idx = e.hash & sizeMask;\n            if (next == null)   // \n                newTable[idx] = e;\n            else { // Reuse consecutive sequence at same slot\n                // e \n                HashEntry<K,V> lastRun = e;\n                // idx  e \n                int lastIdx = idx;\n\n                //  for  lastRun \n                for (HashEntry<K,V> last = next;\n                     last != null;\n                     last = last.next) {\n                    int k = last.hash & sizeMask;\n                    if (k != lastIdx) {\n                        lastIdx = k;\n                        lastRun = last;\n                    }\n                }\n                //  lastRun  lastIdx \n                newTable[lastIdx] = lastRun;\n                //  lastRun \n                //    \n                for (HashEntry<K,V> p = e; p != lastRun; p = p.next) {\n                    V v = p.value;\n                    int h = p.hash;\n                    int k = h & sizeMask;\n                    HashEntry<K,V> n = newTable[k];\n                    newTable[k] = new HashEntry<K,V>(h, p.key, v, n);\n                }\n            }\n        }\n    }\n    //  node    \n    int nodeIndex = node.hash & sizeMask; // add the new node\n    node.setNext(newTable[nodeIndex]);\n    newTable[nodeIndex] = node;\n    table = newTable;\n}\n\n\n HashMap  for  for ?\n\n for  for  lastRun  lastRun  lastRun \n\n Doug Lea  lastRun  Doug Lea  1/6 \n\n\n# get \n\n put get \n\n *  hash  segment \n *  hash \n * \n\npublic V get(Object key) {\n    Segment<K,V> s; // manually integrate access methods to reduce overhead\n    HashEntry<K,V>[] tab;\n    // 1. hash \n    int h = hash(key);\n    long u = (((h >>> segmentShift) & segmentMask) << SSHIFT) + SBASE;\n    // 2.  hash  segment\n    if ((s = (Segment<K,V>)UNSAFE.getObjectVolatile(segments, u)) != null &&\n        (tab = s.table) != null) {\n        // 3. segment \n        for (HashEntry<K,V> e = (HashEntry<K,V>) UNSAFE.getObjectVolatile\n                 (tab, ((long)(((tab.length - 1) & h)) << TSHIFT) + TBASE);\n             e != null; e = e.next) {\n            K k;\n            if ((k = e.key) == key || (e.hash == h && key.equals(k)))\n                return e.value;\n        }\n    }\n    return null;\n}\n\n\n\n# \n\n put  get  get \n\n put  remove  segment  get  segment  put  remove \n\n * put \n   *  CAS  Segment \n   *  get  get  put  setEntryAt  UNSAFE.putOrderedObject\n   *  newTable  table get  get  table  put  put  table  volatile \n * remove \n   * remove \n   * get  remove ""\n   *  remove  get \n   *  remove  1 next table  volatile  volatile  UNSAFE  setEntryAt2 next  volatile \n\n\n# ConcurrentHashMap - JDK 1.8\n\nJDK1.7ConcurrentHashMapSegmentJDK1.8ConcurrentHashMapHashMap++CASsynchronized\n\n\n# \n\n\n\n Java8  HashMap \n\n\n# \n\n// \npublic ConcurrentHashMap() {\n}\npublic ConcurrentHashMap(int initialCapacity) {\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException();\n    int cap = ((initialCapacity >= (MAXIMUM_CAPACITY >>> 1)) ?\n               MAXIMUM_CAPACITY :\n               tableSizeFor(initialCapacity + (initialCapacity >>> 1) + 1));\n    this.sizeCtl = cap;\n}\n\n\n sizeCtlsizeCtl =  (1.5 * initialCapacity + 1) 2  n  initialCapacity  10 sizeCtl  16 initialCapacity  11 sizeCtl  32\n\nsizeCtl \n\n\n# put \n\n:\n\npublic V put(K key, V value) {\n    return putVal(key, value, false);\n}\nfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n    if (key == null || value == null) throw new NullPointerException();\n    //  hash \n    int hash = spread(key.hashCode());\n    // \n    int binCount = 0;\n    for (Node<K,V>[] tab = table;;) {\n        Node<K,V> f; int n, i, fh;\n        // ""\n        if (tab == null || (n = tab.length) == 0)\n            // \n            tab = initTable();\n\n        //  hash  f\n        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n            // \n            //     CAS  put \n            //           CAS \n            if (casTabAt(tab, i, null,\n                         new Node<K,V>(hash, key, value, null)))\n                break;                   // no lock when adding to empty bin\n        }\n        // hash  MOVED\n        else if ((fh = f.hash) == MOVED)\n            // \n            tab = helpTransfer(tab, f);\n\n        else { // f \n\n            V oldVal = null;\n            // \n            synchronized (f) {\n                if (tabAt(tab, i) == f) {\n                    if (fh >= 0) { //  hash  0\n                        // \n                        binCount = 1;\n                        // \n                        for (Node<K,V> e = f;; ++binCount) {\n                            K ek;\n                            // "" key break \n                            if (e.hash == hash &&\n                                ((ek = e.key) == key ||\n                                 (ek != null && key.equals(ek)))) {\n                                oldVal = e.val;\n                                if (!onlyIfAbsent)\n                                    e.val = value;\n                                break;\n                            }\n                            // \n                            Node<K,V> pred = e;\n                            if ((e = e.next) == null) {\n                                pred.next = new Node<K,V>(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    else if (f instanceof TreeBin) { // \n                        Node<K,V> p;\n                        binCount = 2;\n                        // \n                        if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                       value)) != null) {\n                            oldVal = p.val;\n                            if (!onlyIfAbsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n\n            if (binCount != 0) {\n                //  HashMap  8\n                if (binCount >= TREEIFY_THRESHOLD)\n                    //  HashMap \n                    //  64\n                    //    \n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    // \n    addCount(1L, binCount);\n    return null;\n}\n\n\n\n# : initTable\n\n sizeCtl\n\n sizeCtl  CAS \n\nprivate final Node<K,V>[] initTable() {\n    Node<K,V>[] tab; int sc;\n    while ((tab = table) == null || tab.length == 0) {\n        // """"\n        if ((sc = sizeCtl) < 0)\n            Thread.yield(); // lost initialization race; just spin\n        // CAS  sizeCtl  -1\n        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {\n            try {\n                if ((tab = table) == null || tab.length == 0) {\n                    // DEFAULT_CAPACITY  16\n                    int n = (sc > 0) ? sc : DEFAULT_CAPACITY;\n                    //  16 \n                    Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                    //  tabletable  volatile \n                    table = tab = nt;\n                    //  n  16  sc = 12\n                    //  0.75 * n\n                    sc = n - (n >>> 2);\n                }\n            } finally {\n                //  sizeCtl  sc 12 \n                sizeCtl = sc;\n            }\n            break;\n        }\n    }\n    return tab;\n}\n\n\n\n# : treeifyBin\n\n put treeifyBin \n\nprivate final void treeifyBin(Node<K,V>[] tab, int index) {\n    Node<K,V> b; int n, sc;\n    if (tab != null) {\n        // MIN_TREEIFY_CAPACITY  64\n        //  64  32  16 \n        if ((n = tab.length) < MIN_TREEIFY_CAPACITY)\n            // \n            tryPresize(n << 1);\n        // b \n        else if ((b = tabAt(tab, index)) != null && b.hash >= 0) {\n            // \n            synchronized (b) {\n\n                if (tabAt(tab, index) == b) {\n                    // \n                    TreeNode<K,V> hd = null, tl = null;\n                    for (Node<K,V> e = b; e != null; e = e.next) {\n                        TreeNode<K,V> p =\n                            new TreeNode<K,V>(e.hash, e.key, e.val,\n                                              null, null);\n                        if ((p.prev = tl) == null)\n                            hd = p;\n                        else\n                            tl.next = p;\n                        tl = p;\n                    }\n                    // \n                    setTabAt(tab, index, new TreeBin<K,V>(hd));\n                }\n            }\n        }\n    }\n}\n\n\n\n# : tryPresize\n\n Java8 ConcurrentHashMap \n\n transfer \n\n 2 \n\n//  size \nprivate final void tryPresize(int size) {\n    // c: size  1.5  1 2  n \n    int c = (size >= (MAXIMUM_CAPACITY >>> 1)) ? MAXIMUM_CAPACITY :\n        tableSizeFor(size + (size >>> 1) + 1);\n    int sc;\n    while ((sc = sizeCtl) >= 0) {\n        Node<K,V>[] tab = table; int n;\n\n        //  if \n        if (tab == null || (n = tab.length) == 0) {\n            n = (sc > c) ? sc : c;\n            if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {\n                try {\n                    if (table == tab) {\n                        @SuppressWarnings("unchecked")\n                        Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                        table = nt;\n                        sc = n - (n >>> 2); // 0.75 * n\n                    }\n                } finally {\n                    sizeCtl = sc;\n                }\n            }\n        }\n        else if (c <= sc || n >= MAXIMUM_CAPACITY)\n            break;\n        else if (tab == table) {\n            //  rs \n            int rs = resizeStamp(n);\n\n            if (sc < 0) {\n                Node<K,V>[] nt;\n                if ((sc >>> RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||\n                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||\n                    transferIndex <= 0)\n                    break;\n                // 2.  CAS  sizeCtl  1 transfer \n                //     nextTab  null\n                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))\n                    transfer(tab, nt);\n            }\n            // 1.  sizeCtl  (rs << RESIZE_STAMP_SHIFT) + 2)\n            //     ? \n            //   transfer  nextTab  null\n            else if (U.compareAndSwapInt(this, SIZECTL, sc,\n                                         (rs << RESIZE_STAMP_SHIFT) + 2))\n                transfer(tab, null);\n        }\n    }\n}\n\n\n sizeCtl  transfer(tab, null) sizeCtl  1 transfer(tab, nt) sizeCtl  1 transfer(tab, nt)\n\n 1  transfer(tab, null) +  transfer(tab, nt) transfer \n\n\n# : transfer\n\n tab  nextTab \n\n tryPresize  transfer  transfer  put  put  helpTransfer helpTransfer  transfer \n\nnextTab  nullnextTab  null\n\n n n  Doug Lea  stride 16  transferIndex \n\n transferIndex  stride  transferIndex  stride \n\nprivate final void transfer(Node<K,V>[] tab, Node<K,V>[] nextTab) {\n    int n = tab.length, stride;\n\n    // stride  n (n>>>3)/NCPU 16\n    // stride  n \n    //    n  stride \n    if ((stride = (NCPU > 1) ? (n >>> 3) / NCPU : n) < MIN_TRANSFER_STRIDE)\n        stride = MIN_TRANSFER_STRIDE; // subdivide range\n\n    //  nextTab  null\n    //     nextTab  null\n    //       nextTab  null\n    if (nextTab == null) {\n        try {\n            // \n            Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n << 1];\n            nextTab = nt;\n        } catch (Throwable ex) {      // try to cope with OOME\n            sizeCtl = Integer.MAX_VALUE;\n            return;\n        }\n        // nextTable  ConcurrentHashMap \n        nextTable = nextTab;\n        // transferIndex  ConcurrentHashMap \n        transferIndex = n;\n    }\n\n    int nextn = nextTab.length;\n\n    // ForwardingNode  Node\n    // Nodekeyvalue  next  null hash  MOVED\n    //  i \n    //     i  ForwardingNode\n    //    \n    ForwardingNode<K,V> fwd = new ForwardingNode<K,V>(nextTab);\n\n\n    // advance \n    boolean advance = true;\n    boolean finishing = false; // to ensure sweep before committing nextTab\n\n    /*\n     *  for \n     * \n     */\n\n    // i bound \n    for (int i = 0, bound = 0;;) {\n        Node<K,V> f; int fh;\n\n        //  while \n        // advance  true \n        //   : i  transferIndexbound  transferIndex-stride\n        while (advance) {\n            int nextIndex, nextBound;\n            if (--i >= bound || finishing)\n                advance = false;\n\n            //  transferIndex  nextIndex\n            //  transferIndex  0\n            else if ((nextIndex = transferIndex) <= 0) {\n                i = -1;\n                advance = false;\n            }\n            else if (U.compareAndSwapInt\n                     (this, TRANSFERINDEX, nextIndex,\n                      nextBound = (nextIndex > stride ?\n                                   nextIndex - stride : 0))) {\n                // nextBound \n                bound = nextBound;\n                i = nextIndex - 1;\n                advance = false;\n            }\n        }\n        if (i < 0 || i >= n || i + n >= nextn) {\n            int sc;\n            if (finishing) {\n                // \n                nextTable = null;\n                //  nextTab  table \n                table = nextTab;\n                //  sizeCtl: n  sizeCtl  0.75 \n                sizeCtl = (n << 1) - (n >>> 1);\n                return;\n            }\n\n            // sizeCtl  (rs << RESIZE_STAMP_SHIFT) + 2\n            //  sizeCtl  1\n            //  CAS  sizeCtl  1\n            if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n                // \n                if ((sc - 2) != resizeStamp(n) << RESIZE_STAMP_SHIFT)\n                    return;\n\n                //  (sc - 2) == resizeStamp(n) << RESIZE_STAMP_SHIFT\n                //  if(finishing){} \n                finishing = advance = true;\n                i = n; // recheck before commit\n            }\n        }\n        //  i  ForwardingNode \n        else if ((f = tabAt(tab, i)) == null)\n            advance = casTabAt(tab, i, null, fwd);\n        //  ForwardingNode\n        else if ((fh = f.hash) == MOVED)\n            advance = true; // already processed\n        else {\n            // \n            synchronized (f) {\n                if (tabAt(tab, i) == f) {\n                    Node<K,V> ln, hn;\n                    //  hash  0 Node \n                    if (fh >= 0) {\n                        //  Java7  ConcurrentHashMap \n                        // \n                        //    lastRun lastRun \n                        //   lastRun \n                        int runBit = fh & n;\n                        Node<K,V> lastRun = f;\n                        for (Node<K,V> p = f.next; p != null; p = p.next) {\n                            int b = p.hash & n;\n                            if (b != runBit) {\n                                runBit = b;\n                                lastRun = p;\n                            }\n                        }\n                        if (runBit == 0) {\n                            ln = lastRun;\n                            hn = null;\n                        }\n                        else {\n                            hn = lastRun;\n                            ln = null;\n                        }\n                        for (Node<K,V> p = f; p != lastRun; p = p.next) {\n                            int ph = p.hash; K pk = p.key; V pv = p.val;\n                            if ((ph & n) == 0)\n                                ln = new Node<K,V>(ph, pk, pv, ln);\n                            else\n                                hn = new Node<K,V>(ph, pk, pv, hn);\n                        }\n                        //  i\n                        setTabAt(nextTab, i, ln);\n                        //  i+n\n                        setTabAt(nextTab, i + n, hn);\n                        //  fwd\n                        //     hash  MOVED\n                        setTabAt(tab, i, fwd);\n                        // advance  true\n                        advance = true;\n                    }\n                    else if (f instanceof TreeBin) {\n                        // \n                        TreeBin<K,V> t = (TreeBin<K,V>)f;\n                        TreeNode<K,V> lo = null, loTail = null;\n                        TreeNode<K,V> hi = null, hiTail = null;\n                        int lc = 0, hc = 0;\n                        for (Node<K,V> e = t.first; e != null; e = e.next) {\n                            int h = e.hash;\n                            TreeNode<K,V> p = new TreeNode<K,V>\n                                (h, e.key, e.val, null, null);\n                            if ((h & n) == 0) {\n                                if ((p.prev = loTail) == null)\n                                    lo = p;\n                                else\n                                    loTail.next = p;\n                                loTail = p;\n                                ++lc;\n                            }\n                            else {\n                                if ((p.prev = hiTail) == null)\n                                    hi = p;\n                                else\n                                    hiTail.next = p;\n                                hiTail = p;\n                                ++hc;\n                            }\n                        }\n                        // 6\n                        ln = (lc <= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n                            (hc != 0) ? new TreeBin<K,V>(lo) : t;\n                        hn = (hc <= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n                            (lc != 0) ? new TreeBin<K,V>(hi) : t;\n\n                        //  ln  i\n                        setTabAt(nextTab, i, ln);\n                        //  hn  i+n\n                        setTabAt(nextTab, i + n, hn);\n                        //  fwd\n                        //     hash  MOVED\n                        setTabAt(tab, i, fwd);\n                        // advance  true\n                        advance = true;\n                    }\n                }\n            }\n        }\n    }\n}\n\n\ntransfer  transferIndex  stride \n\n tryPresize \n\n\n# get \n\nget :\n\n *  hash \n *  hash : (n - 1) & h\n * \n   *  null null \n   * \n   *  hash  0 find \n   *  3 \n\npublic V get(Object key) {\n    Node<K,V>[] tab; Node<K,V> e, p; int n, eh; K ek;\n    int h = spread(key.hashCode());\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (e = tabAt(tab, (n - 1) & h)) != null) {\n        // \n        if ((eh = e.hash) == h) {\n            if ((ek = e.key) == key || (ek != null && key.equals(ek)))\n                return e.val;\n        }\n        //  hash  0 \n        else if (eh < 0)\n            //  ForwardingNode.find(int h, Object k)  TreeBin.find(int h, Object k)\n            return (p = e.find(h, key)) != null ? p.val : null;\n\n        // \n        while ((e = e.next) != null) {\n            if (e.hash == h &&\n                ((ek = e.key) == key || (ek != null && key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n\n\nForwardingNode.find(int h, Object k) \n\n\n# \n\n * HashTable : synchronizedput;\n * ConcurrentHashMap JDK1.7: ;\n * ConcurrentHashMap JDK1.8: ++CAS;\n\n\n# \n\n * https://blog.csdn.net/defonds/article/details/44021605#t7\n * http://tutorials.jenkov.com/java-concurrency/index.html\n * https://juejin.im/post/5aeeaba8f265da0b9d781d16\n * https://www.javadoop.com/post/hashmap#Java7%20ConcurrentHashMap\n * https://blog.csdn.net/Bill_Xiang_/article/details/81122044\n * https://www.cnblogs.com/leesf456/p/5453341.html\n * https://www.cnblogs.com/huaizuo/archive/2016/04/20/5413069.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html',normalizedContent:'# juc: concurrenthashmap\n\n> jdk1.7concurrenthashmapjdk1.8++casconcurrenthashmap\n\n * juc: concurrenthashmap\n   * bat\n   * hashtable\n   * concurrenthashmap - jdk 1.7\n     * \n     * \n     * put \n     * : ensuresegment\n     * : scanandlockforput\n     * : rehash\n     * get \n     * \n   * concurrenthashmap - jdk 1.8\n     * \n     * \n     * put \n     * : inittable\n     * : treeifybin\n     * : trypresize\n     * : transfer\n     * get \n   * \n   * \n\n\n# bat\n\n\n\n\n\n * hashtable? ? concurrenthashmap?\n * concurrenthashmapjdk1.7jdk1.8? jdk1.8jdk1.7\n * concurrenthashmap jdk1.7? \n * concurrenthashmap jdk1.8? ++cas\n * concurrenthashmap jdk1.7segment(concurrencylevel)? ?\n * concurrenthashmap jdk1.7put?\n * concurrenthashmap jdk1.7? rehash(segment  segment  hashentry<k,v>[] )\n * concurrenthashmap jdk1.8? trypresize\n * concurrenthashmap jdk1.8? 8?\n * concurrenthashmap jdk1.8? transfer\n\n\n# hashtable\n\nhashtablesynchronizedputsynchronizedputhashhash\n\n\n# concurrenthashmap - jdk 1.7\n\njdk1.5~1.7javaconcurrenthashmap.\n\nconcurrenthashmapsegmenthashsegmenthashtableputhashsegmentsegmentconcurrenthashmapputjdk1.7concurrenthashmap\n\n\n# \n\n concurrenthashmap  segment segment  segment\n\nconcurrenthashmap  segment segment  reentrantlock  segment segment \n\n\n\nconcurrencylevel: segment  16 concurrenthashmap  16  segments 16  segment \n\n segment  segment  hashmap\n\n\n# \n\n * initialcapacity:  concurrenthashmap  segment\n\n * loadfactor: segment  segment \n\npublic concurrenthashmap(int initialcapacity,\n                         float loadfactor, int concurrencylevel) {\n    if (!(loadfactor > 0) || initialcapacity < 0 || concurrencylevel <= 0)\n        throw new illegalargumentexception();\n    if (concurrencylevel > max_segments)\n        concurrencylevel = max_segments;\n    // find power-of-two sizes best matching arguments\n    int sshift = 0;\n    int ssize = 1;\n    //  ssize 2  n \n    while (ssize < concurrencylevel) {\n        ++sshift;\n        ssize <<= 1;\n    }\n    // concurrencylevel  16sshift  4\n    //  segmentshift  28segmentmask  15\n    this.segmentshift = 32 - sshift;\n    this.segmentmask = ssize - 1;\n\n    if (initialcapacity > maximum_capacity)\n        initialcapacity = maximum_capacity;\n\n    // initialcapacity  map \n    //  initialcapacity  segment \n    //  initialcapacity  64 segment "" 4 \n    int c = initialcapacity / ssize;\n    if (c * ssize < initialcapacity)\n        ++c;\n    //  min_segment_table_capacity  2\n    // \n    int cap = min_segment_table_capacity; \n    while (cap < c)\n        cap <<= 1;\n\n    //  segment \n    //  segment[0]\n    segment<k,v> s0 =\n        new segment<k,v>(loadfactor, (int)(cap * loadfactor),\n                         (hashentry<k,v>[])new hashentry[cap]);\n    segment<k,v>[] ss = (segment<k,v>[])new segment[ssize];\n    //  segment[0]\n    unsafe.putorderedobject(ss, sbase, s0); // ordered write of segments[0]\n    this.segments = ss;\n}\n\n\n segment \n\n new concurrenthashmap() :\n\n * segment  16\n * segment[i]  2 0.75 1.5\n *  segment[0] null segment[0]\n *  segmentshift  32 - 4 = 28segmentmask  16 - 1 = 15\n\n\n# put \n\n put \n\npublic v put(k key, v value) {\n    segment<k,v> s;\n    if (value == null)\n        throw new nullpointerexception();\n    // 1.  key  hash \n    int hash = hash(key);\n    // 2.  hash  segment  j\n    //    hash  32  segmentshift(28)  4 \n    //     segmentmask(15)  j  hash  4 \n    int j = (hash >>> segmentshift) & segmentmask;\n    //  segment[0] null\n    // ensuresegment(j)  segment[j] \n    if ((s = (segment<k,v>)unsafe.getobject          // nonvolatile; recheck\n         (segments, (j << sshift) + sbase)) == null) //  in ensuresegment\n        s = ensuresegment(j);\n    // 3.   s \n    return s.put(key, hash, value, false);\n}\n\n\n hash  segment segment  put \n\nsegment  + \n\nfinal v put(k key, int hash, v value, boolean onlyifabsent) {\n    //  segment  segment \n    //    \n    hashentry<k,v> node = trylock() ? null :\n        scanandlockforput(key, hash, value);\n    v oldvalue;\n    try {\n        //  segment \n        hashentry<k,v>[] tab = table;\n        //  hash \n        int index = (tab.length - 1) & hash;\n        // first \n        hashentry<k,v> first = entryat(tab, index);\n\n        //  for \n        for (hashentry<k,v> e = first;;) {\n            if (e != null) {\n                k k;\n                if ((k = e.key) == key ||\n                    (e.hash == hash && key.equals(k))) {\n                    oldvalue = e.value;\n                    if (!onlyifabsent) {\n                        // \n                        e.value = value;\n                        ++modcount;\n                    }\n                    break;\n                }\n                // \n                e = e.next;\n            }\n            else {\n                // node  null\n                //  nullnull\n                if (node != null)\n                    node.setnext(first);\n                else\n                    node = new hashentry<k,v>(hash, key, value, first);\n\n                int c = count + 1;\n                //  segment  segment \n                if (c > threshold && tab.length < maximum_capacity)\n                    rehash(node); // \n                else\n                    //  node  tab  index \n                    // \n                    setentryat(tab, index, node);\n                ++modcount;\n                count = c;\n                oldvalue = null;\n                break;\n            }\n        }\n    } finally {\n        // \n        unlock();\n    }\n    return oldvalue;\n}\n\n\n segment \n\n put \n\n\n# : ensuresegment\n\nconcurrenthashmap  segment[0]\n\n segment[k]\n\nprivate segment<k,v> ensuresegment(int k) {\n    final segment<k,v>[] ss = this.segments;\n    long u = (k << sshift) + sbase; // raw offset\n    segment<k,v> seg;\n    if ((seg = (segment<k,v>)unsafe.getobjectvolatile(ss, u)) == null) {\n        //  segment[0] \n        //  segment[0]  segment[k]\n        //  segment[0] \n        segment<k,v> proto = ss[0];\n        int cap = proto.table.length;\n        float lf = proto.loadfactor;\n        int threshold = (int)(cap * lf);\n\n        //  segment[k] \n        hashentry<k,v>[] tab = (hashentry<k,v>[])new hashentry[cap];\n        if ((seg = (segment<k,v>)unsafe.getobjectvolatile(ss, u))\n            == null) { // \n\n            segment<k,v> s = new segment<k,v>(lf, threshold, tab);\n            //  while  cas\n            while ((seg = (segment<k,v>)unsafe.getobjectvolatile(ss, u))\n                   == null) {\n                if (unsafe.compareandswapobject(ss, u, null, seg = s))\n                    break;\n            }\n        }\n    }\n    return seg;\n}\n\n\nensuresegment(int k)  cas \n\n\n# : scanandlockforput\n\n segment  put  node = trylock() ? null : scanandlockforput(key, hash, value) trylock()  segment  scanandlockforput \n\n\n\nprivate hashentry<k,v> scanandlockforput(k key, int hash, v value) {\n    hashentry<k,v> first = entryforhash(this, hash);\n    hashentry<k,v> e = first;\n    hashentry<k,v> node = null;\n    int retries = -1; // negative while locating node\n\n    // \n    while (!trylock()) {\n        hashentry<k,v> f; // to recheck first below\n        if (retries < 0) {\n            if (e == null) {\n                if (node == null) // speculatively create node\n                    // \n                    //  trylock() \n                    node = new hashentry<k,v>(hash, key, value, null);\n                retries = 0;\n            }\n            else if (key.equals(e.key))\n                retries = 0;\n            else\n                // \n                e = e.next;\n        }\n        //  max_scan_retries(164)\n        //    lock() \n        else if (++retries > max_scan_retries) {\n            lock();\n            break;\n        }\n        else if ((retries & 1) == 0 &&\n                 // \n                 //      scanandlockforput \n                 (f = entryforhash(this, hash)) != first) {\n            e = first = f; // re-traverse if entry changed\n            retries = -1;\n        }\n    }\n    return node;\n}\n\n\n trylock()  max_scan_retries lock() \n\n segment  node\n\n\n# : rehash\n\nsegment  segment  hashentry<k,v>[]  2 \n\nput  segment  put \n\n segment \n\n//  node \nprivate void rehash(hashentry<k,v> node) {\n    hashentry<k,v>[] oldtable = table;\n    int oldcapacity = oldtable.length;\n    // 2 \n    int newcapacity = oldcapacity << 1;\n    threshold = (int)(newcapacity * loadfactor);\n    // \n    hashentry<k,v>[] newtable =\n        (hashentry<k,v>[]) new hashentry[newcapacity];\n    //  16  32 sizemask  31 000...00011111\n    int sizemask = newcapacity - 1;\n\n    //  i   i  i+oldcap \n    for (int i = 0; i < oldcapacity ; i++) {\n        // e \n        hashentry<k,v> e = oldtable[i];\n        if (e != null) {\n            hashentry<k,v> next = e.next;\n            // \n            //  16e  oldtable[3]  idx  3  3 + 16 = 19\n            int idx = e.hash & sizemask;\n            if (next == null)   // \n                newtable[idx] = e;\n            else { // reuse consecutive sequence at same slot\n                // e \n                hashentry<k,v> lastrun = e;\n                // idx  e \n                int lastidx = idx;\n\n                //  for  lastrun \n                for (hashentry<k,v> last = next;\n                     last != null;\n                     last = last.next) {\n                    int k = last.hash & sizemask;\n                    if (k != lastidx) {\n                        lastidx = k;\n                        lastrun = last;\n                    }\n                }\n                //  lastrun  lastidx \n                newtable[lastidx] = lastrun;\n                //  lastrun \n                //    \n                for (hashentry<k,v> p = e; p != lastrun; p = p.next) {\n                    v v = p.value;\n                    int h = p.hash;\n                    int k = h & sizemask;\n                    hashentry<k,v> n = newtable[k];\n                    newtable[k] = new hashentry<k,v>(h, p.key, v, n);\n                }\n            }\n        }\n    }\n    //  node    \n    int nodeindex = node.hash & sizemask; // add the new node\n    node.setnext(newtable[nodeindex]);\n    newtable[nodeindex] = node;\n    table = newtable;\n}\n\n\n hashmap  for  for ?\n\n for  for  lastrun  lastrun  lastrun \n\n doug lea  lastrun  doug lea  1/6 \n\n\n# get \n\n put get \n\n *  hash  segment \n *  hash \n * \n\npublic v get(object key) {\n    segment<k,v> s; // manually integrate access methods to reduce overhead\n    hashentry<k,v>[] tab;\n    // 1. hash \n    int h = hash(key);\n    long u = (((h >>> segmentshift) & segmentmask) << sshift) + sbase;\n    // 2.  hash  segment\n    if ((s = (segment<k,v>)unsafe.getobjectvolatile(segments, u)) != null &&\n        (tab = s.table) != null) {\n        // 3. segment \n        for (hashentry<k,v> e = (hashentry<k,v>) unsafe.getobjectvolatile\n                 (tab, ((long)(((tab.length - 1) & h)) << tshift) + tbase);\n             e != null; e = e.next) {\n            k k;\n            if ((k = e.key) == key || (e.hash == h && key.equals(k)))\n                return e.value;\n        }\n    }\n    return null;\n}\n\n\n\n# \n\n put  get  get \n\n put  remove  segment  get  segment  put  remove \n\n * put \n   *  cas  segment \n   *  get  get  put  setentryat  unsafe.putorderedobject\n   *  newtable  table get  get  table  put  put  table  volatile \n * remove \n   * remove \n   * get  remove ""\n   *  remove  get \n   *  remove  1 next table  volatile  volatile  unsafe  setentryat2 next  volatile \n\n\n# concurrenthashmap - jdk 1.8\n\njdk1.7concurrenthashmapsegmentjdk1.8concurrenthashmaphashmap++cassynchronized\n\n\n# \n\n\n\n java8  hashmap \n\n\n# \n\n// \npublic concurrenthashmap() {\n}\npublic concurrenthashmap(int initialcapacity) {\n    if (initialcapacity < 0)\n        throw new illegalargumentexception();\n    int cap = ((initialcapacity >= (maximum_capacity >>> 1)) ?\n               maximum_capacity :\n               tablesizefor(initialcapacity + (initialcapacity >>> 1) + 1));\n    this.sizectl = cap;\n}\n\n\n sizectlsizectl =  (1.5 * initialcapacity + 1) 2  n  initialcapacity  10 sizectl  16 initialcapacity  11 sizectl  32\n\nsizectl \n\n\n# put \n\n:\n\npublic v put(k key, v value) {\n    return putval(key, value, false);\n}\nfinal v putval(k key, v value, boolean onlyifabsent) {\n    if (key == null || value == null) throw new nullpointerexception();\n    //  hash \n    int hash = spread(key.hashcode());\n    // \n    int bincount = 0;\n    for (node<k,v>[] tab = table;;) {\n        node<k,v> f; int n, i, fh;\n        // ""\n        if (tab == null || (n = tab.length) == 0)\n            // \n            tab = inittable();\n\n        //  hash  f\n        else if ((f = tabat(tab, i = (n - 1) & hash)) == null) {\n            // \n            //     cas  put \n            //           cas \n            if (castabat(tab, i, null,\n                         new node<k,v>(hash, key, value, null)))\n                break;                   // no lock when adding to empty bin\n        }\n        // hash  moved\n        else if ((fh = f.hash) == moved)\n            // \n            tab = helptransfer(tab, f);\n\n        else { // f \n\n            v oldval = null;\n            // \n            synchronized (f) {\n                if (tabat(tab, i) == f) {\n                    if (fh >= 0) { //  hash  0\n                        // \n                        bincount = 1;\n                        // \n                        for (node<k,v> e = f;; ++bincount) {\n                            k ek;\n                            // "" key break \n                            if (e.hash == hash &&\n                                ((ek = e.key) == key ||\n                                 (ek != null && key.equals(ek)))) {\n                                oldval = e.val;\n                                if (!onlyifabsent)\n                                    e.val = value;\n                                break;\n                            }\n                            // \n                            node<k,v> pred = e;\n                            if ((e = e.next) == null) {\n                                pred.next = new node<k,v>(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    else if (f instanceof treebin) { // \n                        node<k,v> p;\n                        bincount = 2;\n                        // \n                        if ((p = ((treebin<k,v>)f).puttreeval(hash, key,\n                                                       value)) != null) {\n                            oldval = p.val;\n                            if (!onlyifabsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n\n            if (bincount != 0) {\n                //  hashmap  8\n                if (bincount >= treeify_threshold)\n                    //  hashmap \n                    //  64\n                    //    \n                    treeifybin(tab, i);\n                if (oldval != null)\n                    return oldval;\n                break;\n            }\n        }\n    }\n    // \n    addcount(1l, bincount);\n    return null;\n}\n\n\n\n# : inittable\n\n sizectl\n\n sizectl  cas \n\nprivate final node<k,v>[] inittable() {\n    node<k,v>[] tab; int sc;\n    while ((tab = table) == null || tab.length == 0) {\n        // """"\n        if ((sc = sizectl) < 0)\n            thread.yield(); // lost initialization race; just spin\n        // cas  sizectl  -1\n        else if (u.compareandswapint(this, sizectl, sc, -1)) {\n            try {\n                if ((tab = table) == null || tab.length == 0) {\n                    // default_capacity  16\n                    int n = (sc > 0) ? sc : default_capacity;\n                    //  16 \n                    node<k,v>[] nt = (node<k,v>[])new node<?,?>[n];\n                    //  tabletable  volatile \n                    table = tab = nt;\n                    //  n  16  sc = 12\n                    //  0.75 * n\n                    sc = n - (n >>> 2);\n                }\n            } finally {\n                //  sizectl  sc 12 \n                sizectl = sc;\n            }\n            break;\n        }\n    }\n    return tab;\n}\n\n\n\n# : treeifybin\n\n put treeifybin \n\nprivate final void treeifybin(node<k,v>[] tab, int index) {\n    node<k,v> b; int n, sc;\n    if (tab != null) {\n        // min_treeify_capacity  64\n        //  64  32  16 \n        if ((n = tab.length) < min_treeify_capacity)\n            // \n            trypresize(n << 1);\n        // b \n        else if ((b = tabat(tab, index)) != null && b.hash >= 0) {\n            // \n            synchronized (b) {\n\n                if (tabat(tab, index) == b) {\n                    // \n                    treenode<k,v> hd = null, tl = null;\n                    for (node<k,v> e = b; e != null; e = e.next) {\n                        treenode<k,v> p =\n                            new treenode<k,v>(e.hash, e.key, e.val,\n                                              null, null);\n                        if ((p.prev = tl) == null)\n                            hd = p;\n                        else\n                            tl.next = p;\n                        tl = p;\n                    }\n                    // \n                    settabat(tab, index, new treebin<k,v>(hd));\n                }\n            }\n        }\n    }\n}\n\n\n\n# : trypresize\n\n java8 concurrenthashmap \n\n transfer \n\n 2 \n\n//  size \nprivate final void trypresize(int size) {\n    // c: size  1.5  1 2  n \n    int c = (size >= (maximum_capacity >>> 1)) ? maximum_capacity :\n        tablesizefor(size + (size >>> 1) + 1);\n    int sc;\n    while ((sc = sizectl) >= 0) {\n        node<k,v>[] tab = table; int n;\n\n        //  if \n        if (tab == null || (n = tab.length) == 0) {\n            n = (sc > c) ? sc : c;\n            if (u.compareandswapint(this, sizectl, sc, -1)) {\n                try {\n                    if (table == tab) {\n                        @suppresswarnings("unchecked")\n                        node<k,v>[] nt = (node<k,v>[])new node<?,?>[n];\n                        table = nt;\n                        sc = n - (n >>> 2); // 0.75 * n\n                    }\n                } finally {\n                    sizectl = sc;\n                }\n            }\n        }\n        else if (c <= sc || n >= maximum_capacity)\n            break;\n        else if (tab == table) {\n            //  rs \n            int rs = resizestamp(n);\n\n            if (sc < 0) {\n                node<k,v>[] nt;\n                if ((sc >>> resize_stamp_shift) != rs || sc == rs + 1 ||\n                    sc == rs + max_resizers || (nt = nexttable) == null ||\n                    transferindex <= 0)\n                    break;\n                // 2.  cas  sizectl  1 transfer \n                //     nexttab  null\n                if (u.compareandswapint(this, sizectl, sc, sc + 1))\n                    transfer(tab, nt);\n            }\n            // 1.  sizectl  (rs << resize_stamp_shift) + 2)\n            //     ? \n            //   transfer  nexttab  null\n            else if (u.compareandswapint(this, sizectl, sc,\n                                         (rs << resize_stamp_shift) + 2))\n                transfer(tab, null);\n        }\n    }\n}\n\n\n sizectl  transfer(tab, null) sizectl  1 transfer(tab, nt) sizectl  1 transfer(tab, nt)\n\n 1  transfer(tab, null) +  transfer(tab, nt) transfer \n\n\n# : transfer\n\n tab  nexttab \n\n trypresize  transfer  transfer  put  put  helptransfer helptransfer  transfer \n\nnexttab  nullnexttab  null\n\n n n  doug lea  stride 16  transferindex \n\n transferindex  stride  transferindex  stride \n\nprivate final void transfer(node<k,v>[] tab, node<k,v>[] nexttab) {\n    int n = tab.length, stride;\n\n    // stride  n (n>>>3)/ncpu 16\n    // stride  n \n    //    n  stride \n    if ((stride = (ncpu > 1) ? (n >>> 3) / ncpu : n) < min_transfer_stride)\n        stride = min_transfer_stride; // subdivide range\n\n    //  nexttab  null\n    //     nexttab  null\n    //       nexttab  null\n    if (nexttab == null) {\n        try {\n            // \n            node<k,v>[] nt = (node<k,v>[])new node<?,?>[n << 1];\n            nexttab = nt;\n        } catch (throwable ex) {      // try to cope with oome\n            sizectl = integer.max_value;\n            return;\n        }\n        // nexttable  concurrenthashmap \n        nexttable = nexttab;\n        // transferindex  concurrenthashmap \n        transferindex = n;\n    }\n\n    int nextn = nexttab.length;\n\n    // forwardingnode  node\n    // nodekeyvalue  next  null hash  moved\n    //  i \n    //     i  forwardingnode\n    //    \n    forwardingnode<k,v> fwd = new forwardingnode<k,v>(nexttab);\n\n\n    // advance \n    boolean advance = true;\n    boolean finishing = false; // to ensure sweep before committing nexttab\n\n    /*\n     *  for \n     * \n     */\n\n    // i bound \n    for (int i = 0, bound = 0;;) {\n        node<k,v> f; int fh;\n\n        //  while \n        // advance  true \n        //   : i  transferindexbound  transferindex-stride\n        while (advance) {\n            int nextindex, nextbound;\n            if (--i >= bound || finishing)\n                advance = false;\n\n            //  transferindex  nextindex\n            //  transferindex  0\n            else if ((nextindex = transferindex) <= 0) {\n                i = -1;\n                advance = false;\n            }\n            else if (u.compareandswapint\n                     (this, transferindex, nextindex,\n                      nextbound = (nextindex > stride ?\n                                   nextindex - stride : 0))) {\n                // nextbound \n                bound = nextbound;\n                i = nextindex - 1;\n                advance = false;\n            }\n        }\n        if (i < 0 || i >= n || i + n >= nextn) {\n            int sc;\n            if (finishing) {\n                // \n                nexttable = null;\n                //  nexttab  table \n                table = nexttab;\n                //  sizectl: n  sizectl  0.75 \n                sizectl = (n << 1) - (n >>> 1);\n                return;\n            }\n\n            // sizectl  (rs << resize_stamp_shift) + 2\n            //  sizectl  1\n            //  cas  sizectl  1\n            if (u.compareandswapint(this, sizectl, sc = sizectl, sc - 1)) {\n                // \n                if ((sc - 2) != resizestamp(n) << resize_stamp_shift)\n                    return;\n\n                //  (sc - 2) == resizestamp(n) << resize_stamp_shift\n                //  if(finishing){} \n                finishing = advance = true;\n                i = n; // recheck before commit\n            }\n        }\n        //  i  forwardingnode \n        else if ((f = tabat(tab, i)) == null)\n            advance = castabat(tab, i, null, fwd);\n        //  forwardingnode\n        else if ((fh = f.hash) == moved)\n            advance = true; // already processed\n        else {\n            // \n            synchronized (f) {\n                if (tabat(tab, i) == f) {\n                    node<k,v> ln, hn;\n                    //  hash  0 node \n                    if (fh >= 0) {\n                        //  java7  concurrenthashmap \n                        // \n                        //    lastrun lastrun \n                        //   lastrun \n                        int runbit = fh & n;\n                        node<k,v> lastrun = f;\n                        for (node<k,v> p = f.next; p != null; p = p.next) {\n                            int b = p.hash & n;\n                            if (b != runbit) {\n                                runbit = b;\n                                lastrun = p;\n                            }\n                        }\n                        if (runbit == 0) {\n                            ln = lastrun;\n                            hn = null;\n                        }\n                        else {\n                            hn = lastrun;\n                            ln = null;\n                        }\n                        for (node<k,v> p = f; p != lastrun; p = p.next) {\n                            int ph = p.hash; k pk = p.key; v pv = p.val;\n                            if ((ph & n) == 0)\n                                ln = new node<k,v>(ph, pk, pv, ln);\n                            else\n                                hn = new node<k,v>(ph, pk, pv, hn);\n                        }\n                        //  i\n                        settabat(nexttab, i, ln);\n                        //  i+n\n                        settabat(nexttab, i + n, hn);\n                        //  fwd\n                        //     hash  moved\n                        settabat(tab, i, fwd);\n                        // advance  true\n                        advance = true;\n                    }\n                    else if (f instanceof treebin) {\n                        // \n                        treebin<k,v> t = (treebin<k,v>)f;\n                        treenode<k,v> lo = null, lotail = null;\n                        treenode<k,v> hi = null, hitail = null;\n                        int lc = 0, hc = 0;\n                        for (node<k,v> e = t.first; e != null; e = e.next) {\n                            int h = e.hash;\n                            treenode<k,v> p = new treenode<k,v>\n                                (h, e.key, e.val, null, null);\n                            if ((h & n) == 0) {\n                                if ((p.prev = lotail) == null)\n                                    lo = p;\n                                else\n                                    lotail.next = p;\n                                lotail = p;\n                                ++lc;\n                            }\n                            else {\n                                if ((p.prev = hitail) == null)\n                                    hi = p;\n                                else\n                                    hitail.next = p;\n                                hitail = p;\n                                ++hc;\n                            }\n                        }\n                        // 6\n                        ln = (lc <= untreeify_threshold) ? untreeify(lo) :\n                            (hc != 0) ? new treebin<k,v>(lo) : t;\n                        hn = (hc <= untreeify_threshold) ? untreeify(hi) :\n                            (lc != 0) ? new treebin<k,v>(hi) : t;\n\n                        //  ln  i\n                        settabat(nexttab, i, ln);\n                        //  hn  i+n\n                        settabat(nexttab, i + n, hn);\n                        //  fwd\n                        //     hash  moved\n                        settabat(tab, i, fwd);\n                        // advance  true\n                        advance = true;\n                    }\n                }\n            }\n        }\n    }\n}\n\n\ntransfer  transferindex  stride \n\n trypresize \n\n\n# get \n\nget :\n\n *  hash \n *  hash : (n - 1) & h\n * \n   *  null null \n   * \n   *  hash  0 find \n   *  3 \n\npublic v get(object key) {\n    node<k,v>[] tab; node<k,v> e, p; int n, eh; k ek;\n    int h = spread(key.hashcode());\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (e = tabat(tab, (n - 1) & h)) != null) {\n        // \n        if ((eh = e.hash) == h) {\n            if ((ek = e.key) == key || (ek != null && key.equals(ek)))\n                return e.val;\n        }\n        //  hash  0 \n        else if (eh < 0)\n            //  forwardingnode.find(int h, object k)  treebin.find(int h, object k)\n            return (p = e.find(h, key)) != null ? p.val : null;\n\n        // \n        while ((e = e.next) != null) {\n            if (e.hash == h &&\n                ((ek = e.key) == key || (ek != null && key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n\n\nforwardingnode.find(int h, object k) \n\n\n# \n\n * hashtable : synchronizedput;\n * concurrenthashmap jdk1.7: ;\n * concurrenthashmap jdk1.8: ++cas;\n\n\n# \n\n * https://blog.csdn.net/defonds/article/details/44021605#t7\n * http://tutorials.jenkov.com/java-concurrency/index.html\n * https://juejin.im/post/5aeeaba8f265da0b9d781d16\n * https://www.javadoop.com/post/hashmap#java7%20concurrenthashmap\n * https://blog.csdn.net/bill_xiang_/article/details/81122044\n * https://www.cnblogs.com/leesf456/p/5453341.html\n * https://www.cnblogs.com/huaizuo/archive/2016/04/20/5413069.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-concurrenthashmap.html',charsets:{cjk:!0}},{title:"JUC: ConcurrentLinkedQueue",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html",relativePath:"java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.md",key:"v-2cb56542",path:"/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html",headers:[{level:2,title:"JUC: ConcurrentLinkedQueue",slug:"juc-concurrentlinkedqueue",normalizedTitle:"juc: concurrentlinkedqueue",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:278},{level:2,title:"ConcurrentLinkedQueue",slug:"concurrentlinkedqueue",normalizedTitle:"concurrentlinkedqueue",charIndex:299},{level:2,title:"ConcurrentLinkedQueue",slug:"concurrentlinkedqueue",normalizedTitle:"concurrentlinkedqueue",charIndex:330},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:363},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:377},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:390},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:402},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:416},{level:2,title:"ConcurrentLinkedQueue",slug:"concurrentlinkedqueue",normalizedTitle:"concurrentlinkedqueue",charIndex:495},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:524},{level:3,title:"HOPS()",slug:"hops--",normalizedTitle:"hops()",charIndex:537},{level:3,title:"ConcurrentLinkedQueue",slug:"concurrentlinkedqueue",normalizedTitle:"concurrentlinkedqueue",charIndex:561},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:593}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ConcurrentLinkedQueue BAT ConcurrentLinkedQueue ConcurrentLinkedQueue      ConcurrentLinkedQueue  HOPS() ConcurrentLinkedQueue ",content:'# JUC: ConcurrentLinkedQueue\n\n> ConcurerntLinkedQueue FIFO()  collection ConcurrentLinkedQueuenull\n\n * JUC: ConcurrentLinkedQueue\n   * BAT\n   * ConcurrentLinkedQueue\n   * ConcurrentLinkedQueue\n     * \n     * \n     * \n     * \n     * \n       * offer\n       * poll\n       * remove\n       * size\n   * ConcurrentLinkedQueue\n   * \n     * HOPS()\n     * ConcurrentLinkedQueue\n   * \n\n\n# BAT\n\n\n\n\n\n * ? VectorCollections.synchronizedList(List<T> list), ConcurrentLinkedQueue\n * ConcurrentLinkedQueue?\n * ConcurrentLinkedQueue? (CAS)\n * ConcurrentLinkedQueue? offer()poll()peek()isEmpty()\n * ConcurrentLinkedQueueHOPS()?\n * ConcurrentLinkedQueue?\n\n\n# ConcurrentLinkedQueue\n\nConcurrentLinkedQueueLinkedBlockingQueueConcurrentLinkedQueue:\n\n\n\n: ConcurrentLinkedQueue\n\n\n# ConcurrentLinkedQueue\n\n\n# \n\npublic class ConcurrentLinkedQueue<E> extends AbstractQueue<E>\n        implements Queue<E>, java.io.Serializable {}\n\n\n: ConcurrentLinkedQueueAbstractQueueAbstractQueueQueueQueueSerializable\n\n\n# \n\nprivate static class Node<E> {\n    // \n    volatile E item;\n    // next\n    volatile Node<E> next;\n\n    /**\n        * Constructs a new node.  Uses relaxed write because item can\n        * only be seen after publication via casNext.\n        */\n    // \n    Node(E item) {\n        // item\n        UNSAFE.putObject(this, itemOffset, item);\n    }\n    // item\n    boolean casItem(E cmp, E val) {\n        return UNSAFE.compareAndSwapObject(this, itemOffset, cmp, val);\n    }\n    \n    void lazySetNext(Node<E> val) {\n        // next\n        UNSAFE.putOrderedObject(this, nextOffset, val);\n    }\n    // next\n    boolean casNext(Node<E> cmp, Node<E> val) {\n        return UNSAFE.compareAndSwapObject(this, nextOffset, cmp, val);\n    }\n\n    // Unsafe mechanics\n    // \n    private static final sun.misc.Unsafe UNSAFE;\n    // item\n    private static final long itemOffset;\n    // next\n    private static final long nextOffset;\n\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> k = Node.class;\n            itemOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("item"));\n            nextOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("next"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n}\n\n\n: NodeitemnextitemnextCASitemnext\n\n\n# \n\npublic class ConcurrentLinkedQueue<E> extends AbstractQueue<E>\n        implements Queue<E>, java.io.Serializable {\n    //         \n    private static final long serialVersionUID = 196745693267521676L;\n    // \n    private static final sun.misc.Unsafe UNSAFE;\n    // head\n    private static final long headOffset;\n    // tail\n    private static final long tailOffset;\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> k = ConcurrentLinkedQueue.class;\n            headOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("head"));\n            tailOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("tail"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n    \n    // \n    private transient volatile Node<E> head;\n    // \n    private transient volatile Node<E> tail;\n}\n\n\n: headtailConcurrentLinkedQueueCAS\n\n\n# \n\n * ConcurrentLinkedQueue()\n\npublic ConcurrentLinkedQueue() {\n    // \n    head = tail = new Node<E>(null);\n}\n\n\n:  ConcurrentLinkedQueueitemnullnextnull\n\n * ConcurrentLinkedQueue(Collection<? extends E>)\n\npublic ConcurrentLinkedQueue(Collection<? extends E> c) {\n    Node<E> h = null, t = null;\n    for (E e : c) { // c\n        // \n        checkNotNull(e);\n        // \n        Node<E> newNode = new Node<E>(e);\n        if (h == null) // null\n            // \n            h = t = newNode;\n        else {\n            // next\n            t.lazySetNext(newNode);\n            // \n            t = newNode;\n        }\n    }\n    if (h == null) // null\n        // \n        h = t = new Node<E>(null);\n    // \n    head = h;\n    // \n    tail = t;\n}\n\n\n:  collection  ConcurrentLinkedQueue collection \n\n\n# \n\n# offer\n\npublic boolean offer(E e) {\n    // null\n    checkNotNull(e);\n    // \n    final Node<E> newNode = new Node<E>(e);\n\n    for (Node<E> t = tail, p = t;;) { // \n        // qp\n        Node<E> q = p.next;\n        if (q == null) { // qnull\n            // p is last node\n            if (p.casNext(null, newNode)) { // pnext\n                // Successful CAS is the linearization point\n                // for e to become an element of this queue,\n                // and for newNode to become "live".\n                if (p != t) // pt    // hop two nodes at a time\n                    // \n                    casTail(t, newNode);  // Failure is OK.\n                // \n                return true;\n            }\n            // Lost CAS race to another thread; re-read next\n        }\n        else if (p == q) // pq\n            // We have fallen off list.  If tail is unchanged, it\n            // will also be off-list, in which case we need to\n            // jump to head, from which all live nodes are always\n            // reachable.  Else the new tail is a better bet.\n            // phead\n            p = (t != (t = tail)) ? t : head;\n        else\n            // Check for tail updates after two hops.\n            // p\n            p = (p != t && t != (t = tail)) ? t : q;\n    }\n}\n\n\n: offeroffer(1020)\n\n\n\n * ConcurrentLinkedQueue10\n\n\n\n * 10tail20\n\n\n\n * 20tail\n\n# poll\n\npublic E poll() {\n    restartFromHead:\n    for (;;) { // \n        for (Node<E> h = head, p = h, q;;) { // \n            // item\n            E item = p.item;\n\n            if (item != null && p.casItem(item, null)) { // itemnullitem\n                // Successful CAS is the linearization point\n                // for item to be removed from this queue.\n                if (p != h) // ph    // hop two nodes at a time\n                    // \n                    updateHead(h, ((q = p.next) != null) ? q : p); \n                // item\n                return item;\n            }\n            else if ((q = p.next) == null) { // qnull\n                // \n                updateHead(h, p);\n                return null;\n            }\n            else if (p == q) // pq\n                // \n                continue restartFromHead;\n            else\n                // pq\n                p = q;\n        }\n    }\n}\n\n\n: nullpoll(offer1020poll)\n\n\n\n * poll\n\n\n\n * pollheadheaditemnullpoll\n\n\n\n * pollheaditemnull\n\n# remove\n\npublic boolean remove(Object o) {\n    // null\n    if (o == null) return false;\n    Node<E> pred = null;\n    for (Node<E> p = first(); p != null; p = succ(p)) { // \n        // item\n        E item = p.item;\n        if (item != null &&\n            o.equals(item) &&\n            p.casItem(item, null)) { // itemitemnull\n            // p\n            Node<E> next = succ(p);\n            if (pred != null && next != null) // prednullnextnull\n                // next\n                pred.casNext(p, next);\n            return true;\n        }\n        // predp\n        pred = p;\n    }\n    return false;\n}\n\n\n: ()firstsuccfirst\n\nNode<E> first() {\n    restartFromHead:\n    for (;;) { // \n        for (Node<E> h = head, p = h, q;;) {\n            // pitemnull\n            boolean hasItem = (p.item != null);\n            if (hasItem || (q = p.next) == null) { // itemnullnextnull\n                // \n                updateHead(h, p);\n                // \n                return hasItem ? p : null;\n            }\n            else if (p == q) // pq\n                // \n                continue restartFromHead;\n            else\n                // pq\n                p = q;\n        }\n    }\n}\n\n\n: firstsucc\n\nfinal Node<E> succ(Node<E> p) {\n    // pnext\n    Node<E> next = p.next;\n    // nextnext\n    return (p == next) ? head : next;\n}\n\n\n: succnextheadnextremove(offer1020remove(10)remove(20))\n\n\n\n * ConcurrentLinkedQueueremove(10)\n\n\n\n * remove(10)headheadheaditemnullremove(20)\n\n\n\n * remove(20)headtailitemnull\n\n# size\n\npublic int size() {\n    // \n    int count = 0;\n    for (Node<E> p = first(); p != null; p = succ(p)) // \n        if (p.item != null) // itemnull\n            // Collection.size() spec says to max out\n            if (++count == Integer.MAX_VALUE) // \n                break;\n    // \n    return count;\n}\n\n\n: ConcurrenLinkedQueue(first)itemnull\n\n\n# ConcurrentLinkedQueue\n\nConcurrentLinkedQueue\n\nimport java.util.concurrent.ConcurrentLinkedQueue;\n\nclass PutThread extends Thread {\n    private ConcurrentLinkedQueue<Integer> clq;\n    public PutThread(ConcurrentLinkedQueue<Integer> clq) {\n        this.clq = clq;\n    }\n    \n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                System.out.println("add " + i);\n                clq.add(i);\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nclass GetThread extends Thread {\n    private ConcurrentLinkedQueue<Integer> clq;\n    public GetThread(ConcurrentLinkedQueue<Integer> clq) {\n        this.clq = clq;\n    }\n    \n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                System.out.println("poll " + clq.poll());\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\npublic class ConcurrentLinkedQueueDemo {\n    public static void main(String[] args) {\n        ConcurrentLinkedQueue<Integer> clq = new ConcurrentLinkedQueue<Integer>();\n        PutThread p1 = new PutThread(clq);\n        GetThread g1 = new GetThread(clq);\n        \n        p1.start();\n        g1.start();\n        \n    }\n}\n\n\n():\n\nadd 0\npoll null\nadd 1\npoll 0\nadd 2\npoll 1\nadd 3\npoll 2\nadd 4\npoll 3\nadd 5\npoll 4\npoll 5\nadd 6\nadd 7\npoll 6\npoll 7\nadd 8\nadd 9\npoll 8\n\n\n: GetThreadConcurrentLinkedQueuenull\n\n\n# \n\n\n# HOPS()\n\nofferpolltailhead\n\n * tailtailnullcasTailtailtailnulltail\n\n * headheaditemnullupdateHeadheadheaditemnullhead\n\nhop two nodes at a timeHOPS( )headtail?\n\ntailCAStailCASdoug lea1(tail1)CAStailhead\n\n\n# ConcurrentLinkedQueue\n\nConcurrentLinkedQueue\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5539142.html\n * https://blog.csdn.net/u011521203/article/details/80214968\n * https://blog.csdn.net/u014493323/article/details/81177194\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html',normalizedContent:'# juc: concurrentlinkedqueue\n\n> concurerntlinkedqueue fifo()  collection concurrentlinkedqueuenull\n\n * juc: concurrentlinkedqueue\n   * bat\n   * concurrentlinkedqueue\n   * concurrentlinkedqueue\n     * \n     * \n     * \n     * \n     * \n       * offer\n       * poll\n       * remove\n       * size\n   * concurrentlinkedqueue\n   * \n     * hops()\n     * concurrentlinkedqueue\n   * \n\n\n# bat\n\n\n\n\n\n * ? vectorcollections.synchronizedlist(list<t> list), concurrentlinkedqueue\n * concurrentlinkedqueue?\n * concurrentlinkedqueue? (cas)\n * concurrentlinkedqueue? offer()poll()peek()isempty()\n * concurrentlinkedqueuehops()?\n * concurrentlinkedqueue?\n\n\n# concurrentlinkedqueue\n\nconcurrentlinkedqueuelinkedblockingqueueconcurrentlinkedqueue:\n\n\n\n: concurrentlinkedqueue\n\n\n# concurrentlinkedqueue\n\n\n# \n\npublic class concurrentlinkedqueue<e> extends abstractqueue<e>\n        implements queue<e>, java.io.serializable {}\n\n\n: concurrentlinkedqueueabstractqueueabstractqueuequeuequeueserializable\n\n\n# \n\nprivate static class node<e> {\n    // \n    volatile e item;\n    // next\n    volatile node<e> next;\n\n    /**\n        * constructs a new node.  uses relaxed write because item can\n        * only be seen after publication via casnext.\n        */\n    // \n    node(e item) {\n        // item\n        unsafe.putobject(this, itemoffset, item);\n    }\n    // item\n    boolean casitem(e cmp, e val) {\n        return unsafe.compareandswapobject(this, itemoffset, cmp, val);\n    }\n    \n    void lazysetnext(node<e> val) {\n        // next\n        unsafe.putorderedobject(this, nextoffset, val);\n    }\n    // next\n    boolean casnext(node<e> cmp, node<e> val) {\n        return unsafe.compareandswapobject(this, nextoffset, cmp, val);\n    }\n\n    // unsafe mechanics\n    // \n    private static final sun.misc.unsafe unsafe;\n    // item\n    private static final long itemoffset;\n    // next\n    private static final long nextoffset;\n\n    static {\n        try {\n            unsafe = sun.misc.unsafe.getunsafe();\n            class<?> k = node.class;\n            itemoffset = unsafe.objectfieldoffset\n                (k.getdeclaredfield("item"));\n            nextoffset = unsafe.objectfieldoffset\n                (k.getdeclaredfield("next"));\n        } catch (exception e) {\n            throw new error(e);\n        }\n    }\n}\n\n\n: nodeitemnextitemnextcasitemnext\n\n\n# \n\npublic class concurrentlinkedqueue<e> extends abstractqueue<e>\n        implements queue<e>, java.io.serializable {\n    //         \n    private static final long serialversionuid = 196745693267521676l;\n    // \n    private static final sun.misc.unsafe unsafe;\n    // head\n    private static final long headoffset;\n    // tail\n    private static final long tailoffset;\n    static {\n        try {\n            unsafe = sun.misc.unsafe.getunsafe();\n            class<?> k = concurrentlinkedqueue.class;\n            headoffset = unsafe.objectfieldoffset\n                (k.getdeclaredfield("head"));\n            tailoffset = unsafe.objectfieldoffset\n                (k.getdeclaredfield("tail"));\n        } catch (exception e) {\n            throw new error(e);\n        }\n    }\n    \n    // \n    private transient volatile node<e> head;\n    // \n    private transient volatile node<e> tail;\n}\n\n\n: headtailconcurrentlinkedqueuecas\n\n\n# \n\n * concurrentlinkedqueue()\n\npublic concurrentlinkedqueue() {\n    // \n    head = tail = new node<e>(null);\n}\n\n\n:  concurrentlinkedqueueitemnullnextnull\n\n * concurrentlinkedqueue(collection<? extends e>)\n\npublic concurrentlinkedqueue(collection<? extends e> c) {\n    node<e> h = null, t = null;\n    for (e e : c) { // c\n        // \n        checknotnull(e);\n        // \n        node<e> newnode = new node<e>(e);\n        if (h == null) // null\n            // \n            h = t = newnode;\n        else {\n            // next\n            t.lazysetnext(newnode);\n            // \n            t = newnode;\n        }\n    }\n    if (h == null) // null\n        // \n        h = t = new node<e>(null);\n    // \n    head = h;\n    // \n    tail = t;\n}\n\n\n:  collection  concurrentlinkedqueue collection \n\n\n# \n\n# offer\n\npublic boolean offer(e e) {\n    // null\n    checknotnull(e);\n    // \n    final node<e> newnode = new node<e>(e);\n\n    for (node<e> t = tail, p = t;;) { // \n        // qp\n        node<e> q = p.next;\n        if (q == null) { // qnull\n            // p is last node\n            if (p.casnext(null, newnode)) { // pnext\n                // successful cas is the linearization point\n                // for e to become an element of this queue,\n                // and for newnode to become "live".\n                if (p != t) // pt    // hop two nodes at a time\n                    // \n                    castail(t, newnode);  // failure is ok.\n                // \n                return true;\n            }\n            // lost cas race to another thread; re-read next\n        }\n        else if (p == q) // pq\n            // we have fallen off list.  if tail is unchanged, it\n            // will also be off-list, in which case we need to\n            // jump to head, from which all live nodes are always\n            // reachable.  else the new tail is a better bet.\n            // phead\n            p = (t != (t = tail)) ? t : head;\n        else\n            // check for tail updates after two hops.\n            // p\n            p = (p != t && t != (t = tail)) ? t : q;\n    }\n}\n\n\n: offeroffer(1020)\n\n\n\n * concurrentlinkedqueue10\n\n\n\n * 10tail20\n\n\n\n * 20tail\n\n# poll\n\npublic e poll() {\n    restartfromhead:\n    for (;;) { // \n        for (node<e> h = head, p = h, q;;) { // \n            // item\n            e item = p.item;\n\n            if (item != null && p.casitem(item, null)) { // itemnullitem\n                // successful cas is the linearization point\n                // for item to be removed from this queue.\n                if (p != h) // ph    // hop two nodes at a time\n                    // \n                    updatehead(h, ((q = p.next) != null) ? q : p); \n                // item\n                return item;\n            }\n            else if ((q = p.next) == null) { // qnull\n                // \n                updatehead(h, p);\n                return null;\n            }\n            else if (p == q) // pq\n                // \n                continue restartfromhead;\n            else\n                // pq\n                p = q;\n        }\n    }\n}\n\n\n: nullpoll(offer1020poll)\n\n\n\n * poll\n\n\n\n * pollheadheaditemnullpoll\n\n\n\n * pollheaditemnull\n\n# remove\n\npublic boolean remove(object o) {\n    // null\n    if (o == null) return false;\n    node<e> pred = null;\n    for (node<e> p = first(); p != null; p = succ(p)) { // \n        // item\n        e item = p.item;\n        if (item != null &&\n            o.equals(item) &&\n            p.casitem(item, null)) { // itemitemnull\n            // p\n            node<e> next = succ(p);\n            if (pred != null && next != null) // prednullnextnull\n                // next\n                pred.casnext(p, next);\n            return true;\n        }\n        // predp\n        pred = p;\n    }\n    return false;\n}\n\n\n: ()firstsuccfirst\n\nnode<e> first() {\n    restartfromhead:\n    for (;;) { // \n        for (node<e> h = head, p = h, q;;) {\n            // pitemnull\n            boolean hasitem = (p.item != null);\n            if (hasitem || (q = p.next) == null) { // itemnullnextnull\n                // \n                updatehead(h, p);\n                // \n                return hasitem ? p : null;\n            }\n            else if (p == q) // pq\n                // \n                continue restartfromhead;\n            else\n                // pq\n                p = q;\n        }\n    }\n}\n\n\n: firstsucc\n\nfinal node<e> succ(node<e> p) {\n    // pnext\n    node<e> next = p.next;\n    // nextnext\n    return (p == next) ? head : next;\n}\n\n\n: succnextheadnextremove(offer1020remove(10)remove(20))\n\n\n\n * concurrentlinkedqueueremove(10)\n\n\n\n * remove(10)headheadheaditemnullremove(20)\n\n\n\n * remove(20)headtailitemnull\n\n# size\n\npublic int size() {\n    // \n    int count = 0;\n    for (node<e> p = first(); p != null; p = succ(p)) // \n        if (p.item != null) // itemnull\n            // collection.size() spec says to max out\n            if (++count == integer.max_value) // \n                break;\n    // \n    return count;\n}\n\n\n: concurrenlinkedqueue(first)itemnull\n\n\n# concurrentlinkedqueue\n\nconcurrentlinkedqueue\n\nimport java.util.concurrent.concurrentlinkedqueue;\n\nclass putthread extends thread {\n    private concurrentlinkedqueue<integer> clq;\n    public putthread(concurrentlinkedqueue<integer> clq) {\n        this.clq = clq;\n    }\n    \n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                system.out.println("add " + i);\n                clq.add(i);\n                thread.sleep(100);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        }\n    }\n}\n\nclass getthread extends thread {\n    private concurrentlinkedqueue<integer> clq;\n    public getthread(concurrentlinkedqueue<integer> clq) {\n        this.clq = clq;\n    }\n    \n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                system.out.println("poll " + clq.poll());\n                thread.sleep(100);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        }\n    }\n}\n\npublic class concurrentlinkedqueuedemo {\n    public static void main(string[] args) {\n        concurrentlinkedqueue<integer> clq = new concurrentlinkedqueue<integer>();\n        putthread p1 = new putthread(clq);\n        getthread g1 = new getthread(clq);\n        \n        p1.start();\n        g1.start();\n        \n    }\n}\n\n\n():\n\nadd 0\npoll null\nadd 1\npoll 0\nadd 2\npoll 1\nadd 3\npoll 2\nadd 4\npoll 3\nadd 5\npoll 4\npoll 5\nadd 6\nadd 7\npoll 6\npoll 7\nadd 8\nadd 9\npoll 8\n\n\n: getthreadconcurrentlinkedqueuenull\n\n\n# \n\n\n# hops()\n\nofferpolltailhead\n\n * tailtailnullcastailtailtailnulltail\n\n * headheaditemnullupdateheadheadheaditemnullhead\n\nhop two nodes at a timehops( )headtail?\n\ntailcastailcasdoug lea1(tail1)castailhead\n\n\n# concurrentlinkedqueue\n\nconcurrentlinkedqueue\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5539142.html\n * https://blog.csdn.net/u011521203/article/details/80214968\n * https://blog.csdn.net/u014493323/article/details/81177194\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-concurrentlinkedqueue.html',charsets:{cjk:!0}},{title:"JUC: CopyOnWriteArrayList",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html",relativePath:"java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.md",key:"v-2f00794e",path:"/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html",headers:[{level:2,title:"JUC: CopyOnWriteArrayList",slug:"juc-copyonwritearraylist",normalizedTitle:"juc: copyonwritearraylist",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:168},{level:2,title:"CopyOnWriteArrayList",slug:"copyonwritearraylist",normalizedTitle:"copyonwritearraylist",charIndex:189},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:221},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:235},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:248},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:260},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:274},{level:2,title:"CopyOnWriteArrayList",slug:"copyonwritearraylist",normalizedTitle:"copyonwritearraylist",charIndex:375},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:403},{level:3,title:"CopyOnWriteArrayList",slug:"copyonwritearraylist",normalizedTitle:"copyonwritearraylist",charIndex:416},{level:3,title:"CopyOnWriteArrayListVector?",slug:"copyonwritearraylistvector",normalizedTitle:"copyonwritearraylistvector?",charIndex:452},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:497}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: CopyOnWriteArrayList BAT CopyOnWriteArrayList      CopyOnWriteArrayList  CopyOnWriteArrayList CopyOnWriteArrayListVector? ",content:'# JUC: CopyOnWriteArrayList\n\n> CopyOnWriteArrayListArrayList (addset )COW\n\n * JUC: CopyOnWriteArrayList\n   * BAT\n   * CopyOnWriteArrayList\n     * \n     * \n     * \n     * \n     * \n       * copyOf\n       * add\n       * addIfAbsent\n       * set\n       * remove\n   * CopyOnWriteArrayList\n   * \n     * CopyOnWriteArrayList\n     * CopyOnWriteArrayListVector?\n   * \n\n\n# BAT\n\n\n\n\n\n * Fail-fast?\n * ArrayList?\n * ArrayListCopyOnWriteArrayList? COW\n * ? COWIterator<E>\n * CopyOnWriteArrayListVector?\n * CopyOnWriteArrayList?\n\n\n# CopyOnWriteArrayList\n\n\n# \n\nCopyOnWriteArrayListListListRandomAccess()CloneableSerializable\n\npublic class CopyOnWriteArrayList<E> implements List<E>, RandomAccess, Cloneable, java.io.Serializable {}\n\n\n\n# \n\n * COWIterator\n\nCOWIteratorObjectCopyOnWriteArrayList ConcurrentModificationException(removeset  add) UnsupportedOperationException\n\nstatic final class COWIterator<E> implements ListIterator<E> {\n    /** Snapshot of the array */\n    // \n    private final Object[] snapshot;\n    /** Index of element to be returned by subsequent call to next.  */\n    // \n    private int cursor;\n    // \n    private COWIterator(Object[] elements, int initialCursor) {\n        cursor = initialCursor;\n        snapshot = elements;\n    }\n    // \n    public boolean hasNext() {\n        return cursor < snapshot.length;\n    }\n    // \n    public boolean hasPrevious() {\n        return cursor > 0;\n    }\n    // next\n    @SuppressWarnings("unchecked")\n    public E next() {\n        if (! hasNext()) // \n            throw new NoSuchElementException();\n        // \n        return (E) snapshot[cursor++];\n    }\n\n    @SuppressWarnings("unchecked")\n    public E previous() {\n        if (! hasPrevious())\n            throw new NoSuchElementException();\n        return (E) snapshot[--cursor];\n    }\n    \n    // \n    public int nextIndex() {\n        return cursor;\n    }\n    \n    // \n    public int previousIndex() {\n        return cursor-1;\n    }\n\n    /**\n        * Not supported. Always throws UnsupportedOperationException.\n        * @throws UnsupportedOperationException always; {@code remove}\n        *         is not supported by this iterator.\n        */\n    // remove\n    public void remove() {\n        throw new UnsupportedOperationException();\n    }\n\n    /**\n        * Not supported. Always throws UnsupportedOperationException.\n        * @throws UnsupportedOperationException always; {@code set}\n        *         is not supported by this iterator.\n        */\n    // set\n    public void set(E e) {\n        throw new UnsupportedOperationException();\n    }\n\n    /**\n        * Not supported. Always throws UnsupportedOperationException.\n        * @throws UnsupportedOperationException always; {@code add}\n        *         is not supported by this iterator.\n        */\n    // add\n    public void add(E e) {\n        throw new UnsupportedOperationException();\n    }\n\n    @Override\n    public void forEachRemaining(Consumer<? super E> action) {\n        Objects.requireNonNull(action);\n        Object[] elements = snapshot;\n        final int size = elements.length;\n        for (int i = cursor; i < size; i++) {\n            @SuppressWarnings("unchecked") E e = (E) elements[i];\n            action.accept(e);\n        }\n        cursor = size;\n    }\n}\n\n\n\n# \n\nObjectCASlock\n\npublic class CopyOnWriteArrayList<E>\n    implements List<E>, RandomAccess, Cloneable, java.io.Serializable {\n    // \n    private static final long serialVersionUID = 8673264195747942595L;\n    // \n    final transient ReentrantLock lock = new ReentrantLock();\n    // \n    private transient volatile Object[] array;\n    // \n    private static final sun.misc.Unsafe UNSAFE;\n    // lock\n    private static final long lockOffset;\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> k = CopyOnWriteArrayList.class;\n            lockOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("lock"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n}\n\n\n\n# \n\n * \n\npublic CopyOnWriteArrayList() {\n    // \n    setArray(new Object[0]);\n}\n\n\n * CopyOnWriteArrayList(Collection<? extends E>)  collection  collection \n\npublic CopyOnWriteArrayList(Collection<? extends E> c) {\n    Object[] elements;\n    if (c.getClass() == CopyOnWriteArrayList.class) // \n        // c\n        elements = ((CopyOnWriteArrayList<?>)c).getArray();\n    else { // \n        // celements\n        elements = c.toArray();\n        // c.toArray might (incorrectly) not return Object[] (see 6260652)\n        if (elements.getClass() != Object[].class) // elementsObject[]\n            // elementsObject[]\n            elements = Arrays.copyOf(elements, elements.length, Object[].class);\n    }\n    // \n    setArray(elements);\n}\n\n\n\n\n * cCopyOnWriteArrayList(Object[])CopyOnWriteArrayList(Object[])\n\n * elementselementsObject[](toArrayObject)elementsObject\n\n * CopyOnWriteArrayListObject[]elements\n\n * CopyOnWriteArrayList(E[])\n\n\n\npublic CopyOnWriteArrayList(E[] toCopyIn) {\n    // toCopyInObject[]\n    setArray(Arrays.copyOf(toCopyIn, toCopyIn.length, Object[].class));\n}\n\n\n\n# \n\nCopyOnWriteArrayListArrays.copyOfCopyOnWriteArrayList\n\n# copyOf\n\n null ()\n\npublic static <T,U> T[] copyOf(U[] original, int newLength, Class<? extends T[]> newType) {\n    @SuppressWarnings("unchecked")\n    // copy(newTypeObjectObject[].classObjectObject\n    // ,)\n    T[] copy = ((Object)newType == (Object)Object[].class)\n        ? (T[]) new Object[newLength]\n        : (T[]) Array.newInstance(newType.getComponentType(), newLength);\n    // original0(original.lengthnewLength),copy(0)\n    System.arraycopy(original, 0, copy, 0,\n                        Math.min(original.length, newLength));\n    return copy;\n}\n\n\n# add\n\npublic boolean add(E e) {\n    // \n    final ReentrantLock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        Object[] elements = getArray();\n        // \n        int len = elements.length;\n        // \n        Object[] newElements = Arrays.copyOf(elements, len + 1);\n        // e\n        newElements[len] = e;\n        // \n        setArray(newElements);\n        return true;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n\n\n * ()ObjectObjectlength\n\n * Objectlength+1ObjectnewElements(newElements[length]null)\n\n * lengthnewElements[length]eObject[]newElements\n\n# addIfAbsent\n\n()\n\nprivate boolean addIfAbsent(E e, Object[] snapshot) {\n    // \n    final ReentrantLock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        Object[] current = getArray();\n        // \n        int len = current.length;\n        if (snapshot != current) { // \n            // Optimize for lost race to another addXXX operation\n            // \n            int common = Math.min(snapshot.length, len);\n            for (int i = 0; i < common; i++) // \n                if (current[i] != snapshot[i] && eq(e, current[i])) // e\n                    // snapshotcurrente\n                    // \n                    return false;\n            if (indexOf(e, current, common, len) >= 0) // e\n                    // \n                    return false;\n        }\n        // \n        Object[] newElements = Arrays.copyOf(current, len + 1);\n        // lene\n        newElements[len] = e;\n        // \n        setArray(newElements);\n        return true;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n:\n\n currentcurrentlensnapshotcurrent\n\n snapshotcurrent(addsetremove)(snapshotcurrent)currentsnapshotcurrentcurrent(set)\n\n \n\n currentnewElementslen+1newElements[len]nullnewElements[len]e\n\n \n\n# set\n\n\n\npublic E set(int index, E element) {\n    // \n    final ReentrantLock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        Object[] elements = getArray();\n        // index\n        E oldValue = get(elements, index);\n\n        if (oldValue != element) { // element\n            // \n            int len = elements.length;\n            // \n            Object[] newElements = Arrays.copyOf(elements, len);\n            // index\n            newElements[index] = element;\n            // \n            setArray(newElements);\n        } else {\n            // Not quite a no-op; ensures volatile write semantics\n            // \n            setArray(elements);\n        }\n        // \n        return oldValue;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n# remove\n\n\n\npublic E remove(int index) {\n    // \n    final ReentrantLock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        Object[] elements = getArray();\n        // \n        int len = elements.length;\n        // \n        E oldValue = get(elements, index);\n        // \n        int numMoved = len - index - 1;\n        if (numMoved == 0) // 0\n            // \n            setArray(Arrays.copyOf(elements, len - 1));\n        else { // 0\n            // \n            Object[] newElements = new Object[len - 1];\n            // index\n            System.arraycopy(elements, 0, newElements, 0, index);\n            // index\n            System.arraycopy(elements, index + 1, newElements, index,\n                                numMoved);\n            // \n            setArray(newElements);\n        }\n        // \n        return oldValue;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n\n\n elementslengthelements[index](length - index - 1),0elementslength-1\n\n indexindex\n\n \n\n\n# CopyOnWriteArrayList\n\nCopyOnWriteArrayList: PutThread50msCopyOnWriteArrayListCopyOnWriteArrayListObjectCopyOnWriteArrayList\n\nimport java.util.Iterator;\nimport java.util.concurrent.CopyOnWriteArrayList;\n\nclass PutThread extends Thread {\n    private CopyOnWriteArrayList<Integer> cowal;\n\n    public PutThread(CopyOnWriteArrayList<Integer> cowal) {\n        this.cowal = cowal;\n    }\n\n    public void run() {\n        try {\n            for (int i = 100; i < 110; i++) {\n                cowal.add(i);\n                Thread.sleep(50);\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\npublic class CopyOnWriteArrayListDemo {\n    public static void main(String[] args) {\n        CopyOnWriteArrayList<Integer> cowal = new CopyOnWriteArrayList<Integer>();\n        for (int i = 0; i < 10; i++) {\n            cowal.add(i);\n        }\n        PutThread p1 = new PutThread(cowal);\n        p1.start();\n        Iterator<Integer> iterator = cowal.iterator();\n        while (iterator.hasNext()) {\n            System.out.print(iterator.next() + " ");\n        }\n        System.out.println();\n        try {\n            Thread.sleep(200);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        \n        iterator = cowal.iterator();\n        while (iterator.hasNext()) {\n            System.out.print(iterator.next() + " ");\n        }\n    }\n}\n\n\n()\n\n0 1 2 3 4 5 6 7 8 9 100 \n0 1 2 3 4 5 6 7 8 9 100 101 102 103 \n\n\n\n# \n\n\n# CopyOnWriteArrayList\n\nCopyOnWriteArrayList \n\n * young gcfull gc\n\n * set,CopyOnWriteArrayList ,\n\nCopyOnWriteArrayList \n\nCopyOnWriteArrayList add/set\n\n\n# CopyOnWriteArrayListVector?\n\nVectoraddremovesynchronized; AsizeB removesizeAremove(Synchronized)vectorCopyOnWriteArrayList \n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5547853.html\n * https://blog.csdn.net/LuoZheng4698729/article/details/102824923\n * https://blog.csdn.net/chuanyingcao2675/article/details/101048889\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html',normalizedContent:'# juc: copyonwritearraylist\n\n> copyonwritearraylistarraylist (addset )cow\n\n * juc: copyonwritearraylist\n   * bat\n   * copyonwritearraylist\n     * \n     * \n     * \n     * \n     * \n       * copyof\n       * add\n       * addifabsent\n       * set\n       * remove\n   * copyonwritearraylist\n   * \n     * copyonwritearraylist\n     * copyonwritearraylistvector?\n   * \n\n\n# bat\n\n\n\n\n\n * fail-fast?\n * arraylist?\n * arraylistcopyonwritearraylist? cow\n * ? cowiterator<e>\n * copyonwritearraylistvector?\n * copyonwritearraylist?\n\n\n# copyonwritearraylist\n\n\n# \n\ncopyonwritearraylistlistlistrandomaccess()cloneableserializable\n\npublic class copyonwritearraylist<e> implements list<e>, randomaccess, cloneable, java.io.serializable {}\n\n\n\n# \n\n * cowiterator\n\ncowiteratorobjectcopyonwritearraylist concurrentmodificationexception(removeset  add) unsupportedoperationexception\n\nstatic final class cowiterator<e> implements listiterator<e> {\n    /** snapshot of the array */\n    // \n    private final object[] snapshot;\n    /** index of element to be returned by subsequent call to next.  */\n    // \n    private int cursor;\n    // \n    private cowiterator(object[] elements, int initialcursor) {\n        cursor = initialcursor;\n        snapshot = elements;\n    }\n    // \n    public boolean hasnext() {\n        return cursor < snapshot.length;\n    }\n    // \n    public boolean hasprevious() {\n        return cursor > 0;\n    }\n    // next\n    @suppresswarnings("unchecked")\n    public e next() {\n        if (! hasnext()) // \n            throw new nosuchelementexception();\n        // \n        return (e) snapshot[cursor++];\n    }\n\n    @suppresswarnings("unchecked")\n    public e previous() {\n        if (! hasprevious())\n            throw new nosuchelementexception();\n        return (e) snapshot[--cursor];\n    }\n    \n    // \n    public int nextindex() {\n        return cursor;\n    }\n    \n    // \n    public int previousindex() {\n        return cursor-1;\n    }\n\n    /**\n        * not supported. always throws unsupportedoperationexception.\n        * @throws unsupportedoperationexception always; {@code remove}\n        *         is not supported by this iterator.\n        */\n    // remove\n    public void remove() {\n        throw new unsupportedoperationexception();\n    }\n\n    /**\n        * not supported. always throws unsupportedoperationexception.\n        * @throws unsupportedoperationexception always; {@code set}\n        *         is not supported by this iterator.\n        */\n    // set\n    public void set(e e) {\n        throw new unsupportedoperationexception();\n    }\n\n    /**\n        * not supported. always throws unsupportedoperationexception.\n        * @throws unsupportedoperationexception always; {@code add}\n        *         is not supported by this iterator.\n        */\n    // add\n    public void add(e e) {\n        throw new unsupportedoperationexception();\n    }\n\n    @override\n    public void foreachremaining(consumer<? super e> action) {\n        objects.requirenonnull(action);\n        object[] elements = snapshot;\n        final int size = elements.length;\n        for (int i = cursor; i < size; i++) {\n            @suppresswarnings("unchecked") e e = (e) elements[i];\n            action.accept(e);\n        }\n        cursor = size;\n    }\n}\n\n\n\n# \n\nobjectcaslock\n\npublic class copyonwritearraylist<e>\n    implements list<e>, randomaccess, cloneable, java.io.serializable {\n    // \n    private static final long serialversionuid = 8673264195747942595l;\n    // \n    final transient reentrantlock lock = new reentrantlock();\n    // \n    private transient volatile object[] array;\n    // \n    private static final sun.misc.unsafe unsafe;\n    // lock\n    private static final long lockoffset;\n    static {\n        try {\n            unsafe = sun.misc.unsafe.getunsafe();\n            class<?> k = copyonwritearraylist.class;\n            lockoffset = unsafe.objectfieldoffset\n                (k.getdeclaredfield("lock"));\n        } catch (exception e) {\n            throw new error(e);\n        }\n    }\n}\n\n\n\n# \n\n * \n\npublic copyonwritearraylist() {\n    // \n    setarray(new object[0]);\n}\n\n\n * copyonwritearraylist(collection<? extends e>)  collection  collection \n\npublic copyonwritearraylist(collection<? extends e> c) {\n    object[] elements;\n    if (c.getclass() == copyonwritearraylist.class) // \n        // c\n        elements = ((copyonwritearraylist<?>)c).getarray();\n    else { // \n        // celements\n        elements = c.toarray();\n        // c.toarray might (incorrectly) not return object[] (see 6260652)\n        if (elements.getclass() != object[].class) // elementsobject[]\n            // elementsobject[]\n            elements = arrays.copyof(elements, elements.length, object[].class);\n    }\n    // \n    setarray(elements);\n}\n\n\n\n\n * ccopyonwritearraylist(object[])copyonwritearraylist(object[])\n\n * elementselementsobject[](toarrayobject)elementsobject\n\n * copyonwritearraylistobject[]elements\n\n * copyonwritearraylist(e[])\n\n\n\npublic copyonwritearraylist(e[] tocopyin) {\n    // tocopyinobject[]\n    setarray(arrays.copyof(tocopyin, tocopyin.length, object[].class));\n}\n\n\n\n# \n\ncopyonwritearraylistarrays.copyofcopyonwritearraylist\n\n# copyof\n\n null ()\n\npublic static <t,u> t[] copyof(u[] original, int newlength, class<? extends t[]> newtype) {\n    @suppresswarnings("unchecked")\n    // copy(newtypeobjectobject[].classobjectobject\n    // ,)\n    t[] copy = ((object)newtype == (object)object[].class)\n        ? (t[]) new object[newlength]\n        : (t[]) array.newinstance(newtype.getcomponenttype(), newlength);\n    // original0(original.lengthnewlength),copy(0)\n    system.arraycopy(original, 0, copy, 0,\n                        math.min(original.length, newlength));\n    return copy;\n}\n\n\n# add\n\npublic boolean add(e e) {\n    // \n    final reentrantlock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        object[] elements = getarray();\n        // \n        int len = elements.length;\n        // \n        object[] newelements = arrays.copyof(elements, len + 1);\n        // e\n        newelements[len] = e;\n        // \n        setarray(newelements);\n        return true;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n\n\n * ()objectobjectlength\n\n * objectlength+1objectnewelements(newelements[length]null)\n\n * lengthnewelements[length]eobject[]newelements\n\n# addifabsent\n\n()\n\nprivate boolean addifabsent(e e, object[] snapshot) {\n    // \n    final reentrantlock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        object[] current = getarray();\n        // \n        int len = current.length;\n        if (snapshot != current) { // \n            // optimize for lost race to another addxxx operation\n            // \n            int common = math.min(snapshot.length, len);\n            for (int i = 0; i < common; i++) // \n                if (current[i] != snapshot[i] && eq(e, current[i])) // e\n                    // snapshotcurrente\n                    // \n                    return false;\n            if (indexof(e, current, common, len) >= 0) // e\n                    // \n                    return false;\n        }\n        // \n        object[] newelements = arrays.copyof(current, len + 1);\n        // lene\n        newelements[len] = e;\n        // \n        setarray(newelements);\n        return true;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n:\n\n currentcurrentlensnapshotcurrent\n\n snapshotcurrent(addsetremove)(snapshotcurrent)currentsnapshotcurrentcurrent(set)\n\n \n\n currentnewelementslen+1newelements[len]nullnewelements[len]e\n\n \n\n# set\n\n\n\npublic e set(int index, e element) {\n    // \n    final reentrantlock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        object[] elements = getarray();\n        // index\n        e oldvalue = get(elements, index);\n\n        if (oldvalue != element) { // element\n            // \n            int len = elements.length;\n            // \n            object[] newelements = arrays.copyof(elements, len);\n            // index\n            newelements[index] = element;\n            // \n            setarray(newelements);\n        } else {\n            // not quite a no-op; ensures volatile write semantics\n            // \n            setarray(elements);\n        }\n        // \n        return oldvalue;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n# remove\n\n\n\npublic e remove(int index) {\n    // \n    final reentrantlock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        object[] elements = getarray();\n        // \n        int len = elements.length;\n        // \n        e oldvalue = get(elements, index);\n        // \n        int nummoved = len - index - 1;\n        if (nummoved == 0) // 0\n            // \n            setarray(arrays.copyof(elements, len - 1));\n        else { // 0\n            // \n            object[] newelements = new object[len - 1];\n            // index\n            system.arraycopy(elements, 0, newelements, 0, index);\n            // index\n            system.arraycopy(elements, index + 1, newelements, index,\n                                nummoved);\n            // \n            setarray(newelements);\n        }\n        // \n        return oldvalue;\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n\n\n elementslengthelements[index](length - index - 1),0elementslength-1\n\n indexindex\n\n \n\n\n# copyonwritearraylist\n\ncopyonwritearraylist: putthread50mscopyonwritearraylistcopyonwritearraylistobjectcopyonwritearraylist\n\nimport java.util.iterator;\nimport java.util.concurrent.copyonwritearraylist;\n\nclass putthread extends thread {\n    private copyonwritearraylist<integer> cowal;\n\n    public putthread(copyonwritearraylist<integer> cowal) {\n        this.cowal = cowal;\n    }\n\n    public void run() {\n        try {\n            for (int i = 100; i < 110; i++) {\n                cowal.add(i);\n                thread.sleep(50);\n            }\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\npublic class copyonwritearraylistdemo {\n    public static void main(string[] args) {\n        copyonwritearraylist<integer> cowal = new copyonwritearraylist<integer>();\n        for (int i = 0; i < 10; i++) {\n            cowal.add(i);\n        }\n        putthread p1 = new putthread(cowal);\n        p1.start();\n        iterator<integer> iterator = cowal.iterator();\n        while (iterator.hasnext()) {\n            system.out.print(iterator.next() + " ");\n        }\n        system.out.println();\n        try {\n            thread.sleep(200);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        \n        iterator = cowal.iterator();\n        while (iterator.hasnext()) {\n            system.out.print(iterator.next() + " ");\n        }\n    }\n}\n\n\n()\n\n0 1 2 3 4 5 6 7 8 9 100 \n0 1 2 3 4 5 6 7 8 9 100 101 102 103 \n\n\n\n# \n\n\n# copyonwritearraylist\n\ncopyonwritearraylist \n\n * young gcfull gc\n\n * set,copyonwritearraylist ,\n\ncopyonwritearraylist \n\ncopyonwritearraylist add/set\n\n\n# copyonwritearraylistvector?\n\nvectoraddremovesynchronized; asizeb removesizearemove(synchronized)vectorcopyonwritearraylist \n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5547853.html\n * https://blog.csdn.net/luozheng4698729/article/details/102824923\n * https://blog.csdn.net/chuanyingcao2675/article/details/101048889\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-collection-copyonwritearraylist.html',charsets:{cjk:!0}},{title:"JUC: FutureTask",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-executor-FutureTask.html",relativePath:"java/thread/java-thread-x-juc-executor-FutureTask.md",key:"v-6690af24",path:"/java/thread/java-thread-x-juc-executor-FutureTask.html",headers:[{level:2,title:"JUC: FutureTask",slug:"juc-futuretask",normalizedTitle:"juc: futuretask",charIndex:2},{level:2,title:"BATFutureTask",slug:"batfuturetask",normalizedTitle:"batfuturetask",charIndex:177},{level:2,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:208},{level:2,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:226},{level:2,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:245},{level:3,title:"Callable",slug:"callable",normalizedTitle:"callable",charIndex:267},{level:3,title:"Future",slug:"future",normalizedTitle:"future",charIndex:285},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:301},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:313},{level:3,title:" - run()",slug:"-run",normalizedTitle:" - run()",charIndex:325},{level:3,title:" - get()",slug:"-get",normalizedTitle:" - get()",charIndex:345},{level:3,title:" - awaitDone(boolean timed, long nanos)",slug:"-awaitdone-boolean-timed-long-nanos",normalizedTitle:" - awaitdone(boolean timed, long nanos)",charIndex:365},{level:3,title:" - cancel(boolean mayInterruptIfRunning)",slug:"-cancel-boolean-mayinterruptifrunning",normalizedTitle:" - cancel(boolean mayinterruptifrunning)",charIndex:416},{level:2,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:466},{level:3,title:"Future",slug:"future",normalizedTitle:"future",charIndex:486},{level:3,title:"FutureTask+Thread",slug:"futuretask-thread",normalizedTitle:"futuretask+thread",charIndex:504},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:529}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: FutureTask BATFutureTask FutureTask FutureTask FutureTask Callable Future    - run()  - get()  - awaitDone(boolean timed, long nanos)  - cancel(boolean mayInterruptIfRunning) FutureTask Future FutureTask+Thread ",content:'# JUC: FutureTask\n\n> Future Future FutureTask\n\n * JUC: FutureTask\n   * BATFutureTask\n   * FutureTask\n   * FutureTask\n   * FutureTask\n     * Callable\n     * Future\n     * \n     * \n     *  - run()\n     *  - get()\n     *  - awaitDone(boolean timed, long nanos)\n     *  - cancel(boolean mayInterruptIfRunning)\n   * FutureTask\n     * Future\n     * FutureTask+Thread\n   * \n\n\n# BATFutureTask\n\n\n\nFutureTask\n\n * FutureTask? ?\n * FutureTask?\n * FutureTask?\n * FutureTask?\n * FutureTask?\n * FutureTask? \n\n\n# FutureTask\n\nFutureTask  Future (get)(cancel)(runAndReset)FutureTask  Callable  Runnable task FutureTask CAS\n\n\n# FutureTask\n\n\n\n,FutureTaskRunnableFutureRunnableFutureRunnableFutureFutureTaskRunnableThreadFutureCallable\n\n\n# FutureTask\n\n\n# Callable\n\nCallableVcall()RunnableRunnable\n\npublic interface Callable<V> {\n    /**\n     * Computes a result, or throws an exception if unable to do so.\n     *\n     * @return computed result\n     * @throws Exception if unable to compute a result\n     */\n    V call() throws Exception;\n}\n\n\n\n# Future\n\nFutureFutureFuture:\n\npublic interface Future<V> {\n    boolean cancel(boolean mayInterruptIfRunning);\n    boolean isCancelled();\n    boolean isDone();\n    V get() throws InterruptedException, ExecutionException;\n    V get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n\n\n * cancel():cancel()falsetruemayInterruptIfRunningtruetruemayInterruptIfRunningfalsetrue\n * isCanceled():()truefalse\n * isDone():truefalsetrue\n * get():CancellationExceptionExecutionExceptionInterruptedException\n * get(long timeout,Timeunit unit):get()TimeoutException\n\n\n# \n\n\n//callable\nprivate Callable<V> callable;\n\n//get()\nprivate Object outcome; // non-volatile, protected by state reads/writes\n\n//callable\nprivate volatile Thread runner;\n\n//Treiber\nprivate volatile WaitNode waiters;\n\n//\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n\n\nstatevolatile7\n\n * NEW:\n * COMPLETING:outcome(outcome)NEWCOMPLETING\n * NORMAL:outcomeCOMPLETINGNORMAL\n * EXCEPTIONAL:outcomeCOMPLETINGEXCEPTIONAL\n * CANCELLED:cancel(false)NEWCANCELLED\n * INTERRUPTING: cancel(true)NEWINTERRUPTING\n * INTERRUPTED:interrupt()INTERRUPTINGINTERRUPTED COMPLETING()\n\n:\n\n\n\n\n# \n\n * FutureTask(Callable<V> callable)\n\npublic FutureTask(Callable<V> callable) {\n    if (callable == null)\n        throw new NullPointerException();\n    this.callable = callable;\n    this.state = NEW;       // ensure visibility of callable\n}\n\n\nCallablethis.callableprivate Callable<V> callable;null,stateNEW\n\n * FutureTask(Runnable runnable, V result)\n\npublic FutureTask(Runnable runnable, V result) {\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       // ensure visibility of callable\n}\n\n\nRunnableCallablecallableresultnull\n\nExecutors.callable()RunnableCallable:\n\npublic static <T> Callable<T> callable(Runnable task, T result) {\n    if (task == null)\n       throw new NullPointerException();\n    return new RunnableAdapter<T>(task, result);\n}\n\n\nRunnableAdapter<T>(task, result):\n\nstatic final class RunnableAdapter<T> implements Callable<T> {\n    final Runnable task;\n    final T result;\n    RunnableAdapter(Runnable task, T result) {\n        this.task = task;\n        this.result = result;\n    }\n    public T call() {\n        task.run();\n        return result;\n    }\n}\n\n\nCallablecall()Runnable.run()result\n\nnewFutureTaskTask,newThreadrun()run()\n\n\n#  - run()\n\npublic void run() {\n    //CASrunner\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                     null, Thread.currentThread()))\n        return;\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);//\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);//\n    }\n}\n\n\n\n\n * NEWCASset(result)set(result)\n\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();//\n    }\n}\n\n\n * casstateCOMPLETING lazySet(UNSAFE.putOrderedInt)stateNORMALfinishCompletion()\n\nprivate void finishCompletion() {\n    // assert state > COMPLETING;\n    for (WaitNode q; (q = waiters) != null;) {\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {//\n            for (;;) {//\n                Thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);//\n                }\n                WaitNode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    //\n    done();\n\n    callable = null;        // to reduce footprint\n}\n\n\n * run run handlePossibleCancellationInterrupt(cancel(true))runrunAndReset\n\nprivate void handlePossibleCancellationInterrupt(int s) {\n    //CPU\n    if (s == INTERRUPTING)\n        while (state == INTERRUPTING)\n            Thread.yield(); // wait out pending interrupt\n}\n\n\n\n#  - get()\n\n//\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n\n\nFutureTask get()(state <= COMPLETING)awaitDone()reportreport\n\n//\nprivate V report(int s) throws ExecutionException {\n    Object x = outcome;\n    if (s == NORMAL)\n        return (V)x;\n    if (s >= CANCELLED)\n        throw new CancellationException();\n    throw new ExecutionException((Throwable)x);\n}\n\n\n\n#  - awaitDone(boolean timed, long nanos)\n\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {//\n        if (Thread.interrupted()) {//\n            removeWaiter(q);//WaitNode\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {\n            if (q != null)\n                q.thread = null;//\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet\n            Thread.yield();\n        else if (q == null)\n            q = new WaitNode();\n        else if (!queued)\n            //CASwaiter\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,\n                                                 q.next = waiters, q);\n        else if (timed) {\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);//\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);//\n        }\n        else\n            LockSupport.park(this);//\n    }\n}\n\n\nawaitDone\n\nremoveWaiterInterruptedExceptionremoveWaiter\n\nprivate void removeWaiter(WaitNode node) {\n    if (node != null) {\n        node.thread = null;//\n        retry:\n        for (;;) {          // restart on removeWaiter race\n            //\n            for (WaitNode pred = null, q = waiters, s; q != null; q = s) {\n                s = q.next;\n                if (q.thread != null)\n                    pred = q;\n                else if (pred != null) {\n                    pred.next = s;\n                    if (pred.thread == null) // check for race\n                        continue retry;\n                }\n                else if (!UNSAFE.compareAndSwapObject(this, waitersOffset,q, s)) //cas\n                    continue retry;\n            }\n            break;\n        }\n    }\n}\n\n\n * (state>COMPLETING), Future \n * (COMPLETING) Future CPU\n * stateNEWWaitNodeCASwaiters\n * removeWaiterpark\n * \n\n\n#  - cancel(boolean mayInterruptIfRunning)\n\npublic boolean cancel(boolean mayInterruptIfRunning) {\n    //FutureNEWFutureINTERRUPTINGCANCELLED\n    if (!(state == NEW &&\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {    // in case call to interrupt throws exception\n        if (mayInterruptIfRunning) {//\n            try {\n                Thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        finishCompletion();//\n    }\n    return true;\n}\n\n\n\n\n * FutureNEWFutureINTERRUPTINGCANCELLED\n * NEWmayInterruptIfRunningfinishCompletion\n\n\n# FutureTask\n\n\n\n * : Future + ExecutorService\n * : FutureTask + ExecutorService\n * : FutureTask + Thread\n\n\n# Future\n\npublic class FutureDemo {\n      public static void main(String[] args) {\n          ExecutorService executorService = Executors.newCachedThreadPool();\n          Future future = executorService.submit(new Callable<Object>() {\n              @Override\n              public Object call() throws Exception {\n                  Long start = System.currentTimeMillis();\n                  while (true) {\n                      Long current = System.currentTimeMillis();\n                     if ((current - start) > 1000) {\n                         return 1;\n                     }\n                 }\n             }\n         });\n  \n         try {\n             Integer result = (Integer)future.get();\n             System.out.println(result);\n         }catch (Exception e){\n             e.printStackTrace();\n         }\n     }\n}\n\n\n\n# FutureTask+Thread\n\nimport java.util.concurrent.*;\n \npublic class CallDemo {\n \n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n \n        /**\n         * :Future + ExecutorService\n         * Task task = new Task();\n         * ExecutorService service = Executors.newCachedThreadPool();\n         * Future<Integer> future = service.submit(task1);\n         * service.shutdown();\n         */\n \n \n        /**\n         * : FutureTask + ExecutorService\n         * ExecutorService executor = Executors.newCachedThreadPool();\n         * Task task = new Task();\n         * FutureTask<Integer> futureTask = new FutureTask<Integer>(task);\n         * executor.submit(futureTask);\n         * executor.shutdown();\n         */\n \n        /**\n         * :FutureTask + Thread\n         */\n \n        // 2. FutureTask,Callable\n        FutureTask<Integer> futureTask = new FutureTask<Integer>(new Task());\n        // 3. Thread\n        Thread thread = new Thread(futureTask);\n        thread.setName("Task thread");\n        thread.start();\n \n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n \n        System.out.println("Thread [" + Thread.currentThread().getName() + "] is running");\n \n        // 4. isDone()\n        if(!futureTask.isDone()) {\n            System.out.println("Task is not done");\n            try {\n                Thread.sleep(2000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        int result = 0;\n        try {\n            // 5. get(),\n            result = futureTask.get();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n \n        System.out.println("result is " + result);\n \n    }\n \n    // 1. Callable,call(),\n    static class Task  implements Callable<Integer> {\n \n        @Override\n        public Integer call() throws Exception {\n            System.out.println("Thread [" + Thread.currentThread().getName() + "] is running");\n            int result = 0;\n            for(int i = 0; i < 100;++i) {\n                result += i;\n            }\n \n            Thread.sleep(3000);\n            return result;\n        }\n    }\n}\n\n\n\n# \n\n * https://www.cnblogs.com/linghu-java/p/8991824.htmlhttps://www.jianshu.com/p/d61d7ffa6abc\n * https://blog.csdn.net/xingzhong128/article/details/80553789\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-FutureTask.html',normalizedContent:'# juc: futuretask\n\n> future future futuretask\n\n * juc: futuretask\n   * batfuturetask\n   * futuretask\n   * futuretask\n   * futuretask\n     * callable\n     * future\n     * \n     * \n     *  - run()\n     *  - get()\n     *  - awaitdone(boolean timed, long nanos)\n     *  - cancel(boolean mayinterruptifrunning)\n   * futuretask\n     * future\n     * futuretask+thread\n   * \n\n\n# batfuturetask\n\n\n\nfuturetask\n\n * futuretask? ?\n * futuretask?\n * futuretask?\n * futuretask?\n * futuretask?\n * futuretask? \n\n\n# futuretask\n\nfuturetask  future (get)(cancel)(runandreset)futuretask  callable  runnable task futuretask cas\n\n\n# futuretask\n\n\n\n,futuretaskrunnablefuturerunnablefuturerunnablefuturefuturetaskrunnablethreadfuturecallable\n\n\n# futuretask\n\n\n# callable\n\ncallablevcall()runnablerunnable\n\npublic interface callable<v> {\n    /**\n     * computes a result, or throws an exception if unable to do so.\n     *\n     * @return computed result\n     * @throws exception if unable to compute a result\n     */\n    v call() throws exception;\n}\n\n\n\n# future\n\nfuturefuturefuture:\n\npublic interface future<v> {\n    boolean cancel(boolean mayinterruptifrunning);\n    boolean iscancelled();\n    boolean isdone();\n    v get() throws interruptedexception, executionexception;\n    v get(long timeout, timeunit unit)\n        throws interruptedexception, executionexception, timeoutexception;\n}\n\n\n * cancel():cancel()falsetruemayinterruptifrunningtruetruemayinterruptifrunningfalsetrue\n * iscanceled():()truefalse\n * isdone():truefalsetrue\n * get():cancellationexceptionexecutionexceptioninterruptedexception\n * get(long timeout,timeunit unit):get()timeoutexception\n\n\n# \n\n\n//callable\nprivate callable<v> callable;\n\n//get()\nprivate object outcome; // non-volatile, protected by state reads/writes\n\n//callable\nprivate volatile thread runner;\n\n//treiber\nprivate volatile waitnode waiters;\n\n//\nprivate volatile int state;\nprivate static final int new          = 0;\nprivate static final int completing   = 1;\nprivate static final int normal       = 2;\nprivate static final int exceptional  = 3;\nprivate static final int cancelled    = 4;\nprivate static final int interrupting = 5;\nprivate static final int interrupted  = 6;\n\n\nstatevolatile7\n\n * new:\n * completing:outcome(outcome)newcompleting\n * normal:outcomecompletingnormal\n * exceptional:outcomecompletingexceptional\n * cancelled:cancel(false)newcancelled\n * interrupting: cancel(true)newinterrupting\n * interrupted:interrupt()interruptinginterrupted completing()\n\n:\n\n\n\n\n# \n\n * futuretask(callable<v> callable)\n\npublic futuretask(callable<v> callable) {\n    if (callable == null)\n        throw new nullpointerexception();\n    this.callable = callable;\n    this.state = new;       // ensure visibility of callable\n}\n\n\ncallablethis.callableprivate callable<v> callable;null,statenew\n\n * futuretask(runnable runnable, v result)\n\npublic futuretask(runnable runnable, v result) {\n    this.callable = executors.callable(runnable, result);\n    this.state = new;       // ensure visibility of callable\n}\n\n\nrunnablecallablecallableresultnull\n\nexecutors.callable()runnablecallable:\n\npublic static <t> callable<t> callable(runnable task, t result) {\n    if (task == null)\n       throw new nullpointerexception();\n    return new runnableadapter<t>(task, result);\n}\n\n\nrunnableadapter<t>(task, result):\n\nstatic final class runnableadapter<t> implements callable<t> {\n    final runnable task;\n    final t result;\n    runnableadapter(runnable task, t result) {\n        this.task = task;\n        this.result = result;\n    }\n    public t call() {\n        task.run();\n        return result;\n    }\n}\n\n\ncallablecall()runnable.run()result\n\nnewfuturetasktask,newthreadrun()run()\n\n\n#  - run()\n\npublic void run() {\n    //casrunner\n    if (state != new ||\n        !unsafe.compareandswapobject(this, runneroffset,\n                                     null, thread.currentthread()))\n        return;\n    try {\n        callable<v> c = callable;\n        if (c != null && state == new) {\n            v result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (throwable ex) {\n                result = null;\n                ran = false;\n                setexception(ex);\n            }\n            if (ran)\n                set(result);//\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        int s = state;\n        if (s >= interrupting)\n            handlepossiblecancellationinterrupt(s);//\n    }\n}\n\n\n\n\n * newcasset(result)set(result)\n\nprotected void set(v v) {\n    if (unsafe.compareandswapint(this, stateoffset, new, completing)) {\n        outcome = v;\n        unsafe.putorderedint(this, stateoffset, normal); // final state\n        finishcompletion();//\n    }\n}\n\n\n * casstatecompleting lazyset(unsafe.putorderedint)statenormalfinishcompletion()\n\nprivate void finishcompletion() {\n    // assert state > completing;\n    for (waitnode q; (q = waiters) != null;) {\n        if (unsafe.compareandswapobject(this, waitersoffset, q, null)) {//\n            for (;;) {//\n                thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    locksupport.unpark(t);//\n                }\n                waitnode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    //\n    done();\n\n    callable = null;        // to reduce footprint\n}\n\n\n * run run handlepossiblecancellationinterrupt(cancel(true))runrunandreset\n\nprivate void handlepossiblecancellationinterrupt(int s) {\n    //cpu\n    if (s == interrupting)\n        while (state == interrupting)\n            thread.yield(); // wait out pending interrupt\n}\n\n\n\n#  - get()\n\n//\npublic v get() throws interruptedexception, executionexception {\n    int s = state;\n    if (s <= completing)\n        s = awaitdone(false, 0l);\n    return report(s);\n}\n\n\nfuturetask get()(state <= completing)awaitdone()reportreport\n\n//\nprivate v report(int s) throws executionexception {\n    object x = outcome;\n    if (s == normal)\n        return (v)x;\n    if (s >= cancelled)\n        throw new cancellationexception();\n    throw new executionexception((throwable)x);\n}\n\n\n\n#  - awaitdone(boolean timed, long nanos)\n\nprivate int awaitdone(boolean timed, long nanos)\n    throws interruptedexception {\n    final long deadline = timed ? system.nanotime() + nanos : 0l;\n    waitnode q = null;\n    boolean queued = false;\n    for (;;) {//\n        if (thread.interrupted()) {//\n            removewaiter(q);//waitnode\n            throw new interruptedexception();\n        }\n\n        int s = state;\n        if (s > completing) {\n            if (q != null)\n                q.thread = null;//\n            return s;\n        }\n        else if (s == completing) // cannot time out yet\n            thread.yield();\n        else if (q == null)\n            q = new waitnode();\n        else if (!queued)\n            //caswaiter\n            queued = unsafe.compareandswapobject(this, waitersoffset,\n                                                 q.next = waiters, q);\n        else if (timed) {\n            nanos = deadline - system.nanotime();\n            if (nanos <= 0l) {\n                removewaiter(q);//\n                return state;\n            }\n            locksupport.parknanos(this, nanos);//\n        }\n        else\n            locksupport.park(this);//\n    }\n}\n\n\nawaitdone\n\nremovewaiterinterruptedexceptionremovewaiter\n\nprivate void removewaiter(waitnode node) {\n    if (node != null) {\n        node.thread = null;//\n        retry:\n        for (;;) {          // restart on removewaiter race\n            //\n            for (waitnode pred = null, q = waiters, s; q != null; q = s) {\n                s = q.next;\n                if (q.thread != null)\n                    pred = q;\n                else if (pred != null) {\n                    pred.next = s;\n                    if (pred.thread == null) // check for race\n                        continue retry;\n                }\n                else if (!unsafe.compareandswapobject(this, waitersoffset,q, s)) //cas\n                    continue retry;\n            }\n            break;\n        }\n    }\n}\n\n\n * (state>completing), future \n * (completing) future cpu\n * statenewwaitnodecaswaiters\n * removewaiterpark\n * \n\n\n#  - cancel(boolean mayinterruptifrunning)\n\npublic boolean cancel(boolean mayinterruptifrunning) {\n    //futurenewfutureinterruptingcancelled\n    if (!(state == new &&\n          unsafe.compareandswapint(this, stateoffset, new,\n              mayinterruptifrunning ? interrupting : cancelled)))\n        return false;\n    try {    // in case call to interrupt throws exception\n        if (mayinterruptifrunning) {//\n            try {\n                thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                unsafe.putorderedint(this, stateoffset, interrupted);\n            }\n        }\n    } finally {\n        finishcompletion();//\n    }\n    return true;\n}\n\n\n\n\n * futurenewfutureinterruptingcancelled\n * newmayinterruptifrunningfinishcompletion\n\n\n# futuretask\n\n\n\n * : future + executorservice\n * : futuretask + executorservice\n * : futuretask + thread\n\n\n# future\n\npublic class futuredemo {\n      public static void main(string[] args) {\n          executorservice executorservice = executors.newcachedthreadpool();\n          future future = executorservice.submit(new callable<object>() {\n              @override\n              public object call() throws exception {\n                  long start = system.currenttimemillis();\n                  while (true) {\n                      long current = system.currenttimemillis();\n                     if ((current - start) > 1000) {\n                         return 1;\n                     }\n                 }\n             }\n         });\n  \n         try {\n             integer result = (integer)future.get();\n             system.out.println(result);\n         }catch (exception e){\n             e.printstacktrace();\n         }\n     }\n}\n\n\n\n# futuretask+thread\n\nimport java.util.concurrent.*;\n \npublic class calldemo {\n \n    public static void main(string[] args) throws executionexception, interruptedexception {\n \n        /**\n         * :future + executorservice\n         * task task = new task();\n         * executorservice service = executors.newcachedthreadpool();\n         * future<integer> future = service.submit(task1);\n         * service.shutdown();\n         */\n \n \n        /**\n         * : futuretask + executorservice\n         * executorservice executor = executors.newcachedthreadpool();\n         * task task = new task();\n         * futuretask<integer> futuretask = new futuretask<integer>(task);\n         * executor.submit(futuretask);\n         * executor.shutdown();\n         */\n \n        /**\n         * :futuretask + thread\n         */\n \n        // 2. futuretask,callable\n        futuretask<integer> futuretask = new futuretask<integer>(new task());\n        // 3. thread\n        thread thread = new thread(futuretask);\n        thread.setname("task thread");\n        thread.start();\n \n        try {\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n \n        system.out.println("thread [" + thread.currentthread().getname() + "] is running");\n \n        // 4. isdone()\n        if(!futuretask.isdone()) {\n            system.out.println("task is not done");\n            try {\n                thread.sleep(2000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        }\n        int result = 0;\n        try {\n            // 5. get(),\n            result = futuretask.get();\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n \n        system.out.println("result is " + result);\n \n    }\n \n    // 1. callable,call(),\n    static class task  implements callable<integer> {\n \n        @override\n        public integer call() throws exception {\n            system.out.println("thread [" + thread.currentthread().getname() + "] is running");\n            int result = 0;\n            for(int i = 0; i < 100;++i) {\n                result += i;\n            }\n \n            thread.sleep(3000);\n            return result;\n        }\n    }\n}\n\n\n\n# \n\n * https://www.cnblogs.com/linghu-java/p/8991824.htmlhttps://www.jianshu.com/p/d61d7ffa6abc\n * https://blog.csdn.net/xingzhong128/article/details/80553789\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-futuretask.html',charsets:{cjk:!0}},{title:"JUC: ScheduledThreadPoolExecutor",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html",relativePath:"java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.md",key:"v-039b744e",path:"/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html",headers:[{level:2,title:"JUC: ScheduledThreadPoolExecutor",slug:"juc-scheduledthreadpoolexecutor",normalizedTitle:"juc: scheduledthreadpoolexecutor",charIndex:2},{level:2,title:"BATScheduledThreadPoolExecutor",slug:"batscheduledthreadpoolexecutor",normalizedTitle:"batscheduledthreadpoolexecutor",charIndex:328},{level:2,title:"ScheduledThreadPoolExecutor",slug:"scheduledthreadpoolexecutor",normalizedTitle:"scheduledthreadpoolexecutor",charIndex:376},{level:2,title:"ScheduledThreadPoolExecutor",slug:"scheduledthreadpoolexecutor",normalizedTitle:"scheduledthreadpoolexecutor",charIndex:411},{level:2,title:"ScheduledThreadPoolExecutor",slug:"scheduledthreadpoolexecutor",normalizedTitle:"scheduledthreadpoolexecutor",charIndex:448},{level:3,title:"ScheduledFutureTask",slug:"scheduledfuturetask",normalizedTitle:"scheduledfuturetask",charIndex:487},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:566},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:578},{level:3,title:":Schedule",slug:"-schedule",normalizedTitle:":schedule",charIndex:590},{level:3,title:":scheduleAtFixedRate  scheduleWithFixedDelay",slug:"-scheduleatfixedrate--schedulewithfixeddelay",normalizedTitle:":scheduleatfixedrate  schedulewithfixeddelay",charIndex:611},{level:3,title:":shutdown()",slug:"-shutdown",normalizedTitle:":shutdown()",charIndex:668},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:689},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:700}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ScheduledThreadPoolExecutor BATScheduledThreadPoolExecutor ScheduledThreadPoolExecutor ScheduledThreadPoolExecutor ScheduledThreadPoolExecutor ScheduledFutureTask   :Schedule :scheduleAtFixedRate  scheduleWithFixedDelay :shutdown()  ",content:"# JUC: ScheduledThreadPoolExecutor\n\n> Java 1.3 Timer ( ScheduledThreadPoolExecutor ) ScheduledThreadPoolExecutor \n\n * JUC: ScheduledThreadPoolExecutor\n   * BATScheduledThreadPoolExecutor\n   * ScheduledThreadPoolExecutor\n   * ScheduledThreadPoolExecutor\n   * ScheduledThreadPoolExecutor\n     * ScheduledFutureTask\n       * \n       * run()\n       * cancel\n     * \n     * \n     * :Schedule\n     * :scheduleAtFixedRate  scheduleWithFixedDelay\n     * :shutdown()\n   * \n   * \n\n\n# BATScheduledThreadPoolExecutor\n\n\n\nScheduledThreadPoolExecutor\n\n * ScheduledThreadPoolExecutor?\n * ScheduledThreadPoolExecutorThreadPoolExecutor?\n * ScheduledThreadPoolExecutor?\n * ScheduledThreadPoolExecutor? ?\n * ScheduledThreadPoolExecutorscheduleAtFixedRate  scheduleWithFixedDelay?\n * ThreadPoolExecutor  ScheduledThreadPoolExecutor?\n * Executors  ScheduledThreadPoolExecutor?\n\n\n# ScheduledThreadPoolExecutor\n\nScheduledThreadPoolExecutor ThreadPoolExecutor ThreadPoolExecutor :\n\n * ScheduledFutureTask ( ExecutorService )\n * DelayedWorkQueue DelayedWorkQueue DelayQueue ThreadPoolExecutor(delayedExecute)\n * run-after-shutdown(shutdown)() shutdown \n\n\n# ScheduledThreadPoolExecutor\n\n\n\nScheduledThreadPoolExecutor ThreadPoolExecutor:\n\n * : JUC: ThreadPoolExecutor\n\nScheduledThreadPoolExecutor  ScheduledFutureTask  DelayedWorkQueue:\n\n * ScheduledFutureTask: FutureTaskRunnableFutureDelayed\n\n * DelayedWorkQueue:  ScheduledThreadPoolExecutor  AbstractQueue ThreadPoolExecutor  BlockingQueue  RunnableScheduledFuture  DelayQueue  RunnableScheduledFuture (DelayQueue  PriorityQueue )\n\n\n# ScheduledThreadPoolExecutor\n\n> FutureTask\n\n\n# ScheduledFutureTask\n\n# \n\n//\nprivate final long sequenceNumber;\n\n//\nprivate long time;\n\n//\nprivate final long period;\n\n//\nRunnableScheduledFuture<V> outerTask = this;\n\n//\nint heapIndex;\n\n\n * sequenceNumber:  FIFO sequenceNumber \n * time: triggerTime\n * period: (scheduleAtFixedRate)(scheduleWithFixedDelay)0\n * outerTask: reExecutePeriodic\n\n# run()\n\npublic void run() {\n    boolean periodic = isPeriodic();//\n    if (!canRunInCurrentRunState(periodic))//\n        cancel(false);\n    else if (!periodic)\n        //\n        ScheduledFutureTask.super.run();\n    else if (ScheduledFutureTask.super.runAndReset()) {\n        setNextRunTime();//\n        reExecutePeriodic(outerTask);//\n    }\n}\n\n\n: ScheduledFutureTask run FutureTask / FutureTask run:\n\n * setNextRunTime(): :\n\n//\nprivate void setNextRunTime() {\n    long p = period;\n    if (p > 0)  //scheduleAtFixedRate\n        time += p;\n    else\n        time = triggerTime(-p);  //scheduleWithFixedDelay\n}\n//\nlong triggerTime(long delay) {\n    return now() +\n        ((delay < (Long.MAX_VALUE >> 1)) ? delay : overflowFree(delay));\n}\n\n\n * reExecutePeriodic(): :\n\n//\nvoid reExecutePeriodic(RunnableScheduledFuture<?> task) {\n    if (canRunInCurrentRunState(true)) {//\n        super.getQueue().add(task);//\n        //run-after-shutdown\n        if (!canRunInCurrentRunState(true) && remove(task))\n            task.cancel(false);\n        else\n            ensurePrestart();//\n    }\n}\n\n\nreExecutePeriodicdelayedExecutereExecutePeriodic\n\n# cancel\n\npublic boolean cancel(boolean mayInterruptIfRunning) {\n    boolean cancelled = super.cancel(mayInterruptIfRunning);\n    if (cancelled && removeOnCancel && heapIndex >= 0)\n        remove(this);\n    return cancelled;\n}\n\n\nScheduledFutureTask.cancel FutureTask.cancel removeOnCancel\n\n\n# \n\n// \nprivate volatile boolean continueExistingPeriodicTasksAfterShutdown;\n\n// \nprivate volatile boolean executeExistingDelayedTasksAfterShutdown = true;\n\n// \nprivate volatile boolean removeOnCancel = false;\n\n//FIFO\nprivate static final AtomicLong sequencer = new AtomicLong();\n\n\n\n * continueExistingPeriodicTasksAfterShutdownexecuteExistingDelayedTasksAfterShutdown ScheduledThreadPoolExecutor  run-after-shutdown \n\n * removeOnCancel setRemoveOnCancelPolicyremoveOnCanceltrue\n\n * sequencer FIFO  ScheduledFutureTask sequenceNumber\n\n\n# \n\nScheduledThreadPoolExecutor :\n\npublic ScheduledThreadPoolExecutor(int corePoolSize,\n                                   ThreadFactory threadFactory,\n                                   RejectedExecutionHandler handler) {\n    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n          new DelayedWorkQueue(), threadFactory, handler);\n}\n\n\nsuperThreadPoolExecutorDelayedWorkQueue\n\n\n# :Schedule\n\npublic <V> ScheduledFuture<V> schedule(Callable<V> callable,\n                                       long delay,\n                                       TimeUnit unit) {\n    if (callable == null || unit == null)\n        throw new NullPointerException();\n    RunnableScheduledFuture<V> t = decorateTask(callable,\n        new ScheduledFutureTask<V>(callable, triggerTime(delay, unit)));//ScheduledFutureTask\n    delayedExecute(t);//\n    return t;\n}\n\n\n: schedule():\n\n *  Callable/Runnable: triggerTime ScheduledFutureTask  Runnable/Callable ScheduledThreadPoolExecutordecorateTaskdecorateTaskRunnableScheduledFuture:\n\nprotected <V> RunnableScheduledFuture<V> decorateTask(\n    Runnable runnable, RunnableScheduledFuture<V> task) {\n    return task;\n}\n\n\n * : delayedExecute\n\nprivate void delayedExecute(RunnableScheduledFuture<?> task) {\n    if (isShutdown())\n        reject(task);//\n    else {\n        super.getQueue().add(task);//\n        if (isShutdown() &&\n            !canRunInCurrentRunState(task.isPeriodic()) &&//run-after-shutdown\n            remove(task))//\n            task.cancel(false);\n        else\n            ensurePrestart();//\n    }\n}\n\n\n: delayedExecute:\n\n * (ctl >= SHUTDOWN)\n * :\n\nA:  run-after-shutdown trueensurePrestartensurePrestart:\n\nvoid ensurePrestart() {\n    int wc = workerCountOf(ctl.get());\n    if (wc < corePoolSize)\n        addWorker(null, true);\n    else if (wc == 0)\n        addWorker(null, false);\n}\n\n\nensurePrestart ThreadPoolExecutor corePoolSize0\n\nB:  run-after-shutdown false(ThreadPoolExecutor)removeScheduledFutureTask.cancel\n\n\n# :scheduleAtFixedRate  scheduleWithFixedDelay\n\n/**\n * initialDelay\n * period\n */\npublic ScheduledFuture<?> scheduleAtFixedRate(Runnable command,\n                                              long initialDelay,\n                                              long period,\n                                              TimeUnit unit) {\n    if (command == null || unit == null)\n        throw new NullPointerException();\n    if (period <= 0)\n        throw new IllegalArgumentException();\n    //RunnableScheduledFuture\n    ScheduledFutureTask<Void> sft =\n        new ScheduledFutureTask<Void>(command,\n                                      null,\n                                      triggerTime(initialDelay, unit),//\n                                      unit.toNanos(period));//\n    RunnableScheduledFuture<Void> t = decorateTask(command, sft);//\n    sft.outerTask = t;//outerTask\n    delayedExecute(t);//\n    return t;\n}\n\n/**\n * initialDelay\n * delay\n */\npublic ScheduledFuture<?> scheduleWithFixedDelay(Runnable command,\n                                                 long initialDelay,\n                                                 long delay,\n                                                 TimeUnit unit) {\n    if (command == null || unit == null)\n        throw new NullPointerException();\n    if (delay <= 0)\n        throw new IllegalArgumentException();\n    //RunnableScheduledFuture\n    ScheduledFutureTask<Void> sft =\n        new ScheduledFutureTask<Void>(command,\n                                      null,\n                                      triggerTime(initialDelay, unit),//\n                                      unit.toNanos(-delay));//\n    RunnableScheduledFuture<Void> t = decorateTask(command, sft);//\n    sft.outerTask = t;//outerTask\n    delayedExecute(t);//\n    return t;\n}\n\n\n: scheduleAtFixedRatescheduleWithFixedDelayschedule\n\nscheduleAtFixedRatescheduleWithFixedDelay: unit.toNanosscheduleAtFixedRatescheduleWithFixedDelay ScheduledFutureTask period\n\n\n# :shutdown()\n\npublic void shutdown() {\n    super.shutdown();\n}\n//\n@Override void onShutdown() {\n    BlockingQueue<Runnable> q = super.getQueue();\n    //run-after-shutdown\n    boolean keepDelayed =\n        getExecuteExistingDelayedTasksAfterShutdownPolicy();\n    boolean keepPeriodic =\n        getContinueExistingPeriodicTasksAfterShutdownPolicy();\n    if (!keepDelayed && !keepPeriodic) {//\n        //\n        for (Object e : q.toArray())\n            if (e instanceof RunnableScheduledFuture<?>)\n                ((RunnableScheduledFuture<?>) e).cancel(false);\n        q.clear();//\n    }\n    else {//\n        // Traverse snapshot to avoid iterator exceptions\n        //\n        for (Object e : q.toArray()) {\n            if (e instanceof RunnableScheduledFuture) {\n                RunnableScheduledFuture<?> t =\n                    (RunnableScheduledFuture<?>)e;\n                if ((t.isPeriodic() ? !keepPeriodic : !keepDelayed) ||\n                    t.isCancelled()) { // also remove if already cancelled\n                    //\n                    if (q.remove(t))\n                        t.cancel(false);\n                }\n            }\n        }\n    }\n    tryTerminate(); //\n}\n\n\n: ThreadPoolExecutorshutdown ThreadPoolExecutor shutdownonShutdown run-after-shutdown (continueExistingPeriodicTasksAfterShutdownexecuteExistingDelayedTasksAfterShutdown)\n\n\n# \n\n * ThreadPoolExecutor  ScheduledThreadPoolExecutor\n\n:  ScheduledThreadPoolExecutor maximumPoolSize( ScheduledThreadPoolExecutor Integer.MAX_VALUE)corePoolSize0(allowCoreThreadTimeOut)\n\n * Executors  ScheduledThreadPoolExecutor\n   * newScheduledThreadPool: \n   * newSingleThreadScheduledExecutor: \n\n: newScheduledThreadPool(1, threadFactory) newSingleThreadScheduledExecutornewSingleThreadScheduledExecutornewScheduledThreadPool(1, threadFactory)setCorePoolSize\n\n\n# \n\n * bagwellhttps://www.jianshu.com/p/8c97953f2751\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html",normalizedContent:"# juc: scheduledthreadpoolexecutor\n\n> java 1.3 timer ( scheduledthreadpoolexecutor ) scheduledthreadpoolexecutor \n\n * juc: scheduledthreadpoolexecutor\n   * batscheduledthreadpoolexecutor\n   * scheduledthreadpoolexecutor\n   * scheduledthreadpoolexecutor\n   * scheduledthreadpoolexecutor\n     * scheduledfuturetask\n       * \n       * run()\n       * cancel\n     * \n     * \n     * :schedule\n     * :scheduleatfixedrate  schedulewithfixeddelay\n     * :shutdown()\n   * \n   * \n\n\n# batscheduledthreadpoolexecutor\n\n\n\nscheduledthreadpoolexecutor\n\n * scheduledthreadpoolexecutor?\n * scheduledthreadpoolexecutorthreadpoolexecutor?\n * scheduledthreadpoolexecutor?\n * scheduledthreadpoolexecutor? ?\n * scheduledthreadpoolexecutorscheduleatfixedrate  schedulewithfixeddelay?\n * threadpoolexecutor  scheduledthreadpoolexecutor?\n * executors  scheduledthreadpoolexecutor?\n\n\n# scheduledthreadpoolexecutor\n\nscheduledthreadpoolexecutor threadpoolexecutor threadpoolexecutor :\n\n * scheduledfuturetask ( executorservice )\n * delayedworkqueue delayedworkqueue delayqueue threadpoolexecutor(delayedexecute)\n * run-after-shutdown(shutdown)() shutdown \n\n\n# scheduledthreadpoolexecutor\n\n\n\nscheduledthreadpoolexecutor threadpoolexecutor:\n\n * : juc: threadpoolexecutor\n\nscheduledthreadpoolexecutor  scheduledfuturetask  delayedworkqueue:\n\n * scheduledfuturetask: futuretaskrunnablefuturedelayed\n\n * delayedworkqueue:  scheduledthreadpoolexecutor  abstractqueue threadpoolexecutor  blockingqueue  runnablescheduledfuture  delayqueue  runnablescheduledfuture (delayqueue  priorityqueue )\n\n\n# scheduledthreadpoolexecutor\n\n> futuretask\n\n\n# scheduledfuturetask\n\n# \n\n//\nprivate final long sequencenumber;\n\n//\nprivate long time;\n\n//\nprivate final long period;\n\n//\nrunnablescheduledfuture<v> outertask = this;\n\n//\nint heapindex;\n\n\n * sequencenumber:  fifo sequencenumber \n * time: triggertime\n * period: (scheduleatfixedrate)(schedulewithfixeddelay)0\n * outertask: reexecuteperiodic\n\n# run()\n\npublic void run() {\n    boolean periodic = isperiodic();//\n    if (!canrunincurrentrunstate(periodic))//\n        cancel(false);\n    else if (!periodic)\n        //\n        scheduledfuturetask.super.run();\n    else if (scheduledfuturetask.super.runandreset()) {\n        setnextruntime();//\n        reexecuteperiodic(outertask);//\n    }\n}\n\n\n: scheduledfuturetask run futuretask / futuretask run:\n\n * setnextruntime(): :\n\n//\nprivate void setnextruntime() {\n    long p = period;\n    if (p > 0)  //scheduleatfixedrate\n        time += p;\n    else\n        time = triggertime(-p);  //schedulewithfixeddelay\n}\n//\nlong triggertime(long delay) {\n    return now() +\n        ((delay < (long.max_value >> 1)) ? delay : overflowfree(delay));\n}\n\n\n * reexecuteperiodic(): :\n\n//\nvoid reexecuteperiodic(runnablescheduledfuture<?> task) {\n    if (canrunincurrentrunstate(true)) {//\n        super.getqueue().add(task);//\n        //run-after-shutdown\n        if (!canrunincurrentrunstate(true) && remove(task))\n            task.cancel(false);\n        else\n            ensureprestart();//\n    }\n}\n\n\nreexecuteperiodicdelayedexecutereexecuteperiodic\n\n# cancel\n\npublic boolean cancel(boolean mayinterruptifrunning) {\n    boolean cancelled = super.cancel(mayinterruptifrunning);\n    if (cancelled && removeoncancel && heapindex >= 0)\n        remove(this);\n    return cancelled;\n}\n\n\nscheduledfuturetask.cancel futuretask.cancel removeoncancel\n\n\n# \n\n// \nprivate volatile boolean continueexistingperiodictasksaftershutdown;\n\n// \nprivate volatile boolean executeexistingdelayedtasksaftershutdown = true;\n\n// \nprivate volatile boolean removeoncancel = false;\n\n//fifo\nprivate static final atomiclong sequencer = new atomiclong();\n\n\n\n * continueexistingperiodictasksaftershutdownexecuteexistingdelayedtasksaftershutdown scheduledthreadpoolexecutor  run-after-shutdown \n\n * removeoncancel setremoveoncancelpolicyremoveoncanceltrue\n\n * sequencer fifo  scheduledfuturetask sequencenumber\n\n\n# \n\nscheduledthreadpoolexecutor :\n\npublic scheduledthreadpoolexecutor(int corepoolsize,\n                                   threadfactory threadfactory,\n                                   rejectedexecutionhandler handler) {\n    super(corepoolsize, integer.max_value, 0, nanoseconds,\n          new delayedworkqueue(), threadfactory, handler);\n}\n\n\nsuperthreadpoolexecutordelayedworkqueue\n\n\n# :schedule\n\npublic <v> scheduledfuture<v> schedule(callable<v> callable,\n                                       long delay,\n                                       timeunit unit) {\n    if (callable == null || unit == null)\n        throw new nullpointerexception();\n    runnablescheduledfuture<v> t = decoratetask(callable,\n        new scheduledfuturetask<v>(callable, triggertime(delay, unit)));//scheduledfuturetask\n    delayedexecute(t);//\n    return t;\n}\n\n\n: schedule():\n\n *  callable/runnable: triggertime scheduledfuturetask  runnable/callable scheduledthreadpoolexecutordecoratetaskdecoratetaskrunnablescheduledfuture:\n\nprotected <v> runnablescheduledfuture<v> decoratetask(\n    runnable runnable, runnablescheduledfuture<v> task) {\n    return task;\n}\n\n\n * : delayedexecute\n\nprivate void delayedexecute(runnablescheduledfuture<?> task) {\n    if (isshutdown())\n        reject(task);//\n    else {\n        super.getqueue().add(task);//\n        if (isshutdown() &&\n            !canrunincurrentrunstate(task.isperiodic()) &&//run-after-shutdown\n            remove(task))//\n            task.cancel(false);\n        else\n            ensureprestart();//\n    }\n}\n\n\n: delayedexecute:\n\n * (ctl >= shutdown)\n * :\n\na:  run-after-shutdown trueensureprestartensureprestart:\n\nvoid ensureprestart() {\n    int wc = workercountof(ctl.get());\n    if (wc < corepoolsize)\n        addworker(null, true);\n    else if (wc == 0)\n        addworker(null, false);\n}\n\n\nensureprestart threadpoolexecutor corepoolsize0\n\nb:  run-after-shutdown false(threadpoolexecutor)removescheduledfuturetask.cancel\n\n\n# :scheduleatfixedrate  schedulewithfixeddelay\n\n/**\n * initialdelay\n * period\n */\npublic scheduledfuture<?> scheduleatfixedrate(runnable command,\n                                              long initialdelay,\n                                              long period,\n                                              timeunit unit) {\n    if (command == null || unit == null)\n        throw new nullpointerexception();\n    if (period <= 0)\n        throw new illegalargumentexception();\n    //runnablescheduledfuture\n    scheduledfuturetask<void> sft =\n        new scheduledfuturetask<void>(command,\n                                      null,\n                                      triggertime(initialdelay, unit),//\n                                      unit.tonanos(period));//\n    runnablescheduledfuture<void> t = decoratetask(command, sft);//\n    sft.outertask = t;//outertask\n    delayedexecute(t);//\n    return t;\n}\n\n/**\n * initialdelay\n * delay\n */\npublic scheduledfuture<?> schedulewithfixeddelay(runnable command,\n                                                 long initialdelay,\n                                                 long delay,\n                                                 timeunit unit) {\n    if (command == null || unit == null)\n        throw new nullpointerexception();\n    if (delay <= 0)\n        throw new illegalargumentexception();\n    //runnablescheduledfuture\n    scheduledfuturetask<void> sft =\n        new scheduledfuturetask<void>(command,\n                                      null,\n                                      triggertime(initialdelay, unit),//\n                                      unit.tonanos(-delay));//\n    runnablescheduledfuture<void> t = decoratetask(command, sft);//\n    sft.outertask = t;//outertask\n    delayedexecute(t);//\n    return t;\n}\n\n\n: scheduleatfixedrateschedulewithfixeddelayschedule\n\nscheduleatfixedrateschedulewithfixeddelay: unit.tonanosscheduleatfixedrateschedulewithfixeddelay scheduledfuturetask period\n\n\n# :shutdown()\n\npublic void shutdown() {\n    super.shutdown();\n}\n//\n@override void onshutdown() {\n    blockingqueue<runnable> q = super.getqueue();\n    //run-after-shutdown\n    boolean keepdelayed =\n        getexecuteexistingdelayedtasksaftershutdownpolicy();\n    boolean keepperiodic =\n        getcontinueexistingperiodictasksaftershutdownpolicy();\n    if (!keepdelayed && !keepperiodic) {//\n        //\n        for (object e : q.toarray())\n            if (e instanceof runnablescheduledfuture<?>)\n                ((runnablescheduledfuture<?>) e).cancel(false);\n        q.clear();//\n    }\n    else {//\n        // traverse snapshot to avoid iterator exceptions\n        //\n        for (object e : q.toarray()) {\n            if (e instanceof runnablescheduledfuture) {\n                runnablescheduledfuture<?> t =\n                    (runnablescheduledfuture<?>)e;\n                if ((t.isperiodic() ? !keepperiodic : !keepdelayed) ||\n                    t.iscancelled()) { // also remove if already cancelled\n                    //\n                    if (q.remove(t))\n                        t.cancel(false);\n                }\n            }\n        }\n    }\n    tryterminate(); //\n}\n\n\n: threadpoolexecutorshutdown threadpoolexecutor shutdownonshutdown run-after-shutdown (continueexistingperiodictasksaftershutdownexecuteexistingdelayedtasksaftershutdown)\n\n\n# \n\n * threadpoolexecutor  scheduledthreadpoolexecutor\n\n:  scheduledthreadpoolexecutor maximumpoolsize( scheduledthreadpoolexecutor integer.max_value)corepoolsize0(allowcorethreadtimeout)\n\n * executors  scheduledthreadpoolexecutor\n   * newscheduledthreadpool: \n   * newsinglethreadscheduledexecutor: \n\n: newscheduledthreadpool(1, threadfactory) newsinglethreadscheduledexecutornewsinglethreadscheduledexecutornewscheduledthreadpool(1, threadfactory)setcorepoolsize\n\n\n# \n\n * bagwellhttps://www.jianshu.com/p/8c97953f2751\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-scheduledthreadpoolexecutor.html",charsets:{cjk:!0}},{title:"JUC: Fork/Join",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-executor-ForkJoinPool.html",relativePath:"java/thread/java-thread-x-juc-executor-ForkJoinPool.md",key:"v-695fc26e",path:"/java/thread/java-thread-x-juc-executor-ForkJoinPool.html",headers:[{level:2,title:"JUC: Fork/Join",slug:"juc-fork-join",normalizedTitle:"juc: fork/join",charIndex:2},{level:2,title:"BATFork/Join",slug:"batfork-join",normalizedTitle:"batfork/join",charIndex:202},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:234},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:255},{level:3,title:": (Divide-and-Conquer)",slug:"--divide-and-conquer",normalizedTitle:": (divide-and-conquer)",charIndex:270},{level:3,title:": work-stealing()",slug:"-work-stealing--",normalizedTitle:": work-stealing()",charIndex:308},{level:3,title:"Fork/Join ",slug:"fork-join-",normalizedTitle:"fork/join ",charIndex:343},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:366},{level:3,title:"ForkJoinPool",slug:"forkjoinpool",normalizedTitle:"forkjoinpool",charIndex:386},{level:3,title:"ForkJoinTask",slug:"forkjointask",normalizedTitle:"forkjointask",charIndex:410},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:432},{level:3,title:"ForkJoinPool",slug:"forkjoinpool",normalizedTitle:"forkjoinpool",charIndex:27},{level:3,title:"ForkJoinTask",slug:"forkjointask",normalizedTitle:"forkjointask",charIndex:410},{level:2,title:"Fork/Join",slug:"fork-join-2",normalizedTitle:"fork/join",charIndex:432},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:584},{level:3,title:" - (external/submissions task)",slug:"--external-submissions-task-",normalizedTitle:" - (external/submissions task)",charIndex:596},{level:3,title:": (Worker task)",slug:"--worker-task-",normalizedTitle:": (worker task)",charIndex:875},{level:3,title:": ",slug:"-",normalizedTitle:": ",charIndex:987},{level:3,title:" - ForkJoinTask.join() / ForkJoinTask.invoke()",slug:"-forkjointask-join-forkjointask-invoke",normalizedTitle:" - forkjointask.join() / forkjointask.invoke()",charIndex:1304},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:1614},{level:3,title:"fork()",slug:"fork",normalizedTitle:"fork()",charIndex:1639},{level:3,title:"fork()compute()join()",slug:"fork-compute-join-",normalizedTitle:"fork()compute()join()",charIndex:1659},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1695},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1713},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:1733},{level:3,title:"JDKFork/Join?",slug:"jdkfork-join",normalizedTitle:"jdkfork/join?",charIndex:1746},{level:3,title:"ExecutorsForkJoinPool",slug:"executorsforkjoinpool",normalizedTitle:"executorsforkjoinpool",charIndex:1778},{level:3,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:1814},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:1835},{level:3,title:"Fork/Join1+2+3++10000",slug:"fork-join1-2-3-10000",normalizedTitle:"fork/join1+2+3++10000",charIndex:1856},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1896},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:1910}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: Fork/Join BATFork/Join Fork/Join  : (Divide-and-Conquer) : work-stealing() Fork/Join  Fork/Join ForkJoinPool ForkJoinTask Fork/Join ForkJoinPool ForkJoinTask Fork/Join   - (external/submissions task) : (Worker task) :   - ForkJoinTask.join() / ForkJoinTask.invoke() Fork/Join fork() fork()compute()join()    JDKFork/Join? ExecutorsForkJoinPool Fork/Join Fork/Join Fork/Join1+2+3++10000  ",content:'# JUC: Fork/Join\n\n> ForkJoinPool JDK 7Fork/Join (Divide-and-Conquer)\n\n * JUC: Fork/Join\n   * BATFork/Join\n   * Fork/Join\n     * \n     * : (Divide-and-Conquer)\n     * : work-stealing()\n     * Fork/Join \n   * Fork/Join\n     * ForkJoinPool\n     * ForkJoinTask\n   * Fork/Join\n     * ForkJoinPool\n       * \n       * ForkJoinPool.WorkQueue :\n     * ForkJoinTask\n       * \n   * Fork/Join\n     * \n     *  - (external/submissions task)\n       * externalPush(ForkJoinTask<?> task)\n       * externalSubmit(ForkJoinTask<?> task)\n       * signalWork(WorkQueue[] ws, WorkQueue q)\n       * tryAddWorker(long c)\n       * createWorker()\n       * registerWorker()\n       * \n     * : (Worker task)\n       * ForkJoinTask.fork()\n       * ForkJoinPool.WorkQueue.push()\n       * \n     * : \n       * ForkJoinWorkerThread.run()\n       * ForkJoinPool.runWorker(WorkQueue w)\n       * ForkJoinPool.scan(WorkQueue w, int r)\n       * ForkJoinPool.awaitWork(WorkQueue w, int r)\n       * WorkQueue.runTask()\n       * ForkJoinPool.deregisterWorker(ForkJoinWorkerThread wt, Throwable ex)\n       * \n     *  - ForkJoinTask.join() / ForkJoinTask.invoke()\n       * ForkJoinTask.externalAwaitDone()\n       * ForkJoinPool.awaitJoin()\n       * WorkQueue.tryRemoveAndExec(ForkJoinTask<?> task)\n       * ForkJoinPool.helpStealer(WorkQueue w, ForkJoinTask<?> task)\n       * ForkJoinPool.tryCompensate(WorkQueue w)\n   * Fork/Join\n     * fork()\n     * fork()compute()join()\n     * \n     * \n   * \n     * JDKFork/Join?\n     * ExecutorsForkJoinPool\n     * Fork/Join\n   * Fork/Join\n     * Fork/Join1+2+3++10000\n     * \n   * \n\n\n# BATFork/Join\n\n\n\nFork/Join\n\n * Fork/Join?\n * Fork/JoinJDK?\n * Fork/Join? ?\n * ForkJoinPool?\n * ForkJoinTask?  RecursiveTask RecursiveAction  CountedCompleter  ForkJoinTask \n * Fork/Join /?\n * Fork/Joinwork-stealing ?\n * JDKFork/Join?\n * ExecutorsForkJoinPool?\n * : ForkJoin1+2+3+...+100000?\n * Fork/Join? JDK\n\n\n# Fork/Join\n\nFork/JoinJavaJDK1.7\n\n\n# \n\nFork/Join:\n\n * : ForkJoinTask (RecursiveTaskRecursiveAction  CountedCompleter)\n * Fork/Join: ForkJoinWorkerThread\n * : ForkJoinPool\n\n: ForkJoinPoolForkJoinWorkerThreadForkJoinTask\n\n// from A Java Fork/Join FrameworkDong Lea\nResult solve(Problem problem) {\n\tif (problem is small)\n \t\tdirectly solve problem\n \telse {\n \t\tsplit problem into independent parts\n \t\tfork new subtasks to solve each part\n \t\tjoin all subtasks\n \t\tcompose result from subresults\n\t}\n}\n\n\nForkJoinPool  ForkJoinTask ( Runnable/Callable  ForkJoinTask )RecursiveTask  ForkJoinTask  ForkJoinTaskRecursiveAction  RecursiveTaskCountedCompleter \n\n RecursiveTask RecursiveAction  CountedCompleter  ForkJoinTask \n\n\n# : (Divide-and-Conquer)\n\n(Divide-and-Conquer) Fork/Join :\n\n\n\n * :  - \n\n\n# : work-stealing()\n\nwork-stealing(): () ForkJoinPool  ForkJoinPool (join)\n\n ForkJoinPool (ForkJoinWorkerThread)(WorkQueue)(LIFOFIFO mode )FIFO\n\n:\n\n * WorkQueue\n * pushpoppoll\n * push/poppoll\n * forkpush\n * \n * poll\n\n\n\n\n# Fork/Join \n\nForkJoinPool :\n\n *  FJP (external/submissions task) workQueues \n *  fork (Worker task) workQueues \n\nFork/Join ?\n\n\n\n> \n\n\n# Fork/Join\n\n\n# ForkJoinPool\n\n\n\n:\n\n * ForkJoinWorkerThreadFactory: ForkJoinWorkerThread\n\n * DefaultForkJoinWorkerThreadFactory: ForkJoinWorkerThreadFactory \n\n * InnocuousForkJoinWorkerThreadFactory:  ForkJoinWorkerThreadFactory\n\n * EmptyTask:  join \n\n * ManagedBlocker:  ForkJoinPool ( Phaser  phase generation)\n\n * WorkQueue: ForkJoinPool work-stealing  ForkJoinTask  @Contented \n   \n   * ( fork()) WorkQueue (top ) LIFO \n   * ( pool ) WorkQueue  FIFO (base)\n\n * : (cache line)232-25664\n\n\n# ForkJoinTask\n\n\n\nForkJoinTask  Future ForkJoinTask  Future fork  join  ExceptionNode  Runnable/Callable  Runnable/Callable  ForkJoinTask ( ForkJoinPool  ForkJoinTask )\n\n\n# Fork/Join\n\n> : 4:\n\n *  - (external/submissions task)\n *  - (Worker task)\n * (ForkJoinWorkerThread.run()ForkJoinTask.doExec())\n * (ForkJoinTask.join()ForkJoinTask.invoke())\n\n\n# ForkJoinPool\n\n# \n\n\n\n(UC_MASK & (c + AC_UNIT)) | (SP_MASK & c)c  ctlUC_MASK  SP_MASK AC_UNIT (UC_MASK & (c + AC_UNIT))3232(SP_MASK & c)ctl\n\n\n\nForkJoinPool   WorkQueue :\n\n// Constants shared across ForkJoinPool and WorkQueue\n\n// \nstatic final int SMASK = 0xffff;        //  \nstatic final int MAX_CAP = 0x7fff;        //  \nstatic final int EVENMASK = 0xfffe;        //  \nstatic final int SQMASK = 0x007e;        //  workQueues 64\n\n// ctl  WorkQueue.scanState \nstatic final int SCANNING = 1;             // \nstatic final int INACTIVE = 1 << 31;       //   \nstatic final int SS_SEQ = 1 << 16;       // ABA\n\n// ForkJoinPool.config  WorkQueue.config \nstatic final int MODE_MASK = 0xffff << 16;  // \nstatic final int LIFO_QUEUE = 0; //LIFO\nstatic final int FIFO_QUEUE = 1 << 16;//FIFO\nstatic final int SHARED_QUEUE = 1 << 31;       // \n\n\nForkJoinPool :\n\n//  \nprivate static final long SP_MASK = 0xffffffffL;\nprivate static final long UC_MASK = ~SP_MASK;\n\n// \nprivate static final int AC_SHIFT = 48;\nprivate static final long AC_UNIT = 0x0001L << AC_SHIFT; //\nprivate static final long AC_MASK = 0xffffL << AC_SHIFT; //\n\n// \nprivate static final int TC_SHIFT = 32;\nprivate static final long TC_UNIT = 0x0001L << TC_SHIFT; //\nprivate static final long TC_MASK = 0xffffL << TC_SHIFT; //\nprivate static final long ADD_WORKER = 0x0001L << (TC_SHIFT + 15);  // \n\n// \nprivate static final int RSLOCK = 1;\nprivate static final int RSIGNAL = 1 << 1;\nprivate static final int STARTED = 1 << 2;\nprivate static final int STOP = 1 << 29;\nprivate static final int TERMINATED = 1 << 30;\nprivate static final int SHUTDOWN = 1 << 31;\n\n// \nvolatile long ctl;                   // \nvolatile int runState;               // \nfinal int config;                    // |\nint indexSeed;                       // \nvolatile WorkQueue[] workQueues;     // workQueue\nfinal ForkJoinWorkerThreadFactory factory;// \nfinal UncaughtExceptionHandler ueh;  // \nfinal String workerNamePrefix;       // \nvolatile AtomicLong stealCounter;    // \n\n/**  */\n//\npublic static final ForkJoinWorkerThreadFactory defaultForkJoinWorkerThreadFactory;\n//\nprivate static final RuntimePermission modifyThreadPermission;\n// pool\nstatic final ForkJoinPool common;\n//common\nstatic final int commonParallelism;\n//tryCompensate\nprivate static int commonMaxSpares;\n//workerNamePrefix()\nprivate static int poolNumberSequence;\n//()2\nprivate static final long IDLE_TIMEOUT = 2000L * 1000L * 1000L; // 2sec\n//timer\nprivate static final long TIMEOUT_SLOP = 20L * 1000L * 1000L;  // 20ms\n//\nprivate static final int DEFAULT_COMMON_MAX_SPARES = 256;\n//awaitRunStateLockawaitWork\nprivate static final int SPINS  = 0;\n//indexSeed\nprivate static final int SEED_INCREMENT = 0x9e3779b9;\n\n\n: ForkJoinPool 64 long  ctl16:\n\n * AC: 16\n * TC: 16\n * SS: 16\n * ID:  WorkQueue (poolIndex)16\n\nctl32(sp=(int)ctl)sp0\n\n# ForkJoinPool.WorkQueue :\n\n//2\nstatic final int INITIAL_QUEUE_CAPACITY = 1 << 13;\n//\nstatic final int MAXIMUM_QUEUE_CAPACITY = 1 << 26; // 64M\n\n// \nvolatile int scanState;    // Woker, <0: inactive; odd:scanning\nint stackPred;             // ctl\nint nsteals;               // \nint hint;                  // \nint config;                // \nvolatile int qlock;        // 1: locked, < 0: terminate; else 0\nvolatile int base;         //poll(/)\nint top;                   //  push(/)\nForkJoinTask<?>[] array;   // \nfinal ForkJoinPool pool;   // the containing pool (may be null)\nfinal ForkJoinWorkerThread owner; // null\nvolatile Thread parker;    // parkownernull\nvolatile ForkJoinTask<?> currentJoin;  // join\nvolatile ForkJoinTask<?> currentSteal; // \n\n\n\n# ForkJoinTask\n\n# \n\n/**  */\nvolatile int status; // \nstatic final int DONE_MASK   = 0xf0000000;  // \nstatic final int NORMAL      = 0xf0000000;  // must be negative\nstatic final int CANCELLED   = 0xc0000000;  // must be < NORMAL\nstatic final int EXCEPTIONAL = 0x80000000;  // must be < CANCELLED\nstatic final int SIGNAL      = 0x00010000;  // must be >= 1 << 16 \nstatic final int SMASK       = 0x0000ffff;  //  \n\n\n\n# Fork/Join\n\n\n# \n\npublic ForkJoinPool(int parallelism,\n                    ForkJoinWorkerThreadFactory factory,\n                    UncaughtExceptionHandler handler,\n                    boolean asyncMode) {\n    this(checkParallelism(parallelism),\n            checkFactory(factory),\n            handler,\n            asyncMode ? FIFO_QUEUE : LIFO_QUEUE,\n            "ForkJoinPool-" + nextPoolId() + "-worker-");\n    checkPermission();\n}\n\n\n:  ForkJoinPool :\n\n * parallelism: CPU1\n * factory: \n * handler: null\n * asyncMode:  falsetrue FIFO (join)\n\n ForkJoinPool commonJDK1.8ForkJoinPool.commonPool()common:\n\nprivate static ForkJoinPool makeCommonPool() {\n    int parallelism = -1;\n    ForkJoinWorkerThreadFactory factory = null;\n    UncaughtExceptionHandler handler = null;\n    try {  // ignore exceptions in accessing/parsing\n        String pp = System.getProperty\n                ("java.util.concurrent.ForkJoinPool.common.parallelism");//\n        String fp = System.getProperty\n                ("java.util.concurrent.ForkJoinPool.common.threadFactory");//\n        String hp = System.getProperty\n                ("java.util.concurrent.ForkJoinPool.common.exceptionHandler");//\n        if (pp != null)\n            parallelism = Integer.parseInt(pp);\n        if (fp != null)\n            factory = ((ForkJoinWorkerThreadFactory) ClassLoader.\n                    getSystemClassLoader().loadClass(fp).newInstance());\n        if (hp != null)\n            handler = ((UncaughtExceptionHandler) ClassLoader.\n                    getSystemClassLoader().loadClass(hp).newInstance());\n    } catch (Exception ignore) {\n    }\n    if (factory == null) {\n        if (System.getSecurityManager() == null)\n            factory = defaultForkJoinWorkerThreadFactory;\n        else // use security-managed default\n            factory = new InnocuousForkJoinWorkerThreadFactory();\n    }\n    if (parallelism < 0 && // default 1 less than #cores\n            (parallelism = Runtime.getRuntime().availableProcessors() - 1) <= 0)\n        parallelism = 1;//1\n    if (parallelism > MAX_CAP)\n        parallelism = MAX_CAP;\n    return new ForkJoinPool(parallelism, factory, handler, LIFO_QUEUE,\n            "ForkJoinPool.commonPool-worker-");\n}\n\n\ncommon pool(join)\n\n\n#  - (external/submissions task)\n\n ForkJoinPool :\n\n * invoke()\n * execute()\n * submit()task.get()\n\nexternalPush()externalPush()\n\n# externalPush(ForkJoinTask<?> task)\n\n//submission\nfinal void externalPush(ForkJoinTask<?> task) {\n    WorkQueue[] ws;\n    WorkQueue q;\n    int m;\n    int r = ThreadLocalRandom.getProbe();//WorkQueue\n    int rs = runState;\n    if ((ws = workQueues) != null && (m = (ws.length - 1)) >= 0 &&\n            (q = ws[m & r & SQMASK]) != null && r != 0 && rs > 0 && //workQueue\n            U.compareAndSwapInt(q, QLOCK, 0, 1)) {//workQueue\n        ForkJoinTask<?>[] a;\n        int am, n, s;\n        if ((a = q.array) != null &&\n                (am = a.length - 1) > (n = (s = q.top) - q.base)) {\n            int j = ((am & s) << ASHIFT) + ABASE;//\n            U.putOrderedObject(a, j, task);//\n            U.putOrderedInt(q, QTOP, s + 1);//push slot\n            U.putIntVolatile(q, QLOCK, 0);//\n            if (n <= 1)\n                signalWork(ws, q);//1\n            return;\n        }\n        U.compareAndSwapInt(q, QLOCK, 1, 0);//\n    }\n    externalSubmit(task);//workQueues\n}\n\n\nexternalPushexternalSubmit: externalSubmitexternalPushworkQueuesexternalSubmitexternalSubmit-externalPush\n\nexternalPush:  workQueue workQueue top1(externalSubmit)\n\n# externalSubmit(ForkJoinTask<?> task)\n\n//\nprivate void externalSubmit(ForkJoinTask<?> task) {\n    //WorkQueue\n    int r;                                    // initialize caller\'s probe\n    if ((r = ThreadLocalRandom.getProbe()) == 0) {\n        ThreadLocalRandom.localInit();\n        r = ThreadLocalRandom.getProbe();\n    }\n    for (; ; ) {\n        WorkQueue[] ws;\n        WorkQueue q;\n        int rs, m, k;\n        boolean move = false;\n        if ((rs = runState) < 0) {// \n            tryTerminate(false, false);     // help terminate\n            throw new RejectedExecutionException();\n        }\n        //workQueues\n        else if ((rs & STARTED) == 0 ||     // initialize\n                ((ws = workQueues) == null || (m = ws.length - 1) < 0)) {\n            int ns = 0;\n            rs = lockRunState();//runState\n            try {\n                //\n                if ((rs & STARTED) == 0) {\n                    //stealCounter\n                    U.compareAndSwapObject(this, STEALCOUNTER, null,\n                            new AtomicLong());\n                    //workQueues2\n                    // create workQueues array with size a power of two\n                    int p = config & SMASK; // ensure at least 2 slots\n                    int n = (p > 1) ? p - 1 : 1;\n                    n |= n >>> 1;\n                    n |= n >>> 2;\n                    n |= n >>> 4;\n                    n |= n >>> 8;\n                    n |= n >>> 16;\n                    n = (n + 1) << 1;\n                    workQueues = new WorkQueue[n];\n                    ns = STARTED;\n                }\n            } finally {\n                unlockRunState(rs, (rs & ~RSLOCK) | ns);//runState\n            }\n        } else if ((q = ws[k = r & m & SQMASK]) != null) {//workQueue\n            if (q.qlock == 0 && U.compareAndSwapInt(q, QLOCK, 0, 1)) {// workQueue\n                ForkJoinTask<?>[] a = q.array;//workQueue\n                int s = q.top;\n                boolean submitted = false; // initial submission or resizing\n                try {                      // locked version of push\n                    if ((a != null && a.length > s + 1 - q.base) ||\n                            (a = q.growArray()) != null) {//\n                        int j = (((a.length - 1) & s) << ASHIFT) + ABASE;\n                        U.putOrderedObject(a, j, task);//\n                        U.putOrderedInt(q, QTOP, s + 1);//push slot\n                        submitted = true;\n                    }\n                } finally {\n                    U.compareAndSwapInt(q, QLOCK, 1, 0);//\n                }\n                if (submitted) {//\n                    signalWork(ws, q);//\n                    return;\n                }\n            }\n            move = true;                   // move on failure \n        } else if (((rs = runState) & RSLOCK) == 0) { // create new queue\n            q = new WorkQueue(this, null);\n            q.hint = r;\n            q.config = k | SHARED_QUEUE;\n            q.scanState = INACTIVE;\n            rs = lockRunState();           // publish index\n            if (rs > 0 && (ws = workQueues) != null &&\n                    k < ws.length && ws[k] == null)\n                ws[k] = q;                 // kworkQueue\n            //else terminated\n            unlockRunState(rs, rs & ~RSLOCK);\n        } else\n            move = true;                   // move if busy\n        if (move)\n            r = ThreadLocalRandom.advanceProbe(r);//\n    }\n}\n\n\n: externalSubmitexternalPushworkQueues:\n\n * (runState<0)tryTerminate\n *  FJP : stealCounterworkerQueues\n * externalPush:  workQueuesignalWork\n * 3 workQueue null workQueue\n * \n\n# signalWork(WorkQueue[] ws, WorkQueue q)\n\nfinal void signalWork(WorkQueue[] ws, WorkQueue q) {\n    long c;\n    int sp, i;\n    WorkQueue v;\n    Thread p;\n    while ((c = ctl) < 0L) {                       // too few active\n        if ((sp = (int) c) == 0) {                  // no idle workers\n            if ((c & ADD_WORKER) != 0L)            // too few workers\n                tryAddWorker(c);//\n            break;\n        }\n        if (ws == null)                            // unstarted/terminated\n            break;\n        if (ws.length <= (i = sp & SMASK))         // terminated\n            break;\n        if ((v = ws[i]) == null)                   // terminating\n            break;\n        //ctlSS_SEQABA\n        int vs = (sp + SS_SEQ) & ~INACTIVE;        // next scanState\n        int d = sp - v.scanState;                  // screen CAS\n        //(32)scanState(32)\n        long nc = (UC_MASK & (c + AC_UNIT)) | (SP_MASK & v.stackPred);\n        if (d == 0 && U.compareAndSwapLong(this, CTL, c, nc)) {\n            v.scanState = vs;                      // activate v\n            if ((p = v.parker) != null)\n                U.unpark(p);//\n            break;\n        }\n        if (q != null && q.base == q.top)          // no more work\n            break;\n    }\n}\n\n\n: externalPushexternalSubmitworkQueue.pushscan WorkQueue parker((ctl & ADD_WORKER) != 0L)tryAddWorker\n\n# tryAddWorker(long c)\n\nprivate void tryAddWorker(long c) {\n    boolean add = false;\n    do {\n        long nc = ((AC_MASK & (c + AC_UNIT)) |\n                   (TC_MASK & (c + TC_UNIT)));\n        if (ctl == c) {\n            int rs, stop;                 // check if terminating\n            if ((stop = (rs = lockRunState()) & STOP) == 0)\n                add = U.compareAndSwapLong(this, CTL, c, nc);\n            unlockRunState(rs, rs & ~RSLOCK);//\n            if (stop != 0)\n                break;\n            if (add) {\n                createWorker();//\n                break;\n            }\n        }\n    } while (((c = ctl) & ADD_WORKER) != 0L && (int)c == 0);\n}\n\n\n: ctlcreateWorker()\n\n# createWorker()\n\nprivate boolean createWorker() {\n    ForkJoinWorkerThreadFactory fac = factory;\n    Throwable ex = null;\n    ForkJoinWorkerThread wt = null;\n    try {\n        if (fac != null && (wt = fac.newThread(this)) != null) {\n            wt.start();\n            return true;\n        }\n    } catch (Throwable rex) {\n        ex = rex;\n    }\n    deregisterWorker(wt, ex);//\n    return false;\n}\n\n\n: createWorkerForkJoinWorkerThread(wt.start())deregisterWorker(deregisterWorker)\n\nForkJoinWorkerThread :\n\nprotected ForkJoinWorkerThread(ForkJoinPool pool) {\n    // Use a placeholder until a useful name can be set in registerWorker\n    super("aForkJoinWorkerThread");\n    this.pool = pool;\n    this.workQueue = pool.registerWorker(this);\n}\n\n\n ForkJoinWorkerThread  Thread poolworkQueueworkQueueForkJoinPool.registerWorker\n\n# registerWorker()\n\nfinal WorkQueue registerWorker(ForkJoinWorkerThread wt) {\n    UncaughtExceptionHandler handler;\n    //\n    wt.setDaemon(true);                           // configure thread\n    if ((handler = ueh) != null)\n        wt.setUncaughtExceptionHandler(handler);\n    WorkQueue w = new WorkQueue(this, wt);//WorkQueue\n    int i = 0;                                    // assign a pool index\n    int mode = config & MODE_MASK;\n    int rs = lockRunState();\n    try {\n        WorkQueue[] ws;\n        int n;                    // skip if no array\n        if ((ws = workQueues) != null && (n = ws.length) > 0) {\n            //WorkQueue\n            int s = indexSeed += SEED_INCREMENT;  // unlikely to collide\n            int m = n - 1;\n            i = ((s << 1) | 1) & m;               // Worker odd-numbered indices\n            if (ws[i] != null) {                  // collision \n                int probes = 0;                   // step by approx half n\n                int step = (n <= 4) ? 2 : ((n >>> 1) & EVENMASK) + 2;\n                //\n                while (ws[i = (i + step) & m] != null) {\n                    if (++probes >= n) {//workQueues\n                        workQueues = ws = Arrays.copyOf(ws, n <<= 1);//workQueues \n                        m = n - 1;\n                        probes = 0;\n                    }\n                }\n            }\n            w.hint = s;                           // use as random seed\n            w.config = i | mode;\n            w.scanState = i;                      // publication fence\n            ws[i] = w;\n        }\n    } finally {\n        unlockRunState(rs, rs & ~RSLOCK);\n    }\n    wt.setName(workerNamePrefix.concat(Integer.toString(i >>> 1)));\n    return w;\n}\n\n\n: registerWorker ForkJoinWorkerThread  WorkQueue WorkQueue (: i = ((s << 1) | 1) & m;)\n\n# \n\nOKcreateWorker()(wt.start())CPU ForkJoinWorkerThread run\n\n\n# : (Worker task)\n\nfork()(fork)ForkJoinPool.WorkQueue.push()\n\n# ForkJoinTask.fork()\n\npublic final ForkJoinTask<V> fork() {\n    Thread t;\n    if ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread)\n        ((ForkJoinWorkerThread)t).workQueue.push(this);\n    else\n        ForkJoinPool.common.externalPush(this);\n    return this;\n}\n\n\n:  Worker forkForkJoinPool.workQueue.push()ForkJoinPool.externalPush()()\n\n# ForkJoinPool.WorkQueue.push()\n\nfinal void push(ForkJoinTask<?> task) {\n    ForkJoinTask<?>[] a;\n    ForkJoinPool p;\n    int b = base, s = top, n;\n    if ((a = array) != null) {    // ignore if queue removed\n        int m = a.length - 1;     // fenced write for task visibility\n        U.putOrderedObject(a, ((m & s) << ASHIFT) + ABASE, task);\n        U.putOrderedInt(this, QTOP, s + 1);\n        if ((n = s - b) <= 1) {//\n            if ((p = pool) != null)\n                p.signalWork(p.workQueues, this);\n        } else if (n >= m)\n            growArray();\n    }\n}\n\n\n: top WorkQueue (top-base<=1)signalWork WorkQueue  WorkQueue growArray()growArray():\n\nfinal ForkJoinTask<?>[] growArray() {\n    ForkJoinTask<?>[] oldA = array;//\n    int size = oldA != null ? oldA.length << 1 : INITIAL_QUEUE_CAPACITY;\n    if (size > MAXIMUM_QUEUE_CAPACITY)\n        throw new RejectedExecutionException("Queue capacity exceeded");\n    int oldMask, t, b;\n    //\n    ForkJoinTask<?>[] a = array = new ForkJoinTask<?>[size];\n    if (oldA != null && (oldMask = oldA.length - 1) >= 0 &&\n            (t = top) - (b = base) > 0) {\n        int mask = size - 1;\n        //\n        do { // emulate poll from old array, push to new array\n            ForkJoinTask<?> x;\n            int oldj = ((b & oldMask) << ASHIFT) + ABASE;\n            int j = ((b & mask) << ASHIFT) + ABASE;\n            x = (ForkJoinTask<?>) U.getObjectVolatile(oldA, oldj);\n            if (x != null &&\n                    U.compareAndSwapObject(oldA, oldj, x, null))\n                U.putObjectVolatile(a, j, x);\n        } while (++b != t);\n    }\n    return a;\n}\n\n\n# \n\n\n\n\n# : \n\nForkJoinPool .createWorker()CPU ForkJoinWorkerThread run()\n\n# ForkJoinWorkerThread.run()\n\npublic void run() {\n    if (workQueue.array == null) { // only run once\n        Throwable exception = null;\n        try {\n            onStart();//\n            pool.runWorker(workQueue);\n        } catch (Throwable ex) {\n            exception = ex;\n        } finally {\n            try {\n                onTermination(exception);//\n            } catch (Throwable ex) {\n                if (exception == null)\n                    exception = ex;\n            } finally {\n                pool.deregisterWorker(this, exception);//\n            }\n        }\n    }\n}\n\n\n: (onStartonTermination)ForkJoinPool.runWorker()ForkJoinPool.deregisterWorker(deregisterWorker)\n\n# ForkJoinPool.runWorker(WorkQueue w)\n\nfinal void runWorker(WorkQueue w) {\n    w.growArray();                   // allocate queue\n    int seed = w.hint;               // initially holds randomization hint\n    int r = (seed == 0) ? 1 : seed;  // avoid 0 for xorShift\n    for (ForkJoinTask<?> t; ; ) {\n        if ((t = scan(w, r)) != null)//\n            w.runTask(t);\n        else if (!awaitWork(w, r))\n            break;\n        r ^= r << 13;\n        r ^= r >>> 17;\n        r ^= r << 5; // xorshift\n    }\n}\n\n\n: runWorker ForkJoinWorkerThread : scanWorkQueue .runTaskawaitWork/\n\n# ForkJoinPool.scan(WorkQueue w, int r)\n\nprivate ForkJoinTask<?> scan(WorkQueue w, int r) {\n    WorkQueue[] ws;\n    int m;\n    if ((ws = workQueues) != null && (m = ws.length - 1) > 0 && w != null) {\n        int ss = w.scanState;                     // initially non-negative\n        //\n        for (int origin = r & m, k = origin, oldSum = 0, checkSum = 0; ; ) {\n            WorkQueue q;\n            ForkJoinTask<?>[] a;\n            ForkJoinTask<?> t;\n            int b, n;\n            long c;\n            if ((q = ws[k]) != null) {//workQueue\n                if ((n = (b = q.base) - q.top) < 0 &&\n                        (a = q.array) != null) {      // non-empty\n                    //\n                    long i = (((a.length - 1) & b) << ASHIFT) + ABASE;\n                    if ((t = ((ForkJoinTask<?>)\n                            U.getObjectVolatile(a, i))) != null && //base\n                            q.base == b) {//stable\n                        if (ss >= 0) {  //scanning\n                            if (U.compareAndSwapObject(a, i, t, null)) {//\n                                q.base = b + 1;//base\n                                if (n < -1)       // signal others\n                                    signalWork(ws, q);//\n                                return t;\n                            }\n                        } else if (oldSum == 0 &&   // try to activate \n                                w.scanState < 0)\n                            tryRelease(c = ctl, ws[m & (int) c], AC_UNIT);//\n                    }\n                    //basebase\n                    if (ss < 0)                   // refresh\n                        ss = w.scanState;\n                    r ^= r << 1;\n                    r ^= r >>> 3;\n                    r ^= r << 10;\n                    origin = k = r & m;           // move and rescan\n                    oldSum = checkSum = 0;\n                    continue;\n                }\n                checkSum += b;//base\n            }\n            //k \n            if ((k = (k + 1) & m) == origin) {    // continue until stable\n                // workQueues\n\n                if ((ss >= 0 || (ss == (ss = w.scanState))) &&\n                        oldSum == (oldSum = checkSum)) {\n                    if (ss < 0 || w.qlock < 0)    // already inactive\n                        break;// ,\n\n                    //WorkQueue\n                    int ns = ss | INACTIVE;       // try to inactivate\n                    long nc = ((SP_MASK & ns) |\n                            (UC_MASK & ((c = ctl) - AC_UNIT)));//ctlINACTIVE\n                    w.stackPred = (int) c;         // hold prev stack top\n                    U.putInt(w, QSCANSTATE, ns);//scanStateinactive\n                    if (U.compareAndSwapLong(this, CTL, c, nc))//scanState\n                        ss = ns;\n                    else\n                        w.scanState = ss;         // back out\n                }\n                checkSum = 0;//checkSum\n            }\n        }\n    }\n    return null;\n}\n\n\n: w.hint WorkQueue WorkQueue Worker\n\n:\n\n *  WorkQueue\n\n * base ForkJoinTaskbase WorkQueue 1signalWork\n\n * (INACTIVE)tryRelease\n   \n   tryRelease:\n   \n   private boolean tryRelease(long c, WorkQueue v, long inc) {\n       int sp = (int) c, vs = (sp + SS_SEQ) & ~INACTIVE;\n       Thread p;\n       //ctl32scanStateparker\n       if (v != null && v.scanState == sp) {          // v is at top of stack\n           //(32)scanState(32)\n           long nc = (UC_MASK & (c + inc)) | (SP_MASK & v.stackPred);\n           if (U.compareAndSwapLong(this, CTL, c, nc)) {\n               v.scanState = vs;\n               if ((p = v.parker) != null)\n                   U.unpark(p);//\n               return true;\n           }\n       }\n       return false;\n   }\n   \n\n * base\n\n * workQueuesINACTIVEcheckSumnull\n\n# ForkJoinPool.awaitWork(WorkQueue w, int r)\n\nprivate boolean awaitWork(WorkQueue w, int r) {\n    if (w == null || w.qlock < 0)                 // w is terminating\n        return false;\n    for (int pred = w.stackPred, spins = SPINS, ss; ; ) {\n        if ((ss = w.scanState) >= 0)//\n            break;\n        else if (spins > 0) {\n            r ^= r << 6;\n            r ^= r >>> 21;\n            r ^= r << 7;\n            if (r >= 0 && --spins == 0) {         // randomize spins\n                WorkQueue v;\n                WorkQueue[] ws;\n                int s, j;\n                AtomicLong sc;\n                if (pred != 0 && (ws = workQueues) != null &&\n                        (j = pred & SMASK) < ws.length &&\n                        (v = ws[j]) != null &&        // see if pred parking\n                        (v.parker == null || v.scanState >= 0))\n                    spins = SPINS;                // continue spinning\n            }\n        } else if (w.qlock < 0)                     // workQueuefalse recheck after spins\n            return false;\n        else if (!Thread.interrupted()) {//\n            long c, prevctl, parkTime, deadline;\n            int ac = (int) ((c = ctl) >> AC_SHIFT) + (config & SMASK);//\n            if ((ac <= 0 && tryTerminate(false, false)) || //active\n                    (runState & STOP) != 0)           // pool terminating\n                return false;\n            if (ac <= 0 && ss == (int) c) {        // is last waiter\n                //(32)scanState(32)\n                prevctl = (UC_MASK & (c + AC_UNIT)) | (SP_MASK & pred);\n                int t = (short) (c >>> TC_SHIFT);  // shrink excess spares\n                if (t > 2 && U.compareAndSwapLong(this, CTL, c, prevctl))//\n                    return false;                 // else use timed wait\n                //\n                parkTime = IDLE_TIMEOUT * ((t >= 0) ? 1 : 1 - t);\n                deadline = System.nanoTime() + parkTime - TIMEOUT_SLOP;\n            } else\n                prevctl = parkTime = deadline = 0L;\n            Thread wt = Thread.currentThread();\n            U.putObject(wt, PARKBLOCKER, this);   // emulate LockSupport\n            w.parker = wt;//parker\n            if (w.scanState < 0 && ctl == c)      // recheck before park\n                U.park(false, parkTime);//\n\n            U.putOrderedObject(w, QPARKER, null);\n            U.putObject(wt, PARKBLOCKER, null);\n            if (w.scanState >= 0)//\n                break;\n            if (parkTime != 0L && ctl == c &&\n                    deadline - System.nanoTime() <= 0L &&\n                    U.compareAndSwapLong(this, CTL, c, prevctl))//ctlfalse\n                return false;                     // shrink pool\n        }\n    }\n    return true;\n}\n\n\n: runWorkerscanawaitWork:\n\n * false active false Worker(IDLE_TIMEOUT)scanning(scanState >= 0)true scanctlfalse\n\n# WorkQueue.runTask()\n\nfinal void runTask(ForkJoinTask<?> task) {\n    if (task != null) {\n        scanState &= ~SCANNING; // mark as busy\n        (currentSteal = task).doExec();//currentSteal\n        U.putOrderedObject(this, QCURRENTSTEAL, null); // release for GC\n        execLocalTasks();//\n        ForkJoinWorkerThread thread = owner;\n        if (++nsteals < 0)      // collect on overflow\n            transferStealCount(pool);//\n        scanState |= SCANNING;\n        if (thread != null)\n            thread.afterTopLevelExec();//\n    }\n}\n\n\n: scanWorkQueue.runTask():\n\n * scanState\n\n * currentStealForkJoinTask.doExec():\n   \n   //ForkJoinTask.doExec()\n   final int doExec() {\n       int s; boolean completed;\n       if ((s = status) >= 0) {\n           try {\n               completed = exec();//\n           } catch (Throwable rex) {\n               return setExceptionalCompletion(rex);\n           }\n           if (completed)\n               s = setCompletion(NORMAL);\n       }\n       return s;\n   }\n   \n\n * execLocalTasksWorkerQueue:\n   \n   //\n   final void execLocalTasks() {\n       int b = base, m, s;\n       ForkJoinTask<?>[] a = array;\n       if (b - (s = top - 1) <= 0 && a != null &&\n               (m = a.length - 1) >= 0) {\n           if ((config & FIFO_QUEUE) == 0) {//FIFO\n               for (ForkJoinTask<?> t; ; ) {\n                   if ((t = (ForkJoinTask<?>) U.getAndSetObject\n                           (a, ((m & s) << ASHIFT) + ABASE, null)) == null)//FIFOtop\n                       break;\n                   U.putOrderedInt(this, QTOP, s);\n                   t.doExec();//\n                   if (base - (s = top - 1) > 0)\n                       break;\n               }\n           } else\n               pollAndExecAll();//LIFObase\n       }\n   }\n   \n\n * \n\n * scanState\n\n# ForkJoinPool.deregisterWorker(ForkJoinWorkerThread wt, Throwable ex)\n\nfinal void deregisterWorker(ForkJoinWorkerThread wt, Throwable ex) {\n    WorkQueue w = null;\n    //1.workQueue\n    if (wt != null && (w = wt.workQueue) != null) {//ForkJoinWorkerThread\n        WorkQueue[] ws;                           // remove index from array\n        int idx = w.config & SMASK;//workQueue\n        int rs = lockRunState();//runState\n        if ((ws = workQueues) != null && ws.length > idx && ws[idx] == w)\n            ws[idx] = null;//workQueue\n        unlockRunState(rs, rs & ~RSLOCK);//runState\n    }\n    //2.CTL\n    long c;                                       // decrement counts\n    do {} while (!U.compareAndSwapLong\n                 (this, CTL, c = ctl, ((AC_MASK & (c - AC_UNIT)) |\n                                       (TC_MASK & (c - TC_UNIT)) |\n                                       (SP_MASK & c))));\n    //3.workQueue\n    if (w != null) {\n        w.qlock = -1;                             // ensure set\n        w.transferStealCount(this);\n        w.cancelAll();                            // cancel remaining tasks\n    }\n    //4.workQueue\n    for (;;) {                                    // possibly replace\n        WorkQueue[] ws; int m, sp;\n        //\n        if (tryTerminate(false, false) || w == null || w.array == null ||\n            (runState & STOP) != 0 || (ws = workQueues) == null ||\n            (m = ws.length - 1) < 0)              // already terminating\n            break;\n        //\n        if ((sp = (int)(c = ctl)) != 0) {         // wake up replacement\n            if (tryRelease(c, ws[sp & m], AC_UNIT))\n                break;\n        }\n        //\n        else if (ex != null && (c & ADD_WORKER) != 0L) {\n            tryAddWorker(c);                      // create replacement\n            break;\n        }\n        else                                      // don\'t need replacement\n            break;\n    }\n    //5.\n    if (ex == null)                               // help clean on way out\n        ForkJoinTask.helpExpungeStaleExceptions();\n    else                                          // rethrow\n        ForkJoinTask.rethrow(ex);\n}\n\n\n: deregisterWorker ForkJoinTask \n\n# \n\n(join/invoke)\n\n\n#  - ForkJoinTask.join() / ForkJoinTask.invoke()\n\n * join() :\n\n//\npublic final V join() {\n    int s;\n    if ((s = doJoin() & DONE_MASK) != NORMAL)\n        reportException(s);\n    return getRawResult();\n}\n\n//join, get, quietlyJoin\nprivate int doJoin() {\n    int s; Thread t; ForkJoinWorkerThread wt; ForkJoinPool.WorkQueue w;\n    return (s = status) < 0 ? s :\n        ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ?\n        (w = (wt = (ForkJoinWorkerThread)t).workQueue).\n        tryUnpush(this) && (s = doExec()) < 0 ? s :\n        wt.pool.awaitJoin(w, this, 0L) :\n        externalAwaitDone();\n}\n\n\n * invoke() :\n\n//\npublic final V invoke() {\n    int s;\n    if ((s = doInvoke() & DONE_MASK) != NORMAL)\n        reportException(s);\n    return getRawResult();\n}\n\n//invoke, quietlyInvoke\nprivate int doInvoke() {\n    int s; Thread t; ForkJoinWorkerThread wt;\n    return (s = doExec()) < 0 ? s :\n        ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ?\n        (wt = (ForkJoinWorkerThread)t).pool.\n        awaitJoin(wt.workQueue, this, 0L) :\n        externalAwaitDone();\n}\n\n\n: join()fork()()\n\nForkJoinTaskjoin()invoke()(getdoJoin)externalAwaitDoneinvoke()join() top (tryUnpush) top ForkJoinPool.awaitJoin join (ForkJoinTask fork-join: a.fork(); b.fork(); b.join(); a.join(); b (top )fork()join()ForkJoinPool.awaitJoin)\n\njoin()join()join():\n\n\n\n join (externalAwaitDone) join (ForkJoinPool.awaitJoin())\n\n# ForkJoinTask.externalAwaitDone()\n\nprivate int externalAwaitDone() {\n    //\n    int s = ((this instanceof CountedCompleter) ? // try helping\n             ForkJoinPool.common.externalHelpComplete(  // CountedCompleter\n                 (CountedCompleter<?>)this, 0) :\n             ForkJoinPool.common.tryExternalUnpush(this) ? doExec() : 0);  // ForkJoinTask\n    if (s >= 0 && (s = status) >= 0) {//\n        boolean interrupted = false;\n        do {\n            if (U.compareAndSwapInt(this, STATUS, s, s | SIGNAL)) {  //state\n                synchronized (this) {\n                    if (status >= 0) {//SIGNAL \n                        try {\n                            wait(0L);\n                        } catch (InterruptedException ie) {\n                            interrupted = true;\n                        }\n                    }\n                    else\n                        notifyAll();\n                }\n            }\n        } while ((s = status) >= 0);\n        if (interrupted)\n            Thread.currentThread().interrupt();\n    }\n    return s;\n}\n\n\n: join:\n\n *  CountedCompleter externalHelpComplete\n\n *  ForkJoinTask tryExternalUnpush:\n   \n   // tryUnpush (top)\n   final boolean tryExternalUnpush(ForkJoinTask<?> task) {\n       WorkQueue[] ws;\n       WorkQueue w;\n       ForkJoinTask<?>[] a;\n       int m, s;\n       int r = ThreadLocalRandom.getProbe();\n       if ((ws = workQueues) != null && (m = ws.length - 1) >= 0 &&\n               (w = ws[m & r & SQMASK]) != null &&\n               (a = w.array) != null && (s = w.top) != w.base) {\n           long j = (((a.length - 1) & (s - 1)) << ASHIFT) + ABASE;  //top\n           if (U.compareAndSwapInt(w, QLOCK, 0, 1)) {  //\n               if (w.top == s && w.array == a &&\n                       U.getObject(a, j) == task &&\n                       U.compareAndSwapObject(a, j, task, null)) {  //\n                   U.putOrderedInt(w, QTOP, s - 1);  //top\n                   U.putOrderedInt(w, QLOCK, 0); //true\n                   return true;\n               }\n               U.compareAndSwapInt(w, QLOCK, 1, 0);  //topfalse\n           }\n       }\n       return false;\n   }\n   \n   \n   tryExternalUnpushtopexternalAwaitDonedoExec()\n\n# ForkJoinPool.awaitJoin()\n\nfinal int awaitJoin(WorkQueue w, ForkJoinTask<?> task, long deadline) {\n    int s = 0;\n    if (task != null && w != null) {\n        ForkJoinTask<?> prevJoin = w.currentJoin;  //Workerjoin\n        U.putOrderedObject(w, QCURRENTJOIN, task);  //currentJoin\n        //CountedCompleter\n        CountedCompleter<?> cc = (task instanceof CountedCompleter) ?\n                (CountedCompleter<?>) task : null;\n        for (; ; ) {\n            if ((s = task.status) < 0)  //|| \n                break;\n\n            if (cc != null)//CountedCompleterhelpCompletejoin\n                helpComplete(w, cc, 0);\n            else if (w.base == w.top || w.tryRemoveAndExec(task))  //\n                helpStealer(w, task);  //\n\n            if ((s = task.status) < 0) //||\n                break;\n            //\n            long ms, ns;\n            if (deadline == 0L)\n                ms = 0L;\n            else if ((ns = deadline - System.nanoTime()) <= 0L)\n                break;\n            else if ((ms = TimeUnit.NANOSECONDS.toMillis(ns)) <= 0L)\n                ms = 1L;\n\n            if (tryCompensate(w)) {//\n                task.internalWait(ms);//\n                U.getAndAddLong(this, CTL, AC_UNIT);//\n            }\n        }\n        U.putOrderedObject(w, QCURRENTJOIN, prevJoin);//join\n    }\n    return s;\n}\n\n\n:  join Workertop join :\n\n * awaitJoinjoincurrentJoinjoin\n\n * :\n   \n   * (task.status < 0)|| s\n   *  CountedCompleter helpCompletejoin(CountedCompleter)\n   *  CountedCompleter WorkQueue.tryRemoveAndExec\n   *  WorkQueue helpStealer()\n   * (task.status < 0)\n   * tryCompensate WorkQueue  |unstable|WorkerForkJoinTask.internalWait()ForkJoinTask.internalWait():\n   \n   final void internalWait(long timeout) {\n       int s;\n       if ((s = status) >= 0 && // force completer to issue notify\n           U.compareAndSwapInt(this, STATUS, s, s | SIGNAL)) {//SIGNAL()\n           synchronized (this) {\n               if (status >= 0)\n                   try { wait(timeout); } catch (InterruptedException ie) { }\n               else\n                   notifyAll();\n           }\n       }\n   }\n   \n\nawaitJoin: tryRemoveAndExechelpStealertryCompensate\n\n# WorkQueue.tryRemoveAndExec(ForkJoinTask<?> task)\n\nfinal boolean tryRemoveAndExec(ForkJoinTask<?> task) {\n    ForkJoinTask<?>[] a;\n    int m, s, b, n;\n    if ((a = array) != null && (m = a.length - 1) >= 0 &&\n            task != null) {\n        while ((n = (s = top) - (b = base)) > 0) {\n            //top\n            for (ForkJoinTask<?> t; ; ) {      // traverse from s to b\n                long j = ((--s & m) << ASHIFT) + ABASE;//\n                if ((t = (ForkJoinTask<?>) U.getObject(a, j)) == null) //\n                    return s + 1 == top;     // shorter than expected\n                else if (t == task) { //\n                    boolean removed = false;\n                    if (s + 1 == top) {      // pop\n                        if (U.compareAndSwapObject(a, j, task, null)) { //\n                            U.putOrderedInt(this, QTOP, s); //top\n                            removed = true;\n                        }\n                    } else if (base == b)      // replace with proxy\n                        removed = U.compareAndSwapObject(\n                                a, j, task, new EmptyTask()); //join\n                    if (removed)\n                        task.doExec(); //\n                    break;\n                } else if (t.status < 0 && s + 1 == top) { //top\n                    if (U.compareAndSwapObject(a, j, t, null)) //\n                        U.putOrderedInt(this, QTOP, s);//top\n                    break;                  // was cancelled\n                }\n                if (--n == 0) //\n                    return false;\n            }\n            if (task.status < 0) //\n                return false;\n        }\n    }\n    return true;\n}\n\n\n: top Worker : truefalse\n\n# ForkJoinPool.helpStealer(WorkQueue w, ForkJoinTask<?> task)\n\nprivate void helpStealer(WorkQueue w, ForkJoinTask<?> task) {\n    WorkQueue[] ws = workQueues;\n    int oldSum = 0, checkSum, m;\n    if (ws != null && (m = ws.length - 1) >= 0 && w != null &&\n            task != null) {\n        do {                                       // restart point\n            checkSum = 0;                          // for stability check\n            ForkJoinTask<?> subtask;\n            WorkQueue j = w, v;                    // v is subtask stealer\n            descent:\n            for (subtask = task; subtask.status >= 0; ) {\n                //1. WorkQueuev\n                for (int h = j.hint | 1, k = 0, i; ; k += 2) {//Worker\n                    if (k > m)                     // can\'t find stealer\n                        break descent;\n                    if ((v = ws[i = (h + k) & m]) != null) {\n                        if (v.currentSteal == subtask) {//\n                            j.hint = i;//stealer\n                            break;\n                        }\n                        checkSum += v.base;\n                    }\n                }\n                //2. v\n                for (; ; ) {                         // help v or descend\n                    ForkJoinTask<?>[] a;            //\n                    int b;\n                    checkSum += (b = v.base);\n                    ForkJoinTask<?> next = v.currentJoin;//join\n                    if (subtask.status < 0 || j.currentJoin != subtask ||\n                            v.currentSteal != subtask) // stale\n                        break descent; // staledescent\n                    if (b - v.top >= 0 || (a = v.array) == null) {\n                        if ((subtask = next) == null)   //joinnulldescent\n                            break descent;\n                        j = v;\n                        break; //\n                    }\n                    int i = (((a.length - 1) & b) << ASHIFT) + ABASE;//base\n                    ForkJoinTask<?> t = ((ForkJoinTask<?>)\n                            U.getObjectVolatile(a, i));//base\n                    if (v.base == b) {\n                        if (t == null)             // stale\n                            break descent; // staledescent\n                        if (U.compareAndSwapObject(a, i, t, null)) {//\n                            v.base = b + 1;         //base\n                            ForkJoinTask<?> ps = w.currentSteal;//\n                            int top = w.top;\n                            //workQueuecurrentStealbase\n                            //topworkQueue\n                            // (LIFO)->currentSteal->()\n                            do {\n                                U.putOrderedObject(w, QCURRENTSTEAL, t);\n                                t.doExec();        // clear local tasks too\n                            } while (task.status >= 0 &&\n                                    w.top != top && //\n                                    (t = w.pop()) != null);\n                            U.putOrderedObject(w, QCURRENTSTEAL, ps);//workQueuecurrentSteal\n                            if (w.base != w.top)//workQueue\n                                return;            // can\'t further help\n                        }\n                    }\n                }\n            }\n        } while (task.status >= 0 && oldSum != (oldSum = checkSum));\n    }\n}\n\n\n: :  :\n\nWorker WorkQueue hint base(w.top != top)(LIFO)()\n\n# ForkJoinPool.tryCompensate(WorkQueue w)\n\n//: \nprivate boolean tryCompensate(WorkQueue w) {\n    boolean canBlock;\n    WorkQueue[] ws;\n    long c;\n    int m, pc, sp;\n    if (w == null || w.qlock < 0 ||           // caller terminating\n            (ws = workQueues) == null || (m = ws.length - 1) <= 0 ||\n            (pc = config & SMASK) == 0)           // parallelism disabled\n        canBlock = false; //\n    else if ((sp = (int) (c = ctl)) != 0)      // release idle worker\n        canBlock = tryRelease(c, ws[sp & m], 0L);//\n    else {//\n        int ac = (int) (c >> AC_SHIFT) + pc; //\n        int tc = (short) (c >> TC_SHIFT) + pc;//\n        int nbusy = 0;                        // validate saturation\n        for (int i = 0; i <= m; ++i) {        // two passes of odd indices\n            WorkQueue v;\n            if ((v = ws[((i << 1) | 1) & m]) != null) {//\n                if ((v.scanState & SCANNING) != 0)//\n                    break;\n                ++nbusy;//\n            }\n        }\n        if (nbusy != (tc << 1) || ctl != c)\n            canBlock = false;                 // unstable or stale\n        else if (tc >= pc && ac > 1 && w.isEmpty()) {// && 1 && \n            long nc = ((AC_MASK & (c - AC_UNIT)) |\n                    (~AC_MASK & c));       // uncompensated\n            canBlock = U.compareAndSwapLong(this, CTL, c, nc);//\n        } else if (tc >= MAX_CAP ||\n                (this == common && tc >= pc + commonMaxSpares))//\n            throw new RejectedExecutionException(\n                    "Thread limit exceeded replacing blocked worker");\n        else {                                // similar to tryAddWorker\n            boolean add = false;\n            int rs;      // CAS within lock\n            long nc = ((AC_MASK & c) |\n                    (TC_MASK & (c + TC_UNIT)));//\n            if (((rs = lockRunState()) & STOP) == 0)\n                add = U.compareAndSwapLong(this, CTL, c, nc);//\n            unlockRunState(rs, rs & ~RSLOCK);\n            //\n            canBlock = add && createWorker(); // throws on exception\n        }\n    }\n    return canBlock;\n}\n\n\n: :\n\n :\n\n * (tryRelease)\n * (createWorker)\n\n :\n\n * \n *  && 1 && \n\n\n# Fork/Join\n\nFork/Join,  :\n\n\n# fork()\n\nfork()\n\nfork()join()compute()compute()()\n\n> invokeAllfork()\n\n\n# fork()compute()join()\n\n\n\nright.fork(); // \nlong leftAns = left.compute(); // ()\nlong rightAns = right.join(); // \nreturn leftAns + rightAns;\n\n\n:\n\nleft.fork(); // \nlong leftAns = left.join(); // \nlong rightAns = right.compute(); // \nreturn leftAns + rightAns;\n\n\n\n\nlong rightAns = right.compute(); // \nleft.fork(); // \nlong leftAns = left.join(); // \nreturn leftAns + rightAns;\n\n\n\n\n\n# \n\n()Fork/Join: fork()\n\n: 100~10000\n\n> JavaFork/JoinJIT(Just-in-time)\n\n\n# \n\nFork/JoinListSystem.arraycopy\n\n\n# \n\n\n# JDKFork/Join?\n\n Arrays JDK 8(parallelSort) ForkJoinPool  ConcurrentHashMap JDK 8(forEach)\n\n\n# ExecutorsForkJoinPool\n\nJava8Executors:\n\n// parallelism\npublic static ExecutorService newWorkStealingPool(int parallelism);\n// JVM\n// Runtime.getRuntime().availableProcessors()\npublic static ExecutorService newWorkStealingPool();\n\n\n\n# Fork/Join\n\nJavaForkJoinTaskinvoke()join()get()ExecutionException\n\nForkJoinTask\n\nstatic void rethrow(Throwable ex) {\n    if (ex != null)\n        ForkJoinTask.<RuntimeException>uncheckedThrow(ex);\n}\n\n@SuppressWarnings("unchecked")\nstatic <T extends Throwable> void uncheckedThrow(Throwable t) throws T {\n    throw (T)t; // rely on vacuous cast\n}\n\n\nJava10JVMJava: \n\ninvokejoin()ForkJoinTaskquietlyInvoke()quietlyJoin()\n\nquitelyInvoke()quietlyJoin()isCompletedAbnormally()isCompletedNormally()\n\n\n# Fork/Join\n\n\n# Fork/Join1+2+3++10000\n\npublic class Test {\n\tstatic final class SumTask extends RecursiveTask<Integer> {\n\t\tprivate static final long serialVersionUID = 1L;\n\t\t\n\t\tfinal int start; //\n\t\tfinal int end; //\n\t\t\n\t\tSumTask(int start, int end) {\n\t\t\tthis.start = start;\n\t\t\tthis.end = end;\n\t\t}\n\n\t\t@Override\n\t\tprotected Integer compute() {\n\t\t\t//1000if\n\t\t\tif(end - start < 1000) {\n\t\t\t\tSystem.out.println(Thread.currentThread().getName() + " : " + start + "-" + end);\n\t\t\t\tint sum = 0;\n\t\t\t\tfor(int i = start; i <= end; i++)\n\t\t\t\t\tsum += i;\n\t\t\t\treturn sum;\n\t\t\t}\n\t\t\t//1000\n\t\t\tSumTask task1 = new SumTask(start, (start + end) / 2);\n\t\t\tSumTask task2 = new SumTask((start + end) / 2 + 1, end);\n\t\t\t//\n\t\t\ttask1.fork();\n\t\t\ttask2.fork();\n\t\t\t//\n\t\t\treturn task1.join() + task2.join();\n\t\t}\n\t}\n\t\n\tpublic static void main(String[] args) throws InterruptedException, ExecutionException {\n\t\tForkJoinPool pool = new ForkJoinPool();\n\t\tForkJoinTask<Integer> task = new SumTask(1, 10000);\n\t\tpool.submit(task);\n\t\tSystem.out.println(task.get());\n\t}\n}\n\n\n * \n\nForkJoinPool-1-worker-1 : 1-625\nForkJoinPool-1-worker-7 : 6251-6875\nForkJoinPool-1-worker-6 : 5626-6250\nForkJoinPool-1-worker-10 : 3751-4375\nForkJoinPool-1-worker-13 : 2501-3125\nForkJoinPool-1-worker-8 : 626-1250\nForkJoinPool-1-worker-11 : 5001-5625\nForkJoinPool-1-worker-3 : 7501-8125\nForkJoinPool-1-worker-14 : 1251-1875\nForkJoinPool-1-worker-4 : 9376-10000\nForkJoinPool-1-worker-8 : 8126-8750\nForkJoinPool-1-worker-0 : 1876-2500\nForkJoinPool-1-worker-12 : 4376-5000\nForkJoinPool-1-worker-5 : 8751-9375\nForkJoinPool-1-worker-7 : 6876-7500\nForkJoinPool-1-worker-1 : 3126-3750\n50005000\n\n\n\n# \n\n> : 112358132134  : F(1)=1F(2)=1, F(n)=F(n-1)+F(n-2)(n>=3nN*)\n\npublic static void main(String[] args) {\n    ForkJoinPool forkJoinPool = new ForkJoinPool(4); // 4\n    Fibonacci fibonacci = new Fibonacci(20);\n    long startTime = System.currentTimeMillis();\n    Integer result = forkJoinPool.invoke(fibonacci);\n    long endTime = System.currentTimeMillis();\n    System.out.println("Fork/join sum: " + result + " in " + (endTime - startTime) + " ms.");\n}\n//API\nstatic  class Fibonacci extends RecursiveTask<Integer> {\n    final int n;\n    Fibonacci(int n) {\n        this.n = n;\n    }\n    @Override\n    protected Integer compute() {\n        if (n <= 1) {\n            return n;\n        }\n        Fibonacci f1 = new Fibonacci(n - 1);\n        f1.fork(); \n        Fibonacci f2 = new Fibonacci(n - 2);\n        return f2.compute() + f1.join(); \n    }\n}\n\n\nforkforkf1.fork()f2.fork() f2.join()f1.join()\n\nAPIinvokeAllinvokeAllfork\n\n{\n    // ...\n    Fibonacci f1 = new Fibonacci(n - 1);\n    Fibonacci f2 = new Fibonacci(n - 2);\n    invokeAll(f1,f2);\n    return f2.join() + f1.join();\n}\n\npublic static void invokeAll(ForkJoinTask<?>... tasks) {\n    Throwable ex = null;\n    int last = tasks.length - 1;\n    for (int i = last; i >= 0; --i) {\n        ForkJoinTask<?> t = tasks[i];\n        if (t == null) {\n            if (ex == null)\n                ex = new NullPointerException();\n        }\n        else if (i != 0)   //fork\n            t.fork();\n        else if (t.doInvoke() < NORMAL && ex == null)  //\n            ex = t.getException();\n    }\n    for (int i = 1; i <= last; ++i) {\n        ForkJoinTask<?> t = tasks[i];\n        if (t != null) {\n            if (ex != null)\n                t.cancel(false);\n            else if (t.doJoin() < NORMAL)\n                ex = t.getException();\n        }\n    }\n    if (ex != null)\n        rethrow(ex);\n}\n\n\n\n\n# \n\n * ForkJoinPoolDoug LeaA Java Fork/Join Framework\n * bagwellhttps://www.jianshu.com/p/32a15ef2f1bfhttps://www.jianshu.com/p/6a14d0b54b8d\n * https://blog.csdn.net/u010841296/article/details/83963637\n * https://blog.csdn.net/Holmofy/article/details/82714665\n * https://blog.csdn.net/abc123lzf/article/details/82873181\n * https://blog.csdn.net/yinwenjie/article/details/71524140\n * https://blog.csdn.net/cowbin2012/article/details/89791757\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-ForkJoinPool.html',normalizedContent:'# juc: fork/join\n\n> forkjoinpool jdk 7fork/join (divide-and-conquer)\n\n * juc: fork/join\n   * batfork/join\n   * fork/join\n     * \n     * : (divide-and-conquer)\n     * : work-stealing()\n     * fork/join \n   * fork/join\n     * forkjoinpool\n     * forkjointask\n   * fork/join\n     * forkjoinpool\n       * \n       * forkjoinpool.workqueue :\n     * forkjointask\n       * \n   * fork/join\n     * \n     *  - (external/submissions task)\n       * externalpush(forkjointask<?> task)\n       * externalsubmit(forkjointask<?> task)\n       * signalwork(workqueue[] ws, workqueue q)\n       * tryaddworker(long c)\n       * createworker()\n       * registerworker()\n       * \n     * : (worker task)\n       * forkjointask.fork()\n       * forkjoinpool.workqueue.push()\n       * \n     * : \n       * forkjoinworkerthread.run()\n       * forkjoinpool.runworker(workqueue w)\n       * forkjoinpool.scan(workqueue w, int r)\n       * forkjoinpool.awaitwork(workqueue w, int r)\n       * workqueue.runtask()\n       * forkjoinpool.deregisterworker(forkjoinworkerthread wt, throwable ex)\n       * \n     *  - forkjointask.join() / forkjointask.invoke()\n       * forkjointask.externalawaitdone()\n       * forkjoinpool.awaitjoin()\n       * workqueue.tryremoveandexec(forkjointask<?> task)\n       * forkjoinpool.helpstealer(workqueue w, forkjointask<?> task)\n       * forkjoinpool.trycompensate(workqueue w)\n   * fork/join\n     * fork()\n     * fork()compute()join()\n     * \n     * \n   * \n     * jdkfork/join?\n     * executorsforkjoinpool\n     * fork/join\n   * fork/join\n     * fork/join1+2+3++10000\n     * \n   * \n\n\n# batfork/join\n\n\n\nfork/join\n\n * fork/join?\n * fork/joinjdk?\n * fork/join? ?\n * forkjoinpool?\n * forkjointask?  recursivetask recursiveaction  countedcompleter  forkjointask \n * fork/join /?\n * fork/joinwork-stealing ?\n * jdkfork/join?\n * executorsforkjoinpool?\n * : forkjoin1+2+3+...+100000?\n * fork/join? jdk\n\n\n# fork/join\n\nfork/joinjavajdk1.7\n\n\n# \n\nfork/join:\n\n * : forkjointask (recursivetaskrecursiveaction  countedcompleter)\n * fork/join: forkjoinworkerthread\n * : forkjoinpool\n\n: forkjoinpoolforkjoinworkerthreadforkjointask\n\n// from a java fork/join frameworkdong lea\nresult solve(problem problem) {\n\tif (problem is small)\n \t\tdirectly solve problem\n \telse {\n \t\tsplit problem into independent parts\n \t\tfork new subtasks to solve each part\n \t\tjoin all subtasks\n \t\tcompose result from subresults\n\t}\n}\n\n\nforkjoinpool  forkjointask ( runnable/callable  forkjointask )recursivetask  forkjointask  forkjointaskrecursiveaction  recursivetaskcountedcompleter \n\n recursivetask recursiveaction  countedcompleter  forkjointask \n\n\n# : (divide-and-conquer)\n\n(divide-and-conquer) fork/join :\n\n\n\n * :  - \n\n\n# : work-stealing()\n\nwork-stealing(): () forkjoinpool  forkjoinpool (join)\n\n forkjoinpool (forkjoinworkerthread)(workqueue)(lifofifo mode )fifo\n\n:\n\n * workqueue\n * pushpoppoll\n * push/poppoll\n * forkpush\n * \n * poll\n\n\n\n\n# fork/join \n\nforkjoinpool :\n\n *  fjp (external/submissions task) workqueues \n *  fork (worker task) workqueues \n\nfork/join ?\n\n\n\n> \n\n\n# fork/join\n\n\n# forkjoinpool\n\n\n\n:\n\n * forkjoinworkerthreadfactory: forkjoinworkerthread\n\n * defaultforkjoinworkerthreadfactory: forkjoinworkerthreadfactory \n\n * innocuousforkjoinworkerthreadfactory:  forkjoinworkerthreadfactory\n\n * emptytask:  join \n\n * managedblocker:  forkjoinpool ( phaser  phase generation)\n\n * workqueue: forkjoinpool work-stealing  forkjointask  @contented \n   \n   * ( fork()) workqueue (top ) lifo \n   * ( pool ) workqueue  fifo (base)\n\n * : (cache line)232-25664\n\n\n# forkjointask\n\n\n\nforkjointask  future forkjointask  future fork  join  exceptionnode  runnable/callable  runnable/callable  forkjointask ( forkjoinpool  forkjointask )\n\n\n# fork/join\n\n> : 4:\n\n *  - (external/submissions task)\n *  - (worker task)\n * (forkjoinworkerthread.run()forkjointask.doexec())\n * (forkjointask.join()forkjointask.invoke())\n\n\n# forkjoinpool\n\n# \n\n\n\n(uc_mask & (c + ac_unit)) | (sp_mask & c)c  ctluc_mask  sp_mask ac_unit (uc_mask & (c + ac_unit))3232(sp_mask & c)ctl\n\n\n\nforkjoinpool   workqueue :\n\n// constants shared across forkjoinpool and workqueue\n\n// \nstatic final int smask = 0xffff;        //  \nstatic final int max_cap = 0x7fff;        //  \nstatic final int evenmask = 0xfffe;        //  \nstatic final int sqmask = 0x007e;        //  workqueues 64\n\n// ctl  workqueue.scanstate \nstatic final int scanning = 1;             // \nstatic final int inactive = 1 << 31;       //   \nstatic final int ss_seq = 1 << 16;       // aba\n\n// forkjoinpool.config  workqueue.config \nstatic final int mode_mask = 0xffff << 16;  // \nstatic final int lifo_queue = 0; //lifo\nstatic final int fifo_queue = 1 << 16;//fifo\nstatic final int shared_queue = 1 << 31;       // \n\n\nforkjoinpool :\n\n//  \nprivate static final long sp_mask = 0xffffffffl;\nprivate static final long uc_mask = ~sp_mask;\n\n// \nprivate static final int ac_shift = 48;\nprivate static final long ac_unit = 0x0001l << ac_shift; //\nprivate static final long ac_mask = 0xffffl << ac_shift; //\n\n// \nprivate static final int tc_shift = 32;\nprivate static final long tc_unit = 0x0001l << tc_shift; //\nprivate static final long tc_mask = 0xffffl << tc_shift; //\nprivate static final long add_worker = 0x0001l << (tc_shift + 15);  // \n\n// \nprivate static final int rslock = 1;\nprivate static final int rsignal = 1 << 1;\nprivate static final int started = 1 << 2;\nprivate static final int stop = 1 << 29;\nprivate static final int terminated = 1 << 30;\nprivate static final int shutdown = 1 << 31;\n\n// \nvolatile long ctl;                   // \nvolatile int runstate;               // \nfinal int config;                    // |\nint indexseed;                       // \nvolatile workqueue[] workqueues;     // workqueue\nfinal forkjoinworkerthreadfactory factory;// \nfinal uncaughtexceptionhandler ueh;  // \nfinal string workernameprefix;       // \nvolatile atomiclong stealcounter;    // \n\n/**  */\n//\npublic static final forkjoinworkerthreadfactory defaultforkjoinworkerthreadfactory;\n//\nprivate static final runtimepermission modifythreadpermission;\n// pool\nstatic final forkjoinpool common;\n//common\nstatic final int commonparallelism;\n//trycompensate\nprivate static int commonmaxspares;\n//workernameprefix()\nprivate static int poolnumbersequence;\n//()2\nprivate static final long idle_timeout = 2000l * 1000l * 1000l; // 2sec\n//timer\nprivate static final long timeout_slop = 20l * 1000l * 1000l;  // 20ms\n//\nprivate static final int default_common_max_spares = 256;\n//awaitrunstatelockawaitwork\nprivate static final int spins  = 0;\n//indexseed\nprivate static final int seed_increment = 0x9e3779b9;\n\n\n: forkjoinpool 64 long  ctl16:\n\n * ac: 16\n * tc: 16\n * ss: 16\n * id:  workqueue (poolindex)16\n\nctl32(sp=(int)ctl)sp0\n\n# forkjoinpool.workqueue :\n\n//2\nstatic final int initial_queue_capacity = 1 << 13;\n//\nstatic final int maximum_queue_capacity = 1 << 26; // 64m\n\n// \nvolatile int scanstate;    // woker, <0: inactive; odd:scanning\nint stackpred;             // ctl\nint nsteals;               // \nint hint;                  // \nint config;                // \nvolatile int qlock;        // 1: locked, < 0: terminate; else 0\nvolatile int base;         //poll(/)\nint top;                   //  push(/)\nforkjointask<?>[] array;   // \nfinal forkjoinpool pool;   // the containing pool (may be null)\nfinal forkjoinworkerthread owner; // null\nvolatile thread parker;    // parkownernull\nvolatile forkjointask<?> currentjoin;  // join\nvolatile forkjointask<?> currentsteal; // \n\n\n\n# forkjointask\n\n# \n\n/**  */\nvolatile int status; // \nstatic final int done_mask   = 0xf0000000;  // \nstatic final int normal      = 0xf0000000;  // must be negative\nstatic final int cancelled   = 0xc0000000;  // must be < normal\nstatic final int exceptional = 0x80000000;  // must be < cancelled\nstatic final int signal      = 0x00010000;  // must be >= 1 << 16 \nstatic final int smask       = 0x0000ffff;  //  \n\n\n\n# fork/join\n\n\n# \n\npublic forkjoinpool(int parallelism,\n                    forkjoinworkerthreadfactory factory,\n                    uncaughtexceptionhandler handler,\n                    boolean asyncmode) {\n    this(checkparallelism(parallelism),\n            checkfactory(factory),\n            handler,\n            asyncmode ? fifo_queue : lifo_queue,\n            "forkjoinpool-" + nextpoolid() + "-worker-");\n    checkpermission();\n}\n\n\n:  forkjoinpool :\n\n * parallelism: cpu1\n * factory: \n * handler: null\n * asyncmode:  falsetrue fifo (join)\n\n forkjoinpool commonjdk1.8forkjoinpool.commonpool()common:\n\nprivate static forkjoinpool makecommonpool() {\n    int parallelism = -1;\n    forkjoinworkerthreadfactory factory = null;\n    uncaughtexceptionhandler handler = null;\n    try {  // ignore exceptions in accessing/parsing\n        string pp = system.getproperty\n                ("java.util.concurrent.forkjoinpool.common.parallelism");//\n        string fp = system.getproperty\n                ("java.util.concurrent.forkjoinpool.common.threadfactory");//\n        string hp = system.getproperty\n                ("java.util.concurrent.forkjoinpool.common.exceptionhandler");//\n        if (pp != null)\n            parallelism = integer.parseint(pp);\n        if (fp != null)\n            factory = ((forkjoinworkerthreadfactory) classloader.\n                    getsystemclassloader().loadclass(fp).newinstance());\n        if (hp != null)\n            handler = ((uncaughtexceptionhandler) classloader.\n                    getsystemclassloader().loadclass(hp).newinstance());\n    } catch (exception ignore) {\n    }\n    if (factory == null) {\n        if (system.getsecuritymanager() == null)\n            factory = defaultforkjoinworkerthreadfactory;\n        else // use security-managed default\n            factory = new innocuousforkjoinworkerthreadfactory();\n    }\n    if (parallelism < 0 && // default 1 less than #cores\n            (parallelism = runtime.getruntime().availableprocessors() - 1) <= 0)\n        parallelism = 1;//1\n    if (parallelism > max_cap)\n        parallelism = max_cap;\n    return new forkjoinpool(parallelism, factory, handler, lifo_queue,\n            "forkjoinpool.commonpool-worker-");\n}\n\n\ncommon pool(join)\n\n\n#  - (external/submissions task)\n\n forkjoinpool :\n\n * invoke()\n * execute()\n * submit()task.get()\n\nexternalpush()externalpush()\n\n# externalpush(forkjointask<?> task)\n\n//submission\nfinal void externalpush(forkjointask<?> task) {\n    workqueue[] ws;\n    workqueue q;\n    int m;\n    int r = threadlocalrandom.getprobe();//workqueue\n    int rs = runstate;\n    if ((ws = workqueues) != null && (m = (ws.length - 1)) >= 0 &&\n            (q = ws[m & r & sqmask]) != null && r != 0 && rs > 0 && //workqueue\n            u.compareandswapint(q, qlock, 0, 1)) {//workqueue\n        forkjointask<?>[] a;\n        int am, n, s;\n        if ((a = q.array) != null &&\n                (am = a.length - 1) > (n = (s = q.top) - q.base)) {\n            int j = ((am & s) << ashift) + abase;//\n            u.putorderedobject(a, j, task);//\n            u.putorderedint(q, qtop, s + 1);//push slot\n            u.putintvolatile(q, qlock, 0);//\n            if (n <= 1)\n                signalwork(ws, q);//1\n            return;\n        }\n        u.compareandswapint(q, qlock, 1, 0);//\n    }\n    externalsubmit(task);//workqueues\n}\n\n\nexternalpushexternalsubmit: externalsubmitexternalpushworkqueuesexternalsubmitexternalsubmit-externalpush\n\nexternalpush:  workqueue workqueue top1(externalsubmit)\n\n# externalsubmit(forkjointask<?> task)\n\n//\nprivate void externalsubmit(forkjointask<?> task) {\n    //workqueue\n    int r;                                    // initialize caller\'s probe\n    if ((r = threadlocalrandom.getprobe()) == 0) {\n        threadlocalrandom.localinit();\n        r = threadlocalrandom.getprobe();\n    }\n    for (; ; ) {\n        workqueue[] ws;\n        workqueue q;\n        int rs, m, k;\n        boolean move = false;\n        if ((rs = runstate) < 0) {// \n            tryterminate(false, false);     // help terminate\n            throw new rejectedexecutionexception();\n        }\n        //workqueues\n        else if ((rs & started) == 0 ||     // initialize\n                ((ws = workqueues) == null || (m = ws.length - 1) < 0)) {\n            int ns = 0;\n            rs = lockrunstate();//runstate\n            try {\n                //\n                if ((rs & started) == 0) {\n                    //stealcounter\n                    u.compareandswapobject(this, stealcounter, null,\n                            new atomiclong());\n                    //workqueues2\n                    // create workqueues array with size a power of two\n                    int p = config & smask; // ensure at least 2 slots\n                    int n = (p > 1) ? p - 1 : 1;\n                    n |= n >>> 1;\n                    n |= n >>> 2;\n                    n |= n >>> 4;\n                    n |= n >>> 8;\n                    n |= n >>> 16;\n                    n = (n + 1) << 1;\n                    workqueues = new workqueue[n];\n                    ns = started;\n                }\n            } finally {\n                unlockrunstate(rs, (rs & ~rslock) | ns);//runstate\n            }\n        } else if ((q = ws[k = r & m & sqmask]) != null) {//workqueue\n            if (q.qlock == 0 && u.compareandswapint(q, qlock, 0, 1)) {// workqueue\n                forkjointask<?>[] a = q.array;//workqueue\n                int s = q.top;\n                boolean submitted = false; // initial submission or resizing\n                try {                      // locked version of push\n                    if ((a != null && a.length > s + 1 - q.base) ||\n                            (a = q.growarray()) != null) {//\n                        int j = (((a.length - 1) & s) << ashift) + abase;\n                        u.putorderedobject(a, j, task);//\n                        u.putorderedint(q, qtop, s + 1);//push slot\n                        submitted = true;\n                    }\n                } finally {\n                    u.compareandswapint(q, qlock, 1, 0);//\n                }\n                if (submitted) {//\n                    signalwork(ws, q);//\n                    return;\n                }\n            }\n            move = true;                   // move on failure \n        } else if (((rs = runstate) & rslock) == 0) { // create new queue\n            q = new workqueue(this, null);\n            q.hint = r;\n            q.config = k | shared_queue;\n            q.scanstate = inactive;\n            rs = lockrunstate();           // publish index\n            if (rs > 0 && (ws = workqueues) != null &&\n                    k < ws.length && ws[k] == null)\n                ws[k] = q;                 // kworkqueue\n            //else terminated\n            unlockrunstate(rs, rs & ~rslock);\n        } else\n            move = true;                   // move if busy\n        if (move)\n            r = threadlocalrandom.advanceprobe(r);//\n    }\n}\n\n\n: externalsubmitexternalpushworkqueues:\n\n * (runstate<0)tryterminate\n *  fjp : stealcounterworkerqueues\n * externalpush:  workqueuesignalwork\n * 3 workqueue null workqueue\n * \n\n# signalwork(workqueue[] ws, workqueue q)\n\nfinal void signalwork(workqueue[] ws, workqueue q) {\n    long c;\n    int sp, i;\n    workqueue v;\n    thread p;\n    while ((c = ctl) < 0l) {                       // too few active\n        if ((sp = (int) c) == 0) {                  // no idle workers\n            if ((c & add_worker) != 0l)            // too few workers\n                tryaddworker(c);//\n            break;\n        }\n        if (ws == null)                            // unstarted/terminated\n            break;\n        if (ws.length <= (i = sp & smask))         // terminated\n            break;\n        if ((v = ws[i]) == null)                   // terminating\n            break;\n        //ctlss_seqaba\n        int vs = (sp + ss_seq) & ~inactive;        // next scanstate\n        int d = sp - v.scanstate;                  // screen cas\n        //(32)scanstate(32)\n        long nc = (uc_mask & (c + ac_unit)) | (sp_mask & v.stackpred);\n        if (d == 0 && u.compareandswaplong(this, ctl, c, nc)) {\n            v.scanstate = vs;                      // activate v\n            if ((p = v.parker) != null)\n                u.unpark(p);//\n            break;\n        }\n        if (q != null && q.base == q.top)          // no more work\n            break;\n    }\n}\n\n\n: externalpushexternalsubmitworkqueue.pushscan workqueue parker((ctl & add_worker) != 0l)tryaddworker\n\n# tryaddworker(long c)\n\nprivate void tryaddworker(long c) {\n    boolean add = false;\n    do {\n        long nc = ((ac_mask & (c + ac_unit)) |\n                   (tc_mask & (c + tc_unit)));\n        if (ctl == c) {\n            int rs, stop;                 // check if terminating\n            if ((stop = (rs = lockrunstate()) & stop) == 0)\n                add = u.compareandswaplong(this, ctl, c, nc);\n            unlockrunstate(rs, rs & ~rslock);//\n            if (stop != 0)\n                break;\n            if (add) {\n                createworker();//\n                break;\n            }\n        }\n    } while (((c = ctl) & add_worker) != 0l && (int)c == 0);\n}\n\n\n: ctlcreateworker()\n\n# createworker()\n\nprivate boolean createworker() {\n    forkjoinworkerthreadfactory fac = factory;\n    throwable ex = null;\n    forkjoinworkerthread wt = null;\n    try {\n        if (fac != null && (wt = fac.newthread(this)) != null) {\n            wt.start();\n            return true;\n        }\n    } catch (throwable rex) {\n        ex = rex;\n    }\n    deregisterworker(wt, ex);//\n    return false;\n}\n\n\n: createworkerforkjoinworkerthread(wt.start())deregisterworker(deregisterworker)\n\nforkjoinworkerthread :\n\nprotected forkjoinworkerthread(forkjoinpool pool) {\n    // use a placeholder until a useful name can be set in registerworker\n    super("aforkjoinworkerthread");\n    this.pool = pool;\n    this.workqueue = pool.registerworker(this);\n}\n\n\n forkjoinworkerthread  thread poolworkqueueworkqueueforkjoinpool.registerworker\n\n# registerworker()\n\nfinal workqueue registerworker(forkjoinworkerthread wt) {\n    uncaughtexceptionhandler handler;\n    //\n    wt.setdaemon(true);                           // configure thread\n    if ((handler = ueh) != null)\n        wt.setuncaughtexceptionhandler(handler);\n    workqueue w = new workqueue(this, wt);//workqueue\n    int i = 0;                                    // assign a pool index\n    int mode = config & mode_mask;\n    int rs = lockrunstate();\n    try {\n        workqueue[] ws;\n        int n;                    // skip if no array\n        if ((ws = workqueues) != null && (n = ws.length) > 0) {\n            //workqueue\n            int s = indexseed += seed_increment;  // unlikely to collide\n            int m = n - 1;\n            i = ((s << 1) | 1) & m;               // worker odd-numbered indices\n            if (ws[i] != null) {                  // collision \n                int probes = 0;                   // step by approx half n\n                int step = (n <= 4) ? 2 : ((n >>> 1) & evenmask) + 2;\n                //\n                while (ws[i = (i + step) & m] != null) {\n                    if (++probes >= n) {//workqueues\n                        workqueues = ws = arrays.copyof(ws, n <<= 1);//workqueues \n                        m = n - 1;\n                        probes = 0;\n                    }\n                }\n            }\n            w.hint = s;                           // use as random seed\n            w.config = i | mode;\n            w.scanstate = i;                      // publication fence\n            ws[i] = w;\n        }\n    } finally {\n        unlockrunstate(rs, rs & ~rslock);\n    }\n    wt.setname(workernameprefix.concat(integer.tostring(i >>> 1)));\n    return w;\n}\n\n\n: registerworker forkjoinworkerthread  workqueue workqueue (: i = ((s << 1) | 1) & m;)\n\n# \n\nokcreateworker()(wt.start())cpu forkjoinworkerthread run\n\n\n# : (worker task)\n\nfork()(fork)forkjoinpool.workqueue.push()\n\n# forkjointask.fork()\n\npublic final forkjointask<v> fork() {\n    thread t;\n    if ((t = thread.currentthread()) instanceof forkjoinworkerthread)\n        ((forkjoinworkerthread)t).workqueue.push(this);\n    else\n        forkjoinpool.common.externalpush(this);\n    return this;\n}\n\n\n:  worker forkforkjoinpool.workqueue.push()forkjoinpool.externalpush()()\n\n# forkjoinpool.workqueue.push()\n\nfinal void push(forkjointask<?> task) {\n    forkjointask<?>[] a;\n    forkjoinpool p;\n    int b = base, s = top, n;\n    if ((a = array) != null) {    // ignore if queue removed\n        int m = a.length - 1;     // fenced write for task visibility\n        u.putorderedobject(a, ((m & s) << ashift) + abase, task);\n        u.putorderedint(this, qtop, s + 1);\n        if ((n = s - b) <= 1) {//\n            if ((p = pool) != null)\n                p.signalwork(p.workqueues, this);\n        } else if (n >= m)\n            growarray();\n    }\n}\n\n\n: top workqueue (top-base<=1)signalwork workqueue  workqueue growarray()growarray():\n\nfinal forkjointask<?>[] growarray() {\n    forkjointask<?>[] olda = array;//\n    int size = olda != null ? olda.length << 1 : initial_queue_capacity;\n    if (size > maximum_queue_capacity)\n        throw new rejectedexecutionexception("queue capacity exceeded");\n    int oldmask, t, b;\n    //\n    forkjointask<?>[] a = array = new forkjointask<?>[size];\n    if (olda != null && (oldmask = olda.length - 1) >= 0 &&\n            (t = top) - (b = base) > 0) {\n        int mask = size - 1;\n        //\n        do { // emulate poll from old array, push to new array\n            forkjointask<?> x;\n            int oldj = ((b & oldmask) << ashift) + abase;\n            int j = ((b & mask) << ashift) + abase;\n            x = (forkjointask<?>) u.getobjectvolatile(olda, oldj);\n            if (x != null &&\n                    u.compareandswapobject(olda, oldj, x, null))\n                u.putobjectvolatile(a, j, x);\n        } while (++b != t);\n    }\n    return a;\n}\n\n\n# \n\n\n\n\n# : \n\nforkjoinpool .createworker()cpu forkjoinworkerthread run()\n\n# forkjoinworkerthread.run()\n\npublic void run() {\n    if (workqueue.array == null) { // only run once\n        throwable exception = null;\n        try {\n            onstart();//\n            pool.runworker(workqueue);\n        } catch (throwable ex) {\n            exception = ex;\n        } finally {\n            try {\n                ontermination(exception);//\n            } catch (throwable ex) {\n                if (exception == null)\n                    exception = ex;\n            } finally {\n                pool.deregisterworker(this, exception);//\n            }\n        }\n    }\n}\n\n\n: (onstartontermination)forkjoinpool.runworker()forkjoinpool.deregisterworker(deregisterworker)\n\n# forkjoinpool.runworker(workqueue w)\n\nfinal void runworker(workqueue w) {\n    w.growarray();                   // allocate queue\n    int seed = w.hint;               // initially holds randomization hint\n    int r = (seed == 0) ? 1 : seed;  // avoid 0 for xorshift\n    for (forkjointask<?> t; ; ) {\n        if ((t = scan(w, r)) != null)//\n            w.runtask(t);\n        else if (!awaitwork(w, r))\n            break;\n        r ^= r << 13;\n        r ^= r >>> 17;\n        r ^= r << 5; // xorshift\n    }\n}\n\n\n: runworker forkjoinworkerthread : scanworkqueue .runtaskawaitwork/\n\n# forkjoinpool.scan(workqueue w, int r)\n\nprivate forkjointask<?> scan(workqueue w, int r) {\n    workqueue[] ws;\n    int m;\n    if ((ws = workqueues) != null && (m = ws.length - 1) > 0 && w != null) {\n        int ss = w.scanstate;                     // initially non-negative\n        //\n        for (int origin = r & m, k = origin, oldsum = 0, checksum = 0; ; ) {\n            workqueue q;\n            forkjointask<?>[] a;\n            forkjointask<?> t;\n            int b, n;\n            long c;\n            if ((q = ws[k]) != null) {//workqueue\n                if ((n = (b = q.base) - q.top) < 0 &&\n                        (a = q.array) != null) {      // non-empty\n                    //\n                    long i = (((a.length - 1) & b) << ashift) + abase;\n                    if ((t = ((forkjointask<?>)\n                            u.getobjectvolatile(a, i))) != null && //base\n                            q.base == b) {//stable\n                        if (ss >= 0) {  //scanning\n                            if (u.compareandswapobject(a, i, t, null)) {//\n                                q.base = b + 1;//base\n                                if (n < -1)       // signal others\n                                    signalwork(ws, q);//\n                                return t;\n                            }\n                        } else if (oldsum == 0 &&   // try to activate \n                                w.scanstate < 0)\n                            tryrelease(c = ctl, ws[m & (int) c], ac_unit);//\n                    }\n                    //basebase\n                    if (ss < 0)                   // refresh\n                        ss = w.scanstate;\n                    r ^= r << 1;\n                    r ^= r >>> 3;\n                    r ^= r << 10;\n                    origin = k = r & m;           // move and rescan\n                    oldsum = checksum = 0;\n                    continue;\n                }\n                checksum += b;//base\n            }\n            //k \n            if ((k = (k + 1) & m) == origin) {    // continue until stable\n                // workqueues\n\n                if ((ss >= 0 || (ss == (ss = w.scanstate))) &&\n                        oldsum == (oldsum = checksum)) {\n                    if (ss < 0 || w.qlock < 0)    // already inactive\n                        break;// ,\n\n                    //workqueue\n                    int ns = ss | inactive;       // try to inactivate\n                    long nc = ((sp_mask & ns) |\n                            (uc_mask & ((c = ctl) - ac_unit)));//ctlinactive\n                    w.stackpred = (int) c;         // hold prev stack top\n                    u.putint(w, qscanstate, ns);//scanstateinactive\n                    if (u.compareandswaplong(this, ctl, c, nc))//scanstate\n                        ss = ns;\n                    else\n                        w.scanstate = ss;         // back out\n                }\n                checksum = 0;//checksum\n            }\n        }\n    }\n    return null;\n}\n\n\n: w.hint workqueue workqueue worker\n\n:\n\n *  workqueue\n\n * base forkjointaskbase workqueue 1signalwork\n\n * (inactive)tryrelease\n   \n   tryrelease:\n   \n   private boolean tryrelease(long c, workqueue v, long inc) {\n       int sp = (int) c, vs = (sp + ss_seq) & ~inactive;\n       thread p;\n       //ctl32scanstateparker\n       if (v != null && v.scanstate == sp) {          // v is at top of stack\n           //(32)scanstate(32)\n           long nc = (uc_mask & (c + inc)) | (sp_mask & v.stackpred);\n           if (u.compareandswaplong(this, ctl, c, nc)) {\n               v.scanstate = vs;\n               if ((p = v.parker) != null)\n                   u.unpark(p);//\n               return true;\n           }\n       }\n       return false;\n   }\n   \n\n * base\n\n * workqueuesinactivechecksumnull\n\n# forkjoinpool.awaitwork(workqueue w, int r)\n\nprivate boolean awaitwork(workqueue w, int r) {\n    if (w == null || w.qlock < 0)                 // w is terminating\n        return false;\n    for (int pred = w.stackpred, spins = spins, ss; ; ) {\n        if ((ss = w.scanstate) >= 0)//\n            break;\n        else if (spins > 0) {\n            r ^= r << 6;\n            r ^= r >>> 21;\n            r ^= r << 7;\n            if (r >= 0 && --spins == 0) {         // randomize spins\n                workqueue v;\n                workqueue[] ws;\n                int s, j;\n                atomiclong sc;\n                if (pred != 0 && (ws = workqueues) != null &&\n                        (j = pred & smask) < ws.length &&\n                        (v = ws[j]) != null &&        // see if pred parking\n                        (v.parker == null || v.scanstate >= 0))\n                    spins = spins;                // continue spinning\n            }\n        } else if (w.qlock < 0)                     // workqueuefalse recheck after spins\n            return false;\n        else if (!thread.interrupted()) {//\n            long c, prevctl, parktime, deadline;\n            int ac = (int) ((c = ctl) >> ac_shift) + (config & smask);//\n            if ((ac <= 0 && tryterminate(false, false)) || //active\n                    (runstate & stop) != 0)           // pool terminating\n                return false;\n            if (ac <= 0 && ss == (int) c) {        // is last waiter\n                //(32)scanstate(32)\n                prevctl = (uc_mask & (c + ac_unit)) | (sp_mask & pred);\n                int t = (short) (c >>> tc_shift);  // shrink excess spares\n                if (t > 2 && u.compareandswaplong(this, ctl, c, prevctl))//\n                    return false;                 // else use timed wait\n                //\n                parktime = idle_timeout * ((t >= 0) ? 1 : 1 - t);\n                deadline = system.nanotime() + parktime - timeout_slop;\n            } else\n                prevctl = parktime = deadline = 0l;\n            thread wt = thread.currentthread();\n            u.putobject(wt, parkblocker, this);   // emulate locksupport\n            w.parker = wt;//parker\n            if (w.scanstate < 0 && ctl == c)      // recheck before park\n                u.park(false, parktime);//\n\n            u.putorderedobject(w, qparker, null);\n            u.putobject(wt, parkblocker, null);\n            if (w.scanstate >= 0)//\n                break;\n            if (parktime != 0l && ctl == c &&\n                    deadline - system.nanotime() <= 0l &&\n                    u.compareandswaplong(this, ctl, c, prevctl))//ctlfalse\n                return false;                     // shrink pool\n        }\n    }\n    return true;\n}\n\n\n: runworkerscanawaitwork:\n\n * false active false worker(idle_timeout)scanning(scanstate >= 0)true scanctlfalse\n\n# workqueue.runtask()\n\nfinal void runtask(forkjointask<?> task) {\n    if (task != null) {\n        scanstate &= ~scanning; // mark as busy\n        (currentsteal = task).doexec();//currentsteal\n        u.putorderedobject(this, qcurrentsteal, null); // release for gc\n        execlocaltasks();//\n        forkjoinworkerthread thread = owner;\n        if (++nsteals < 0)      // collect on overflow\n            transferstealcount(pool);//\n        scanstate |= scanning;\n        if (thread != null)\n            thread.aftertoplevelexec();//\n    }\n}\n\n\n: scanworkqueue.runtask():\n\n * scanstate\n\n * currentstealforkjointask.doexec():\n   \n   //forkjointask.doexec()\n   final int doexec() {\n       int s; boolean completed;\n       if ((s = status) >= 0) {\n           try {\n               completed = exec();//\n           } catch (throwable rex) {\n               return setexceptionalcompletion(rex);\n           }\n           if (completed)\n               s = setcompletion(normal);\n       }\n       return s;\n   }\n   \n\n * execlocaltasksworkerqueue:\n   \n   //\n   final void execlocaltasks() {\n       int b = base, m, s;\n       forkjointask<?>[] a = array;\n       if (b - (s = top - 1) <= 0 && a != null &&\n               (m = a.length - 1) >= 0) {\n           if ((config & fifo_queue) == 0) {//fifo\n               for (forkjointask<?> t; ; ) {\n                   if ((t = (forkjointask<?>) u.getandsetobject\n                           (a, ((m & s) << ashift) + abase, null)) == null)//fifotop\n                       break;\n                   u.putorderedint(this, qtop, s);\n                   t.doexec();//\n                   if (base - (s = top - 1) > 0)\n                       break;\n               }\n           } else\n               pollandexecall();//lifobase\n       }\n   }\n   \n\n * \n\n * scanstate\n\n# forkjoinpool.deregisterworker(forkjoinworkerthread wt, throwable ex)\n\nfinal void deregisterworker(forkjoinworkerthread wt, throwable ex) {\n    workqueue w = null;\n    //1.workqueue\n    if (wt != null && (w = wt.workqueue) != null) {//forkjoinworkerthread\n        workqueue[] ws;                           // remove index from array\n        int idx = w.config & smask;//workqueue\n        int rs = lockrunstate();//runstate\n        if ((ws = workqueues) != null && ws.length > idx && ws[idx] == w)\n            ws[idx] = null;//workqueue\n        unlockrunstate(rs, rs & ~rslock);//runstate\n    }\n    //2.ctl\n    long c;                                       // decrement counts\n    do {} while (!u.compareandswaplong\n                 (this, ctl, c = ctl, ((ac_mask & (c - ac_unit)) |\n                                       (tc_mask & (c - tc_unit)) |\n                                       (sp_mask & c))));\n    //3.workqueue\n    if (w != null) {\n        w.qlock = -1;                             // ensure set\n        w.transferstealcount(this);\n        w.cancelall();                            // cancel remaining tasks\n    }\n    //4.workqueue\n    for (;;) {                                    // possibly replace\n        workqueue[] ws; int m, sp;\n        //\n        if (tryterminate(false, false) || w == null || w.array == null ||\n            (runstate & stop) != 0 || (ws = workqueues) == null ||\n            (m = ws.length - 1) < 0)              // already terminating\n            break;\n        //\n        if ((sp = (int)(c = ctl)) != 0) {         // wake up replacement\n            if (tryrelease(c, ws[sp & m], ac_unit))\n                break;\n        }\n        //\n        else if (ex != null && (c & add_worker) != 0l) {\n            tryaddworker(c);                      // create replacement\n            break;\n        }\n        else                                      // don\'t need replacement\n            break;\n    }\n    //5.\n    if (ex == null)                               // help clean on way out\n        forkjointask.helpexpungestaleexceptions();\n    else                                          // rethrow\n        forkjointask.rethrow(ex);\n}\n\n\n: deregisterworker forkjointask \n\n# \n\n(join/invoke)\n\n\n#  - forkjointask.join() / forkjointask.invoke()\n\n * join() :\n\n//\npublic final v join() {\n    int s;\n    if ((s = dojoin() & done_mask) != normal)\n        reportexception(s);\n    return getrawresult();\n}\n\n//join, get, quietlyjoin\nprivate int dojoin() {\n    int s; thread t; forkjoinworkerthread wt; forkjoinpool.workqueue w;\n    return (s = status) < 0 ? s :\n        ((t = thread.currentthread()) instanceof forkjoinworkerthread) ?\n        (w = (wt = (forkjoinworkerthread)t).workqueue).\n        tryunpush(this) && (s = doexec()) < 0 ? s :\n        wt.pool.awaitjoin(w, this, 0l) :\n        externalawaitdone();\n}\n\n\n * invoke() :\n\n//\npublic final v invoke() {\n    int s;\n    if ((s = doinvoke() & done_mask) != normal)\n        reportexception(s);\n    return getrawresult();\n}\n\n//invoke, quietlyinvoke\nprivate int doinvoke() {\n    int s; thread t; forkjoinworkerthread wt;\n    return (s = doexec()) < 0 ? s :\n        ((t = thread.currentthread()) instanceof forkjoinworkerthread) ?\n        (wt = (forkjoinworkerthread)t).pool.\n        awaitjoin(wt.workqueue, this, 0l) :\n        externalawaitdone();\n}\n\n\n: join()fork()()\n\nforkjointaskjoin()invoke()(getdojoin)externalawaitdoneinvoke()join() top (tryunpush) top forkjoinpool.awaitjoin join (forkjointask fork-join: a.fork(); b.fork(); b.join(); a.join(); b (top )fork()join()forkjoinpool.awaitjoin)\n\njoin()join()join():\n\n\n\n join (externalawaitdone) join (forkjoinpool.awaitjoin())\n\n# forkjointask.externalawaitdone()\n\nprivate int externalawaitdone() {\n    //\n    int s = ((this instanceof countedcompleter) ? // try helping\n             forkjoinpool.common.externalhelpcomplete(  // countedcompleter\n                 (countedcompleter<?>)this, 0) :\n             forkjoinpool.common.tryexternalunpush(this) ? doexec() : 0);  // forkjointask\n    if (s >= 0 && (s = status) >= 0) {//\n        boolean interrupted = false;\n        do {\n            if (u.compareandswapint(this, status, s, s | signal)) {  //state\n                synchronized (this) {\n                    if (status >= 0) {//signal \n                        try {\n                            wait(0l);\n                        } catch (interruptedexception ie) {\n                            interrupted = true;\n                        }\n                    }\n                    else\n                        notifyall();\n                }\n            }\n        } while ((s = status) >= 0);\n        if (interrupted)\n            thread.currentthread().interrupt();\n    }\n    return s;\n}\n\n\n: join:\n\n *  countedcompleter externalhelpcomplete\n\n *  forkjointask tryexternalunpush:\n   \n   // tryunpush (top)\n   final boolean tryexternalunpush(forkjointask<?> task) {\n       workqueue[] ws;\n       workqueue w;\n       forkjointask<?>[] a;\n       int m, s;\n       int r = threadlocalrandom.getprobe();\n       if ((ws = workqueues) != null && (m = ws.length - 1) >= 0 &&\n               (w = ws[m & r & sqmask]) != null &&\n               (a = w.array) != null && (s = w.top) != w.base) {\n           long j = (((a.length - 1) & (s - 1)) << ashift) + abase;  //top\n           if (u.compareandswapint(w, qlock, 0, 1)) {  //\n               if (w.top == s && w.array == a &&\n                       u.getobject(a, j) == task &&\n                       u.compareandswapobject(a, j, task, null)) {  //\n                   u.putorderedint(w, qtop, s - 1);  //top\n                   u.putorderedint(w, qlock, 0); //true\n                   return true;\n               }\n               u.compareandswapint(w, qlock, 1, 0);  //topfalse\n           }\n       }\n       return false;\n   }\n   \n   \n   tryexternalunpushtopexternalawaitdonedoexec()\n\n# forkjoinpool.awaitjoin()\n\nfinal int awaitjoin(workqueue w, forkjointask<?> task, long deadline) {\n    int s = 0;\n    if (task != null && w != null) {\n        forkjointask<?> prevjoin = w.currentjoin;  //workerjoin\n        u.putorderedobject(w, qcurrentjoin, task);  //currentjoin\n        //countedcompleter\n        countedcompleter<?> cc = (task instanceof countedcompleter) ?\n                (countedcompleter<?>) task : null;\n        for (; ; ) {\n            if ((s = task.status) < 0)  //|| \n                break;\n\n            if (cc != null)//countedcompleterhelpcompletejoin\n                helpcomplete(w, cc, 0);\n            else if (w.base == w.top || w.tryremoveandexec(task))  //\n                helpstealer(w, task);  //\n\n            if ((s = task.status) < 0) //||\n                break;\n            //\n            long ms, ns;\n            if (deadline == 0l)\n                ms = 0l;\n            else if ((ns = deadline - system.nanotime()) <= 0l)\n                break;\n            else if ((ms = timeunit.nanoseconds.tomillis(ns)) <= 0l)\n                ms = 1l;\n\n            if (trycompensate(w)) {//\n                task.internalwait(ms);//\n                u.getandaddlong(this, ctl, ac_unit);//\n            }\n        }\n        u.putorderedobject(w, qcurrentjoin, prevjoin);//join\n    }\n    return s;\n}\n\n\n:  join workertop join :\n\n * awaitjoinjoincurrentjoinjoin\n\n * :\n   \n   * (task.status < 0)|| s\n   *  countedcompleter helpcompletejoin(countedcompleter)\n   *  countedcompleter workqueue.tryremoveandexec\n   *  workqueue helpstealer()\n   * (task.status < 0)\n   * trycompensate workqueue  |unstable|workerforkjointask.internalwait()forkjointask.internalwait():\n   \n   final void internalwait(long timeout) {\n       int s;\n       if ((s = status) >= 0 && // force completer to issue notify\n           u.compareandswapint(this, status, s, s | signal)) {//signal()\n           synchronized (this) {\n               if (status >= 0)\n                   try { wait(timeout); } catch (interruptedexception ie) { }\n               else\n                   notifyall();\n           }\n       }\n   }\n   \n\nawaitjoin: tryremoveandexechelpstealertrycompensate\n\n# workqueue.tryremoveandexec(forkjointask<?> task)\n\nfinal boolean tryremoveandexec(forkjointask<?> task) {\n    forkjointask<?>[] a;\n    int m, s, b, n;\n    if ((a = array) != null && (m = a.length - 1) >= 0 &&\n            task != null) {\n        while ((n = (s = top) - (b = base)) > 0) {\n            //top\n            for (forkjointask<?> t; ; ) {      // traverse from s to b\n                long j = ((--s & m) << ashift) + abase;//\n                if ((t = (forkjointask<?>) u.getobject(a, j)) == null) //\n                    return s + 1 == top;     // shorter than expected\n                else if (t == task) { //\n                    boolean removed = false;\n                    if (s + 1 == top) {      // pop\n                        if (u.compareandswapobject(a, j, task, null)) { //\n                            u.putorderedint(this, qtop, s); //top\n                            removed = true;\n                        }\n                    } else if (base == b)      // replace with proxy\n                        removed = u.compareandswapobject(\n                                a, j, task, new emptytask()); //join\n                    if (removed)\n                        task.doexec(); //\n                    break;\n                } else if (t.status < 0 && s + 1 == top) { //top\n                    if (u.compareandswapobject(a, j, t, null)) //\n                        u.putorderedint(this, qtop, s);//top\n                    break;                  // was cancelled\n                }\n                if (--n == 0) //\n                    return false;\n            }\n            if (task.status < 0) //\n                return false;\n        }\n    }\n    return true;\n}\n\n\n: top worker : truefalse\n\n# forkjoinpool.helpstealer(workqueue w, forkjointask<?> task)\n\nprivate void helpstealer(workqueue w, forkjointask<?> task) {\n    workqueue[] ws = workqueues;\n    int oldsum = 0, checksum, m;\n    if (ws != null && (m = ws.length - 1) >= 0 && w != null &&\n            task != null) {\n        do {                                       // restart point\n            checksum = 0;                          // for stability check\n            forkjointask<?> subtask;\n            workqueue j = w, v;                    // v is subtask stealer\n            descent:\n            for (subtask = task; subtask.status >= 0; ) {\n                //1. workqueuev\n                for (int h = j.hint | 1, k = 0, i; ; k += 2) {//worker\n                    if (k > m)                     // can\'t find stealer\n                        break descent;\n                    if ((v = ws[i = (h + k) & m]) != null) {\n                        if (v.currentsteal == subtask) {//\n                            j.hint = i;//stealer\n                            break;\n                        }\n                        checksum += v.base;\n                    }\n                }\n                //2. v\n                for (; ; ) {                         // help v or descend\n                    forkjointask<?>[] a;            //\n                    int b;\n                    checksum += (b = v.base);\n                    forkjointask<?> next = v.currentjoin;//join\n                    if (subtask.status < 0 || j.currentjoin != subtask ||\n                            v.currentsteal != subtask) // stale\n                        break descent; // staledescent\n                    if (b - v.top >= 0 || (a = v.array) == null) {\n                        if ((subtask = next) == null)   //joinnulldescent\n                            break descent;\n                        j = v;\n                        break; //\n                    }\n                    int i = (((a.length - 1) & b) << ashift) + abase;//base\n                    forkjointask<?> t = ((forkjointask<?>)\n                            u.getobjectvolatile(a, i));//base\n                    if (v.base == b) {\n                        if (t == null)             // stale\n                            break descent; // staledescent\n                        if (u.compareandswapobject(a, i, t, null)) {//\n                            v.base = b + 1;         //base\n                            forkjointask<?> ps = w.currentsteal;//\n                            int top = w.top;\n                            //workqueuecurrentstealbase\n                            //topworkqueue\n                            // (lifo)->currentsteal->()\n                            do {\n                                u.putorderedobject(w, qcurrentsteal, t);\n                                t.doexec();        // clear local tasks too\n                            } while (task.status >= 0 &&\n                                    w.top != top && //\n                                    (t = w.pop()) != null);\n                            u.putorderedobject(w, qcurrentsteal, ps);//workqueuecurrentsteal\n                            if (w.base != w.top)//workqueue\n                                return;            // can\'t further help\n                        }\n                    }\n                }\n            }\n        } while (task.status >= 0 && oldsum != (oldsum = checksum));\n    }\n}\n\n\n: :  :\n\nworker workqueue hint base(w.top != top)(lifo)()\n\n# forkjoinpool.trycompensate(workqueue w)\n\n//: \nprivate boolean trycompensate(workqueue w) {\n    boolean canblock;\n    workqueue[] ws;\n    long c;\n    int m, pc, sp;\n    if (w == null || w.qlock < 0 ||           // caller terminating\n            (ws = workqueues) == null || (m = ws.length - 1) <= 0 ||\n            (pc = config & smask) == 0)           // parallelism disabled\n        canblock = false; //\n    else if ((sp = (int) (c = ctl)) != 0)      // release idle worker\n        canblock = tryrelease(c, ws[sp & m], 0l);//\n    else {//\n        int ac = (int) (c >> ac_shift) + pc; //\n        int tc = (short) (c >> tc_shift) + pc;//\n        int nbusy = 0;                        // validate saturation\n        for (int i = 0; i <= m; ++i) {        // two passes of odd indices\n            workqueue v;\n            if ((v = ws[((i << 1) | 1) & m]) != null) {//\n                if ((v.scanstate & scanning) != 0)//\n                    break;\n                ++nbusy;//\n            }\n        }\n        if (nbusy != (tc << 1) || ctl != c)\n            canblock = false;                 // unstable or stale\n        else if (tc >= pc && ac > 1 && w.isempty()) {// && 1 && \n            long nc = ((ac_mask & (c - ac_unit)) |\n                    (~ac_mask & c));       // uncompensated\n            canblock = u.compareandswaplong(this, ctl, c, nc);//\n        } else if (tc >= max_cap ||\n                (this == common && tc >= pc + commonmaxspares))//\n            throw new rejectedexecutionexception(\n                    "thread limit exceeded replacing blocked worker");\n        else {                                // similar to tryaddworker\n            boolean add = false;\n            int rs;      // cas within lock\n            long nc = ((ac_mask & c) |\n                    (tc_mask & (c + tc_unit)));//\n            if (((rs = lockrunstate()) & stop) == 0)\n                add = u.compareandswaplong(this, ctl, c, nc);//\n            unlockrunstate(rs, rs & ~rslock);\n            //\n            canblock = add && createworker(); // throws on exception\n        }\n    }\n    return canblock;\n}\n\n\n: :\n\n :\n\n * (tryrelease)\n * (createworker)\n\n :\n\n * \n *  && 1 && \n\n\n# fork/join\n\nfork/join,  :\n\n\n# fork()\n\nfork()\n\nfork()join()compute()compute()()\n\n> invokeallfork()\n\n\n# fork()compute()join()\n\n\n\nright.fork(); // \nlong leftans = left.compute(); // ()\nlong rightans = right.join(); // \nreturn leftans + rightans;\n\n\n:\n\nleft.fork(); // \nlong leftans = left.join(); // \nlong rightans = right.compute(); // \nreturn leftans + rightans;\n\n\n\n\nlong rightans = right.compute(); // \nleft.fork(); // \nlong leftans = left.join(); // \nreturn leftans + rightans;\n\n\n\n\n\n# \n\n()fork/join: fork()\n\n: 100~10000\n\n> javafork/joinjit(just-in-time)\n\n\n# \n\nfork/joinlistsystem.arraycopy\n\n\n# \n\n\n# jdkfork/join?\n\n arrays jdk 8(parallelsort) forkjoinpool  concurrenthashmap jdk 8(foreach)\n\n\n# executorsforkjoinpool\n\njava8executors:\n\n// parallelism\npublic static executorservice newworkstealingpool(int parallelism);\n// jvm\n// runtime.getruntime().availableprocessors()\npublic static executorservice newworkstealingpool();\n\n\n\n# fork/join\n\njavaforkjointaskinvoke()join()get()executionexception\n\nforkjointask\n\nstatic void rethrow(throwable ex) {\n    if (ex != null)\n        forkjointask.<runtimeexception>uncheckedthrow(ex);\n}\n\n@suppresswarnings("unchecked")\nstatic <t extends throwable> void uncheckedthrow(throwable t) throws t {\n    throw (t)t; // rely on vacuous cast\n}\n\n\njava10jvmjava: \n\ninvokejoin()forkjointaskquietlyinvoke()quietlyjoin()\n\nquitelyinvoke()quietlyjoin()iscompletedabnormally()iscompletednormally()\n\n\n# fork/join\n\n\n# fork/join1+2+3++10000\n\npublic class test {\n\tstatic final class sumtask extends recursivetask<integer> {\n\t\tprivate static final long serialversionuid = 1l;\n\t\t\n\t\tfinal int start; //\n\t\tfinal int end; //\n\t\t\n\t\tsumtask(int start, int end) {\n\t\t\tthis.start = start;\n\t\t\tthis.end = end;\n\t\t}\n\n\t\t@override\n\t\tprotected integer compute() {\n\t\t\t//1000if\n\t\t\tif(end - start < 1000) {\n\t\t\t\tsystem.out.println(thread.currentthread().getname() + " : " + start + "-" + end);\n\t\t\t\tint sum = 0;\n\t\t\t\tfor(int i = start; i <= end; i++)\n\t\t\t\t\tsum += i;\n\t\t\t\treturn sum;\n\t\t\t}\n\t\t\t//1000\n\t\t\tsumtask task1 = new sumtask(start, (start + end) / 2);\n\t\t\tsumtask task2 = new sumtask((start + end) / 2 + 1, end);\n\t\t\t//\n\t\t\ttask1.fork();\n\t\t\ttask2.fork();\n\t\t\t//\n\t\t\treturn task1.join() + task2.join();\n\t\t}\n\t}\n\t\n\tpublic static void main(string[] args) throws interruptedexception, executionexception {\n\t\tforkjoinpool pool = new forkjoinpool();\n\t\tforkjointask<integer> task = new sumtask(1, 10000);\n\t\tpool.submit(task);\n\t\tsystem.out.println(task.get());\n\t}\n}\n\n\n * \n\nforkjoinpool-1-worker-1 : 1-625\nforkjoinpool-1-worker-7 : 6251-6875\nforkjoinpool-1-worker-6 : 5626-6250\nforkjoinpool-1-worker-10 : 3751-4375\nforkjoinpool-1-worker-13 : 2501-3125\nforkjoinpool-1-worker-8 : 626-1250\nforkjoinpool-1-worker-11 : 5001-5625\nforkjoinpool-1-worker-3 : 7501-8125\nforkjoinpool-1-worker-14 : 1251-1875\nforkjoinpool-1-worker-4 : 9376-10000\nforkjoinpool-1-worker-8 : 8126-8750\nforkjoinpool-1-worker-0 : 1876-2500\nforkjoinpool-1-worker-12 : 4376-5000\nforkjoinpool-1-worker-5 : 8751-9375\nforkjoinpool-1-worker-7 : 6876-7500\nforkjoinpool-1-worker-1 : 3126-3750\n50005000\n\n\n\n# \n\n> : 112358132134  : f(1)=1f(2)=1, f(n)=f(n-1)+f(n-2)(n>=3nn*)\n\npublic static void main(string[] args) {\n    forkjoinpool forkjoinpool = new forkjoinpool(4); // 4\n    fibonacci fibonacci = new fibonacci(20);\n    long starttime = system.currenttimemillis();\n    integer result = forkjoinpool.invoke(fibonacci);\n    long endtime = system.currenttimemillis();\n    system.out.println("fork/join sum: " + result + " in " + (endtime - starttime) + " ms.");\n}\n//api\nstatic  class fibonacci extends recursivetask<integer> {\n    final int n;\n    fibonacci(int n) {\n        this.n = n;\n    }\n    @override\n    protected integer compute() {\n        if (n <= 1) {\n            return n;\n        }\n        fibonacci f1 = new fibonacci(n - 1);\n        f1.fork(); \n        fibonacci f2 = new fibonacci(n - 2);\n        return f2.compute() + f1.join(); \n    }\n}\n\n\nforkforkf1.fork()f2.fork() f2.join()f1.join()\n\napiinvokeallinvokeallfork\n\n{\n    // ...\n    fibonacci f1 = new fibonacci(n - 1);\n    fibonacci f2 = new fibonacci(n - 2);\n    invokeall(f1,f2);\n    return f2.join() + f1.join();\n}\n\npublic static void invokeall(forkjointask<?>... tasks) {\n    throwable ex = null;\n    int last = tasks.length - 1;\n    for (int i = last; i >= 0; --i) {\n        forkjointask<?> t = tasks[i];\n        if (t == null) {\n            if (ex == null)\n                ex = new nullpointerexception();\n        }\n        else if (i != 0)   //fork\n            t.fork();\n        else if (t.doinvoke() < normal && ex == null)  //\n            ex = t.getexception();\n    }\n    for (int i = 1; i <= last; ++i) {\n        forkjointask<?> t = tasks[i];\n        if (t != null) {\n            if (ex != null)\n                t.cancel(false);\n            else if (t.dojoin() < normal)\n                ex = t.getexception();\n        }\n    }\n    if (ex != null)\n        rethrow(ex);\n}\n\n\n\n\n# \n\n * forkjoinpooldoug leaa java fork/join framework\n * bagwellhttps://www.jianshu.com/p/32a15ef2f1bfhttps://www.jianshu.com/p/6a14d0b54b8d\n * https://blog.csdn.net/u010841296/article/details/83963637\n * https://blog.csdn.net/holmofy/article/details/82714665\n * https://blog.csdn.net/abc123lzf/article/details/82873181\n * https://blog.csdn.net/yinwenjie/article/details/71524140\n * https://blog.csdn.net/cowbin2012/article/details/89791757\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-forkjoinpool.html',charsets:{cjk:!0}},{title:"JUC - ",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-overview.html",relativePath:"java/thread/java-thread-x-juc-overview.md",key:"v-4ac8f434",path:"/java/thread/java-thread-x-juc-overview.html",headers:[{level:2,title:"JUC - ",slug:"juc-",normalizedTitle:"juc - ",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:165},{level:2,title:"Overview",slug:"overview",normalizedTitle:"overview",charIndex:186},{level:2,title:"LockTools",slug:"locktools",normalizedTitle:"locktools",charIndex:200},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:221},{level:3,title:": Condition",slug:"-condition",normalizedTitle:": condition",charIndex:234},{level:3,title:": Lock",slug:"-lock",normalizedTitle:": lock",charIndex:255},{level:3,title:": ReadWriteLock",slug:"-readwritelock",normalizedTitle:": readwritelock",charIndex:271},{level:3,title:": AbstractOwnableSynchonizer",slug:"-abstractownablesynchonizer",normalizedTitle:": abstractownablesynchonizer",charIndex:296},{level:3,title:"(long): AbstractQueuedLongSynchronizer",slug:"-long-abstractqueuedlongsynchronizer",normalizedTitle:"(long): abstractqueuedlongsynchronizer",charIndex:335},{level:3,title:"(int): AbstractQueuedSynchronizer",slug:"-int-abstractqueuedsynchronizer",normalizedTitle:"(int): abstractqueuedsynchronizer",charIndex:384},{level:3,title:": LockSupport",slug:"-locksupport",normalizedTitle:": locksupport",charIndex:430},{level:3,title:": ReentrantLock",slug:"-reentrantlock",normalizedTitle:": reentrantlock",charIndex:455},{level:3,title:": ReentrantReadWriteLock",slug:"-reentrantreadwritelock",normalizedTitle:": reentrantreadwritelock",charIndex:482},{level:3,title:": StampedLock",slug:"-stampedlock",normalizedTitle:": stampedlock",charIndex:518},{level:3,title:": CountDownLatch",slug:"-countdownlatch",normalizedTitle:": countdownlatch",charIndex:543},{level:3,title:": CyclicBarrier",slug:"-cyclicbarrier",normalizedTitle:": cyclicbarrier",charIndex:572},{level:3,title:": Phaser",slug:"-phaser",normalizedTitle:": phaser",charIndex:600},{level:3,title:": Semaphore",slug:"-semaphore",normalizedTitle:": semaphore",charIndex:621},{level:3,title:": Exchanger",slug:"-exchanger",normalizedTitle:": exchanger",charIndex:645},{level:2,title:"Collections: ",slug:"collections-",normalizedTitle:"collections: ",charIndex:667},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:692},{level:3,title:"Queue: ArrayBlockingQueue",slug:"queue-arrayblockingqueue",normalizedTitle:"queue: arrayblockingqueue",charIndex:705},{level:3,title:"Queue: LinkedBlockingQueue",slug:"queue-linkedblockingqueue",normalizedTitle:"queue: linkedblockingqueue",charIndex:738},{level:3,title:"Queue: LinkedBlockingDeque",slug:"queue-linkedblockingdeque",normalizedTitle:"queue: linkedblockingdeque",charIndex:772},{level:3,title:"Queue: ConcurrentLinkedQueue",slug:"queue-concurrentlinkedqueue",normalizedTitle:"queue: concurrentlinkedqueue",charIndex:806},{level:3,title:"Queue: ConcurrentLinkedDeque",slug:"queue-concurrentlinkeddeque",normalizedTitle:"queue: concurrentlinkeddeque",charIndex:842},{level:3,title:"Queue: DelayQueue",slug:"queue-delayqueue",normalizedTitle:"queue: delayqueue",charIndex:878},{level:3,title:"Queue: PriorityBlockingQueue",slug:"queue-priorityblockingqueue",normalizedTitle:"queue: priorityblockingqueue",charIndex:903},{level:3,title:"Queue: SynchronousQueue",slug:"queue-synchronousqueue",normalizedTitle:"queue: synchronousqueue",charIndex:939},{level:3,title:"Queue: LinkedTransferQueue",slug:"queue-linkedtransferqueue",normalizedTitle:"queue: linkedtransferqueue",charIndex:970},{level:3,title:"List: CopyOnWriteArrayList",slug:"list-copyonwritearraylist",normalizedTitle:"list: copyonwritearraylist",charIndex:1004},{level:3,title:"Set: CopyOnWriteArraySet",slug:"set-copyonwritearrayset",normalizedTitle:"set: copyonwritearrayset",charIndex:1038},{level:3,title:"Set: ConcurrentSkipListSet",slug:"set-concurrentskiplistset",normalizedTitle:"set: concurrentskiplistset",charIndex:1070},{level:3,title:"Map: ConcurrentHashMap",slug:"map-concurrenthashmap",normalizedTitle:"map: concurrenthashmap",charIndex:1104},{level:3,title:"Map: ConcurrentSkipListMap",slug:"map-concurrentskiplistmap",normalizedTitle:"map: concurrentskiplistmap",charIndex:1134},{level:2,title:"Atomic: ",slug:"atomic-",normalizedTitle:"atomic: ",charIndex:1166},{level:3,title:"AtomicBooleanAtomicIntegerAtomicLong",slug:"-atomicboolean-atomicinteger-atomiclong",normalizedTitle:"atomicbooleanatomicintegeratomiclong",charIndex:1185},{level:3,title:"AtomicIntegerArrayAtomicLongArrayBooleanArray",slug:"-atomicintegerarray-atomiclongarray-booleanarray",normalizedTitle:"atomicintegerarrayatomiclongarraybooleanarray",charIndex:1236},{level:3,title:"AtomicReferenceAtomicMarkedReferenceAtomicStampedReference",slug:"-atomicreference-atomicmarkedreference-atomicstampedreference",normalizedTitle:"atomicreferenceatomicmarkedreferenceatomicstampedreference",charIndex:1294},{level:3,title:"FieldUpdaterAtomicLongFieldUpdaterAtomicIntegerFieldUpdaterAtomicReferenceFieldUpdater",slug:"fieldupdater-atomiclongfieldupdater-atomicintegerfieldupdater-atomicreferencefieldupdater",normalizedTitle:"fieldupdateratomiclongfieldupdateratomicintegerfieldupdateratomicreferencefieldupdater",charIndex:1365},{level:2,title:"Executors: ",slug:"executors-",normalizedTitle:"executors: ",charIndex:1460},{level:3,title:"",slug:"-2",normalizedTitle:"",charIndex:692},{level:3,title:": Executor",slug:"-executor",normalizedTitle:": executor",charIndex:1495},{level:3,title:"ExecutorService",slug:"executorservice",normalizedTitle:"executorservice",charIndex:1515},{level:3,title:"ScheduledExecutorService",slug:"scheduledexecutorservice",normalizedTitle:"scheduledexecutorservice",charIndex:1538},{level:3,title:"AbstractExecutorService",slug:"abstractexecutorservice",normalizedTitle:"abstractexecutorservice",charIndex:1570},{level:3,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:1601},{level:3,title:": ThreadPoolExecutor",slug:"-threadpoolexecutor",normalizedTitle:": threadpoolexecutor",charIndex:1619},{level:3,title:": ScheduledThreadExecutor",slug:"-scheduledthreadexecutor",normalizedTitle:": scheduledthreadexecutor",charIndex:1649},{level:3,title:": Fork/Join",slug:"-fork-join",normalizedTitle:": fork/join",charIndex:1684},{level:3,title:": Executors",slug:"-executors",normalizedTitle:": executors",charIndex:1707},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:1727}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC -  BAT Overview LockTools  : Condition : Lock : ReadWriteLock : AbstractOwnableSynchonizer (long): AbstractQueuedLongSynchronizer (int): AbstractQueuedSynchronizer : LockSupport : ReentrantLock : ReentrantReadWriteLock : StampedLock : CountDownLatch : CyclicBarrier : Phaser : Semaphore : Exchanger Collections:   Queue: ArrayBlockingQueue Queue: LinkedBlockingQueue Queue: LinkedBlockingDeque Queue: ConcurrentLinkedQueue Queue: ConcurrentLinkedDeque Queue: DelayQueue Queue: PriorityBlockingQueue Queue: SynchronousQueue Queue: LinkedTransferQueue List: CopyOnWriteArrayList Set: CopyOnWriteArraySet Set: ConcurrentSkipListSet Map: ConcurrentHashMap Map: ConcurrentSkipListMap Atomic:  AtomicBooleanAtomicIntegerAtomicLong AtomicIntegerArrayAtomicLongArrayBooleanArray AtomicReferenceAtomicMarkedReferenceAtomicStampedReference FieldUpdaterAtomicLongFieldUpdaterAtomicIntegerFieldUpdaterAtomicReferenceFieldUpdater Executors:   : Executor ExecutorService ScheduledExecutorService AbstractExecutorService FutureTask : ThreadPoolExecutor : ScheduledThreadExecutor : Fork/Join : Executors ",content:'# JUC - \n\n\n\nJ.U.C; JUC\n\n * JUC - \n   * BAT\n   * Overview\n   * LockTools\n     * \n     * : Condition\n     * : Lock\n     * : ReadWriteLock\n     * : AbstractOwnableSynchonizer\n     * (long): AbstractQueuedLongSynchronizer\n     * (int): AbstractQueuedSynchronizer\n     * : LockSupport\n     * : ReentrantLock\n     * : ReentrantReadWriteLock\n     * : StampedLock\n     * : CountDownLatch\n     * : CyclicBarrier\n     * : Phaser\n     * : Semaphore\n     * : Exchanger\n   * Collections: \n     * \n     * Queue: ArrayBlockingQueue\n     * Queue: LinkedBlockingQueue\n     * Queue: LinkedBlockingDeque\n     * Queue: ConcurrentLinkedQueue\n     * Queue: ConcurrentLinkedDeque\n     * Queue: DelayQueue\n     * Queue: PriorityBlockingQueue\n     * Queue: SynchronousQueue\n     * Queue: LinkedTransferQueue\n     * List: CopyOnWriteArrayList\n     * Set: CopyOnWriteArraySet\n     * Set: ConcurrentSkipListSet\n     * Map: ConcurrentHashMap\n     * Map: ConcurrentSkipListMap\n   * Atomic: \n     * AtomicBooleanAtomicIntegerAtomicLong\n     * AtomicIntegerArrayAtomicLongArrayBooleanArray\n     * AtomicReferenceAtomicMarkedReferenceAtomicStampedReference\n     * FieldUpdaterAtomicLongFieldUpdaterAtomicIntegerFieldUpdaterAtomicReferenceFieldUpdater\n   * Executors: \n     * \n     * : Executor\n     * ExecutorService\n     * ScheduledExecutorService\n     * AbstractExecutorService\n     * FutureTask\n     * : ThreadPoolExecutor\n     * : ScheduledThreadExecutor\n     * : Fork/Join\n     * : Executors\n   * \n\n\n# BAT\n\n\n\n\n\n * JUC?\n * ?\n * ?\n\n\n# Overview\n\n\n\n * Java  - \n * Java  - \n * : synchronized\n * : volatile\n * : final\n\n\n\n\n\n: (: )\n\n * LockTools()\n * Collections: \n * Atomic: \n * Executors: \n\n\n# LockTools\n\n\n# \n\n\n\n\n# : Condition\n\n> Condition Object (waitnotify  notifyAll) Lock  set (wait-set)Lock  synchronized Condition  Object await(),signal()/\n\nJUC: AbstractQueuedSynchronizer-conditionobject\n\n\n# : Lock\n\n> LockLocksynchronizedCondition\n\n\n# : ReadWriteLock\n\n> ReadWriteLock  writer reader \n\n\n# : AbstractOwnableSynchonizer\n\n> AbstractOwnableSynchonizer()AbstractOwnableSynchronizer \n\n\n# (long): AbstractQueuedLongSynchronizer\n\n> AbstractQueuedLongSynchronizer long  AbstractQueuedSynchronizer  AbstractQueuedSynchronizer  long  int 64 \n\n\n# (int): AbstractQueuedSynchronizer\n\n> AbstractQueuedSynchronizer (FIFO) () int \n\n: JUC: AbstractQueuedSynchronizer\n\n\n# : LockSupport\n\n> LockSupportLockSupport"Thread Thread.suspend()Thread.resume()"LockSupportpark()  unpark() park()unpark()Thread.suspend  Thread.resume\n\n: JUC: LockSupport\n\n\n# : ReentrantLock\n\n> ReentrantLock Lock synchronized \n\n: JUC: ReentrantLock\n\n\n# : ReentrantReadWriteLock\n\n> ReentrantReadWriteLockReadWriteLockLockReadLockWriteLockReadLockWriteLock\n\n: JUC: ReentrantReadWriteLock\n\n\n# : StampedLock\n\n> java8java.util.concurrent.locksAPIStampedLock()StampedLockstamp0\n\n: Java 8 - StampedLock\n\n\n# : CountDownLatch\n\n> CountDownLatch\n\n: JUC: CountDownLatch\n\n\n# : CyclicBarrier\n\n> CyclicBarrier (common barrier point) CyclicBarrier  barrier   barrier\n\n: JUC: CyclicBarrier\n\n\n# : Phaser\n\n> PhaserJDK 7CyclicBarrierCountDownLatch\n\n: JUC: Phaser\n\n\n# : Semaphore\n\n> Semaphore acquire() release() Semaphore ()\n\n: JUC: Semaphore\n\n\n# : Exchanger\n\n> Exchanger, exchange()exchange()exchange()\n\n: JUC: Exchanger\n\n\n# Collections: \n\n\n# \n\n\n\n\n# Queue: ArrayBlockingQueue\n\n>  FIFO()  \n\n: JUC: BlockingQueue\n\n\n# Queue: LinkedBlockingQueue\n\n>  blocking queue FIFO()  \n\n: JUC: BlockingQueue\n\n\n# Queue: LinkedBlockingDeque\n\n> \n\n: JUC: BlockingQueue\n\n\n# Queue: ConcurrentLinkedQueue\n\n>  FIFO()   collection ConcurrentLinkedQueue  null \n\n: JUC: ConcurrentLinkedQueue\n\n\n# Queue: ConcurrentLinkedDeque\n\n> FIFOFILO\n\n\n# Queue: DelayQueue\n\n> Lockhead\n\n\n# Queue: PriorityBlockingQueue\n\n> LockpriorityQueuenullcomparable\n\n\n# Queue: SynchronousQueue\n\n> CASFIFOFILO\n\n\n# Queue: LinkedTransferQueue\n\n> JDK 7CAS FIFO()LinkedTransferQueueConcurrentLinkedQueueSynchronousQueue()LinkedBlockingQueue, \n\n\n# List: CopyOnWriteArrayList\n\n> ArrayList (addset ) \n\n: JUC: CopyOnWriteArrayList\n\n\n# Set: CopyOnWriteArraySet\n\n> CopyOnWriteArrayListSetCopyOnWriteArayListaddaddIfAbsentaddCopyOnWriteArrayList\n\n\n# Set: ConcurrentSkipListSet\n\n> ConcurrentSkipListMap  NavigableSet set  set  Comparator \n\n\n# Map: ConcurrentHashMap\n\n> HashMapConcurrentHashMapJDK 7Locksegment()JDK 8 CAS+synchronized\n\n: JUC: ConcurrentHashMap, JDK 7JDK 8\n\n\n# Map: ConcurrentSkipListMap\n\n> (TreeMap); Comparator \n\n\n# Atomic: \n\nJVM()\n\nCASUnsafe13: JUC: CAS, Unsafe\n\n\n# AtomicBooleanAtomicIntegerAtomicLong\n\n> AtomicBooleanAtomicIntegerAtomicLongboolintergerlong\n\n\n# AtomicIntegerArrayAtomicLongArrayBooleanArray\n\n> AtomicIntegerArrayAtomicLongArrayAtomicBooleanArray\n\n\n# AtomicReferenceAtomicMarkedReferenceAtomicStampedReference\n\n> AtomicReferenceAtomicMarkedReferenceAtomicStampedReference\n\n\n# FieldUpdaterAtomicLongFieldUpdaterAtomicIntegerFieldUpdaterAtomicReferenceFieldUpdater\n\n> AtomicLongFieldUpdaterAtomicIntegerFieldUpdaterAtomicReferenceFieldUpdaterFieldUpdater\n\n\n# Executors: \n\n\n# \n\n\n\n\n# : Executor\n\n> Executor() Executor \n\n\n# ExecutorService\n\n> ExecutorServiceExecutorExecutorService Future   ExecutorService\n\n\n# ScheduledExecutorService\n\n> ScheduledExecutorServiceExecutorService\n\n\n# AbstractExecutorService\n\n> AbstractExecutorServiceExecutorService ExecutorService  newTaskFor  RunnableFuture  submitinvokeAny  invokeAll RunnableFuture  FutureTask \n\n\n# FutureTask\n\n> FutureTask  Future (get)(cancel)(runAndReset)FutureTask  Callable  Runnable task FutureTask CAS\n\n: JUC: FutureTask\n\n\n# : ThreadPoolExecutor\n\n> ThreadPoolExecutorAbstractExecutorService ExecutorService Executors  : () ThreadPoolExecutor \n\n: JUC: ThreadPoolExecutor\n\n\n# : ScheduledThreadExecutor\n\n> ScheduledThreadPoolExecutorScheduledExecutorService ThreadPoolExecutor  Timer\n\n: JUC: ScheduledThreadExecutor\n\n\n# : Fork/Join\n\n> ForkJoinPool JDK 7Fork/Join (Divide-and-Conquer)\n\n: JUC: Fork/Join\n\n\n# : Executors\n\n> ExecutorsExecutorServiceScheduledExecutorServiceThreadFactoryCallableThreadPoolExecutor, ScheduledThreadExecutorForkJoinPool\n\n\n# \n\n * https://www.cnblogs.com/leesf456/p/5344133.html\n * https://www.cnblogs.com/leesf456/p/5428630.html\n * https://www.cnblogs.com/leesf456/p/5550043.html\n * https://www.jianshu.com/p/8cb5d816cb69\n * bagwell https://www.jianshu.com/p/af9c0f404a93\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-overview.html',normalizedContent:'# juc - \n\n\n\nj.u.c; juc\n\n * juc - \n   * bat\n   * overview\n   * locktools\n     * \n     * : condition\n     * : lock\n     * : readwritelock\n     * : abstractownablesynchonizer\n     * (long): abstractqueuedlongsynchronizer\n     * (int): abstractqueuedsynchronizer\n     * : locksupport\n     * : reentrantlock\n     * : reentrantreadwritelock\n     * : stampedlock\n     * : countdownlatch\n     * : cyclicbarrier\n     * : phaser\n     * : semaphore\n     * : exchanger\n   * collections: \n     * \n     * queue: arrayblockingqueue\n     * queue: linkedblockingqueue\n     * queue: linkedblockingdeque\n     * queue: concurrentlinkedqueue\n     * queue: concurrentlinkeddeque\n     * queue: delayqueue\n     * queue: priorityblockingqueue\n     * queue: synchronousqueue\n     * queue: linkedtransferqueue\n     * list: copyonwritearraylist\n     * set: copyonwritearrayset\n     * set: concurrentskiplistset\n     * map: concurrenthashmap\n     * map: concurrentskiplistmap\n   * atomic: \n     * atomicbooleanatomicintegeratomiclong\n     * atomicintegerarrayatomiclongarraybooleanarray\n     * atomicreferenceatomicmarkedreferenceatomicstampedreference\n     * fieldupdateratomiclongfieldupdateratomicintegerfieldupdateratomicreferencefieldupdater\n   * executors: \n     * \n     * : executor\n     * executorservice\n     * scheduledexecutorservice\n     * abstractexecutorservice\n     * futuretask\n     * : threadpoolexecutor\n     * : scheduledthreadexecutor\n     * : fork/join\n     * : executors\n   * \n\n\n# bat\n\n\n\n\n\n * juc?\n * ?\n * ?\n\n\n# overview\n\n\n\n * java  - \n * java  - \n * : synchronized\n * : volatile\n * : final\n\n\n\n\n\n: (: )\n\n * locktools()\n * collections: \n * atomic: \n * executors: \n\n\n# locktools\n\n\n# \n\n\n\n\n# : condition\n\n> condition object (waitnotify  notifyall) lock  set (wait-set)lock  synchronized condition  object await(),signal()/\n\njuc: abstractqueuedsynchronizer-conditionobject\n\n\n# : lock\n\n> locklocksynchronizedcondition\n\n\n# : readwritelock\n\n> readwritelock  writer reader \n\n\n# : abstractownablesynchonizer\n\n> abstractownablesynchonizer()abstractownablesynchronizer \n\n\n# (long): abstractqueuedlongsynchronizer\n\n> abstractqueuedlongsynchronizer long  abstractqueuedsynchronizer  abstractqueuedsynchronizer  long  int 64 \n\n\n# (int): abstractqueuedsynchronizer\n\n> abstractqueuedsynchronizer (fifo) () int \n\n: juc: abstractqueuedsynchronizer\n\n\n# : locksupport\n\n> locksupportlocksupport"thread thread.suspend()thread.resume()"locksupportpark()  unpark() park()unpark()thread.suspend  thread.resume\n\n: juc: locksupport\n\n\n# : reentrantlock\n\n> reentrantlock lock synchronized \n\n: juc: reentrantlock\n\n\n# : reentrantreadwritelock\n\n> reentrantreadwritelockreadwritelocklockreadlockwritelockreadlockwritelock\n\n: juc: reentrantreadwritelock\n\n\n# : stampedlock\n\n> java8java.util.concurrent.locksapistampedlock()stampedlockstamp0\n\n: java 8 - stampedlock\n\n\n# : countdownlatch\n\n> countdownlatch\n\n: juc: countdownlatch\n\n\n# : cyclicbarrier\n\n> cyclicbarrier (common barrier point) cyclicbarrier  barrier   barrier\n\n: juc: cyclicbarrier\n\n\n# : phaser\n\n> phaserjdk 7cyclicbarriercountdownlatch\n\n: juc: phaser\n\n\n# : semaphore\n\n> semaphore acquire() release() semaphore ()\n\n: juc: semaphore\n\n\n# : exchanger\n\n> exchanger, exchange()exchange()exchange()\n\n: juc: exchanger\n\n\n# collections: \n\n\n# \n\n\n\n\n# queue: arrayblockingqueue\n\n>  fifo()  \n\n: juc: blockingqueue\n\n\n# queue: linkedblockingqueue\n\n>  blocking queue fifo()  \n\n: juc: blockingqueue\n\n\n# queue: linkedblockingdeque\n\n> \n\n: juc: blockingqueue\n\n\n# queue: concurrentlinkedqueue\n\n>  fifo()   collection concurrentlinkedqueue  null \n\n: juc: concurrentlinkedqueue\n\n\n# queue: concurrentlinkeddeque\n\n> fifofilo\n\n\n# queue: delayqueue\n\n> lockhead\n\n\n# queue: priorityblockingqueue\n\n> lockpriorityqueuenullcomparable\n\n\n# queue: synchronousqueue\n\n> casfifofilo\n\n\n# queue: linkedtransferqueue\n\n> jdk 7cas fifo()linkedtransferqueueconcurrentlinkedqueuesynchronousqueue()linkedblockingqueue, \n\n\n# list: copyonwritearraylist\n\n> arraylist (addset ) \n\n: juc: copyonwritearraylist\n\n\n# set: copyonwritearrayset\n\n> copyonwritearraylistsetcopyonwritearaylistaddaddifabsentaddcopyonwritearraylist\n\n\n# set: concurrentskiplistset\n\n> concurrentskiplistmap  navigableset set  set  comparator \n\n\n# map: concurrenthashmap\n\n> hashmapconcurrenthashmapjdk 7locksegment()jdk 8 cas+synchronized\n\n: juc: concurrenthashmap, jdk 7jdk 8\n\n\n# map: concurrentskiplistmap\n\n> (treemap); comparator \n\n\n# atomic: \n\njvm()\n\ncasunsafe13: juc: cas, unsafe\n\n\n# atomicbooleanatomicintegeratomiclong\n\n> atomicbooleanatomicintegeratomiclongboolintergerlong\n\n\n# atomicintegerarrayatomiclongarraybooleanarray\n\n> atomicintegerarrayatomiclongarrayatomicbooleanarray\n\n\n# atomicreferenceatomicmarkedreferenceatomicstampedreference\n\n> atomicreferenceatomicmarkedreferenceatomicstampedreference\n\n\n# fieldupdateratomiclongfieldupdateratomicintegerfieldupdateratomicreferencefieldupdater\n\n> atomiclongfieldupdateratomicintegerfieldupdateratomicreferencefieldupdaterfieldupdater\n\n\n# executors: \n\n\n# \n\n\n\n\n# : executor\n\n> executor() executor \n\n\n# executorservice\n\n> executorserviceexecutorexecutorservice future   executorservice\n\n\n# scheduledexecutorservice\n\n> scheduledexecutorserviceexecutorservice\n\n\n# abstractexecutorservice\n\n> abstractexecutorserviceexecutorservice executorservice  newtaskfor  runnablefuture  submitinvokeany  invokeall runnablefuture  futuretask \n\n\n# futuretask\n\n> futuretask  future (get)(cancel)(runandreset)futuretask  callable  runnable task futuretask cas\n\n: juc: futuretask\n\n\n# : threadpoolexecutor\n\n> threadpoolexecutorabstractexecutorservice executorservice executors  : () threadpoolexecutor \n\n: juc: threadpoolexecutor\n\n\n# : scheduledthreadexecutor\n\n> scheduledthreadpoolexecutorscheduledexecutorservice threadpoolexecutor  timer\n\n: juc: scheduledthreadexecutor\n\n\n# : fork/join\n\n> forkjoinpool jdk 7fork/join (divide-and-conquer)\n\n: juc: fork/join\n\n\n# : executors\n\n> executorsexecutorservicescheduledexecutorservicethreadfactorycallablethreadpoolexecutor, scheduledthreadexecutorforkjoinpool\n\n\n# \n\n * https://www.cnblogs.com/leesf456/p/5344133.html\n * https://www.cnblogs.com/leesf456/p/5428630.html\n * https://www.cnblogs.com/leesf456/p/5550043.html\n * https://www.jianshu.com/p/8cb5d816cb69\n * bagwell https://www.jianshu.com/p/af9c0f404a93\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-overview.html',charsets:{cjk:!0}},{title:"JUC: ThreadPoolExecutor",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html",relativePath:"java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.md",key:"v-3969da64",path:"/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html",headers:[{level:2,title:"JUC: ThreadPoolExecutor",slug:"juc-threadpoolexecutor",normalizedTitle:"juc: threadpoolexecutor",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:99},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:120},{level:2,title:"ThreadPoolExecutor",slug:"threadpoolexecutor",normalizedTitle:"threadpoolexecutor",charIndex:134},{level:2,title:"ThreadPoolExecutor",slug:"threadpoolexecutor",normalizedTitle:"threadpoolexecutor",charIndex:160},{level:3,title:"Execute",slug:"execute",normalizedTitle:"execute",charIndex:190},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:207},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:217},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:319},{level:2,title:"ThreadPoolExecutor",slug:"threadpoolexecutor",normalizedTitle:"threadpoolexecutor",charIndex:383},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:413},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:427},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:439},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:542},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:595},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:606},{level:3,title:"Executors? ?",slug:"executors-",normalizedTitle:"executors? ?",charIndex:619},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:708},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:727},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:741}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ThreadPoolExecutor BAT  ThreadPoolExecutor ThreadPoolExecutor Execute    ThreadPoolExecutor       Executors? ?   ",content:'# JUC: ThreadPoolExecutor\n\n> ThreadPoolExecutor\n\n * JUC: ThreadPoolExecutor\n   * BAT\n   * \n   * ThreadPoolExecutor\n   * ThreadPoolExecutor\n     * Execute\n     * \n     * \n       * newFixedThreadPool\n       * newSingleThreadExecutor\n       * newCachedThreadPool\n     * \n       *  - shutdown\n       *  - shutdownNow\n   * ThreadPoolExecutor\n     * \n     * \n     * \n       * execute()\n       * addWorker\n       * Workerrunworker\n       * getTask\n     * \n       * submit\n       * FutureTask\n     * \n   * \n     * Executors? ?\n       *  1\n       * 2\n       * 3\n     * \n     * \n   * \n\n\n# BAT\n\n\n\n\n\n * ?\n * Java? \n * Executors? ?\n * ThreadPoolExecutor? \n * ThreadPoolExecutor?\n * workermaxSize?\n * ThreadPoolExecutorRejectedExecutionHandler? ?\n * ? execute > addWorker >runworker (getTask)\n * ?\n * ?\n * ?\n * ?\n\n\n# \n\n:\n\n * ()\n * ()\n * \n\n\n# ThreadPoolExecutor\n\nJava?\n\nJDK 5RunnableCallableExecutor\n\n * WorkerThread\n\npublic class WorkerThread implements Runnable {\n     \n    private String command;\n     \n    public WorkerThread(String s){\n        this.command=s;\n    }\n \n    @Override\n    public void run() {\n        System.out.println(Thread.currentThread().getName()+" Start. Command = "+command);\n        processCommand();\n        System.out.println(Thread.currentThread().getName()+" End.");\n    }\n \n    private void processCommand() {\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n \n    @Override\n    public String toString(){\n        return this.command;\n    }\n}\n\n\n * SimpleThreadPool\n\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n \npublic class SimpleThreadPool {\n \n    public static void main(String[] args) {\n        ExecutorService executor = Executors.newFixedThreadPool(5);\n        for (int i = 0; i < 10; i++) {\n            Runnable worker = new WorkerThread("" + i);\n            executor.execute(worker);\n          }\n        executor.shutdown(); // This will make the executor accept no new threads and finish all existing threads in the queue\n        while (!executor.isTerminated()) { // Wait until all threads are finish,and also you can use "executor.awaitTermination();" to wait\n        }\n        System.out.println("Finished all threads");\n    }\n\n}\n\n\n\n\n\n\npool-1-thread-2 Start. Command = 1\npool-1-thread-4 Start. Command = 3\npool-1-thread-1 Start. Command = 0\npool-1-thread-3 Start. Command = 2\npool-1-thread-5 Start. Command = 4\npool-1-thread-4 End.\npool-1-thread-5 End.\npool-1-thread-1 End.\npool-1-thread-3 End.\npool-1-thread-3 Start. Command = 8\npool-1-thread-2 End.\npool-1-thread-2 Start. Command = 9\npool-1-thread-1 Start. Command = 7\npool-1-thread-5 Start. Command = 6\npool-1-thread-4 Start. Command = 5\npool-1-thread-2 End.\npool-1-thread-4 End.\npool-1-thread-3 End.\npool-1-thread-5 End.\npool-1-thread-1 End.\nFinished all threads\n\n\n "pool-1-thread-1"  "pool-1-thread-5" \n\nExecutors  ThreadPoolExecutor  ExecutorService  ThreadPoolExecutor  ThreadPoolExecutor  RejectedExecutionHandler \n\n RejectedExecutionHandler \n\n * RejectedExecutionHandlerImpl.java\n\nimport java.util.concurrent.RejectedExecutionHandler;\nimport java.util.concurrent.ThreadPoolExecutor;\n \npublic class RejectedExecutionHandlerImpl implements RejectedExecutionHandler {\n \n    @Override\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {\n        System.out.println(r.toString() + " is rejected");\n    }\n \n}\n\n\nThreadPoolExecutor  executor  executor \n\n * MyMonitorThread.java\n\nimport java.util.concurrent.ThreadPoolExecutor;\n \npublic class MyMonitorThread implements Runnable\n{\n    private ThreadPoolExecutor executor;\n     \n    private int seconds;\n     \n    private boolean run=true;\n \n    public MyMonitorThread(ThreadPoolExecutor executor, int delay)\n    {\n        this.executor = executor;\n        this.seconds=delay;\n    }\n     \n    public void shutdown(){\n        this.run=false;\n    }\n \n    @Override\n    public void run()\n    {\n        while(run){\n                System.out.println(\n                    String.format("[monitor] [%d/%d] Active: %d, Completed: %d, Task: %d, isShutdown: %s, isTerminated: %s",\n                        this.executor.getPoolSize(),\n                        this.executor.getCorePoolSize(),\n                        this.executor.getActiveCount(),\n                        this.executor.getCompletedTaskCount(),\n                        this.executor.getTaskCount(),\n                        this.executor.isShutdown(),\n                        this.executor.isTerminated()));\n                try {\n                    Thread.sleep(seconds*1000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n        }\n             \n    }\n}\n\n\n ThreadPoolExecutor \n\n * WorkerPool.java\n\nimport java.util.concurrent.ArrayBlockingQueue;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ThreadFactory;\nimport java.util.concurrent.ThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\n \npublic class WorkerPool {\n \n    public static void main(String args[]) throws InterruptedException{\n        //RejectedExecutionHandler implementation\n        RejectedExecutionHandlerImpl rejectionHandler = new RejectedExecutionHandlerImpl();\n        //Get the ThreadFactory implementation to use\n        ThreadFactory threadFactory = Executors.defaultThreadFactory();\n        //creating the ThreadPoolExecutor\n        ThreadPoolExecutor executorPool = new ThreadPoolExecutor(2, 4, 10, TimeUnit.SECONDS, new ArrayBlockingQueue<Runnable>(2), threadFactory, rejectionHandler);\n        //start the monitoring thread\n        MyMonitorThread monitor = new MyMonitorThread(executorPool, 3);\n        Thread monitorThread = new Thread(monitor);\n        monitorThread.start();\n        //submit work to the thread pool\n        for(int i=0; i<10; i++){\n            executorPool.execute(new WorkerThread("cmd"+i));\n        }\n         \n        Thread.sleep(30000);\n        //shut down the pool\n        executorPool.shutdown();\n        //shut down the monitor thread\n        Thread.sleep(5000);\n        monitor.shutdown();\n         \n    }\n}\n\n\n ThreadPoolExecutor  2 4  2() RejectedExecutionHandlerImpl \n\n\n\npool-1-thread-1 Start. Command = cmd0\npool-1-thread-4 Start. Command = cmd5\ncmd6 is rejected\npool-1-thread-3 Start. Command = cmd4\npool-1-thread-2 Start. Command = cmd1\ncmd7 is rejected\ncmd8 is rejected\ncmd9 is rejected\n[monitor] [0/2] Active: 4, Completed: 0, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [4/2] Active: 4, Completed: 0, Task: 6, isShutdown: false, isTerminated: false\npool-1-thread-4 End.\npool-1-thread-1 End.\npool-1-thread-2 End.\npool-1-thread-3 End.\npool-1-thread-1 Start. Command = cmd3\npool-1-thread-4 Start. Command = cmd2\n[monitor] [4/2] Active: 2, Completed: 4, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [4/2] Active: 2, Completed: 4, Task: 6, isShutdown: false, isTerminated: false\npool-1-thread-1 End.\npool-1-thread-4 End.\n[monitor] [4/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [2/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [2/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [2/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [2/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [2/2] Active: 0, Completed: 6, Task: 6, isShutdown: false, isTerminated: false\n[monitor] [0/2] Active: 0, Completed: 6, Task: 6, isShutdown: true, isTerminated: true\n[monitor] [0/2] Active: 0, Completed: 6, Task: 6, isShutdown: true, isTerminated: true\n\n\n executor  shutdown() \n\n\n# ThreadPoolExecutor\n\njavaworkerSetworkQueue()workQueueworkerSetworkQueueworkQueueworker\n\n\n\n\n# Execute\n\n:\n\n 1. corePoolSize2.\n 2. BlockingQueueBlockingQueue3.\n 3. maximumPoolSizeRejectedExecutionHandler\n\nThreadPoolExecutorCASctl.\n\n\n# \n\npublic ThreadPoolExecutor(int corePoolSize,\n                              int maximumPoolSize,\n                              long keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue<Runnable> workQueue,\n                              RejectedExecutionHandler handler)\n\n\n * corePoolSize corePoolSize, , corePoolSizeprestartAllCoreThreads()\n\n * workQueue . JDK: JUC : BlockQueue\n   \n   * ArrayBlockingQueue: FIFO\n   * LinkedBlockingQueue: FIFOArrayBlockingQueue\n   * SynchronousQueue: LinkedBlockingQueue\n   * PriorityBlockingQueue: \n\nLinkedBlockingQueueArrayBlockingQueueput(), take()SynchronousQueueTransfer.transfer().\n\n * maximumPoolSize maximumPoolSize, maximumPoolSize, workQueue.\n\n * keepAliveTime corePoolSize, \n\n * unit keepAliveTime\n\n * threadFactory DefaultThreadFactory\n\n * handler 4:\n   \n   * AbortPolicy: \n   * CallerRunsPolicy: \n   * DiscardOldestPolicy: \n   * DiscardPolicy: \n\nRejectedExecutionHandler\n\n\n# \n\n# newFixedThreadPool\n\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue<Runnable>());\n}\n\n\ncorePoolSize\n\nFixedThreadPoolLinkedBlockingQueue(Integer.MAX_VALUE), :\n\n * corePoolSize,maximumPoolSizekeepAliveTime\n * , FixedThreadPool, \n\n# newSingleThreadExecutor\n\npublic static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue<Runnable>()));\n}\n\n\n.\n\n, SingleThreadPool, \n\n# newCachedThreadPool\n\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                    60L, TimeUnit.SECONDS,\n                                    new SynchronousQueue<Runnable>());\n}\n\n\nInteger.MAX_VALUE2147483647SynchronousQueue newFixedThreadPoolnewCachedThreadPoolkeepAliveTime :\n\n * SynchronousQueueoffer()task,  SynchronousQueuetask, SynchronousQueuepoll(), task. (2)\n * , .\n * 60s, . CachedThreadPool.\n\n\n# \n\ninterrupt.\n\n#  - shutdown\n\nSHUTDOWN, .\n\n#  - shutdownNow\n\nSTOP, . , isShutDown() true. , isTerminated()true.\n\n\n# ThreadPoolExecutor\n\n\n# \n\n// worker\n//int32int3,29worker\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n//\nprivate final BlockingQueue<Runnable> workQueue;\n//worker,set\nprivate final HashSet<Worker> workers = new HashSet<Worker>();\n//worker\nprivate int largestPoolSize;\n//workermaxSize,\nprivate volatile RejectedExecutionHandler handler;\n//coreSizeworker\nprivate volatile long keepAliveTime;\n//worker\nprivate volatile int corePoolSize;\n//worker,workQueue\nprivate volatile int maximumPoolSize;\n\n\n\n# \n\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n\n// runState is stored in the high-order bits\nprivate static final int RUNNING    = -1 << COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\nprivate static final int STOP       =  1 << COUNT_BITS;\nprivate static final int TIDYING    =  2 << COUNT_BITS;\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n// Packing and unpacking ctl\nprivate static int runStateOf(int c)     { return c & ~CAPACITY; }\nprivate static int workerCountOf(int c)  { return c & CAPACITY; }\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n\n\nAtomicIntegerctl: 293:\n\n * RUNNING: -1 << COUNT_BITS3111\n * SHUTDOWN: 0 << COUNT_BITS3000\n * STOP : 1 << COUNT_BITS3001\n * TIDYING : 2 << COUNT_BITS3010, \n * TERMINATED: 3 << COUNT_BITS3011, terminated()\n\n\n\n\n# \n\n> execute > addWorker >runworker (getTask)\n\nWokerReentrantLockWokerHashSetWoker Woker: threadWokerthisstartthreadWorkerrunWorker firstTaskgetTaskgetTaskcpu\n\n# execute()\n\nThreadPoolExecutor.execute(task)Executor.execute(task)\n\npublic void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n    /*\n     * Proceed in 3 steps:\n     *\n     * 1. If fewer than corePoolSize threads are running, try to\n     * start a new thread with the given command as its first\n     * task.  The call to addWorker atomically checks runState and\n     * workerCount, and so prevents false alarms that would add\n     * threads when it shouldn\'t, by returning false.\n     *\n     * 2. If a task can be successfully queued, then we still need\n     * to double-check whether we should have added a thread\n     * (because existing ones died since last checking) or that\n     * the pool shut down since entry into this method. So we\n     * recheck state and if necessary roll back the enqueuing if\n     * stopped, or start a new thread if there are none.\n     *\n     * 3. If we cannot queue task, then we try to add a new\n     * thread.  If it fails, we know we are shut down or saturated\n     * and so reject the task.\n     */\n    int c = ctl.get();\n    if (workerCountOf(c) < corePoolSize) {  \n    //workerCountOfcorePoolSizeaddWorkercommand\n       if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    // double check: c, recheck\n    // RUNNING\n    if (isRunning(c) && workQueue.offer(command)) {\n        int recheck = ctl.get();\n        // recheck and if necessary shutdownremove(command)\n        //RUNNINGreject\n        if (! isRunning(recheck) && remove(command))\n            reject(command);\n        //running\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // reject\n    else if (!addWorker(command, false))\n        reject(command);\n}\n\n\n * double check?\n\nctl.get()commandworkquedouble checkrunning()command\n\n# addWorker\n\nexecute: addWorker  :\n\nprivate final ReentrantLock mainLock = new ReentrantLock();\n\n\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    // CAS\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs >= SHUTDOWN &&\n            ! (rs == SHUTDOWN &&\n                firstTask == null &&\n                ! workQueue.isEmpty()))\n            return false;\n\n        for (;;) {\n            int wc = workerCountOf(c);\n            if (wc >= CAPACITY ||\n                wc >= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            c = ctl.get();  // Re-read ctl\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n    }\n\n    boolean workerStarted = false;\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        w = new Worker(firstTask);\n        final Thread t = w.thread;\n        if (t != null) {\n            // \n            final ReentrantLock mainLock = this.mainLock;\n            mainLock.lock();\n            try {\n                // Recheck while holding lock.\n                // Back out on ThreadFactory failure or if\n                // shut down before lock acquired.\n                int rs = runStateOf(ctl.get());\n\n                if (rs < SHUTDOWN ||\n                    (rs == SHUTDOWN && firstTask == null)) {\n                    if (t.isAlive()) // precheck that t is startable\n                        throw new IllegalThreadStateException();\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s > largestPoolSize)\n                        largestPoolSize = s;\n                    workerAdded = true;\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            if (workerAdded) {\n                t.start();  // (Worker.thread(firstTask).start());\n                workerStarted = true;\n            }\n        }\n    } finally {\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    return workerStarted;\n}\n\n\n# Workerrunworker\n\n private final class Worker extends AbstractQueuedSynchronizer implements Runnable{\n     Worker(Runnable firstTask) {\n         setState(-1); // inhibit interrupts until runWorker\n         this.firstTask = firstTask;\n         this.thread = getThreadFactory().newThread(this); // \n     }\n     /** Delegates main run loop to outer runWorker  */\n     public void run() {\n         runWorker(this);\n     }\n     // ...\n }\n\n\n * AQS\n * Runnable\n * firstTaskWorker\n\n:\n\n//,addWorkerworker\nfinal Thread thread;\n//worker,\nRunnable firstTask;\n//\nvolatile long completedTasks;\n\nWorker(Runnable firstTask) {\n    setState(-1); // inhibit interrupts until runWorker\n    this.firstTask = firstTask;\n    //Thread,,thread,workerrun\n    this.thread = getThreadFactory().newThread(this);\n}   \n\n\nrunWorker:\n\n * unlockAQSstate0\n * WorkerfirstTaskworkQueue:\n   * thread()\n   * \n   * beforeExecute\n   * run\n   * afterExecute\n   * \n\n> getTaskgetTaskcpu\n\nfinal void runWorker(Worker w) {\n    Thread wt = Thread.currentThread();\n    Runnable task = w.firstTask;\n    w.firstTask = null;\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true;\n    try {\n        // firstTaskworkerQueuetask(getTask())\n\n        while (task != null || (task = getTask()) != null) {\n            w.lock();\n            // If pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  This\n            // requires a recheck in second case to deal with\n            // shutdownNow race while clearing interrupt\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                    (Thread.interrupted() &&\n                    runStateAtLeast(ctl.get(), STOP))) &&\n                !wt.isInterrupted())\n                wt.interrupt();\n            try {\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    task.run();\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    thrown = x; throw new Error(x);\n                } finally {\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedTasks++;\n                w.unlock();\n            }\n        }\n        completedAbruptly = false;\n    } finally {\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n\n\n# getTask\n\ngetTask()keepAliveTimecorePoolSizeworker\n\nprivate Runnable getTask() {\n    boolean timedOut = false; // Did the last poll() time out?\n\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        if (rs >= SHUTDOWN && (rs >= STOP || workQueue.isEmpty())) {\n            decrementWorkerCount();\n            return null;\n        }\n\n        int wc = workerCountOf(c);\n\n        // Are workers subject to culling?\n        boolean timed = allowCoreThreadTimeOut || wc > corePoolSize;\n\n        if ((wc > maximumPoolSize || (timed && timedOut))\n            && (wc > 1 || workQueue.isEmpty())) {\n            if (compareAndDecrementWorkerCount(c))\n                return null;\n            continue;\n        }\n\n        try {\n            Runnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :\n                workQueue.take();\n            if (r != null)\n                return r;\n            timedOut = true;\n        } catch (InterruptedException retry) {\n            timedOut = false;\n        }\n    }\n}\n\n\nkeepAliveTime:\n\nboolean timed = allowCoreThreadTimeOut || wc > corePoolSize;\nRunnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :\n                workQueue.take();\n\n\nallowCoreThreadTimeOutfalseturekeepAliveTime\n\ntimed == falseworkQueue.take: take\n\ntimed == true, workQueue.poll: keepAliveTimenull\n\n\n# \n\n\n\n 1. submitexecute\n 2. FutureTaskgetWaitNodewaiters \n 3. FutureTaskUNSAFEwaiterswaitNodenullLockSupportunpark\n\npublic class Test{\n    public static void main(String[] args) {\n\n        ExecutorService es = Executors.newCachedThreadPool();\n        Future<String> future = es.submit(new Callable<String>() {\n            @Override\n            public String call() throws Exception {\n                try {\n                    TimeUnit.SECONDS.sleep(2);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                return "future result";\n            }\n        });\n        try {\n            String result = future.get();\n            System.out.println(result);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\nFutureCallableCallableFuture\n\n 1. CallableRunnableRunnable\n 2. CallableFuture\n 3. Future.getCallable\n\n# submit\n\nAbstractExecutorService.submit()ExecutorService.submit() , ThreadPoolExecutor AbstractExecutorService.submit()submitThreadPoolExecutor`\n\n// submit()ExecutorService\n<T> Future<T> submit(Callable<T> task);\n\n<T> Future<T> submit(Runnable task, T result);\n\nFuture<?> submit(Runnable task);\n\n\n// submitAbstractExecutorService\npublic Future<?> submit(Runnable task) {\n    if (task == null) throw new NullPointerException();\n    // submitCallableFutureTask\n    RunnableFuture<Void> ftask = newTaskFor(task, null);\n    execute(ftask);\n    return ftask;\n}\n\n\nsubmitCallableFutureTaskExecutor.executeFutureTaskFutureTaskrun\n\n# FutureTask\n\npublic class FutureTask<V> implements RunnableFuture<V> FutureTask(FutureTaskrun)\n\n * \n\n/* The run state of this task, initially NEW. \n    * ...\n    * Possible state transitions:\n    * NEW -> COMPLETING -> NORMAL\n    * NEW -> COMPLETING -> EXCEPTIONAL\n    * NEW -> CANCELLED\n    * NEW -> INTERRUPTING -> INTERRUPTED\n    */\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n\n\nsun.misc.Unsafe\n\n * get\n\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n} \n\n\nawaitDone:\n\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (Thread.interrupted()) {\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet\n            Thread.yield();\n        else if (q == null)\n            q = new WaitNode();\n        else if (!queued)\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,q.next = waiters, q);\n        else if (timed) {\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);\n        }\n        else\n            LockSupport.park(this);\n    }\n}\n\n\n 1. \n 2. FutureTaskstateCOMPLETING\n 3. stateCOMPLETINGyieldcpustateNORMAL\n 4. WaitNodeUNSAFEwaiters\n 5. LockSupportparkparkNanos\n\nrun\n\npublic void run() {\n    if (state != NEW || !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread()))\n        return;\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n\n\nFutureTask.run\n\n 1. Callablecall\n 2. callset\n 3. callsetException\n\n\n# \n\nshutdownSHUTDOWN,,,\n\npublic void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        //\n        checkShutdownAccess();\n        //\n        advanceRunState(SHUTDOWN);\n        //worker\n        interruptIdleWorkers();\n            //,\n        onShutdown(); // hook for ScheduledThreadPoolExecutor\n    } finally {\n        mainLock.unlock();\n    }\n    tryTerminate();\n}\n\nprivate void interruptIdleWorkers() {\n    interruptIdleWorkers(false);\n}\n\nprivate void interruptIdleWorkers(boolean onlyOne) {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        //worker\n        for (Worker w : workers) {\n            Thread t = w.thread;\n            //w.tryLock(),,worker,\n            //,workerAQS,\n            //,worker,,tryLock()false\n            if (!t.isInterrupted() && w.tryLock()) {\n                try {\n                    t.interrupt();\n                } catch (SecurityException ignore) {\n                } finally {\n                    w.unlock();\n                }\n            }\n            if (onlyOne)\n                break;\n        }\n    } finally {\n        mainLock.unlock();\n    }\n}\n\n\nshutdownNowSTOPworker,\n\npublic List<Runnable> shutdownNow() {\n    List<Runnable> tasks;\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        //\n        advanceRunState(STOP);\n        //worker\n        interruptWorkers();\n        //\n        tasks = drainQueue();\n    } finally {\n        mainLock.unlock();\n    }\n    tryTerminate();\n    return tasks;\n}\n\nprivate void interruptWorkers() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        //worker\n        for (Worker w : workers)\n            w.interruptIfStarted();\n    } finally {\n        mainLock.unlock();\n    }\n}\n\n\n\n# \n\n\n# Executors? ?\n\nExecutorsThreadPoolExecutor Executors\n\n * newFixedThreadPoolnewSingleThreadExecutor: OOM\n * newCachedThreadPoolnewScheduledThreadPool: Integer.MAX_VALUEOOM\n\n#  1\n\ncommons-lang3\n\nScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1,\n        new BasicThreadFactory.Builder().namingPattern("example-schedule-pool-%d").daemon(true).build());\n\n\n# 2\n\ncom.google.guava\n\nThreadFactory namedThreadFactory = new ThreadFactoryBuilder().setNameFormat("demo-pool-%d").build();\n\n//Common Thread Pool\nExecutorService pool = new ThreadPoolExecutor(5, 200, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<Runnable>(1024), namedThreadFactory, new ThreadPoolExecutor.AbortPolicy());\n\n// excute\npool.execute(()-> System.out.println(Thread.currentThread().getName()));\n\n //gracefully shutdown\npool.shutdown();\n\n\n# 3\n\nspringbeanThreadFactorybeanexecute(Runnable task)\n\n    <bean id="userThreadPool" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">\n        <property name="corePoolSize" value="10" />\n        <property name="maxPoolSize" value="100" />\n        <property name="queueCapacity" value="2000" />\n\n    <property name="threadFactory" value= threadFactory />\n        <property name="rejectedExecutionHandler">\n            <ref local="rejectedExecutionHandler" />\n        </property>\n    </bean>\n    \n    //in code\n    userThreadPool.execute(thread);\n\n\n\n# \n\n(CPU/ IO)\n\n:\n\n * CPU: Ncpu+1\n * IO: , Ncpu*2\n * : CPUIO\n\n\n# \n\nThreadPoolExecutor:\n\n * getTaskCount() Returns the approximate total number of tasks that have ever been scheduled for execution.\n * getCompletedTaskCount() Returns the approximate total number of tasks that have completed execution. getTaskCount()\n * getLargestPoolSize() Returns the largest number of threads that have ever simultaneously been in the pool. maximumPoolSize\n * getPoolSize() Returns the current number of threads in the pool.\n * getActiveCount() Returns the approximate number of threads that are actively executing tasks.\n\n\n# \n\n * Java\n * https://www.jianshu.com/p/87bff5cc8d8c\n * https://blog.csdn.net/programmer_at/article/details/79799267\n * https://blog.csdn.net/u013332124/article/details/79587436\n * https://www.journaldev.com/1069/threadpoolexecutor-java-thread-pool-example-executorservice\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html',normalizedContent:'# juc: threadpoolexecutor\n\n> threadpoolexecutor\n\n * juc: threadpoolexecutor\n   * bat\n   * \n   * threadpoolexecutor\n   * threadpoolexecutor\n     * execute\n     * \n     * \n       * newfixedthreadpool\n       * newsinglethreadexecutor\n       * newcachedthreadpool\n     * \n       *  - shutdown\n       *  - shutdownnow\n   * threadpoolexecutor\n     * \n     * \n     * \n       * execute()\n       * addworker\n       * workerrunworker\n       * gettask\n     * \n       * submit\n       * futuretask\n     * \n   * \n     * executors? ?\n       *  1\n       * 2\n       * 3\n     * \n     * \n   * \n\n\n# bat\n\n\n\n\n\n * ?\n * java? \n * executors? ?\n * threadpoolexecutor? \n * threadpoolexecutor?\n * workermaxsize?\n * threadpoolexecutorrejectedexecutionhandler? ?\n * ? execute > addworker >runworker (gettask)\n * ?\n * ?\n * ?\n * ?\n\n\n# \n\n:\n\n * ()\n * ()\n * \n\n\n# threadpoolexecutor\n\njava?\n\njdk 5runnablecallableexecutor\n\n * workerthread\n\npublic class workerthread implements runnable {\n     \n    private string command;\n     \n    public workerthread(string s){\n        this.command=s;\n    }\n \n    @override\n    public void run() {\n        system.out.println(thread.currentthread().getname()+" start. command = "+command);\n        processcommand();\n        system.out.println(thread.currentthread().getname()+" end.");\n    }\n \n    private void processcommand() {\n        try {\n            thread.sleep(5000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n \n    @override\n    public string tostring(){\n        return this.command;\n    }\n}\n\n\n * simplethreadpool\n\nimport java.util.concurrent.executorservice;\nimport java.util.concurrent.executors;\n \npublic class simplethreadpool {\n \n    public static void main(string[] args) {\n        executorservice executor = executors.newfixedthreadpool(5);\n        for (int i = 0; i < 10; i++) {\n            runnable worker = new workerthread("" + i);\n            executor.execute(worker);\n          }\n        executor.shutdown(); // this will make the executor accept no new threads and finish all existing threads in the queue\n        while (!executor.isterminated()) { // wait until all threads are finish,and also you can use "executor.awaittermination();" to wait\n        }\n        system.out.println("finished all threads");\n    }\n\n}\n\n\n\n\n\n\npool-1-thread-2 start. command = 1\npool-1-thread-4 start. command = 3\npool-1-thread-1 start. command = 0\npool-1-thread-3 start. command = 2\npool-1-thread-5 start. command = 4\npool-1-thread-4 end.\npool-1-thread-5 end.\npool-1-thread-1 end.\npool-1-thread-3 end.\npool-1-thread-3 start. command = 8\npool-1-thread-2 end.\npool-1-thread-2 start. command = 9\npool-1-thread-1 start. command = 7\npool-1-thread-5 start. command = 6\npool-1-thread-4 start. command = 5\npool-1-thread-2 end.\npool-1-thread-4 end.\npool-1-thread-3 end.\npool-1-thread-5 end.\npool-1-thread-1 end.\nfinished all threads\n\n\n "pool-1-thread-1"  "pool-1-thread-5" \n\nexecutors  threadpoolexecutor  executorservice  threadpoolexecutor  threadpoolexecutor  rejectedexecutionhandler \n\n rejectedexecutionhandler \n\n * rejectedexecutionhandlerimpl.java\n\nimport java.util.concurrent.rejectedexecutionhandler;\nimport java.util.concurrent.threadpoolexecutor;\n \npublic class rejectedexecutionhandlerimpl implements rejectedexecutionhandler {\n \n    @override\n    public void rejectedexecution(runnable r, threadpoolexecutor executor) {\n        system.out.println(r.tostring() + " is rejected");\n    }\n \n}\n\n\nthreadpoolexecutor  executor  executor \n\n * mymonitorthread.java\n\nimport java.util.concurrent.threadpoolexecutor;\n \npublic class mymonitorthread implements runnable\n{\n    private threadpoolexecutor executor;\n     \n    private int seconds;\n     \n    private boolean run=true;\n \n    public mymonitorthread(threadpoolexecutor executor, int delay)\n    {\n        this.executor = executor;\n        this.seconds=delay;\n    }\n     \n    public void shutdown(){\n        this.run=false;\n    }\n \n    @override\n    public void run()\n    {\n        while(run){\n                system.out.println(\n                    string.format("[monitor] [%d/%d] active: %d, completed: %d, task: %d, isshutdown: %s, isterminated: %s",\n                        this.executor.getpoolsize(),\n                        this.executor.getcorepoolsize(),\n                        this.executor.getactivecount(),\n                        this.executor.getcompletedtaskcount(),\n                        this.executor.gettaskcount(),\n                        this.executor.isshutdown(),\n                        this.executor.isterminated()));\n                try {\n                    thread.sleep(seconds*1000);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n        }\n             \n    }\n}\n\n\n threadpoolexecutor \n\n * workerpool.java\n\nimport java.util.concurrent.arrayblockingqueue;\nimport java.util.concurrent.executors;\nimport java.util.concurrent.threadfactory;\nimport java.util.concurrent.threadpoolexecutor;\nimport java.util.concurrent.timeunit;\n \npublic class workerpool {\n \n    public static void main(string args[]) throws interruptedexception{\n        //rejectedexecutionhandler implementation\n        rejectedexecutionhandlerimpl rejectionhandler = new rejectedexecutionhandlerimpl();\n        //get the threadfactory implementation to use\n        threadfactory threadfactory = executors.defaultthreadfactory();\n        //creating the threadpoolexecutor\n        threadpoolexecutor executorpool = new threadpoolexecutor(2, 4, 10, timeunit.seconds, new arrayblockingqueue<runnable>(2), threadfactory, rejectionhandler);\n        //start the monitoring thread\n        mymonitorthread monitor = new mymonitorthread(executorpool, 3);\n        thread monitorthread = new thread(monitor);\n        monitorthread.start();\n        //submit work to the thread pool\n        for(int i=0; i<10; i++){\n            executorpool.execute(new workerthread("cmd"+i));\n        }\n         \n        thread.sleep(30000);\n        //shut down the pool\n        executorpool.shutdown();\n        //shut down the monitor thread\n        thread.sleep(5000);\n        monitor.shutdown();\n         \n    }\n}\n\n\n threadpoolexecutor  2 4  2() rejectedexecutionhandlerimpl \n\n\n\npool-1-thread-1 start. command = cmd0\npool-1-thread-4 start. command = cmd5\ncmd6 is rejected\npool-1-thread-3 start. command = cmd4\npool-1-thread-2 start. command = cmd1\ncmd7 is rejected\ncmd8 is rejected\ncmd9 is rejected\n[monitor] [0/2] active: 4, completed: 0, task: 6, isshutdown: false, isterminated: false\n[monitor] [4/2] active: 4, completed: 0, task: 6, isshutdown: false, isterminated: false\npool-1-thread-4 end.\npool-1-thread-1 end.\npool-1-thread-2 end.\npool-1-thread-3 end.\npool-1-thread-1 start. command = cmd3\npool-1-thread-4 start. command = cmd2\n[monitor] [4/2] active: 2, completed: 4, task: 6, isshutdown: false, isterminated: false\n[monitor] [4/2] active: 2, completed: 4, task: 6, isshutdown: false, isterminated: false\npool-1-thread-1 end.\npool-1-thread-4 end.\n[monitor] [4/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [2/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [2/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [2/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [2/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [2/2] active: 0, completed: 6, task: 6, isshutdown: false, isterminated: false\n[monitor] [0/2] active: 0, completed: 6, task: 6, isshutdown: true, isterminated: true\n[monitor] [0/2] active: 0, completed: 6, task: 6, isshutdown: true, isterminated: true\n\n\n executor  shutdown() \n\n\n# threadpoolexecutor\n\njavaworkersetworkqueue()workqueueworkersetworkqueueworkqueueworker\n\n\n\n\n# execute\n\n:\n\n 1. corepoolsize2.\n 2. blockingqueueblockingqueue3.\n 3. maximumpoolsizerejectedexecutionhandler\n\nthreadpoolexecutorcasctl.\n\n\n# \n\npublic threadpoolexecutor(int corepoolsize,\n                              int maximumpoolsize,\n                              long keepalivetime,\n                              timeunit unit,\n                              blockingqueue<runnable> workqueue,\n                              rejectedexecutionhandler handler)\n\n\n * corepoolsize corepoolsize, , corepoolsizeprestartallcorethreads()\n\n * workqueue . jdk: juc : blockqueue\n   \n   * arrayblockingqueue: fifo\n   * linkedblockingqueue: fifoarrayblockingqueue\n   * synchronousqueue: linkedblockingqueue\n   * priorityblockingqueue: \n\nlinkedblockingqueuearrayblockingqueueput(), take()synchronousqueuetransfer.transfer().\n\n * maximumpoolsize maximumpoolsize, maximumpoolsize, workqueue.\n\n * keepalivetime corepoolsize, \n\n * unit keepalivetime\n\n * threadfactory defaultthreadfactory\n\n * handler 4:\n   \n   * abortpolicy: \n   * callerrunspolicy: \n   * discardoldestpolicy: \n   * discardpolicy: \n\nrejectedexecutionhandler\n\n\n# \n\n# newfixedthreadpool\n\npublic static executorservice newfixedthreadpool(int nthreads) {\n    return new threadpoolexecutor(nthreads, nthreads,\n                                0l, timeunit.milliseconds,\n                                new linkedblockingqueue<runnable>());\n}\n\n\ncorepoolsize\n\nfixedthreadpoollinkedblockingqueue(integer.max_value), :\n\n * corepoolsize,maximumpoolsizekeepalivetime\n * , fixedthreadpool, \n\n# newsinglethreadexecutor\n\npublic static executorservice newsinglethreadexecutor() {\n    return new finalizabledelegatedexecutorservice\n        (new threadpoolexecutor(1, 1,\n                                0l, timeunit.milliseconds,\n                                new linkedblockingqueue<runnable>()));\n}\n\n\n.\n\n, singlethreadpool, \n\n# newcachedthreadpool\n\npublic static executorservice newcachedthreadpool() {\n    return new threadpoolexecutor(0, integer.max_value,\n                                    60l, timeunit.seconds,\n                                    new synchronousqueue<runnable>());\n}\n\n\ninteger.max_value2147483647synchronousqueue newfixedthreadpoolnewcachedthreadpoolkeepalivetime :\n\n * synchronousqueueoffer()task,  synchronousqueuetask, synchronousqueuepoll(), task. (2)\n * , .\n * 60s, . cachedthreadpool.\n\n\n# \n\ninterrupt.\n\n#  - shutdown\n\nshutdown, .\n\n#  - shutdownnow\n\nstop, . , isshutdown() true. , isterminated()true.\n\n\n# threadpoolexecutor\n\n\n# \n\n// worker\n//int32int3,29worker\nprivate final atomicinteger ctl = new atomicinteger(ctlof(running, 0));\n//\nprivate final blockingqueue<runnable> workqueue;\n//worker,set\nprivate final hashset<worker> workers = new hashset<worker>();\n//worker\nprivate int largestpoolsize;\n//workermaxsize,\nprivate volatile rejectedexecutionhandler handler;\n//coresizeworker\nprivate volatile long keepalivetime;\n//worker\nprivate volatile int corepoolsize;\n//worker,workqueue\nprivate volatile int maximumpoolsize;\n\n\n\n# \n\nprivate final atomicinteger ctl = new atomicinteger(ctlof(running, 0));\nprivate static final int count_bits = integer.size - 3;\nprivate static final int capacity   = (1 << count_bits) - 1;\n\n// runstate is stored in the high-order bits\nprivate static final int running    = -1 << count_bits;\nprivate static final int shutdown   =  0 << count_bits;\nprivate static final int stop       =  1 << count_bits;\nprivate static final int tidying    =  2 << count_bits;\nprivate static final int terminated =  3 << count_bits;\n\n// packing and unpacking ctl\nprivate static int runstateof(int c)     { return c & ~capacity; }\nprivate static int workercountof(int c)  { return c & capacity; }\nprivate static int ctlof(int rs, int wc) { return rs | wc; }\n\n\natomicintegerctl: 293:\n\n * running: -1 << count_bits3111\n * shutdown: 0 << count_bits3000\n * stop : 1 << count_bits3001\n * tidying : 2 << count_bits3010, \n * terminated: 3 << count_bits3011, terminated()\n\n\n\n\n# \n\n> execute > addworker >runworker (gettask)\n\nwokerreentrantlockwokerhashsetwoker woker: threadwokerthisstartthreadworkerrunworker firsttaskgettaskgettaskcpu\n\n# execute()\n\nthreadpoolexecutor.execute(task)executor.execute(task)\n\npublic void execute(runnable command) {\n    if (command == null)\n        throw new nullpointerexception();\n    /*\n     * proceed in 3 steps:\n     *\n     * 1. if fewer than corepoolsize threads are running, try to\n     * start a new thread with the given command as its first\n     * task.  the call to addworker atomically checks runstate and\n     * workercount, and so prevents false alarms that would add\n     * threads when it shouldn\'t, by returning false.\n     *\n     * 2. if a task can be successfully queued, then we still need\n     * to double-check whether we should have added a thread\n     * (because existing ones died since last checking) or that\n     * the pool shut down since entry into this method. so we\n     * recheck state and if necessary roll back the enqueuing if\n     * stopped, or start a new thread if there are none.\n     *\n     * 3. if we cannot queue task, then we try to add a new\n     * thread.  if it fails, we know we are shut down or saturated\n     * and so reject the task.\n     */\n    int c = ctl.get();\n    if (workercountof(c) < corepoolsize) {  \n    //workercountofcorepoolsizeaddworkercommand\n       if (addworker(command, true))\n            return;\n        c = ctl.get();\n    }\n    // double check: c, recheck\n    // running\n    if (isrunning(c) && workqueue.offer(command)) {\n        int recheck = ctl.get();\n        // recheck and if necessary shutdownremove(command)\n        //runningreject\n        if (! isrunning(recheck) && remove(command))\n            reject(command);\n        //running\n        else if (workercountof(recheck) == 0)\n            addworker(null, false);\n    }\n    // reject\n    else if (!addworker(command, false))\n        reject(command);\n}\n\n\n * double check?\n\nctl.get()commandworkquedouble checkrunning()command\n\n# addworker\n\nexecute: addworker  :\n\nprivate final reentrantlock mainlock = new reentrantlock();\n\n\nprivate boolean addworker(runnable firsttask, boolean core) {\n    // cas\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runstateof(c);\n\n        // check if queue empty only if necessary.\n        if (rs >= shutdown &&\n            ! (rs == shutdown &&\n                firsttask == null &&\n                ! workqueue.isempty()))\n            return false;\n\n        for (;;) {\n            int wc = workercountof(c);\n            if (wc >= capacity ||\n                wc >= (core ? corepoolsize : maximumpoolsize))\n                return false;\n            if (compareandincrementworkercount(c))\n                break retry;\n            c = ctl.get();  // re-read ctl\n            if (runstateof(c) != rs)\n                continue retry;\n            // else cas failed due to workercount change; retry inner loop\n        }\n    }\n\n    boolean workerstarted = false;\n    boolean workeradded = false;\n    worker w = null;\n    try {\n        w = new worker(firsttask);\n        final thread t = w.thread;\n        if (t != null) {\n            // \n            final reentrantlock mainlock = this.mainlock;\n            mainlock.lock();\n            try {\n                // recheck while holding lock.\n                // back out on threadfactory failure or if\n                // shut down before lock acquired.\n                int rs = runstateof(ctl.get());\n\n                if (rs < shutdown ||\n                    (rs == shutdown && firsttask == null)) {\n                    if (t.isalive()) // precheck that t is startable\n                        throw new illegalthreadstateexception();\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s > largestpoolsize)\n                        largestpoolsize = s;\n                    workeradded = true;\n                }\n            } finally {\n                mainlock.unlock();\n            }\n            if (workeradded) {\n                t.start();  // (worker.thread(firsttask).start());\n                workerstarted = true;\n            }\n        }\n    } finally {\n        if (! workerstarted)\n            addworkerfailed(w);\n    }\n    return workerstarted;\n}\n\n\n# workerrunworker\n\n private final class worker extends abstractqueuedsynchronizer implements runnable{\n     worker(runnable firsttask) {\n         setstate(-1); // inhibit interrupts until runworker\n         this.firsttask = firsttask;\n         this.thread = getthreadfactory().newthread(this); // \n     }\n     /** delegates main run loop to outer runworker  */\n     public void run() {\n         runworker(this);\n     }\n     // ...\n }\n\n\n * aqs\n * runnable\n * firsttaskworker\n\n:\n\n//,addworkerworker\nfinal thread thread;\n//worker,\nrunnable firsttask;\n//\nvolatile long completedtasks;\n\nworker(runnable firsttask) {\n    setstate(-1); // inhibit interrupts until runworker\n    this.firsttask = firsttask;\n    //thread,,thread,workerrun\n    this.thread = getthreadfactory().newthread(this);\n}   \n\n\nrunworker:\n\n * unlockaqsstate0\n * workerfirsttaskworkqueue:\n   * thread()\n   * \n   * beforeexecute\n   * run\n   * afterexecute\n   * \n\n> gettaskgettaskcpu\n\nfinal void runworker(worker w) {\n    thread wt = thread.currentthread();\n    runnable task = w.firsttask;\n    w.firsttask = null;\n    w.unlock(); // allow interrupts\n    boolean completedabruptly = true;\n    try {\n        // firsttaskworkerqueuetask(gettask())\n\n        while (task != null || (task = gettask()) != null) {\n            w.lock();\n            // if pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  this\n            // requires a recheck in second case to deal with\n            // shutdownnow race while clearing interrupt\n            if ((runstateatleast(ctl.get(), stop) ||\n                    (thread.interrupted() &&\n                    runstateatleast(ctl.get(), stop))) &&\n                !wt.isinterrupted())\n                wt.interrupt();\n            try {\n                beforeexecute(wt, task);\n                throwable thrown = null;\n                try {\n                    task.run();\n                } catch (runtimeexception x) {\n                    thrown = x; throw x;\n                } catch (error x) {\n                    thrown = x; throw x;\n                } catch (throwable x) {\n                    thrown = x; throw new error(x);\n                } finally {\n                    afterexecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedtasks++;\n                w.unlock();\n            }\n        }\n        completedabruptly = false;\n    } finally {\n        processworkerexit(w, completedabruptly);\n    }\n}\n\n\n# gettask\n\ngettask()keepalivetimecorepoolsizeworker\n\nprivate runnable gettask() {\n    boolean timedout = false; // did the last poll() time out?\n\n    for (;;) {\n        int c = ctl.get();\n        int rs = runstateof(c);\n\n        // check if queue empty only if necessary.\n        if (rs >= shutdown && (rs >= stop || workqueue.isempty())) {\n            decrementworkercount();\n            return null;\n        }\n\n        int wc = workercountof(c);\n\n        // are workers subject to culling?\n        boolean timed = allowcorethreadtimeout || wc > corepoolsize;\n\n        if ((wc > maximumpoolsize || (timed && timedout))\n            && (wc > 1 || workqueue.isempty())) {\n            if (compareanddecrementworkercount(c))\n                return null;\n            continue;\n        }\n\n        try {\n            runnable r = timed ?\n                workqueue.poll(keepalivetime, timeunit.nanoseconds) :\n                workqueue.take();\n            if (r != null)\n                return r;\n            timedout = true;\n        } catch (interruptedexception retry) {\n            timedout = false;\n        }\n    }\n}\n\n\nkeepalivetime:\n\nboolean timed = allowcorethreadtimeout || wc > corepoolsize;\nrunnable r = timed ?\n                workqueue.poll(keepalivetime, timeunit.nanoseconds) :\n                workqueue.take();\n\n\nallowcorethreadtimeoutfalseturekeepalivetime\n\ntimed == falseworkqueue.take: take\n\ntimed == true, workqueue.poll: keepalivetimenull\n\n\n# \n\n\n\n 1. submitexecute\n 2. futuretaskgetwaitnodewaiters \n 3. futuretaskunsafewaiterswaitnodenulllocksupportunpark\n\npublic class test{\n    public static void main(string[] args) {\n\n        executorservice es = executors.newcachedthreadpool();\n        future<string> future = es.submit(new callable<string>() {\n            @override\n            public string call() throws exception {\n                try {\n                    timeunit.seconds.sleep(2);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n                return "future result";\n            }\n        });\n        try {\n            string result = future.get();\n            system.out.println(result);\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\nfuturecallablecallablefuture\n\n 1. callablerunnablerunnable\n 2. callablefuture\n 3. future.getcallable\n\n# submit\n\nabstractexecutorservice.submit()executorservice.submit() , threadpoolexecutor abstractexecutorservice.submit()submitthreadpoolexecutor`\n\n// submit()executorservice\n<t> future<t> submit(callable<t> task);\n\n<t> future<t> submit(runnable task, t result);\n\nfuture<?> submit(runnable task);\n\n\n// submitabstractexecutorservice\npublic future<?> submit(runnable task) {\n    if (task == null) throw new nullpointerexception();\n    // submitcallablefuturetask\n    runnablefuture<void> ftask = newtaskfor(task, null);\n    execute(ftask);\n    return ftask;\n}\n\n\nsubmitcallablefuturetaskexecutor.executefuturetaskfuturetaskrun\n\n# futuretask\n\npublic class futuretask<v> implements runnablefuture<v> futuretask(futuretaskrun)\n\n * \n\n/* the run state of this task, initially new. \n    * ...\n    * possible state transitions:\n    * new -> completing -> normal\n    * new -> completing -> exceptional\n    * new -> cancelled\n    * new -> interrupting -> interrupted\n    */\nprivate volatile int state;\nprivate static final int new          = 0;\nprivate static final int completing   = 1;\nprivate static final int normal       = 2;\nprivate static final int exceptional  = 3;\nprivate static final int cancelled    = 4;\nprivate static final int interrupting = 5;\nprivate static final int interrupted  = 6;\n\n\nsun.misc.unsafe\n\n * get\n\npublic v get() throws interruptedexception, executionexception {\n    int s = state;\n    if (s <= completing)\n        s = awaitdone(false, 0l);\n    return report(s);\n} \n\n\nawaitdone:\n\nprivate int awaitdone(boolean timed, long nanos)\n    throws interruptedexception {\n    final long deadline = timed ? system.nanotime() + nanos : 0l;\n    waitnode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (thread.interrupted()) {\n            removewaiter(q);\n            throw new interruptedexception();\n        }\n\n        int s = state;\n        if (s > completing) {\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == completing) // cannot time out yet\n            thread.yield();\n        else if (q == null)\n            q = new waitnode();\n        else if (!queued)\n            queued = unsafe.compareandswapobject(this, waitersoffset,q.next = waiters, q);\n        else if (timed) {\n            nanos = deadline - system.nanotime();\n            if (nanos <= 0l) {\n                removewaiter(q);\n                return state;\n            }\n            locksupport.parknanos(this, nanos);\n        }\n        else\n            locksupport.park(this);\n    }\n}\n\n\n 1. \n 2. futuretaskstatecompleting\n 3. statecompletingyieldcpustatenormal\n 4. waitnodeunsafewaiters\n 5. locksupportparkparknanos\n\nrun\n\npublic void run() {\n    if (state != new || !unsafe.compareandswapobject(this, runneroffset, null, thread.currentthread()))\n        return;\n    try {\n        callable<v> c = callable;\n        if (c != null && state == new) {\n            v result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (throwable ex) {\n                result = null;\n                ran = false;\n                setexception(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        int s = state;\n        if (s >= interrupting)\n            handlepossiblecancellationinterrupt(s);\n    }\n}\n\n\nfuturetask.run\n\n 1. callablecall\n 2. callset\n 3. callsetexception\n\n\n# \n\nshutdownshutdown,,,\n\npublic void shutdown() {\n    final reentrantlock mainlock = this.mainlock;\n    mainlock.lock();\n    try {\n        //\n        checkshutdownaccess();\n        //\n        advancerunstate(shutdown);\n        //worker\n        interruptidleworkers();\n            //,\n        onshutdown(); // hook for scheduledthreadpoolexecutor\n    } finally {\n        mainlock.unlock();\n    }\n    tryterminate();\n}\n\nprivate void interruptidleworkers() {\n    interruptidleworkers(false);\n}\n\nprivate void interruptidleworkers(boolean onlyone) {\n    final reentrantlock mainlock = this.mainlock;\n    mainlock.lock();\n    try {\n        //worker\n        for (worker w : workers) {\n            thread t = w.thread;\n            //w.trylock(),,worker,\n            //,workeraqs,\n            //,worker,,trylock()false\n            if (!t.isinterrupted() && w.trylock()) {\n                try {\n                    t.interrupt();\n                } catch (securityexception ignore) {\n                } finally {\n                    w.unlock();\n                }\n            }\n            if (onlyone)\n                break;\n        }\n    } finally {\n        mainlock.unlock();\n    }\n}\n\n\nshutdownnowstopworker,\n\npublic list<runnable> shutdownnow() {\n    list<runnable> tasks;\n    final reentrantlock mainlock = this.mainlock;\n    mainlock.lock();\n    try {\n        checkshutdownaccess();\n        //\n        advancerunstate(stop);\n        //worker\n        interruptworkers();\n        //\n        tasks = drainqueue();\n    } finally {\n        mainlock.unlock();\n    }\n    tryterminate();\n    return tasks;\n}\n\nprivate void interruptworkers() {\n    final reentrantlock mainlock = this.mainlock;\n    mainlock.lock();\n    try {\n        //worker\n        for (worker w : workers)\n            w.interruptifstarted();\n    } finally {\n        mainlock.unlock();\n    }\n}\n\n\n\n# \n\n\n# executors? ?\n\nexecutorsthreadpoolexecutor executors\n\n * newfixedthreadpoolnewsinglethreadexecutor: oom\n * newcachedthreadpoolnewscheduledthreadpool: integer.max_valueoom\n\n#  1\n\ncommons-lang3\n\nscheduledexecutorservice executorservice = new scheduledthreadpoolexecutor(1,\n        new basicthreadfactory.builder().namingpattern("example-schedule-pool-%d").daemon(true).build());\n\n\n# 2\n\ncom.google.guava\n\nthreadfactory namedthreadfactory = new threadfactorybuilder().setnameformat("demo-pool-%d").build();\n\n//common thread pool\nexecutorservice pool = new threadpoolexecutor(5, 200, 0l, timeunit.milliseconds, new linkedblockingqueue<runnable>(1024), namedthreadfactory, new threadpoolexecutor.abortpolicy());\n\n// excute\npool.execute(()-> system.out.println(thread.currentthread().getname()));\n\n //gracefully shutdown\npool.shutdown();\n\n\n# 3\n\nspringbeanthreadfactorybeanexecute(runnable task)\n\n    <bean id="userthreadpool" class="org.springframework.scheduling.concurrent.threadpooltaskexecutor">\n        <property name="corepoolsize" value="10" />\n        <property name="maxpoolsize" value="100" />\n        <property name="queuecapacity" value="2000" />\n\n    <property name="threadfactory" value= threadfactory />\n        <property name="rejectedexecutionhandler">\n            <ref local="rejectedexecutionhandler" />\n        </property>\n    </bean>\n    \n    //in code\n    userthreadpool.execute(thread);\n\n\n\n# \n\n(cpu/ io)\n\n:\n\n * cpu: ncpu+1\n * io: , ncpu*2\n * : cpuio\n\n\n# \n\nthreadpoolexecutor:\n\n * gettaskcount() returns the approximate total number of tasks that have ever been scheduled for execution.\n * getcompletedtaskcount() returns the approximate total number of tasks that have completed execution. gettaskcount()\n * getlargestpoolsize() returns the largest number of threads that have ever simultaneously been in the pool. maximumpoolsize\n * getpoolsize() returns the current number of threads in the pool.\n * getactivecount() returns the approximate number of threads that are actively executing tasks.\n\n\n# \n\n * java\n * https://www.jianshu.com/p/87bff5cc8d8c\n * https://blog.csdn.net/programmer_at/article/details/79799267\n * https://blog.csdn.net/u013332124/article/details/79587436\n * https://www.journaldev.com/1069/threadpoolexecutor-java-thread-pool-example-executorservice\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-executor-threadpoolexecutor.html',charsets:{cjk:!0}},{title:"JUC: CountDownLatch",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-tool-countdownlatch.html",relativePath:"java/thread/java-thread-x-juc-tool-countdownlatch.md",key:"v-6403e0ae",path:"/java/thread/java-thread-x-juc-tool-countdownlatch.html",headers:[{level:2,title:"JUC: CountDownLatch",slug:"juc-countdownlatch",normalizedTitle:"juc: countdownlatch",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:129},{level:2,title:"CountDownLatch",slug:"countdownlatch",normalizedTitle:"countdownlatch",charIndex:150},{level:2,title:"CountDownLatch",slug:"countdownlatch",normalizedTitle:"countdownlatch",charIndex:172},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:198},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:212},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:225},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:237},{level:3,title:" - await",slug:"-await",normalizedTitle:" - await",charIndex:251},{level:3,title:" - countDown",slug:"-countdown",normalizedTitle:" - countdown",charIndex:273},{level:2,title:"CountDownLatch",slug:"countdownlatch",normalizedTitle:"countdownlatch",charIndex:297},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:319},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:332},{level:3,title:"waitnotify",slug:"waitnotify",normalizedTitle:"waitnotify",charIndex:345},{level:3,title:"CountDownLatch",slug:"countdownlatch",normalizedTitle:"countdownlatch",charIndex:368},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:390}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: CountDownLatch BAT CountDownLatch CountDownLatch      - await  - countDown CountDownLatch   waitnotify CountDownLatch ",content:'# JUC: CountDownLatch\n\n> CountDownLatchAQS\n\n * JUC: CountDownLatch\n   * BAT\n   * CountDownLatch\n   * CountDownLatch\n     * \n     * \n     * \n     * \n     *  - await\n     *  - countDown\n   * CountDownLatch\n   * \n     * \n     * waitnotify\n     * CountDownLatch\n   * \n\n\n# BAT\n\n\n\n\n\n * CountDownLatch?\n * CountDownLatch?\n * CountDownLatch? \n * CountDownLatch? await(),countDown()\n * CountDownLatch?\n * addsize 110252? CountDownLatch wait notify \n\n\n# CountDownLatch\n\nAQSAQSAQS: sync queue condition queueCountDownLatchnnCountDownLatchcountDownawait\n\n\n# CountDownLatch\n\n\n# \n\nCountDownLatch, AQSSync\n\npublic class CountDownLatch {}\n\n\n\n# \n\nCountDownLatchSyncAbstractQueuedSynchronizer\n\nprivate static final class Sync extends AbstractQueuedSynchronizer {\n    // \n    private static final long serialVersionUID = 4982264981922014374L;\n    \n    // \n    Sync(int count) {\n        setState(count);\n    }\n    \n    // \n    int getCount() {\n        return getState();\n    }\n\n    // \n    protected int tryAcquireShared(int acquires) {\n        return (getState() == 0) ? 1 : -1;\n    }\n\n    // \n    protected boolean tryReleaseShared(int releases) {\n        // Decrement count; signal when transition to zero\n        // \n        for (;;) {\n            // \n            int c = getState();\n            if (c == 0) // \n                return false;\n            // \n            int nextc = c-1;\n            if (compareAndSetState(c, nextc)) // \n                return nextc == 0;\n        }\n    }\n}\n\n\n: CountDownLatchSyncAQSAQSCountDownLatch\n\n\n# \n\nCountDownLatchSync:\n\npublic class CountDownLatch {\n    // \n    private final Sync sync;\n}\n\n\n\n# \n\npublic CountDownLatch(int count) {\n    if (count < 0) throw new IllegalArgumentException("count < 0");\n    // \n    this.sync = new Sync(count);\n}\n\n\n: CountDownLatchsync\n\n\n#  - await\n\n\n\npublic void await() throws InterruptedException {\n    // sync\n    sync.acquireSharedInterruptibly(1);\n}\n\n\n: CountDownLatchawaitSyncacquireSharedInterruptibly(AQS)\n\n * acquireSharedInterruptibly:\n\npublic final void acquireSharedInterruptibly(int arg)\n        throws InterruptedException {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    if (tryAcquireShared(arg) < 0)\n        doAcquireSharedInterruptibly(arg);\n}\n\n\n: acquireSharedInterruptiblyCountDownLatchSynctryAcquireSharedAQSdoAcquireSharedInterruptibly\n\n * tryAcquireShared:\n\nprotected int tryAcquireShared(int acquires) {\n    return (getState() == 0) ? 1 : -1;\n}\n\n\n: AQSstate0010-1\n\n * doAcquireSharedInterruptibly:\n\nprivate void doAcquireSharedInterruptibly(int arg) throws InterruptedException {\n    // \n    final Node node = addWaiter(Node.SHARED);\n    boolean failed = true;\n    try {\n        for (;;) { // \n            // node\n            final Node p = node.predecessor();\n            if (p == head) { // \n                // \n                int r = tryAcquireShared(arg);\n                if (r >= 0) { // \n                    // \n                    setHeadAndPropagate(node, r);\n                    // next\n                    p.next = null; // help GC\n                    failed = false;\n                    return;\n                }\n            }\n            if (shouldParkAfterFailedAcquire(p, node) &&\n                parkAndCheckInterrupt()) // \n                // \n                throw new InterruptedException();\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n\n\n: AQSdoAcquireSharedInterruptiblyCountDownLatchSynctryAcquireSharedAQSsetHeadAndPropagate\n\n * setHeadAndPropagate\n\nprivate void setHeadAndPropagate(Node node, int propagate) {\n    // \n    Node h = head; // Record old head for check below\n    // \n    setHead(node);\n    /*\n        * Try to signal next queued node if:\n        *   Propagation was indicated by caller,\n        *     or was recorded (as h.waitStatus either before\n        *     or after setHead) by a previous operation\n        *     (note: this uses sign-check of waitStatus because\n        *      PROPAGATE status may transition to SIGNAL.)\n        * and\n        *   The next node is waiting in shared mode,\n        *     or we don\'t know, because it appears null\n        *\n        * The conservatism in both of these checks may cause\n        * unnecessary wake-ups, but only when there are multiple\n        * racing acquires/releases, so most need signals now or soon\n        * anyway.\n        */\n    // \n    if (propagate > 0 || h == null || h.waitStatus < 0 ||\n        (h = head) == null || h.waitStatus < 0) {\n        // \n        Node s = node.next;\n        if (s == null || s.isShared()) // \n            // \n            doReleaseShared();\n    }\n}\n\n\n: AQSdoReleaseShared\n\nprivate void doReleaseShared() {\n    /*\n        * Ensure that a release propagates, even if there are other\n        * in-progress acquires/releases.  This proceeds in the usual\n        * way of trying to unparkSuccessor of head if it needs\n        * signal. But if it does not, status is set to PROPAGATE to\n        * ensure that upon release, propagation continues.\n        * Additionally, we must loop in case a new node is added\n        * while we are doing this. Also, unlike other uses of\n        * unparkSuccessor, we need to know if CAS to reset status\n        * fails, if so rechecking.\n        */\n    // \n    for (;;) {\n        // \n        Node h = head;\n        if (h != null && h != tail) { // \n            // \n            int ws = h.waitStatus; \n            if (ws == Node.SIGNAL) { // SIGNAL\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) // \n                    continue;            // loop to recheck cases\n                // \n                unparkSuccessor(h);\n            }\n            else if (ws == 0 &&\n                        !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) // 0\n                continue;                // loop on failed CAS\n        }\n        if (h == head) //   \n            break;\n    }\n}\n\n\n: \n\nCountDownLatchawait\n\n\n\n: \n\n\n#  - countDown\n\n\n\npublic void countDown() {\n    sync.releaseShared(1);\n}\n\n\n: countDownSyncreleaseShared(AQS)\n\n * releaseShared\n\npublic final boolean releaseShared(int arg) {\n    if (tryReleaseShared(arg)) {\n        doReleaseShared();\n        return true;\n    }\n    return false;\n}\n\n\n: CountDownLatchtryReleaseSharedAQSdoReleaseShared\n\n * tryReleaseShared\n\nprotected boolean tryReleaseShared(int releases) {\n    // Decrement count; signal when transition to zero\n    // \n    for (;;) {\n        // \n        int c = getState();\n        if (c == 0) // \n            return false;\n        // \n        int nextc = c-1;\n        if (compareAndSetState(c, nextc)) // \n            return nextc == 0;\n    }\n}\n\n\n: \n\n * AQSdoReleaseShared\n\nprivate void doReleaseShared() {\n    /*\n        * Ensure that a release propagates, even if there are other\n        * in-progress acquires/releases.  This proceeds in the usual\n        * way of trying to unparkSuccessor of head if it needs\n        * signal. But if it does not, status is set to PROPAGATE to\n        * ensure that upon release, propagation continues.\n        * Additionally, we must loop in case a new node is added\n        * while we are doing this. Also, unlike other uses of\n        * unparkSuccessor, we need to know if CAS to reset status\n        * fails, if so rechecking.\n        */\n    // \n    for (;;) {\n        // \n        Node h = head;\n        if (h != null && h != tail) { // \n            // \n            int ws = h.waitStatus; \n            if (ws == Node.SIGNAL) { // SIGNAL\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) // \n                    continue;            // loop to recheck cases\n                // \n                unparkSuccessor(h);\n            }\n            else if (ws == 0 &&\n                        !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) // 0\n                continue;                // loop on failed CAS\n        }\n        if (h == head) //   \n            break;\n    }\n}\n\n\n: \n\nCountDownLatchcountDown\n\n\n\n: \n\n\n# CountDownLatch\n\nCountDownLatch\n\nimport java.util.concurrent.CountDownLatch;\n\nclass MyThread extends Thread {\n    private CountDownLatch countDownLatch;\n    \n    public MyThread(String name, CountDownLatch countDownLatch) {\n        super(name);\n        this.countDownLatch = countDownLatch;\n    }\n    \n    public void run() {\n        System.out.println(Thread.currentThread().getName() + " doing something");\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(Thread.currentThread().getName() + " finish");\n        countDownLatch.countDown();\n    }\n}\n\npublic class CountDownLatchDemo {\n    public static void main(String[] args) {\n        CountDownLatch countDownLatch = new CountDownLatch(2);\n        MyThread t1 = new MyThread("t1", countDownLatch);\n        MyThread t2 = new MyThread("t2", countDownLatch);\n        t1.start();\n        t2.start();\n        System.out.println("Waiting for t1 thread and t2 thread to finish");\n        try {\n            countDownLatch.await();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }            \n        System.out.println(Thread.currentThread().getName() + " continue");        \n    }\n}\n\n\n():\n\nWaiting for t1 thread and t2 thread to finish\nt1 doing something\nt2 doing something\nt1 finish\nt2 finish\nmain continue\n\n\n: 2\n\n\n\n: mainawaitmaint1countDownt2countDownmain\n\n * maincountDownLatch.await\n\n\n\n: mainparkSync queue()AQSstate2mainnextWaiterSHARED\n\n * t1countDownLatch.countDown\n\n\n\n: Sync queueAQSstate1\n\n * t2countDownLatch.countDown\n\n\n\n: AQSstate0mainunparkmaincpu\n\n * maincpumainparkAndCheckInterruptparkAndCheckInterrupt\n\n\n\n: mainparkAndCheckInterruptAQSstate0headtailnextWaiterSHARED\n\n\n# \n\n\n# \n\n> addsize 110252.\n\n\n# waitnotify\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n *  t2 wait  notify waitnotify\n */\npublic class T2 {\n\n volatile   List list = new ArrayList();\n\n    public void add (int i){\n        list.add(i);\n    }\n\n    public int getSize(){\n        return list.size();\n    }\n\n    public static void main(String[] args) {\n\n        T2 t2 = new T2();\n\n        Object lock = new Object();\n\n        new Thread(() -> {\n            synchronized(lock){\n                System.out.println("t2 ");\n                if(t2.getSize() != 5){\n                    try {\n                        /***/\n                        lock.wait();\n                        System.out.println("t2 ");\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                lock.notify();\n            }\n        },"t2").start();\n\n        new Thread(() -> {\n           synchronized (lock){\n               System.out.println("t1 ");\n               for (int i=0;i<9;i++){\n                   t2.add(i);\n                   System.out.println("add"+i);\n                   if(t2.getSize() == 5){\n                       /***/\n                       lock.notify();\n                       try {\n                           lock.wait();\n                       } catch (InterruptedException e) {\n                           e.printStackTrace();\n                       }\n                   }\n               }\n           }\n        }).start();\n    }\n}\n\n\n\n\nt2 \nt1 \nadd0\nadd1\nadd2\nadd3\nadd4\nt2 \nadd5\nadd6\nadd7\nadd8\n\n\n\n# CountDownLatch\n\nCountDownLatch wait notify ?\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * CountDownLatch wait notify   Count 0\n */\npublic class T3 {\n\n   volatile List list = new ArrayList();\n\n    public void add(int i){\n        list.add(i);\n    }\n\n    public int getSize(){\n        return list.size();\n    }\n\n\n    public static void main(String[] args) {\n        T3 t = new T3();\n        CountDownLatch countDownLatch = new CountDownLatch(1);\n\n        new Thread(() -> {\n            System.out.println("t2 start");\n           if(t.getSize() != 5){\n               try {\n                   countDownLatch.await();\n                   System.out.println("t2 end");\n               } catch (InterruptedException e) {\n                   e.printStackTrace();\n               }\n           }\n        },"t2").start();\n\n        new Thread(()->{\n            System.out.println("t1 start");\n           for (int i = 0;i<9;i++){\n               t.add(i);\n               System.out.println("add"+ i);\n               if(t.getSize() == 5){\n                   System.out.println("countdown is open");\n                   countDownLatch.countDown();\n               }\n           }\n            System.out.println("t1 end");\n        },"t1").start();\n    }\n\n}\n\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5406191.html\n * https://www.jianshu.com/p/40336ef1f5fe\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-countdownlatch.html',normalizedContent:'# juc: countdownlatch\n\n> countdownlatchaqs\n\n * juc: countdownlatch\n   * bat\n   * countdownlatch\n   * countdownlatch\n     * \n     * \n     * \n     * \n     *  - await\n     *  - countdown\n   * countdownlatch\n   * \n     * \n     * waitnotify\n     * countdownlatch\n   * \n\n\n# bat\n\n\n\n\n\n * countdownlatch?\n * countdownlatch?\n * countdownlatch? \n * countdownlatch? await(),countdown()\n * countdownlatch?\n * addsize 110252? countdownlatch wait notify \n\n\n# countdownlatch\n\naqsaqsaqs: sync queue condition queuecountdownlatchnncountdownlatchcountdownawait\n\n\n# countdownlatch\n\n\n# \n\ncountdownlatch, aqssync\n\npublic class countdownlatch {}\n\n\n\n# \n\ncountdownlatchsyncabstractqueuedsynchronizer\n\nprivate static final class sync extends abstractqueuedsynchronizer {\n    // \n    private static final long serialversionuid = 4982264981922014374l;\n    \n    // \n    sync(int count) {\n        setstate(count);\n    }\n    \n    // \n    int getcount() {\n        return getstate();\n    }\n\n    // \n    protected int tryacquireshared(int acquires) {\n        return (getstate() == 0) ? 1 : -1;\n    }\n\n    // \n    protected boolean tryreleaseshared(int releases) {\n        // decrement count; signal when transition to zero\n        // \n        for (;;) {\n            // \n            int c = getstate();\n            if (c == 0) // \n                return false;\n            // \n            int nextc = c-1;\n            if (compareandsetstate(c, nextc)) // \n                return nextc == 0;\n        }\n    }\n}\n\n\n: countdownlatchsyncaqsaqscountdownlatch\n\n\n# \n\ncountdownlatchsync:\n\npublic class countdownlatch {\n    // \n    private final sync sync;\n}\n\n\n\n# \n\npublic countdownlatch(int count) {\n    if (count < 0) throw new illegalargumentexception("count < 0");\n    // \n    this.sync = new sync(count);\n}\n\n\n: countdownlatchsync\n\n\n#  - await\n\n\n\npublic void await() throws interruptedexception {\n    // sync\n    sync.acquiresharedinterruptibly(1);\n}\n\n\n: countdownlatchawaitsyncacquiresharedinterruptibly(aqs)\n\n * acquiresharedinterruptibly:\n\npublic final void acquiresharedinterruptibly(int arg)\n        throws interruptedexception {\n    if (thread.interrupted())\n        throw new interruptedexception();\n    if (tryacquireshared(arg) < 0)\n        doacquiresharedinterruptibly(arg);\n}\n\n\n: acquiresharedinterruptiblycountdownlatchsynctryacquiresharedaqsdoacquiresharedinterruptibly\n\n * tryacquireshared:\n\nprotected int tryacquireshared(int acquires) {\n    return (getstate() == 0) ? 1 : -1;\n}\n\n\n: aqsstate0010-1\n\n * doacquiresharedinterruptibly:\n\nprivate void doacquiresharedinterruptibly(int arg) throws interruptedexception {\n    // \n    final node node = addwaiter(node.shared);\n    boolean failed = true;\n    try {\n        for (;;) { // \n            // node\n            final node p = node.predecessor();\n            if (p == head) { // \n                // \n                int r = tryacquireshared(arg);\n                if (r >= 0) { // \n                    // \n                    setheadandpropagate(node, r);\n                    // next\n                    p.next = null; // help gc\n                    failed = false;\n                    return;\n                }\n            }\n            if (shouldparkafterfailedacquire(p, node) &&\n                parkandcheckinterrupt()) // \n                // \n                throw new interruptedexception();\n        }\n    } finally {\n        if (failed)\n            cancelacquire(node);\n    }\n}\n\n\n: aqsdoacquiresharedinterruptiblycountdownlatchsynctryacquiresharedaqssetheadandpropagate\n\n * setheadandpropagate\n\nprivate void setheadandpropagate(node node, int propagate) {\n    // \n    node h = head; // record old head for check below\n    // \n    sethead(node);\n    /*\n        * try to signal next queued node if:\n        *   propagation was indicated by caller,\n        *     or was recorded (as h.waitstatus either before\n        *     or after sethead) by a previous operation\n        *     (note: this uses sign-check of waitstatus because\n        *      propagate status may transition to signal.)\n        * and\n        *   the next node is waiting in shared mode,\n        *     or we don\'t know, because it appears null\n        *\n        * the conservatism in both of these checks may cause\n        * unnecessary wake-ups, but only when there are multiple\n        * racing acquires/releases, so most need signals now or soon\n        * anyway.\n        */\n    // \n    if (propagate > 0 || h == null || h.waitstatus < 0 ||\n        (h = head) == null || h.waitstatus < 0) {\n        // \n        node s = node.next;\n        if (s == null || s.isshared()) // \n            // \n            doreleaseshared();\n    }\n}\n\n\n: aqsdoreleaseshared\n\nprivate void doreleaseshared() {\n    /*\n        * ensure that a release propagates, even if there are other\n        * in-progress acquires/releases.  this proceeds in the usual\n        * way of trying to unparksuccessor of head if it needs\n        * signal. but if it does not, status is set to propagate to\n        * ensure that upon release, propagation continues.\n        * additionally, we must loop in case a new node is added\n        * while we are doing this. also, unlike other uses of\n        * unparksuccessor, we need to know if cas to reset status\n        * fails, if so rechecking.\n        */\n    // \n    for (;;) {\n        // \n        node h = head;\n        if (h != null && h != tail) { // \n            // \n            int ws = h.waitstatus; \n            if (ws == node.signal) { // signal\n                if (!compareandsetwaitstatus(h, node.signal, 0)) // \n                    continue;            // loop to recheck cases\n                // \n                unparksuccessor(h);\n            }\n            else if (ws == 0 &&\n                        !compareandsetwaitstatus(h, 0, node.propagate)) // 0\n                continue;                // loop on failed cas\n        }\n        if (h == head) //   \n            break;\n    }\n}\n\n\n: \n\ncountdownlatchawait\n\n\n\n: \n\n\n#  - countdown\n\n\n\npublic void countdown() {\n    sync.releaseshared(1);\n}\n\n\n: countdownsyncreleaseshared(aqs)\n\n * releaseshared\n\npublic final boolean releaseshared(int arg) {\n    if (tryreleaseshared(arg)) {\n        doreleaseshared();\n        return true;\n    }\n    return false;\n}\n\n\n: countdownlatchtryreleasesharedaqsdoreleaseshared\n\n * tryreleaseshared\n\nprotected boolean tryreleaseshared(int releases) {\n    // decrement count; signal when transition to zero\n    // \n    for (;;) {\n        // \n        int c = getstate();\n        if (c == 0) // \n            return false;\n        // \n        int nextc = c-1;\n        if (compareandsetstate(c, nextc)) // \n            return nextc == 0;\n    }\n}\n\n\n: \n\n * aqsdoreleaseshared\n\nprivate void doreleaseshared() {\n    /*\n        * ensure that a release propagates, even if there are other\n        * in-progress acquires/releases.  this proceeds in the usual\n        * way of trying to unparksuccessor of head if it needs\n        * signal. but if it does not, status is set to propagate to\n        * ensure that upon release, propagation continues.\n        * additionally, we must loop in case a new node is added\n        * while we are doing this. also, unlike other uses of\n        * unparksuccessor, we need to know if cas to reset status\n        * fails, if so rechecking.\n        */\n    // \n    for (;;) {\n        // \n        node h = head;\n        if (h != null && h != tail) { // \n            // \n            int ws = h.waitstatus; \n            if (ws == node.signal) { // signal\n                if (!compareandsetwaitstatus(h, node.signal, 0)) // \n                    continue;            // loop to recheck cases\n                // \n                unparksuccessor(h);\n            }\n            else if (ws == 0 &&\n                        !compareandsetwaitstatus(h, 0, node.propagate)) // 0\n                continue;                // loop on failed cas\n        }\n        if (h == head) //   \n            break;\n    }\n}\n\n\n: \n\ncountdownlatchcountdown\n\n\n\n: \n\n\n# countdownlatch\n\ncountdownlatch\n\nimport java.util.concurrent.countdownlatch;\n\nclass mythread extends thread {\n    private countdownlatch countdownlatch;\n    \n    public mythread(string name, countdownlatch countdownlatch) {\n        super(name);\n        this.countdownlatch = countdownlatch;\n    }\n    \n    public void run() {\n        system.out.println(thread.currentthread().getname() + " doing something");\n        try {\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println(thread.currentthread().getname() + " finish");\n        countdownlatch.countdown();\n    }\n}\n\npublic class countdownlatchdemo {\n    public static void main(string[] args) {\n        countdownlatch countdownlatch = new countdownlatch(2);\n        mythread t1 = new mythread("t1", countdownlatch);\n        mythread t2 = new mythread("t2", countdownlatch);\n        t1.start();\n        t2.start();\n        system.out.println("waiting for t1 thread and t2 thread to finish");\n        try {\n            countdownlatch.await();\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }            \n        system.out.println(thread.currentthread().getname() + " continue");        \n    }\n}\n\n\n():\n\nwaiting for t1 thread and t2 thread to finish\nt1 doing something\nt2 doing something\nt1 finish\nt2 finish\nmain continue\n\n\n: 2\n\n\n\n: mainawaitmaint1countdownt2countdownmain\n\n * maincountdownlatch.await\n\n\n\n: mainparksync queue()aqsstate2mainnextwaitershared\n\n * t1countdownlatch.countdown\n\n\n\n: sync queueaqsstate1\n\n * t2countdownlatch.countdown\n\n\n\n: aqsstate0mainunparkmaincpu\n\n * maincpumainparkandcheckinterruptparkandcheckinterrupt\n\n\n\n: mainparkandcheckinterruptaqsstate0headtailnextwaitershared\n\n\n# \n\n\n# \n\n> addsize 110252.\n\n\n# waitnotify\n\nimport java.util.arraylist;\nimport java.util.list;\n\n/**\n *  t2 wait  notify waitnotify\n */\npublic class t2 {\n\n volatile   list list = new arraylist();\n\n    public void add (int i){\n        list.add(i);\n    }\n\n    public int getsize(){\n        return list.size();\n    }\n\n    public static void main(string[] args) {\n\n        t2 t2 = new t2();\n\n        object lock = new object();\n\n        new thread(() -> {\n            synchronized(lock){\n                system.out.println("t2 ");\n                if(t2.getsize() != 5){\n                    try {\n                        /***/\n                        lock.wait();\n                        system.out.println("t2 ");\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                }\n                lock.notify();\n            }\n        },"t2").start();\n\n        new thread(() -> {\n           synchronized (lock){\n               system.out.println("t1 ");\n               for (int i=0;i<9;i++){\n                   t2.add(i);\n                   system.out.println("add"+i);\n                   if(t2.getsize() == 5){\n                       /***/\n                       lock.notify();\n                       try {\n                           lock.wait();\n                       } catch (interruptedexception e) {\n                           e.printstacktrace();\n                       }\n                   }\n               }\n           }\n        }).start();\n    }\n}\n\n\n\n\nt2 \nt1 \nadd0\nadd1\nadd2\nadd3\nadd4\nt2 \nadd5\nadd6\nadd7\nadd8\n\n\n\n# countdownlatch\n\ncountdownlatch wait notify ?\n\nimport java.util.arraylist;\nimport java.util.list;\nimport java.util.concurrent.countdownlatch;\n\n/**\n * countdownlatch wait notify   count 0\n */\npublic class t3 {\n\n   volatile list list = new arraylist();\n\n    public void add(int i){\n        list.add(i);\n    }\n\n    public int getsize(){\n        return list.size();\n    }\n\n\n    public static void main(string[] args) {\n        t3 t = new t3();\n        countdownlatch countdownlatch = new countdownlatch(1);\n\n        new thread(() -> {\n            system.out.println("t2 start");\n           if(t.getsize() != 5){\n               try {\n                   countdownlatch.await();\n                   system.out.println("t2 end");\n               } catch (interruptedexception e) {\n                   e.printstacktrace();\n               }\n           }\n        },"t2").start();\n\n        new thread(()->{\n            system.out.println("t1 start");\n           for (int i = 0;i<9;i++){\n               t.add(i);\n               system.out.println("add"+ i);\n               if(t.getsize() == 5){\n                   system.out.println("countdown is open");\n                   countdownlatch.countdown();\n               }\n           }\n            system.out.println("t1 end");\n        },"t1").start();\n    }\n\n}\n\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5406191.html\n * https://www.jianshu.com/p/40336ef1f5fe\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-countdownlatch.html',charsets:{cjk:!0}},{title:"JUC: CyclicBarrier",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-tool-cyclicbarrier.html",relativePath:"java/thread/java-thread-x-juc-tool-cyclicbarrier.md",key:"v-120dde14",path:"/java/thread/java-thread-x-juc-tool-cyclicbarrier.html",headers:[{level:2,title:"JUC: CyclicBarrier",slug:"juc-cyclicbarrier",normalizedTitle:"juc: cyclicbarrier",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:165},{level:2,title:"CyclicBarrier",slug:"cyclicbarrier",normalizedTitle:"cyclicbarrier",charIndex:186},{level:2,title:"CyclicBarrier",slug:"cyclicbarrier",normalizedTitle:"cyclicbarrier",charIndex:207},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:232},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:1061},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:246},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:258},{level:3,title:" - dowait",slug:"-dowait",normalizedTitle:" - dowait",charIndex:272},{level:3,title:" - nextGeneration",slug:"-nextgeneration",normalizedTitle:" - nextgeneration",charIndex:295},{level:3,title:"breakBarrier",slug:"breakbarrier",normalizedTitle:"breakbarrier",charIndex:326},{level:2,title:"CyclicBarrier",slug:"cyclicbarrier",normalizedTitle:"cyclicbarrier",charIndex:346},{level:2,title:"CountDonwLatch",slug:"countdonwlatch",normalizedTitle:"countdonwlatch",charIndex:367},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:391}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: CyclicBarrier BAT CyclicBarrier CyclicBarrier      - dowait  - nextGeneration breakBarrier CyclicBarrier CountDonwLatch ",content:'# JUC: CyclicBarrier\n\n> CyclicBarrierReentrantLockAbstractQueuedSynchronizer, CountDownLatch()\n\n * JUC: CyclicBarrier\n   * BAT\n   * CyclicBarrier\n   * CyclicBarrier\n     * \n     * \n     * \n     *  - dowait\n     *  - nextGeneration\n     * breakBarrier\n   * CyclicBarrier\n   * CountDonwLatch\n   * \n\n\n# BAT\n\n\n\n\n\n * CyclicBarrier?\n * CyclicBarrier?\n * CountDownLatchCyclicBarrier?\n * CyclicBarrier?\n * CyclicBarrier?\n\n\n# CyclicBarrier\n\n * CountDownLatch\n\n * CyclicBarrier\n\n\n# CyclicBarrier\n\n\n# \n\nCyclicBarrier, AQS\n\npublic class CyclicBarrier {}\n\n\n\n# \n\nCyclicBarrierGenerationCycBarrierGeneration\n\nprivate static class Generation {\n    boolean broken = false;\n}\n\n\n: Generationbroken\n\n\n# \n\npublic class CyclicBarrier {\n    \n    /** The lock for guarding barrier entry */\n    // \n    private final ReentrantLock lock = new ReentrantLock();\n    /** Condition to wait on until tripped */\n    // \n    private final Condition trip = lock.newCondition();\n    /** The number of parties */\n    // \n    private final int parties;\n    /* The command to run when tripped */\n    //  barrier \n    private final Runnable barrierCommand;\n    /** The current generation */\n    // \n    private Generation generation = new Generation();\n    // \n    private int count;\n}\n\n\n: ReentrantLockConditionConditionAQSAQS\n\n\n# \n\n * CyclicBarrier(int, Runnable)\n\npublic CyclicBarrier(int parties, Runnable barrierAction) {\n    // 0\n    if (parties <= 0) throw new IllegalArgumentException();\n    // parties\n    this.parties = parties;\n    // count\n    this.count = parties;\n    // barrierCommand\n    this.barrierCommand = barrierAction;\n}\n\n\n: CyclicBarrier\n\n * CyclicBarrier(int)\n\npublic CyclicBarrier(int parties) {\n    // \n    this(parties, null);\n}\n\n\n: CyclicBarrier\n\n\n#  - dowait\n\nCyclicBarrierCyclicBarrierawaitdoawait\n\nprivate int dowait(boolean timed, long nanos)\n    throws InterruptedException, BrokenBarrierException,\n            TimeoutException {\n    // \n    final ReentrantLock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        final Generation g = generation;\n        \n        if (g.broken) // \n            throw new BrokenBarrierException();\n\n        if (Thread.interrupted()) { // \n            // \n            breakBarrier();\n            // \n            throw new InterruptedException();\n        }\n        \n        // \n        int index = --count;\n        if (index == 0) {  // 0\n            // \n            boolean ranAction = false;\n            try {\n                // \n                final Runnable command = barrierCommand;\n                if (command != null) // \n                    // \n                    command.run();\n                // ranAction\n                ranAction = true;\n                // \n                nextGeneration();\n                return 0;\n            } finally {\n                if (!ranAction) // \n                    // \n                    breakBarrier();\n            }\n        }\n\n        // loop until tripped, broken, interrupted, or timed out\n        // \n        for (;;) {\n            try {\n                if (!timed) // \n                    // \n                    trip.await(); \n                else if (nanos > 0L) // 0\n                    // \n                    nanos = trip.awaitNanos(nanos);\n            } catch (InterruptedException ie) { \n                if (g == generation && ! g.broken) { // \n                    // \n                    breakBarrier();\n                    // \n                    throw ie;\n                } else { // \n                    // We\'re about to finish waiting even if we had not\n                    // been interrupted, so this interrupt is deemed to\n                    // "belong" to subsequent execution.\n                    // \n                    Thread.currentThread().interrupt();\n                }\n            }\n\n            if (g.broken) // \n                throw new BrokenBarrierException();\n\n            if (g != generation) // \n                // \n                return index;\n\n            if (timed && nanos <= 0L) { // 0\n                // \n                breakBarrier();\n                // \n                throw new TimeoutException();\n            }\n        }\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n: dowait:\n\n\n\n\n#  - nextGeneration\n\n\n\nprivate void nextGeneration() {\n    // signal completion of last generation\n    // \n    trip.signalAll();\n    // set up next generation\n    // \n    count = parties;\n    // \n    generation = new Generation();\n}\n\n\nAQSsignalAll\n\npublic final void signalAll() {\n    if (!isHeldExclusively()) // \n        throw new IllegalMonitorStateException();\n    // condition\n    Node first = firstWaiter;\n    if (first != null) // \n        // \n        doSignalAll(first);\n}\n\n\n: doSignalAlldoSignalAll\n\nprivate void doSignalAll(Node first) {\n    // condition\n    lastWaiter = firstWaiter = null;\n    // \n    do {\n        // firstnextWaiter\n        Node next = first.nextWaiter;\n        // firstnextWaiter\n        first.nextWaiter = null;\n        // firstconditionsync\n        transferForSignal(first);\n        // first\n        first = next;\n    } while (first != null);\n}\n\n\n: transferForSignal\n\nfinal boolean transferForSignal(Node node) {\n    /*\n        * If cannot change waitStatus, the node has been cancelled.\n        */\n    if (!compareAndSetWaitStatus(node, Node.CONDITION, 0))\n        return false;\n\n    /*\n        * Splice onto queue and try to set waitStatus of predecessor to\n        * indicate that thread is (probably) waiting. If cancelled or\n        * attempt to set waitStatus fails, wake up to resync (in which\n        * case the waitStatus can be transiently and harmlessly wrong).\n        */\n    Node p = enq(node);\n    int ws = p.waitStatus;\n    if (ws > 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))\n        LockSupport.unpark(node.thread);\n    return true;\n}\n\n\n: enq\n\nprivate Node enq(final Node node) {\n    for (;;) { // \n        // \n        Node t = tail;\n        if (t == null) { // \n            if (compareAndSetHead(new Node())) // \n                tail = head; // \n        } else { // \n            // nodeprev\n            node.prev = t; \n            if (compareAndSetTail(t, node)) { // tnode\n                // nextnode\n                t.next = node; \n                return t; // \n            }\n        }\n    }\n}\n\n\n: \n\nnewGeneration:\n\n\n\n\n# breakBarrier\n\n:\n\nprivate void breakBarrier() {\n    // \n    generation.broken = true;\n    // \n    count = parties;\n    // \n    trip.signalAll();\n}\n\n\n: AQSsignalAllsignal\n\n\n# CyclicBarrier\n\nCyclicBarrier\n\nimport java.util.concurrent.BrokenBarrierException;\nimport java.util.concurrent.CyclicBarrier;\n\nclass MyThread extends Thread {\n    private CyclicBarrier cb;\n    public MyThread(String name, CyclicBarrier cb) {\n        super(name);\n        this.cb = cb;\n    }\n    \n    public void run() {\n        System.out.println(Thread.currentThread().getName() + " going to await");\n        try {\n            cb.await();\n            System.out.println(Thread.currentThread().getName() + " continue");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\npublic class CyclicBarrierDemo {\n    public static void main(String[] args) throws InterruptedException, BrokenBarrierException {\n        CyclicBarrier cb = new CyclicBarrier(3, new Thread("barrierAction") {\n            public void run() {\n                System.out.println(Thread.currentThread().getName() + " barrier action");\n                \n            }\n        });\n        MyThread t1 = new MyThread("t1", cb);\n        MyThread t2 = new MyThread("t2", cb);\n        t1.start();\n        t2.start();\n        System.out.println(Thread.currentThread().getName() + " going to await");\n        cb.await();\n        System.out.println(Thread.currentThread().getName() + " continue");\n\n    }\n}\n\n\n():\n\nt1 going to await\nmain going to await\nt2 going to await\nt2 barrier action\nt2 continue\nt1 continue\nmain continue\n\n\n: \n\n\n\n: t1cb.awaitmaincb.barrierAction\n\n * main()cb.await\n\n\n\n: ReentrantLockdowaitReentrantLock.NonfairSynclockAQS0maindowaittrip.awaitmainmain\n\n * t1cb.awaitt1lock.lockmain\n\n\n\n: condition queue()t1t1park\n\n * t2cb.awaitt2lock.lockt1\n\n\n\n: t2awaitcommand.runCondition queueSync queuemainunparkmaincpu\n\n * maincpu:\n\n\n\n: mainAQS.COwaitparkt1unparkcpu\n\n * t1cpu\n\n\n\n: t1AQS.COwaitparkSync queue\n\n: awaitCyclicBarrierAPI\n\n\n# CountDonwLatch\n\n * CountDownLatchCyclicBarrier\n * CountDownLatchCyclicBarrier\n * CountDownLatchCyclicBarrierCountDownLatchCyclicBarrier\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5392816.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-cyclicbarrier.html',normalizedContent:'# juc: cyclicbarrier\n\n> cyclicbarrierreentrantlockabstractqueuedsynchronizer, countdownlatch()\n\n * juc: cyclicbarrier\n   * bat\n   * cyclicbarrier\n   * cyclicbarrier\n     * \n     * \n     * \n     *  - dowait\n     *  - nextgeneration\n     * breakbarrier\n   * cyclicbarrier\n   * countdonwlatch\n   * \n\n\n# bat\n\n\n\n\n\n * cyclicbarrier?\n * cyclicbarrier?\n * countdownlatchcyclicbarrier?\n * cyclicbarrier?\n * cyclicbarrier?\n\n\n# cyclicbarrier\n\n * countdownlatch\n\n * cyclicbarrier\n\n\n# cyclicbarrier\n\n\n# \n\ncyclicbarrier, aqs\n\npublic class cyclicbarrier {}\n\n\n\n# \n\ncyclicbarriergenerationcycbarriergeneration\n\nprivate static class generation {\n    boolean broken = false;\n}\n\n\n: generationbroken\n\n\n# \n\npublic class cyclicbarrier {\n    \n    /** the lock for guarding barrier entry */\n    // \n    private final reentrantlock lock = new reentrantlock();\n    /** condition to wait on until tripped */\n    // \n    private final condition trip = lock.newcondition();\n    /** the number of parties */\n    // \n    private final int parties;\n    /* the command to run when tripped */\n    //  barrier \n    private final runnable barriercommand;\n    /** the current generation */\n    // \n    private generation generation = new generation();\n    // \n    private int count;\n}\n\n\n: reentrantlockconditionconditionaqsaqs\n\n\n# \n\n * cyclicbarrier(int, runnable)\n\npublic cyclicbarrier(int parties, runnable barrieraction) {\n    // 0\n    if (parties <= 0) throw new illegalargumentexception();\n    // parties\n    this.parties = parties;\n    // count\n    this.count = parties;\n    // barriercommand\n    this.barriercommand = barrieraction;\n}\n\n\n: cyclicbarrier\n\n * cyclicbarrier(int)\n\npublic cyclicbarrier(int parties) {\n    // \n    this(parties, null);\n}\n\n\n: cyclicbarrier\n\n\n#  - dowait\n\ncyclicbarriercyclicbarrierawaitdoawait\n\nprivate int dowait(boolean timed, long nanos)\n    throws interruptedexception, brokenbarrierexception,\n            timeoutexception {\n    // \n    final reentrantlock lock = this.lock;\n    // \n    lock.lock();\n    try {\n        // \n        final generation g = generation;\n        \n        if (g.broken) // \n            throw new brokenbarrierexception();\n\n        if (thread.interrupted()) { // \n            // \n            breakbarrier();\n            // \n            throw new interruptedexception();\n        }\n        \n        // \n        int index = --count;\n        if (index == 0) {  // 0\n            // \n            boolean ranaction = false;\n            try {\n                // \n                final runnable command = barriercommand;\n                if (command != null) // \n                    // \n                    command.run();\n                // ranaction\n                ranaction = true;\n                // \n                nextgeneration();\n                return 0;\n            } finally {\n                if (!ranaction) // \n                    // \n                    breakbarrier();\n            }\n        }\n\n        // loop until tripped, broken, interrupted, or timed out\n        // \n        for (;;) {\n            try {\n                if (!timed) // \n                    // \n                    trip.await(); \n                else if (nanos > 0l) // 0\n                    // \n                    nanos = trip.awaitnanos(nanos);\n            } catch (interruptedexception ie) { \n                if (g == generation && ! g.broken) { // \n                    // \n                    breakbarrier();\n                    // \n                    throw ie;\n                } else { // \n                    // we\'re about to finish waiting even if we had not\n                    // been interrupted, so this interrupt is deemed to\n                    // "belong" to subsequent execution.\n                    // \n                    thread.currentthread().interrupt();\n                }\n            }\n\n            if (g.broken) // \n                throw new brokenbarrierexception();\n\n            if (g != generation) // \n                // \n                return index;\n\n            if (timed && nanos <= 0l) { // 0\n                // \n                breakbarrier();\n                // \n                throw new timeoutexception();\n            }\n        }\n    } finally {\n        // \n        lock.unlock();\n    }\n}\n\n\n: dowait:\n\n\n\n\n#  - nextgeneration\n\n\n\nprivate void nextgeneration() {\n    // signal completion of last generation\n    // \n    trip.signalall();\n    // set up next generation\n    // \n    count = parties;\n    // \n    generation = new generation();\n}\n\n\naqssignalall\n\npublic final void signalall() {\n    if (!isheldexclusively()) // \n        throw new illegalmonitorstateexception();\n    // condition\n    node first = firstwaiter;\n    if (first != null) // \n        // \n        dosignalall(first);\n}\n\n\n: dosignalalldosignalall\n\nprivate void dosignalall(node first) {\n    // condition\n    lastwaiter = firstwaiter = null;\n    // \n    do {\n        // firstnextwaiter\n        node next = first.nextwaiter;\n        // firstnextwaiter\n        first.nextwaiter = null;\n        // firstconditionsync\n        transferforsignal(first);\n        // first\n        first = next;\n    } while (first != null);\n}\n\n\n: transferforsignal\n\nfinal boolean transferforsignal(node node) {\n    /*\n        * if cannot change waitstatus, the node has been cancelled.\n        */\n    if (!compareandsetwaitstatus(node, node.condition, 0))\n        return false;\n\n    /*\n        * splice onto queue and try to set waitstatus of predecessor to\n        * indicate that thread is (probably) waiting. if cancelled or\n        * attempt to set waitstatus fails, wake up to resync (in which\n        * case the waitstatus can be transiently and harmlessly wrong).\n        */\n    node p = enq(node);\n    int ws = p.waitstatus;\n    if (ws > 0 || !compareandsetwaitstatus(p, ws, node.signal))\n        locksupport.unpark(node.thread);\n    return true;\n}\n\n\n: enq\n\nprivate node enq(final node node) {\n    for (;;) { // \n        // \n        node t = tail;\n        if (t == null) { // \n            if (compareandsethead(new node())) // \n                tail = head; // \n        } else { // \n            // nodeprev\n            node.prev = t; \n            if (compareandsettail(t, node)) { // tnode\n                // nextnode\n                t.next = node; \n                return t; // \n            }\n        }\n    }\n}\n\n\n: \n\nnewgeneration:\n\n\n\n\n# breakbarrier\n\n:\n\nprivate void breakbarrier() {\n    // \n    generation.broken = true;\n    // \n    count = parties;\n    // \n    trip.signalall();\n}\n\n\n: aqssignalallsignal\n\n\n# cyclicbarrier\n\ncyclicbarrier\n\nimport java.util.concurrent.brokenbarrierexception;\nimport java.util.concurrent.cyclicbarrier;\n\nclass mythread extends thread {\n    private cyclicbarrier cb;\n    public mythread(string name, cyclicbarrier cb) {\n        super(name);\n        this.cb = cb;\n    }\n    \n    public void run() {\n        system.out.println(thread.currentthread().getname() + " going to await");\n        try {\n            cb.await();\n            system.out.println(thread.currentthread().getname() + " continue");\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n    }\n}\npublic class cyclicbarrierdemo {\n    public static void main(string[] args) throws interruptedexception, brokenbarrierexception {\n        cyclicbarrier cb = new cyclicbarrier(3, new thread("barrieraction") {\n            public void run() {\n                system.out.println(thread.currentthread().getname() + " barrier action");\n                \n            }\n        });\n        mythread t1 = new mythread("t1", cb);\n        mythread t2 = new mythread("t2", cb);\n        t1.start();\n        t2.start();\n        system.out.println(thread.currentthread().getname() + " going to await");\n        cb.await();\n        system.out.println(thread.currentthread().getname() + " continue");\n\n    }\n}\n\n\n():\n\nt1 going to await\nmain going to await\nt2 going to await\nt2 barrier action\nt2 continue\nt1 continue\nmain continue\n\n\n: \n\n\n\n: t1cb.awaitmaincb.barrieraction\n\n * main()cb.await\n\n\n\n: reentrantlockdowaitreentrantlock.nonfairsynclockaqs0maindowaittrip.awaitmainmain\n\n * t1cb.awaitt1lock.lockmain\n\n\n\n: condition queue()t1t1park\n\n * t2cb.awaitt2lock.lockt1\n\n\n\n: t2awaitcommand.runcondition queuesync queuemainunparkmaincpu\n\n * maincpu:\n\n\n\n: mainaqs.cowaitparkt1unparkcpu\n\n * t1cpu\n\n\n\n: t1aqs.cowaitparksync queue\n\n: awaitcyclicbarrierapi\n\n\n# countdonwlatch\n\n * countdownlatchcyclicbarrier\n * countdownlatchcyclicbarrier\n * countdownlatchcyclicbarriercountdownlatchcyclicbarrier\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5392816.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-cyclicbarrier.html',charsets:{cjk:!0}},{title:"JUC: Exchanger",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-tool-exchanger.html",relativePath:"java/thread/java-thread-x-juc-tool-exchanger.md",key:"v-0751ed32",path:"/java/thread/java-thread-x-juc-tool-exchanger.html",headers:[{level:2,title:"JUC: Exchanger",slug:"juc-exchanger",normalizedTitle:"juc: exchanger",charIndex:2},{level:2,title:"BATExchanger",slug:"batexchanger",normalizedTitle:"batexchanger",charIndex:93},{level:2,title:"Exchanger",slug:"exchanger",normalizedTitle:"exchanger",charIndex:123},{level:2,title:"Exchanger",slug:"exchanger",normalizedTitle:"exchanger",charIndex:140},{level:2,title:"Exchanger",slug:"exchanger",normalizedTitle:"exchanger",charIndex:159},{level:3,title:" - Participant",slug:"-participant",normalizedTitle:" - participant",charIndex:180},{level:3,title:" - Node",slug:"-node",normalizedTitle:" - node",charIndex:205},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:223},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:235},{level:3,title:" - exchange(V x)",slug:"-exchange-v-x",normalizedTitle:" - exchange(v x)",charIndex:247},{level:3,title:"slotExchange(Object item, boolean timed, long ns)",slug:"slotexchange-object-item-boolean-timed-long-ns",normalizedTitle:"slotexchange(object item, boolean timed, long ns)",charIndex:275},{level:3,title:"arenaExchange(Object item, boolean timed, long ns)",slug:"arenaexchange-object-item-boolean-timed-long-ns",normalizedTitle:"arenaexchange(object item, boolean timed, long ns)",charIndex:332},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:15006},{level:3,title:"Exchanger",slug:"exchanger",normalizedTitle:"exchanger",charIndex:15416},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:388}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: Exchanger BATExchanger Exchanger Exchanger Exchanger  - Participant  - Node    - exchange(V x) slotExchange(Object item, boolean timed, long ns) arenaExchange(Object item, boolean timed, long ns)  Exchanger ",content:'# JUC: Exchanger\n\n> Exchanger, \n\n * JUC: Exchanger\n   * BATExchanger\n   * Exchanger\n   * Exchanger\n   * Exchanger\n     *  - Participant\n     *  - Node\n     * \n     * \n     *  - exchange(V x)\n     * slotExchange(Object item, boolean timed, long ns)\n     * arenaExchange(Object item, boolean timed, long ns)\n   * \n\n\n# BATExchanger\n\n\n\nExchanger\n\n * Exchanger?\n * SynchronousQueueExchanger SynchronousQueue ?\n * ExchangerJDK?\n * Exchanger?\n * Exchangerslotarena node? ?\n * arenaslotarena?\n * Exchanger?\n * Exchanger\n\n\n# Exchanger\n\nExchangerexchange()exchange()exchange()\n\n\n# Exchanger\n\nfor (;;) {\n    if (slot is empty) { // offer\n        // slotitem Node         \n        place item in a Node;\n        if (can CAS slot from empty to node) {\n            // nodeCASslot\n            wait for release;\n            // nodeitem\n            return matching item in node;\n        }\n    } else if (can CAS slot from node to empty) { // release\n         // slot\n        // nodeitemitem\n        get the item in node;\n        set matching item in node;\n        // \n        release waiting thread;\n    }\n    // else retry on CAS failure\n}\n\n\n2ABAslotslotBABAExchangerslot\n\n\n# Exchanger\n\n\n#  - Participant\n\nstatic final class Participant extends ThreadLocal<Node> {\n    public Node initialValue() { return new Node(); }\n}\n\n\nParticipantNode, ThreadLocal\n\n\n#  - Node\n\n@sun.misc.Contended static final class Node {\n     // arena\n    int index; \n    // Exchanger.bound\n    int bound; \n    // boundCAS\n    int collides;\n    // \n    int hash; \n    // \n    Object item; \n    //releasing\n    volatile Object match; \n    //null\n    volatile Thread parked;\n}\n\n\nNodeboundcollidesareaarenaslotexchangerslotNodeslot? CASslotarenaboundbound\n\n\n# \n\nprivate final Participant participant;\nprivate volatile Node[] arena;\nprivate volatile Node slot;\n\n\n *  arena?\n\nslotarena, NodeslotExchanger? Participant arena? slotarenaarenaslotExchangerarenaarena\n\n * Node\n\nParticipantParticipant NodeThreadLocalNodearenaindex\n\n\n# \n\n/**\n* Creates a new Exchanger.\n*/\npublic Exchanger() {\n    participant = new Participant();\n}\n\n\nparticipant\n\n\n#  - exchange(V x)\n\n()\n\npublic V exchange(V x) throws InterruptedException {\n    Object v;\n    // nullitem\n    Object item = (x == null) ? NULL_ITEM : x; // translate null args\n    // \n    if ((arena != null ||\n            (v = slotExchange(item, false, 0 L)) == null) &&\n        ((Thread.interrupted() || // disambiguates null return\n            (v = arenaExchange(item, false, 0 L)) == null)))\n        throw new InterruptedException();\n    return (v == NULL_ITEM) ? null : (V) v;\n}\n\n\narenanullslotExchange()InterruptedExceptionarenaExchange()slotExchange(Object item, boolean timed, long ns)arenaExchange(Object item, boolean timed, long ns)V\n\nNULL_ITEM ObjectslotExchange()slot\n\n\n# slotExchange(Object item, boolean timed, long ns)\n\nprivate final Object slotExchange(Object item, boolean timed, long ns) {\n    // node\n    Node p = participant.get();\n    // \n    Thread t = Thread.currentThread();\n    // null\n    if (t.isInterrupted()) // preserve interrupt status so caller can recheck\n        return null;\n\t// \n    for (Node q;;) {\n        // slotq\n        if ((q = slot) != null) {\n             // slot nullslot\n\t\t\t// CASslotnull\n            if (U.compareAndSwapObject(this, SLOT, q, null)) {\n                // CASslotitemv\n                // \n                Object v = q.item;\n                // qmatch\n                q.match = item;\n                 // \n                Thread w = q.parked;\n                if (w != null)\n                    // null\n                    U.unpark(w);\n                // V\n                return v;\n            }\n            // create arena on contention, but continue until slot null\n            // CAS \n            // NCPU:CPU\n            // bound == 0 arenaCASboundSEQ\n            if (NCPU > 1 && bound == 0 &&\n                U.compareAndSwapInt(this, BOUND, 0, SEQ))\n                // arena\n                arena = new Node[(FULL + 2) << ASHIFT];\n        }\n        // arenaslotExchange\n\t\t// arena\n        else if (arena != null)\n            // arenaExchange\n            return null; // caller must reroute to arenaExchange\n        else {\n            // \n            // \n            // p\n            p.item = item;\n            // CASslot\n            if (U.compareAndSwapObject(this, SLOT, null, p))\n                // \n                break;\n            // CASslot\n            // itemnullslot\n            p.item = null;\n        }\n    }\n\n    // await release\n    // slot\n    // \n    int h = p.hash;\n    long end = timed ? System.nanoTime() + ns : 0 L;\n    // \n    int spins = (NCPU > 1) ? SPINS : 1;\n    Object v;\n    // p.matchnullslot\n    while ((v = p.match) == null) {\n        // spins0\n        if (spins > 0) {\n            h ^= h << 1;\n            h ^= h >>> 3;\n            h ^= h << 10;\n            if (h == 0)\n                h = SPINS | (int) t.getId();\n            else if (h < 0 && (--spins & ((SPINS >>> 1) - 1)) == 0)\n                Thread.yield();\n        } else if (slot != p)\n            spins = SPINS;\n        // \n        else if (!t.isInterrupted() && arena == null &&\n            (!timed || (ns = end - System.nanoTime()) > 0 L)) {\n            // t\n            U.putObject(t, BLOCKER, this);\n            // p\n            p.parked = t;\n            if (slot == p)\n                // slotnull\n                U.park(false, ns);\n            // null\n            p.parked = null;\n            // t\n            U.putObject(t, BLOCKER, null);\n        // (arenanull)    \n        } else if (U.compareAndSwapObject(this, SLOT, p, null)) {\n             // arenanullvnull,vTIMED_OUT\n            v = timed && ns <= 0 L && !t.isInterrupted() ? TIMED_OUT : null;\n            break;\n        }\n    }\n    // matchpmatchnull\n    U.putOrderedObject(p, MATCH, null);\n    // itemnull\n    p.item = null;\n    p.hash = h;\n    // \n    return v;\n}\n\n\nparticipantNodereturn nullInterruptedException\n\n * slotnullslotVarena\n * slotnullarenanullnullarenaExchange\n * slotnullarenanullslotspin+block(+)\n\n+match(releasing)nullspins+(hash)0slot(slot != p)&arenanull&(+)arenanull+vnullTIMED_OUTnull(arena)\n\nmatch\n\n\n# arenaExchange(Object item, boolean timed, long ns)\n\narenaslotExchangearena\n\n// timed truens>0\nprivate final Object arenaExchange(Object item, boolean timed, long ns) {\n    Node[] a = arena;\n    // node\n    Node p = participant.get();\n    //index0\n    for (int i = p.index;;) { // access slot at i\n        // \n        int b, m, c;\n        long j; // j is raw array offset\n        // \n        // qarena(i + 1) *  128node\n        Node q = (Node) U.getObjectVolatile(a, j = (i << ASHIFT) + ABASE);\n        // qnullCASjnull\n        if (q != null && U.compareAndSwapObject(a, j, q, null)) {\n            // \n            Object v = q.item; // release\n            q.match = item;\n            Thread w = q.parked;\n            if (w != null)\n                U.unpark(w);\n            return v;\n        // q null  i     \n        } else if (i <= (m = (b = bound) & MMASK) && q == null) {\n             // itempitem\n            p.item = item; // offer\n            if (U.compareAndSwapObject(a, j, null, p)) {\n                // \n                long end = (timed && m == 0) ? System.nanoTime() + ns : 0 L;\n                Thread t = Thread.currentThread(); // wait\n                // \n                for (int h = p.hash, spins = SPINS;;) {\n                    Object v = p.match;\n                    if (v != null) {\n                        // matchnull\n                        // matchnull,itemnull\n                        U.putOrderedObject(p, MATCH, null);\n                        p.item = null; // clear for next use\n                        p.hash = h;\n                        return v;\n                    } else if (spins > 0) {\n                        h ^= h << 1;\n                        h ^= h >>> 3;\n                        h ^= h << 10; // xorshift\n                        if (h == 0) // initialize hash\n                            h = SPINS | (int) t.getId();\n                        else if (h < 0 && // approx 50% true\n                            (--spins & ((SPINS >>> 1) - 1)) == 0)\n                            Thread.yield(); // two yields per wait\n                    } else if (U.getObjectVolatile(a, j) != p)\n                        // slotExchangearenaCAS\n                       // matchmatch\n                        spins = SPINS; // releaser hasn\'t set match yet\n                    else if (!t.isInterrupted() && m == 0 &&\n                        (!timed ||\n                            (ns = end - System.nanoTime()) > 0 L)) {\n                        // t\n                        U.putObject(t, BLOCKER, this); // emulate LockSupport\n                         // t\n                        p.parked = t; // minimize window\n                        if (U.getObjectVolatile(a, j) == p)\n                            // \n                            U.park(false, ns);\n                        p.parked = null;\n                         // t\n                        U.putObject(t, BLOCKER, null);\n                    } else if (U.getObjectVolatile(a, j) == p &&\n                        U.compareAndSwapObject(a, j, p, null)) {\n                        // boundSEQ\n                        if (m != 0) // try to shrink\n                            U.compareAndSwapInt(this, BOUND, b, b + SEQ - 1);\n                        p.item = null;\n                        p.hash = h;\n                        i = p.index >>>= 1; // descend\n                        if (Thread.interrupted())\n                            return null;\n                        if (timed && m == 0 && ns <= 0 L)\n                            return TIMED_OUT;\n                        break; // expired; restart\n                    }\n                }\n            } else\n                // arenai\n                p.item = null; // clear offer\n        } else {\n            // bound & MMASKqnullCAS\n           // bound\n            if (p.bound != b) { // stale; reset\n                p.bound = b;\n                p.collides = 0;\n                // \n                i = (i != m || m == 0) ? m : m - 1;\n            } else if ((c = p.collides) < m || m == FULL ||\n                !U.compareAndSwapInt(this, BOUND, b, b + SEQ + 1)) {\n                 // CAS\n                p.collides = c + 1;\n                // \n                i = (i == 0) ? m : i - 1; // cyclically traverse\n            } else\n                // boundSEQ+1\n                i = m + 1; // grow\n            // \n            p.index = i;\n        }\n    }\n}\n\n\nparticipantNodeNodeindexarenanode\n\n * arenaslotarena\n\narena = new Node[(FULL + 2) << ASHIFT];\n// arena? FULL ASHIFT\nstatic final int FULL = (NCPU >= (MMASK << 1)) ? MMASK : NCPU >>> 1;\nprivate static final int ASHIFT = 7;\n\nprivate static final int NCPU = Runtime.getRuntime().availableProcessors();\nprivate static final int MMASK = 0xff;        // 255\n// NCPU = 8 768arenaarena\n\nNode q = (Node)U.getObjectVolatile(a, j = (i << ASHIFT) + ABASE);\n// ASHIFTNodeABASE\n\nClass<?> ak = Node[].class;\nABASE = U.arrayBaseOffset(ak) + (1 << ASHIFT);\n// U.arrayBaseOffsetunsafe.arrayIndexScale(T[].class) TNoffsetarrayOffset+N*arrayScaleBASE = arrayOffset+ 128 \n\n\n * @sun.misc.Contended\n\nab(FIFO)cpu cache lineacache line(b)babab\n\nNode, Java 8 sun.misc.Contended << ASHIFTsun.misc.ContendedNode\n\n@sun.misc.Contended static final class Node{\n....\n}\n\n\narenaExchange()arenanodeq CAS\n\n * qnullbound & MMASK + \n * bound & MMASKqnullpbound bond(b != p.bound)p.bound = bcollides = 0 i = mm - 1m m boundcollidesiboundim+1index\n\n\n# \n\n * SynchronousQueue\n\nExchangerSynchronousQueueASynchronousQueueaBAExchangerBAaBBbASynchronousQueueExchanger\n\n * JDK\n   \n   * JDK5Exchanger1\n   * JDK6ExchangerConcurrentMapslot\n\nJDK1.6 \n\n\n# Exchanger\n\nbufferExchange2\n\npublic class Test {\n    static class Producer extends Thread {\n        private Exchanger<Integer> exchanger;\n        private static int data = 0;\n        Producer(String name, Exchanger<Integer> exchanger) {\n            super("Producer-" + name);\n            this.exchanger = exchanger;\n        }\n\n        @Override\n        public void run() {\n            for (int i=1; i<5; i++) {\n                try {\n                    TimeUnit.SECONDS.sleep(1);\n                    data = i;\n                    System.out.println(getName()+" :" + data);\n                    data = exchanger.exchange(data);\n                    System.out.println(getName()+" :" + data);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    static class Consumer extends Thread {\n        private Exchanger<Integer> exchanger;\n        private static int data = 0;\n        Consumer(String name, Exchanger<Integer> exchanger) {\n            super("Consumer-" + name);\n            this.exchanger = exchanger;\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                data = 0;\n                System.out.println(getName()+" :" + data);\n                try {\n                    TimeUnit.SECONDS.sleep(1);\n                    data = exchanger.exchange(data);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(getName()+" :" + data);\n            }\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        Exchanger<Integer> exchanger = new Exchanger<Integer>();\n        new Producer("", exchanger).start();\n        new Consumer("", exchanger).start();\n        TimeUnit.SECONDS.sleep(7);\n        System.exit(-1);\n    }\n}\n\n\n\n\nConsumer- :0\nProducer- :1\nConsumer- :1\nConsumer- :0\nProducer- :0\nProducer- :2\nProducer- :0\nConsumer- :2\nConsumer- :0\nProducer- :3\nProducer- :0\nConsumer- :3\nConsumer- :0\nProducer- :4\nProducer- :0\nConsumer- :4\nConsumer- :0\n\n\n\n# \n\n * https://cloud.tencent.com/developer/article/1529492\n * https://coderbee.net/index.php/concurrent/20140424/897\n * https://www.cnblogs.com/wanly3643/p/3939552.html\n * https://www.iteye.com/blog/brokendreams-2253956\n * https://blog.csdn.net/u014634338/article/details/78385521\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-exchanger.html',normalizedContent:'# juc: exchanger\n\n> exchanger, \n\n * juc: exchanger\n   * batexchanger\n   * exchanger\n   * exchanger\n   * exchanger\n     *  - participant\n     *  - node\n     * \n     * \n     *  - exchange(v x)\n     * slotexchange(object item, boolean timed, long ns)\n     * arenaexchange(object item, boolean timed, long ns)\n   * \n\n\n# batexchanger\n\n\n\nexchanger\n\n * exchanger?\n * synchronousqueueexchanger synchronousqueue ?\n * exchangerjdk?\n * exchanger?\n * exchangerslotarena node? ?\n * arenaslotarena?\n * exchanger?\n * exchanger\n\n\n# exchanger\n\nexchangerexchange()exchange()exchange()\n\n\n# exchanger\n\nfor (;;) {\n    if (slot is empty) { // offer\n        // slotitem node         \n        place item in a node;\n        if (can cas slot from empty to node) {\n            // nodecasslot\n            wait for release;\n            // nodeitem\n            return matching item in node;\n        }\n    } else if (can cas slot from node to empty) { // release\n         // slot\n        // nodeitemitem\n        get the item in node;\n        set matching item in node;\n        // \n        release waiting thread;\n    }\n    // else retry on cas failure\n}\n\n\n2abaslotslotbabaexchangerslot\n\n\n# exchanger\n\n\n#  - participant\n\nstatic final class participant extends threadlocal<node> {\n    public node initialvalue() { return new node(); }\n}\n\n\nparticipantnode, threadlocal\n\n\n#  - node\n\n@sun.misc.contended static final class node {\n     // arena\n    int index; \n    // exchanger.bound\n    int bound; \n    // boundcas\n    int collides;\n    // \n    int hash; \n    // \n    object item; \n    //releasing\n    volatile object match; \n    //null\n    volatile thread parked;\n}\n\n\nnodeboundcollidesareaarenaslotexchangerslotnodeslot? casslotarenaboundbound\n\n\n# \n\nprivate final participant participant;\nprivate volatile node[] arena;\nprivate volatile node slot;\n\n\n *  arena?\n\nslotarena, nodeslotexchanger? participant arena? slotarenaarenaslotexchangerarenaarena\n\n * node\n\nparticipantparticipant nodethreadlocalnodearenaindex\n\n\n# \n\n/**\n* creates a new exchanger.\n*/\npublic exchanger() {\n    participant = new participant();\n}\n\n\nparticipant\n\n\n#  - exchange(v x)\n\n()\n\npublic v exchange(v x) throws interruptedexception {\n    object v;\n    // nullitem\n    object item = (x == null) ? null_item : x; // translate null args\n    // \n    if ((arena != null ||\n            (v = slotexchange(item, false, 0 l)) == null) &&\n        ((thread.interrupted() || // disambiguates null return\n            (v = arenaexchange(item, false, 0 l)) == null)))\n        throw new interruptedexception();\n    return (v == null_item) ? null : (v) v;\n}\n\n\narenanullslotexchange()interruptedexceptionarenaexchange()slotexchange(object item, boolean timed, long ns)arenaexchange(object item, boolean timed, long ns)v\n\nnull_item objectslotexchange()slot\n\n\n# slotexchange(object item, boolean timed, long ns)\n\nprivate final object slotexchange(object item, boolean timed, long ns) {\n    // node\n    node p = participant.get();\n    // \n    thread t = thread.currentthread();\n    // null\n    if (t.isinterrupted()) // preserve interrupt status so caller can recheck\n        return null;\n\t// \n    for (node q;;) {\n        // slotq\n        if ((q = slot) != null) {\n             // slot nullslot\n\t\t\t// casslotnull\n            if (u.compareandswapobject(this, slot, q, null)) {\n                // casslotitemv\n                // \n                object v = q.item;\n                // qmatch\n                q.match = item;\n                 // \n                thread w = q.parked;\n                if (w != null)\n                    // null\n                    u.unpark(w);\n                // v\n                return v;\n            }\n            // create arena on contention, but continue until slot null\n            // cas \n            // ncpu:cpu\n            // bound == 0 arenacasboundseq\n            if (ncpu > 1 && bound == 0 &&\n                u.compareandswapint(this, bound, 0, seq))\n                // arena\n                arena = new node[(full + 2) << ashift];\n        }\n        // arenaslotexchange\n\t\t// arena\n        else if (arena != null)\n            // arenaexchange\n            return null; // caller must reroute to arenaexchange\n        else {\n            // \n            // \n            // p\n            p.item = item;\n            // casslot\n            if (u.compareandswapobject(this, slot, null, p))\n                // \n                break;\n            // casslot\n            // itemnullslot\n            p.item = null;\n        }\n    }\n\n    // await release\n    // slot\n    // \n    int h = p.hash;\n    long end = timed ? system.nanotime() + ns : 0 l;\n    // \n    int spins = (ncpu > 1) ? spins : 1;\n    object v;\n    // p.matchnullslot\n    while ((v = p.match) == null) {\n        // spins0\n        if (spins > 0) {\n            h ^= h << 1;\n            h ^= h >>> 3;\n            h ^= h << 10;\n            if (h == 0)\n                h = spins | (int) t.getid();\n            else if (h < 0 && (--spins & ((spins >>> 1) - 1)) == 0)\n                thread.yield();\n        } else if (slot != p)\n            spins = spins;\n        // \n        else if (!t.isinterrupted() && arena == null &&\n            (!timed || (ns = end - system.nanotime()) > 0 l)) {\n            // t\n            u.putobject(t, blocker, this);\n            // p\n            p.parked = t;\n            if (slot == p)\n                // slotnull\n                u.park(false, ns);\n            // null\n            p.parked = null;\n            // t\n            u.putobject(t, blocker, null);\n        // (arenanull)    \n        } else if (u.compareandswapobject(this, slot, p, null)) {\n             // arenanullvnull,vtimed_out\n            v = timed && ns <= 0 l && !t.isinterrupted() ? timed_out : null;\n            break;\n        }\n    }\n    // matchpmatchnull\n    u.putorderedobject(p, match, null);\n    // itemnull\n    p.item = null;\n    p.hash = h;\n    // \n    return v;\n}\n\n\nparticipantnodereturn nullinterruptedexception\n\n * slotnullslotvarena\n * slotnullarenanullnullarenaexchange\n * slotnullarenanullslotspin+block(+)\n\n+match(releasing)nullspins+(hash)0slot(slot != p)&arenanull&(+)arenanull+vnulltimed_outnull(arena)\n\nmatch\n\n\n# arenaexchange(object item, boolean timed, long ns)\n\narenaslotexchangearena\n\n// timed truens>0\nprivate final object arenaexchange(object item, boolean timed, long ns) {\n    node[] a = arena;\n    // node\n    node p = participant.get();\n    //index0\n    for (int i = p.index;;) { // access slot at i\n        // \n        int b, m, c;\n        long j; // j is raw array offset\n        // \n        // qarena(i + 1) *  128node\n        node q = (node) u.getobjectvolatile(a, j = (i << ashift) + abase);\n        // qnullcasjnull\n        if (q != null && u.compareandswapobject(a, j, q, null)) {\n            // \n            object v = q.item; // release\n            q.match = item;\n            thread w = q.parked;\n            if (w != null)\n                u.unpark(w);\n            return v;\n        // q null  i     \n        } else if (i <= (m = (b = bound) & mmask) && q == null) {\n             // itempitem\n            p.item = item; // offer\n            if (u.compareandswapobject(a, j, null, p)) {\n                // \n                long end = (timed && m == 0) ? system.nanotime() + ns : 0 l;\n                thread t = thread.currentthread(); // wait\n                // \n                for (int h = p.hash, spins = spins;;) {\n                    object v = p.match;\n                    if (v != null) {\n                        // matchnull\n                        // matchnull,itemnull\n                        u.putorderedobject(p, match, null);\n                        p.item = null; // clear for next use\n                        p.hash = h;\n                        return v;\n                    } else if (spins > 0) {\n                        h ^= h << 1;\n                        h ^= h >>> 3;\n                        h ^= h << 10; // xorshift\n                        if (h == 0) // initialize hash\n                            h = spins | (int) t.getid();\n                        else if (h < 0 && // approx 50% true\n                            (--spins & ((spins >>> 1) - 1)) == 0)\n                            thread.yield(); // two yields per wait\n                    } else if (u.getobjectvolatile(a, j) != p)\n                        // slotexchangearenacas\n                       // matchmatch\n                        spins = spins; // releaser hasn\'t set match yet\n                    else if (!t.isinterrupted() && m == 0 &&\n                        (!timed ||\n                            (ns = end - system.nanotime()) > 0 l)) {\n                        // t\n                        u.putobject(t, blocker, this); // emulate locksupport\n                         // t\n                        p.parked = t; // minimize window\n                        if (u.getobjectvolatile(a, j) == p)\n                            // \n                            u.park(false, ns);\n                        p.parked = null;\n                         // t\n                        u.putobject(t, blocker, null);\n                    } else if (u.getobjectvolatile(a, j) == p &&\n                        u.compareandswapobject(a, j, p, null)) {\n                        // boundseq\n                        if (m != 0) // try to shrink\n                            u.compareandswapint(this, bound, b, b + seq - 1);\n                        p.item = null;\n                        p.hash = h;\n                        i = p.index >>>= 1; // descend\n                        if (thread.interrupted())\n                            return null;\n                        if (timed && m == 0 && ns <= 0 l)\n                            return timed_out;\n                        break; // expired; restart\n                    }\n                }\n            } else\n                // arenai\n                p.item = null; // clear offer\n        } else {\n            // bound & mmaskqnullcas\n           // bound\n            if (p.bound != b) { // stale; reset\n                p.bound = b;\n                p.collides = 0;\n                // \n                i = (i != m || m == 0) ? m : m - 1;\n            } else if ((c = p.collides) < m || m == full ||\n                !u.compareandswapint(this, bound, b, b + seq + 1)) {\n                 // cas\n                p.collides = c + 1;\n                // \n                i = (i == 0) ? m : i - 1; // cyclically traverse\n            } else\n                // boundseq+1\n                i = m + 1; // grow\n            // \n            p.index = i;\n        }\n    }\n}\n\n\nparticipantnodenodeindexarenanode\n\n * arenaslotarena\n\narena = new node[(full + 2) << ashift];\n// arena? full ashift\nstatic final int full = (ncpu >= (mmask << 1)) ? mmask : ncpu >>> 1;\nprivate static final int ashift = 7;\n\nprivate static final int ncpu = runtime.getruntime().availableprocessors();\nprivate static final int mmask = 0xff;        // 255\n// ncpu = 8 768arenaarena\n\nnode q = (node)u.getobjectvolatile(a, j = (i << ashift) + abase);\n// ashiftnodeabase\n\nclass<?> ak = node[].class;\nabase = u.arraybaseoffset(ak) + (1 << ashift);\n// u.arraybaseoffsetunsafe.arrayindexscale(t[].class) tnoffsetarrayoffset+n*arrayscalebase = arrayoffset+ 128 \n\n\n * @sun.misc.contended\n\nab(fifo)cpu cache lineacache line(b)babab\n\nnode, java 8 sun.misc.contended << ashiftsun.misc.contendednode\n\n@sun.misc.contended static final class node{\n....\n}\n\n\narenaexchange()arenanodeq cas\n\n * qnullbound & mmask + \n * bound & mmaskqnullpbound bond(b != p.bound)p.bound = bcollides = 0 i = mm - 1m m boundcollidesiboundim+1index\n\n\n# \n\n * synchronousqueue\n\nexchangersynchronousqueueasynchronousqueueabaexchangerbaabbbasynchronousqueueexchanger\n\n * jdk\n   \n   * jdk5exchanger1\n   * jdk6exchangerconcurrentmapslot\n\njdk1.6 \n\n\n# exchanger\n\nbufferexchange2\n\npublic class test {\n    static class producer extends thread {\n        private exchanger<integer> exchanger;\n        private static int data = 0;\n        producer(string name, exchanger<integer> exchanger) {\n            super("producer-" + name);\n            this.exchanger = exchanger;\n        }\n\n        @override\n        public void run() {\n            for (int i=1; i<5; i++) {\n                try {\n                    timeunit.seconds.sleep(1);\n                    data = i;\n                    system.out.println(getname()+" :" + data);\n                    data = exchanger.exchange(data);\n                    system.out.println(getname()+" :" + data);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n            }\n        }\n    }\n\n    static class consumer extends thread {\n        private exchanger<integer> exchanger;\n        private static int data = 0;\n        consumer(string name, exchanger<integer> exchanger) {\n            super("consumer-" + name);\n            this.exchanger = exchanger;\n        }\n\n        @override\n        public void run() {\n            while (true) {\n                data = 0;\n                system.out.println(getname()+" :" + data);\n                try {\n                    timeunit.seconds.sleep(1);\n                    data = exchanger.exchange(data);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n                system.out.println(getname()+" :" + data);\n            }\n        }\n    }\n\n    public static void main(string[] args) throws interruptedexception {\n        exchanger<integer> exchanger = new exchanger<integer>();\n        new producer("", exchanger).start();\n        new consumer("", exchanger).start();\n        timeunit.seconds.sleep(7);\n        system.exit(-1);\n    }\n}\n\n\n\n\nconsumer- :0\nproducer- :1\nconsumer- :1\nconsumer- :0\nproducer- :0\nproducer- :2\nproducer- :0\nconsumer- :2\nconsumer- :0\nproducer- :3\nproducer- :0\nconsumer- :3\nconsumer- :0\nproducer- :4\nproducer- :0\nconsumer- :4\nconsumer- :0\n\n\n\n# \n\n * https://cloud.tencent.com/developer/article/1529492\n * https://coderbee.net/index.php/concurrent/20140424/897\n * https://www.cnblogs.com/wanly3643/p/3939552.html\n * https://www.iteye.com/blog/brokendreams-2253956\n * https://blog.csdn.net/u014634338/article/details/78385521\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-exchanger.html',charsets:{cjk:!0}},{title:"JUC: Semaphore",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-tool-semaphore.html",relativePath:"java/thread/java-thread-x-juc-tool-semaphore.md",key:"v-58f4b370",path:"/java/thread/java-thread-x-juc-tool-semaphore.html",headers:[{level:2,title:"JUC: Semaphore",slug:"juc-semaphore",normalizedTitle:"juc: semaphore",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:173},{level:2,title:"Semaphore",slug:"semaphore",normalizedTitle:"semaphore",charIndex:194},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:215},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:229},{level:3,title:" - Sync",slug:"-sync",normalizedTitle:" - sync",charIndex:242},{level:3,title:" - NonfairSync",slug:"-nonfairsync",normalizedTitle:" - nonfairsync",charIndex:263},{level:3,title:" - FairSync",slug:"-fairsync",normalizedTitle:" - fairsync",charIndex:291},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:316},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:328},{level:3,title:" - acquire",slug:"-acquire",normalizedTitle:" - acquire",charIndex:342},{level:3,title:" - release",slug:"-release",normalizedTitle:" - release",charIndex:368},{level:2,title:"Semaphore",slug:"semaphore",normalizedTitle:"semaphore",charIndex:392},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:409},{level:3,title:"SemaphoreAQS",slug:"semaphoreaqs",normalizedTitle:"semaphoreaqs",charIndex:422},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:458},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:750}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: Semaphore BAT Semaphore    - Sync  - NonfairSync  - FairSync    - acquire  - release Semaphore  SemaphoreAQS  ",content:'# JUC: Semaphore\n\n> SemaphoreAbstractQueuedSynchronizerSemaphoren\n\n * JUC: Semaphore\n   * BAT\n   * Semaphore\n     * \n     * \n     *  - Sync\n     *  - NonfairSync\n     *  - FairSync\n     * \n     * \n     *  - acquire\n     *  - release\n   * Semaphore\n   * \n     * SemaphoreAQS\n     * \n       * semaphore10111acquire?\n       * semaphore1011acquire?\n       * semaphore11acquirereleaseacquire(2)?\n       * semaphore21release3?\n   * \n\n\n# BAT\n\n\n\n\n\n * Semaphore?\n * Semaphore?\n * Semaphore? ?\n * Semaphore?\n * SemaphoreAQS?\n * Semaphore(acquire)(release)?\n * Semaphore10111acquire?\n * Semaphore1011acquire?\n * Semaphore11acquirereleaseacquire(2)?\n * Semaphore21release3?\n\n\n# Semaphore\n\n\n# \n\npublic class Semaphore implements java.io.Serializable {}\n\n\n: SemaphoreSerializable\n\n\n# \n\nSemaphore\n\n\n\n: SemaphoreReentrantLockSyncNonfairSyncFairSyncNonfairSyncFairSyncSyncSyncAbstractQueuedSynchronizer\n\n\n#  - Sync\n\nSync\n\n// AQS\nabstract static class Sync extends AbstractQueuedSynchronizer {\n    // \n    private static final long serialVersionUID = 1192457210091910933L;\n    \n    // \n    Sync(int permits) {\n        // \n        setState(permits);\n    }\n    \n    // \n    final int getPermits() {\n        return getState();\n    }\n\n    // \n    final int nonfairTryAcquireShared(int acquires) {\n        for (;;) { // \n            // \n            int available = getState();\n            // \n            int remaining = available - acquires;\n            if (remaining < 0 ||\n                compareAndSetState(available, remaining)) // 0\n                return remaining;\n        }\n    }\n    \n    // \n    protected final boolean tryReleaseShared(int releases) {\n        for (;;) { // \n            // \n            int current = getState();\n            // \n            int next = current + releases;\n            if (next < current) // overflow\n                throw new Error("Maximum permit count exceeded");\n            if (compareAndSetState(current, next)) // \n                return true;\n        }\n    }\n\n    // \n    final void reducePermits(int reductions) {\n        for (;;) { // \n            // \n            int current = getState();\n            // \n            int next = current - reductions;\n            if (next > current) // underflow\n                throw new Error("Permit count underflow");\n            if (compareAndSetState(current, next)) // \n                return;\n        }\n    }\n\n    // \n    final int drainPermits() {\n        for (;;) { // \n            // \n            int current = getState();\n            if (current == 0 || compareAndSetState(current, 0)) // 0\n                return current;\n        }\n    }\n}\n\n\n: SyncSync\n\n\n\n\n#  - NonfairSync\n\nNonfairSyncSynctryAcquireSharedAQS:\n\nstatic final class NonfairSync extends Sync {\n    // \n    private static final long serialVersionUID = -2694183684443567898L;\n    \n    // \n    NonfairSync(int permits) {\n        super(permits);\n    }\n    // \n    protected int tryAcquireShared(int acquires) {\n        return nonfairTryAcquireShared(acquires);\n    }\n}\n\n\n: tryAcquireSharedSyncnonfairTryAcquireShared\n\n\n#  - FairSync\n\nFairSyncSynctryAcquireSharedAQS\n\nprotected int tryAcquireShared(int acquires) {\n    for (;;) { // \n        if (hasQueuedPredecessors()) // \n            return -1;\n        // \n        int available = getState();\n        // \n        int remaining = available - acquires;\n        if (remaining < 0 ||\n            compareAndSetState(available, remaining)) // 0\n            return remaining;\n    }\n}\n\n\n: tryAcquireShared\n\n\n# \n\npublic class Semaphore implements java.io.Serializable {\n    // \n    private static final long serialVersionUID = -3222578661600680210L;\n    // \n    private final Sync sync;\n}\n\n\n: SemaphoresyncSemaphoresync\n\n\n# \n\n * Semaphore(int)\n\npublic Semaphore(int permits) {\n    sync = new NonfairSync(permits);\n}\n\n\n: Semaphore\n\n * Semaphore(int, boolean)\n\npublic Semaphore(int permits, boolean fair) {\n    sync = fair ? new FairSync(permits) : new NonfairSync(permits);\n}\n\n\n: Semaphore\n\n\n#  - acquire\n\n()\n\npublic void acquire() throws InterruptedException {\n    sync.acquireSharedInterruptibly(1);\n}\n\n\n: SyncacquireSharedInterruptibly(AQS)acquireSharedInterruptiblyCountDownLatch\n\n()\n\n\n\n: \n\n\n#  - release\n\n()\n\npublic void release() {\n    sync.releaseShared(1);\n}\n\n\n: SyncreleaseShared(AQS)releaseSharedCountDownLatch\n\n():\n\n\n\n: \n\n\n# Semaphore\n\nSemaphore\n\nimport java.util.concurrent.Semaphore;\n\nclass MyThread extends Thread {\n    private Semaphore semaphore;\n    \n    public MyThread(String name, Semaphore semaphore) {\n        super(name);\n        this.semaphore = semaphore;\n    }\n    \n    public void run() {        \n        int count = 3;\n        System.out.println(Thread.currentThread().getName() + " trying to acquire");\n        try {\n            semaphore.acquire(count);\n            System.out.println(Thread.currentThread().getName() + " acquire successfully");\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            semaphore.release(count);\n            System.out.println(Thread.currentThread().getName() + " release successfully");\n        }\n    }\n}\n\npublic class SemaphoreDemo {\n    public final static int SEM_SIZE = 10;\n    \n    public static void main(String[] args) {\n        Semaphore semaphore = new Semaphore(SEM_SIZE);\n        MyThread t1 = new MyThread("t1", semaphore);\n        MyThread t2 = new MyThread("t2", semaphore);\n        t1.start();\n        t2.start();\n        int permits = 5;\n        System.out.println(Thread.currentThread().getName() + " trying to acquire");\n        try {\n            semaphore.acquire(permits);\n            System.out.println(Thread.currentThread().getName() + " acquire successfully");\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            semaphore.release();\n            System.out.println(Thread.currentThread().getName() + " release successfully");\n        }      \n    }\n}\n\n\n():\n\nmain trying to acquire\nmain acquire successfully\nt1 trying to acquire\nt1 acquire successfully\nt2 trying to acquire\nt1 release successfully\nmain release successfully\nt2 acquire successfully\nt2 release successfully\n\n\n: 10maint1t2\n\n\n\n: mainacquiret1acquiret2acquiret2t1maint2t2t2\n\n * mainsemaphore.acquire\n\n\n\n: AQSstate5main\n\n * t1semaphore.acquire\n\n\n\n: AQSstate2t1\n\n * t2semaphore.acquire\n\n\n\n: t2AQSstate2\n\n * t1semaphore.release\n\n\n\n: t2unparkAQSstate5t2cpu\n\n * mainsemaphore.release\n\n\n\n: t2unparkt2CPUAQSstate10\n\n * t2CPUt2parkAndCheckInterruptshould\n\n\n\n: Sync queuesetHeadAndPropagateunpark\n\n * t2semaphore.release\n\n\n\n: t2release10Sync queue\n\n\n# \n\n\n# SemaphoreAQS\n\nCyclicBarrierReentrantLockSemaphoreAQSawaitpark\n\n\n# \n\n# semaphore10111acquire?\n\n\n\n# semaphore1011acquire?\n\nacquire\n\n# semaphore11acquirereleaseacquire(2)?\n\nrelease\n\n# semaphore21release3?\n\nreleaseSemaphorereleaseacquire\n\ndemo\n\npublic class TestSemaphore2 {\n    public static void main(String[] args) {\n        int permitsNum = 2;\n        final Semaphore semaphore = new Semaphore(permitsNum);\n        try {\n            System.out.println("availablePermits:"+semaphore.availablePermits()+",semaphore.tryAcquire(3,1, TimeUnit.SECONDS):"+semaphore.tryAcquire(3,1, TimeUnit.SECONDS));\n            semaphore.release();\n            System.out.println("availablePermits:"+semaphore.availablePermits()+",semaphore.tryAcquire(3,1, TimeUnit.SECONDS):"+semaphore.tryAcquire(3,1, TimeUnit.SECONDS));\n        }catch (Exception e) {\n\n        }\n    }\n}\n\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5414778.html\n * https://blog.csdn.net/u010412719/article/details/94986327\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-semaphore.html',normalizedContent:'# juc: semaphore\n\n> semaphoreabstractqueuedsynchronizersemaphoren\n\n * juc: semaphore\n   * bat\n   * semaphore\n     * \n     * \n     *  - sync\n     *  - nonfairsync\n     *  - fairsync\n     * \n     * \n     *  - acquire\n     *  - release\n   * semaphore\n   * \n     * semaphoreaqs\n     * \n       * semaphore10111acquire?\n       * semaphore1011acquire?\n       * semaphore11acquirereleaseacquire(2)?\n       * semaphore21release3?\n   * \n\n\n# bat\n\n\n\n\n\n * semaphore?\n * semaphore?\n * semaphore? ?\n * semaphore?\n * semaphoreaqs?\n * semaphore(acquire)(release)?\n * semaphore10111acquire?\n * semaphore1011acquire?\n * semaphore11acquirereleaseacquire(2)?\n * semaphore21release3?\n\n\n# semaphore\n\n\n# \n\npublic class semaphore implements java.io.serializable {}\n\n\n: semaphoreserializable\n\n\n# \n\nsemaphore\n\n\n\n: semaphorereentrantlocksyncnonfairsyncfairsyncnonfairsyncfairsyncsyncsyncabstractqueuedsynchronizer\n\n\n#  - sync\n\nsync\n\n// aqs\nabstract static class sync extends abstractqueuedsynchronizer {\n    // \n    private static final long serialversionuid = 1192457210091910933l;\n    \n    // \n    sync(int permits) {\n        // \n        setstate(permits);\n    }\n    \n    // \n    final int getpermits() {\n        return getstate();\n    }\n\n    // \n    final int nonfairtryacquireshared(int acquires) {\n        for (;;) { // \n            // \n            int available = getstate();\n            // \n            int remaining = available - acquires;\n            if (remaining < 0 ||\n                compareandsetstate(available, remaining)) // 0\n                return remaining;\n        }\n    }\n    \n    // \n    protected final boolean tryreleaseshared(int releases) {\n        for (;;) { // \n            // \n            int current = getstate();\n            // \n            int next = current + releases;\n            if (next < current) // overflow\n                throw new error("maximum permit count exceeded");\n            if (compareandsetstate(current, next)) // \n                return true;\n        }\n    }\n\n    // \n    final void reducepermits(int reductions) {\n        for (;;) { // \n            // \n            int current = getstate();\n            // \n            int next = current - reductions;\n            if (next > current) // underflow\n                throw new error("permit count underflow");\n            if (compareandsetstate(current, next)) // \n                return;\n        }\n    }\n\n    // \n    final int drainpermits() {\n        for (;;) { // \n            // \n            int current = getstate();\n            if (current == 0 || compareandsetstate(current, 0)) // 0\n                return current;\n        }\n    }\n}\n\n\n: syncsync\n\n\n\n\n#  - nonfairsync\n\nnonfairsyncsynctryacquiresharedaqs:\n\nstatic final class nonfairsync extends sync {\n    // \n    private static final long serialversionuid = -2694183684443567898l;\n    \n    // \n    nonfairsync(int permits) {\n        super(permits);\n    }\n    // \n    protected int tryacquireshared(int acquires) {\n        return nonfairtryacquireshared(acquires);\n    }\n}\n\n\n: tryacquiresharedsyncnonfairtryacquireshared\n\n\n#  - fairsync\n\nfairsyncsynctryacquiresharedaqs\n\nprotected int tryacquireshared(int acquires) {\n    for (;;) { // \n        if (hasqueuedpredecessors()) // \n            return -1;\n        // \n        int available = getstate();\n        // \n        int remaining = available - acquires;\n        if (remaining < 0 ||\n            compareandsetstate(available, remaining)) // 0\n            return remaining;\n    }\n}\n\n\n: tryacquireshared\n\n\n# \n\npublic class semaphore implements java.io.serializable {\n    // \n    private static final long serialversionuid = -3222578661600680210l;\n    // \n    private final sync sync;\n}\n\n\n: semaphoresyncsemaphoresync\n\n\n# \n\n * semaphore(int)\n\npublic semaphore(int permits) {\n    sync = new nonfairsync(permits);\n}\n\n\n: semaphore\n\n * semaphore(int, boolean)\n\npublic semaphore(int permits, boolean fair) {\n    sync = fair ? new fairsync(permits) : new nonfairsync(permits);\n}\n\n\n: semaphore\n\n\n#  - acquire\n\n()\n\npublic void acquire() throws interruptedexception {\n    sync.acquiresharedinterruptibly(1);\n}\n\n\n: syncacquiresharedinterruptibly(aqs)acquiresharedinterruptiblycountdownlatch\n\n()\n\n\n\n: \n\n\n#  - release\n\n()\n\npublic void release() {\n    sync.releaseshared(1);\n}\n\n\n: syncreleaseshared(aqs)releasesharedcountdownlatch\n\n():\n\n\n\n: \n\n\n# semaphore\n\nsemaphore\n\nimport java.util.concurrent.semaphore;\n\nclass mythread extends thread {\n    private semaphore semaphore;\n    \n    public mythread(string name, semaphore semaphore) {\n        super(name);\n        this.semaphore = semaphore;\n    }\n    \n    public void run() {        \n        int count = 3;\n        system.out.println(thread.currentthread().getname() + " trying to acquire");\n        try {\n            semaphore.acquire(count);\n            system.out.println(thread.currentthread().getname() + " acquire successfully");\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            semaphore.release(count);\n            system.out.println(thread.currentthread().getname() + " release successfully");\n        }\n    }\n}\n\npublic class semaphoredemo {\n    public final static int sem_size = 10;\n    \n    public static void main(string[] args) {\n        semaphore semaphore = new semaphore(sem_size);\n        mythread t1 = new mythread("t1", semaphore);\n        mythread t2 = new mythread("t2", semaphore);\n        t1.start();\n        t2.start();\n        int permits = 5;\n        system.out.println(thread.currentthread().getname() + " trying to acquire");\n        try {\n            semaphore.acquire(permits);\n            system.out.println(thread.currentthread().getname() + " acquire successfully");\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            semaphore.release();\n            system.out.println(thread.currentthread().getname() + " release successfully");\n        }      \n    }\n}\n\n\n():\n\nmain trying to acquire\nmain acquire successfully\nt1 trying to acquire\nt1 acquire successfully\nt2 trying to acquire\nt1 release successfully\nmain release successfully\nt2 acquire successfully\nt2 release successfully\n\n\n: 10maint1t2\n\n\n\n: mainacquiret1acquiret2acquiret2t1maint2t2t2\n\n * mainsemaphore.acquire\n\n\n\n: aqsstate5main\n\n * t1semaphore.acquire\n\n\n\n: aqsstate2t1\n\n * t2semaphore.acquire\n\n\n\n: t2aqsstate2\n\n * t1semaphore.release\n\n\n\n: t2unparkaqsstate5t2cpu\n\n * mainsemaphore.release\n\n\n\n: t2unparkt2cpuaqsstate10\n\n * t2cput2parkandcheckinterruptshould\n\n\n\n: sync queuesetheadandpropagateunpark\n\n * t2semaphore.release\n\n\n\n: t2release10sync queue\n\n\n# \n\n\n# semaphoreaqs\n\ncyclicbarrierreentrantlocksemaphoreaqsawaitpark\n\n\n# \n\n# semaphore10111acquire?\n\n\n\n# semaphore1011acquire?\n\nacquire\n\n# semaphore11acquirereleaseacquire(2)?\n\nrelease\n\n# semaphore21release3?\n\nreleasesemaphorereleaseacquire\n\ndemo\n\npublic class testsemaphore2 {\n    public static void main(string[] args) {\n        int permitsnum = 2;\n        final semaphore semaphore = new semaphore(permitsnum);\n        try {\n            system.out.println("availablepermits:"+semaphore.availablepermits()+",semaphore.tryacquire(3,1, timeunit.seconds):"+semaphore.tryacquire(3,1, timeunit.seconds));\n            semaphore.release();\n            system.out.println("availablepermits:"+semaphore.availablepermits()+",semaphore.tryacquire(3,1, timeunit.seconds):"+semaphore.tryacquire(3,1, timeunit.seconds));\n        }catch (exception e) {\n\n        }\n    }\n}\n\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5414778.html\n * https://blog.csdn.net/u010412719/article/details/94986327\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-semaphore.html',charsets:{cjk:!0}},{title:"JUC: Phaser",frontmatter:{},regularPath:"/java/thread/java-thread-x-juc-tool-phaser.html",relativePath:"java/thread/java-thread-x-juc-tool-phaser.md",key:"v-57dda42e",path:"/java/thread/java-thread-x-juc-tool-phaser.html",headers:[{level:2,title:"JUC: Phaser",slug:"juc-phaser",normalizedTitle:"juc: phaser",charIndex:2},{level:2,title:"BATPhaser",slug:"batphaser",normalizedTitle:"batphaser",charIndex:142},{level:2,title:"Phaser",slug:"phaser",normalizedTitle:"phaser",charIndex:171},{level:2,title:"Phaser",slug:"phaser",normalizedTitle:"phaser",charIndex:187},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:205},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:217},{level:3,title:" - register()",slug:"-register",normalizedTitle:" - register()",charIndex:229},{level:3,title:" - arrive()",slug:"-arrive",normalizedTitle:" - arrive()",charIndex:252},{level:3,title:" - arriveAndAwaitAdvance()",slug:"-arriveandawaitadvance",normalizedTitle:" - arriveandawaitadvance()",charIndex:273},{level:3,title:" - awaitAdvance(int phase)",slug:"-awaitadvance-int-phase",normalizedTitle:" - awaitadvance(int phase)",charIndex:309},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:343}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: Phaser BATPhaser Phaser Phaser    - register()  - arrive()  - arriveAndAwaitAdvance()  - awaitAdvance(int phase) ",content:'# JUC: Phaser\n\n> PhaserJDK 7CyclicBarrierCountDownLatch\n\n * JUC: Phaser\n   * BATPhaser\n   * Phaser\n   * Phaser\n     * \n     * \n     *  - register()\n     *  - arrive()\n     *  - arriveAndAwaitAdvance()\n     *  - awaitAdvance(int phase)\n   * \n\n\n# BATPhaser\n\n\n\nPhaser\n\n * Phaser?\n * PhaserCyclicBarrierCountDownLatch?\n * CountDownLatchPhaser?\n * Phaser?\n * Phaser?\n\n\n# Phaser\n\n\n\n * Registration()\n\nbarrierphaserparties(register,bulkRegisterparties)(arriveAndDeregister)count()\n\n * Synchronization()\n\nCyclicBarrierPhaserawaitarriveAndAwaitAdvanceCyclicBarrier.awaitphaserphase number0phaserphase+1(Integer.MAX_VALUE)phase number phaser   :\n\n>  * Arrival() arrivearriveAndDeregisterarrival phase numberphase numberphaseonAdvanceCyclicBarrierbarrierAction\n> \n>  * Waiting() awaitAdvancearrival phase numberphaserphasephaseCyclicBarrierawaitAdvancephaserforceTerminationhandlerPhaserForkJoinPoolphase\n\n * Termination() :\n\nisTerminatedphaseronAdvancetrueTerminationderegistrationparties0onAdvancetrueonAdvanceforceTermination\n\n * Tiering() :\n\nPhaser()partiesPhaser Phaserparent phaserphaserphaserregisterbulkRegisterphaserarriveAndDeregister\n\n * Monitoring() :\n\npartiesphasergetRegisteredPartiespartiesgetArrivedPartiesphasepartiesparties(getUnarrivedParties)phase\n\n\n# Phaser\n\n\n# \n\nprivate volatile long state;\n/**\n * The parent of this phaser, or null if none\n */\nprivate final Phaser parent;\n/**\n * The root of phaser tree. Equals this if not in a tree.\n */\nprivate final Phaser root;\n//phaseheaderheader\nprivate final AtomicReference<QNode> evenQ;\nprivate final AtomicReference<QNode> oddQ;\n\n\n\nstate:\n\nPhaserlongstate:\n\n * 0-15parties\n * 16-31parties\n * 32-62phase\n * 63phaser\n\n: PhaserphaserootreconcileState QnodePhaserForkJoinPoolManagedBlockerPhaserForkJoinPoolphase(isReleasableblock)\n\n\n# \n\n//\npublic Phaser() {\n    this(null, 0);\n}\npublic Phaser(int parties) {\n    this(null, parties);\n}\npublic Phaser(Phaser parent) {\n    this(parent, 0);\n}\npublic Phaser(Phaser parent, int parties)\n//party\npublic int register()\n//\npublic int bulkRegister(int parties)\n//phaserarrival phase number\npublic int arrive() \n//phaserarrival phase number\npublic int arriveAndDeregister()\n/*\n * phaserawaitAdvance(arrive())\n * awaitAdvance\n * awaitAdvance(arriveAndDeregister())\n */\npublic int arriveAndAwaitAdvance()\n//phase arrival phase number\npublic int awaitAdvance(int phase)\n//phasephase number\npublic int awaitAdvance(int phase) \n//awaitAdvance\npublic int awaitAdvanceInterruptibly(int phase) throws InterruptedException\npublic int awaitAdvanceInterruptibly(int phase, long timeout, TimeUnit unit)\n    throws InterruptedException, TimeoutException\n//phaserpartiesphaser\npublic void forceTermination()\n\n\n\n#  - register()\n\n//party\npublic int register() {\n    return doRegister(1);\n}\nprivate int doRegister(int registrations) {\n    // adjustment to state\n    long adjust = ((long)registrations << PARTIES_SHIFT) | registrations;\n    final Phaser parent = this.parent;\n    int phase;\n    for (;;) {\n        long s = (parent == null) ? state : reconcileState();\n        int counts = (int)s;\n        int parties = counts >>> PARTIES_SHIFT;//parties\n        int unarrived = counts & UNARRIVED_MASK;//\n        if (registrations > MAX_PARTIES - parties)\n            throw new IllegalStateException(badRegister(s));\n        phase = (int)(s >>> PHASE_SHIFT);//\n        if (phase < 0)\n            break;\n        if (counts != EMPTY) {                  // not 1st registration\n            if (parent == null || reconcileState() == s) {\n                if (unarrived == 0)             // wait out advance\n                    root.internalAwaitAdvance(phase, null);//\n                else if (UNSAFE.compareAndSwapLong(this, stateOffset,\n                                                   s, s + adjust))//parties\n                    break;\n            }\n        }\n        else if (parent == null) {              // 1st root registration\n            long next = ((long)phase << PHASE_SHIFT) | adjust;\n            if (UNSAFE.compareAndSwapLong(this, stateOffset, s, next))//phase\n                break;\n        }\n        else {\n            //phaser\n            synchronized (this) {               // 1st sub registration\n                if (state == s) {               // recheck under lock\n                    phase = parent.doRegister(1);//\n                    if (phase < 0)\n                        break;\n                    // finish registration whenever parent registration\n                    // succeeded, even when racing with termination,\n                    // since these are part of the same "transaction".\n                    //phaser\n                    while (!UNSAFE.compareAndSwapLong\n                           (this, stateOffset, s,\n                            ((long)phase << PHASE_SHIFT) | adjust)) {//phase\n                        s = state;\n                        phase = (int)(root.state >>> PHASE_SHIFT);\n                        // assert (int)s == EMPTY;\n                    }\n                    break;\n                }\n            }\n        }\n    }\n    return phase;\n}\n\n\n: registerphaserpartyonAdvancephaserphaserparty\n\nregisterbulkRegisterdoRegister:\n\n * phaserparties\n * phaserrootphase\n * phaserphaserphase\n * PhaserphaserootPhaserreconcileState()rootphase :\n\nprivate long reconcileState() {\n    final Phaser root = this.root;\n    long s = state;\n    if (root != this) {\n        int phase, p;\n        // CAS to root phase with current parties, tripping unarrived\n        while ((phase = (int)(root.state >>> PHASE_SHIFT)) !=\n               (int)(s >>> PHASE_SHIFT) &&\n               !UNSAFE.compareAndSwapLong\n               (this, stateOffset, s,\n                s = (((long)phase << PHASE_SHIFT) |\n                     ((phase < 0) ? (s & COUNTS_MASK) :\n                      (((p = (int)s >>> PARTIES_SHIFT) == 0) ? EMPTY :\n                       ((s & PARTIES_MASK) | p))))))\n            s = state;\n    }\n    return s;\n}\n\n\nrootphaseadvancephaserparties advance(parties0EMPTY)\n\nregister0phaseinternalAwaitAdvance():\n\n//phase\nprivate int internalAwaitAdvance(int phase, QNode node) {\n    // assert root == this;\n    releaseWaiters(phase-1);          // ensure old queue clean\n    boolean queued = false;           // true when node is enqueued\n    int lastUnarrived = 0;            // to increase spins upon change\n    int spins = SPINS_PER_ARRIVAL;\n    long s;\n    int p;\n    while ((p = (int)((s = state) >>> PHASE_SHIFT)) == phase) {\n        if (node == null) {           // spinning in noninterruptible mode\n            int unarrived = (int)s & UNARRIVED_MASK;//\n            if (unarrived != lastUnarrived &&\n                (lastUnarrived = unarrived) < NCPU)\n                spins += SPINS_PER_ARRIVAL;\n            boolean interrupted = Thread.interrupted();\n            if (interrupted || --spins < 0) { // need node to record intr\n                //node\n                node = new QNode(this, phase, false, false, 0L);\n                node.wasInterrupted = interrupted;\n            }\n        }\n        else if (node.isReleasable()) // done or aborted\n            break;\n        else if (!queued) {           // push onto queue\n            AtomicReference<QNode> head = (phase & 1) == 0 ? evenQ : oddQ;\n            QNode q = node.next = head.get();\n            if ((q == null || q.phase == phase) &&\n                (int)(state >>> PHASE_SHIFT) == phase) // avoid stale enq\n                queued = head.compareAndSet(q, node);\n        }\n        else {\n            try {\n                ForkJoinPool.managedBlock(node);//node\n            } catch (InterruptedException ie) {\n                node.wasInterrupted = true;\n            }\n        }\n    }\n\n    if (node != null) {\n        if (node.thread != null)\n            node.thread = null;       // avoid need for unpark()\n        if (node.wasInterrupted && !node.interruptible)\n            Thread.currentThread().interrupt();\n        if (p == phase && (p = (int)(state >>> PHASE_SHIFT)) == phase)\n            return abortWait(phase); // possibly clean up on abort\n    }\n    releaseWaiters(phase);\n    return p;\n}\n\n\nnodedoRegisterinternalAwaitAdvance:\n\n * releaseWaiters\n * SPINS_PER_ARRIVALnode\n * ForkJoinPool.managedBlock\n * \n * phase\n\n\n#  - arrive()\n\n//phaserarrival phase number\npublic int arrive() {\n    return doArrive(ONE_ARRIVAL);\n}\n\nprivate int doArrive(int adjust) {\n    final Phaser root = this.root;\n    for (;;) {\n        long s = (root == this) ? state : reconcileState();\n        int phase = (int)(s >>> PHASE_SHIFT);\n        if (phase < 0)\n            return phase;\n        int counts = (int)s;\n        //\n        int unarrived = (counts == EMPTY) ? 0 : (counts & UNARRIVED_MASK);\n        if (unarrived <= 0)\n            throw new IllegalStateException(badArrive(s));\n        if (UNSAFE.compareAndSwapLong(this, stateOffset, s, s-=adjust)) {//state\n            if (unarrived == 1) {//\n                long n = s & PARTIES_MASK;  // base of next state\n                int nextUnarrived = (int)n >>> PARTIES_SHIFT;\n                if (root == this) {\n                    if (onAdvance(phase, nextUnarrived))//phaser\n                        n |= TERMINATION_BIT;\n                    else if (nextUnarrived == 0)\n                        n |= EMPTY;\n                    else\n                        n |= nextUnarrived;\n                    int nextPhase = (phase + 1) & MAX_PHASE;\n                    n |= (long)nextPhase << PHASE_SHIFT;\n                    UNSAFE.compareAndSwapLong(this, stateOffset, s, n);\n                    releaseWaiters(phase);//phase\n                }\n                //arrive\n                else if (nextUnarrived == 0) { //propagate deregistration\n                    phase = parent.doArrive(ONE_DEREGISTER);\n                    UNSAFE.compareAndSwapLong(this, stateOffset,\n                                              s, s | EMPTY);\n                }\n                else\n                    phase = parent.doArrive(ONE_ARRIVAL);\n            }\n            return phase;\n        }\n    }\n}\n\n\n: arrivephaserarrivearriveAndDeregisterdoArrive:\n\n * state(state - adjust)\n * phase\n * :\n   * rootphaserCASphase\n   * partiesdoArrivestateEMPTY\n\n\n#  - arriveAndAwaitAdvance()\n\npublic int arriveAndAwaitAdvance() {\n    // Specialization of doArrive+awaitAdvance eliminating some reads/paths\n    final Phaser root = this.root;\n    for (;;) {\n        long s = (root == this) ? state : reconcileState();\n        int phase = (int)(s >>> PHASE_SHIFT);\n        if (phase < 0)\n            return phase;\n        int counts = (int)s;\n        int unarrived = (counts == EMPTY) ? 0 : (counts & UNARRIVED_MASK);//\n        if (unarrived <= 0)\n            throw new IllegalStateException(badArrive(s));\n        if (UNSAFE.compareAndSwapLong(this, stateOffset, s,\n                                      s -= ONE_ARRIVAL)) {//state\n            if (unarrived > 1)\n                return root.internalAwaitAdvance(phase, null);//\n            if (root != this)\n                return parent.arriveAndAwaitAdvance();//Phaser\n            long n = s & PARTIES_MASK;  // base of next state\n            int nextUnarrived = (int)n >>> PARTIES_SHIFT;\n            if (onAdvance(phase, nextUnarrived))//\n                n |= TERMINATION_BIT;\n            else if (nextUnarrived == 0)\n                n |= EMPTY;\n            else\n                n |= nextUnarrived;\n            int nextPhase = (phase + 1) & MAX_PHASE;//phase\n            n |= (long)nextPhase << PHASE_SHIFT;\n            if (!UNSAFE.compareAndSwapLong(this, stateOffset, s, n))//state\n                return (int)(state >>> PHASE_SHIFT); // terminated\n            releaseWaiters(phase);//phase\n            return nextPhase;\n        }\n    }\n}\n\n\n: phaserawaitAdvance(arrive())awaitAdvanceawaitAdvance(arriveAndDeregister())CyclicBarrier.await:\n\n * state(state - 1)\n * 1internalAwaitAdvancephase\n * arriveAndAwaitAdvance\n * <=1phaserCASphasephasephase\n\n\n#  - awaitAdvance(int phase)\n\npublic int awaitAdvance(int phase) {\n    final Phaser root = this.root;\n    long s = (root == this) ? state : reconcileState();\n    int p = (int)(s >>> PHASE_SHIFT);\n    if (phase < 0)\n        return phase;\n    if (p == phase)\n        return root.internalAwaitAdvance(phase, null);\n    return p;\n}\n//awaitAdvance\npublic int awaitAdvanceInterruptibly(int phase)\n    throws InterruptedException {\n    final Phaser root = this.root;\n    long s = (root == this) ? state : reconcileState();\n    int p = (int)(s >>> PHASE_SHIFT);\n    if (phase < 0)\n        return phase;\n    if (p == phase) {\n        QNode node = new QNode(this, phase, true, false, 0L);\n        p = root.internalAwaitAdvance(phase, node);\n        if (node.wasInterrupted)\n            throw new InterruptedException();\n    }\n    return p;\n}\n\n\n: awaitAdvancephasephase numberawaitAdvanceInterruptiblyawaitAdvance\n\n\n# \n\n * bagwellhttps://www.jianshu.com/p/e5794645ca8d\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-phaser.html',normalizedContent:'# juc: phaser\n\n> phaserjdk 7cyclicbarriercountdownlatch\n\n * juc: phaser\n   * batphaser\n   * phaser\n   * phaser\n     * \n     * \n     *  - register()\n     *  - arrive()\n     *  - arriveandawaitadvance()\n     *  - awaitadvance(int phase)\n   * \n\n\n# batphaser\n\n\n\nphaser\n\n * phaser?\n * phasercyclicbarriercountdownlatch?\n * countdownlatchphaser?\n * phaser?\n * phaser?\n\n\n# phaser\n\n\n\n * registration()\n\nbarrierphaserparties(register,bulkregisterparties)(arriveandderegister)count()\n\n * synchronization()\n\ncyclicbarrierphaserawaitarriveandawaitadvancecyclicbarrier.awaitphaserphase number0phaserphase+1(integer.max_value)phase number phaser   :\n\n>  * arrival() arrivearriveandderegisterarrival phase numberphase numberphaseonadvancecyclicbarrierbarrieraction\n> \n>  * waiting() awaitadvancearrival phase numberphaserphasephasecyclicbarrierawaitadvancephaserforceterminationhandlerphaserforkjoinpoolphase\n\n * termination() :\n\nisterminatedphaseronadvancetrueterminationderegistrationparties0onadvancetrueonadvanceforcetermination\n\n * tiering() :\n\nphaser()partiesphaser phaserparent phaserphaserphaserregisterbulkregisterphaserarriveandderegister\n\n * monitoring() :\n\npartiesphasergetregisteredpartiespartiesgetarrivedpartiesphasepartiesparties(getunarrivedparties)phase\n\n\n# phaser\n\n\n# \n\nprivate volatile long state;\n/**\n * the parent of this phaser, or null if none\n */\nprivate final phaser parent;\n/**\n * the root of phaser tree. equals this if not in a tree.\n */\nprivate final phaser root;\n//phaseheaderheader\nprivate final atomicreference<qnode> evenq;\nprivate final atomicreference<qnode> oddq;\n\n\n\nstate:\n\nphaserlongstate:\n\n * 0-15parties\n * 16-31parties\n * 32-62phase\n * 63phaser\n\n: phaserphaserootreconcilestate qnodephaserforkjoinpoolmanagedblockerphaserforkjoinpoolphase(isreleasableblock)\n\n\n# \n\n//\npublic phaser() {\n    this(null, 0);\n}\npublic phaser(int parties) {\n    this(null, parties);\n}\npublic phaser(phaser parent) {\n    this(parent, 0);\n}\npublic phaser(phaser parent, int parties)\n//party\npublic int register()\n//\npublic int bulkregister(int parties)\n//phaserarrival phase number\npublic int arrive() \n//phaserarrival phase number\npublic int arriveandderegister()\n/*\n * phaserawaitadvance(arrive())\n * awaitadvance\n * awaitadvance(arriveandderegister())\n */\npublic int arriveandawaitadvance()\n//phase arrival phase number\npublic int awaitadvance(int phase)\n//phasephase number\npublic int awaitadvance(int phase) \n//awaitadvance\npublic int awaitadvanceinterruptibly(int phase) throws interruptedexception\npublic int awaitadvanceinterruptibly(int phase, long timeout, timeunit unit)\n    throws interruptedexception, timeoutexception\n//phaserpartiesphaser\npublic void forcetermination()\n\n\n\n#  - register()\n\n//party\npublic int register() {\n    return doregister(1);\n}\nprivate int doregister(int registrations) {\n    // adjustment to state\n    long adjust = ((long)registrations << parties_shift) | registrations;\n    final phaser parent = this.parent;\n    int phase;\n    for (;;) {\n        long s = (parent == null) ? state : reconcilestate();\n        int counts = (int)s;\n        int parties = counts >>> parties_shift;//parties\n        int unarrived = counts & unarrived_mask;//\n        if (registrations > max_parties - parties)\n            throw new illegalstateexception(badregister(s));\n        phase = (int)(s >>> phase_shift);//\n        if (phase < 0)\n            break;\n        if (counts != empty) {                  // not 1st registration\n            if (parent == null || reconcilestate() == s) {\n                if (unarrived == 0)             // wait out advance\n                    root.internalawaitadvance(phase, null);//\n                else if (unsafe.compareandswaplong(this, stateoffset,\n                                                   s, s + adjust))//parties\n                    break;\n            }\n        }\n        else if (parent == null) {              // 1st root registration\n            long next = ((long)phase << phase_shift) | adjust;\n            if (unsafe.compareandswaplong(this, stateoffset, s, next))//phase\n                break;\n        }\n        else {\n            //phaser\n            synchronized (this) {               // 1st sub registration\n                if (state == s) {               // recheck under lock\n                    phase = parent.doregister(1);//\n                    if (phase < 0)\n                        break;\n                    // finish registration whenever parent registration\n                    // succeeded, even when racing with termination,\n                    // since these are part of the same "transaction".\n                    //phaser\n                    while (!unsafe.compareandswaplong\n                           (this, stateoffset, s,\n                            ((long)phase << phase_shift) | adjust)) {//phase\n                        s = state;\n                        phase = (int)(root.state >>> phase_shift);\n                        // assert (int)s == empty;\n                    }\n                    break;\n                }\n            }\n        }\n    }\n    return phase;\n}\n\n\n: registerphaserpartyonadvancephaserphaserparty\n\nregisterbulkregisterdoregister:\n\n * phaserparties\n * phaserrootphase\n * phaserphaserphase\n * phaserphaserootphaserreconcilestate()rootphase :\n\nprivate long reconcilestate() {\n    final phaser root = this.root;\n    long s = state;\n    if (root != this) {\n        int phase, p;\n        // cas to root phase with current parties, tripping unarrived\n        while ((phase = (int)(root.state >>> phase_shift)) !=\n               (int)(s >>> phase_shift) &&\n               !unsafe.compareandswaplong\n               (this, stateoffset, s,\n                s = (((long)phase << phase_shift) |\n                     ((phase < 0) ? (s & counts_mask) :\n                      (((p = (int)s >>> parties_shift) == 0) ? empty :\n                       ((s & parties_mask) | p))))))\n            s = state;\n    }\n    return s;\n}\n\n\nrootphaseadvancephaserparties advance(parties0empty)\n\nregister0phaseinternalawaitadvance():\n\n//phase\nprivate int internalawaitadvance(int phase, qnode node) {\n    // assert root == this;\n    releasewaiters(phase-1);          // ensure old queue clean\n    boolean queued = false;           // true when node is enqueued\n    int lastunarrived = 0;            // to increase spins upon change\n    int spins = spins_per_arrival;\n    long s;\n    int p;\n    while ((p = (int)((s = state) >>> phase_shift)) == phase) {\n        if (node == null) {           // spinning in noninterruptible mode\n            int unarrived = (int)s & unarrived_mask;//\n            if (unarrived != lastunarrived &&\n                (lastunarrived = unarrived) < ncpu)\n                spins += spins_per_arrival;\n            boolean interrupted = thread.interrupted();\n            if (interrupted || --spins < 0) { // need node to record intr\n                //node\n                node = new qnode(this, phase, false, false, 0l);\n                node.wasinterrupted = interrupted;\n            }\n        }\n        else if (node.isreleasable()) // done or aborted\n            break;\n        else if (!queued) {           // push onto queue\n            atomicreference<qnode> head = (phase & 1) == 0 ? evenq : oddq;\n            qnode q = node.next = head.get();\n            if ((q == null || q.phase == phase) &&\n                (int)(state >>> phase_shift) == phase) // avoid stale enq\n                queued = head.compareandset(q, node);\n        }\n        else {\n            try {\n                forkjoinpool.managedblock(node);//node\n            } catch (interruptedexception ie) {\n                node.wasinterrupted = true;\n            }\n        }\n    }\n\n    if (node != null) {\n        if (node.thread != null)\n            node.thread = null;       // avoid need for unpark()\n        if (node.wasinterrupted && !node.interruptible)\n            thread.currentthread().interrupt();\n        if (p == phase && (p = (int)(state >>> phase_shift)) == phase)\n            return abortwait(phase); // possibly clean up on abort\n    }\n    releasewaiters(phase);\n    return p;\n}\n\n\nnodedoregisterinternalawaitadvance:\n\n * releasewaiters\n * spins_per_arrivalnode\n * forkjoinpool.managedblock\n * \n * phase\n\n\n#  - arrive()\n\n//phaserarrival phase number\npublic int arrive() {\n    return doarrive(one_arrival);\n}\n\nprivate int doarrive(int adjust) {\n    final phaser root = this.root;\n    for (;;) {\n        long s = (root == this) ? state : reconcilestate();\n        int phase = (int)(s >>> phase_shift);\n        if (phase < 0)\n            return phase;\n        int counts = (int)s;\n        //\n        int unarrived = (counts == empty) ? 0 : (counts & unarrived_mask);\n        if (unarrived <= 0)\n            throw new illegalstateexception(badarrive(s));\n        if (unsafe.compareandswaplong(this, stateoffset, s, s-=adjust)) {//state\n            if (unarrived == 1) {//\n                long n = s & parties_mask;  // base of next state\n                int nextunarrived = (int)n >>> parties_shift;\n                if (root == this) {\n                    if (onadvance(phase, nextunarrived))//phaser\n                        n |= termination_bit;\n                    else if (nextunarrived == 0)\n                        n |= empty;\n                    else\n                        n |= nextunarrived;\n                    int nextphase = (phase + 1) & max_phase;\n                    n |= (long)nextphase << phase_shift;\n                    unsafe.compareandswaplong(this, stateoffset, s, n);\n                    releasewaiters(phase);//phase\n                }\n                //arrive\n                else if (nextunarrived == 0) { //propagate deregistration\n                    phase = parent.doarrive(one_deregister);\n                    unsafe.compareandswaplong(this, stateoffset,\n                                              s, s | empty);\n                }\n                else\n                    phase = parent.doarrive(one_arrival);\n            }\n            return phase;\n        }\n    }\n}\n\n\n: arrivephaserarrivearriveandderegisterdoarrive:\n\n * state(state - adjust)\n * phase\n * :\n   * rootphasercasphase\n   * partiesdoarrivestateempty\n\n\n#  - arriveandawaitadvance()\n\npublic int arriveandawaitadvance() {\n    // specialization of doarrive+awaitadvance eliminating some reads/paths\n    final phaser root = this.root;\n    for (;;) {\n        long s = (root == this) ? state : reconcilestate();\n        int phase = (int)(s >>> phase_shift);\n        if (phase < 0)\n            return phase;\n        int counts = (int)s;\n        int unarrived = (counts == empty) ? 0 : (counts & unarrived_mask);//\n        if (unarrived <= 0)\n            throw new illegalstateexception(badarrive(s));\n        if (unsafe.compareandswaplong(this, stateoffset, s,\n                                      s -= one_arrival)) {//state\n            if (unarrived > 1)\n                return root.internalawaitadvance(phase, null);//\n            if (root != this)\n                return parent.arriveandawaitadvance();//phaser\n            long n = s & parties_mask;  // base of next state\n            int nextunarrived = (int)n >>> parties_shift;\n            if (onadvance(phase, nextunarrived))//\n                n |= termination_bit;\n            else if (nextunarrived == 0)\n                n |= empty;\n            else\n                n |= nextunarrived;\n            int nextphase = (phase + 1) & max_phase;//phase\n            n |= (long)nextphase << phase_shift;\n            if (!unsafe.compareandswaplong(this, stateoffset, s, n))//state\n                return (int)(state >>> phase_shift); // terminated\n            releasewaiters(phase);//phase\n            return nextphase;\n        }\n    }\n}\n\n\n: phaserawaitadvance(arrive())awaitadvanceawaitadvance(arriveandderegister())cyclicbarrier.await:\n\n * state(state - 1)\n * 1internalawaitadvancephase\n * arriveandawaitadvance\n * <=1phasercasphasephasephase\n\n\n#  - awaitadvance(int phase)\n\npublic int awaitadvance(int phase) {\n    final phaser root = this.root;\n    long s = (root == this) ? state : reconcilestate();\n    int p = (int)(s >>> phase_shift);\n    if (phase < 0)\n        return phase;\n    if (p == phase)\n        return root.internalawaitadvance(phase, null);\n    return p;\n}\n//awaitadvance\npublic int awaitadvanceinterruptibly(int phase)\n    throws interruptedexception {\n    final phaser root = this.root;\n    long s = (root == this) ? state : reconcilestate();\n    int p = (int)(s >>> phase_shift);\n    if (phase < 0)\n        return phase;\n    if (p == phase) {\n        qnode node = new qnode(this, phase, true, false, 0l);\n        p = root.internalawaitadvance(phase, node);\n        if (node.wasinterrupted)\n            throw new interruptedexception();\n    }\n    return p;\n}\n\n\n: awaitadvancephasephase numberawaitadvanceinterruptiblyawaitadvance\n\n\n# \n\n * bagwellhttps://www.jianshu.com/p/e5794645ca8d\n *  https://www.pdai.tech/md/java/thread/java-thread-x-juc-tool-phaser.html',charsets:{cjk:!0}},{title:": final",frontmatter:{},regularPath:"/java/thread/java-thread-x-key-final.html",relativePath:"java/thread/java-thread-x-key-final.md",key:"v-32f9ea64",path:"/java/thread/java-thread-x-key-final.html",headers:[{level:2,title:": final",slug:"-final",normalizedTitle:": final",charIndex:2},{level:2,title:"BATfinal",slug:"batfinal",normalizedTitle:"batfinal",charIndex:113},{level:2,title:"final",slug:"final",normalizedTitle:"final",charIndex:139},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:156},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:167},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:226},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:238},{level:2,title:"final",slug:"final",normalizedTitle:"final",charIndex:323},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:342},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:405},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:480},{level:2,title:"final",slug:"final",normalizedTitle:"final",charIndex:499},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:517},{level:3,title:"final",slug:"final-",normalizedTitle:"final",charIndex:535},{level:3,title:" final ",slug:"-final-",normalizedTitle:" final ",charIndex:565},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:591},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:608}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:": final BATfinal final     final final final final final final final  final   ",content:'# : final\n\n> final \n\n * : final\n   * BATfinal\n   * final\n     * \n     * \n       * private final\n       * final\n     * \n     * \n       * final?\n       * static final\n       * blank final\n   * final\n     * final\n       * final\n       * final\n     * final\n       * final\n       * final\n     * final\n   * final\n     * final\n     * final\n     *  final \n     * \n   * \n\n\n# BATfinal\n\n\n\nfinal\n\n * final?\n * privatefinal?\n * final? StringfinalMyStringStringtoMyString()?\n * final? \n * final? \n * final?\n * final?\n *  final ?\n * \n\n\n# final\n\n\n# \n\nfinal\n\nfinalfinalfinalfinal\n\n> final? StringfinalMyStringStringtoMyString()?\n\n/(final),, \n\n/**\n* \n*/\nclass MyString{\n\n    private String innerString;\n\n    // ...init & other methods\n\n    // \n    public int length(){\n        return innerString.length(); // innerString\n    }\n\n    // \n    public String toMyString(){\n        //...\n    }\n}\n\n\n\n# \n\n> :\n\n * private final\n * final\n\n# private final\n\nprivatefinalprivateprivatefinal\n\npublic class Base {\n    private void test() {\n    }\n}\n\npublic class Son extends Base{\n    public void test() {\n    }\n    public static void main(String[] args) {\n        Son son = new Son();\n        Base father = son;\n        //father.test();\n    }\n}\n\n\nBaseSontest(),privatefinalSontest()SonSonfatherfather.test()Basetestprivate\n\n# final\n\nfinalfinal? \n\npublic class FinalExampleParent {\n    public final void test() {\n    }\n\n    public final void test(String str) {\n    }\n}\n\n\n\n# \n\nJavafinal\n\n\n# \n\n> \n\n# final?\n\n, \n\npublic class Test {\n    //\n    final int i = 1;\n    final static int J = 1;\n    final int[] a = {1,2,3,4};\n    //\n    Random r = new Random();\n    final int k = r.nextInt();\n\n    public static void main(String[] args) {\n\n    }\n}\n\n\nkfinalk\n\n# static final\n\nstaticfinal \n\nimport java.util.Random;\npublic class Test {\n    static Random r = new Random();\n    final int k = r.nextInt(10);\n    static final int k2 = r.nextInt(10); \n    public static void main(String[] args) {\n        Test t1 = new Test();\n        System.out.println("k="+t1.k+" k2="+t1.k2);\n        Test t2 = new Test();\n        System.out.println("k="+t2.k+" k2="+t2.k2);\n    }\n}\n\n\n\n\nkk2? staticstatic final\n\n# blank final\n\nJavafinalfinal,\n\n * (final)\n * \n\nfinal\n\n:\n\npublic class Test {\n    final int i1 = 1;\n    final int i2;//final\n    public Test() {\n        i2 = 1;\n    }\n    public Test(int x) {\n        this.i2 = x;\n    }\n}\n\n\ni2staticfinal\n\n\n# final\n\nfinalJavafinal? final? javajavajava,final? ? final\n\n\n# final\n\n\n\npublic class FinalDemo {\n    private int a;  //\n    private final int b; //final\n    private static FinalDemo finalDemo;\n\n    public FinalDemo() {\n        a = 1; // 1. \n        b = 2; // 2. final\n    }\n\n    public static void writer() {\n        finalDemo = new FinalDemo();\n    }\n\n    public static void reader() {\n        FinalDemo demo = finalDemo; // 3.\n        int a = demo.a;    //4.\n        int b = demo.b;    //5.final\n    }\n}\n\n\nAwriter()Breader()\n\n# final\n\nfinalfinal\n\n * JMMfinal\n * finalreturnstorestorefinal\n\nwriter\n\n * FinalDemo\n * finalDemo\n\n\n\n\n\na,b()aBa()finalbfinalbbBfinal\n\nfinalfinalBfinalDemo\n\n# final\n\nfinalfinalJMM()finalLoadLoadfinal\n\nread()\n\n * finalDemo;\n * finalDemoa;\n * finalDemofinalb;\n\nAAB\n\n\n\nBfinalfinal\n\nfinalfinalfinal\n\n\n# final\n\nfinal? ? \n\n# final\n\nfinalfinalfinal\n\npublic class FinalReferenceDemo {\n    final int[] arrays;\n    private FinalReferenceDemo finalReferenceDemo;\n\n    public FinalReferenceDemo() {\n        arrays = new int[1];  //1\n        arrays[0] = 1;        //2\n    }\n\n    public void writerOne() {\n        finalReferenceDemo = new FinalReferenceDemo(); //3\n    }\n\n    public void writerTwo() {\n        arrays[0] = 2;  //4\n    }\n\n    public void reader() {\n        if (finalReferenceDemo != null) {  //5\n            int temp = finalReferenceDemo.arrays[0];  //6\n        }\n    }\n}\n\n\nAwirterOneBwriterTwoCreader()\n\n\n\nfinal13final23\n\n# final\n\nJMMCAfinalarrays[0] = 1BJMMBCBCvolatile\n\n\n# final\n\nfinal\n\n * :\n   \n   * finalfinalfinalfinal\n   * finalfinal\n\n * \n   \n   * final \n\n\n# final\n\n\n# final\n\nfinalfinalStoreStorefinalfinalLoadLoad\n\nX86X86-StoreStoreX86finalLoadLoadX86final/\n\n\n# final\n\nfinalfinal\n\npublic class FinalReferenceEscapeDemo {\n    private final int a;\n    private FinalReferenceEscapeDemo referenceDemo;\n\n    public FinalReferenceEscapeDemo() {\n        a = 1;  //1\n        referenceDemo = this; //2\n    }\n\n    public void writer() {\n        new FinalReferenceEscapeDemo();\n    }\n\n    public void reader() {\n        if (referenceDemo != null) {  //3\n            int temp = referenceDemo.a; //4\n        }\n    }\n}\n\n\n\n\n\n\nAwriterreader12122referenceDemoBfinalfinalthis\n\n\n#  final \n\n final \n\npublic class MyClass {\n  private final int myField = 1;\n  public MyClass() {\n    ...\n  }\n}\n\n\n\n\npublic class MyClass {\n  private final int myField;\n  public MyClass() {\n    ...\n    myField = 1;\n    ...\n  }\n}\n\n\n final \n\n list\n\nprivate final List myList = new ArrayList();\nmyList.add("Hello");\n\n\n final \n\nmyList = new ArrayList();\nmyList = someOtherList;\n\n\n final\n\n"  "  volatile synchronized  Lock \n\n\n# \n\nbyte b1=1;\nbyte b2=3;\nbyte b3=b1+b2;//b1b2intjavaintbyte-----\n\n\nb1 b2final\n\nfinal byte b1=1;\nfinal byte b2=3;\nbyte b3=b1+b2;//\n\n\n\n# \n\n * https://www.jianshu.com/p/1e82c75034b7\n * java\n * java\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-final.html',normalizedContent:'# : final\n\n> final \n\n * : final\n   * batfinal\n   * final\n     * \n     * \n       * private final\n       * final\n     * \n     * \n       * final?\n       * static final\n       * blank final\n   * final\n     * final\n       * final\n       * final\n     * final\n       * final\n       * final\n     * final\n   * final\n     * final\n     * final\n     *  final \n     * \n   * \n\n\n# batfinal\n\n\n\nfinal\n\n * final?\n * privatefinal?\n * final? stringfinalmystringstringtomystring()?\n * final? \n * final? \n * final?\n * final?\n *  final ?\n * \n\n\n# final\n\n\n# \n\nfinal\n\nfinalfinalfinalfinal\n\n> final? stringfinalmystringstringtomystring()?\n\n/(final),, \n\n/**\n* \n*/\nclass mystring{\n\n    private string innerstring;\n\n    // ...init & other methods\n\n    // \n    public int length(){\n        return innerstring.length(); // innerstring\n    }\n\n    // \n    public string tomystring(){\n        //...\n    }\n}\n\n\n\n# \n\n> :\n\n * private final\n * final\n\n# private final\n\nprivatefinalprivateprivatefinal\n\npublic class base {\n    private void test() {\n    }\n}\n\npublic class son extends base{\n    public void test() {\n    }\n    public static void main(string[] args) {\n        son son = new son();\n        base father = son;\n        //father.test();\n    }\n}\n\n\nbasesontest(),privatefinalsontest()sonsonfatherfather.test()basetestprivate\n\n# final\n\nfinalfinal? \n\npublic class finalexampleparent {\n    public final void test() {\n    }\n\n    public final void test(string str) {\n    }\n}\n\n\n\n# \n\njavafinal\n\n\n# \n\n> \n\n# final?\n\n, \n\npublic class test {\n    //\n    final int i = 1;\n    final static int j = 1;\n    final int[] a = {1,2,3,4};\n    //\n    random r = new random();\n    final int k = r.nextint();\n\n    public static void main(string[] args) {\n\n    }\n}\n\n\nkfinalk\n\n# static final\n\nstaticfinal \n\nimport java.util.random;\npublic class test {\n    static random r = new random();\n    final int k = r.nextint(10);\n    static final int k2 = r.nextint(10); \n    public static void main(string[] args) {\n        test t1 = new test();\n        system.out.println("k="+t1.k+" k2="+t1.k2);\n        test t2 = new test();\n        system.out.println("k="+t2.k+" k2="+t2.k2);\n    }\n}\n\n\n\n\nkk2? staticstatic final\n\n# blank final\n\njavafinalfinal,\n\n * (final)\n * \n\nfinal\n\n:\n\npublic class test {\n    final int i1 = 1;\n    final int i2;//final\n    public test() {\n        i2 = 1;\n    }\n    public test(int x) {\n        this.i2 = x;\n    }\n}\n\n\ni2staticfinal\n\n\n# final\n\nfinaljavafinal? final? javajavajava,final? ? final\n\n\n# final\n\n\n\npublic class finaldemo {\n    private int a;  //\n    private final int b; //final\n    private static finaldemo finaldemo;\n\n    public finaldemo() {\n        a = 1; // 1. \n        b = 2; // 2. final\n    }\n\n    public static void writer() {\n        finaldemo = new finaldemo();\n    }\n\n    public static void reader() {\n        finaldemo demo = finaldemo; // 3.\n        int a = demo.a;    //4.\n        int b = demo.b;    //5.final\n    }\n}\n\n\nawriter()breader()\n\n# final\n\nfinalfinal\n\n * jmmfinal\n * finalreturnstorestorefinal\n\nwriter\n\n * finaldemo\n * finaldemo\n\n\n\n\n\na,b()aba()finalbfinalbbbfinal\n\nfinalfinalbfinaldemo\n\n# final\n\nfinalfinaljmm()finalloadloadfinal\n\nread()\n\n * finaldemo;\n * finaldemoa;\n * finaldemofinalb;\n\naab\n\n\n\nbfinalfinal\n\nfinalfinalfinal\n\n\n# final\n\nfinal? ? \n\n# final\n\nfinalfinalfinal\n\npublic class finalreferencedemo {\n    final int[] arrays;\n    private finalreferencedemo finalreferencedemo;\n\n    public finalreferencedemo() {\n        arrays = new int[1];  //1\n        arrays[0] = 1;        //2\n    }\n\n    public void writerone() {\n        finalreferencedemo = new finalreferencedemo(); //3\n    }\n\n    public void writertwo() {\n        arrays[0] = 2;  //4\n    }\n\n    public void reader() {\n        if (finalreferencedemo != null) {  //5\n            int temp = finalreferencedemo.arrays[0];  //6\n        }\n    }\n}\n\n\nawirteronebwritertwocreader()\n\n\n\nfinal13final23\n\n# final\n\njmmcafinalarrays[0] = 1bjmmbcbcvolatile\n\n\n# final\n\nfinal\n\n * :\n   \n   * finalfinalfinalfinal\n   * finalfinal\n\n * \n   \n   * final \n\n\n# final\n\n\n# final\n\nfinalfinalstorestorefinalfinalloadload\n\nx86x86-storestorex86finalloadloadx86final/\n\n\n# final\n\nfinalfinal\n\npublic class finalreferenceescapedemo {\n    private final int a;\n    private finalreferenceescapedemo referencedemo;\n\n    public finalreferenceescapedemo() {\n        a = 1;  //1\n        referencedemo = this; //2\n    }\n\n    public void writer() {\n        new finalreferenceescapedemo();\n    }\n\n    public void reader() {\n        if (referencedemo != null) {  //3\n            int temp = referencedemo.a; //4\n        }\n    }\n}\n\n\n\n\n\n\nawriterreader12122referencedemobfinalfinalthis\n\n\n#  final \n\n final \n\npublic class myclass {\n  private final int myfield = 1;\n  public myclass() {\n    ...\n  }\n}\n\n\n\n\npublic class myclass {\n  private final int myfield;\n  public myclass() {\n    ...\n    myfield = 1;\n    ...\n  }\n}\n\n\n final \n\n list\n\nprivate final list mylist = new arraylist();\nmylist.add("hello");\n\n\n final \n\nmylist = new arraylist();\nmylist = someotherlist;\n\n\n final\n\n"  "  volatile synchronized  lock \n\n\n# \n\nbyte b1=1;\nbyte b2=3;\nbyte b3=b1+b2;//b1b2intjavaintbyte-----\n\n\nb1 b2final\n\nfinal byte b1=1;\nfinal byte b2=3;\nbyte b3=b1+b2;//\n\n\n\n# \n\n * https://www.jianshu.com/p/1e82c75034b7\n * java\n * java\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-final.html',charsets:{cjk:!0}},{title:": volatile",frontmatter:{},regularPath:"/java/thread/java-thread-x-key-volatile.html",relativePath:"java/thread/java-thread-x-key-volatile.md",key:"v-a5b25408",path:"/java/thread/java-thread-x-key-volatile.html",headers:[{level:2,title:": volatile",slug:"-volatile",normalizedTitle:": volatile",charIndex:2},{level:2,title:"BATvolatile",slug:"batvolatile",normalizedTitle:"batvolatile",charIndex:106},{level:2,title:"volatile",slug:"volatile",normalizedTitle:"volatile",charIndex:135},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:156},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:168},{level:3,title:":/",slug:"--",normalizedTitle:":/",charIndex:181},{level:2,title:"volatile ",slug:"volatile-",normalizedTitle:"volatile ",charIndex:273},{level:3,title:"volatile ",slug:"volatile-",normalizedTitle:"volatile ",charIndex:295},{level:3,title:"volatile ",slug:"volatile-",normalizedTitle:"volatile ",charIndex:349},{level:2,title:"volatile ",slug:"volatile-",normalizedTitle:"volatile ",charIndex:431},{level:3,title:"1",slug:"1-",normalizedTitle:"1",charIndex:453},{level:3,title:"2(one-time safe publication)",slug:"2--one-time-safe-publication",normalizedTitle:"2(one-time safe publication)",charIndex:469},{level:3,title:"3(independent observation)",slug:"3--independent-observation",normalizedTitle:"3(independent observation)",charIndex:515},{level:3,title:"4volatile bean ",slug:"4-volatile-bean-",normalizedTitle:"4volatile bean ",charIndex:556},{level:3,title:"5",slug:"5--",normalizedTitle:"5",charIndex:584},{level:3,title:"6(double-checked)",slug:"6--double-checked",normalizedTitle:"6(double-checked)",charIndex:607},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:637}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:": volatile BATvolatile volatile   :/ volatile  volatile  volatile  volatile  1 2(one-time safe publication) 3(independent observation) 4volatile bean  5 6(double-checked) ",content:'# : volatile\n\n> Sychronized()volatile\n\n * : volatile\n   * BATvolatile\n   * volatile\n     * \n     * \n     * :/\n       * 1 i++?\n       * 2 longdoublevolatile?\n   * volatile \n     * volatile \n       * lock \n       * \n     * volatile \n       * volatile  happens-before \n       * volatile \n   * volatile \n     * 1\n     * 2(one-time safe publication)\n     * 3(independent observation)\n     * 4volatile bean \n     * 5\n     * 6(double-checked)\n   * \n\n\n# BATvolatile\n\n\n\nvolatile\n\n * volatile?\n * volatile?\n * 32longdoublevolatile? 64?\n * i++?\n * volatile? \n * volatile? happens-before\n * volatile?\n\n\n# volatile\n\n\n# \n\n(DCL)\n\npublic class Singleton {\n    public static volatile Singleton singleton;\n    /**\n     * \n     */\n    private Singleton() {};\n    public static Singleton getInstance() {\n        if (singleton == null) {\n            synchronized (singleton.class) {\n                if (singleton == null) {\n                    singleton = new Singleton();\n                }\n            }\n        }\n        return singleton;\n    }\n}\n\n\nsingletonvolatile\n\n * \n * \n * \n\n\n\n * \n * \n * \n\nvolatile\n\n\n# \n\nvolatile\n\npublic class TestVolatile {\n    private static boolean stop = false;\n\n    public static void main(String[] args) {\n        // Thread-A\n        new Thread("Thread A") {\n            @Override\n            public void run() {\n                while (!stop) {\n                }\n                System.out.println(Thread.currentThread() + " stopped");\n            }\n        }.start();\n\n        // Thread-main\n        try {\n            TimeUnit.SECONDS.sleep(1);\n            System.out.println(Thread.currentThread() + " after 1 seconds");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        stop = true;\n    }\n}\n\n\n\n\nThread[main,5,main] after 1 seconds\n\n// Thread Aloop, Thread A Thread Main stop\n\n\n Thread-main 1 stop = tureThread Astopvolatilestop:\n\nThread[main,5,main] after 1 seconds\nThread[Thread A,5,main] stopped\n\nProcess finished with exit code 0\n\n\n\n# :/\n\nvolatile/\n\n# 1 i++?\n\nvolatile/longdoublei++i++\n\n\n\npublic class VolatileTest01 {\n    volatile int i;\n\n    public void addI(){\n        i++;\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        final  VolatileTest01 test01 = new VolatileTest01();\n        for (int n = 0; n < 1000; n++) {\n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        Thread.sleep(10);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    test01.addI();\n                }\n            }).start();\n        }\n        Thread.sleep(10000);//10\n        System.out.println(test01.i);\n    }\n}\n\n\nivolatile981 volatile(1000)i++\n\n * i\n * i1\n * i volatileAtomicIntegerSynchronized+1 Thread.sleep()\n\n# 2 longdoublevolatile?\n\nlongdouble3232longdouble/longdoublevolatilelongdouble/\n\nJLS\n\n> 17.7 Non-Atomic Treatment of double and long\n\n * For the purposes of the Java programming language memory model, a single write to a non-volatile long or double value is treated as two separate writes: one to each 32-bit half. This can result in a situation where a thread sees the first 32 bits of a 64-bit value from one write, and the second 32 bits from another write.\n * Writes and reads of volatile long and double values are always atomic.\n * Writes to and reads of references are always atomic, regardless of whether they are implemented as 32-bit or 64-bit values.\n * Some implementations may find it convenient to divide a single write action on a 64-bit long or double value into two write actions on adjacent 32-bit values. For efficiencys sake, this behavior is implementation-specific; an implementation of the Java Virtual Machine is free to perform writes to long and double values atomically or in two parts.\n * Implementations of the Java Virtual Machine are encouraged to avoid splitting 64-bit values where possible. Programmers are encouraged to declare shared 64-bit values as volatile or synchronize their programs correctly to avoid possible complications.\n\n 64 long  double  volatile\n\n\n# volatile \n\n\n# volatile \n\n> volatile (Memory Barrier):\n\n *  CPU \n * JMM  CPU +  CPU Memory Barrier \n\n Java  volatile \n\npublic class Test {\n    private volatile int a;\n    public void update() {\n        a = 1;\n    }\n    public static void main(String[] args) {\n        Test test = new Test();\n        test.update();\n    }\n}\n\n\n hsdis  jitwatch :\n\n......\n  0x0000000002951563: and    $0xffffffffffffff87,%rdi\n  0x0000000002951567: je     0x00000000029515f8\n  0x000000000295156d: test   $0x7,%rdi\n  0x0000000002951574: jne    0x00000000029515bd\n  0x0000000002951576: test   $0x300,%rdi\n  0x000000000295157d: jne    0x000000000295159c\n  0x000000000295157f: and    $0x37f,%rax\n  0x0000000002951586: mov    %rax,%rdi\n  0x0000000002951589: or     %r15,%rdi\n  0x000000000295158c: lock cmpxchg %rdi,(%rdx)  // volatile  lock \n  0x0000000002951591: jne    0x0000000002951a15\n  0x0000000002951597: jmpq   0x00000000029515f8\n  0x000000000295159c: mov    0x8(%rdx),%edi\n  0x000000000295159f: shl    $0x3,%rdi\n  0x00000000029515a3: mov    0xa8(%rdi),%rdi\n  0x00000000029515aa: or     %r15,%rdi\n......\n\n\nlock :\n\n * \n *  CPU \n\n(L1L2 )\n\n volatile JVM  lock \n\n(MESI)\n\n\n\nvolatile \n\n# lock \n\n Pentium  IA-32 lock  LOCK#  CPU    CPU  (MESI)\n\n# \n\n(line) CPU  32 64 128  CPU  64  LOCK#     " (snooping)"   ( CPU ) CPU   \n\n\n# volatile \n\n# volatile  happens-before \n\nhappens-before  volatile  volatile happens-before  volatile \n\n//AwriterBreader\nclass VolatileExample {\n    int a = 0;\n    volatile boolean flag = false;\n    \n    public void writer() {\n        a = 1;              // 1 A\n        flag = true;        // 2 Avolatile\n    } \n    \n    public void reader() {\n        if (flag) {         // 3 Bvolatile\n        int i = a;          // 4 B\n        \n        }\n    }\n}\n\n\n happens-before  3  happens-before \n\n * 1 happens-before 2  3 happens-before 4\n *  volatile 2 happens-before 3\n *  happens-before 1 happens-before 4\n\n\n\n A  volatile  flag  true  B \n\n# volatile \n\nJMM JMM \n\nJava \n\nJMM  volatile \n\n\n\n" NO " \n\n volatile \n\nJMM \n\n *  volatile  StoreStore \n *  volatile  StoreLoad \n *  volatile  LoadLoad \n *  volatile  LoadStore \n\nvolatile  volatile \n\n            \nStoreStore     volatile \nStoreLoad      volatile  volatile /\nLoadLoad       volatile \nLoadStore      volatile \n\n\n\n\n\n\n# volatile \n\n volatile \n\n * \n * \n *  volatile\n\n\n# 1\n\n volatile \n\nvolatile boolean shutdownRequested;\n......\npublic void shutdown() { shutdownRequested = true; }\npublic void doWork() { \n    while (!shutdownRequested) { \n        // do stuff\n    }\n}\n\n\n\n# 2(one-time safe publication)\n\n()((double-checked-locking))\n\npublic class BackgroundFloobleLoader {\n    public volatile Flooble theFlooble;\n \n    public void initInBackground() {\n        // do lots of stuff\n        theFlooble = new Flooble();  // this is the only write to theFlooble\n    }\n}\n \npublic class SomeOtherClass {\n    public void doWork() {\n        while (true) { \n            // do some stuff...\n            // use the Flooble, but only if it is ready\n            if (floobleLoader.theFlooble != null) \n                doSomething(floobleLoader.theFlooble);\n        }\n    }\n}\n\n\n\n# 3(independent observation)\n\n volatile    volatile \n\npublic class UserManager {\n    public volatile String lastUser;\n \n    public boolean authenticate(String user, String password) {\n        boolean valid = passwordIsValid(user, password);\n        if (valid) {\n            User u = new User();\n            activeUsers.add(u);\n            lastUser = user;\n        }\n        return valid;\n    }\n}\n\n\n\n# 4volatile bean \n\n volatile bean JavaBean  volatile  getter  setter   ( volatile  volatile ) volatile  JavaBean \n\n@ThreadSafe\npublic class Person {\n    private volatile String firstName;\n    private volatile String lastName;\n    private volatile int age;\n \n    public String getFirstName() { return firstName; }\n    public String getLastName() { return lastName; }\n    public int getAge() { return age; }\n \n    public void setFirstName(String firstName) { \n        this.firstName = firstName;\n    }\n \n    public void setLastName(String lastName) { \n        this.lastName = lastName;\n    }\n \n    public void setAge(int age) { \n        this.age = age;\n    }\n}\n\n\n\n# 5\n\nvolatile  ++x () volatile   volatile   synchronized  volatile  volatile \n\n@ThreadSafe\npublic class CheesyCounter {\n    // Employs the cheap read-write lock trick\n    // All mutative operations MUST be done with the \'this\' lock held\n    @GuardedBy("this") private volatile int value;\n \n    public int getValue() { return value; }\n \n    public synchronized int increment() {\n        return value++;\n    }\n}\n\n\n\n# 6(double-checked)\n\n\n\n volatile  100% bug \n\nclass Singleton {\n    private volatile static Singleton instance;\n    private Singleton() {\n    }\n    public static Singleton getInstance() {\n        if (instance == null) {\n            syschronized(Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    } \n}\n\n\n\n# \n\n * https://blog.csdn.net/devotion987/article/details/68486942\n * https://www.jianshu.com/p/ccfe24b63d87\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-volatile.html',normalizedContent:'# : volatile\n\n> sychronized()volatile\n\n * : volatile\n   * batvolatile\n   * volatile\n     * \n     * \n     * :/\n       * 1 i++?\n       * 2 longdoublevolatile?\n   * volatile \n     * volatile \n       * lock \n       * \n     * volatile \n       * volatile  happens-before \n       * volatile \n   * volatile \n     * 1\n     * 2(one-time safe publication)\n     * 3(independent observation)\n     * 4volatile bean \n     * 5\n     * 6(double-checked)\n   * \n\n\n# batvolatile\n\n\n\nvolatile\n\n * volatile?\n * volatile?\n * 32longdoublevolatile? 64?\n * i++?\n * volatile? \n * volatile? happens-before\n * volatile?\n\n\n# volatile\n\n\n# \n\n(dcl)\n\npublic class singleton {\n    public static volatile singleton singleton;\n    /**\n     * \n     */\n    private singleton() {};\n    public static singleton getinstance() {\n        if (singleton == null) {\n            synchronized (singleton.class) {\n                if (singleton == null) {\n                    singleton = new singleton();\n                }\n            }\n        }\n        return singleton;\n    }\n}\n\n\nsingletonvolatile\n\n * \n * \n * \n\n\n\n * \n * \n * \n\nvolatile\n\n\n# \n\nvolatile\n\npublic class testvolatile {\n    private static boolean stop = false;\n\n    public static void main(string[] args) {\n        // thread-a\n        new thread("thread a") {\n            @override\n            public void run() {\n                while (!stop) {\n                }\n                system.out.println(thread.currentthread() + " stopped");\n            }\n        }.start();\n\n        // thread-main\n        try {\n            timeunit.seconds.sleep(1);\n            system.out.println(thread.currentthread() + " after 1 seconds");\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        stop = true;\n    }\n}\n\n\n\n\nthread[main,5,main] after 1 seconds\n\n// thread aloop, thread a thread main stop\n\n\n thread-main 1 stop = turethread astopvolatilestop:\n\nthread[main,5,main] after 1 seconds\nthread[thread a,5,main] stopped\n\nprocess finished with exit code 0\n\n\n\n# :/\n\nvolatile/\n\n# 1 i++?\n\nvolatile/longdoublei++i++\n\n\n\npublic class volatiletest01 {\n    volatile int i;\n\n    public void addi(){\n        i++;\n    }\n\n    public static void main(string[] args) throws interruptedexception {\n        final  volatiletest01 test01 = new volatiletest01();\n        for (int n = 0; n < 1000; n++) {\n            new thread(new runnable() {\n                @override\n                public void run() {\n                    try {\n                        thread.sleep(10);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                    test01.addi();\n                }\n            }).start();\n        }\n        thread.sleep(10000);//10\n        system.out.println(test01.i);\n    }\n}\n\n\nivolatile981 volatile(1000)i++\n\n * i\n * i1\n * i volatileatomicintegersynchronized+1 thread.sleep()\n\n# 2 longdoublevolatile?\n\nlongdouble3232longdouble/longdoublevolatilelongdouble/\n\njls\n\n> 17.7 non-atomic treatment of double and long\n\n * for the purposes of the java programming language memory model, a single write to a non-volatile long or double value is treated as two separate writes: one to each 32-bit half. this can result in a situation where a thread sees the first 32 bits of a 64-bit value from one write, and the second 32 bits from another write.\n * writes and reads of volatile long and double values are always atomic.\n * writes to and reads of references are always atomic, regardless of whether they are implemented as 32-bit or 64-bit values.\n * some implementations may find it convenient to divide a single write action on a 64-bit long or double value into two write actions on adjacent 32-bit values. for efficiencys sake, this behavior is implementation-specific; an implementation of the java virtual machine is free to perform writes to long and double values atomically or in two parts.\n * implementations of the java virtual machine are encouraged to avoid splitting 64-bit values where possible. programmers are encouraged to declare shared 64-bit values as volatile or synchronize their programs correctly to avoid possible complications.\n\n 64 long  double  volatile\n\n\n# volatile \n\n\n# volatile \n\n> volatile (memory barrier):\n\n *  cpu \n * jmm  cpu +  cpu memory barrier \n\n java  volatile \n\npublic class test {\n    private volatile int a;\n    public void update() {\n        a = 1;\n    }\n    public static void main(string[] args) {\n        test test = new test();\n        test.update();\n    }\n}\n\n\n hsdis  jitwatch :\n\n......\n  0x0000000002951563: and    $0xffffffffffffff87,%rdi\n  0x0000000002951567: je     0x00000000029515f8\n  0x000000000295156d: test   $0x7,%rdi\n  0x0000000002951574: jne    0x00000000029515bd\n  0x0000000002951576: test   $0x300,%rdi\n  0x000000000295157d: jne    0x000000000295159c\n  0x000000000295157f: and    $0x37f,%rax\n  0x0000000002951586: mov    %rax,%rdi\n  0x0000000002951589: or     %r15,%rdi\n  0x000000000295158c: lock cmpxchg %rdi,(%rdx)  // volatile  lock \n  0x0000000002951591: jne    0x0000000002951a15\n  0x0000000002951597: jmpq   0x00000000029515f8\n  0x000000000295159c: mov    0x8(%rdx),%edi\n  0x000000000295159f: shl    $0x3,%rdi\n  0x00000000029515a3: mov    0xa8(%rdi),%rdi\n  0x00000000029515aa: or     %r15,%rdi\n......\n\n\nlock :\n\n * \n *  cpu \n\n(l1l2 )\n\n volatile jvm  lock \n\n(mesi)\n\n\n\nvolatile \n\n# lock \n\n pentium  ia-32 lock  lock#  cpu    cpu  (mesi)\n\n# \n\n(line) cpu  32 64 128  cpu  64  lock#     " (snooping)"   ( cpu ) cpu   \n\n\n# volatile \n\n# volatile  happens-before \n\nhappens-before  volatile  volatile happens-before  volatile \n\n//awriterbreader\nclass volatileexample {\n    int a = 0;\n    volatile boolean flag = false;\n    \n    public void writer() {\n        a = 1;              // 1 a\n        flag = true;        // 2 avolatile\n    } \n    \n    public void reader() {\n        if (flag) {         // 3 bvolatile\n        int i = a;          // 4 b\n        \n        }\n    }\n}\n\n\n happens-before  3  happens-before \n\n * 1 happens-before 2  3 happens-before 4\n *  volatile 2 happens-before 3\n *  happens-before 1 happens-before 4\n\n\n\n a  volatile  flag  true  b \n\n# volatile \n\njmm jmm \n\njava \n\njmm  volatile \n\n\n\n" no " \n\n volatile \n\njmm \n\n *  volatile  storestore \n *  volatile  storeload \n *  volatile  loadload \n *  volatile  loadstore \n\nvolatile  volatile \n\n            \nstorestore     volatile \nstoreload      volatile  volatile /\nloadload       volatile \nloadstore      volatile \n\n\n\n\n\n\n# volatile \n\n volatile \n\n * \n * \n *  volatile\n\n\n# 1\n\n volatile \n\nvolatile boolean shutdownrequested;\n......\npublic void shutdown() { shutdownrequested = true; }\npublic void dowork() { \n    while (!shutdownrequested) { \n        // do stuff\n    }\n}\n\n\n\n# 2(one-time safe publication)\n\n()((double-checked-locking))\n\npublic class backgroundfloobleloader {\n    public volatile flooble theflooble;\n \n    public void initinbackground() {\n        // do lots of stuff\n        theflooble = new flooble();  // this is the only write to theflooble\n    }\n}\n \npublic class someotherclass {\n    public void dowork() {\n        while (true) { \n            // do some stuff...\n            // use the flooble, but only if it is ready\n            if (floobleloader.theflooble != null) \n                dosomething(floobleloader.theflooble);\n        }\n    }\n}\n\n\n\n# 3(independent observation)\n\n volatile    volatile \n\npublic class usermanager {\n    public volatile string lastuser;\n \n    public boolean authenticate(string user, string password) {\n        boolean valid = passwordisvalid(user, password);\n        if (valid) {\n            user u = new user();\n            activeusers.add(u);\n            lastuser = user;\n        }\n        return valid;\n    }\n}\n\n\n\n# 4volatile bean \n\n volatile bean javabean  volatile  getter  setter   ( volatile  volatile ) volatile  javabean \n\n@threadsafe\npublic class person {\n    private volatile string firstname;\n    private volatile string lastname;\n    private volatile int age;\n \n    public string getfirstname() { return firstname; }\n    public string getlastname() { return lastname; }\n    public int getage() { return age; }\n \n    public void setfirstname(string firstname) { \n        this.firstname = firstname;\n    }\n \n    public void setlastname(string lastname) { \n        this.lastname = lastname;\n    }\n \n    public void setage(int age) { \n        this.age = age;\n    }\n}\n\n\n\n# 5\n\nvolatile  ++x () volatile   volatile   synchronized  volatile  volatile \n\n@threadsafe\npublic class cheesycounter {\n    // employs the cheap read-write lock trick\n    // all mutative operations must be done with the \'this\' lock held\n    @guardedby("this") private volatile int value;\n \n    public int getvalue() { return value; }\n \n    public synchronized int increment() {\n        return value++;\n    }\n}\n\n\n\n# 6(double-checked)\n\n\n\n volatile  100% bug \n\nclass singleton {\n    private volatile static singleton instance;\n    private singleton() {\n    }\n    public static singleton getinstance() {\n        if (instance == null) {\n            syschronized(singleton.class) {\n                if (instance == null) {\n                    instance = new singleton();\n                }\n            }\n        }\n        return instance;\n    } \n}\n\n\n\n# \n\n * https://blog.csdn.net/devotion987/article/details/68486942\n * https://www.jianshu.com/p/ccfe24b63d87\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-volatile.html',charsets:{cjk:!0}},{title:"JUC: LockSupport",frontmatter:{},regularPath:"/java/thread/java-thread-x-lock-LockSupport.html",relativePath:"java/thread/java-thread-x-lock-LockSupport.md",key:"v-21f7fb68",path:"/java/thread/java-thread-x-lock-LockSupport.html",headers:[{level:2,title:"JUC: LockSupport",slug:"juc-locksupport",normalizedTitle:"juc: locksupport",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:96},{level:2,title:"LockSupport",slug:"locksupport",normalizedTitle:"locksupport",charIndex:117},{level:2,title:"LockSupport",slug:"locksupport",normalizedTitle:"locksupport",charIndex:136},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:159},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:171},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:185},{level:2,title:"LockSupport",slug:"locksupport",normalizedTitle:"locksupport",charIndex:273},{level:3,title:"wait/notify",slug:"wait-notify",normalizedTitle:"wait/notify",charIndex:296},{level:3,title:"park/unpark",slug:"park-unpark",normalizedTitle:"park/unpark",charIndex:323},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:350},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:360},{level:3,title:"Thread.sleep()Object.wait()",slug:"thread-sleep-object-wait-",normalizedTitle:"thread.sleep()object.wait()",charIndex:374},{level:3,title:"Object.wait()Condition.await()",slug:"object-wait-condition-await-",normalizedTitle:"object.wait()condition.await()",charIndex:413},{level:3,title:"Thread.sleep()LockSupport.park()",slug:"thread-sleep-locksupport-park-",normalizedTitle:"thread.sleep()locksupport.park()",charIndex:455},{level:3,title:"Object.wait()LockSupport.park()",slug:"object-wait-locksupport-park-",normalizedTitle:"object.wait()locksupport.park()",charIndex:499},{level:3,title:"LockSupport.park()?",slug:"locksupport-park-",normalizedTitle:"locksupport.park()?",charIndex:614},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:646}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: LockSupport BAT LockSupport LockSupport    LockSupport wait/notify park/unpark   Thread.sleep()Object.wait() Object.wait()Condition.await() Thread.sleep()LockSupport.park() Object.wait()LockSupport.park() LockSupport.park()? ",content:'# JUC: LockSupport\n\n> LockSupport\n\n * JUC: LockSupport\n   * BAT\n   * LockSupport\n   * LockSupport\n     * \n     * \n     * \n       * park\n       * parkNanos\n       * parkUntil\n       * unpark\n   * LockSupport\n     * wait/notify\n     * park/unpark\n     * \n   * \n     * Thread.sleep()Object.wait()\n     * Object.wait()Condition.await()\n     * Thread.sleep()LockSupport.park()\n     * Object.wait()LockSupport.park()\n       * wait()notify()?\n       * park()unpark()?\n     * LockSupport.park()?\n   * \n\n\n# BAT\n\n\n\n\n\n * LockSupport? AQSUnsafe(CAS)LockSupport(park/unpark)\n * wait/notifyLockSupportpark/unpark?\n * LockSupport.park()? Condition.await()?\n * Thread.sleep()Object.wait()Condition.await()LockSupport.park()? \n * wait()notify()?\n * park()unpark()?\n\n\n# LockSupport\n\nLockSupportLockSupport.parkLockSupport.unpark\n\n\n# LockSupport\n\n\n# \n\npublic class LockSupport {\n    // Hotspot implementation via intrinsics API\n    private static final sun.misc.Unsafe UNSAFE;\n    // \n    private static final long parkBlockerOffset;\n    // \n    private static final long SEED;\n    // \n    private static final long PROBE;\n    // \n    private static final long SECONDARY;\n    \n    static {\n        try {\n            // Unsafe\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            // \n            Class<?> tk = Thread.class;\n            // ThreadparkBlocker\n            parkBlockerOffset = UNSAFE.objectFieldOffset\n                (tk.getDeclaredField("parkBlocker"));\n            // ThreadthreadLocalRandomSeed\n            SEED = UNSAFE.objectFieldOffset\n                (tk.getDeclaredField("threadLocalRandomSeed"));\n            // ThreadthreadLocalRandomProbe\n            PROBE = UNSAFE.objectFieldOffset\n                (tk.getDeclaredField("threadLocalRandomProbe"));\n            // ThreadthreadLocalRandomSecondarySeed\n            SECONDARY = UNSAFE.objectFieldOffset\n                (tk.getDeclaredField("threadLocalRandomSecondarySeed"));\n        } catch (Exception ex) { throw new Error(ex); }\n    }\n}\n\n\n: UNSAFEsun.misc.Unsafelong\n\n\n# \n\n// \nprivate LockSupport() {}\n\n\n: LockSupport\n\n\n# \n\nLockSupportsun.misc.UnsafeparkunparkLockSupportUnsafeparkunpark:\n\npublic native void park(boolean isAbsolute, long time);\npublic native void unpark(Thread thread);\n\n\n: :\n\n * park:  unpark  timeisAbsolutetrueisAbsolutefalsetime0unpark\n\n * unparkpark\n\n# park\n\npark\n\npublic static void park()\npublic static void park(Object blocker)\n\n\n: park()blockerparkBlockerpark(Object)\n\npublic static void park(Object blocker) {\n    // \n    Thread t = Thread.currentThread();\n    // Blocker\n    setBlocker(t, blocker);\n    // \n    UNSAFE.park(false, 0L);\n    // Blocker\n    setBlocker(t, null);\n}\n\n\n: parkparkBlockersetBlockerUnsafeparksetBlockerparksetBlocker? parkparkBlockerUnsafeparkunparksetBlockerunparksetBlockerparkBlockernullparksetBlockerpark(Object blocker)getBlockerpark(Object blocker)blockerpark(Object blocker)parkBlockernullpark(Object)setBlockersetBlocker\n\nprivate static void setBlocker(Thread t, Object arg) {\n    // tparkBlockerarg\n    UNSAFE.putObject(t, parkBlockerOffset, arg);\n}\n\n\n: tparkBlockerarg\n\npark()\n\npublic static void park() {\n    // \n    UNSAFE.park(false, 0L);\n}\n\n\n: park\n\n *  unpark\n * \n * ()\n\n# parkNanos\n\n\n\npublic static void parkNanos(Object blocker, long nanos) {\n    if (nanos > 0) { // 0\n        // \n        Thread t = Thread.currentThread();\n        // Blocker\n        setBlocker(t, blocker);\n        // \n        UNSAFE.park(false, nanos);\n        // \n        setBlocker(t, null);\n    }\n}\n\n\n: setBlockernanos\n\n# parkUntil\n\n, :\n\npublic static void parkUntil(Object blocker, long deadline) {\n    // \n    Thread t = Thread.currentThread();\n    // Blocker\n    setBlocker(t, blocker);\n    UNSAFE.park(true, deadline);\n    // Blockernull\n    setBlocker(t, null);\n}\n\n\n: setBlockerdeadline\n\n# unpark\n\n park  park :\n\npublic static void unpark(Thread thread) {\n    if (thread != null) // \n        UNSAFE.unpark(thread); // \n}\n\n\n: \n\n\n# LockSupport\n\n\n# wait/notify\n\nclass MyThread extends Thread {\n    \n    public void run() {\n        synchronized (this) {\n            System.out.println("before notify");            \n            notify();\n            System.out.println("after notify");    \n        }\n    }\n}\n\npublic class WaitAndNotifyDemo {\n    public static void main(String[] args) throws InterruptedException {\n        MyThread myThread = new MyThread();            \n        synchronized (myThread) {\n            try {        \n                myThread.start();\n                // 3s\n                Thread.sleep(3000);\n                System.out.println("before wait");\n                // \n                myThread.wait();\n                System.out.println("after wait");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }            \n        }        \n    }\n}\n\n\n\n\nbefore wait\nbefore notify\nafter notify\nafter wait\n\n\n: \n\n\n\nwait/notifywaitnotifynotifywait\n\nclass MyThread extends Thread {\n    public void run() {\n        synchronized (this) {\n            System.out.println("before notify");            \n            notify();\n            System.out.println("after notify");    \n        }\n    }\n}\n\npublic class WaitAndNotifyDemo {\n    public static void main(String[] args) throws InterruptedException {\n        MyThread myThread = new MyThread();        \n        myThread.start();\n        // 3s\n        Thread.sleep(3000);\n        synchronized (myThread) {\n            try {        \n                System.out.println("before wait");\n                // \n                myThread.wait();\n                System.out.println("after wait");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }            \n        }        \n    }\n}\n\n\n:\n\nbefore notify\nafter notify\nbefore wait\n\n\n: notifywait\n\n\n# park/unpark\n\nimport java.util.concurrent.locks.LockSupport;\n\nclass MyThread extends Thread {\n    private Object object;\n\n    public MyThread(Object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        System.out.println("before unpark");\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        // blocker\n        System.out.println("Blocker info " + LockSupport.getBlocker((Thread) object));\n        // \n        LockSupport.unpark((Thread) object);\n        // 500msparksetBlocker(t, null);\n        try {\n            Thread.sleep(500);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        // blocker\n        System.out.println("Blocker info " + LockSupport.getBlocker((Thread) object));\n\n        System.out.println("after unpark");\n    }\n}\n\npublic class test {\n    public static void main(String[] args) {\n        MyThread myThread = new MyThread(Thread.currentThread());\n        myThread.start();\n        System.out.println("before park");\n        // \n        LockSupport.park("ParkAndUnparkDemo");\n        System.out.println("after park");\n    }\n}\n\n\n:\n\nbefore park\nbefore unpark\nBlocker info ParkAndUnparkDemo\nafter park\nBlocker info null\nafter unpark\n\n\n: parkunparkunparkgetBlockernullunparkLock.park(Object blocker)setBlocker(t, null)getBlockernull\n\nparkunparkunparkpark\n\nimport java.util.concurrent.locks.LockSupport;\n\nclass MyThread extends Thread {\n    private Object object;\n\n    public MyThread(Object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        System.out.println("before unpark");        \n        // \n        LockSupport.unpark((Thread) object);\n        System.out.println("after unpark");\n    }\n}\n\npublic class ParkAndUnparkDemo {\n    public static void main(String[] args) {\n        MyThread myThread = new MyThread(Thread.currentThread());\n        myThread.start();\n        try {\n            // 3s\n            Thread.sleep(3000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println("before park");\n        // \n        LockSupport.park("ParkAndUnparkDemo");\n        System.out.println("after park");\n    }\n}\n\n\n:\n\nbefore unpark\nafter unpark\nbefore park\nafter park\n\n\n: unparkparkwait/notifypark/unparkwait/notify\n\n\n# \n\n\n\nimport java.util.concurrent.locks.LockSupport;\n\nclass MyThread extends Thread {\n    private Object object;\n\n    public MyThread(Object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        System.out.println("before interrupt");        \n        try {\n            // 3s\n            Thread.sleep(3000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }    \n        Thread thread = (Thread) object;\n        // \n        thread.interrupt();\n        System.out.println("after interrupt");\n    }\n}\n\npublic class InterruptDemo {\n    public static void main(String[] args) {\n        MyThread myThread = new MyThread(Thread.currentThread());\n        myThread.start();\n        System.out.println("before park");\n        // \n        LockSupport.park("ParkAndUnparkDemo");\n        System.out.println("after park");\n    }\n}\n\n\n:\n\nbefore park\nbefore interrupt\nafter interrupt\nafter park\n\n\n: parkmyThreadinterruptunpark\n\n\n# \n\n\n# Thread.sleep()Object.wait()\n\nThread.sleep()Object.wait()\n\n * Thread.sleep()Object.wait()\n * Thread.sleep()Object.wait()\n * Thread.sleep()\n * Object.wait()Object.notify()\n * Object.wait()notify\n\nThread.sleep()Object.wait()\n\n\n# Object.wait()Condition.await()\n\nObject.wait()Condition.await()Condition.await()LockSupport.park()\n\nstate0LockSupport.park()\n\n\n# Thread.sleep()LockSupport.park()\n\nLockSupport.park()parkNanos()parkUtil()park()\n\n * Thread.sleep()LockSupport.park()\n * Thread.sleep()\n * LockSupport.park()LockSupport.unpark()\n * Thread.sleep()InterruptedException\n * LockSupport.park()\n * Thread.sleep()native\n * LockSupport.park()Unsafenative\n\n\n# Object.wait()LockSupport.park()\n\n? ? \n\n * Object.wait()synchronized\n * LockSupport.park()\n * Object.wait()\n * LockSupport.park()\n * Object.wait()notify()\n * LockSupport.park()unpark()\n\npark()/unpark()Semaphoreunpark()\n\n# wait()notify()?\n\nnotify()wait()IllegalMonitorStateException\n\nwait()notify()\n\n# park()unpark()?\n\npark()\n\n\n# LockSupport.park()?\n\nConditionawait()\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5347293.html\n * https://blog.csdn.net/tangtong1/article/details/102829724\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-LockSupport.html',normalizedContent:'# juc: locksupport\n\n> locksupport\n\n * juc: locksupport\n   * bat\n   * locksupport\n   * locksupport\n     * \n     * \n     * \n       * park\n       * parknanos\n       * parkuntil\n       * unpark\n   * locksupport\n     * wait/notify\n     * park/unpark\n     * \n   * \n     * thread.sleep()object.wait()\n     * object.wait()condition.await()\n     * thread.sleep()locksupport.park()\n     * object.wait()locksupport.park()\n       * wait()notify()?\n       * park()unpark()?\n     * locksupport.park()?\n   * \n\n\n# bat\n\n\n\n\n\n * locksupport? aqsunsafe(cas)locksupport(park/unpark)\n * wait/notifylocksupportpark/unpark?\n * locksupport.park()? condition.await()?\n * thread.sleep()object.wait()condition.await()locksupport.park()? \n * wait()notify()?\n * park()unpark()?\n\n\n# locksupport\n\nlocksupportlocksupport.parklocksupport.unpark\n\n\n# locksupport\n\n\n# \n\npublic class locksupport {\n    // hotspot implementation via intrinsics api\n    private static final sun.misc.unsafe unsafe;\n    // \n    private static final long parkblockeroffset;\n    // \n    private static final long seed;\n    // \n    private static final long probe;\n    // \n    private static final long secondary;\n    \n    static {\n        try {\n            // unsafe\n            unsafe = sun.misc.unsafe.getunsafe();\n            // \n            class<?> tk = thread.class;\n            // threadparkblocker\n            parkblockeroffset = unsafe.objectfieldoffset\n                (tk.getdeclaredfield("parkblocker"));\n            // threadthreadlocalrandomseed\n            seed = unsafe.objectfieldoffset\n                (tk.getdeclaredfield("threadlocalrandomseed"));\n            // threadthreadlocalrandomprobe\n            probe = unsafe.objectfieldoffset\n                (tk.getdeclaredfield("threadlocalrandomprobe"));\n            // threadthreadlocalrandomsecondaryseed\n            secondary = unsafe.objectfieldoffset\n                (tk.getdeclaredfield("threadlocalrandomsecondaryseed"));\n        } catch (exception ex) { throw new error(ex); }\n    }\n}\n\n\n: unsafesun.misc.unsafelong\n\n\n# \n\n// \nprivate locksupport() {}\n\n\n: locksupport\n\n\n# \n\nlocksupportsun.misc.unsafeparkunparklocksupportunsafeparkunpark:\n\npublic native void park(boolean isabsolute, long time);\npublic native void unpark(thread thread);\n\n\n: :\n\n * park:  unpark  timeisabsolutetrueisabsolutefalsetime0unpark\n\n * unparkpark\n\n# park\n\npark\n\npublic static void park()\npublic static void park(object blocker)\n\n\n: park()blockerparkblockerpark(object)\n\npublic static void park(object blocker) {\n    // \n    thread t = thread.currentthread();\n    // blocker\n    setblocker(t, blocker);\n    // \n    unsafe.park(false, 0l);\n    // blocker\n    setblocker(t, null);\n}\n\n\n: parkparkblockersetblockerunsafeparksetblockerparksetblocker? parkparkblockerunsafeparkunparksetblockerunparksetblockerparkblockernullparksetblockerpark(object blocker)getblockerpark(object blocker)blockerpark(object blocker)parkblockernullpark(object)setblockersetblocker\n\nprivate static void setblocker(thread t, object arg) {\n    // tparkblockerarg\n    unsafe.putobject(t, parkblockeroffset, arg);\n}\n\n\n: tparkblockerarg\n\npark()\n\npublic static void park() {\n    // \n    unsafe.park(false, 0l);\n}\n\n\n: park\n\n *  unpark\n * \n * ()\n\n# parknanos\n\n\n\npublic static void parknanos(object blocker, long nanos) {\n    if (nanos > 0) { // 0\n        // \n        thread t = thread.currentthread();\n        // blocker\n        setblocker(t, blocker);\n        // \n        unsafe.park(false, nanos);\n        // \n        setblocker(t, null);\n    }\n}\n\n\n: setblockernanos\n\n# parkuntil\n\n, :\n\npublic static void parkuntil(object blocker, long deadline) {\n    // \n    thread t = thread.currentthread();\n    // blocker\n    setblocker(t, blocker);\n    unsafe.park(true, deadline);\n    // blockernull\n    setblocker(t, null);\n}\n\n\n: setblockerdeadline\n\n# unpark\n\n park  park :\n\npublic static void unpark(thread thread) {\n    if (thread != null) // \n        unsafe.unpark(thread); // \n}\n\n\n: \n\n\n# locksupport\n\n\n# wait/notify\n\nclass mythread extends thread {\n    \n    public void run() {\n        synchronized (this) {\n            system.out.println("before notify");            \n            notify();\n            system.out.println("after notify");    \n        }\n    }\n}\n\npublic class waitandnotifydemo {\n    public static void main(string[] args) throws interruptedexception {\n        mythread mythread = new mythread();            \n        synchronized (mythread) {\n            try {        \n                mythread.start();\n                // 3s\n                thread.sleep(3000);\n                system.out.println("before wait");\n                // \n                mythread.wait();\n                system.out.println("after wait");\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }            \n        }        \n    }\n}\n\n\n\n\nbefore wait\nbefore notify\nafter notify\nafter wait\n\n\n: \n\n\n\nwait/notifywaitnotifynotifywait\n\nclass mythread extends thread {\n    public void run() {\n        synchronized (this) {\n            system.out.println("before notify");            \n            notify();\n            system.out.println("after notify");    \n        }\n    }\n}\n\npublic class waitandnotifydemo {\n    public static void main(string[] args) throws interruptedexception {\n        mythread mythread = new mythread();        \n        mythread.start();\n        // 3s\n        thread.sleep(3000);\n        synchronized (mythread) {\n            try {        \n                system.out.println("before wait");\n                // \n                mythread.wait();\n                system.out.println("after wait");\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }            \n        }        \n    }\n}\n\n\n:\n\nbefore notify\nafter notify\nbefore wait\n\n\n: notifywait\n\n\n# park/unpark\n\nimport java.util.concurrent.locks.locksupport;\n\nclass mythread extends thread {\n    private object object;\n\n    public mythread(object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        system.out.println("before unpark");\n        try {\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        // blocker\n        system.out.println("blocker info " + locksupport.getblocker((thread) object));\n        // \n        locksupport.unpark((thread) object);\n        // 500msparksetblocker(t, null);\n        try {\n            thread.sleep(500);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        // blocker\n        system.out.println("blocker info " + locksupport.getblocker((thread) object));\n\n        system.out.println("after unpark");\n    }\n}\n\npublic class test {\n    public static void main(string[] args) {\n        mythread mythread = new mythread(thread.currentthread());\n        mythread.start();\n        system.out.println("before park");\n        // \n        locksupport.park("parkandunparkdemo");\n        system.out.println("after park");\n    }\n}\n\n\n:\n\nbefore park\nbefore unpark\nblocker info parkandunparkdemo\nafter park\nblocker info null\nafter unpark\n\n\n: parkunparkunparkgetblockernullunparklock.park(object blocker)setblocker(t, null)getblockernull\n\nparkunparkunparkpark\n\nimport java.util.concurrent.locks.locksupport;\n\nclass mythread extends thread {\n    private object object;\n\n    public mythread(object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        system.out.println("before unpark");        \n        // \n        locksupport.unpark((thread) object);\n        system.out.println("after unpark");\n    }\n}\n\npublic class parkandunparkdemo {\n    public static void main(string[] args) {\n        mythread mythread = new mythread(thread.currentthread());\n        mythread.start();\n        try {\n            // 3s\n            thread.sleep(3000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println("before park");\n        // \n        locksupport.park("parkandunparkdemo");\n        system.out.println("after park");\n    }\n}\n\n\n:\n\nbefore unpark\nafter unpark\nbefore park\nafter park\n\n\n: unparkparkwait/notifypark/unparkwait/notify\n\n\n# \n\n\n\nimport java.util.concurrent.locks.locksupport;\n\nclass mythread extends thread {\n    private object object;\n\n    public mythread(object object) {\n        this.object = object;\n    }\n\n    public void run() {\n        system.out.println("before interrupt");        \n        try {\n            // 3s\n            thread.sleep(3000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }    \n        thread thread = (thread) object;\n        // \n        thread.interrupt();\n        system.out.println("after interrupt");\n    }\n}\n\npublic class interruptdemo {\n    public static void main(string[] args) {\n        mythread mythread = new mythread(thread.currentthread());\n        mythread.start();\n        system.out.println("before park");\n        // \n        locksupport.park("parkandunparkdemo");\n        system.out.println("after park");\n    }\n}\n\n\n:\n\nbefore park\nbefore interrupt\nafter interrupt\nafter park\n\n\n: parkmythreadinterruptunpark\n\n\n# \n\n\n# thread.sleep()object.wait()\n\nthread.sleep()object.wait()\n\n * thread.sleep()object.wait()\n * thread.sleep()object.wait()\n * thread.sleep()\n * object.wait()object.notify()\n * object.wait()notify\n\nthread.sleep()object.wait()\n\n\n# object.wait()condition.await()\n\nobject.wait()condition.await()condition.await()locksupport.park()\n\nstate0locksupport.park()\n\n\n# thread.sleep()locksupport.park()\n\nlocksupport.park()parknanos()parkutil()park()\n\n * thread.sleep()locksupport.park()\n * thread.sleep()\n * locksupport.park()locksupport.unpark()\n * thread.sleep()interruptedexception\n * locksupport.park()\n * thread.sleep()native\n * locksupport.park()unsafenative\n\n\n# object.wait()locksupport.park()\n\n? ? \n\n * object.wait()synchronized\n * locksupport.park()\n * object.wait()\n * locksupport.park()\n * object.wait()notify()\n * locksupport.park()unpark()\n\npark()/unpark()semaphoreunpark()\n\n# wait()notify()?\n\nnotify()wait()illegalmonitorstateexception\n\nwait()notify()\n\n# park()unpark()?\n\npark()\n\n\n# locksupport.park()?\n\nconditionawait()\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5347293.html\n * https://blog.csdn.net/tangtong1/article/details/102829724\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-locksupport.html',charsets:{cjk:!0}},{title:": synchronized",frontmatter:{},regularPath:"/java/thread/java-thread-x-key-synchronized.html",relativePath:"java/thread/java-thread-x-key-synchronized.md",key:"v-e8b8e8e8",path:"/java/thread/java-thread-x-key-synchronized.html",headers:[{level:2,title:": synchronized",slug:"-synchronized",normalizedTitle:": synchronized",charIndex:2},{level:2,title:"BATSynchronized",slug:"batsynchronized",normalizedTitle:"batsynchronized",charIndex:181},{level:2,title:"Synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:214},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:237},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:336},{level:2,title:"Synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:406},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:430},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:447},{level:3,title:"happens-before",slug:"-happens-before",normalizedTitle:"happens-before",charIndex:468},{level:2,title:"JVM",slug:"jvm",normalizedTitle:"jvm",charIndex:504},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:520},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:532},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:579},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:590},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:601},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:629},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:656},{level:2,title:"SynchronizedLock",slug:"synchronizedlock",normalizedTitle:"synchronizedlock",charIndex:669},{level:3,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:694},{level:3,title:"Lock",slug:"lock",normalizedTitle:"lock",charIndex:717},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:733},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:744}],lastUpdated:"2023/4/10 22:14:07",lastUpdatedTimestamp:1681136047e3,headersStr:": synchronized BATSynchronized Synchronized   Synchronized   happens-before JVM        SynchronizedLock synchronized Lock  ",content:'# : synchronized\n\n> CJavaLock APIsynchronized, synchronized\n\n * : synchronized\n   * BATSynchronized\n   * Synchronized\n     * \n       * this,\n       * synchronizedthis\n     * \n       * synchronize\n       * synchronizedClass\n   * Synchronized\n     * \n     * \n     * happens-before\n   * JVM\n     * \n     * \n       * \n       * \n     * \n     * \n     * \n       * \n     * \n       * \n     * \n   * SynchronizedLock\n     * synchronized\n     * Lock\n   * \n   * \n\n\n# BATSynchronized\n\n\n\nsynchronized\n\n * Synchronized? \n * Synchronized? \n * Synchronized? Java Lock\n * SynchronizedLock?\n * Synchronized?\n * Synchronized,?\n * SynchronizedJVM?\n * Synchronized?\n * ()?\n * ? JVM?\n * JDKSynchronized?\n\n\n# Synchronized\n\nSychronized\n\n * \n * (this),*.classsynchronizedstatic\n * synchronized\n\n\n# \n\n(this,)()\n\n# this,\n\n * 1\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance = new SynchronizedObjectLock();\n\n    @Override\n    public void run() {\n        // this,,10\n        synchronized (this) {\n            System.out.println("" + Thread.currentThread().getName());\n            try {\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName() + "");\n        }\n    }\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nThread-0\nThread-0\nThread-1\nThread-1\n\n\n * 2\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance = new SynchronizedObjectLock();\n    // 2\n    Object block1 = new Object();\n    Object block2 = new Object();\n\n    @Override\n    public void run() {\n        // \n        synchronized (block1) {\n            System.out.println("block1," + Thread.currentThread().getName());\n            try {\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("block1,"+Thread.currentThread().getName() + "");\n        }\n\n        synchronized (block2) {\n            System.out.println("block2," + Thread.currentThread().getName());\n            try {\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("block2,"+Thread.currentThread().getName() + "");\n        }\n    }\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nblock1,Thread-0\nblock1,Thread-0\nblock2,Thread-0// \nblock1,Thread-1\nblock2,Thread-0\nblock1,Thread-1\nblock2,Thread-1\nblock2,Thread-1\n\n\n# synchronizedthis\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance = new SynchronizedObjectLock();\n\n    @Override\n    public void run() {\n        method();\n    }\n\n    public synchronized void method() {\n        System.out.println("" + Thread.currentThread().getName());\n        try {\n            Thread.sleep(3000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(Thread.currentThread().getName() + "");\n    }\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nThread-0\nThread-0\nThread-1\nThread-1\n\n\n\n# \n\nsynchronizedClass\n\n# synchronized\n\n * 1\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance1 = new SynchronizedObjectLock();\n    static SynchronizedObjectLock instance2 = new SynchronizedObjectLock();\n\n    @Override\n    public void run() {\n        method();\n    }\n\n    // synchronizedthis\n    public synchronized void method() {\n        System.out.println("" + Thread.currentThread().getName());\n        try {\n            Thread.sleep(3000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(Thread.currentThread().getName() + "");\n    }\n\n    public static void main(String[] args) {\n        // t1t2this\n        Thread t1 = new Thread(instance1);\n        Thread t2 = new Thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nThread-0\nThread-1\nThread-1\nThread-0\n\n\n * 2\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance1 = new SynchronizedObjectLock();\n    static SynchronizedObjectLock instance2 = new SynchronizedObjectLock();\n\n    @Override\n    public void run() {\n        method();\n    }\n\n    // synchronizedClass\n    public static synchronized void method() {\n        System.out.println("" + Thread.currentThread().getName());\n        try {\n            Thread.sleep(3000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(Thread.currentThread().getName() + "");\n    }\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread(instance1);\n        Thread t2 = new Thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nThread-0\nThread-0\nThread-1\nThread-1\n\n\n# synchronizedClass\n\npublic class SynchronizedObjectLock implements Runnable {\n    static SynchronizedObjectLock instance1 = new SynchronizedObjectLock();\n    static SynchronizedObjectLock instance2 = new SynchronizedObjectLock();\n\n    @Override\n    public void run() {\n        // \n        synchronized(SynchronizedObjectLock.class){\n            System.out.println("" + Thread.currentThread().getName());\n            try {\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName() + "");\n        }\n    }\n\n    public static void main(String[] args) {\n        Thread t1 = new Thread(instance1);\n        Thread t2 = new Thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nThread-0\nThread-0\nThread-1\nThread-1\n\n\n\n# Synchronized\n\n\n# \n\n> (this)JVM(monitor)\n\nJVM\n\npublic class SynchronizedDemo2 {\n\n    Object object = new Object();\n    public void method1() {\n        synchronized (object) {\n\n        }\n        method2();\n    }\n\n    private static void method2() {\n\n    }\n}\n\n\njavac.class\n\n>javac SynchronizedDemo2.java\n\n\njavap.class\n\n>javap -verbose SynchronizedDemo2.class\n\n\n\n\n\n\nmonitorentermonitorexit\n\nMonitorenterMonitorexit11monitor()monitorMonitormonitorenter3\n\n * monitor0+1+1\n * monitor2\n * \n\nmonitorexitmonitormonitor100monitor\n\n\n\n\n\nObjectObjectBLOCKEDObject\n\n\n# \n\n * \n\nreentrantre-entrant\n\nclass\n\n * \n\npublic class SynchronizedDemo {\n\n    public static void main(String[] args) {\n        SynchronizedDemo demo =  new SynchronizedDemo();\n        demo.method1();\n    }\n\n    private synchronized void method1() {\n        System.out.println(Thread.currentThread().getId() + ": method1()");\n        method2();\n    }\n\n    private synchronized void method2() {\n        System.out.println(Thread.currentThread().getId()+ ": method2()");\n        method3();\n    }\n\n    private synchronized void method3() {\n        System.out.println(Thread.currentThread().getId()+ ": method3()");\n    }\n}\n\n\n\n\n * monitorenter\n   * monitor=0\n   * method1()monitor+1 -> 1 \n   * method2()monitor+1 -> 2\n   * method3()monitor+1 -> 3\n * monitorexit\n   * method3()monitor-1 -> 2\n   * method2()monitor-1 -> 1\n   * method2()monitor-1 -> 0 \n   * monitor=0\n\nSynchronizedmonitormonitormonitor\n\n\n# happens-before\n\nSynchronizedhappens-beforehappens-before\n\npublic class MonitorDemo {\n    private int a = 0;\n\n    public synchronized void writer() {     // 1\n        a++;                                // 2\n    }                                       // 3\n\n    public synchronized void reader() {    // 4\n        int i = a;                         // 5\n    }                                      // 6\n}\n\n\nhappens-before\n\n\n\nhappens-beforeAhappens-beforeBhappens-beforhappens-before2 happens-before 5?\n\nhappens-before:A happens-before BABABAA2 happens-before 5ABBa1\n\n\n# JVM\n\nJVMmonitorentermonitorexitMutex LockMutex Lock()Mutex Lockjdk1.6(Lock Coarsening)(Lock Elimination)(Lightweight Locking)(Biased Locking)(Adaptive Spinning)\n\n * (Lock Coarsening)unlocklock\n\n * (Lock Elimination)JITStack(Heap)\n\n * (Lightweight Locking)()monitorentermonitorexitCASCAS()\n\n * (Biased Locking)CASCAS\n\n * (Adaptive Spinning)CASmonitor(mutex semaphore)(Spinning)monitorsemaphore()\n\n> Synchronied\n\n\n# \n\nJava SE 1.6Synchronied\n\n>         ()\n\n\n# \n\n# \n\n> SynchronizedHotSpot()CPU()\n\nJDK1.4 JDK 1.6(CPUCPU)JDK10-XX:PreBlockSpin\n\n()\n\n# \n\nJDK 1.6 JVM100JVMJVM\n\n\n# \n\nJVMJVM\n\nJava APIJVMStringStringStringJavacStringJDK 1.5StringBufferappend()JDK 1.5StringBuidlerappend()\n\npublic static String test03(String s1, String s2, String s3) {\n    String s = s1 + s2 + s3;\n    return s;\n}\n\n\njavap \n\n\n\nStringBuilderJVM(Vector)\n\n\n# \n\n()\n\n\n\nJavap java\n\npublic static String test04(String s1, String s2, String s3) {\n    StringBuffer sb = new StringBuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.toString();\n}\n\n\nappend()JVMJVM() append()\n\n\n# \n\nJDK 1.6\n\nHotSpotJava(Object Header)HashCodeGC Age3264()Mark Word (Klass Point)\n\n# \n\nJVM(Lock Record)Mark Word(JVMMark WordDisplaced Mark Ward)\n\n\n\n01JVMLock RecordMark Word\n\nCASMark WordMark WordLock RecordMark Word(Mark Word2bit)00\n\n\n\nJVMMark Word10.Mark Word\n\nCASDisplaced Mark Word\n\n\n\n\n# \n\n> \n\nHotSpotJava SE 1.6 SynchronizedIDCASMark Word\n\n\n\n# \n\n()JVM\n\n\n\n\n# \n\n                                                                                        \n    CAS                    \n                                CPU             \n   CPU                                \n\n\n# SynchronizedLock\n\n\n# synchronized\n\n * Lock\n\n * ()\n\n * Lock.........\n\n\n# Lock\n\nLock4:\n\n * lock(): \n * unlock(): \n * tryLock(): boolean\n * tryLock(long,TimeUtil): \n\nSynchronized()ConditionLock\n\nReentrantLocklockInterruptibly() ReentrantLockReentrantLocksynchronized\n\n> ReentrantLock Lock synchronized : JUC: ReentrantLock\n\n\n# \n\nsynchronized(JVM)JDK5Lock\n\n * Synchronized\n   \n   * \n   * \n   * \n   * Locksynchronizedjava.util.concurrentsynchronized\n\n * synchronized\n\nsynchronized\n\n\n# \n\n+Java +Java\n\n * https://juejin.im/post/5ae6dc04f265da0ba351d3ff\n * https://www.cnblogs.com/javaminer/p/3889023.html\n * https://www.jianshu.com/p/dab7745c0954\n * https://www.cnblogs.com/wuchaodzxx/p/6867546.html\n * https://www.cnblogs.com/xyabk/p/10901291.html\n * https://www.jianshu.com/p/64240319ed60\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-synchronized.html',normalizedContent:'# : synchronized\n\n> cjavalock apisynchronized, synchronized\n\n * : synchronized\n   * batsynchronized\n   * synchronized\n     * \n       * this,\n       * synchronizedthis\n     * \n       * synchronize\n       * synchronizedclass\n   * synchronized\n     * \n     * \n     * happens-before\n   * jvm\n     * \n     * \n       * \n       * \n     * \n     * \n     * \n       * \n     * \n       * \n     * \n   * synchronizedlock\n     * synchronized\n     * lock\n   * \n   * \n\n\n# batsynchronized\n\n\n\nsynchronized\n\n * synchronized? \n * synchronized? \n * synchronized? java lock\n * synchronizedlock?\n * synchronized?\n * synchronized,?\n * synchronizedjvm?\n * synchronized?\n * ()?\n * ? jvm?\n * jdksynchronized?\n\n\n# synchronized\n\nsychronized\n\n * \n * (this),*.classsynchronizedstatic\n * synchronized\n\n\n# \n\n(this,)()\n\n# this,\n\n * 1\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance = new synchronizedobjectlock();\n\n    @override\n    public void run() {\n        // this,,10\n        synchronized (this) {\n            system.out.println("" + thread.currentthread().getname());\n            try {\n                thread.sleep(3000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println(thread.currentthread().getname() + "");\n        }\n    }\n\n    public static void main(string[] args) {\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nthread-0\nthread-0\nthread-1\nthread-1\n\n\n * 2\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance = new synchronizedobjectlock();\n    // 2\n    object block1 = new object();\n    object block2 = new object();\n\n    @override\n    public void run() {\n        // \n        synchronized (block1) {\n            system.out.println("block1," + thread.currentthread().getname());\n            try {\n                thread.sleep(3000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("block1,"+thread.currentthread().getname() + "");\n        }\n\n        synchronized (block2) {\n            system.out.println("block2," + thread.currentthread().getname());\n            try {\n                thread.sleep(3000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("block2,"+thread.currentthread().getname() + "");\n        }\n    }\n\n    public static void main(string[] args) {\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nblock1,thread-0\nblock1,thread-0\nblock2,thread-0// \nblock1,thread-1\nblock2,thread-0\nblock1,thread-1\nblock2,thread-1\nblock2,thread-1\n\n\n# synchronizedthis\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance = new synchronizedobjectlock();\n\n    @override\n    public void run() {\n        method();\n    }\n\n    public synchronized void method() {\n        system.out.println("" + thread.currentthread().getname());\n        try {\n            thread.sleep(3000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println(thread.currentthread().getname() + "");\n    }\n\n    public static void main(string[] args) {\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nthread-0\nthread-0\nthread-1\nthread-1\n\n\n\n# \n\nsynchronizedclass\n\n# synchronized\n\n * 1\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance1 = new synchronizedobjectlock();\n    static synchronizedobjectlock instance2 = new synchronizedobjectlock();\n\n    @override\n    public void run() {\n        method();\n    }\n\n    // synchronizedthis\n    public synchronized void method() {\n        system.out.println("" + thread.currentthread().getname());\n        try {\n            thread.sleep(3000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println(thread.currentthread().getname() + "");\n    }\n\n    public static void main(string[] args) {\n        // t1t2this\n        thread t1 = new thread(instance1);\n        thread t2 = new thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nthread-0\nthread-1\nthread-1\nthread-0\n\n\n * 2\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance1 = new synchronizedobjectlock();\n    static synchronizedobjectlock instance2 = new synchronizedobjectlock();\n\n    @override\n    public void run() {\n        method();\n    }\n\n    // synchronizedclass\n    public static synchronized void method() {\n        system.out.println("" + thread.currentthread().getname());\n        try {\n            thread.sleep(3000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println(thread.currentthread().getname() + "");\n    }\n\n    public static void main(string[] args) {\n        thread t1 = new thread(instance1);\n        thread t2 = new thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nthread-0\nthread-0\nthread-1\nthread-1\n\n\n# synchronizedclass\n\npublic class synchronizedobjectlock implements runnable {\n    static synchronizedobjectlock instance1 = new synchronizedobjectlock();\n    static synchronizedobjectlock instance2 = new synchronizedobjectlock();\n\n    @override\n    public void run() {\n        // \n        synchronized(synchronizedobjectlock.class){\n            system.out.println("" + thread.currentthread().getname());\n            try {\n                thread.sleep(3000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println(thread.currentthread().getname() + "");\n        }\n    }\n\n    public static void main(string[] args) {\n        thread t1 = new thread(instance1);\n        thread t2 = new thread(instance2);\n        t1.start();\n        t2.start();\n    }\n}\n\n\n\n\nthread-0\nthread-0\nthread-1\nthread-1\n\n\n\n# synchronized\n\n\n# \n\n> (this)jvm(monitor)\n\njvm\n\npublic class synchronizeddemo2 {\n\n    object object = new object();\n    public void method1() {\n        synchronized (object) {\n\n        }\n        method2();\n    }\n\n    private static void method2() {\n\n    }\n}\n\n\njavac.class\n\n>javac synchronizeddemo2.java\n\n\njavap.class\n\n>javap -verbose synchronizeddemo2.class\n\n\n\n\n\n\nmonitorentermonitorexit\n\nmonitorentermonitorexit11monitor()monitormonitormonitorenter3\n\n * monitor0+1+1\n * monitor2\n * \n\nmonitorexitmonitormonitor100monitor\n\n\n\n\n\nobjectobjectblockedobject\n\n\n# \n\n * \n\nreentrantre-entrant\n\nclass\n\n * \n\npublic class synchronizeddemo {\n\n    public static void main(string[] args) {\n        synchronizeddemo demo =  new synchronizeddemo();\n        demo.method1();\n    }\n\n    private synchronized void method1() {\n        system.out.println(thread.currentthread().getid() + ": method1()");\n        method2();\n    }\n\n    private synchronized void method2() {\n        system.out.println(thread.currentthread().getid()+ ": method2()");\n        method3();\n    }\n\n    private synchronized void method3() {\n        system.out.println(thread.currentthread().getid()+ ": method3()");\n    }\n}\n\n\n\n\n * monitorenter\n   * monitor=0\n   * method1()monitor+1 -> 1 \n   * method2()monitor+1 -> 2\n   * method3()monitor+1 -> 3\n * monitorexit\n   * method3()monitor-1 -> 2\n   * method2()monitor-1 -> 1\n   * method2()monitor-1 -> 0 \n   * monitor=0\n\nsynchronizedmonitormonitormonitor\n\n\n# happens-before\n\nsynchronizedhappens-beforehappens-before\n\npublic class monitordemo {\n    private int a = 0;\n\n    public synchronized void writer() {     // 1\n        a++;                                // 2\n    }                                       // 3\n\n    public synchronized void reader() {    // 4\n        int i = a;                         // 5\n    }                                      // 6\n}\n\n\nhappens-before\n\n\n\nhappens-beforeahappens-beforebhappens-beforhappens-before2 happens-before 5?\n\nhappens-before:a happens-before bababaa2 happens-before 5abba1\n\n\n# jvm\n\njvmmonitorentermonitorexitmutex lockmutex lock()mutex lockjdk1.6(lock coarsening)(lock elimination)(lightweight locking)(biased locking)(adaptive spinning)\n\n * (lock coarsening)unlocklock\n\n * (lock elimination)jitstack(heap)\n\n * (lightweight locking)()monitorentermonitorexitcascas()\n\n * (biased locking)cascas\n\n * (adaptive spinning)casmonitor(mutex semaphore)(spinning)monitorsemaphore()\n\n> synchronied\n\n\n# \n\njava se 1.6synchronied\n\n>         ()\n\n\n# \n\n# \n\n> synchronizedhotspot()cpu()\n\njdk1.4 jdk 1.6(cpucpu)jdk10-xx:preblockspin\n\n()\n\n# \n\njdk 1.6 jvm100jvmjvm\n\n\n# \n\njvmjvm\n\njava apijvmstringstringstringjavacstringjdk 1.5stringbufferappend()jdk 1.5stringbuidlerappend()\n\npublic static string test03(string s1, string s2, string s3) {\n    string s = s1 + s2 + s3;\n    return s;\n}\n\n\njavap \n\n\n\nstringbuilderjvm(vector)\n\n\n# \n\n()\n\n\n\njavap java\n\npublic static string test04(string s1, string s2, string s3) {\n    stringbuffer sb = new stringbuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.tostring();\n}\n\n\nappend()jvmjvm() append()\n\n\n# \n\njdk 1.6\n\nhotspotjava(object header)hashcodegc age3264()mark word (klass point)\n\n# \n\njvm(lock record)mark word(jvmmark worddisplaced mark ward)\n\n\n\n01jvmlock recordmark word\n\ncasmark wordmark wordlock recordmark word(mark word2bit)00\n\n\n\njvmmark word10.mark word\n\ncasdisplaced mark word\n\n\n\n\n# \n\n> \n\nhotspotjava se 1.6 synchronizedidcasmark word\n\n\n\n# \n\n()jvm\n\n\n\n\n# \n\n                                                                                        \n    cas                    \n                                cpu             \n   cpu                                \n\n\n# synchronizedlock\n\n\n# synchronized\n\n * lock\n\n * ()\n\n * lock.........\n\n\n# lock\n\nlock4:\n\n * lock(): \n * unlock(): \n * trylock(): boolean\n * trylock(long,timeutil): \n\nsynchronized()conditionlock\n\nreentrantlocklockinterruptibly() reentrantlockreentrantlocksynchronized\n\n> reentrantlock lock synchronized : juc: reentrantlock\n\n\n# \n\nsynchronized(jvm)jdk5lock\n\n * synchronized\n   \n   * \n   * \n   * \n   * locksynchronizedjava.util.concurrentsynchronized\n\n * synchronized\n\nsynchronized\n\n\n# \n\n+java +java\n\n * https://juejin.im/post/5ae6dc04f265da0ba351d3ff\n * https://www.cnblogs.com/javaminer/p/3889023.html\n * https://www.jianshu.com/p/dab7745c0954\n * https://www.cnblogs.com/wuchaodzxx/p/6867546.html\n * https://www.cnblogs.com/xyabk/p/10901291.html\n * https://www.jianshu.com/p/64240319ed60\n *  https://www.pdai.tech/md/java/thread/java-thread-x-key-synchronized.html',charsets:{cjk:!0}},{title:"JUC: ReentrantLock",frontmatter:{},regularPath:"/java/thread/java-thread-x-lock-ReentrantLock.html",relativePath:"java/thread/java-thread-x-lock-ReentrantLock.md",key:"v-4212a3b8",path:"/java/thread/java-thread-x-lock-ReentrantLock.html",headers:[{level:2,title:"JUC: ReentrantLock",slug:"juc-reentrantlock",normalizedTitle:"juc: reentrantlock",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:150},{level:2,title:"ReentrantLock",slug:"reentrantlock",normalizedTitle:"reentrantlock",charIndex:171},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:196},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:210},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:223},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:235},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:249},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:261},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:273},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:282}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ReentrantLock BAT ReentrantLock        ",content:'# JUC: ReentrantLock\n\n> ReentrantLockAbstractQueuedSynchronizerAbstractQueuedSynchronizer\n\n * JUC: ReentrantLock\n   * BAT\n   * ReentrantLock\n     * \n     * \n     * \n     * \n     * \n   * \n     * \n   * \n\n\n# BAT\n\n\n\n\n\n * ? ?\n * ReentrantLockAQS? \n * ReentrantLock?\n * ReentrantLock?\n * ReentrantLock?\n * ReentrantLock?\n * ReentrantLockSynchronized?\n\n\n# ReentrantLock\n\n\n# \n\nReentrantLockLockLocklockunlocknewCondition\n\npublic class ReentrantLock implements Lock, java.io.Serializable\n\n\n\n# \n\nReentrantLock\n\n\n\n: ReentrantLockSyncNonfairSyncFairSyncNonfairSyncFairSyncSyncSyncAbstractQueuedSynchronizer\n\n * Sync\n\nSync:\n\nabstract static class Sync extends AbstractQueuedSynchronizer {\n    // \n    private static final long serialVersionUID = -5179523762034025860L;\n    \n    // \n    abstract void lock();\n    \n    // \n    final boolean nonfairTryAcquire(int acquires) {\n        // \n        final Thread current = Thread.currentThread();\n        // \n        int c = getState();\n        if (c == 0) { // \n            if (compareAndSetState(0, acquires)) { // 0\n                // \n                setExclusiveOwnerThread(current); \n                return true; // \n            }\n        }\n        else if (current == getExclusiveOwnerThread()) { // \n            int nextc = c + acquires; // \n            if (nextc < 0) // overflow\n                throw new Error("Maximum lock count exceeded");\n            // \n            setState(nextc); \n            // \n            return true; \n        }\n        // \n        return false;\n    }\n    \n    // \n    protected final boolean tryRelease(int releases) {\n        int c = getState() - releases;\n        if (Thread.currentThread() != getExclusiveOwnerThread()) // \n            throw new IllegalMonitorStateException(); // \n        // \n        boolean free = false; \n        if (c == 0) {\n            free = true;\n            // \n            setExclusiveOwnerThread(null); \n        }\n        // \n        setState(c); \n        return free; \n    }\n    \n    // \n    protected final boolean isHeldExclusively() {\n        // While we must in general read state before owner,\n        // we don\'t need to do so to check if current thread is owner\n        return getExclusiveOwnerThread() == Thread.currentThread();\n    }\n\n    // \n    final ConditionObject newCondition() {\n        return new ConditionObject();\n    }\n\n    // Methods relayed from outer class\n    // \n    final Thread getOwner() {        \n        return getState() == 0 ? null : getExclusiveOwnerThread();\n    }\n    // \n    final int getHoldCount() {            \n        return isHeldExclusively() ? getState() : 0;\n    }\n\n    // \n    final boolean isLocked() {        \n        return getState() != 0;\n    }\n\n    /**\n        * Reconstitutes the instance from a stream (that is, deserializes it).\n        */\n    // \n    private void readObject(java.io.ObjectInputStream s)\n        throws java.io.IOException, ClassNotFoundException {\n        s.defaultReadObject();\n        setState(0); // reset to unlocked state\n    }\n}\n\n\nSync\n\n\n\n * NonfairSync\n\nNonfairSyncSyncSynclock:\n\n// \nstatic final class NonfairSync extends Sync {\n    // \n    private static final long serialVersionUID = 7316153563782823691L;\n\n    // \n    final void lock() {\n        if (compareAndSetState(0, 1)) // 0\n            // \n            setExclusiveOwnerThread(Thread.currentThread());\n        else // set\n            // \n            acquire(1); \n    }\n\n    protected final boolean tryAcquire(int acquires) {\n        return nonfairTryAcquire(acquires);\n    }\n}\n\n\n: lock\n\n * FairSyn\n\nFairSyncSyncSynclock:\n\n// \nstatic final class FairSync extends Sync {\n    // \n    private static final long serialVersionUID = -3000897897090466540L;\n\n    final void lock() {\n        // \n        acquire(1);\n    }\n\n    /**\n        * Fair version of tryAcquire.  Don\'t grant access unless\n        * recursive call or no waiters or is first.\n        */\n    // \n    protected final boolean tryAcquire(int acquires) {\n        // \n        final Thread current = Thread.currentThread();\n        // \n        int c = getState();\n        if (c == 0) { // 0\n            if (!hasQueuedPredecessors() &&\n                compareAndSetState(0, acquires)) { // \n                // \n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        else if (current == getExclusiveOwnerThread()) { // 0\n            // \n            int nextc = c + acquires;\n            if (nextc < 0) // int\n                throw new Error("Maximum lock count exceeded");\n            // \n            setState(nextc);\n            return true;\n        }\n        return false;\n    }\n}\n\n\n: locksync(AbstractQueuedSynchronizer)FairSynclock\n\n\n\n: sync queueNonfairNonfair\n\n\n# \n\nReentrantLocksyncReentrantLockSyncAbstractQueuedSynchronizer\n\npublic class ReentrantLock implements Lock, java.io.Serializable {\n    // \n    private static final long serialVersionUID = 7373984872572414699L;    \n    // \n    private final Sync sync;\n}\n\n\n\n# \n\n * ReentrantLock()\n\n\n\npublic ReentrantLock() {\n    // \n    sync = new NonfairSync();\n}\n\n\n * ReentrantLock(boolean)\n\ntrue:\n\npublic ReentrantLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n}\n\n\n\n# \n\nReentrantLockSyncSyncAQSAQSReentrantLocklockSynclock()Sync\n\nReentrantLockAQSAQS\n\n\n# \n\n\n# \n\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\nclass MyThread extends Thread {\n    private Lock lock;\n    public MyThread(String name, Lock lock) {\n        super(name);\n        this.lock = lock;\n    }\n    \n    public void run () {\n        lock.lock();\n        try {\n            System.out.println(Thread.currentThread() + " running");\n            try {\n                Thread.sleep(500);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\npublic class AbstractQueuedSynchronizerDemo {\n    public static void main(String[] args) throws InterruptedException {\n        Lock lock = new ReentrantLock(true);\n        \n        MyThread t1 = new MyThread("t1", lock);        \n        MyThread t2 = new MyThread("t2", lock);\n        MyThread t3 = new MyThread("t3", lock);\n        t1.start();\n        t2.start();    \n        t3.start();\n    }\n}\n\n\n():\n\nThread[t1,5,main] running\nThread[t2,5,main] running\nThread[t3,5,main] running\n\n\n: \n\n\n\n: t1lock -> t2lock -> t3lock -> t1unlock -> t2unlock -> t3unlock\n\n * t1lock.lock\n\n\n\n: t1\n\n * t2lock.lock\n\n\n\n: t2LockSupport.park\n\n * t3lock.lock\n\n\n\n: t3LockSupport.park\n\n * t1lock.unlock\n\n\n\n: head0t2unparkt2t3\n\n * t2cput2park\n\n\n\n: setHeadheadheadprethreadnullacquireQueuedsync queue\n\n * t2lock.unlock\n\n\n\n: unpark t3t3\n\n * t3cpu\n\n\n\n: sync queue0null\n\n * t3lock.unlock\n\n\n\n: \n\nConditionAQS\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5383609.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-ReentrantLock.html',normalizedContent:'# juc: reentrantlock\n\n> reentrantlockabstractqueuedsynchronizerabstractqueuedsynchronizer\n\n * juc: reentrantlock\n   * bat\n   * reentrantlock\n     * \n     * \n     * \n     * \n     * \n   * \n     * \n   * \n\n\n# bat\n\n\n\n\n\n * ? ?\n * reentrantlockaqs? \n * reentrantlock?\n * reentrantlock?\n * reentrantlock?\n * reentrantlock?\n * reentrantlocksynchronized?\n\n\n# reentrantlock\n\n\n# \n\nreentrantlocklocklocklockunlocknewcondition\n\npublic class reentrantlock implements lock, java.io.serializable\n\n\n\n# \n\nreentrantlock\n\n\n\n: reentrantlocksyncnonfairsyncfairsyncnonfairsyncfairsyncsyncsyncabstractqueuedsynchronizer\n\n * sync\n\nsync:\n\nabstract static class sync extends abstractqueuedsynchronizer {\n    // \n    private static final long serialversionuid = -5179523762034025860l;\n    \n    // \n    abstract void lock();\n    \n    // \n    final boolean nonfairtryacquire(int acquires) {\n        // \n        final thread current = thread.currentthread();\n        // \n        int c = getstate();\n        if (c == 0) { // \n            if (compareandsetstate(0, acquires)) { // 0\n                // \n                setexclusiveownerthread(current); \n                return true; // \n            }\n        }\n        else if (current == getexclusiveownerthread()) { // \n            int nextc = c + acquires; // \n            if (nextc < 0) // overflow\n                throw new error("maximum lock count exceeded");\n            // \n            setstate(nextc); \n            // \n            return true; \n        }\n        // \n        return false;\n    }\n    \n    // \n    protected final boolean tryrelease(int releases) {\n        int c = getstate() - releases;\n        if (thread.currentthread() != getexclusiveownerthread()) // \n            throw new illegalmonitorstateexception(); // \n        // \n        boolean free = false; \n        if (c == 0) {\n            free = true;\n            // \n            setexclusiveownerthread(null); \n        }\n        // \n        setstate(c); \n        return free; \n    }\n    \n    // \n    protected final boolean isheldexclusively() {\n        // while we must in general read state before owner,\n        // we don\'t need to do so to check if current thread is owner\n        return getexclusiveownerthread() == thread.currentthread();\n    }\n\n    // \n    final conditionobject newcondition() {\n        return new conditionobject();\n    }\n\n    // methods relayed from outer class\n    // \n    final thread getowner() {        \n        return getstate() == 0 ? null : getexclusiveownerthread();\n    }\n    // \n    final int getholdcount() {            \n        return isheldexclusively() ? getstate() : 0;\n    }\n\n    // \n    final boolean islocked() {        \n        return getstate() != 0;\n    }\n\n    /**\n        * reconstitutes the instance from a stream (that is, deserializes it).\n        */\n    // \n    private void readobject(java.io.objectinputstream s)\n        throws java.io.ioexception, classnotfoundexception {\n        s.defaultreadobject();\n        setstate(0); // reset to unlocked state\n    }\n}\n\n\nsync\n\n\n\n * nonfairsync\n\nnonfairsyncsyncsynclock:\n\n// \nstatic final class nonfairsync extends sync {\n    // \n    private static final long serialversionuid = 7316153563782823691l;\n\n    // \n    final void lock() {\n        if (compareandsetstate(0, 1)) // 0\n            // \n            setexclusiveownerthread(thread.currentthread());\n        else // set\n            // \n            acquire(1); \n    }\n\n    protected final boolean tryacquire(int acquires) {\n        return nonfairtryacquire(acquires);\n    }\n}\n\n\n: lock\n\n * fairsyn\n\nfairsyncsyncsynclock:\n\n// \nstatic final class fairsync extends sync {\n    // \n    private static final long serialversionuid = -3000897897090466540l;\n\n    final void lock() {\n        // \n        acquire(1);\n    }\n\n    /**\n        * fair version of tryacquire.  don\'t grant access unless\n        * recursive call or no waiters or is first.\n        */\n    // \n    protected final boolean tryacquire(int acquires) {\n        // \n        final thread current = thread.currentthread();\n        // \n        int c = getstate();\n        if (c == 0) { // 0\n            if (!hasqueuedpredecessors() &&\n                compareandsetstate(0, acquires)) { // \n                // \n                setexclusiveownerthread(current);\n                return true;\n            }\n        }\n        else if (current == getexclusiveownerthread()) { // 0\n            // \n            int nextc = c + acquires;\n            if (nextc < 0) // int\n                throw new error("maximum lock count exceeded");\n            // \n            setstate(nextc);\n            return true;\n        }\n        return false;\n    }\n}\n\n\n: locksync(abstractqueuedsynchronizer)fairsynclock\n\n\n\n: sync queuenonfairnonfair\n\n\n# \n\nreentrantlocksyncreentrantlocksyncabstractqueuedsynchronizer\n\npublic class reentrantlock implements lock, java.io.serializable {\n    // \n    private static final long serialversionuid = 7373984872572414699l;    \n    // \n    private final sync sync;\n}\n\n\n\n# \n\n * reentrantlock()\n\n\n\npublic reentrantlock() {\n    // \n    sync = new nonfairsync();\n}\n\n\n * reentrantlock(boolean)\n\ntrue:\n\npublic reentrantlock(boolean fair) {\n    sync = fair ? new fairsync() : new nonfairsync();\n}\n\n\n\n# \n\nreentrantlocksyncsyncaqsaqsreentrantlocklocksynclock()sync\n\nreentrantlockaqsaqs\n\n\n# \n\n\n# \n\nimport java.util.concurrent.locks.lock;\nimport java.util.concurrent.locks.reentrantlock;\n\nclass mythread extends thread {\n    private lock lock;\n    public mythread(string name, lock lock) {\n        super(name);\n        this.lock = lock;\n    }\n    \n    public void run () {\n        lock.lock();\n        try {\n            system.out.println(thread.currentthread() + " running");\n            try {\n                thread.sleep(500);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\npublic class abstractqueuedsynchronizerdemo {\n    public static void main(string[] args) throws interruptedexception {\n        lock lock = new reentrantlock(true);\n        \n        mythread t1 = new mythread("t1", lock);        \n        mythread t2 = new mythread("t2", lock);\n        mythread t3 = new mythread("t3", lock);\n        t1.start();\n        t2.start();    \n        t3.start();\n    }\n}\n\n\n():\n\nthread[t1,5,main] running\nthread[t2,5,main] running\nthread[t3,5,main] running\n\n\n: \n\n\n\n: t1lock -> t2lock -> t3lock -> t1unlock -> t2unlock -> t3unlock\n\n * t1lock.lock\n\n\n\n: t1\n\n * t2lock.lock\n\n\n\n: t2locksupport.park\n\n * t3lock.lock\n\n\n\n: t3locksupport.park\n\n * t1lock.unlock\n\n\n\n: head0t2unparkt2t3\n\n * t2cput2park\n\n\n\n: setheadheadheadprethreadnullacquirequeuedsync queue\n\n * t2lock.unlock\n\n\n\n: unpark t3t3\n\n * t3cpu\n\n\n\n: sync queue0null\n\n * t3lock.unlock\n\n\n\n: \n\nconditionaqs\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5383609.html\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-reentrantlock.html',charsets:{cjk:!0}},{title:"JUC: AQS",frontmatter:{},regularPath:"/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html",relativePath:"java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.md",key:"v-2bc4f624",path:"/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html",headers:[{level:2,title:"JUC: AQS",slug:"juc-aqs",normalizedTitle:"juc: aqs",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:125},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:146},{level:3,title:"AQS ",slug:"aqs-",normalizedTitle:"aqs ",charIndex:182},{level:3,title:"AQS ",slug:"aqs-",normalizedTitle:"aqs ",charIndex:198},{level:3,title:"AQS",slug:"aqs",normalizedTitle:"aqs",charIndex:218},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:238},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:274},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:312},{level:3,title:" - Node",slug:"-node",normalizedTitle:" - node",charIndex:326},{level:3,title:" - ConditionObject",slug:"-conditionobject",normalizedTitle:" - conditionobject",charIndex:347},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:379},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:391},{level:3,title:" - acquire",slug:"-acquire",normalizedTitle:" - acquire",charIndex:405},{level:3,title:" - release",slug:"-release",normalizedTitle:" - release",charIndex:431},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:455},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:492},{level:2,title:"AbstractQueuedSynchronizer",slug:"abstractqueuedsynchronizer",normalizedTitle:"abstractqueuedsynchronizer",charIndex:529},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:563}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: AQS BAT AbstractQueuedSynchronizer AQS  AQS  AQS AbstractQueuedSynchronizer AbstractQueuedSynchronizer   - Node  - ConditionObject    - acquire  - release AbstractQueuedSynchronizer AbstractQueuedSynchronizer AbstractQueuedSynchronizer ",content:'# JUC: AQS\n\n> AbstractQueuedSynchronizerFIFO\n\n * JUC: AQS\n   * BAT\n   * AbstractQueuedSynchronizer\n     * AQS \n     * AQS \n     * AQS\n   * AbstractQueuedSynchronizer\n   * AbstractQueuedSynchronizer\n     * \n     *  - Node\n     *  - ConditionObject\n     * \n     * \n     *  - acquire\n     *  - release\n   * AbstractQueuedSynchronizer\n   * AbstractQueuedSynchronizer\n   * AbstractQueuedSynchronizer\n   * \n\n\n# BAT\n\n\n\n\n\n * AQS? ?\n * AQS? ? \n * AQS?\n * AQS? AQS(ReentrantLock) (SemaphoreCountDownLatch CyclicBarrier )ReentrantReadWriteLock\n * AQS? \n * AQS?\n\n\n# AbstractQueuedSynchronizer\n\nAQSAQSReentrantLockSemaphoreReentrantReadWriteLockSynchronousQueueFutureTaskAQSAQS\n\n\n# AQS \n\nAQSAQSCLH\n\n> CLH(Craig,Landin,and Hagersten)()AQSCLH(Node)\n\nAQSintFIFOAQSCAS\n\nprivate volatile int state;//volatile\n\n\nproctedgetStatesetStatecompareAndSetState\n\n//\nprotected final int getState() {  \n        return state;\n}\n // \nprotected final void setState(int newState) { \n        state = newState;\n}\n//(CAS)updateexpect()\nprotected final boolean compareAndSetState(int expect, int update) {\n        return unsafe.compareAndSwapInt(this, stateOffset, expect, update);\n}\n\n\n\n# AQS \n\nAQS\n\n * Exclusive()ReentrantLock\n   * \n   * \n * Share()Semaphore/CountDownLatchSemaphoreCountDownLatCh CyclicBarrierReadWriteLock \n\nReentrantReadWriteLock ReentrantReadWriteLock\n\n state (/)AQS\n\n\n# AQS\n\n> ()\n\nAbstractQueuedSynchronizer(state) AQS\n\n - (Template Method)\n\nAQSAQS\n\nisHeldExclusively()//condition\ntryAcquire(int)//truefalse\ntryRelease(int)//truefalse\ntryAcquireShared(int)//0\ntryReleaseShared(int)//truefalse\n\n\n UnsupportedOperationException AQSfinal \n\nReentrantLockstate0Alock()tryAcquire()state+1tryAcquire()Aunlock()state=0()A(state)state\n\n\n# AbstractQueuedSynchronizer\n\nAbstractQueuedSynchronizerCLH(Craig,Landin,and Hagersten)()AQSCLH(Node)Sync queueheadtailheadCondition queueConditionCondition queue\n\n\n\n\n# AbstractQueuedSynchronizer\n\n\n# \n\nAbstractQueuedSynchronizerAbstractOwnableSynchronizerSerializable\n\npublic abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable\n\n\nAbstractOwnableSynchronizer:\n\npublic abstract class AbstractOwnableSynchronizer implements java.io.Serializable {\n    \n    // \n    private static final long serialVersionUID = 3737899427754241961L;\n    // \n    protected AbstractOwnableSynchronizer() { }\n    // \n    private transient Thread exclusiveOwnerThread;\n    \n    //  \n    protected final void setExclusiveOwnerThread(Thread thread) {\n        exclusiveOwnerThread = thread;\n    }\n    \n    //  \n    protected final Thread getExclusiveOwnerThread() {\n        return exclusiveOwnerThread;\n    }\n}\n\n\nAbstractOwnableSynchronizersetExclusiveOwnerThreadgetExclusiveOwnerThread\n\n> AbstractQueuedSynchronizerNodeConditionObject\n\n\n#  - Node\n\nstatic final class Node {\n    // \n    // \n    static final Node SHARED = new Node();\n    // \n    static final Node EXCLUSIVE = null;        \n    // \n    // CANCELLED1\n    // SIGNAL-1unpark\n    // CONDITION-2conditioncondition\n    // PROPAGATE-3acquireShared\n    // 0sync\n    static final int CANCELLED =  1;\n    static final int SIGNAL    = -1;\n    static final int CONDITION = -2;\n    static final int PROPAGATE = -3;        \n\n    // \n    volatile int waitStatus;        \n    // \n    volatile Node prev;    \n    // \n    volatile Node next;        \n    // \n    volatile Thread thread;        \n    // \n    Node nextWaiter;\n    \n    // \n    final boolean isShared() {\n        return nextWaiter == SHARED;\n    }\n    \n    // \n    final Node predecessor() throws NullPointerException {\n        // \n        Node p = prev; \n        if (p == null) // \n            throw new NullPointerException();\n        else // \n            return p;\n    }\n    \n    // \n    Node() {    // Used to establish initial head or SHARED marker\n    }\n    \n    // \n        Node(Thread thread, Node mode) {    // Used by addWaiter\n        this.nextWaiter = mode;\n        this.thread = thread;\n    }\n    \n    // \n    Node(Thread thread, int waitStatus) { // Used by Condition\n        this.waitStatus = waitStatus;\n        this.thread = thread;\n    }\n}\n\n\nNodeThread\n\n * CANCELLED1\n\n * SIGNAL-1unpark\n\n * CONDITION-2conditioncondition queue\n\n * PROPAGATE-3acquireShared\n\n * 0sync queue\n\n\n#  - ConditionObject\n\n:\n\n// \npublic class ConditionObject implements Condition, java.io.Serializable {\n    // \n    private static final long serialVersionUID = 1173984872572414699L;\n    /** First node of condition queue. */\n    // condition\n    private transient Node firstWaiter;\n    /** Last node of condition queue. */\n    // condition\n    private transient Node lastWaiter;\n\n    /**\n        * Creates a new {@code ConditionObject} instance.\n        */\n    // \n    public ConditionObject() { }\n\n    // Internal methods\n\n    /**\n        * Adds a new waiter to wait queue.\n        * @return its new wait node\n        */\n    // waiterwait\n    private Node addConditionWaiter() {\n        // \n        Node t = lastWaiter;\n        // If lastWaiter is cancelled, clean out.\n        if (t != null && t.waitStatus != Node.CONDITION) { // CONDITION\n            // CONDITION\n            unlinkCancelledWaiters(); \n            // t\n            t = lastWaiter;\n        }\n        // \n        Node node = new Node(Thread.currentThread(), Node.CONDITION);\n        if (t == null) // \n            // condition\n            firstWaiter = node;\n        else // \n            // nextWaiternode\n            t.nextWaiter = node;\n        // condition\n        lastWaiter = node;\n        return node;\n    }\n\n    /**\n        * Removes and transfers nodes until hit non-cancelled one or\n        * null. Split out from signal in part to encourage compilers\n        * to inline the case of no waiters.\n        * @param first (non-null) the first node on condition queue\n        */\n    private void doSignal(Node first) {\n        // \n        do {\n            if ( (firstWaiter = first.nextWaiter) == null) // nextWaiter\n                // \n                lastWaiter = null;\n            // firstnextWaiter\n            first.nextWaiter = null;\n        } while (!transferForSignal(first) &&\n                    (first = firstWaiter) != null); // conditionsynccondition\n    }\n\n    /**\n        * Removes and transfers all nodes.\n        * @param first (non-null) the first node on condition queue\n        */\n    private void doSignalAll(Node first) {\n        // condition\n        lastWaiter = firstWaiter = null;\n        // \n        do {\n            // firstnextWaiter\n            Node next = first.nextWaiter;\n            // firstnextWaiter\n            first.nextWaiter = null;\n            // firstconditionsync\n            transferForSignal(first);\n            // first\n            first = next;\n        } while (first != null);\n    }\n\n    /**\n        * Unlinks cancelled waiter nodes from condition queue.\n        * Called only while holding lock. This is called when\n        * cancellation occurred during condition wait, and upon\n        * insertion of a new waiter when lastWaiter is seen to have\n        * been cancelled. This method is needed to avoid garbage\n        * retention in the absence of signals. So even though it may\n        * require a full traversal, it comes into play only when\n        * timeouts or cancellations occur in the absence of\n        * signals. It traverses all nodes rather than stopping at a\n        * particular target to unlink all pointers to garbage nodes\n        * without requiring many re-traversals during cancellation\n        * storms.\n        */\n    // conditionCANCEL\n    private void unlinkCancelledWaiters() {\n        // condition\n        Node t = firstWaiter;\n        Node trail = null;\n        while (t != null) { // t\n            // \n            Node next = t.nextWaiter;\n            if (t.waitStatus != Node.CONDITION) { // tCONDTION\n                // tnextWaiter\n                t.nextWaiter = null;\n                if (trail == null) // trail\n                    // condition\n                    firstWaiter = next;\n                else // trail\n                    // trailnextWaiternext\n                    trail.nextWaiter = next;\n                if (next == null) // next\n                    // condition\n                    lastWaiter = trail;\n            }\n            else // tCONDTION\n                // trail\n                trail = t;\n            // t\n            t = next;\n        }\n    }\n\n    // public methods\n\n    /**\n        * Moves the longest-waiting thread, if one exists, from the\n        * wait queue for this condition to the wait queue for the\n        * owning lock.\n        *\n        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}\n        *         returns {@code false}\n        */\n    //  await \n    public final void signal() {\n        if (!isHeldExclusively()) // \n            throw new IllegalMonitorStateException();\n        // condition\n        Node first = firstWaiter;\n        if (first != null) // \n            // \n            doSignal(first);\n    }\n\n    /**\n        * Moves all threads from the wait queue for this condition to\n        * the wait queue for the owning lock.\n        *\n        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}\n        *         returns {@code false}\n        */\n    //  await \n    public final void signalAll() {\n        if (!isHeldExclusively()) // \n            throw new IllegalMonitorStateException();\n        // condition\n        Node first = firstWaiter;\n        if (first != null) // \n            // \n            doSignalAll(first);\n    }\n\n    /**\n        * Implements uninterruptible condition wait.\n        * <ol>\n        * <li> Save lock state returned by {@link #getState}.\n        * <li> Invoke {@link #release} with saved state as argument,\n        *      throwing IllegalMonitorStateException if it fails.\n        * <li> Block until signalled.\n        * <li> Reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * </ol>\n        */\n    // \n    public final void awaitUninterruptibly() {\n        // \n        Node node = addConditionWaiter();\n        // \n        int savedState = fullyRelease(node);\n        boolean interrupted = false;\n        while (!isOnSyncQueue(node)) { // \n            // \n            LockSupport.park(this);\n            if (Thread.interrupted()) // \n                // interrupted\n                interrupted = true; \n        }\n        if (acquireQueued(node, savedState) || interrupted) // \n            selfInterrupt();\n    }\n\n    /*\n        * For interruptible waits, we need to track whether to throw\n        * InterruptedException, if interrupted while blocked on\n        * condition, versus reinterrupt current thread, if\n        * interrupted while blocked waiting to re-acquire.\n        */\n\n    /** Mode meaning to reinterrupt on exit from wait */\n    private static final int REINTERRUPT =  1;\n    /** Mode meaning to throw InterruptedException on exit from wait */\n    private static final int THROW_IE    = -1;\n\n    /**\n        * Checks for interrupt, returning THROW_IE if interrupted\n        * before signalled, REINTERRUPT if after signalled, or\n        * 0 if not interrupted.\n        */\n    private int checkInterruptWhileWaiting(Node node) {\n        return Thread.interrupted() ?\n            (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :\n            0; \n    }\n\n    /**\n        * Throws InterruptedException, reinterrupts current thread, or\n        * does nothing, depending on mode.\n        */\n    private void reportInterruptAfterWait(int interruptMode)\n        throws InterruptedException {\n        if (interruptMode == THROW_IE)\n            throw new InterruptedException();\n        else if (interruptMode == REINTERRUPT)\n            selfInterrupt();\n    }\n\n    /**\n        * Implements interruptible condition wait.\n        * <ol>\n        * <li> If current thread is interrupted, throw InterruptedException.\n        * <li> Save lock state returned by {@link #getState}.\n        * <li> Invoke {@link #release} with saved state as argument,\n        *      throwing IllegalMonitorStateException if it fails.\n        * <li> Block until signalled or interrupted.\n        * <li> Reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> If interrupted while blocked in step 4, throw InterruptedException.\n        * </ol>\n        */\n    // // \n    public final void await() throws InterruptedException {\n        if (Thread.interrupted()) // \n            throw new InterruptedException();\n        // wait\n        Node node = addConditionWaiter();\n        // \n        int savedState = fullyRelease(node);\n        int interruptMode = 0;\n        while (!isOnSyncQueue(node)) {\n            // \n            LockSupport.park(this);\n            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) // \n                break;\n        }\n        if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n            interruptMode = REINTERRUPT;\n        if (node.nextWaiter != null) // clean up if cancelled\n            unlinkCancelledWaiters();\n        if (interruptMode != 0)\n            reportInterruptAfterWait(interruptMode);\n    }\n\n    /**\n        * Implements timed condition wait.\n        * <ol>\n        * <li> If current thread is interrupted, throw InterruptedException.\n        * <li> Save lock state returned by {@link #getState}.\n        * <li> Invoke {@link #release} with saved state as argument,\n        *      throwing IllegalMonitorStateException if it fails.\n        * <li> Block until signalled, interrupted, or timed out.\n        * <li> Reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> If interrupted while blocked in step 4, throw InterruptedException.\n        * </ol>\n        */\n    //  \n    public final long awaitNanos(long nanosTimeout)\n            throws InterruptedException {\n        if (Thread.interrupted())\n            throw new InterruptedException();\n        Node node = addConditionWaiter();\n        int savedState = fullyRelease(node);\n        final long deadline = System.nanoTime() + nanosTimeout;\n        int interruptMode = 0;\n        while (!isOnSyncQueue(node)) {\n            if (nanosTimeout <= 0L) {\n                transferAfterCancelledWait(node);\n                break;\n            }\n            if (nanosTimeout >= spinForTimeoutThreshold)\n                LockSupport.parkNanos(this, nanosTimeout);\n            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n                break;\n            nanosTimeout = deadline - System.nanoTime();\n        }\n        if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n            interruptMode = REINTERRUPT;\n        if (node.nextWaiter != null)\n            unlinkCancelledWaiters();\n        if (interruptMode != 0)\n            reportInterruptAfterWait(interruptMode);\n        return deadline - System.nanoTime();\n    }\n\n    /**\n        * Implements absolute timed condition wait.\n        * <ol>\n        * <li> If current thread is interrupted, throw InterruptedException.\n        * <li> Save lock state returned by {@link #getState}.\n        * <li> Invoke {@link #release} with saved state as argument,\n        *      throwing IllegalMonitorStateException if it fails.\n        * <li> Block until signalled, interrupted, or timed out.\n        * <li> Reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> If interrupted while blocked in step 4, throw InterruptedException.\n        * <li> If timed out while blocked in step 4, return false, else true.\n        * </ol>\n        */\n    // \n    public final boolean awaitUntil(Date deadline)\n            throws InterruptedException {\n        long abstime = deadline.getTime();\n        if (Thread.interrupted())\n            throw new InterruptedException();\n        Node node = addConditionWaiter();\n        int savedState = fullyRelease(node);\n        boolean timedout = false;\n        int interruptMode = 0;\n        while (!isOnSyncQueue(node)) {\n            if (System.currentTimeMillis() > abstime) {\n                timedout = transferAfterCancelledWait(node);\n                break;\n            }\n            LockSupport.parkUntil(this, abstime);\n            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n                break;\n        }\n        if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n            interruptMode = REINTERRUPT;\n        if (node.nextWaiter != null)\n            unlinkCancelledWaiters();\n        if (interruptMode != 0)\n            reportInterruptAfterWait(interruptMode);\n        return !timedout;\n    }\n\n    /**\n        * Implements timed condition wait.\n        * <ol>\n        * <li> If current thread is interrupted, throw InterruptedException.\n        * <li> Save lock state returned by {@link #getState}.\n        * <li> Invoke {@link #release} with saved state as argument,\n        *      throwing IllegalMonitorStateException if it fails.\n        * <li> Block until signalled, interrupted, or timed out.\n        * <li> Reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> If interrupted while blocked in step 4, throw InterruptedException.\n        * <li> If timed out while blocked in step 4, return false, else true.\n        * </ol>\n        */\n    // : awaitNanos(unit.toNanos(time)) > 0\n    public final boolean await(long time, TimeUnit unit)\n            throws InterruptedException {\n        long nanosTimeout = unit.toNanos(time);\n        if (Thread.interrupted())\n            throw new InterruptedException();\n        Node node = addConditionWaiter();\n        int savedState = fullyRelease(node);\n        final long deadline = System.nanoTime() + nanosTimeout;\n        boolean timedout = false;\n        int interruptMode = 0;\n        while (!isOnSyncQueue(node)) {\n            if (nanosTimeout <= 0L) {\n                timedout = transferAfterCancelledWait(node);\n                break;\n            }\n            if (nanosTimeout >= spinForTimeoutThreshold)\n                LockSupport.parkNanos(this, nanosTimeout);\n            if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n                break;\n            nanosTimeout = deadline - System.nanoTime();\n        }\n        if (acquireQueued(node, savedState) && interruptMode != THROW_IE)\n            interruptMode = REINTERRUPT;\n        if (node.nextWaiter != null)\n            unlinkCancelledWaiters();\n        if (interruptMode != 0)\n            reportInterruptAfterWait(interruptMode);\n        return !timedout;\n    }\n\n    //  support for instrumentation\n\n    /**\n        * Returns true if this condition was created by the given\n        * synchronization object.\n        *\n        * @return {@code true} if owned\n        */\n    final boolean isOwnedBy(AbstractQueuedSynchronizer sync) {\n        return sync == AbstractQueuedSynchronizer.this;\n    }\n\n    /**\n        * Queries whether any threads are waiting on this condition.\n        * Implements {@link AbstractQueuedSynchronizer#hasWaiters(ConditionObject)}.\n        *\n        * @return {@code true} if there are any waiting threads\n        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}\n        *         returns {@code false}\n        */\n    //  \n    protected final boolean hasWaiters() {\n        if (!isHeldExclusively())\n            throw new IllegalMonitorStateException();\n        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {\n            if (w.waitStatus == Node.CONDITION)\n                return true;\n        }\n        return false;\n    }\n\n    /**\n        * Returns an estimate of the number of threads waiting on\n        * this condition.\n        * Implements {@link AbstractQueuedSynchronizer#getWaitQueueLength(ConditionObject)}.\n        *\n        * @return the estimated number of waiting threads\n        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}\n        *         returns {@code false}\n        */\n    // \n    protected final int getWaitQueueLength() {\n        if (!isHeldExclusively())\n            throw new IllegalMonitorStateException();\n        int n = 0;\n        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {\n            if (w.waitStatus == Node.CONDITION)\n                ++n;\n        }\n        return n;\n    }\n\n    /**\n        * Returns a collection containing those threads that may be\n        * waiting on this Condition.\n        * Implements {@link AbstractQueuedSynchronizer#getWaitingThreads(ConditionObject)}.\n        *\n        * @return the collection of threads\n        * @throws IllegalMonitorStateException if {@link #isHeldExclusively}\n        *         returns {@code false}\n        */\n    // \n    protected final Collection<Thread> getWaitingThreads() {\n        if (!isHeldExclusively())\n            throw new IllegalMonitorStateException();\n        ArrayList<Thread> list = new ArrayList<Thread>();\n        for (Node w = firstWaiter; w != null; w = w.nextWaiter) {\n            if (w.waitStatus == Node.CONDITION) {\n                Thread t = w.thread;\n                if (t != null)\n                    list.add(t);\n            }\n        }\n        return list;\n    }\n}\n\n\nConditionCondition\n\npublic interface Condition {\n\n    // \n    void await() throws InterruptedException;\n    \n    // \n    void awaitUninterruptibly();\n    \n    // \n    long awaitNanos(long nanosTimeout) throws InterruptedException;\n    \n    // : awaitNanos(unit.toNanos(time)) > 0\n    boolean await(long time, TimeUnit unit) throws InterruptedException;\n    \n    // \n    boolean awaitUntil(Date deadline) throws InterruptedException;\n    \n    //  await \n    void signal();\n    \n    //  await \n    void signalAll();\n}\n\n\nConditionawaitsignalCondtionObject\n\n\n# \n\nheadtailstatespinForTimeoutThresholdAbstractQueuedSynchronizer\n\npublic abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer\n    implements java.io.Serializable {    \n    // \n    private static final long serialVersionUID = 7373984972572414691L;    \n    // \n    private transient volatile Node head;    \n    // \n    private transient volatile Node tail;    \n    // \n    private volatile int state;    \n    // \n    static final long spinForTimeoutThreshold = 1000L;\n    \n    // Unsafe\n    private static final Unsafe unsafe = Unsafe.getUnsafe();\n    // state\n    private static final long stateOffset;\n    // head\n    private static final long headOffset;\n    // state\n    private static final long tailOffset;\n    // tail\n    private static final long waitStatusOffset;\n    // next\n    private static final long nextOffset;\n    // \n    static {\n        try {\n            stateOffset = unsafe.objectFieldOffset\n                (AbstractQueuedSynchronizer.class.getDeclaredField("state"));\n            headOffset = unsafe.objectFieldOffset\n                (AbstractQueuedSynchronizer.class.getDeclaredField("head"));\n            tailOffset = unsafe.objectFieldOffset\n                (AbstractQueuedSynchronizer.class.getDeclaredField("tail"));\n            waitStatusOffset = unsafe.objectFieldOffset\n                (Node.class.getDeclaredField("waitStatus"));\n            nextOffset = unsafe.objectFieldOffset\n                (Node.class.getDeclaredField("next"));\n\n        } catch (Exception ex) { throw new Error(ex); }\n    }\n}\n\n\n\n# \n\n\n\nprotected AbstractQueuedSynchronizer() { }    \n\n\n\n#  - acquire\n\n()aquire:\n\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n\n\nacquire\n\n\n\n * tryAcquireAbstractQueuedSynchronizer\n\n * tryAcquireaddWaiteraddWaiterSync queue\n\n * acquireQueuedSync queuetruefalse\n\n * tryAcquire\n\naddWaiter\n\n// \nprivate Node addWaiter(Node mode) {\n    // \n    Node node = new Node(Thread.currentThread(), mode);\n    // Try the fast path of enq; backup to full enq on failure\n    // \n    Node pred = tail;\n    if (pred != null) { // \n        // nodeprev\n        node.prev = pred; \n        if (compareAndSetTail(pred, node)) { // prednode \n            // nextnode\n            pred.next = node;\n            return node; // \n        }\n    }\n    enq(node); // ()compareAndSetTail\n    return node;\n}\n\n\naddWaitersync queuesync queueenqenq\n\nprivate Node enq(final Node node) {\n    for (;;) { // \n        // \n        Node t = tail;\n        if (t == null) { // \n            if (compareAndSetHead(new Node())) // \n                tail = head; // \n        } else { // \n            // nodeprev\n            node.prev = t; \n            if (compareAndSetTail(t, node)) { // tnode\n                // nextnode\n                t.next = node; \n                return t; // \n            }\n        }\n    }\n}\n\n\nenq\n\nacquireQueue\n\n// sync()\nfinal boolean acquireQueued(final Node node, int arg) {\n    // \n    boolean failed = true;\n    try {\n        // \n        boolean interrupted = false;\n        for (;;) { // \n            // node\n            final Node p = node.predecessor(); \n            if (p == head && tryAcquire(arg)) { // \n                setHead(node); // \n                p.next = null; // help GC\n                failed = false; // \n                return interrupted; \n            }\n            if (shouldParkAfterFailedAcquire(p, node) &&\n                parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n\n\n()shouldParkAfterFailedAcquireparkAndCheckInterruptshouldParkAfterFailedAcquire\n\n// ()\nprivate static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n    // \n    int ws = pred.waitStatus;\n    if (ws == Node.SIGNAL) // SIGNAL-1\n        /*\n            * This node has already set status asking a release\n            * to signal it, so it can safely park.\n            */\n        // park\n        return true; \n    if (ws > 0) { // CANCELLED1\n        /*\n            * Predecessor was cancelled. Skip over predecessors and\n            * indicate retry.\n            */\n        do {\n            node.prev = pred = pred.prev;\n        } while (pred.waitStatus > 0); // predCANCELLED\n        // prednext\n        pred.next = node; \n    } else { // PROPAGATE -3 0 ,(CONDITION -2condition queue) \n        /*\n            * waitStatus must be 0 or PROPAGATE.  Indicate that we\n            * need a signal, but don\'t park yet.  Caller will need to\n            * retry to make sure it cannot acquire before parking.\n            */\n        // SIGNAL\n        compareAndSetWaitStatus(pred, ws, Node.SIGNAL); \n    }\n    // park\n    return false;\n}\n\n\nSIGNALparkparkparkAndCheckInterrupt\n\n// park\nprivate final boolean parkAndCheckInterrupt() {\n    // blocker\n    LockSupport.park(this);\n    return Thread.interrupted(); // \n}\n\n\nparkAndCheckInterruptparkfinalcancelAcquire\n\n// ()\nprivate void cancelAcquire(Node node) {\n    // Ignore if node doesn\'t exist\n    // node\n    if (node == null)\n        return;\n    // nodethread\n    node.thread = null;\n\n    // Skip cancelled predecessors\n    // node\n    Node pred = node.prev;\n    while (pred.waitStatus > 0) // node0CANCELLED\n        node.prev = pred = pred.prev;\n\n    // predNext is the apparent node to unsplice. CASes below will\n    // fail if not, in which case, we lost race vs another cancel\n    // or signal, so no further action is necessary.\n    // pred\n    Node predNext = pred.next;\n\n    // Can use unconditional write instead of CAS here.\n    // After this atomic step, other Nodes can skip past us.\n    // Before, we are free of interference from other threads.\n    // nodeCANCELLED\n    node.waitStatus = Node.CANCELLED;\n\n    // If we are the tail, remove ourselves.\n    if (node == tail && compareAndSetTail(node, pred)) { // nodepred\n        // prednextnull\n        compareAndSetNext(pred, predNext, null); \n    } else { // node\n        // If successor needs signal, try to set pred\'s next-link\n        // so it will get one. Otherwise wake it up to propagate.\n        int ws;\n        if (pred != head &&\n            ((ws = pred.waitStatus) == Node.SIGNAL ||\n                (ws <= 0 && compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &&\n            pred.thread != null) { // (predpredSIGNAL) \n                                // pred0SIGNALpred\n            // \n            Node next = node.next;\n            if (next != null && next.waitStatus <= 0) // 0\n                compareAndSetNext(pred, predNext, next); // pred.next = next;\n        } else {\n            unparkSuccessor(node); // node\n        }\n\n        node.next = node; // help GC\n    }\n}\n\n\nCANCELLEDunparkSuccessor\n\n// \nprivate void unparkSuccessor(Node node) {\n    /*\n        * If status is negative (i.e., possibly needing signal) try\n        * to clear in anticipation of signalling.  It is OK if this\n        * fails or if status is changed by waiting thread.\n        */\n    // node\n    int ws = node.waitStatus;\n    if (ws < 0) // 0SIGNAL -1  CONDITION -2  PROPAGATE -3\n        // 0\n        compareAndSetWaitStatus(node, ws, 0);\n\n    /*\n        * Thread to unpark is held in successor, which is normally\n        * just the next node.  But if cancelled or apparently null,\n        * traverse backwards from tail to find the actual\n        * non-cancelled successor.\n        */\n    // node\n    Node s = node.next;\n    if (s == null || s.waitStatus > 0) { // 0CANCELLED\n        // s\n        s = null; \n        // \n        for (Node t = tail; t != null && t != node; t = t.prev)\n            if (t.waitStatus <= 0) // 00\n                // \n                s = t;\n    }\n    if (s != null) // \n        LockSupport.unpark(s.thread);\n}\n\n\nnode\n\ncancelAcquireunparkSuccessor:\n\n\n\nnodecancelAcquireunparkst4\n\nacquireQueued:\n\n * head()\n * 1headfinally\n * 2parkparkSIGNALparkpark\n * parkunpark\n\n\n#  - release\n\n:\n\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) { // \n        // \n        Node h = head; \n        if (h != null && h.waitStatus != 0) // 0\n            unparkSuccessor(h); //\n        return true;\n    }\n    return false;\n}\n\n\ntryReleasetryRelease0unparkSuccessor\n\n\n\n\n# AbstractQueuedSynchronizer\n\nAbstractQueuedSyncrhonizer\n\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\nclass MyThread extends Thread {\n    private Lock lock;\n    public MyThread(String name, Lock lock) {\n        super(name);\n        this.lock = lock;\n    }\n    \n    public void run () {\n        lock.lock();\n        try {\n            System.out.println(Thread.currentThread() + " running");\n        } finally {\n            lock.unlock();\n        }\n    }\n}\npublic class AbstractQueuedSynchronizerDemo {\n    public static void main(String[] args) {\n        Lock lock = new ReentrantLock();\n        \n        MyThread t1 = new MyThread("t1", lock);\n        MyThread t2 = new MyThread("t2", lock);\n        t1.start();\n        t2.start();    \n    }\n}\n\n\n():\n\nThread[t1,5,main] running\nThread[t2,5,main] running\n\n\n: t1t2lock\n\n\n\n: t1lock.lockt2lock.lockt1lock.unlockt2lock.unlockAbstractQueuedSynchronizer\n\n * t1lock.lock\n\n\n\n: AQSAbstractQueuedSynchronizerAOSAbstractOwnableSynchronizer\n\n * t2lock.lock\n\n\n\n: t2LockSupport.park\n\n * t1lock.unlock\n\n\n\n: t1lock.unlockLockSupport.unparkt2t2LockSupport.park\n\n\n\n: LockSupport.unparkt2parkAndCheckInterruptacquireQueuedheadtailt2sync\n\n * t2lock.unlock\n\n\n\n: t2lock.unlock\n\n\n# AbstractQueuedSynchronizer\n\nConditionAbstractQueuedSynchronizer\n\n * Depot()\n\nimport java.util.concurrent.locks.Condition;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class Depot {\n    private int size;\n    private int capacity;\n    private Lock lock;\n    private Condition fullCondition;\n    private Condition emptyCondition;\n    \n    public Depot(int capacity) {\n        this.capacity = capacity;    \n        lock = new ReentrantLock();\n        fullCondition = lock.newCondition();\n        emptyCondition = lock.newCondition();\n    }\n    \n    public void produce(int no) {\n        lock.lock();\n        int left = no;\n        try {\n            while (left > 0) {\n                while (size >= capacity)  {\n                    System.out.println(Thread.currentThread() + " before await");\n                    fullCondition.await();\n                    System.out.println(Thread.currentThread() + " after await");\n                }\n                int inc = (left + size) > capacity ? (capacity - size) : left;\n                left -= inc;\n                size += inc;\n                System.out.println("produce = " + inc + ", size = " + size);\n                emptyCondition.signal();\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public void consume(int no) {\n        lock.lock();\n        int left = no;\n        try {            \n            while (left > 0) {\n                while (size <= 0) {\n                    System.out.println(Thread.currentThread() + " before await");\n                    emptyCondition.await();\n                    System.out.println(Thread.currentThread() + " after await");\n                }\n                int dec = (size - left) > 0 ? left : size;\n                left -= dec;\n                size -= dec;\n                System.out.println("consume = " + dec + ", size = " + size);\n                fullCondition.signal();\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\n\n * \n\nclass Consumer {\n    private Depot depot;\n    public Consumer(Depot depot) {\n        this.depot = depot;\n    }\n    \n    public void consume(int no) {\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                depot.consume(no);\n            }\n        }, no + " consume thread").start();\n    }\n}\n\nclass Producer {\n    private Depot depot;\n    public Producer(Depot depot) {\n        this.depot = depot;\n    }\n    \n    public void produce(int no) {\n        new Thread(new Runnable() {\n            \n            @Override\n            public void run() {\n                depot.produce(no);\n            }\n        }, no + " produce thread").start();\n    }\n}\n\npublic class ReentrantLockDemo {\n    public static void main(String[] args) throws InterruptedException {\n        Depot depot = new Depot(500);\n        new Producer(depot).produce(500);\n        new Producer(depot).produce(200);\n        new Consumer(depot).consume(500);\n        new Consumer(depot).consume(200);\n    }\n}\n\n\n * ():\n\nproduce = 500, size = 500\nThread[200 produce thread,5,main] before await\nconsume = 500, size = 0\nThread[200 consume thread,5,main] before await\nThread[200 produce thread,5,main] after await\nproduce = 200, size = 200\nThread[200 consume thread,5,main] after await\nconsume = 200, size = 0\n\n\n: \n\n\n\n: p1produce 500p2produce 200c1consume 500c2consume 200\n\n * p1lock.lock\n * p2lock.lock\n\n\n\n: p2lock.lockp2LockSupport.park\n\n * c1lock.lock\n\n\n\n: c1sync queue(p2)waitStatusSIGNAL\n\n * c2lock.lock\n\n\n\n: c1sync queue(c1)waitStatusSIGNAL\n\n * p1emptyCondition.signal\n\n\n\n: AQS.COAbstractQueuedSynchronizer.ConditionObjectsignal\n\n * p1lock.unlock\n\n\n\n: p2(c1c2)p2\n\n * p2fullCondition.await\n\n\n\n: p2condition queuesync queuep2LockSupport.parkawaitheadc1c1\n\n * c1c1parkacquireQueuedc1head\n\n\n\n: headc1c1\n\n * c1fullCondtion.signal\n\n\n\n: signalp2condition queuesync queuecondition queuenullSIGNAL\n\n * c1lock.unlock\n\n\n\n: c2\n\n * c2emptyCondition.await\n\n\n\n: awaitcondition queuecondition queueunparkp2\n\n * p2unparkCPUp2p2AQS:awaitparkAQS.CO:await\n\n\n\n * p2emptyCondition.signal\n\n\n\n: condition queuesync queuecondition queueheadSIGNAL\n\n * p2lock.unlock\n\n\n\n: unlockc2c2\n\n * c2fullCondition. signalfullConditioncondition queue\n\n * c2lock.unlockc2syncunparkSuccessortrue\n\n\n# AbstractQueuedSynchronizer\n\nAbstractQueuedSynchronizersync queue\n\n * \n * head\n * condition queuesync queuesignal\n * SIGNAL\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5350186.html\n * http://ifeve.com/introduce-abstractqueuedsynchronizer/\n * http://blog.csdn.net/chen77716/article/details/6641477\n * https://blog.csdn.net/mulinsen77/article/details/84583716\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html',normalizedContent:'# juc: aqs\n\n> abstractqueuedsynchronizerfifo\n\n * juc: aqs\n   * bat\n   * abstractqueuedsynchronizer\n     * aqs \n     * aqs \n     * aqs\n   * abstractqueuedsynchronizer\n   * abstractqueuedsynchronizer\n     * \n     *  - node\n     *  - conditionobject\n     * \n     * \n     *  - acquire\n     *  - release\n   * abstractqueuedsynchronizer\n   * abstractqueuedsynchronizer\n   * abstractqueuedsynchronizer\n   * \n\n\n# bat\n\n\n\n\n\n * aqs? ?\n * aqs? ? \n * aqs?\n * aqs? aqs(reentrantlock) (semaphorecountdownlatch cyclicbarrier )reentrantreadwritelock\n * aqs? \n * aqs?\n\n\n# abstractqueuedsynchronizer\n\naqsaqsreentrantlocksemaphorereentrantreadwritelocksynchronousqueuefuturetaskaqsaqs\n\n\n# aqs \n\naqsaqsclh\n\n> clh(craig,landin,and hagersten)()aqsclh(node)\n\naqsintfifoaqscas\n\nprivate volatile int state;//volatile\n\n\nproctedgetstatesetstatecompareandsetstate\n\n//\nprotected final int getstate() {  \n        return state;\n}\n // \nprotected final void setstate(int newstate) { \n        state = newstate;\n}\n//(cas)updateexpect()\nprotected final boolean compareandsetstate(int expect, int update) {\n        return unsafe.compareandswapint(this, stateoffset, expect, update);\n}\n\n\n\n# aqs \n\naqs\n\n * exclusive()reentrantlock\n   * \n   * \n * share()semaphore/countdownlatchsemaphorecountdownlatch cyclicbarrierreadwritelock \n\nreentrantreadwritelock reentrantreadwritelock\n\n state (/)aqs\n\n\n# aqs\n\n> ()\n\nabstractqueuedsynchronizer(state) aqs\n\n - (template method)\n\naqsaqs\n\nisheldexclusively()//condition\ntryacquire(int)//truefalse\ntryrelease(int)//truefalse\ntryacquireshared(int)//0\ntryreleaseshared(int)//truefalse\n\n\n unsupportedoperationexception aqsfinal \n\nreentrantlockstate0alock()tryacquire()state+1tryacquire()aunlock()state=0()a(state)state\n\n\n# abstractqueuedsynchronizer\n\nabstractqueuedsynchronizerclh(craig,landin,and hagersten)()aqsclh(node)sync queueheadtailheadcondition queueconditioncondition queue\n\n\n\n\n# abstractqueuedsynchronizer\n\n\n# \n\nabstractqueuedsynchronizerabstractownablesynchronizerserializable\n\npublic abstract class abstractqueuedsynchronizer extends abstractownablesynchronizer implements java.io.serializable\n\n\nabstractownablesynchronizer:\n\npublic abstract class abstractownablesynchronizer implements java.io.serializable {\n    \n    // \n    private static final long serialversionuid = 3737899427754241961l;\n    // \n    protected abstractownablesynchronizer() { }\n    // \n    private transient thread exclusiveownerthread;\n    \n    //  \n    protected final void setexclusiveownerthread(thread thread) {\n        exclusiveownerthread = thread;\n    }\n    \n    //  \n    protected final thread getexclusiveownerthread() {\n        return exclusiveownerthread;\n    }\n}\n\n\nabstractownablesynchronizersetexclusiveownerthreadgetexclusiveownerthread\n\n> abstractqueuedsynchronizernodeconditionobject\n\n\n#  - node\n\nstatic final class node {\n    // \n    // \n    static final node shared = new node();\n    // \n    static final node exclusive = null;        \n    // \n    // cancelled1\n    // signal-1unpark\n    // condition-2conditioncondition\n    // propagate-3acquireshared\n    // 0sync\n    static final int cancelled =  1;\n    static final int signal    = -1;\n    static final int condition = -2;\n    static final int propagate = -3;        \n\n    // \n    volatile int waitstatus;        \n    // \n    volatile node prev;    \n    // \n    volatile node next;        \n    // \n    volatile thread thread;        \n    // \n    node nextwaiter;\n    \n    // \n    final boolean isshared() {\n        return nextwaiter == shared;\n    }\n    \n    // \n    final node predecessor() throws nullpointerexception {\n        // \n        node p = prev; \n        if (p == null) // \n            throw new nullpointerexception();\n        else // \n            return p;\n    }\n    \n    // \n    node() {    // used to establish initial head or shared marker\n    }\n    \n    // \n        node(thread thread, node mode) {    // used by addwaiter\n        this.nextwaiter = mode;\n        this.thread = thread;\n    }\n    \n    // \n    node(thread thread, int waitstatus) { // used by condition\n        this.waitstatus = waitstatus;\n        this.thread = thread;\n    }\n}\n\n\nnodethread\n\n * cancelled1\n\n * signal-1unpark\n\n * condition-2conditioncondition queue\n\n * propagate-3acquireshared\n\n * 0sync queue\n\n\n#  - conditionobject\n\n:\n\n// \npublic class conditionobject implements condition, java.io.serializable {\n    // \n    private static final long serialversionuid = 1173984872572414699l;\n    /** first node of condition queue. */\n    // condition\n    private transient node firstwaiter;\n    /** last node of condition queue. */\n    // condition\n    private transient node lastwaiter;\n\n    /**\n        * creates a new {@code conditionobject} instance.\n        */\n    // \n    public conditionobject() { }\n\n    // internal methods\n\n    /**\n        * adds a new waiter to wait queue.\n        * @return its new wait node\n        */\n    // waiterwait\n    private node addconditionwaiter() {\n        // \n        node t = lastwaiter;\n        // if lastwaiter is cancelled, clean out.\n        if (t != null && t.waitstatus != node.condition) { // condition\n            // condition\n            unlinkcancelledwaiters(); \n            // t\n            t = lastwaiter;\n        }\n        // \n        node node = new node(thread.currentthread(), node.condition);\n        if (t == null) // \n            // condition\n            firstwaiter = node;\n        else // \n            // nextwaiternode\n            t.nextwaiter = node;\n        // condition\n        lastwaiter = node;\n        return node;\n    }\n\n    /**\n        * removes and transfers nodes until hit non-cancelled one or\n        * null. split out from signal in part to encourage compilers\n        * to inline the case of no waiters.\n        * @param first (non-null) the first node on condition queue\n        */\n    private void dosignal(node first) {\n        // \n        do {\n            if ( (firstwaiter = first.nextwaiter) == null) // nextwaiter\n                // \n                lastwaiter = null;\n            // firstnextwaiter\n            first.nextwaiter = null;\n        } while (!transferforsignal(first) &&\n                    (first = firstwaiter) != null); // conditionsynccondition\n    }\n\n    /**\n        * removes and transfers all nodes.\n        * @param first (non-null) the first node on condition queue\n        */\n    private void dosignalall(node first) {\n        // condition\n        lastwaiter = firstwaiter = null;\n        // \n        do {\n            // firstnextwaiter\n            node next = first.nextwaiter;\n            // firstnextwaiter\n            first.nextwaiter = null;\n            // firstconditionsync\n            transferforsignal(first);\n            // first\n            first = next;\n        } while (first != null);\n    }\n\n    /**\n        * unlinks cancelled waiter nodes from condition queue.\n        * called only while holding lock. this is called when\n        * cancellation occurred during condition wait, and upon\n        * insertion of a new waiter when lastwaiter is seen to have\n        * been cancelled. this method is needed to avoid garbage\n        * retention in the absence of signals. so even though it may\n        * require a full traversal, it comes into play only when\n        * timeouts or cancellations occur in the absence of\n        * signals. it traverses all nodes rather than stopping at a\n        * particular target to unlink all pointers to garbage nodes\n        * without requiring many re-traversals during cancellation\n        * storms.\n        */\n    // conditioncancel\n    private void unlinkcancelledwaiters() {\n        // condition\n        node t = firstwaiter;\n        node trail = null;\n        while (t != null) { // t\n            // \n            node next = t.nextwaiter;\n            if (t.waitstatus != node.condition) { // tcondtion\n                // tnextwaiter\n                t.nextwaiter = null;\n                if (trail == null) // trail\n                    // condition\n                    firstwaiter = next;\n                else // trail\n                    // trailnextwaiternext\n                    trail.nextwaiter = next;\n                if (next == null) // next\n                    // condition\n                    lastwaiter = trail;\n            }\n            else // tcondtion\n                // trail\n                trail = t;\n            // t\n            t = next;\n        }\n    }\n\n    // public methods\n\n    /**\n        * moves the longest-waiting thread, if one exists, from the\n        * wait queue for this condition to the wait queue for the\n        * owning lock.\n        *\n        * @throws illegalmonitorstateexception if {@link #isheldexclusively}\n        *         returns {@code false}\n        */\n    //  await \n    public final void signal() {\n        if (!isheldexclusively()) // \n            throw new illegalmonitorstateexception();\n        // condition\n        node first = firstwaiter;\n        if (first != null) // \n            // \n            dosignal(first);\n    }\n\n    /**\n        * moves all threads from the wait queue for this condition to\n        * the wait queue for the owning lock.\n        *\n        * @throws illegalmonitorstateexception if {@link #isheldexclusively}\n        *         returns {@code false}\n        */\n    //  await \n    public final void signalall() {\n        if (!isheldexclusively()) // \n            throw new illegalmonitorstateexception();\n        // condition\n        node first = firstwaiter;\n        if (first != null) // \n            // \n            dosignalall(first);\n    }\n\n    /**\n        * implements uninterruptible condition wait.\n        * <ol>\n        * <li> save lock state returned by {@link #getstate}.\n        * <li> invoke {@link #release} with saved state as argument,\n        *      throwing illegalmonitorstateexception if it fails.\n        * <li> block until signalled.\n        * <li> reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * </ol>\n        */\n    // \n    public final void awaituninterruptibly() {\n        // \n        node node = addconditionwaiter();\n        // \n        int savedstate = fullyrelease(node);\n        boolean interrupted = false;\n        while (!isonsyncqueue(node)) { // \n            // \n            locksupport.park(this);\n            if (thread.interrupted()) // \n                // interrupted\n                interrupted = true; \n        }\n        if (acquirequeued(node, savedstate) || interrupted) // \n            selfinterrupt();\n    }\n\n    /*\n        * for interruptible waits, we need to track whether to throw\n        * interruptedexception, if interrupted while blocked on\n        * condition, versus reinterrupt current thread, if\n        * interrupted while blocked waiting to re-acquire.\n        */\n\n    /** mode meaning to reinterrupt on exit from wait */\n    private static final int reinterrupt =  1;\n    /** mode meaning to throw interruptedexception on exit from wait */\n    private static final int throw_ie    = -1;\n\n    /**\n        * checks for interrupt, returning throw_ie if interrupted\n        * before signalled, reinterrupt if after signalled, or\n        * 0 if not interrupted.\n        */\n    private int checkinterruptwhilewaiting(node node) {\n        return thread.interrupted() ?\n            (transferaftercancelledwait(node) ? throw_ie : reinterrupt) :\n            0; \n    }\n\n    /**\n        * throws interruptedexception, reinterrupts current thread, or\n        * does nothing, depending on mode.\n        */\n    private void reportinterruptafterwait(int interruptmode)\n        throws interruptedexception {\n        if (interruptmode == throw_ie)\n            throw new interruptedexception();\n        else if (interruptmode == reinterrupt)\n            selfinterrupt();\n    }\n\n    /**\n        * implements interruptible condition wait.\n        * <ol>\n        * <li> if current thread is interrupted, throw interruptedexception.\n        * <li> save lock state returned by {@link #getstate}.\n        * <li> invoke {@link #release} with saved state as argument,\n        *      throwing illegalmonitorstateexception if it fails.\n        * <li> block until signalled or interrupted.\n        * <li> reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> if interrupted while blocked in step 4, throw interruptedexception.\n        * </ol>\n        */\n    // // \n    public final void await() throws interruptedexception {\n        if (thread.interrupted()) // \n            throw new interruptedexception();\n        // wait\n        node node = addconditionwaiter();\n        // \n        int savedstate = fullyrelease(node);\n        int interruptmode = 0;\n        while (!isonsyncqueue(node)) {\n            // \n            locksupport.park(this);\n            if ((interruptmode = checkinterruptwhilewaiting(node)) != 0) // \n                break;\n        }\n        if (acquirequeued(node, savedstate) && interruptmode != throw_ie)\n            interruptmode = reinterrupt;\n        if (node.nextwaiter != null) // clean up if cancelled\n            unlinkcancelledwaiters();\n        if (interruptmode != 0)\n            reportinterruptafterwait(interruptmode);\n    }\n\n    /**\n        * implements timed condition wait.\n        * <ol>\n        * <li> if current thread is interrupted, throw interruptedexception.\n        * <li> save lock state returned by {@link #getstate}.\n        * <li> invoke {@link #release} with saved state as argument,\n        *      throwing illegalmonitorstateexception if it fails.\n        * <li> block until signalled, interrupted, or timed out.\n        * <li> reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> if interrupted while blocked in step 4, throw interruptedexception.\n        * </ol>\n        */\n    //  \n    public final long awaitnanos(long nanostimeout)\n            throws interruptedexception {\n        if (thread.interrupted())\n            throw new interruptedexception();\n        node node = addconditionwaiter();\n        int savedstate = fullyrelease(node);\n        final long deadline = system.nanotime() + nanostimeout;\n        int interruptmode = 0;\n        while (!isonsyncqueue(node)) {\n            if (nanostimeout <= 0l) {\n                transferaftercancelledwait(node);\n                break;\n            }\n            if (nanostimeout >= spinfortimeoutthreshold)\n                locksupport.parknanos(this, nanostimeout);\n            if ((interruptmode = checkinterruptwhilewaiting(node)) != 0)\n                break;\n            nanostimeout = deadline - system.nanotime();\n        }\n        if (acquirequeued(node, savedstate) && interruptmode != throw_ie)\n            interruptmode = reinterrupt;\n        if (node.nextwaiter != null)\n            unlinkcancelledwaiters();\n        if (interruptmode != 0)\n            reportinterruptafterwait(interruptmode);\n        return deadline - system.nanotime();\n    }\n\n    /**\n        * implements absolute timed condition wait.\n        * <ol>\n        * <li> if current thread is interrupted, throw interruptedexception.\n        * <li> save lock state returned by {@link #getstate}.\n        * <li> invoke {@link #release} with saved state as argument,\n        *      throwing illegalmonitorstateexception if it fails.\n        * <li> block until signalled, interrupted, or timed out.\n        * <li> reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> if interrupted while blocked in step 4, throw interruptedexception.\n        * <li> if timed out while blocked in step 4, return false, else true.\n        * </ol>\n        */\n    // \n    public final boolean awaituntil(date deadline)\n            throws interruptedexception {\n        long abstime = deadline.gettime();\n        if (thread.interrupted())\n            throw new interruptedexception();\n        node node = addconditionwaiter();\n        int savedstate = fullyrelease(node);\n        boolean timedout = false;\n        int interruptmode = 0;\n        while (!isonsyncqueue(node)) {\n            if (system.currenttimemillis() > abstime) {\n                timedout = transferaftercancelledwait(node);\n                break;\n            }\n            locksupport.parkuntil(this, abstime);\n            if ((interruptmode = checkinterruptwhilewaiting(node)) != 0)\n                break;\n        }\n        if (acquirequeued(node, savedstate) && interruptmode != throw_ie)\n            interruptmode = reinterrupt;\n        if (node.nextwaiter != null)\n            unlinkcancelledwaiters();\n        if (interruptmode != 0)\n            reportinterruptafterwait(interruptmode);\n        return !timedout;\n    }\n\n    /**\n        * implements timed condition wait.\n        * <ol>\n        * <li> if current thread is interrupted, throw interruptedexception.\n        * <li> save lock state returned by {@link #getstate}.\n        * <li> invoke {@link #release} with saved state as argument,\n        *      throwing illegalmonitorstateexception if it fails.\n        * <li> block until signalled, interrupted, or timed out.\n        * <li> reacquire by invoking specialized version of\n        *      {@link #acquire} with saved state as argument.\n        * <li> if interrupted while blocked in step 4, throw interruptedexception.\n        * <li> if timed out while blocked in step 4, return false, else true.\n        * </ol>\n        */\n    // : awaitnanos(unit.tonanos(time)) > 0\n    public final boolean await(long time, timeunit unit)\n            throws interruptedexception {\n        long nanostimeout = unit.tonanos(time);\n        if (thread.interrupted())\n            throw new interruptedexception();\n        node node = addconditionwaiter();\n        int savedstate = fullyrelease(node);\n        final long deadline = system.nanotime() + nanostimeout;\n        boolean timedout = false;\n        int interruptmode = 0;\n        while (!isonsyncqueue(node)) {\n            if (nanostimeout <= 0l) {\n                timedout = transferaftercancelledwait(node);\n                break;\n            }\n            if (nanostimeout >= spinfortimeoutthreshold)\n                locksupport.parknanos(this, nanostimeout);\n            if ((interruptmode = checkinterruptwhilewaiting(node)) != 0)\n                break;\n            nanostimeout = deadline - system.nanotime();\n        }\n        if (acquirequeued(node, savedstate) && interruptmode != throw_ie)\n            interruptmode = reinterrupt;\n        if (node.nextwaiter != null)\n            unlinkcancelledwaiters();\n        if (interruptmode != 0)\n            reportinterruptafterwait(interruptmode);\n        return !timedout;\n    }\n\n    //  support for instrumentation\n\n    /**\n        * returns true if this condition was created by the given\n        * synchronization object.\n        *\n        * @return {@code true} if owned\n        */\n    final boolean isownedby(abstractqueuedsynchronizer sync) {\n        return sync == abstractqueuedsynchronizer.this;\n    }\n\n    /**\n        * queries whether any threads are waiting on this condition.\n        * implements {@link abstractqueuedsynchronizer#haswaiters(conditionobject)}.\n        *\n        * @return {@code true} if there are any waiting threads\n        * @throws illegalmonitorstateexception if {@link #isheldexclusively}\n        *         returns {@code false}\n        */\n    //  \n    protected final boolean haswaiters() {\n        if (!isheldexclusively())\n            throw new illegalmonitorstateexception();\n        for (node w = firstwaiter; w != null; w = w.nextwaiter) {\n            if (w.waitstatus == node.condition)\n                return true;\n        }\n        return false;\n    }\n\n    /**\n        * returns an estimate of the number of threads waiting on\n        * this condition.\n        * implements {@link abstractqueuedsynchronizer#getwaitqueuelength(conditionobject)}.\n        *\n        * @return the estimated number of waiting threads\n        * @throws illegalmonitorstateexception if {@link #isheldexclusively}\n        *         returns {@code false}\n        */\n    // \n    protected final int getwaitqueuelength() {\n        if (!isheldexclusively())\n            throw new illegalmonitorstateexception();\n        int n = 0;\n        for (node w = firstwaiter; w != null; w = w.nextwaiter) {\n            if (w.waitstatus == node.condition)\n                ++n;\n        }\n        return n;\n    }\n\n    /**\n        * returns a collection containing those threads that may be\n        * waiting on this condition.\n        * implements {@link abstractqueuedsynchronizer#getwaitingthreads(conditionobject)}.\n        *\n        * @return the collection of threads\n        * @throws illegalmonitorstateexception if {@link #isheldexclusively}\n        *         returns {@code false}\n        */\n    // \n    protected final collection<thread> getwaitingthreads() {\n        if (!isheldexclusively())\n            throw new illegalmonitorstateexception();\n        arraylist<thread> list = new arraylist<thread>();\n        for (node w = firstwaiter; w != null; w = w.nextwaiter) {\n            if (w.waitstatus == node.condition) {\n                thread t = w.thread;\n                if (t != null)\n                    list.add(t);\n            }\n        }\n        return list;\n    }\n}\n\n\nconditioncondition\n\npublic interface condition {\n\n    // \n    void await() throws interruptedexception;\n    \n    // \n    void awaituninterruptibly();\n    \n    // \n    long awaitnanos(long nanostimeout) throws interruptedexception;\n    \n    // : awaitnanos(unit.tonanos(time)) > 0\n    boolean await(long time, timeunit unit) throws interruptedexception;\n    \n    // \n    boolean awaituntil(date deadline) throws interruptedexception;\n    \n    //  await \n    void signal();\n    \n    //  await \n    void signalall();\n}\n\n\nconditionawaitsignalcondtionobject\n\n\n# \n\nheadtailstatespinfortimeoutthresholdabstractqueuedsynchronizer\n\npublic abstract class abstractqueuedsynchronizer extends abstractownablesynchronizer\n    implements java.io.serializable {    \n    // \n    private static final long serialversionuid = 7373984972572414691l;    \n    // \n    private transient volatile node head;    \n    // \n    private transient volatile node tail;    \n    // \n    private volatile int state;    \n    // \n    static final long spinfortimeoutthreshold = 1000l;\n    \n    // unsafe\n    private static final unsafe unsafe = unsafe.getunsafe();\n    // state\n    private static final long stateoffset;\n    // head\n    private static final long headoffset;\n    // state\n    private static final long tailoffset;\n    // tail\n    private static final long waitstatusoffset;\n    // next\n    private static final long nextoffset;\n    // \n    static {\n        try {\n            stateoffset = unsafe.objectfieldoffset\n                (abstractqueuedsynchronizer.class.getdeclaredfield("state"));\n            headoffset = unsafe.objectfieldoffset\n                (abstractqueuedsynchronizer.class.getdeclaredfield("head"));\n            tailoffset = unsafe.objectfieldoffset\n                (abstractqueuedsynchronizer.class.getdeclaredfield("tail"));\n            waitstatusoffset = unsafe.objectfieldoffset\n                (node.class.getdeclaredfield("waitstatus"));\n            nextoffset = unsafe.objectfieldoffset\n                (node.class.getdeclaredfield("next"));\n\n        } catch (exception ex) { throw new error(ex); }\n    }\n}\n\n\n\n# \n\n\n\nprotected abstractqueuedsynchronizer() { }    \n\n\n\n#  - acquire\n\n()aquire:\n\npublic final void acquire(int arg) {\n    if (!tryacquire(arg) && acquirequeued(addwaiter(node.exclusive), arg))\n        selfinterrupt();\n}\n\n\nacquire\n\n\n\n * tryacquireabstractqueuedsynchronizer\n\n * tryacquireaddwaiteraddwaitersync queue\n\n * acquirequeuedsync queuetruefalse\n\n * tryacquire\n\naddwaiter\n\n// \nprivate node addwaiter(node mode) {\n    // \n    node node = new node(thread.currentthread(), mode);\n    // try the fast path of enq; backup to full enq on failure\n    // \n    node pred = tail;\n    if (pred != null) { // \n        // nodeprev\n        node.prev = pred; \n        if (compareandsettail(pred, node)) { // prednode \n            // nextnode\n            pred.next = node;\n            return node; // \n        }\n    }\n    enq(node); // ()compareandsettail\n    return node;\n}\n\n\naddwaitersync queuesync queueenqenq\n\nprivate node enq(final node node) {\n    for (;;) { // \n        // \n        node t = tail;\n        if (t == null) { // \n            if (compareandsethead(new node())) // \n                tail = head; // \n        } else { // \n            // nodeprev\n            node.prev = t; \n            if (compareandsettail(t, node)) { // tnode\n                // nextnode\n                t.next = node; \n                return t; // \n            }\n        }\n    }\n}\n\n\nenq\n\nacquirequeue\n\n// sync()\nfinal boolean acquirequeued(final node node, int arg) {\n    // \n    boolean failed = true;\n    try {\n        // \n        boolean interrupted = false;\n        for (;;) { // \n            // node\n            final node p = node.predecessor(); \n            if (p == head && tryacquire(arg)) { // \n                sethead(node); // \n                p.next = null; // help gc\n                failed = false; // \n                return interrupted; \n            }\n            if (shouldparkafterfailedacquire(p, node) &&\n                parkandcheckinterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelacquire(node);\n    }\n}\n\n\n()shouldparkafterfailedacquireparkandcheckinterruptshouldparkafterfailedacquire\n\n// ()\nprivate static boolean shouldparkafterfailedacquire(node pred, node node) {\n    // \n    int ws = pred.waitstatus;\n    if (ws == node.signal) // signal-1\n        /*\n            * this node has already set status asking a release\n            * to signal it, so it can safely park.\n            */\n        // park\n        return true; \n    if (ws > 0) { // cancelled1\n        /*\n            * predecessor was cancelled. skip over predecessors and\n            * indicate retry.\n            */\n        do {\n            node.prev = pred = pred.prev;\n        } while (pred.waitstatus > 0); // predcancelled\n        // prednext\n        pred.next = node; \n    } else { // propagate -3 0 ,(condition -2condition queue) \n        /*\n            * waitstatus must be 0 or propagate.  indicate that we\n            * need a signal, but don\'t park yet.  caller will need to\n            * retry to make sure it cannot acquire before parking.\n            */\n        // signal\n        compareandsetwaitstatus(pred, ws, node.signal); \n    }\n    // park\n    return false;\n}\n\n\nsignalparkparkparkandcheckinterrupt\n\n// park\nprivate final boolean parkandcheckinterrupt() {\n    // blocker\n    locksupport.park(this);\n    return thread.interrupted(); // \n}\n\n\nparkandcheckinterruptparkfinalcancelacquire\n\n// ()\nprivate void cancelacquire(node node) {\n    // ignore if node doesn\'t exist\n    // node\n    if (node == null)\n        return;\n    // nodethread\n    node.thread = null;\n\n    // skip cancelled predecessors\n    // node\n    node pred = node.prev;\n    while (pred.waitstatus > 0) // node0cancelled\n        node.prev = pred = pred.prev;\n\n    // prednext is the apparent node to unsplice. cases below will\n    // fail if not, in which case, we lost race vs another cancel\n    // or signal, so no further action is necessary.\n    // pred\n    node prednext = pred.next;\n\n    // can use unconditional write instead of cas here.\n    // after this atomic step, other nodes can skip past us.\n    // before, we are free of interference from other threads.\n    // nodecancelled\n    node.waitstatus = node.cancelled;\n\n    // if we are the tail, remove ourselves.\n    if (node == tail && compareandsettail(node, pred)) { // nodepred\n        // prednextnull\n        compareandsetnext(pred, prednext, null); \n    } else { // node\n        // if successor needs signal, try to set pred\'s next-link\n        // so it will get one. otherwise wake it up to propagate.\n        int ws;\n        if (pred != head &&\n            ((ws = pred.waitstatus) == node.signal ||\n                (ws <= 0 && compareandsetwaitstatus(pred, ws, node.signal))) &&\n            pred.thread != null) { // (predpredsignal) \n                                // pred0signalpred\n            // \n            node next = node.next;\n            if (next != null && next.waitstatus <= 0) // 0\n                compareandsetnext(pred, prednext, next); // pred.next = next;\n        } else {\n            unparksuccessor(node); // node\n        }\n\n        node.next = node; // help gc\n    }\n}\n\n\ncancelledunparksuccessor\n\n// \nprivate void unparksuccessor(node node) {\n    /*\n        * if status is negative (i.e., possibly needing signal) try\n        * to clear in anticipation of signalling.  it is ok if this\n        * fails or if status is changed by waiting thread.\n        */\n    // node\n    int ws = node.waitstatus;\n    if (ws < 0) // 0signal -1  condition -2  propagate -3\n        // 0\n        compareandsetwaitstatus(node, ws, 0);\n\n    /*\n        * thread to unpark is held in successor, which is normally\n        * just the next node.  but if cancelled or apparently null,\n        * traverse backwards from tail to find the actual\n        * non-cancelled successor.\n        */\n    // node\n    node s = node.next;\n    if (s == null || s.waitstatus > 0) { // 0cancelled\n        // s\n        s = null; \n        // \n        for (node t = tail; t != null && t != node; t = t.prev)\n            if (t.waitstatus <= 0) // 00\n                // \n                s = t;\n    }\n    if (s != null) // \n        locksupport.unpark(s.thread);\n}\n\n\nnode\n\ncancelacquireunparksuccessor:\n\n\n\nnodecancelacquireunparkst4\n\nacquirequeued:\n\n * head()\n * 1headfinally\n * 2parkparksignalparkpark\n * parkunpark\n\n\n#  - release\n\n:\n\npublic final boolean release(int arg) {\n    if (tryrelease(arg)) { // \n        // \n        node h = head; \n        if (h != null && h.waitstatus != 0) // 0\n            unparksuccessor(h); //\n        return true;\n    }\n    return false;\n}\n\n\ntryreleasetryrelease0unparksuccessor\n\n\n\n\n# abstractqueuedsynchronizer\n\nabstractqueuedsyncrhonizer\n\nimport java.util.concurrent.locks.lock;\nimport java.util.concurrent.locks.reentrantlock;\n\nclass mythread extends thread {\n    private lock lock;\n    public mythread(string name, lock lock) {\n        super(name);\n        this.lock = lock;\n    }\n    \n    public void run () {\n        lock.lock();\n        try {\n            system.out.println(thread.currentthread() + " running");\n        } finally {\n            lock.unlock();\n        }\n    }\n}\npublic class abstractqueuedsynchronizerdemo {\n    public static void main(string[] args) {\n        lock lock = new reentrantlock();\n        \n        mythread t1 = new mythread("t1", lock);\n        mythread t2 = new mythread("t2", lock);\n        t1.start();\n        t2.start();    \n    }\n}\n\n\n():\n\nthread[t1,5,main] running\nthread[t2,5,main] running\n\n\n: t1t2lock\n\n\n\n: t1lock.lockt2lock.lockt1lock.unlockt2lock.unlockabstractqueuedsynchronizer\n\n * t1lock.lock\n\n\n\n: aqsabstractqueuedsynchronizeraosabstractownablesynchronizer\n\n * t2lock.lock\n\n\n\n: t2locksupport.park\n\n * t1lock.unlock\n\n\n\n: t1lock.unlocklocksupport.unparkt2t2locksupport.park\n\n\n\n: locksupport.unparkt2parkandcheckinterruptacquirequeuedheadtailt2sync\n\n * t2lock.unlock\n\n\n\n: t2lock.unlock\n\n\n# abstractqueuedsynchronizer\n\nconditionabstractqueuedsynchronizer\n\n * depot()\n\nimport java.util.concurrent.locks.condition;\nimport java.util.concurrent.locks.lock;\nimport java.util.concurrent.locks.reentrantlock;\n\npublic class depot {\n    private int size;\n    private int capacity;\n    private lock lock;\n    private condition fullcondition;\n    private condition emptycondition;\n    \n    public depot(int capacity) {\n        this.capacity = capacity;    \n        lock = new reentrantlock();\n        fullcondition = lock.newcondition();\n        emptycondition = lock.newcondition();\n    }\n    \n    public void produce(int no) {\n        lock.lock();\n        int left = no;\n        try {\n            while (left > 0) {\n                while (size >= capacity)  {\n                    system.out.println(thread.currentthread() + " before await");\n                    fullcondition.await();\n                    system.out.println(thread.currentthread() + " after await");\n                }\n                int inc = (left + size) > capacity ? (capacity - size) : left;\n                left -= inc;\n                size += inc;\n                system.out.println("produce = " + inc + ", size = " + size);\n                emptycondition.signal();\n            }\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public void consume(int no) {\n        lock.lock();\n        int left = no;\n        try {            \n            while (left > 0) {\n                while (size <= 0) {\n                    system.out.println(thread.currentthread() + " before await");\n                    emptycondition.await();\n                    system.out.println(thread.currentthread() + " after await");\n                }\n                int dec = (size - left) > 0 ? left : size;\n                left -= dec;\n                size -= dec;\n                system.out.println("consume = " + dec + ", size = " + size);\n                fullcondition.signal();\n            }\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\n\n * \n\nclass consumer {\n    private depot depot;\n    public consumer(depot depot) {\n        this.depot = depot;\n    }\n    \n    public void consume(int no) {\n        new thread(new runnable() {\n            @override\n            public void run() {\n                depot.consume(no);\n            }\n        }, no + " consume thread").start();\n    }\n}\n\nclass producer {\n    private depot depot;\n    public producer(depot depot) {\n        this.depot = depot;\n    }\n    \n    public void produce(int no) {\n        new thread(new runnable() {\n            \n            @override\n            public void run() {\n                depot.produce(no);\n            }\n        }, no + " produce thread").start();\n    }\n}\n\npublic class reentrantlockdemo {\n    public static void main(string[] args) throws interruptedexception {\n        depot depot = new depot(500);\n        new producer(depot).produce(500);\n        new producer(depot).produce(200);\n        new consumer(depot).consume(500);\n        new consumer(depot).consume(200);\n    }\n}\n\n\n * ():\n\nproduce = 500, size = 500\nthread[200 produce thread,5,main] before await\nconsume = 500, size = 0\nthread[200 consume thread,5,main] before await\nthread[200 produce thread,5,main] after await\nproduce = 200, size = 200\nthread[200 consume thread,5,main] after await\nconsume = 200, size = 0\n\n\n: \n\n\n\n: p1produce 500p2produce 200c1consume 500c2consume 200\n\n * p1lock.lock\n * p2lock.lock\n\n\n\n: p2lock.lockp2locksupport.park\n\n * c1lock.lock\n\n\n\n: c1sync queue(p2)waitstatussignal\n\n * c2lock.lock\n\n\n\n: c1sync queue(c1)waitstatussignal\n\n * p1emptycondition.signal\n\n\n\n: aqs.coabstractqueuedsynchronizer.conditionobjectsignal\n\n * p1lock.unlock\n\n\n\n: p2(c1c2)p2\n\n * p2fullcondition.await\n\n\n\n: p2condition queuesync queuep2locksupport.parkawaitheadc1c1\n\n * c1c1parkacquirequeuedc1head\n\n\n\n: headc1c1\n\n * c1fullcondtion.signal\n\n\n\n: signalp2condition queuesync queuecondition queuenullsignal\n\n * c1lock.unlock\n\n\n\n: c2\n\n * c2emptycondition.await\n\n\n\n: awaitcondition queuecondition queueunparkp2\n\n * p2unparkcpup2p2aqs:awaitparkaqs.co:await\n\n\n\n * p2emptycondition.signal\n\n\n\n: condition queuesync queuecondition queueheadsignal\n\n * p2lock.unlock\n\n\n\n: unlockc2c2\n\n * c2fullcondition. signalfullconditioncondition queue\n\n * c2lock.unlockc2syncunparksuccessortrue\n\n\n# abstractqueuedsynchronizer\n\nabstractqueuedsynchronizersync queue\n\n * \n * head\n * condition queuesync queuesignal\n * signal\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5350186.html\n * http://ifeve.com/introduce-abstractqueuedsynchronizer/\n * http://blog.csdn.net/chen77716/article/details/6641477\n * https://blog.csdn.net/mulinsen77/article/details/84583716\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-abstractqueuedsynchronizer.html',charsets:{cjk:!0}},{title:"JUC: ReentrantReadWriteLock",frontmatter:{},regularPath:"/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html",relativePath:"java/thread/java-thread-x-lock-ReentrantReadWriteLock.md",key:"v-a53cce24",path:"/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html",headers:[{level:2,title:"JUC: ReentrantReadWriteLock",slug:"juc-reentrantreadwritelock",normalizedTitle:"juc: reentrantreadwritelock",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:178},{level:2,title:"ReentrantReadWriteLock",slug:"reentrantreadwritelock",normalizedTitle:"reentrantreadwritelock",charIndex:199},{level:2,title:"ReentrantReadWriteLock",slug:"reentrantreadwritelock",normalizedTitle:"reentrantreadwritelock",charIndex:231},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:265},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:279},{level:3,title:" - Sync",slug:"-sync",normalizedTitle:" - sync",charIndex:292},{level:3,title:" - Sync",slug:"-sync",normalizedTitle:" - sync",charIndex:311},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:335},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:347},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:321},{level:2,title:"ReentrantReadWriteLock",slug:"reentrantreadwritelock",normalizedTitle:"reentrantreadwritelock",charIndex:373},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:403},{level:3,title:"?",slug:"",normalizedTitle:"?",charIndex:416},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:430}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"JUC: ReentrantReadWriteLock BAT ReentrantReadWriteLock ReentrantReadWriteLock    - Sync  - Sync    ReentrantReadWriteLock  ? ",content:'# JUC: ReentrantReadWriteLock\n\n> ReentrantReadWriteLockReentrantReadWriteLockReadLockWriteLock\n\n * JUC: ReentrantReadWriteLock\n   * BAT\n   * ReentrantReadWriteLock\n   * ReentrantReadWriteLock\n     * \n     * \n     *  - Sync\n     *  - Sync\n     * \n     * \n     * \n   * ReentrantReadWriteLock\n   * \n     * ?\n   * \n\n\n# BAT\n\n\n\n\n\n * ReentrantLockReentrantReadWriteLock?\n * ReentrantReadWriteLock?\n * ReentrantReadWriteLock? 1616\n * ?\n * ThreadLocalHoldCounter?\n * HoldCounter?\n * ?\n * ?\n * RentrantReadWriteLock?\n * ? RentrantReadWriteLock?\n\n\n# ReentrantReadWriteLock\n\nReentrantReadWriteLockReentrantLockAbstractQueuedSynchronizerReentrantReadWriteLockAQS\n\n\n# ReentrantReadWriteLock\n\n\n# \n\npublic class ReentrantReadWriteLock implements ReadWriteLock, java.io.Serializable {}\n\n\n: ReentrantReadWriteLockReadWriteLockReadWriteLockSerializableReentrantReadWriteLock\n\n\n# \n\nReentrantReadWriteLock\n\n\n\n: SyncAQSNonfairSyncSyncFairSyncSyncReadLockLockWriteLockLock\n\n\n#  - Sync\n\n * \n\nabstract static class Sync extends AbstractQueuedSynchronizer {}\n\n\n: SyncAQSSyncReentrantReadWriteLock\n\n * \n\nSyncHoldCounterThreadLocalHoldCounterHoldCounterHoldCounter\n\n// \nstatic final class HoldCounter {\n    // \n    int count = 0;\n    // Use id, not reference, to avoid garbage retention\n    // TID\n    final long tid = getThreadId(Thread.currentThread());\n}\n\n\n: HoldCountercounttidcounttidtidThreadLocalHoldCounter\n\n// \nstatic final class ThreadLocalHoldCounter\n    extends ThreadLocal<HoldCounter> {\n    // setHoldCounter\n    public HoldCounter initialValue() {\n        return new HoldCounter();\n    }\n}\n\n\n: ThreadLocalHoldCounterThreadLocalinitialValueThreadLocalsetgetinitialValueHolderCounter\n\n * \n\nabstract static class Sync extends AbstractQueuedSynchronizer {\n    // \n    private static final long serialVersionUID = 6317671515068378041L;        \n    // 1616\n    static final int SHARED_SHIFT   = 16;\n    // \n    static final int SHARED_UNIT    = (1 << SHARED_SHIFT);\n    // \n    static final int MAX_COUNT      = (1 << SHARED_SHIFT) - 1;\n    // \n    static final int EXCLUSIVE_MASK = (1 << SHARED_SHIFT) - 1;\n    // \n    private transient ThreadLocalHoldCounter readHolds;\n    // \n    private transient HoldCounter cachedHoldCounter;\n    // \n    private transient Thread firstReader = null;\n    // \n    private transient int firstReaderHoldCount;\n}\n\n\n: \n\n * \n\n// \nSync() {\n    // \n    readHolds = new ThreadLocalHoldCounter();\n    // AQS\n    setState(getState()); // ensures visibility of readHolds\n}\n\n\n: SyncAQSstate\n\n\n#  - Sync\n\nReentrantReadWriteLockSyncSync\n\n * sharedCount\n\n\n\nstatic int sharedCount(int c)    { return c >>> SHARED_SHIFT; }\n\n\n: state16state16\n\n * exclusiveCount\n\n\n\nstatic int exclusiveCount(int c) { return c & EXCLUSIVE_MASK; }\n\n\n: state(2^16 - 1)state2^16state\n\n * tryRelease\n\n/*\n* Note that tryRelease and tryAcquire can be called by\n* Conditions. So it is possible that their arguments contain\n* both read and write holds that are all released during a\n* condition wait and re-established in tryAcquire.\n*/\n\nprotected final boolean tryRelease(int releases) {\n    // \n    if (!isHeldExclusively())\n        throw new IllegalMonitorStateException();\n    // \n    int nextc = getState() - releases;\n    boolean free = exclusiveCount(nextc) == 0; // \n    if (free)\n        setExclusiveOwnerThread(null); // \n    setState(nextc); // \n    return free;\n}\n\n\n: 0\n\n\n\n * tryAcquire\n\nprotected final boolean tryAcquire(int acquires) {\n    /*\n        * Walkthrough:\n        * 1. If read count nonzero or write count nonzero\n        *    and owner is a different thread, fail.\n        * 2. If count would saturate, fail. (This can only\n        *    happen if count is already nonzero.)\n        * 3. Otherwise, this thread is eligible for lock if\n        *    it is either a reentrant acquire or\n        *    queue policy allows it. If so, update state\n        *    and set owner.\n        */\n    // \n    Thread current = Thread.currentThread();\n    // \n    int c = getState();\n    // \n    int w = exclusiveCount(c);\n    if (c != 0) { // 0\n        // (Note: if c != 0 and w == 0 then shared count != 0)\n        if (w == 0 || current != getExclusiveOwnerThread()) // 0\n            return false;\n        if (w + exclusiveCount(acquires) > MAX_COUNT) // \n            throw new Error("Maximum lock count exceeded");\n        // Reentrant acquire\n        // AQS\n        setState(c + acquires);\n        return true;\n    }\n    if (writerShouldBlock() ||\n        !compareAndSetState(c, c + acquires)) // \n        return false;\n    // \n    setExclusiveOwnerThread(current);\n    return true;\n}\n\n\n: state00()statetruestate00falsestatetrue\n\n\n\n * tryReleaseShared\n\nprotected final boolean tryReleaseShared(int unused) {\n    // \n    Thread current = Thread.currentThread();\n    if (firstReader == current) { // \n        // assert firstReaderHoldCount > 0;\n        if (firstReaderHoldCount == 1) // 1\n            firstReader = null;\n        else // \n            firstReaderHoldCount--;\n    } else { // \n        // \n        HoldCounter rh = cachedHoldCounter;\n        if (rh == null || rh.tid != getThreadId(current)) // tidtid\n            // \n            rh = readHolds.get();\n        // \n        int count = rh.count;\n        if (count <= 1) { // 1\n            // \n            readHolds.remove();\n            if (count <= 0) // 0\n                throw unmatchedUnlockException();\n        }\n        // \n        --rh.count;\n    }\n    for (;;) { // \n        // \n        int c = getState();\n        // \n        int nextc = c - SHARED_UNIT;\n        if (compareAndSetState(c, nextc)) // \n            // Releasing the read lock has no effect on readers,\n            // but it may allow waiting writers to proceed if\n            // both read and write locks are now free.\n            return nextc == 0;\n    }\n}\n\n\n: firstReaderfirstReaderHoldCount1firstReaderfirstReaderHoldCount1( )tidtidcount1count0state\n\n\n\n * tryAcquireShared\n\nprivate IllegalMonitorStateException unmatchedUnlockException() {\n    return new IllegalMonitorStateException(\n        "attempt to unlock read lock, not locked by current thread");\n}\n\n// \nprotected final int tryAcquireShared(int unused) {\n    /*\n        * Walkthrough:\n        * 1. If write lock held by another thread, fail.\n        * 2. Otherwise, this thread is eligible for\n        *    lock wrt state, so ask if it should block\n        *    because of queue policy. If not, try\n        *    to grant by CASing state and updating count.\n        *    Note that step does not check for reentrant\n        *    acquires, which is postponed to full version\n        *    to avoid having to check hold count in\n        *    the more typical non-reentrant case.\n        * 3. If step 2 fails either because thread\n        *    apparently not eligible or CAS fails or count\n        *    saturated, chain to version with full retry loop.\n        */\n    // \n    Thread current = Thread.currentThread();\n    // \n    int c = getState();\n    if (exclusiveCount(c) != 0 &&\n        getExclusiveOwnerThread() != current) // 0\n        return -1;\n    // \n    int r = sharedCount(c);\n    if (!readerShouldBlock() &&\n        r < MAX_COUNT &&\n        compareAndSetState(c, c + SHARED_UNIT)) { // \n        if (r == 0) { // 0\n            // \n            firstReader = current;\n            // 1\n            firstReaderHoldCount = 1;\n        } else if (firstReader == current) { // \n            // 1\n            firstReaderHoldCount++;\n        } else { // 0\n            // \n            HoldCounter rh = cachedHoldCounter;\n            if (rh == null || rh.tid != getThreadId(current)) // tidtid\n                // \n                cachedHoldCounter = rh = readHolds.get();\n            else if (rh.count == 0) // 0\n                // \n                readHolds.set(rh);\n            rh.count++;\n        }\n        return 1;\n    }\n    return fullTryAcquireShared(current);\n}\n\n\n: 0firstReaderfirstReaderHoldCountfirstReaderHoldCountHoldCounter\n\n\n\n * fullTryAcquireShared\n\nfinal int fullTryAcquireShared(Thread current) {\n    /*\n        * This code is in part redundant with that in\n        * tryAcquireShared but is simpler overall by not\n        * complicating tryAcquireShared with interactions between\n        * retries and lazily reading hold counts.\n        */\n    HoldCounter rh = null;\n    for (;;) { // \n        // \n        int c = getState();\n        if (exclusiveCount(c) != 0) { // 0\n            if (getExclusiveOwnerThread() != current) // \n                return -1;\n            // else we hold the exclusive lock; blocking here\n            // would cause deadlock.\n        } else if (readerShouldBlock()) { // 0\n            // Make sure we\'re not acquiring read lock reentrantly\n            if (firstReader == current) { // \n                // assert firstReaderHoldCount > 0;\n            } else { // \n                if (rh == null) { // \n                    // \n                    rh = cachedHoldCounter;\n                    if (rh == null || rh.tid != getThreadId(current)) { // tidtid\n                        rh = readHolds.get();\n                        if (rh.count == 0)\n                            readHolds.remove();\n                    }\n                }\n                if (rh.count == 0)\n                    return -1;\n            }\n        }\n        if (sharedCount(c) == MAX_COUNT) // \n            throw new Error("Maximum lock count exceeded");\n        if (compareAndSetState(c, c + SHARED_UNIT)) { // \n            if (sharedCount(c) == 0) { // 0\n                // \n                firstReader = current;\n                // \n                firstReaderHoldCount = 1;\n            } else if (firstReader == current) {\n                firstReaderHoldCount++;\n            } else {\n                if (rh == null)\n                    rh = cachedHoldCounter;\n                if (rh == null || rh.tid != getThreadId(current))\n                    rh = readHolds.get();\n                else if (rh.count == 0)\n                    readHolds.set(rh);\n                rh.count++;\n                cachedHoldCounter = rh; // cache for release\n            }\n            return 1;\n        }\n    }\n}\n\n\n: tryAcquireShared()fullTryAcquireSharedtryAcquireShared\n\nSync\n\n\n# \n\npublic class ReentrantReadWriteLock\n        implements ReadWriteLock, java.io.Serializable {\n    //     \n    private static final long serialVersionUID = -6992448646407690164L;    \n    // \n    private final ReentrantReadWriteLock.ReadLock readerLock;\n    // \n    private final ReentrantReadWriteLock.WriteLock writerLock;\n    // \n    final Sync sync;\n    \n    private static final sun.misc.Unsafe UNSAFE;\n    // ID\n    private static final long TID_OFFSET;\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> tk = Thread.class;\n            // tid\n            TID_OFFSET = UNSAFE.objectFieldOffset\n                (tk.getDeclaredField("tid"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n}\n\n\n: ReentrantReadWriteLockReentrantReadWriteLock.ReadLockReentrantReadWriteLock.WriteLockSync\n\n\n# \n\n * ReentrantReadWriteLock()\n\npublic ReentrantReadWriteLock() {\n    this(false);\n}\n\n\n: \n\n * ReentrantReadWriteLock(boolean)\n\npublic ReentrantReadWriteLock(boolean fair) {\n    // \n    sync = fair ? new FairSync() : new NonfairSync();\n    // \n    readerLock = new ReadLock(this);\n    // \n    writerLock = new WriteLock(this);\n}\n\n\n: \n\n\n# \n\nReentrantReadWriteLockSyncSync\n\n\n# ReentrantReadWriteLock\n\nReentrantReadWriteLock\n\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\nclass ReadThread extends Thread {\n    private ReentrantReadWriteLock rrwLock;\n    \n    public ReadThread(String name, ReentrantReadWriteLock rrwLock) {\n        super(name);\n        this.rrwLock = rrwLock;\n    }\n    \n    public void run() {\n        System.out.println(Thread.currentThread().getName() + " trying to lock");\n        try {\n            rrwLock.readLock().lock();\n            System.out.println(Thread.currentThread().getName() + " lock successfully");\n            Thread.sleep(5000);        \n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            rrwLock.readLock().unlock();\n            System.out.println(Thread.currentThread().getName() + " unlock successfully");\n        }\n    }\n}\n\nclass WriteThread extends Thread {\n    private ReentrantReadWriteLock rrwLock;\n    \n    public WriteThread(String name, ReentrantReadWriteLock rrwLock) {\n        super(name);\n        this.rrwLock = rrwLock;\n    }\n    \n    public void run() {\n        System.out.println(Thread.currentThread().getName() + " trying to lock");\n        try {\n            rrwLock.writeLock().lock();\n            System.out.println(Thread.currentThread().getName() + " lock successfully");    \n        } finally {\n            rrwLock.writeLock().unlock();\n            System.out.println(Thread.currentThread().getName() + " unlock successfully");\n        }\n    }\n}\n\npublic class ReentrantReadWriteLockDemo {\n    public static void main(String[] args) {\n        ReentrantReadWriteLock rrwLock = new ReentrantReadWriteLock();\n        ReadThread rt1 = new ReadThread("rt1", rrwLock);\n        ReadThread rt2 = new ReadThread("rt2", rrwLock);\n        WriteThread wt1 = new WriteThread("wt1", rrwLock);\n        rt1.start();\n        rt2.start();\n        wt1.start();\n    } \n}\n\n\n():\n\nrt1 trying to lock\nrt2 trying to lock\nwt1 trying to lock\nrt1 lock successfully\nrt2 lock successfully\nrt1 unlock successfully\nrt2 unlock successfully\nwt1 lock successfully\nwt1 unlock successfully\n\n\n: ReentrantReadWriteLock\n\n\n\n * rt1rrwLock.readLock().lock\n\n\n\n: AQSstate2^16 1\n\n * rt2rrwLock.readLock().lock\n\n\n\n: AQSstate2 * 2^162\n\n * wt1rrwLock.writeLock().lock\n\n\n\n: Sync queuewt1\n\n * rt1rrwLock.readLock().unlock\n\n\n\n: AQSstate2^16\n\n * rt2rrwLock.readLock().unlock\n\n\n\n: rt2unlockAQSstate0wt1unparkCPU\n\n * wt1CPUacquireQueuedparkAndCheckInterruptparkAndCheckInterrupt\n\n\n\n: sync queueAQSstate1\n\n * wt1rrwLock.writeLock().unlock\n\n\n\n: AQSstate0Sync queue\n\n\n# \n\n\n# ?\n\n()()\n\n\n\npublic void processData() {\n    readLock.lock();\n    if (!update) {\n        // \n        readLock.unlock();\n        // \n        writeLock.lock();\n        try {\n            if (!update) {\n                // ()\n                update = true;\n            }\n            readLock.lock();\n        } finally {\n            writeLock.unlock();\n        }\n        // \n    }\n    try {\n        // ()\n    } finally {\n        readLock.unlock();\n    }\n}\n\n\nupdate(volatile)falseprocessData()lock()\n\n? (T)TTT\n\nRentrantReadWriteLock()\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5419132.html\n * https://blog.csdn.net/jiankunking/article/details/83954263\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html',normalizedContent:'# juc: reentrantreadwritelock\n\n> reentrantreadwritelockreentrantreadwritelockreadlockwritelock\n\n * juc: reentrantreadwritelock\n   * bat\n   * reentrantreadwritelock\n   * reentrantreadwritelock\n     * \n     * \n     *  - sync\n     *  - sync\n     * \n     * \n     * \n   * reentrantreadwritelock\n   * \n     * ?\n   * \n\n\n# bat\n\n\n\n\n\n * reentrantlockreentrantreadwritelock?\n * reentrantreadwritelock?\n * reentrantreadwritelock? 1616\n * ?\n * threadlocalholdcounter?\n * holdcounter?\n * ?\n * ?\n * rentrantreadwritelock?\n * ? rentrantreadwritelock?\n\n\n# reentrantreadwritelock\n\nreentrantreadwritelockreentrantlockabstractqueuedsynchronizerreentrantreadwritelockaqs\n\n\n# reentrantreadwritelock\n\n\n# \n\npublic class reentrantreadwritelock implements readwritelock, java.io.serializable {}\n\n\n: reentrantreadwritelockreadwritelockreadwritelockserializablereentrantreadwritelock\n\n\n# \n\nreentrantreadwritelock\n\n\n\n: syncaqsnonfairsyncsyncfairsyncsyncreadlocklockwritelocklock\n\n\n#  - sync\n\n * \n\nabstract static class sync extends abstractqueuedsynchronizer {}\n\n\n: syncaqssyncreentrantreadwritelock\n\n * \n\nsyncholdcounterthreadlocalholdcounterholdcounterholdcounter\n\n// \nstatic final class holdcounter {\n    // \n    int count = 0;\n    // use id, not reference, to avoid garbage retention\n    // tid\n    final long tid = getthreadid(thread.currentthread());\n}\n\n\n: holdcountercounttidcounttidtidthreadlocalholdcounter\n\n// \nstatic final class threadlocalholdcounter\n    extends threadlocal<holdcounter> {\n    // setholdcounter\n    public holdcounter initialvalue() {\n        return new holdcounter();\n    }\n}\n\n\n: threadlocalholdcounterthreadlocalinitialvaluethreadlocalsetgetinitialvalueholdercounter\n\n * \n\nabstract static class sync extends abstractqueuedsynchronizer {\n    // \n    private static final long serialversionuid = 6317671515068378041l;        \n    // 1616\n    static final int shared_shift   = 16;\n    // \n    static final int shared_unit    = (1 << shared_shift);\n    // \n    static final int max_count      = (1 << shared_shift) - 1;\n    // \n    static final int exclusive_mask = (1 << shared_shift) - 1;\n    // \n    private transient threadlocalholdcounter readholds;\n    // \n    private transient holdcounter cachedholdcounter;\n    // \n    private transient thread firstreader = null;\n    // \n    private transient int firstreaderholdcount;\n}\n\n\n: \n\n * \n\n// \nsync() {\n    // \n    readholds = new threadlocalholdcounter();\n    // aqs\n    setstate(getstate()); // ensures visibility of readholds\n}\n\n\n: syncaqsstate\n\n\n#  - sync\n\nreentrantreadwritelocksyncsync\n\n * sharedcount\n\n\n\nstatic int sharedcount(int c)    { return c >>> shared_shift; }\n\n\n: state16state16\n\n * exclusivecount\n\n\n\nstatic int exclusivecount(int c) { return c & exclusive_mask; }\n\n\n: state(2^16 - 1)state2^16state\n\n * tryrelease\n\n/*\n* note that tryrelease and tryacquire can be called by\n* conditions. so it is possible that their arguments contain\n* both read and write holds that are all released during a\n* condition wait and re-established in tryacquire.\n*/\n\nprotected final boolean tryrelease(int releases) {\n    // \n    if (!isheldexclusively())\n        throw new illegalmonitorstateexception();\n    // \n    int nextc = getstate() - releases;\n    boolean free = exclusivecount(nextc) == 0; // \n    if (free)\n        setexclusiveownerthread(null); // \n    setstate(nextc); // \n    return free;\n}\n\n\n: 0\n\n\n\n * tryacquire\n\nprotected final boolean tryacquire(int acquires) {\n    /*\n        * walkthrough:\n        * 1. if read count nonzero or write count nonzero\n        *    and owner is a different thread, fail.\n        * 2. if count would saturate, fail. (this can only\n        *    happen if count is already nonzero.)\n        * 3. otherwise, this thread is eligible for lock if\n        *    it is either a reentrant acquire or\n        *    queue policy allows it. if so, update state\n        *    and set owner.\n        */\n    // \n    thread current = thread.currentthread();\n    // \n    int c = getstate();\n    // \n    int w = exclusivecount(c);\n    if (c != 0) { // 0\n        // (note: if c != 0 and w == 0 then shared count != 0)\n        if (w == 0 || current != getexclusiveownerthread()) // 0\n            return false;\n        if (w + exclusivecount(acquires) > max_count) // \n            throw new error("maximum lock count exceeded");\n        // reentrant acquire\n        // aqs\n        setstate(c + acquires);\n        return true;\n    }\n    if (writershouldblock() ||\n        !compareandsetstate(c, c + acquires)) // \n        return false;\n    // \n    setexclusiveownerthread(current);\n    return true;\n}\n\n\n: state00()statetruestate00falsestatetrue\n\n\n\n * tryreleaseshared\n\nprotected final boolean tryreleaseshared(int unused) {\n    // \n    thread current = thread.currentthread();\n    if (firstreader == current) { // \n        // assert firstreaderholdcount > 0;\n        if (firstreaderholdcount == 1) // 1\n            firstreader = null;\n        else // \n            firstreaderholdcount--;\n    } else { // \n        // \n        holdcounter rh = cachedholdcounter;\n        if (rh == null || rh.tid != getthreadid(current)) // tidtid\n            // \n            rh = readholds.get();\n        // \n        int count = rh.count;\n        if (count <= 1) { // 1\n            // \n            readholds.remove();\n            if (count <= 0) // 0\n                throw unmatchedunlockexception();\n        }\n        // \n        --rh.count;\n    }\n    for (;;) { // \n        // \n        int c = getstate();\n        // \n        int nextc = c - shared_unit;\n        if (compareandsetstate(c, nextc)) // \n            // releasing the read lock has no effect on readers,\n            // but it may allow waiting writers to proceed if\n            // both read and write locks are now free.\n            return nextc == 0;\n    }\n}\n\n\n: firstreaderfirstreaderholdcount1firstreaderfirstreaderholdcount1( )tidtidcount1count0state\n\n\n\n * tryacquireshared\n\nprivate illegalmonitorstateexception unmatchedunlockexception() {\n    return new illegalmonitorstateexception(\n        "attempt to unlock read lock, not locked by current thread");\n}\n\n// \nprotected final int tryacquireshared(int unused) {\n    /*\n        * walkthrough:\n        * 1. if write lock held by another thread, fail.\n        * 2. otherwise, this thread is eligible for\n        *    lock wrt state, so ask if it should block\n        *    because of queue policy. if not, try\n        *    to grant by casing state and updating count.\n        *    note that step does not check for reentrant\n        *    acquires, which is postponed to full version\n        *    to avoid having to check hold count in\n        *    the more typical non-reentrant case.\n        * 3. if step 2 fails either because thread\n        *    apparently not eligible or cas fails or count\n        *    saturated, chain to version with full retry loop.\n        */\n    // \n    thread current = thread.currentthread();\n    // \n    int c = getstate();\n    if (exclusivecount(c) != 0 &&\n        getexclusiveownerthread() != current) // 0\n        return -1;\n    // \n    int r = sharedcount(c);\n    if (!readershouldblock() &&\n        r < max_count &&\n        compareandsetstate(c, c + shared_unit)) { // \n        if (r == 0) { // 0\n            // \n            firstreader = current;\n            // 1\n            firstreaderholdcount = 1;\n        } else if (firstreader == current) { // \n            // 1\n            firstreaderholdcount++;\n        } else { // 0\n            // \n            holdcounter rh = cachedholdcounter;\n            if (rh == null || rh.tid != getthreadid(current)) // tidtid\n                // \n                cachedholdcounter = rh = readholds.get();\n            else if (rh.count == 0) // 0\n                // \n                readholds.set(rh);\n            rh.count++;\n        }\n        return 1;\n    }\n    return fulltryacquireshared(current);\n}\n\n\n: 0firstreaderfirstreaderholdcountfirstreaderholdcountholdcounter\n\n\n\n * fulltryacquireshared\n\nfinal int fulltryacquireshared(thread current) {\n    /*\n        * this code is in part redundant with that in\n        * tryacquireshared but is simpler overall by not\n        * complicating tryacquireshared with interactions between\n        * retries and lazily reading hold counts.\n        */\n    holdcounter rh = null;\n    for (;;) { // \n        // \n        int c = getstate();\n        if (exclusivecount(c) != 0) { // 0\n            if (getexclusiveownerthread() != current) // \n                return -1;\n            // else we hold the exclusive lock; blocking here\n            // would cause deadlock.\n        } else if (readershouldblock()) { // 0\n            // make sure we\'re not acquiring read lock reentrantly\n            if (firstreader == current) { // \n                // assert firstreaderholdcount > 0;\n            } else { // \n                if (rh == null) { // \n                    // \n                    rh = cachedholdcounter;\n                    if (rh == null || rh.tid != getthreadid(current)) { // tidtid\n                        rh = readholds.get();\n                        if (rh.count == 0)\n                            readholds.remove();\n                    }\n                }\n                if (rh.count == 0)\n                    return -1;\n            }\n        }\n        if (sharedcount(c) == max_count) // \n            throw new error("maximum lock count exceeded");\n        if (compareandsetstate(c, c + shared_unit)) { // \n            if (sharedcount(c) == 0) { // 0\n                // \n                firstreader = current;\n                // \n                firstreaderholdcount = 1;\n            } else if (firstreader == current) {\n                firstreaderholdcount++;\n            } else {\n                if (rh == null)\n                    rh = cachedholdcounter;\n                if (rh == null || rh.tid != getthreadid(current))\n                    rh = readholds.get();\n                else if (rh.count == 0)\n                    readholds.set(rh);\n                rh.count++;\n                cachedholdcounter = rh; // cache for release\n            }\n            return 1;\n        }\n    }\n}\n\n\n: tryacquireshared()fulltryacquiresharedtryacquireshared\n\nsync\n\n\n# \n\npublic class reentrantreadwritelock\n        implements readwritelock, java.io.serializable {\n    //     \n    private static final long serialversionuid = -6992448646407690164l;    \n    // \n    private final reentrantreadwritelock.readlock readerlock;\n    // \n    private final reentrantreadwritelock.writelock writerlock;\n    // \n    final sync sync;\n    \n    private static final sun.misc.unsafe unsafe;\n    // id\n    private static final long tid_offset;\n    static {\n        try {\n            unsafe = sun.misc.unsafe.getunsafe();\n            class<?> tk = thread.class;\n            // tid\n            tid_offset = unsafe.objectfieldoffset\n                (tk.getdeclaredfield("tid"));\n        } catch (exception e) {\n            throw new error(e);\n        }\n    }\n}\n\n\n: reentrantreadwritelockreentrantreadwritelock.readlockreentrantreadwritelock.writelocksync\n\n\n# \n\n * reentrantreadwritelock()\n\npublic reentrantreadwritelock() {\n    this(false);\n}\n\n\n: \n\n * reentrantreadwritelock(boolean)\n\npublic reentrantreadwritelock(boolean fair) {\n    // \n    sync = fair ? new fairsync() : new nonfairsync();\n    // \n    readerlock = new readlock(this);\n    // \n    writerlock = new writelock(this);\n}\n\n\n: \n\n\n# \n\nreentrantreadwritelocksyncsync\n\n\n# reentrantreadwritelock\n\nreentrantreadwritelock\n\nimport java.util.concurrent.locks.reentrantreadwritelock;\n\nclass readthread extends thread {\n    private reentrantreadwritelock rrwlock;\n    \n    public readthread(string name, reentrantreadwritelock rrwlock) {\n        super(name);\n        this.rrwlock = rrwlock;\n    }\n    \n    public void run() {\n        system.out.println(thread.currentthread().getname() + " trying to lock");\n        try {\n            rrwlock.readlock().lock();\n            system.out.println(thread.currentthread().getname() + " lock successfully");\n            thread.sleep(5000);        \n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            rrwlock.readlock().unlock();\n            system.out.println(thread.currentthread().getname() + " unlock successfully");\n        }\n    }\n}\n\nclass writethread extends thread {\n    private reentrantreadwritelock rrwlock;\n    \n    public writethread(string name, reentrantreadwritelock rrwlock) {\n        super(name);\n        this.rrwlock = rrwlock;\n    }\n    \n    public void run() {\n        system.out.println(thread.currentthread().getname() + " trying to lock");\n        try {\n            rrwlock.writelock().lock();\n            system.out.println(thread.currentthread().getname() + " lock successfully");    \n        } finally {\n            rrwlock.writelock().unlock();\n            system.out.println(thread.currentthread().getname() + " unlock successfully");\n        }\n    }\n}\n\npublic class reentrantreadwritelockdemo {\n    public static void main(string[] args) {\n        reentrantreadwritelock rrwlock = new reentrantreadwritelock();\n        readthread rt1 = new readthread("rt1", rrwlock);\n        readthread rt2 = new readthread("rt2", rrwlock);\n        writethread wt1 = new writethread("wt1", rrwlock);\n        rt1.start();\n        rt2.start();\n        wt1.start();\n    } \n}\n\n\n():\n\nrt1 trying to lock\nrt2 trying to lock\nwt1 trying to lock\nrt1 lock successfully\nrt2 lock successfully\nrt1 unlock successfully\nrt2 unlock successfully\nwt1 lock successfully\nwt1 unlock successfully\n\n\n: reentrantreadwritelock\n\n\n\n * rt1rrwlock.readlock().lock\n\n\n\n: aqsstate2^16 1\n\n * rt2rrwlock.readlock().lock\n\n\n\n: aqsstate2 * 2^162\n\n * wt1rrwlock.writelock().lock\n\n\n\n: sync queuewt1\n\n * rt1rrwlock.readlock().unlock\n\n\n\n: aqsstate2^16\n\n * rt2rrwlock.readlock().unlock\n\n\n\n: rt2unlockaqsstate0wt1unparkcpu\n\n * wt1cpuacquirequeuedparkandcheckinterruptparkandcheckinterrupt\n\n\n\n: sync queueaqsstate1\n\n * wt1rrwlock.writelock().unlock\n\n\n\n: aqsstate0sync queue\n\n\n# \n\n\n# ?\n\n()()\n\n\n\npublic void processdata() {\n    readlock.lock();\n    if (!update) {\n        // \n        readlock.unlock();\n        // \n        writelock.lock();\n        try {\n            if (!update) {\n                // ()\n                update = true;\n            }\n            readlock.lock();\n        } finally {\n            writelock.unlock();\n        }\n        // \n    }\n    try {\n        // ()\n    } finally {\n        readlock.unlock();\n    }\n}\n\n\nupdate(volatile)falseprocessdata()lock()\n\n? (t)ttt\n\nrentrantreadwritelock()\n\n\n# \n\n * leesfhttps://www.cnblogs.com/leesf456/p/5419132.html\n * https://blog.csdn.net/jiankunking/article/details/83954263\n *  https://www.pdai.tech/md/java/thread/java-thread-x-lock-reentrantreadwritelock.html',charsets:{cjk:!0}},{title:"Java - Java",frontmatter:{},regularPath:"/java/thread/java-thread-x-lock-all.html",relativePath:"java/thread/java-thread-x-lock-all.md",key:"v-57973fdc",path:"/java/thread/java-thread-x-lock-all.html",headers:[{level:2,title:"Java - Java",slug:"java-java",normalizedTitle:"java - java",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:170},{level:2,title:"1\\.  VS ",slug:"_1--vs-",normalizedTitle:"1.  vs ",charIndex:178},{level:2,title:"2\\.  VS ",slug:"_2--vs-",normalizedTitle:"2.  vs ",charIndex:197},{level:2,title:"3\\.  VS  VS  VS ",slug:"_3--vs--vs--vs-",normalizedTitle:"3.  vs  vs  vs ",charIndex:219},{level:2,title:"4\\.  VS ",slug:"_4--vs-",normalizedTitle:"4.  vs ",charIndex:253},{level:2,title:"5\\.  VS ",slug:"_5--vs-",normalizedTitle:"5.  vs ",charIndex:273},{level:2,title:"6\\. () VS ",slug:"_6---vs-",normalizedTitle:"6. () vs ",charIndex:295},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:319},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:327},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:337},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:347}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java - Java  1\\.  VS  2\\.  VS  3\\.  VS  VS  VS  4\\.  VS  5\\.  VS  6\\. () VS     ",content:'# Java - Java\n\n> JavaJDK 8Netty 3.10.6\n\n * Java - Java\n   * \n   * 1.  VS \n   * 2.  VS \n   * 3.  VS  VS  VS \n   * 4.  VS \n   * 5.  VS \n   * 6. () VS \n   * \n   * \n   * \n   * \n\n\n# \n\nJavaJDK 8Netty 3.10.6\n\nJava\n\n\n\n\n# 1.  VS \n\n> Java\n\nJavasynchronizedLock\n\n\n\nJavaCASJavaCAS\n\n\n\n\n\n * \n * \n\n\n\n// -------------------------  -------------------------\n// synchronized\npublic synchronized void testMethod() {\n\t// \n}\n// ReentrantLock\nprivate ReentrantLock lock = new ReentrantLock(); // \npublic void modifyPublicResources() {\n\tlock.lock();\n\t// \n\tlock.unlock();\n}\n\n// -------------------------  -------------------------\nprivate AtomicInteger atomicInteger = new AtomicInteger();  // AtomicInteger\natomicInteger.incrementAndGet(); //1\n\n\nJUC: CAS, Unsafe\n\n\n# 2.  VS \n\n> \n\nJavaCPU\n\nCPU\n\n\n\n\n\n10-XX:PreBlockSpin\n\nCASAtomicIntegerunsafedo-while\n\n - synchronized - \n\n\n# 3.  VS  VS  VS \n\n> synchronized\n\n Mark WordCASCAS\n\n\n\n - synchronized - \n\n\n# 4.  VS \n\nCPU\n\nCPU\n\n\n\n\n\n\n\n\n\n\n\nJUC - ReentrantLock\n\n\n# 5.  VS \n\nclassJavaReentrantLocksynchronized\n\npublic class Widget {\n    public synchronized void doSomething() {\n        System.out.println("1...");\n        doOthers();\n    }\n\n    public synchronized void doOthers() {\n        System.out.println("2...");\n    }\n}\n\n\nsynchronizeddoSomething()doOthers()doOthers()doOthers()\n\ndoOthers()doSomething()\n\n\n\n\n\n\n\n\n\n\n\nReentrantLocksynchronizedReentrantLockNonReentrantLock\n\nReentrantLockNonReentrantLockAQSAQSstatusstatus0\n\nstatusstatus == 0status1status != 0status+1statusstatus != 0\n\nstatusstatus-1 == 0status0\n\n\n\n\n\n * JUC: LockSupport\n * JUC: AbstractQueuedSynchronizer\n * JUC - ReentrantLock\n *  - synchronized\n\n\n# 6. () VS \n\n> ReentrantLockReentrantReadWriteLock\n\nTAAJDKsynchronizedJUCLock\n\nTAA\n\nAQS\n\nReentrantReadWriteLock\n\n\n\nReentrantReadWriteLockReadLockWriteLockReadLockWriteLockSyncSyncAQSCountDownLatchReentrantLockSemaphore\n\nReentrantReadWriteLockSyncReentrantReadWriteLock\n\n\n\n * JUC: ReentrantReadWriteLock\n\n\n# \n\nJava\n\nJava\n\n\n# \n\n * Java\n * Java\n * Java CAS \n * Javasynchronized\n * Java synchronized\n * Java SE1.6Synchronized\n * ReadWriteLock\n * JUCJDK1.8ReentrantReadWriteLock\n * JavaReentrantReadWriteLock\n * Java\n\n\n# \n\n2017 \n\n\n# \n\n\n\n https://www.pdai.tech/md/java/thread/java-thread-x-lock-all.html',normalizedContent:'# java - java\n\n> javajdk 8netty 3.10.6\n\n * java - java\n   * \n   * 1.  vs \n   * 2.  vs \n   * 3.  vs  vs  vs \n   * 4.  vs \n   * 5.  vs \n   * 6. () vs \n   * \n   * \n   * \n   * \n\n\n# \n\njavajdk 8netty 3.10.6\n\njava\n\n\n\n\n# 1.  vs \n\n> java\n\njavasynchronizedlock\n\n\n\njavacasjavacas\n\n\n\n\n\n * \n * \n\n\n\n// -------------------------  -------------------------\n// synchronized\npublic synchronized void testmethod() {\n\t// \n}\n// reentrantlock\nprivate reentrantlock lock = new reentrantlock(); // \npublic void modifypublicresources() {\n\tlock.lock();\n\t// \n\tlock.unlock();\n}\n\n// -------------------------  -------------------------\nprivate atomicinteger atomicinteger = new atomicinteger();  // atomicinteger\natomicinteger.incrementandget(); //1\n\n\njuc: cas, unsafe\n\n\n# 2.  vs \n\n> \n\njavacpu\n\ncpu\n\n\n\n\n\n10-xx:preblockspin\n\ncasatomicintegerunsafedo-while\n\n - synchronized - \n\n\n# 3.  vs  vs  vs \n\n> synchronized\n\n mark wordcascas\n\n\n\n - synchronized - \n\n\n# 4.  vs \n\ncpu\n\ncpu\n\n\n\n\n\n\n\n\n\n\n\njuc - reentrantlock\n\n\n# 5.  vs \n\nclassjavareentrantlocksynchronized\n\npublic class widget {\n    public synchronized void dosomething() {\n        system.out.println("1...");\n        doothers();\n    }\n\n    public synchronized void doothers() {\n        system.out.println("2...");\n    }\n}\n\n\nsynchronizeddosomething()doothers()doothers()doothers()\n\ndoothers()dosomething()\n\n\n\n\n\n\n\n\n\n\n\nreentrantlocksynchronizedreentrantlocknonreentrantlock\n\nreentrantlocknonreentrantlockaqsaqsstatusstatus0\n\nstatusstatus == 0status1status != 0status+1statusstatus != 0\n\nstatusstatus-1 == 0status0\n\n\n\n\n\n * juc: locksupport\n * juc: abstractqueuedsynchronizer\n * juc - reentrantlock\n *  - synchronized\n\n\n# 6. () vs \n\n> reentrantlockreentrantreadwritelock\n\ntaajdksynchronizedjuclock\n\ntaa\n\naqs\n\nreentrantreadwritelock\n\n\n\nreentrantreadwritelockreadlockwritelockreadlockwritelocksyncsyncaqscountdownlatchreentrantlocksemaphore\n\nreentrantreadwritelocksyncreentrantreadwritelock\n\n\n\n * juc: reentrantreadwritelock\n\n\n# \n\njava\n\njava\n\n\n# \n\n * java\n * java\n * java cas \n * javasynchronized\n * java synchronized\n * java se1.6synchronized\n * readwritelock\n * jucjdk1.8reentrantreadwritelock\n * javareentrantreadwritelock\n * java\n\n\n# \n\n2017 \n\n\n# \n\n\n\n https://www.pdai.tech/md/java/thread/java-thread-x-lock-all.html',charsets:{cjk:!0}},{title:"Java",frontmatter:{},regularPath:"/java/thread/java-thread-x-overview.html",relativePath:"java/thread/java-thread-x-overview.md",key:"v-3fa2451e",path:"/java/thread/java-thread-x-overview.html",headers:[{level:2,title:"Java",slug:"java",normalizedTitle:"java",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:9},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:124},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:134}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java   ",content:"# Java\n\n> Java synchronizedvolatilefinal, JUC\n\n * Java\n   * \n   * \n   * \n\n\n# \n\n\n\n\n# \n\n> A. Java - Java Java@pdai\n\n * Java  - \n * Java  - \n   * ?\n   * ? \n   * ? \n   * Java? 3JMM8Happens-Before\n   * ? \n   * ?\n   * ?\n * Java  - \n   * ? ?\n   * ?\n   * ?\n   * ?\n   * ? ?\n   * ?\n * Java - Java\n   * Java\n * : synchronized\n   * Synchronized? \n   * Synchronized? \n   * Synchronized? Java Lock\n   * SynchronizedLock?\n   * Synchronized?\n   * Synchronized,?\n   * SynchronizedJVM?\n   * Synchronized?\n   * ()?\n   * ? JVM?\n   * JDKSynchronized?\n * : volatile\n   * volatile?\n   * volatile?\n   * 32longdoublevolatile? 64?\n   * i++?\n   * volatile? \n   * volatile? happens-before\n   * volatile?\n * : final\n   * final?\n   * privatefinal?\n   * final? StringfinalMyStringStringtoMyString()?\n   * final? \n   * final? \n   * final?\n   * final?\n   *  final ?\n   * \n\n> B. Java - Java J.U.CJ.U.CLock, , @pdai\n\n * JUC - \n   * JUC?\n   * ?\n   * ?\n\n> B.1 Java - Java J.U.C1/5CASCAS, Unsafe\n\n * JUC: CAS, Unsafe\n   * ?\n   * CAS?\n   * CASAtomicInteger?\n   * CAS?\n   * Java?\n   * AtomicInteger? CAS+volatile\n   * Unsafe?\n   * Java? 134\n   * AtomicStampedReference?\n   * AtomicStampedReferenceABA? Pair\n   * javaABA? AtomicMarkableReference\n\n> B.2 Java - Java J.U.C2/5JUC\n\n * JUC: LockSupport\n   * LockSupport? AQSUnsafe(CAS)LockSupport(park/unpark)\n   * wait/notifyLockSupportpark/unpark?\n   * LockSupport.park()? Condition.await()?\n   * Thread.sleep()Object.wait()Condition.await()LockSupport.park()? \n   * wait()notify()?\n   * park()unpark()?\n * JUC: AQS\n   * AQS? ?\n   * AQS? ? \n   * AQS?\n   * AQS? AQS(ReentrantLock) (SemaphoreCountDownLatch CyclicBarrier )ReentrantReadWriteLock\n   * AQS? \n   * AQS?\n * JUC: ReentrantLock\n   * ? ?\n   * ReentrantLockAQS? \n   * ReentrantLock?\n   * ReentrantLock?\n   * ReentrantLock?\n   * ReentrantLock?\n   * ReentrantLockSynchronized?\n * JUC: ReentrantReadWriteLock\n   * ReentrantLockReentrantReadWriteLock?\n   * ReentrantReadWriteLock?\n   * ReentrantReadWriteLock? 1616\n   * ?\n   * ThreadLocalHoldCounter?\n   * HoldCounter?\n   * ?\n   * ?\n   * RentrantReadWriteLock?\n   * ? RentrantReadWriteLock?\n\n> B.3 Java - Java J.U.C3/5JUC\n\n * JUC: ConcurrentHashMap\n   * HashTable? ? ConcurrentHashMap?\n   * ConcurrentHashMapJDK1.7JDK1.8? JDK1.8JDK1.7\n   * ConcurrentHashMap JDK1.7? \n   * ConcurrentHashMap JDK1.8? ++CAS\n   * ConcurrentHashMap JDK1.7Segment(concurrencyLevel)? ?\n   * ConcurrentHashMap JDK1.7put?\n   * ConcurrentHashMap JDK1.7? rehash(segment  segment  HashEntry<K,V>[] )\n   * ConcurrentHashMap JDK1.8? tryPresize\n   * ConcurrentHashMap JDK1.8? 8?\n   * ConcurrentHashMap JDK1.8? transfer\n * JUC: CopyOnWriteArrayList\n   * Fail-fast?\n   * ArrayList?\n   * ArrayListCopyOnWriteArrayList? COW\n   * ? COWIterator<E>\n   * CopyOnWriteArrayListVector?\n   * CopyOnWriteArrayList?\n * JUC: ConcurrentLinkedQueue\n   * ? VectorCollections.synchronizedList( List<T> list), ConcurrentLinkedQueue\n   * ConcurrentLinkedQueue?\n   * ConcurrentLinkedQueue? (CAS)\n   * ConcurrentLinkedQueue? offer()poll()peek()isEmpty()\n   * ConcurrentLinkedQueueHOPS()?\n   * ConcurrentLinkedQueue?\n * JUC: BlockingQueue\n   * BlockingDeque?\n   * BlockingQueue? ArrayBlockingQueue, DelayQueue, LinkedBlockingQueue, SynchronousQueue...\n   * BlockingQueue?\n   * BlockingQueue?\n   * BlockingQueue? (add(o),offer(o),put(o),offer(o, timeout, timeunit))?\n   * BlockingDeque BlockingQueue?\n   * BlockingDeque?\n   * BlockingDeque?\n   * BlockingDeque BlockingQueue?\n\n> B.4 Java - Java J.U.C4/5JUC\n\n * JUC: FutureTask\n   * FutureTask? ?\n   * FutureTask?\n   * FutureTask?\n   * FutureTask?\n   * FutureTask?\n   * FutureTask? \n * JUC: ThreadPoolExecutor\n   * ?\n   * Java? \n   * Executors? ?\n   * ThreadPoolExecutor? \n   * ThreadPoolExecutor?\n   * workermaxSize?\n   * ThreadPoolExecutorRejectedExecutionHandler? ?\n   * ? execute > addWorker >runworker (getTask)\n   * ?\n   * ?\n   * ?\n   * ?\n * JUC: ScheduledThreadPool\n   * ScheduledThreadPoolExecutor?\n   * ScheduledThreadPoolExecutorThreadPoolExecutor?\n   * ScheduledThreadPoolExecutor?\n   * ScheduledThreadPoolExecutor? ?\n   * ScheduledThreadPoolExecutorscheduleAtFixedRate  scheduleWithFixedDelay?\n   * ThreadPoolExecutor  ScheduledThreadPoolExecutor?\n   * Executors  ScheduledThreadPoolExecutor?\n * JUC: Fork/Join\n   * Fork/Join?\n   * Fork/JoinJDK?\n   * Fork/Join? ?\n   * ForkJoinPool?\n   * ForkJoinTask?  RecursiveTask RecursiveAction  CountedCompleter  ForkJoinTask \n   * Fork/Join /?\n   * Fork/Joinwork-stealing ?\n   * JDKFork/Join?\n   * ExecutorsForkJoinPool?\n   * : ForkJoin1+2+3+...+100000?\n   * Fork/Join? JDK\n\n> B.5 Java - Java J.U.C5/5JUCThreadLocal\n\n * JUC: CountDownLatch\n   * CountDownLatch?\n   * CountDownLatch?\n   * CountDownLatch? \n   * CountDownLatch? await(),countDown()\n   * CountDownLatch?\n   * addsize 110252? CountDownLatch wait notify \n * JUC: CyclicBarrier\n   * CyclicBarrier?\n   * CyclicBarrier?\n   * CountDownLatchCyclicBarrier?\n   * CyclicBarrier?\n   * CyclicBarrier?\n * JUC: Semaphore\n   * Semaphore?\n   * Semaphore?\n   * Semaphore? ?\n   * Semaphore?\n   * SemaphoreAQS?\n   * Semaphore(acquire)(release)?\n   * Semaphore10111acquire?\n   * Semaphore1011acquire?\n   * Semaphore11acquirereleaseacquire(2)?\n   * Semaphore21release3?\n * JUC: Phaser\n   * Phaser?\n   * PhaserCyclicBarrierCountDownLatch?\n   * CountDownLatchPhaser?\n   * Phaser?\n   * Phaser?\n * JUC: Exchanger\n   * Exchanger?\n   * SynchronousQueueExchanger SynchronousQueue ?\n   * ExchangerJDK?\n   * Exchanger?\n   * Exchangerslotarena node? ?\n   * arenaslotarena?\n   * Exchanger?\n   * Exchanger\n * Java  - ThreadLocal\n   * ThreadLocal? ?\n   * ThreadLocal\n   * ThreadLocal?\n   * ThreadLocal? \n   * ThreadLocal?\n\n> C. Java - Java  ()@pdai\n\n * TODOJava  - ,\n * TODOJava  - \n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-overview.html\n\n https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html\n\n https://docs.oracle.com/javase/tutorial/essential/concurrency/atomic.html\n\nDoug Lea http://ifeve.com/doug-lea/\n\nJava https://github.com/CL0610/Java-concurrency\n\n() https://zhuanlan.zhihu.com/p/33616143",normalizedContent:"# java\n\n> java synchronizedvolatilefinal, juc\n\n * java\n   * \n   * \n   * \n\n\n# \n\n\n\n\n# \n\n> a. java - java java@pdai\n\n * java  - \n * java  - \n   * ?\n   * ? \n   * ? \n   * java? 3jmm8happens-before\n   * ? \n   * ?\n   * ?\n * java  - \n   * ? ?\n   * ?\n   * ?\n   * ?\n   * ? ?\n   * ?\n * java - java\n   * java\n * : synchronized\n   * synchronized? \n   * synchronized? \n   * synchronized? java lock\n   * synchronizedlock?\n   * synchronized?\n   * synchronized,?\n   * synchronizedjvm?\n   * synchronized?\n   * ()?\n   * ? jvm?\n   * jdksynchronized?\n * : volatile\n   * volatile?\n   * volatile?\n   * 32longdoublevolatile? 64?\n   * i++?\n   * volatile? \n   * volatile? happens-before\n   * volatile?\n * : final\n   * final?\n   * privatefinal?\n   * final? stringfinalmystringstringtomystring()?\n   * final? \n   * final? \n   * final?\n   * final?\n   *  final ?\n   * \n\n> b. java - java j.u.cj.u.clock, , @pdai\n\n * juc - \n   * juc?\n   * ?\n   * ?\n\n> b.1 java - java j.u.c1/5cascas, unsafe\n\n * juc: cas, unsafe\n   * ?\n   * cas?\n   * casatomicinteger?\n   * cas?\n   * java?\n   * atomicinteger? cas+volatile\n   * unsafe?\n   * java? 134\n   * atomicstampedreference?\n   * atomicstampedreferenceaba? pair\n   * javaaba? atomicmarkablereference\n\n> b.2 java - java j.u.c2/5juc\n\n * juc: locksupport\n   * locksupport? aqsunsafe(cas)locksupport(park/unpark)\n   * wait/notifylocksupportpark/unpark?\n   * locksupport.park()? condition.await()?\n   * thread.sleep()object.wait()condition.await()locksupport.park()? \n   * wait()notify()?\n   * park()unpark()?\n * juc: aqs\n   * aqs? ?\n   * aqs? ? \n   * aqs?\n   * aqs? aqs(reentrantlock) (semaphorecountdownlatch cyclicbarrier )reentrantreadwritelock\n   * aqs? \n   * aqs?\n * juc: reentrantlock\n   * ? ?\n   * reentrantlockaqs? \n   * reentrantlock?\n   * reentrantlock?\n   * reentrantlock?\n   * reentrantlock?\n   * reentrantlocksynchronized?\n * juc: reentrantreadwritelock\n   * reentrantlockreentrantreadwritelock?\n   * reentrantreadwritelock?\n   * reentrantreadwritelock? 1616\n   * ?\n   * threadlocalholdcounter?\n   * holdcounter?\n   * ?\n   * ?\n   * rentrantreadwritelock?\n   * ? rentrantreadwritelock?\n\n> b.3 java - java j.u.c3/5juc\n\n * juc: concurrenthashmap\n   * hashtable? ? concurrenthashmap?\n   * concurrenthashmapjdk1.7jdk1.8? jdk1.8jdk1.7\n   * concurrenthashmap jdk1.7? \n   * concurrenthashmap jdk1.8? ++cas\n   * concurrenthashmap jdk1.7segment(concurrencylevel)? ?\n   * concurrenthashmap jdk1.7put?\n   * concurrenthashmap jdk1.7? rehash(segment  segment  hashentry<k,v>[] )\n   * concurrenthashmap jdk1.8? trypresize\n   * concurrenthashmap jdk1.8? 8?\n   * concurrenthashmap jdk1.8? transfer\n * juc: copyonwritearraylist\n   * fail-fast?\n   * arraylist?\n   * arraylistcopyonwritearraylist? cow\n   * ? cowiterator<e>\n   * copyonwritearraylistvector?\n   * copyonwritearraylist?\n * juc: concurrentlinkedqueue\n   * ? vectorcollections.synchronizedlist( list<t> list), concurrentlinkedqueue\n   * concurrentlinkedqueue?\n   * concurrentlinkedqueue? (cas)\n   * concurrentlinkedqueue? offer()poll()peek()isempty()\n   * concurrentlinkedqueuehops()?\n   * concurrentlinkedqueue?\n * juc: blockingqueue\n   * blockingdeque?\n   * blockingqueue? arrayblockingqueue, delayqueue, linkedblockingqueue, synchronousqueue...\n   * blockingqueue?\n   * blockingqueue?\n   * blockingqueue? (add(o),offer(o),put(o),offer(o, timeout, timeunit))?\n   * blockingdeque blockingqueue?\n   * blockingdeque?\n   * blockingdeque?\n   * blockingdeque blockingqueue?\n\n> b.4 java - java j.u.c4/5juc\n\n * juc: futuretask\n   * futuretask? ?\n   * futuretask?\n   * futuretask?\n   * futuretask?\n   * futuretask?\n   * futuretask? \n * juc: threadpoolexecutor\n   * ?\n   * java? \n   * executors? ?\n   * threadpoolexecutor? \n   * threadpoolexecutor?\n   * workermaxsize?\n   * threadpoolexecutorrejectedexecutionhandler? ?\n   * ? execute > addworker >runworker (gettask)\n   * ?\n   * ?\n   * ?\n   * ?\n * juc: scheduledthreadpool\n   * scheduledthreadpoolexecutor?\n   * scheduledthreadpoolexecutorthreadpoolexecutor?\n   * scheduledthreadpoolexecutor?\n   * scheduledthreadpoolexecutor? ?\n   * scheduledthreadpoolexecutorscheduleatfixedrate  schedulewithfixeddelay?\n   * threadpoolexecutor  scheduledthreadpoolexecutor?\n   * executors  scheduledthreadpoolexecutor?\n * juc: fork/join\n   * fork/join?\n   * fork/joinjdk?\n   * fork/join? ?\n   * forkjoinpool?\n   * forkjointask?  recursivetask recursiveaction  countedcompleter  forkjointask \n   * fork/join /?\n   * fork/joinwork-stealing ?\n   * jdkfork/join?\n   * executorsforkjoinpool?\n   * : forkjoin1+2+3+...+100000?\n   * fork/join? jdk\n\n> b.5 java - java j.u.c5/5jucthreadlocal\n\n * juc: countdownlatch\n   * countdownlatch?\n   * countdownlatch?\n   * countdownlatch? \n   * countdownlatch? await(),countdown()\n   * countdownlatch?\n   * addsize 110252? countdownlatch wait notify \n * juc: cyclicbarrier\n   * cyclicbarrier?\n   * cyclicbarrier?\n   * countdownlatchcyclicbarrier?\n   * cyclicbarrier?\n   * cyclicbarrier?\n * juc: semaphore\n   * semaphore?\n   * semaphore?\n   * semaphore? ?\n   * semaphore?\n   * semaphoreaqs?\n   * semaphore(acquire)(release)?\n   * semaphore10111acquire?\n   * semaphore1011acquire?\n   * semaphore11acquirereleaseacquire(2)?\n   * semaphore21release3?\n * juc: phaser\n   * phaser?\n   * phasercyclicbarriercountdownlatch?\n   * countdownlatchphaser?\n   * phaser?\n   * phaser?\n * juc: exchanger\n   * exchanger?\n   * synchronousqueueexchanger synchronousqueue ?\n   * exchangerjdk?\n   * exchanger?\n   * exchangerslotarena node? ?\n   * arenaslotarena?\n   * exchanger?\n   * exchanger\n * java  - threadlocal\n   * threadlocal? ?\n   * threadlocal\n   * threadlocal?\n   * threadlocal? \n   * threadlocal?\n\n> c. java - java  ()@pdai\n\n * todojava  - ,\n * todojava  - \n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-overview.html\n\n https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html\n\n https://docs.oracle.com/javase/tutorial/essential/concurrency/atomic.html\n\ndoug lea http://ifeve.com/doug-lea/\n\njava https://github.com/cl0610/java-concurrency\n\n() https://zhuanlan.zhihu.com/p/33616143",charsets:{cjk:!0}},{title:"Spring",frontmatter:{},regularPath:"/spring/basic/spring.html",relativePath:"spring/basic/spring.md",key:"v-88e9c230",path:"/spring/basic/spring.html",headers:[{level:2,title:"Spring",slug:"spring",normalizedTitle:"spring",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:98}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Spring ",content:"# Spring\n\n\n\nSpringSpringIOCAOPSpringMVC\n\n\n# \n\n>  Spring\n\n * Spring - SpringSpring\n   * Spring? SpringSpring Framework\n\n\n\n> SpringIoCAOPIoCAOP\n\n * Spring - SpringSpring\n   * SpringSpring FrameworkSpring FrameworkSpring FrameworkSpringIOCAOP XMLJava\n\n\n\n * Spring - Spring(IOC)\n   * Spring - SpringSpringIoCIoC; IOCIOC\n\n\n\n * Spring - Spring(AOP)\n   * Spring - SpringSpringAOPAOP; AOPAOP\n\n\n\n> SpringIOCAOPwebSpringMVC\n\n * Spring - SpringMVC\n   * SpringSpringIOCAOPweb SpringMVCSpring MVCSpringSpring Container CoreAOPWeb MVCwebJavaweb SpringMVC\n\n\n\n> Spring - IoCAOPSpringMVC\n\n * Spring - Spring IOCIOC\n   * IoCIOCIOC\n\n\n\n * Spring - Spring IOCIOC\n   * IOCSpringxmlBeanDefinationIoC\n\n\n\n * Spring - Spring IOCBean(,)\n   * IOCSpringxmlBeanDefinationIoCBeanBeanDefinitionbeanDefinitionMapConcurrentHashMap<String, Object>BeanDefinitionClassBeanDefinitionBean\n\n\n\n * Spring - Spring AOP\n   * Spring IOCBeanSpring AOPIOCBeanSpring AOP(AdviceAdviceAdvisor)\n\n\n\n * Spring - Spring AOPAOP\n   * Spring AOP(AdviceAdviceAdvisor)cglibJDK\n\n\n\n * Spring - Spring AOPCglib\n   * SpringAOPCglibSpringAOP\n\n\n\n * Spring - Spring AOPJDK\n   * SpringAOP CglibSpringAOP JDK\n\n\n\n * Spring - SpringMVCDispatcherServlet\n   * IOCSpringMVCSpringMVCDispatcherServletDispatcherServletDispatcherServlet\n\n\n\n * Spring - SpringMVCDispatcherServlet\n   * IOCSpringMVCSpringMVCDispatcherServletDispatcherServletDispatcherServlet\n\n\n\n *  https://www.pdai.tech/md/spring/spring.html",normalizedContent:"# spring\n\n\n\nspringspringiocaopspringmvc\n\n\n# \n\n>  spring\n\n * spring - springspring\n   * spring? springspring framework\n\n\n\n> springiocaopiocaop\n\n * spring - springspring\n   * springspring frameworkspring frameworkspring frameworkspringiocaop xmljava\n\n\n\n * spring - spring(ioc)\n   * spring - springspringiocioc; iocioc\n\n\n\n * spring - spring(aop)\n   * spring - springspringaopaop; aopaop\n\n\n\n> springiocaopwebspringmvc\n\n * spring - springmvc\n   * springspringiocaopweb springmvcspring mvcspringspring container coreaopweb mvcwebjavaweb springmvc\n\n\n\n> spring - iocaopspringmvc\n\n * spring - spring iocioc\n   * iociocioc\n\n\n\n * spring - spring iocioc\n   * iocspringxmlbeandefinationioc\n\n\n\n * spring - spring iocbean(,)\n   * iocspringxmlbeandefinationiocbeanbeandefinitionbeandefinitionmapconcurrenthashmap<string, object>beandefinitionclassbeandefinitionbean\n\n\n\n * spring - spring aop\n   * spring iocbeanspring aopiocbeanspring aop(adviceadviceadvisor)\n\n\n\n * spring - spring aopaop\n   * spring aop(adviceadviceadvisor)cglibjdk\n\n\n\n * spring - spring aopcglib\n   * springaopcglibspringaop\n\n\n\n * spring - spring aopjdk\n   * springaop cglibspringaop jdk\n\n\n\n * spring - springmvcdispatcherservlet\n   * iocspringmvcspringmvcdispatcherservletdispatcherservletdispatcherservlet\n\n\n\n * spring - springmvcdispatcherservlet\n   * iocspringmvcspringmvcdispatcherservletdispatcherservletdispatcherservlet\n\n\n\n *  https://www.pdai.tech/md/spring/spring.html",charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/thread/java-thread-x-thread-basic.html",relativePath:"java/thread/java-thread-x-thread-basic.md",key:"v-4ffe6dba",path:"/java/thread/java-thread-x-thread-basic.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:659},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:85},{level:3,title:"(New)",slug:"-new",normalizedTitle:"(new)",charIndex:99},{level:3,title:"(Runnable)",slug:"-runnable",normalizedTitle:"(runnable)",charIndex:114},{level:3,title:"(Blocking)",slug:"-blocking",normalizedTitle:"(blocking)",charIndex:135},{level:3,title:"(Waiting)",slug:"-waiting",normalizedTitle:"(waiting)",charIndex:155},{level:3,title:"(Timed Waiting)",slug:"-timed-waiting",normalizedTitle:"(timed waiting)",charIndex:177},{level:3,title:"(Terminated)",slug:"-terminated",normalizedTitle:"(terminated)",charIndex:204},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:224},{level:3,title:" Runnable ",slug:"-runnable-",normalizedTitle:" runnable ",charIndex:238},{level:3,title:" Callable ",slug:"-callable-",normalizedTitle:" callable ",charIndex:260},{level:3,title:" Thread ",slug:"-thread-",normalizedTitle:" thread ",charIndex:282},{level:3,title:" VS  Thread",slug:"-vs--thread",normalizedTitle:" vs  thread",charIndex:301},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:324},{level:3,title:"Executor",slug:"executor",normalizedTitle:"executor",charIndex:338},{level:3,title:"Daemon",slug:"daemon",normalizedTitle:"daemon",charIndex:354},{level:3,title:"sleep()",slug:"sleep",normalizedTitle:"sleep()",charIndex:368},{level:3,title:"yield()",slug:"yield",normalizedTitle:"yield()",charIndex:383},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:396},{level:3,title:"InterruptedException",slug:"interruptedexception",normalizedTitle:"interruptedexception",charIndex:408},{level:3,title:"interrupted()",slug:"interrupted",normalizedTitle:"interrupted()",charIndex:436},{level:3,title:"Executor ",slug:"executor-",normalizedTitle:"executor ",charIndex:457},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:477},{level:3,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:491},{level:3,title:"ReentrantLock",slug:"reentrantlock",normalizedTitle:"reentrantlock",charIndex:511},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:532},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:542},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:552},{level:3,title:"join()",slug:"join",normalizedTitle:"join()",charIndex:567},{level:3,title:"wait() notify() notifyAll()",slug:"wait-notify-notifyall",normalizedTitle:"wait() notify() notifyall()",charIndex:581},{level:3,title:"await() signal() signalAll()",slug:"await-signal-signalall",normalizedTitle:"await() signal() signalall()",charIndex:616},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:650}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  -  BAT  (New) (Runnable) (Blocking) (Waiting) (Timed Waiting) (Terminated)   Runnable   Callable   Thread   VS  Thread  Executor Daemon sleep() yield()  InterruptedException interrupted() Executor   synchronized ReentrantLock    join() wait() notify() notifyAll() await() signal() signalAll() ",content:'# Java  - \n\n> Java\n\n * Java  - \n   * \n     * (New)\n     * (Runnable)\n     * (Blocking)\n     * (Waiting)\n     * (Timed Waiting)\n     * (Terminated)\n   * \n     *  Runnable \n     *  Callable \n     *  Thread \n     *  VS  Thread\n   * \n     * Executor\n     * Daemon\n     * sleep()\n     * yield()\n   * \n     * InterruptedException\n     * interrupted()\n     * Executor \n   * \n     * synchronized\n     * ReentrantLock\n     * \n     * \n   * \n     * join()\n     * wait() notify() notifyAll()\n     * await() signal() signalAll()\n   * \n\n\n# BAT\n\n\n\n@pdai\n\n * ? ?\n * ?\n * ?\n * ?\n * ? ?\n * ?\n\n\n# \n\n\n\n\n# (New)\n\n\n\n\n# (Runnable)\n\n CPU \n\n Running  Ready\n\n\n# (Blocking)\n\n\n\n\n# (Waiting)\n\n CPU \n\n                                \n Timeout  Object.wait()    Object.notify() / Object.notifyAll()\n Timeout  Thread.join()    \nLockSupport.park()                -\n\n\n# (Timed Waiting)\n\n\n\n Thread.sleep() \n\n Object.wait() \n\n\n\n Thread.sleep()  Object.wait() \n\n                               \nThread.sleep()                   \n Timeout  Object.wait()     / Object.notify() / Object.notifyAll()\n Timeout  Thread.join()     / \nLockSupport.parkNanos()          -\nLockSupport.parkUntil()          -\n\n\n# (Terminated)\n\n\n\n\n# \n\n:\n\n *  Runnable \n *  Callable \n *  Thread \n\n Runnable  Callable  Thread \n\n\n#  Runnable \n\n run() \n\n Thread  start() \n\npublic class MyRunnable implements Runnable {\n    public void run() {\n        // ...\n    }\n}\n\n\npublic static void main(String[] args) {\n    MyRunnable instance = new MyRunnable();\n    Thread thread = new Thread(instance);\n    thread.start();\n}\n\n\n\n#  Callable \n\n Runnable Callable  FutureTask \n\npublic class MyCallable implements Callable<Integer> {\n    public Integer call() {\n        return 123;\n    }\n}\n\n\npublic static void main(String[] args) throws ExecutionException, InterruptedException {\n    MyCallable mc = new MyCallable();\n    FutureTask<Integer> ft = new FutureTask<>(mc);\n    Thread thread = new Thread(ft);\n    thread.start();\n    System.out.println(ft.get());\n}\n\n\n\n#  Thread \n\n run()  Thread  Runable \n\n start()  run() \n\npublic class MyThread extends Thread {\n    public void run() {\n        // ...\n    }\n}\n\n\npublic static void main(String[] args) {\n    MyThread mt = new MyThread();\n    mt.start();\n}\n\n\n\n#  VS  Thread\n\n:\n\n * Java  Thread \n *  Thread \n\n\n# \n\n\n# Executor\n\nExecutor \n\n Executor:\n\n * CachedThreadPool: \n * FixedThreadPool: \n * SingleThreadExecutor:  1  FixedThreadPool\n\npublic static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < 5; i++) {\n        executorService.execute(new MyRunnable());\n    }\n    executorService.shutdown();\n}\n\n\n\n# Daemon\n\n\n\n\n\nmain() \n\n setDaemon() \n\npublic static void main(String[] args) {\n    Thread thread = new Thread(new MyRunnable());\n    thread.setDaemon(true);\n}\n\n\n\n# sleep()\n\nThread.sleep(millisec) millisec \n\nsleep()  InterruptedException main() \n\npublic void run() {\n    try {\n        Thread.sleep(3000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}\n\n\n\n# yield()\n\n Thread.yield() \n\npublic void run() {\n    Thread.yield();\n}\n\n\n\n# \n\n\n\n\n# InterruptedException\n\n interrupt()  InterruptedException I/O  synchronized \n\n main()  Thread.sleep()  InterruptedException\n\npublic class InterruptExample {\n\n    private static class MyThread1 extends Thread {\n        @Override\n        public void run() {\n            try {\n                Thread.sleep(2000);\n                System.out.println("Thread run");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\n\npublic static void main(String[] args) throws InterruptedException {\n    Thread thread1 = new MyThread1();\n    thread1.start();\n    thread1.interrupt();\n    System.out.println("Main run");\n}\n\n\nMain run\njava.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at InterruptExample.lambda$main$0(InterruptExample.java:5)\n    at InterruptExample$$Lambda$1/713338599.run(Unknown Source)\n    at java.lang.Thread.run(Thread.java:745)\n\n\n\n# interrupted()\n\n run()  sleep()  InterruptedException  interrupt() \n\n interrupt()  interrupted()  true interrupted() \n\npublic class InterruptExample {\n\n    private static class MyThread2 extends Thread {\n        @Override\n        public void run() {\n            while (!interrupted()) {\n                // ..\n            }\n            System.out.println("Thread end");\n        }\n    }\n}\n\n\npublic static void main(String[] args) throws InterruptedException {\n    Thread thread2 = new MyThread2();\n    thread2.start();\n    thread2.interrupt();\n}\n\n\n\n# Executor \n\n Executor  shutdown()  shutdownNow()  interrupt() \n\n Lambda \n\npublic static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> {\n        try {\n            Thread.sleep(2000);\n            System.out.println("Thread run");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n    executorService.shutdownNow();\n    System.out.println("Main run");\n}\n\n\nMain run\njava.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at ExecutorInterruptExample.lambda$main$0(ExecutorInterruptExample.java:9)\n    at ExecutorInterruptExample$$Lambda$1/1160460865.run(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n\n\n Executor  submit()  Future<?>  cancel(true) \n\nFuture<?> future = executorService.submit(() -> {\n    // ..\n});\nfuture.cancel(true);\n\n\n\n# \n\nJava  JVM  synchronized JDK  ReentrantLock\n\n\n# synchronized\n\n1. \n\npublic void func() {\n    synchronized (this) {\n        // ...\n    }\n}\n\n\n\n\n ExecutorService \n\npublic class SynchronizedExample {\n\n    public void func1() {\n        synchronized (this) {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        }\n    }\n}\n\n\npublic static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func1());\n    executorService.execute(() -> e1.func1());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n\n\npublic static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    SynchronizedExample e2 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func1());\n    executorService.execute(() -> e2.func1());\n}\n\n\n0 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9\n\n\n2. \n\npublic synchronized void func () {\n    // ...\n}\n\n\n\n\n3. \n\npublic void func() {\n    synchronized (SynchronizedExample.class) {\n        // ...\n    }\n}\n\n\n\n\npublic class SynchronizedExample {\n\n    public void func2() {\n        synchronized (SynchronizedExample.class) {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        }\n    }\n}\n\n\npublic static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    SynchronizedExample e2 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func2());\n    executorService.execute(() -> e2.func2());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n4. \n\npublic synchronized static void fun() {\n    // ...\n}\n\n\n\n\n\n# ReentrantLock\n\nReentrantLock  java.util.concurrent(J.U.C)\n\npublic class LockExample {\n\n    private Lock lock = new ReentrantLock();\n\n    public void func() {\n        lock.lock();\n        try {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        } finally {\n            lock.unlock(); // \n        }\n    }\n}\n\n\npublic static void main(String[] args) {\n    LockExample lockExample = new LockExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> lockExample.func());\n    executorService.execute(() -> lockExample.func());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n\n# \n\n1. \n\nsynchronized  JVM  ReentrantLock  JDK \n\n2. \n\n Java  synchronized synchronized  ReentrantLock \n\n3. \n\n\n\nReentrantLock  synchronized \n\n4. \n\n\n\nsynchronized ReentrantLock \n\n5. \n\n ReentrantLock  Condition \n\n\n# \n\n ReentrantLock  synchronized synchronized  JVM JVM  ReentrantLock  JDK  synchronized  JVM \n\n\n# \n\n\n\n\n# join()\n\n join() \n\n b  b  a  join() b  a  a  b \n\npublic class JoinExample {\n\n    private class A extends Thread {\n        @Override\n        public void run() {\n            System.out.println("A");\n        }\n    }\n\n    private class B extends Thread {\n\n        private A a;\n\n        B(A a) {\n            this.a = a;\n        }\n\n        @Override\n        public void run() {\n            try {\n                a.join();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("B");\n        }\n    }\n\n    public void test() {\n        A a = new A();\n        B b = new B(a);\n        b.start();\n        a.start();\n    }\n}\n\n\npublic static void main(String[] args) {\n    JoinExample example = new JoinExample();\n    example.test();\n}\n\n\n\n# wait() notify() notifyAll()\n\n wait()  notify()  notifyAll() \n\n Object  Thread\n\n IllegalMonitorStateExeception\n\n wait()  notify()  notifyAll() \n\npublic class WaitNotifyExample {\n    public synchronized void before() {\n        System.out.println("before");\n        notifyAll();\n    }\n\n    public synchronized void after() {\n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println("after");\n    }\n}\n\n\npublic static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    WaitNotifyExample example = new WaitNotifyExample();\n    executorService.execute(() -> example.after());\n    executorService.execute(() -> example.before());\n}\n\n\nwait()  sleep() \n\n * wait()  Object  sleep()  Thread \n * wait() sleep() \n\n\n# await() signal() signalAll()\n\njava.util.concurrent  Condition  Condition  await()  signal()  signalAll()  wait() await() \n\n Lock  Condition \n\npublic class AwaitSignalExample {\n    private Lock lock = new ReentrantLock();\n    private Condition condition = lock.newCondition();\n\n    public void before() {\n        lock.lock();\n        try {\n            System.out.println("before");\n            condition.signalAll();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void after() {\n        lock.lock();\n        try {\n            condition.await();\n            System.out.println("after");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\n\npublic static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    AwaitSignalExample example = new AwaitSignalExample();\n    executorService.execute(() -> example.after());\n    executorService.execute(() -> example.before());\n}\n\n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-thread-basic.html',normalizedContent:'# java  - \n\n> java\n\n * java  - \n   * \n     * (new)\n     * (runnable)\n     * (blocking)\n     * (waiting)\n     * (timed waiting)\n     * (terminated)\n   * \n     *  runnable \n     *  callable \n     *  thread \n     *  vs  thread\n   * \n     * executor\n     * daemon\n     * sleep()\n     * yield()\n   * \n     * interruptedexception\n     * interrupted()\n     * executor \n   * \n     * synchronized\n     * reentrantlock\n     * \n     * \n   * \n     * join()\n     * wait() notify() notifyall()\n     * await() signal() signalall()\n   * \n\n\n# bat\n\n\n\n@pdai\n\n * ? ?\n * ?\n * ?\n * ?\n * ? ?\n * ?\n\n\n# \n\n\n\n\n# (new)\n\n\n\n\n# (runnable)\n\n cpu \n\n running  ready\n\n\n# (blocking)\n\n\n\n\n# (waiting)\n\n cpu \n\n                                \n timeout  object.wait()    object.notify() / object.notifyall()\n timeout  thread.join()    \nlocksupport.park()                -\n\n\n# (timed waiting)\n\n\n\n thread.sleep() \n\n object.wait() \n\n\n\n thread.sleep()  object.wait() \n\n                               \nthread.sleep()                   \n timeout  object.wait()     / object.notify() / object.notifyall()\n timeout  thread.join()     / \nlocksupport.parknanos()          -\nlocksupport.parkuntil()          -\n\n\n# (terminated)\n\n\n\n\n# \n\n:\n\n *  runnable \n *  callable \n *  thread \n\n runnable  callable  thread \n\n\n#  runnable \n\n run() \n\n thread  start() \n\npublic class myrunnable implements runnable {\n    public void run() {\n        // ...\n    }\n}\n\n\npublic static void main(string[] args) {\n    myrunnable instance = new myrunnable();\n    thread thread = new thread(instance);\n    thread.start();\n}\n\n\n\n#  callable \n\n runnable callable  futuretask \n\npublic class mycallable implements callable<integer> {\n    public integer call() {\n        return 123;\n    }\n}\n\n\npublic static void main(string[] args) throws executionexception, interruptedexception {\n    mycallable mc = new mycallable();\n    futuretask<integer> ft = new futuretask<>(mc);\n    thread thread = new thread(ft);\n    thread.start();\n    system.out.println(ft.get());\n}\n\n\n\n#  thread \n\n run()  thread  runable \n\n start()  run() \n\npublic class mythread extends thread {\n    public void run() {\n        // ...\n    }\n}\n\n\npublic static void main(string[] args) {\n    mythread mt = new mythread();\n    mt.start();\n}\n\n\n\n#  vs  thread\n\n:\n\n * java  thread \n *  thread \n\n\n# \n\n\n# executor\n\nexecutor \n\n executor:\n\n * cachedthreadpool: \n * fixedthreadpool: \n * singlethreadexecutor:  1  fixedthreadpool\n\npublic static void main(string[] args) {\n    executorservice executorservice = executors.newcachedthreadpool();\n    for (int i = 0; i < 5; i++) {\n        executorservice.execute(new myrunnable());\n    }\n    executorservice.shutdown();\n}\n\n\n\n# daemon\n\n\n\n\n\nmain() \n\n setdaemon() \n\npublic static void main(string[] args) {\n    thread thread = new thread(new myrunnable());\n    thread.setdaemon(true);\n}\n\n\n\n# sleep()\n\nthread.sleep(millisec) millisec \n\nsleep()  interruptedexception main() \n\npublic void run() {\n    try {\n        thread.sleep(3000);\n    } catch (interruptedexception e) {\n        e.printstacktrace();\n    }\n}\n\n\n\n# yield()\n\n thread.yield() \n\npublic void run() {\n    thread.yield();\n}\n\n\n\n# \n\n\n\n\n# interruptedexception\n\n interrupt()  interruptedexception i/o  synchronized \n\n main()  thread.sleep()  interruptedexception\n\npublic class interruptexample {\n\n    private static class mythread1 extends thread {\n        @override\n        public void run() {\n            try {\n                thread.sleep(2000);\n                system.out.println("thread run");\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        }\n    }\n}\n\n\npublic static void main(string[] args) throws interruptedexception {\n    thread thread1 = new mythread1();\n    thread1.start();\n    thread1.interrupt();\n    system.out.println("main run");\n}\n\n\nmain run\njava.lang.interruptedexception: sleep interrupted\n    at java.lang.thread.sleep(native method)\n    at interruptexample.lambda$main$0(interruptexample.java:5)\n    at interruptexample$$lambda$1/713338599.run(unknown source)\n    at java.lang.thread.run(thread.java:745)\n\n\n\n# interrupted()\n\n run()  sleep()  interruptedexception  interrupt() \n\n interrupt()  interrupted()  true interrupted() \n\npublic class interruptexample {\n\n    private static class mythread2 extends thread {\n        @override\n        public void run() {\n            while (!interrupted()) {\n                // ..\n            }\n            system.out.println("thread end");\n        }\n    }\n}\n\n\npublic static void main(string[] args) throws interruptedexception {\n    thread thread2 = new mythread2();\n    thread2.start();\n    thread2.interrupt();\n}\n\n\n\n# executor \n\n executor  shutdown()  shutdownnow()  interrupt() \n\n lambda \n\npublic static void main(string[] args) {\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> {\n        try {\n            thread.sleep(2000);\n            system.out.println("thread run");\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    });\n    executorservice.shutdownnow();\n    system.out.println("main run");\n}\n\n\nmain run\njava.lang.interruptedexception: sleep interrupted\n    at java.lang.thread.sleep(native method)\n    at executorinterruptexample.lambda$main$0(executorinterruptexample.java:9)\n    at executorinterruptexample$$lambda$1/1160460865.run(unknown source)\n    at java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1142)\n    at java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:617)\n    at java.lang.thread.run(thread.java:745)\n\n\n executor  submit()  future<?>  cancel(true) \n\nfuture<?> future = executorservice.submit(() -> {\n    // ..\n});\nfuture.cancel(true);\n\n\n\n# \n\njava  jvm  synchronized jdk  reentrantlock\n\n\n# synchronized\n\n1. \n\npublic void func() {\n    synchronized (this) {\n        // ...\n    }\n}\n\n\n\n\n executorservice \n\npublic class synchronizedexample {\n\n    public void func1() {\n        synchronized (this) {\n            for (int i = 0; i < 10; i++) {\n                system.out.print(i + " ");\n            }\n        }\n    }\n}\n\n\npublic static void main(string[] args) {\n    synchronizedexample e1 = new synchronizedexample();\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> e1.func1());\n    executorservice.execute(() -> e1.func1());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n\n\npublic static void main(string[] args) {\n    synchronizedexample e1 = new synchronizedexample();\n    synchronizedexample e2 = new synchronizedexample();\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> e1.func1());\n    executorservice.execute(() -> e2.func1());\n}\n\n\n0 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9\n\n\n2. \n\npublic synchronized void func () {\n    // ...\n}\n\n\n\n\n3. \n\npublic void func() {\n    synchronized (synchronizedexample.class) {\n        // ...\n    }\n}\n\n\n\n\npublic class synchronizedexample {\n\n    public void func2() {\n        synchronized (synchronizedexample.class) {\n            for (int i = 0; i < 10; i++) {\n                system.out.print(i + " ");\n            }\n        }\n    }\n}\n\n\npublic static void main(string[] args) {\n    synchronizedexample e1 = new synchronizedexample();\n    synchronizedexample e2 = new synchronizedexample();\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> e1.func2());\n    executorservice.execute(() -> e2.func2());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n4. \n\npublic synchronized static void fun() {\n    // ...\n}\n\n\n\n\n\n# reentrantlock\n\nreentrantlock  java.util.concurrent(j.u.c)\n\npublic class lockexample {\n\n    private lock lock = new reentrantlock();\n\n    public void func() {\n        lock.lock();\n        try {\n            for (int i = 0; i < 10; i++) {\n                system.out.print(i + " ");\n            }\n        } finally {\n            lock.unlock(); // \n        }\n    }\n}\n\n\npublic static void main(string[] args) {\n    lockexample lockexample = new lockexample();\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> lockexample.func());\n    executorservice.execute(() -> lockexample.func());\n}\n\n\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n\n\n\n# \n\n1. \n\nsynchronized  jvm  reentrantlock  jdk \n\n2. \n\n java  synchronized synchronized  reentrantlock \n\n3. \n\n\n\nreentrantlock  synchronized \n\n4. \n\n\n\nsynchronized reentrantlock \n\n5. \n\n reentrantlock  condition \n\n\n# \n\n reentrantlock  synchronized synchronized  jvm jvm  reentrantlock  jdk  synchronized  jvm \n\n\n# \n\n\n\n\n# join()\n\n join() \n\n b  b  a  join() b  a  a  b \n\npublic class joinexample {\n\n    private class a extends thread {\n        @override\n        public void run() {\n            system.out.println("a");\n        }\n    }\n\n    private class b extends thread {\n\n        private a a;\n\n        b(a a) {\n            this.a = a;\n        }\n\n        @override\n        public void run() {\n            try {\n                a.join();\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("b");\n        }\n    }\n\n    public void test() {\n        a a = new a();\n        b b = new b(a);\n        b.start();\n        a.start();\n    }\n}\n\n\npublic static void main(string[] args) {\n    joinexample example = new joinexample();\n    example.test();\n}\n\n\n\n# wait() notify() notifyall()\n\n wait()  notify()  notifyall() \n\n object  thread\n\n illegalmonitorstateexeception\n\n wait()  notify()  notifyall() \n\npublic class waitnotifyexample {\n    public synchronized void before() {\n        system.out.println("before");\n        notifyall();\n    }\n\n    public synchronized void after() {\n        try {\n            wait();\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println("after");\n    }\n}\n\n\npublic static void main(string[] args) {\n    executorservice executorservice = executors.newcachedthreadpool();\n    waitnotifyexample example = new waitnotifyexample();\n    executorservice.execute(() -> example.after());\n    executorservice.execute(() -> example.before());\n}\n\n\nwait()  sleep() \n\n * wait()  object  sleep()  thread \n * wait() sleep() \n\n\n# await() signal() signalall()\n\njava.util.concurrent  condition  condition  await()  signal()  signalall()  wait() await() \n\n lock  condition \n\npublic class awaitsignalexample {\n    private lock lock = new reentrantlock();\n    private condition condition = lock.newcondition();\n\n    public void before() {\n        lock.lock();\n        try {\n            system.out.println("before");\n            condition.signalall();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void after() {\n        lock.lock();\n        try {\n            condition.await();\n            system.out.println("after");\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\n\npublic static void main(string[] args) {\n    executorservice executorservice = executors.newcachedthreadpool();\n    awaitsignalexample example = new awaitsignalexample();\n    executorservice.execute(() -> example.after());\n    executorservice.execute(() -> example.before());\n}\n\n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-thread-basic.html',charsets:{cjk:!0}},{title:"Java  - ThreadLocal",frontmatter:{},regularPath:"/java/thread/java-thread-x-threadlocal.html",relativePath:"java/thread/java-thread-x-threadlocal.md",key:"v-064549ee",path:"/java/thread/java-thread-x-threadlocal.html",headers:[{level:2,title:"Java  - ThreadLocal",slug:"java--threadlocal",normalizedTitle:"java  - threadlocal",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:140},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:161},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:180},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:199},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:220},{level:3,title:"ThreadLocalMap",slug:"threadlocalmap",normalizedTitle:"threadlocalmap",charIndex:236},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:261},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:287},{level:3,title:"",slug:"-",normalizedTitle:"",charIndex:312},{level:3,title:"Session",slug:"session",normalizedTitle:"session",charIndex:334},{level:3,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:352},{level:3,title:"java  ThreadLocal",slug:"java--threadlocal",normalizedTitle:"java  threadlocal",charIndex:378},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:409}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"Java  - ThreadLocal BAT ThreadLocal ThreadLocal ThreadLocal  ThreadLocalMap ThreadLocal ThreadLocal  Session ThreadLocal java  ThreadLocal ",content:'# Java  - ThreadLocal\n\n> ThreadLocal, \n\n * Java  - ThreadLocal\n   * BAT\n   * ThreadLocal\n   * ThreadLocal\n   * ThreadLocal\n     * \n     * ThreadLocalMap\n   * ThreadLocal\n   * ThreadLocal\n     * \n     * Session\n     * ThreadLocal\n     * java  ThreadLocal\n   * \n\n\n# BAT\n\n\n\n\n\n * ThreadLocal? ?\n * ThreadLocal\n * ThreadLocal?\n * ThreadLocal? \n * ThreadLocal?\n\n\n# ThreadLocal\n\nJava  - ()\n\n * : synchronized  ReentrantLock\n * : CAS, AtomicXXXX\n * : (Thread Local)\n\n (Thread Local)\n\n> This class provides thread-local variables. These variables differ from their normal counterparts in that each thread that accesses one (via its {@code get} or {@code set} method) has its own, independently initialized copy of the variable. {@code ThreadLocal} instances are typically private static fields in classes that wish to associate state with a thread (e.g., a user ID or Transaction ID)  (thread-local) ( get  set )ThreadLocal  private static ( ID  ID)\n\nThreadLocal; ThreadLocal, ThreadLocal, \n\n\n# ThreadLocal\n\n> ThreadLocalsessionThreadLocal\n\n * \n\nclass ConnectionManager {\n    private static Connection connect = null;\n\n    public static Connection openConnection() {\n        if (connect == null) {\n            connect = DriverManager.getConnection();\n        }\n        return connect;\n    }\n\n    public static void closeConnection() {\n        if (connect != null)\n            connect.close();\n    }\n}\n\n\n2openConnectionconnectconnectconnectconnectcloseConnection\n\n * \n\nconnectSynchronizedReentrantLock\n\n * connect?\n\nconnectconnectconnect\n\nclass ConnectionManager {\n    private Connection connect = null;\n\n    public Connection openConnection() {\n        if (connect == null) {\n            connect = DriverManager.getConnection();\n        }\n        return connect;\n    }\n\n    public void closeConnection() {\n        if (connect != null)\n            connect.close();\n    }\n}\n\nclass Dao {\n    public void insert() {\n        ConnectionManager connectionManager = new ConnectionManager();\n        Connection connection = connectionManager.openConnection();\n\n        // connection\n\n        connectionManager.closeConnection();\n    }\n}\n\n\n\n\n * ThreadLocal\n\nThreadLocalThreadLocal\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.SQLException;\n\npublic class ConnectionManager {\n\n    private static final ThreadLocal<Connection> dbConnectionLocal = new ThreadLocal<Connection>() {\n        @Override\n        protected Connection initialValue() {\n            try {\n                return DriverManager.getConnection("", "", "");\n            } catch (SQLException e) {\n                e.printStackTrace();\n            }\n            return null;\n        }\n    };\n\n    public Connection getConnection() {\n        return dbConnectionLocal.get();\n    }\n}\n\n\n * ThreadLocal\n\nThreaLocalJDKThreadLocal instances are typically private static fields in classes that wish to associate state with a thread(IDID)private staticThreadLocal \n\n> ThreadLocalThreadLocal\n\n\n# ThreadLocal\n\n\n# \n\nThreadThreadLocalMapthreadLocals, Connection, dbConnectionLocal() Key, ConnectionValue; , ThreadLocalinitialValueConnection;\n\n:\n\npublic T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap threadLocals = getMap(t);\n    if (threadLocals != null) {\n        ThreadLocalMap.Entry e = threadLocals.getEntry(this);\n        if (e != null) {\n            @SuppressWarnings("unchecked")\n            T result = (T)e.value;\n            return result;\n        }\n    }\n    return setInitialValue();\n}\n\n\n * t, tThreadLocalMapthreadLocals\n * threadLocals(null) ThreadLocalKey, (Connection);\n * threadLocals(null)ThreadLocalKey, Connection, threadLocals Map,\n * threadLocals, ThreadLocalMap, ConnectionThreadLocalMap\n\n, ?\n\nprivate T setInitialValue() {\n    T value = initialValue();\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createMap(t, value);\n    return value;\n}\n\n\n * initialValue, Connection\n\n * threadLocals, ThreadLocalMap, ThreadLocalMap, , ;\n\n, ThreadLocalThreadthreadLocals\n\npublic void set(T value) {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createMap(t, value);\n}\n\n\ninitialValue, DBConnectionFactorygetConnection:\n\npublic Connection getConnection() {\n    Connection connection = dbConnectionLocal.get();\n    if (connection == null) {\n        try {\n            connection = DriverManager.getConnection("", "", "");\n            dbConnectionLocal.set(connection);\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n    return connection;\n}\n\n\nThreadLocal; Map, threadLocals, key;\n\nMap, ;\n\nThreadLocal, ThreadLocal? ThreadLocalMap, ?\n\n\n# ThreadLocalMap\n\n, Map, ThreadLocalMapMap\n\n * Map;\n * public, default, ThreadLocalMapThreadLocal, \n * ThreadLocalMapEntryWeakReference<ThreadLocal<?>>\n * EntryKey, Value; Entry, bucketEntry;\n\nThreadLocalMap, , Map:\n\nprivate void set(ThreadLocal<?> key, Object value) {\n\n    // We don\'t use a fast path as with get() because it is at\n    // least as common to use set() to create new entries as\n    // it is to replace existing ones, in which case, a fast\n    // path would fail more often than not.\n\n    Entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadLocalHashCode & (len-1);\n\n    for (Entry e = tab[i];\n         e != null;\n         e = tab[i = nextIndex(i, len)]) {\n        ThreadLocal<?> k = e.get();\n\n        if (k == key) {\n            e.value = value;\n            return;\n        }\n\n        if (k == null) {\n            replaceStaleEntry(key, value, i);\n            return;\n        }\n    }\n\n    tab[i] = new Entry(key, value);\n    int sz = ++size;\n    if (!cleanSomeSlots(i, sz) && sz >= threshold)\n        rehash();\n}\n\n\n, :\n\n * threadLocal : i = 2,  i = 2 (Entry)KeythreadLocal  Key, , EntryValue;\n *  Entry  Key, ThreadLocal, replaceStaleEntry\n * (ThreadLocal) > Table , HashMap,  ;\n\nSet, Get:\n\nprivate Entry getEntry(ThreadLocal<?> key) {\n    int i = key.threadLocalHashCode & (table.length - 1);\n    Entry e = table[i];\n    if (e != null && e.get() == key)\n        return e;\n    else\n        return getEntryAfterMiss(key, i, e);\n}\n\n\nThreadLocal, entrythreadLocal, ; \n\n\n# ThreadLocal\n\n\n\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.concurrent.ThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\n\npublic class ThreadLocalDemo {\n    static class LocalVariable {\n        private Long[] a = new Long[1024 * 1024];\n    }\n\n    // (1)\n    final static ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor(5, 5, 1, TimeUnit.MINUTES,\n            new LinkedBlockingQueue<>());\n    // (2)\n    final static ThreadLocal<LocalVariable> localVariable = new ThreadLocal<LocalVariable>();\n\n    public static void main(String[] args) throws InterruptedException {\n        // (3)\n        Thread.sleep(5000 * 4);\n        for (int i = 0; i < 50; ++i) {\n            poolExecutor.execute(new Runnable() {\n                public void run() {\n                    // (4)\n                    localVariable.set(new LocalVariable());\n                    // (5)\n                    System.out.println("use local varaible" + localVariable.get());\n                    localVariable.remove();\n                }\n            });\n        }\n        // (6)\n        System.out.println("pool execute over");\n    }\n}\n\n\nThreadLocal , , <ThreadLocal, LocalVariable>, final static  ThreadLocal , ThreadLocalMap  Key , , , LocalVariable, ; LocalVariable, ,  =  * LocalVariable;\n\n, , ThreadLocal,  remove,  ThreadLocalMap remove:\n\nprivate void remove(ThreadLocal<?> key) {\n    Entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadLocalHashCode & (len-1);\n    for (Entry e = tab[i];\n         e != null;\n         e = tab[i = nextIndex(i, len)]) {\n        if (e.get() == key) {\n            e.clear();\n            expungeStaleEntry(i);\n            return;\n        }\n    }\n}\n\n\nKeyEntry, EntryKey(ThreadLocal), Entry\n\n\n# ThreadLocal\n\n\n\n\n# \n\n> (IDID)private staticThreadLocal \n\n\n\npublic class SerialNum {\n    // The next serial number to be assigned\n    private static int nextSerialNum = 0;\n\n    private static ThreadLocal serialNum = new ThreadLocal() {\n        protected synchronized Object initialValue() {\n            return new Integer(nextSerialNum++);\n        }\n    };\n\n    public static int get() {\n        return ((Integer) (serialNum.get())).intValue();\n    }\n}\n\n\n\n# Session\n\n\n\nprivate static final ThreadLocal threadSession = new ThreadLocal();  \n  \npublic static Session getSession() throws InfrastructureException {  \n    Session s = (Session) threadSession.get();  \n    try {  \n        if (s == null) {  \n            s = getSessionFactory().openSession();  \n            threadSession.set(s);  \n        }  \n    } catch (HibernateException ex) {  \n        throw new InfrastructureException(ex);  \n    }  \n    return s;  \n}  \n\n\n\n# ThreadLocal\n\nThreadLocal\n\n * (ThreadDemo)ThreadLocalthreadXxxxxx\n * ThreadDemogetXxx()ThreadLocalnullnew()\n * ThreadDemorun()getXxx()\n\npublic class ThreadLocalTest implements Runnable{\n    \n    ThreadLocal<Student> StudentThreadLocal = new ThreadLocal<Student>();\n\n    @Override\n    public void run() {\n        String currentThreadName = Thread.currentThread().getName();\n        System.out.println(currentThreadName + " is running...");\n        Random random = new Random();\n        int age = random.nextInt(100);\n        System.out.println(currentThreadName + " is set age: "  + age);\n        Student Student = getStudentt(); //newStudenttStudentt\n        Student.setAge(age);\n        System.out.println(currentThreadName + " is first get age: " + Student.getAge());\n        try {\n            Thread.sleep(500);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println( currentThreadName + " is second get age: " + Student.getAge());\n        \n    }\n    \n    private Student getStudentt() {\n        Student Student = StudentThreadLocal.get();\n        if (null == Student) {\n            Student = new Student();\n            StudentThreadLocal.set(Student);\n        }\n        return Student;\n    }\n\n    public static void main(String[] args) {\n        ThreadLocalTest t = new ThreadLocalTest();\n        Thread t1 = new Thread(t,"Thread A");\n        Thread t2 = new Thread(t,"Thread B");\n        t1.start();\n        t2.start();\n    }\n    \n}\n\nclass Student{\n    int age;\n    public int getAge() {\n        return age;\n    }\n    public void setAge(int age) {\n        this.age = age;\n    }\n    \n}\n\n\n\n# java  ThreadLocal\n\n java  ThreadLocal :\n\nimport java.text.DateFormat;\nimport java.text.SimpleDateFormat;\n \npublic class DateUtils {\n    public static final ThreadLocal<DateFormat> df = new ThreadLocal<DateFormat>(){\n        @Override\n        protected DateFormat initialValue() {\n            return new SimpleDateFormat("yyyy-MM-dd");\n        }\n    };\n}\n\n\n DateFormat \n\nDateUtils.df.get().format(new Date());\n\n\n\n# \n\n * https://blog.csdn.net/vking_wang/article/details/14225379\n * https://mp.weixin.qq.com/s/mo3-y-45_ao54b5T7ez7iA\n * https://www.xttblog.com/?p=3087\n * https://blog.csdn.net/whut2010hj/article/details/81413887\n * https://segmentfault.com/a/1190000018399795\n *  https://www.pdai.tech/md/java/thread/java-thread-x-threadlocal.html',normalizedContent:'# java  - threadlocal\n\n> threadlocal, \n\n * java  - threadlocal\n   * bat\n   * threadlocal\n   * threadlocal\n   * threadlocal\n     * \n     * threadlocalmap\n   * threadlocal\n   * threadlocal\n     * \n     * session\n     * threadlocal\n     * java  threadlocal\n   * \n\n\n# bat\n\n\n\n\n\n * threadlocal? ?\n * threadlocal\n * threadlocal?\n * threadlocal? \n * threadlocal?\n\n\n# threadlocal\n\njava  - ()\n\n * : synchronized  reentrantlock\n * : cas, atomicxxxx\n * : (thread local)\n\n (thread local)\n\n> this class provides thread-local variables. these variables differ from their normal counterparts in that each thread that accesses one (via its {@code get} or {@code set} method) has its own, independently initialized copy of the variable. {@code threadlocal} instances are typically private static fields in classes that wish to associate state with a thread (e.g., a user id or transaction id)  (thread-local) ( get  set )threadlocal  private static ( id  id)\n\nthreadlocal; threadlocal, threadlocal, \n\n\n# threadlocal\n\n> threadlocalsessionthreadlocal\n\n * \n\nclass connectionmanager {\n    private static connection connect = null;\n\n    public static connection openconnection() {\n        if (connect == null) {\n            connect = drivermanager.getconnection();\n        }\n        return connect;\n    }\n\n    public static void closeconnection() {\n        if (connect != null)\n            connect.close();\n    }\n}\n\n\n2openconnectionconnectconnectconnectconnectcloseconnection\n\n * \n\nconnectsynchronizedreentrantlock\n\n * connect?\n\nconnectconnectconnect\n\nclass connectionmanager {\n    private connection connect = null;\n\n    public connection openconnection() {\n        if (connect == null) {\n            connect = drivermanager.getconnection();\n        }\n        return connect;\n    }\n\n    public void closeconnection() {\n        if (connect != null)\n            connect.close();\n    }\n}\n\nclass dao {\n    public void insert() {\n        connectionmanager connectionmanager = new connectionmanager();\n        connection connection = connectionmanager.openconnection();\n\n        // connection\n\n        connectionmanager.closeconnection();\n    }\n}\n\n\n\n\n * threadlocal\n\nthreadlocalthreadlocal\n\nimport java.sql.connection;\nimport java.sql.drivermanager;\nimport java.sql.sqlexception;\n\npublic class connectionmanager {\n\n    private static final threadlocal<connection> dbconnectionlocal = new threadlocal<connection>() {\n        @override\n        protected connection initialvalue() {\n            try {\n                return drivermanager.getconnection("", "", "");\n            } catch (sqlexception e) {\n                e.printstacktrace();\n            }\n            return null;\n        }\n    };\n\n    public connection getconnection() {\n        return dbconnectionlocal.get();\n    }\n}\n\n\n * threadlocal\n\nthrealocaljdkthreadlocal instances are typically private static fields in classes that wish to associate state with a thread(idid)private staticthreadlocal \n\n> threadlocalthreadlocal\n\n\n# threadlocal\n\n\n# \n\nthreadthreadlocalmapthreadlocals, connection, dbconnectionlocal() key, connectionvalue; , threadlocalinitialvalueconnection;\n\n:\n\npublic t get() {\n    thread t = thread.currentthread();\n    threadlocalmap threadlocals = getmap(t);\n    if (threadlocals != null) {\n        threadlocalmap.entry e = threadlocals.getentry(this);\n        if (e != null) {\n            @suppresswarnings("unchecked")\n            t result = (t)e.value;\n            return result;\n        }\n    }\n    return setinitialvalue();\n}\n\n\n * t, tthreadlocalmapthreadlocals\n * threadlocals(null) threadlocalkey, (connection);\n * threadlocals(null)threadlocalkey, connection, threadlocals map,\n * threadlocals, threadlocalmap, connectionthreadlocalmap\n\n, ?\n\nprivate t setinitialvalue() {\n    t value = initialvalue();\n    thread t = thread.currentthread();\n    threadlocalmap map = getmap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createmap(t, value);\n    return value;\n}\n\n\n * initialvalue, connection\n\n * threadlocals, threadlocalmap, threadlocalmap, , ;\n\n, threadlocalthreadthreadlocals\n\npublic void set(t value) {\n    thread t = thread.currentthread();\n    threadlocalmap map = getmap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createmap(t, value);\n}\n\n\ninitialvalue, dbconnectionfactorygetconnection:\n\npublic connection getconnection() {\n    connection connection = dbconnectionlocal.get();\n    if (connection == null) {\n        try {\n            connection = drivermanager.getconnection("", "", "");\n            dbconnectionlocal.set(connection);\n        } catch (sqlexception e) {\n            e.printstacktrace();\n        }\n    }\n    return connection;\n}\n\n\nthreadlocal; map, threadlocals, key;\n\nmap, ;\n\nthreadlocal, threadlocal? threadlocalmap, ?\n\n\n# threadlocalmap\n\n, map, threadlocalmapmap\n\n * map;\n * public, default, threadlocalmapthreadlocal, \n * threadlocalmapentryweakreference<threadlocal<?>>\n * entrykey, value; entry, bucketentry;\n\nthreadlocalmap, , map:\n\nprivate void set(threadlocal<?> key, object value) {\n\n    // we don\'t use a fast path as with get() because it is at\n    // least as common to use set() to create new entries as\n    // it is to replace existing ones, in which case, a fast\n    // path would fail more often than not.\n\n    entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadlocalhashcode & (len-1);\n\n    for (entry e = tab[i];\n         e != null;\n         e = tab[i = nextindex(i, len)]) {\n        threadlocal<?> k = e.get();\n\n        if (k == key) {\n            e.value = value;\n            return;\n        }\n\n        if (k == null) {\n            replacestaleentry(key, value, i);\n            return;\n        }\n    }\n\n    tab[i] = new entry(key, value);\n    int sz = ++size;\n    if (!cleansomeslots(i, sz) && sz >= threshold)\n        rehash();\n}\n\n\n, :\n\n * threadlocal : i = 2,  i = 2 (entry)keythreadlocal  key, , entryvalue;\n *  entry  key, threadlocal, replacestaleentry\n * (threadlocal) > table , hashmap,  ;\n\nset, get:\n\nprivate entry getentry(threadlocal<?> key) {\n    int i = key.threadlocalhashcode & (table.length - 1);\n    entry e = table[i];\n    if (e != null && e.get() == key)\n        return e;\n    else\n        return getentryaftermiss(key, i, e);\n}\n\n\nthreadlocal, entrythreadlocal, ; \n\n\n# threadlocal\n\n\n\nimport java.util.concurrent.linkedblockingqueue;\nimport java.util.concurrent.threadpoolexecutor;\nimport java.util.concurrent.timeunit;\n\npublic class threadlocaldemo {\n    static class localvariable {\n        private long[] a = new long[1024 * 1024];\n    }\n\n    // (1)\n    final static threadpoolexecutor poolexecutor = new threadpoolexecutor(5, 5, 1, timeunit.minutes,\n            new linkedblockingqueue<>());\n    // (2)\n    final static threadlocal<localvariable> localvariable = new threadlocal<localvariable>();\n\n    public static void main(string[] args) throws interruptedexception {\n        // (3)\n        thread.sleep(5000 * 4);\n        for (int i = 0; i < 50; ++i) {\n            poolexecutor.execute(new runnable() {\n                public void run() {\n                    // (4)\n                    localvariable.set(new localvariable());\n                    // (5)\n                    system.out.println("use local varaible" + localvariable.get());\n                    localvariable.remove();\n                }\n            });\n        }\n        // (6)\n        system.out.println("pool execute over");\n    }\n}\n\n\nthreadlocal , , <threadlocal, localvariable>, final static  threadlocal , threadlocalmap  key , , , localvariable, ; localvariable, ,  =  * localvariable;\n\n, , threadlocal,  remove,  threadlocalmap remove:\n\nprivate void remove(threadlocal<?> key) {\n    entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadlocalhashcode & (len-1);\n    for (entry e = tab[i];\n         e != null;\n         e = tab[i = nextindex(i, len)]) {\n        if (e.get() == key) {\n            e.clear();\n            expungestaleentry(i);\n            return;\n        }\n    }\n}\n\n\nkeyentry, entrykey(threadlocal), entry\n\n\n# threadlocal\n\n\n\n\n# \n\n> (idid)private staticthreadlocal \n\n\n\npublic class serialnum {\n    // the next serial number to be assigned\n    private static int nextserialnum = 0;\n\n    private static threadlocal serialnum = new threadlocal() {\n        protected synchronized object initialvalue() {\n            return new integer(nextserialnum++);\n        }\n    };\n\n    public static int get() {\n        return ((integer) (serialnum.get())).intvalue();\n    }\n}\n\n\n\n# session\n\n\n\nprivate static final threadlocal threadsession = new threadlocal();  \n  \npublic static session getsession() throws infrastructureexception {  \n    session s = (session) threadsession.get();  \n    try {  \n        if (s == null) {  \n            s = getsessionfactory().opensession();  \n            threadsession.set(s);  \n        }  \n    } catch (hibernateexception ex) {  \n        throw new infrastructureexception(ex);  \n    }  \n    return s;  \n}  \n\n\n\n# threadlocal\n\nthreadlocal\n\n * (threaddemo)threadlocalthreadxxxxxx\n * threaddemogetxxx()threadlocalnullnew()\n * threaddemorun()getxxx()\n\npublic class threadlocaltest implements runnable{\n    \n    threadlocal<student> studentthreadlocal = new threadlocal<student>();\n\n    @override\n    public void run() {\n        string currentthreadname = thread.currentthread().getname();\n        system.out.println(currentthreadname + " is running...");\n        random random = new random();\n        int age = random.nextint(100);\n        system.out.println(currentthreadname + " is set age: "  + age);\n        student student = getstudentt(); //newstudenttstudentt\n        student.setage(age);\n        system.out.println(currentthreadname + " is first get age: " + student.getage());\n        try {\n            thread.sleep(500);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n        system.out.println( currentthreadname + " is second get age: " + student.getage());\n        \n    }\n    \n    private student getstudentt() {\n        student student = studentthreadlocal.get();\n        if (null == student) {\n            student = new student();\n            studentthreadlocal.set(student);\n        }\n        return student;\n    }\n\n    public static void main(string[] args) {\n        threadlocaltest t = new threadlocaltest();\n        thread t1 = new thread(t,"thread a");\n        thread t2 = new thread(t,"thread b");\n        t1.start();\n        t2.start();\n    }\n    \n}\n\nclass student{\n    int age;\n    public int getage() {\n        return age;\n    }\n    public void setage(int age) {\n        this.age = age;\n    }\n    \n}\n\n\n\n# java  threadlocal\n\n java  threadlocal :\n\nimport java.text.dateformat;\nimport java.text.simpledateformat;\n \npublic class dateutils {\n    public static final threadlocal<dateformat> df = new threadlocal<dateformat>(){\n        @override\n        protected dateformat initialvalue() {\n            return new simpledateformat("yyyy-mm-dd");\n        }\n    };\n}\n\n\n dateformat \n\ndateutils.df.get().format(new date());\n\n\n\n# \n\n * https://blog.csdn.net/vking_wang/article/details/14225379\n * https://mp.weixin.qq.com/s/mo3-y-45_ao54b5t7ez7ia\n * https://www.xttblog.com/?p=3087\n * https://blog.csdn.net/whut2010hj/article/details/81413887\n * https://segmentfault.com/a/1190000018399795\n *  https://www.pdai.tech/md/java/thread/java-thread-x-threadlocal.html',charsets:{cjk:!0}},{title:"SQL",frontmatter:{},regularPath:"/sql/basic/sql-db.html",relativePath:"sql/basic/sql-db.md",key:"v-c2b654bc",path:"/sql/basic/sql-db.html",headers:[{level:2,title:"SQL",slug:"sql",normalizedTitle:"sql",charIndex:2},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:46},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:59},{level:3,title:"SQL",slug:"sql",normalizedTitle:"sql",charIndex:780}],lastUpdated:"2023/4/9 16:04:35",lastUpdatedTimestamp:1681027475e3,headersStr:"SQL   SQL",content:"# SQL\n\n> \n\n\n# \n\n\n\n\n# \n\n\n\n> A. SQL\n\n * SQL DB - \n * SQL DB - \n   * Architecture of a Database SystemHow does a relational database work\n * SQL DB - \n   * \n * SQL DB - \n   * , ,  , , 6\n * SQL DB - \n   * \n\n----------------------------------------\n\n\n# SQL\n\n\n\n> B. SQLSQLSQL->SQL->SQL->SQL\n\n * SQL - SQL\n   * SQL\n * SQL - SQL\n   * SQL--SQL\n * SQL - SQL\n   * LeetcodeSQL\n * SQL - SQL\n   * SQL\n *  https://www.pdai.tech/md/db/sql/sql-db.html\n\n----------------------------------------",normalizedContent:"# sql\n\n> \n\n\n# \n\n\n\n\n# \n\n\n\n> a. sql\n\n * sql db - \n * sql db - \n   * architecture of a database systemhow does a relational database work\n * sql db - \n   * \n * sql db - \n   * , ,  , , 6\n * sql db - \n   * \n\n----------------------------------------\n\n\n# sql\n\n\n\n> b. sqlsqlsql->sql->sql->sql\n\n * sql - sql\n   * sql\n * sql - sql\n   * sql--sql\n * sql - sql\n   * leetcodesql\n * sql - sql\n   * sql\n *  https://www.pdai.tech/md/db/sql/sql-db.html\n\n----------------------------------------",charsets:{cjk:!0}},{title:"Java  - ",frontmatter:{},regularPath:"/java/thread/java-thread-x-theorty.html",relativePath:"java/thread/java-thread-x-theorty.md",key:"v-07d81cee",path:"/java/thread/java-thread-x-theorty.html",headers:[{level:2,title:"Java  - ",slug:"java--",normalizedTitle:"java  - ",charIndex:2},{level:2,title:"BAT",slug:"bat",normalizedTitle:"bat",charIndex:76},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:97},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:111},{level:2,title:": ",slug:"-",normalizedTitle:": ",charIndex:124},{level:3,title:": CPU",slug:"-cpu",normalizedTitle:": cpu",charIndex:148},{level:3,title:": ",slug:"-",normalizedTitle:": ",charIndex:168},{level:3,title:": ",slug:"-",normalizedTitle:": ",charIndex:187},{level:2,title:"JAVA: JMM(Java)",slug:"java-jmm-java",normalizedTitle:"java: jmm(java)",charIndex:203},{level:3,title:": volatilesynchronized  final",slug:"-volatilesynchronized--final",normalizedTitle:": volatilesynchronized  final",charIndex:240},{level:3,title:"Happens-Before ",slug:"happens-before-",normalizedTitle:"happens-before ",charIndex:282},{level:2,title:": ",slug:"-",normalizedTitle:": ",charIndex:461},{level:3,title:"1\\. ",slug:"_1-",normalizedTitle:"1. ",charIndex:486},{level:3,title:"2\\. ",slug:"_2-",normalizedTitle:"2. ",charIndex:500},{level:3,title:"3\\. ",slug:"_3-",normalizedTitle:"3. ",charIndex:517},{level:3,title:"4\\. ",slug:"_4-",normalizedTitle:"4. ",charIndex:534},{level:3,title:"5\\. ",slug:"_5-",normalizedTitle:"5. ",charIndex:549},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:562},{level:3,title:"1\\. ",slug:"_1-",normalizedTitle:"1. ",charIndex:579},{level:3,title:"2\\. ",slug:"_2-",normalizedTitle:"2. ",charIndex:594},{level:3,title:"3\\. ",slug:"_3-",normalizedTitle:"3. ",charIndex:610},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:624}],lastUpdated:"2023/4/10 22:14:07",lastUpdatedTimestamp:1681136047e3,headersStr:"Java  -  BAT   :  : CPU :  :  JAVA: JMM(Java) : volatilesynchronized  final Happens-Before  :  1\\.  2\\.  3\\.  4\\.  5\\.   1\\.  2\\.  3\\.  ",content:'# Java  - \n\n> JMM\n\n * Java  - \n   * BAT\n   * \n   * \n   * : \n     * : CPU\n     * : \n     * : \n   * JAVA: JMM(Java)\n     * : volatilesynchronized  final\n     * Happens-Before \n       * 1. \n       * 2. \n       * 3. volatile \n       * 4. \n       * 5. \n       * 6. \n       * 7. \n       * 8. \n   * : \n     * 1. \n     * 2. \n     * 3. \n     * 4. \n     * 5. \n   * \n     * 1. \n     * 2. \n     * 3. \n   * \n\n\n# BAT\n\n\n\n@pdai\n\n * ?\n * ? \n * ? \n * Java? 3JMM8Happens-Before\n * ? \n * ?\n * ?\n\n\n# \n\nCPUI/O  CPU :\n\n * CPU //  \n *  CPU CPU  I/O //  \n * //  \n\n\n# \n\n\n\n 1000  cnt  1000\n\npublic class ThreadUnsafeExample {\n\n    private int cnt = 0;\n\n    public void add() {\n        cnt++;\n    }\n\n    public int get() {\n        return cnt;\n    }\n}\n\n\npublic static void main(String[] args) throws InterruptedException {\n    final int threadSize = 1000;\n    ThreadUnsafeExample example = new ThreadUnsafeExample();\n    final CountDownLatch countDownLatch = new CountDownLatch(threadSize);\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < threadSize; i++) {\n        executorService.execute(() -> {\n            example.add();\n            countDownLatch.countDown();\n        });\n    }\n    countDownLatch.await();\n    executorService.shutdown();\n    System.out.println(example.get());\n}\n\n\n\n# : \n\n1000? ?\n\n\n# : CPU\n\n\n\n\n\n//1\nint i = 0;\ni = 10;\n \n//2\nj = i;\n\n\n1CPU12CPU21 i =10iCPU110CPU1i10\n\n2 j = iiCPU2i0j010.\n\n1i21\n\n\n# : \n\n \n\n\n\nint i = 1;\n\n// 1\ni += 1;\n\n// 2\ni += 1;\n\n\ni += 1 CPU \n\n 1.  i  CPU\n 2. CPU i + 1 \n 3. i CPU \n\nCPU1221i23\n\n\n# : \n\n\n\nint i = 0;              \nboolean flag = false;\ni = 1;                //1  \nflag = true;          //2\n\n\nintboolean12JVM12? ? Instruction Reorder\n\n\n\n * \n * Instruction-Level Parallelism ILP\n *  / \n\n java \n\n\n\n 1 2  3 JMM JMM  java memory barriersintel  memory fence\n\nJava \n\n\n# JAVA: JMM(Java)\n\nJava Java \n\n\n\nJMMJava  JVM \n\n * volatilesynchronized  final \n * Happens-Before \n\n\n\n * \n\nJava \n\nx = 10;        //1: 10x10\ny = x;         //2: 2xxx x 2\nx++;           //3 x++3x1\nx = x + 1;     //4 3\n\n\n41\n\n\n\n> JavasynchronizedLocksynchronizedLock\n\n * \n\nJavavolatile\n\nvolatile\n\n\n\n> synchronizedLocksynchronizedLock\n\n * \n\nJavavolatilesynchronizedLocksynchronizedLockJMMHappens-Before \n\n\n# : volatilesynchronized  final\n\n\n\n * : synchronized\n * : volatile\n * : final\n\n\n# Happens-Before \n\n volatile  synchronized JVM \n\n# 1. \n\n> Single Thread rule\n\n\n\n\n\n# 2. \n\n> Monitor Lock Rule\n\n unlock  lock \n\n\n\n# 3. volatile \n\n> Volatile Variable Rule\n\n volatile \n\n\n\n# 4. \n\n> Thread Start Rule\n\nThread  start() \n\n\n\n# 5. \n\n> Thread Join Rule\n\nThread  join() \n\n\n\n# 6. \n\n> Thread Interruption Rule\n\n interrupt()  interrupted() \n\n# 7. \n\n> Finalizer Rule\n\n() finalize() \n\n# 8. \n\n> Transitivity\n\n A  B B  C A  C\n\n\n# : \n\n\n\n: \n\n\n# 1. \n\n(Immutable)\n\n\n\n:\n\n * final \n * String\n * \n * Number  Long  Double BigInteger  BigDecimal  Number  AtomicInteger  AtomicLong \n\n Collections.unmodifiableXXX() \n\npublic class ImmutableExample {\n    public static void main(String[] args) {\n        Map<String, Integer> map = new HashMap<>();\n        Map<String, Integer> unmodifiableMap = Collections.unmodifiableMap(map);\n        unmodifiableMap.put("a", 1);\n    }\n}\n\n\nException in thread "main" java.lang.UnsupportedOperationException\n    at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)\n    at ImmutableExample.main(ImmutableExample.java:9)\n\n\nCollections.unmodifiableXXX() \n\npublic V put(K key, V value) {\n    throw new UnsupportedOperationException();\n}\n\n\n\n# 2. \n\n\n\n\n# 3. \n\n\n\n Java  VectorHashTableCollections  synchronizedCollection() \n\n Vector  ArrayIndexOutOfBoundsException\n\npublic class VectorUnsafeExample {\n    private static Vector<Integer> vector = new Vector<>();\n\n    public static void main(String[] args) {\n        while (true) {\n            for (int i = 0; i < 100; i++) {\n                vector.add(i);\n            }\n            ExecutorService executorService = Executors.newCachedThreadPool();\n            executorService.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.remove(i);\n                }\n            });\n            executorService.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.get(i);\n                }\n            });\n            executorService.shutdown();\n        }\n    }\n}\n\n\nException in thread "Thread-159738" java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 3\n    at java.util.Vector.remove(Vector.java:831)\n    at VectorUnsafeExample.lambda$main$0(VectorUnsafeExample.java:14)\n    at VectorUnsafeExample$$Lambda$1/713338599.run(Unknown Source)\n    at java.lang.Thread.run(Thread.java:745)\n\n\n\n\nexecutorService.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.remove(i);\n        }\n    }\n});\nexecutorService.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.get(i);\n        }\n    }\n});\n\n\n\n# 4. \n\nJava API  Vector  HashTable  ArrayList  HashMap \n\n\n# 5. \n\n Java \n\n\n# \n\n\n# 1. \n\nsynchronized  ReentrantLock\n\n\n\n * Java  - \n\n\n\n * : Synchronized\n * JUC: ReentrantLock\n\n\n# 2. \n\n\n\n()\n\n()CAS\n\n: ()\n\n: (Compare-and-SwapCAS)CAS  3  V A  B V  A V  B\n\n()AtomicInteger\n\nJ.U.C  AtomicInteger compareAndSet()  getAndIncrement()  Unsafe  CAS \n\n AtomicInteger \n\nprivate AtomicInteger cnt = new AtomicInteger();\n\npublic void add() {\n    cnt.incrementAndGet();\n}\n\n\n incrementAndGet()  unsafe  getAndAddInt() \n\npublic final int incrementAndGet() {\n    return unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n}\n\n\n getAndAddInt() var1 var2 var4  1 getIntVolatile(var1, var2)  compareAndSwapInt()  CAS  var5 var1+var2  var5+var4\n\n getAndAddInt() \n\npublic final int getAndAddInt(Object var1, long var2, int var4) {\n    int var5;\n    do {\n        var5 = this.getIntVolatile(var1, var2);\n    } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));\n\n    return var5;\n}\n\n\n()ABA\n\n A  B A CAS \n\nJ.U.C  AtomicStampedReference  CAS  ABA  ABA \n\nCAS, Unsafe\n\n * JUC: CAS, Unsafe\n\n\n# 3. \n\n\n\n()\n\n\n\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class StackClosedExample {\n    public void add100() {\n        int cnt = 0;\n        for (int i = 0; i < 100; i++) {\n            cnt++;\n        }\n        System.out.println(cnt);\n    }\n}\n\n\npublic static void main(String[] args) {\n    StackClosedExample example = new StackClosedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> example.add100());\n    executorService.execute(() -> example.add100());\n    executorService.shutdown();\n}\n\n\nJ.U.C\n\n * JUC: FutureTask\n * JUC: ThreadPoolExecutor\n * JUC: ScheduledThreadPool\n * JUC: Fork/Join\n\n()(Thread Local Storage)\n\n\n\n(-) Web (Thread-per-Request) Web \n\n java.lang.ThreadLocal \n\nthread1  threadLocal  1 thread2  threadLocal  2thread1  threadLocal  1 thread2 \n\npublic class ThreadLocalExample {\n    public static void main(String[] args) {\n        ThreadLocal threadLocal = new ThreadLocal();\n        Thread thread1 = new Thread(() -> {\n            threadLocal.set(1);\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(threadLocal.get());\n            threadLocal.remove();\n        });\n        Thread thread2 = new Thread(() -> {\n            threadLocal.set(2);\n            threadLocal.remove();\n        });\n        thread1.start();\n        thread2.start();\n    }\n}\n\n\n\n\n ThreadLocal:\n\npublic class ThreadLocalExample1 {\n    public static void main(String[] args) {\n        ThreadLocal threadLocal1 = new ThreadLocal();\n        ThreadLocal threadLocal2 = new ThreadLocal();\n        Thread thread1 = new Thread(() -> {\n            threadLocal1.set(1);\n            threadLocal2.set(1);\n        });\n        Thread thread2 = new Thread(() -> {\n            threadLocal1.set(2);\n            threadLocal2.set(2);\n        });\n        thread1.start();\n        thread2.start();\n    }\n}\n\n\n:\n\n\n\n Thread  ThreadLocal.ThreadLocalMap Thread  ThreadLocal.ThreadLocalMap \n\n/* ThreadLocal values pertaining to this thread. This map is maintained\n * by the ThreadLocal class. */\nThreadLocal.ThreadLocalMap threadLocals = null;\n\n\n ThreadLocal  set(T value)  ThreadLocalMap  ThreadLocal->value  Map \n\npublic void set(T value) {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createMap(t, value);\n}\n\n\nget() \n\npublic T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        if (e != null) {\n            @SuppressWarnings("unchecked")\n            T result = (T)e.value;\n            return result;\n        }\n    }\n    return setInitialValue();\n}\n\n\nThreadLocal \n\n ()  ThreadLocal.ThreadLocalMap  ThreadLocal  ThreadLocal  remove() ThreadLocal \n\nJava  - ThreadLocal\n\n()(Reentrant Code)\n\n(Pure Code)()\n\n\n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-theorty.html',normalizedContent:'# java  - \n\n> jmm\n\n * java  - \n   * bat\n   * \n   * \n   * : \n     * : cpu\n     * : \n     * : \n   * java: jmm(java)\n     * : volatilesynchronized  final\n     * happens-before \n       * 1. \n       * 2. \n       * 3. volatile \n       * 4. \n       * 5. \n       * 6. \n       * 7. \n       * 8. \n   * : \n     * 1. \n     * 2. \n     * 3. \n     * 4. \n     * 5. \n   * \n     * 1. \n     * 2. \n     * 3. \n   * \n\n\n# bat\n\n\n\n@pdai\n\n * ?\n * ? \n * ? \n * java? 3jmm8happens-before\n * ? \n * ?\n * ?\n\n\n# \n\ncpui/o  cpu :\n\n * cpu //  \n *  cpu cpu  i/o //  \n * //  \n\n\n# \n\n\n\n 1000  cnt  1000\n\npublic class threadunsafeexample {\n\n    private int cnt = 0;\n\n    public void add() {\n        cnt++;\n    }\n\n    public int get() {\n        return cnt;\n    }\n}\n\n\npublic static void main(string[] args) throws interruptedexception {\n    final int threadsize = 1000;\n    threadunsafeexample example = new threadunsafeexample();\n    final countdownlatch countdownlatch = new countdownlatch(threadsize);\n    executorservice executorservice = executors.newcachedthreadpool();\n    for (int i = 0; i < threadsize; i++) {\n        executorservice.execute(() -> {\n            example.add();\n            countdownlatch.countdown();\n        });\n    }\n    countdownlatch.await();\n    executorservice.shutdown();\n    system.out.println(example.get());\n}\n\n\n\n# : \n\n1000? ?\n\n\n# : cpu\n\n\n\n\n\n//1\nint i = 0;\ni = 10;\n \n//2\nj = i;\n\n\n1cpu12cpu21 i =10icpu110cpu1i10\n\n2 j = iicpu2i0j010.\n\n1i21\n\n\n# : \n\n \n\n\n\nint i = 1;\n\n// 1\ni += 1;\n\n// 2\ni += 1;\n\n\ni += 1 cpu \n\n 1.  i  cpu\n 2. cpu i + 1 \n 3. i cpu \n\ncpu1221i23\n\n\n# : \n\n\n\nint i = 0;              \nboolean flag = false;\ni = 1;                //1  \nflag = true;          //2\n\n\nintboolean12jvm12? ? instruction reorder\n\n\n\n * \n * instruction-level parallelism ilp\n *  / \n\n java \n\n\n\n 1 2  3 jmm jmm  java memory barriersintel  memory fence\n\njava \n\n\n# java: jmm(java)\n\njava java \n\n\n\njmmjava  jvm \n\n * volatilesynchronized  final \n * happens-before \n\n\n\n * \n\njava \n\nx = 10;        //1: 10x10\ny = x;         //2: 2xxx x 2\nx++;           //3 x++3x1\nx = x + 1;     //4 3\n\n\n41\n\n\n\n> javasynchronizedlocksynchronizedlock\n\n * \n\njavavolatile\n\nvolatile\n\n\n\n> synchronizedlocksynchronizedlock\n\n * \n\njavavolatilesynchronizedlocksynchronizedlockjmmhappens-before \n\n\n# : volatilesynchronized  final\n\n\n\n * : synchronized\n * : volatile\n * : final\n\n\n# happens-before \n\n volatile  synchronized jvm \n\n# 1. \n\n> single thread rule\n\n\n\n\n\n# 2. \n\n> monitor lock rule\n\n unlock  lock \n\n\n\n# 3. volatile \n\n> volatile variable rule\n\n volatile \n\n\n\n# 4. \n\n> thread start rule\n\nthread  start() \n\n\n\n# 5. \n\n> thread join rule\n\nthread  join() \n\n\n\n# 6. \n\n> thread interruption rule\n\n interrupt()  interrupted() \n\n# 7. \n\n> finalizer rule\n\n() finalize() \n\n# 8. \n\n> transitivity\n\n a  b b  c a  c\n\n\n# : \n\n\n\n: \n\n\n# 1. \n\n(immutable)\n\n\n\n:\n\n * final \n * string\n * \n * number  long  double biginteger  bigdecimal  number  atomicinteger  atomiclong \n\n collections.unmodifiablexxx() \n\npublic class immutableexample {\n    public static void main(string[] args) {\n        map<string, integer> map = new hashmap<>();\n        map<string, integer> unmodifiablemap = collections.unmodifiablemap(map);\n        unmodifiablemap.put("a", 1);\n    }\n}\n\n\nexception in thread "main" java.lang.unsupportedoperationexception\n    at java.util.collections$unmodifiablemap.put(collections.java:1457)\n    at immutableexample.main(immutableexample.java:9)\n\n\ncollections.unmodifiablexxx() \n\npublic v put(k key, v value) {\n    throw new unsupportedoperationexception();\n}\n\n\n\n# 2. \n\n\n\n\n# 3. \n\n\n\n java  vectorhashtablecollections  synchronizedcollection() \n\n vector  arrayindexoutofboundsexception\n\npublic class vectorunsafeexample {\n    private static vector<integer> vector = new vector<>();\n\n    public static void main(string[] args) {\n        while (true) {\n            for (int i = 0; i < 100; i++) {\n                vector.add(i);\n            }\n            executorservice executorservice = executors.newcachedthreadpool();\n            executorservice.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.remove(i);\n                }\n            });\n            executorservice.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.get(i);\n                }\n            });\n            executorservice.shutdown();\n        }\n    }\n}\n\n\nexception in thread "thread-159738" java.lang.arrayindexoutofboundsexception: array index out of range: 3\n    at java.util.vector.remove(vector.java:831)\n    at vectorunsafeexample.lambda$main$0(vectorunsafeexample.java:14)\n    at vectorunsafeexample$$lambda$1/713338599.run(unknown source)\n    at java.lang.thread.run(thread.java:745)\n\n\n\n\nexecutorservice.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.remove(i);\n        }\n    }\n});\nexecutorservice.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.get(i);\n        }\n    }\n});\n\n\n\n# 4. \n\njava api  vector  hashtable  arraylist  hashmap \n\n\n# 5. \n\n java \n\n\n# \n\n\n# 1. \n\nsynchronized  reentrantlock\n\n\n\n * java  - \n\n\n\n * : synchronized\n * juc: reentrantlock\n\n\n# 2. \n\n\n\n()\n\n()cas\n\n: ()\n\n: (compare-and-swapcas)cas  3  v a  b v  a v  b\n\n()atomicinteger\n\nj.u.c  atomicinteger compareandset()  getandincrement()  unsafe  cas \n\n atomicinteger \n\nprivate atomicinteger cnt = new atomicinteger();\n\npublic void add() {\n    cnt.incrementandget();\n}\n\n\n incrementandget()  unsafe  getandaddint() \n\npublic final int incrementandget() {\n    return unsafe.getandaddint(this, valueoffset, 1) + 1;\n}\n\n\n getandaddint() var1 var2 var4  1 getintvolatile(var1, var2)  compareandswapint()  cas  var5 var1+var2  var5+var4\n\n getandaddint() \n\npublic final int getandaddint(object var1, long var2, int var4) {\n    int var5;\n    do {\n        var5 = this.getintvolatile(var1, var2);\n    } while(!this.compareandswapint(var1, var2, var5, var5 + var4));\n\n    return var5;\n}\n\n\n()aba\n\n a  b a cas \n\nj.u.c  atomicstampedreference  cas  aba  aba \n\ncas, unsafe\n\n * juc: cas, unsafe\n\n\n# 3. \n\n\n\n()\n\n\n\nimport java.util.concurrent.executorservice;\nimport java.util.concurrent.executors;\n\npublic class stackclosedexample {\n    public void add100() {\n        int cnt = 0;\n        for (int i = 0; i < 100; i++) {\n            cnt++;\n        }\n        system.out.println(cnt);\n    }\n}\n\n\npublic static void main(string[] args) {\n    stackclosedexample example = new stackclosedexample();\n    executorservice executorservice = executors.newcachedthreadpool();\n    executorservice.execute(() -> example.add100());\n    executorservice.execute(() -> example.add100());\n    executorservice.shutdown();\n}\n\n\nj.u.c\n\n * juc: futuretask\n * juc: threadpoolexecutor\n * juc: scheduledthreadpool\n * juc: fork/join\n\n()(thread local storage)\n\n\n\n(-) web (thread-per-request) web \n\n java.lang.threadlocal \n\nthread1  threadlocal  1 thread2  threadlocal  2thread1  threadlocal  1 thread2 \n\npublic class threadlocalexample {\n    public static void main(string[] args) {\n        threadlocal threadlocal = new threadlocal();\n        thread thread1 = new thread(() -> {\n            threadlocal.set(1);\n            try {\n                thread.sleep(1000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println(threadlocal.get());\n            threadlocal.remove();\n        });\n        thread thread2 = new thread(() -> {\n            threadlocal.set(2);\n            threadlocal.remove();\n        });\n        thread1.start();\n        thread2.start();\n    }\n}\n\n\n\n\n threadlocal:\n\npublic class threadlocalexample1 {\n    public static void main(string[] args) {\n        threadlocal threadlocal1 = new threadlocal();\n        threadlocal threadlocal2 = new threadlocal();\n        thread thread1 = new thread(() -> {\n            threadlocal1.set(1);\n            threadlocal2.set(1);\n        });\n        thread thread2 = new thread(() -> {\n            threadlocal1.set(2);\n            threadlocal2.set(2);\n        });\n        thread1.start();\n        thread2.start();\n    }\n}\n\n\n:\n\n\n\n thread  threadlocal.threadlocalmap thread  threadlocal.threadlocalmap \n\n/* threadlocal values pertaining to this thread. this map is maintained\n * by the threadlocal class. */\nthreadlocal.threadlocalmap threadlocals = null;\n\n\n threadlocal  set(t value)  threadlocalmap  threadlocal->value  map \n\npublic void set(t value) {\n    thread t = thread.currentthread();\n    threadlocalmap map = getmap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createmap(t, value);\n}\n\n\nget() \n\npublic t get() {\n    thread t = thread.currentthread();\n    threadlocalmap map = getmap(t);\n    if (map != null) {\n        threadlocalmap.entry e = map.getentry(this);\n        if (e != null) {\n            @suppresswarnings("unchecked")\n            t result = (t)e.value;\n            return result;\n        }\n    }\n    return setinitialvalue();\n}\n\n\nthreadlocal \n\n ()  threadlocal.threadlocalmap  threadlocal  threadlocal  remove() threadlocal \n\njava  - threadlocal\n\n()(reentrant code)\n\n(pure code)()\n\n\n\n\n# \n\n https://www.pdai.tech/md/java/thread/java-thread-x-theorty.html',charsets:{cjk:!0}},{frontmatter:{layout:"Tags",title:"Tags"},regularPath:"/tag/",key:"v-b1564aac",path:"/tag/",headersStr:null,content:"",normalizedContent:"",charsets:{}},{frontmatter:{layout:"FrontmatterKey",title:"Categories"},regularPath:"/categories/",key:"v-ef9325c4",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{}},{frontmatter:{layout:"TimeLines",title:"Timeline"},regularPath:"/timeline/",key:"v-6319eb4e",path:"/timeline/",headersStr:null,content:"",normalizedContent:"",charsets:{}}],themeConfig:{subSidebar:"auto",searchMaxSuggestions:15,smoothScroll:!0,logo:"/Eminem.svg",lastUpdated:"Last Updated",repo:"https://github.com/lowskylee/vblog",repoLabel:"GitHub",docsRepo:"https://github.com/lowskylee/vblog",docsDir:"docs",docsBranch:"master",editLinks:!0,editLinkText:"Edit this page",nav:[{text:"",link:"/"},{text:"Java",items:[{text:"Java ",link:"/java/basic/java-basic-oop"},{text:"Java ",link:"/java/collection/java-collection-all"},{text:"Java ",link:"/java/thread/java-thread-x-overview"}]},{text:"",items:[{text:"",link:"/algorithm/basic/alg-basic-overview"}]},{text:"",items:[{text:"",link:"/sql/basic/sql-db"}]},{text:"Spring",items:[{text:"Spring Framework 5",link:"/spring/basic/spring"}]},{text:"",items:[{text:"ASCII",link:"https://www.fly63.com/tool/ascii/"},{text:"",link:"https://regexr.com/"}]},{text:"",items:[{text:"Git",link:"https://git-scm.com/book/zh/v2"},{text:"Nginx",link:"https://www.nginx.cn/doc/index.html"},{text:"Kafka",link:"https://kafka.apachecn.org/"}]}],sidebar:{"/java/":[{title:"Java ",children:[{title:"Java  - ",path:"/java/basic/java-basic-oop"},{title:"Java  - ",path:"/java/basic/java-basic-lan-basic"},{title:"Java  -  & Q/A",path:"/java/basic/java-basic-lan-sum"},{title:"JJava  - ",path:"/java/basic/java-basic-x-generic"},{title:"Java  - ",path:"/java/basic/java-basic-x-annotation"},{title:"Java  - ",path:"/java/basic/java-basic-x-exception"},{title:"Java  - ",path:"/java/basic/java-basic-x-reflection"},{title:"Java - SPI",path:"/java/basic/java-advanced-spi"}]},{title:"Java ",children:[{title:"Collection ",path:"/java/collection/java-collection-all"},{title:"Collection - ArrayList ",path:"/java/collection/java-collection-ArrayList"},{title:"Collection - LinkedList",path:"/java/collection/java-collection-LinkedList"},{title:"Collection - Stack & Queue ",path:"/java/collection/java-collection-Queue&Stack"},{title:"Collection - PriorityQueue",path:"/java/collection/java-collection-PriorityQueue"},{title:"Map - HashSet & HashMap ",path:"/java/collection/java-map-HashMap&HashSet"},{title:"Map - LinkedHashSet&Map",path:"/java/collection/java-map-LinkedHashMap&LinkedHashSet"},{title:"Map - TreeSet & TreeMap ",path:"/java/collection/java-map-TreeMap&TreeSet"},{title:"Map - WeakHashMap",path:"/java/collection/java-map-WeakHashMap"}]},{title:"Java ",children:[{title:"Java",path:"/java/thread/java-thread-x-overview"},{title:"Java  - ",path:"/java/thread/java-thread-x-theorty"},{title:"Java  - ",path:"/java/thread/java-thread-x-thread-basic"},{title:"Java - Java",path:"/java/thread/java-thread-x-lock-all"},{title:": synchronized",path:"/java/thread/java-thread-x-key-synchronized"},{title:": volatile",path:"/java/thread/java-thread-x-key-volatile"},{title:": final",path:"/java/thread/java-thread-x-key-final"},{title:"JUC - ",path:"/java/thread/java-thread-x-juc-overview"},{title:"JUC: CAS, Unsafe",path:"/java/thread/java-thread-x-juc-AtomicInteger"},{title:"JUC: LockSupport",path:"/java/thread/java-thread-x-lock-LockSupport"},{title:"JUC: AQS",path:"/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer"},{title:"JUC: ReentrantLock",path:"/java/thread/java-thread-x-lock-ReentrantLock"},{title:"JUC: ReentrantReadWriteLock",path:"/java/thread/java-thread-x-lock-ReentrantReadWriteLock"},{title:"JUC: ConcurrentHashMap",path:"/java/thread/java-thread-x-juc-collection-ConcurrentHashMap"},{title:"JUC: CopyOnWriteArrayList",path:"/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList"},{title:"JUC: ConcurrentLinkedQueue",path:"/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue"},{title:"JUC: BlockingQueue",path:"/java/thread/java-thread-x-juc-collection-BlockingQueue"},{title:"JUC: FutureTask",path:"/java/thread/java-thread-x-juc-executor-FutureTask"},{title:"JUC: ThreadPoolExecutor",path:"/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor"},{title:"JUC: ScheduledThreadPoolExecutor",path:"/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor"},{title:"JUC: Fork/Join",path:"/java/thread/java-thread-x-juc-executor-ForkJoinPool"},{title:"JUC: CountDownLatch",path:"/java/thread/java-thread-x-juc-tool-countdownlatch"},{title:"JUC: CyclicBarrier",path:"/java/thread/java-thread-x-juc-tool-cyclicbarrier"},{title:"JUC: Semaphore",path:"/java/thread/java-thread-x-juc-tool-semaphore"},{title:"JUC: Phaser",path:"/java/thread/java-thread-x-juc-tool-phaser"},{title:"JUC: Exchanger",path:"/java/thread/java-thread-x-juc-tool-exchanger"},{title:"Java  - ThreadLocal",path:"/java/thread/java-thread-x-threadlocal"}]}],"/algorithm/":[{title:"",children:[{title:"",path:"/algorithm/basic/alg-basic-overview"}]}],"/sql/":[{title:"",children:[{title:"SQL",path:"/sql/basic/sql-db"}]}],"/spring/":[{title:"Spring Framework 5",children:[{title:"Spring",path:"/spring/basic/spring"}]}],"/":[{title:"",collapsable:!1,children:[{title:"",path:"/"},{title:"",path:"/about"}]}]}},locales:{"/":{lang:"zh-CN",path:"/"}}};var He=t(26),Qe={computed:{$recoPosts(){let n=this.$site.pages;return n=Object(He.a)(n,!1),Object(He.c)(n),n},$recoPostsForTimeline(){let n=this.$recoPosts;const e={},t=[];n=Object(He.a)(n,!0),this.pages=0==n.length?[]:n;for(let t=0,a=n.length;t<a;t++){const a=n[t],r=Ge(a.frontmatter.date,"year");e[r]?e[r].push(a):e[r]=[a]}for(const n in e){const a=e[n];Object(He.b)(a),t.unshift({year:n,data:a})}return t},$categoriesList(){return this.$categories.list.map(n=>(n.pages=n.pages.filter(n=>!1!==n.frontmatter.publish),n))},$tagesList(){return this.$tags.list.map(n=>(n.pages=n.pages.filter(n=>!1!==n.frontmatter.publish),n))},$showSubSideBar(){const{$themeConfig:{subSidebar:n,sidebar:e},$frontmatter:{subSidebar:t,sidebar:a}}=this,r=this.$page.headers||[];return!([t,a].indexOf(!1)>-1)&&([t,a].indexOf("auto")>-1&&r.length>0||[n,e].indexOf("auto")>-1&&r.length>0)}}};function Ge(n,e){n=function(n){var e=new Date(n).toJSON();return new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"").replace(/-/g,"/")}(n);const t=new Date(n),a=t.getFullYear(),r=t.getMonth()+1,i=t.getDate();return"year"==e?a:`${r}-${i}`}var Ke={all:"",article:"",tag:"",category:"",friendLink:"",timeLine:"",timeLineMsg:""},Ye={all:"",article:"",tag:"",category:"",friendLink:"",timeLine:"",timeLineMsg:""},Xe={all:"All",article:"Articles",tag:"Tags",category:"Categories",friendLink:"Friend Links",timeLine:"TimeLine",timeLineMsg:"Yesterday Once More!"},Ze={all:"",article:"",tag:"",category:"",friendLink:"",timeLine:"",timeLineMsg:""},nt={all:"",article:"",tag:"",category:"",friendLink:" ",timeLine:" ",timeLineMsg:" !"},et={all:"Todas",article:"Artculos",tag:"Etiquetas",category:"Categoras",friendLink:"Pginas amigas",timeLine:"Cronologa",timeLineMsg:"Ayer otra vez!"},tt={computed:{$recoLocales(){const n=this.$themeLocaleConfig.recoLocales||{};return/^zh\-(CN|SG)$/.test(this.$lang)?{...Ke,...n}:/^zh\-(HK|MO|TW)$/.test(this.$lang)?{...Ye,...n}:/^ja\-JP$/.test(this.$lang)?{...Ze,...n}:/^ko\-KR$/.test(this.$lang)?{...nt,...n}:/^es(\-[A-Z]+)?$/.test(this.$lang)?{...et,...n}:{...Xe,...n}}}},at=t(40);t(271);a.b.component("Badge",()=>Promise.all([t.e(0),t.e(9)]).then(t.bind(null,512)));var rt={name:"BackToTop",data:()=>({visible:!1,customStyle:{right:"1rem",bottom:"6rem",width:"2.5rem",height:"2.5rem","border-radius":".25rem","line-height":"2.5rem"},visibilityHeight:400}),mounted(){window.addEventListener("scroll",this.throttle(this.handleScroll,500))},beforeDestroy(){window.removeEventListener("scroll",this.throttle(this.handleScroll,500))},methods:{handleScroll(){this.visible=window.pageYOffset>this.visibilityHeight},backToTop(){window.scrollTo(0,0)},throttle(n,e){let t=null,a=Date.now();return function(){const r=Date.now(),i=e-(r-a),o=this,s=arguments;clearTimeout(t),i<=0?(n.apply(o,s),a=Date.now()):t=setTimeout(n,i)}}}},it=(t(272),Object(Ue.a)(rt,(function(){var n=this._self._c;return n("transition",{attrs:{name:"fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:this.visible,expression:"visible"}],staticClass:"back-to-ceiling",style:this.customStyle,on:{click:this.backToTop}},[n("svg",{staticClass:"icon",attrs:{t:"1574745035067",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5404"}},[n("path",{attrs:{d:"M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z","p-id":"5405"}}),n("path",{attrs:{d:"M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z","p-id":"5406"}})])])])}),[],!1,null,"c6073ba8",null).exports);t(273),t(278);const ot={prev:"",next:"",go:"",jump:""},st={prev:"",next:"",go:"",jump:""},lt={prev:"Prev",next:"Next",go:"Go",jump:"Jump To"},ct={prev:"",next:"",go:"",jump:""},ut={prev:" ",next:" ",go:"",jump:""};var dt={data:()=>({changePage:"",pageSize:10}),props:{total:{type:Number,default:10},perPage:{type:Number,default:10},currentPage:{type:Number,default:1}},computed:{pages(){return Math.ceil(this.total/this.pageSize)},efont:function(){return this.pages>7},indexes:function(){var n=1,e=this.pages,t=[];for(this.pages>=7&&(this.currentPage>5&&this.currentPage<this.pages-4?(n=Number(this.currentPage)-3,e=Number(this.currentPage)+3):this.currentPage<=5?(n=1,e=7):(e=this.pages,n=this.pages-6));n<=e;)t.push(n),n++;return t},pagationLocales(){return function(n){const{$lang:e,$recoLocales:{pagation:t}={}}=n;return t||(/^zh\-(CN|SG)$/.test(e)?ot:/^zh\-(HK|MO|TW)$/.test(e)?st:/^ja\-JP$/.test(e)?ct:/^ko\-KR$/.test(e)?ut:lt)}(this)},showStartFakePageNum:function(){return this.efont&&!this.indexes.includes(1)},showLastFakePageNum:function(){return this.efont&&!this.indexes.includes(this.pages)}},methods:{goPrev(){let n=this.currentPage;this.currentPage>1&&this.emit(--n)},goNext(){let n=this.currentPage;n<this.pages&&this.emit(++n)},jumpPage:function(n){const e=parseInt(n);e<=this.pages&&e>0?this.emit(e):alert(`0${this.pages}`)},emit(n){this.$emit("getCurrentPage",n)}}},pt=(t(279),Object(Ue.a)(dt,(function(){var n=this,e=n._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:n.pages>1,expression:"pages > 1"}],staticClass:"pagation"},[e("div",{staticClass:"pagation-list"},[e("span",{directives:[{name:"show",rawName:"v-show",value:n.currentPage>1,expression:"currentPage > 1"}],staticClass:"jump",attrs:{unselectable:"on"},on:{click:n.goPrev}},[n._v(n._s(n.pagationLocales.prev))]),n._v(" "),n.showStartFakePageNum?e("span",{staticClass:"jump",on:{click:function(e){return n.jumpPage(1)}}},[n._v("1")]):n._e(),n._v(" "),n.showStartFakePageNum&&n.indexes[0]>2?e("span",{staticClass:"ellipsis"},[n._v("...")]):n._e(),n._v(" "),n._l(n.indexes,(function(t){return e("span",{key:t,staticClass:"jump",class:{bgprimary:n.currentPage==t},on:{click:function(e){return n.jumpPage(t)}}},[n._v(n._s(t))])})),n._v(" "),n.showLastFakePageNum&&n.pages-n.indexes.at(-1)>1?e("span",{staticClass:"ellipsis"},[n._v("...")]):n._e(),n._v(" "),n.showLastFakePageNum?e("span",{staticClass:"jump",on:{click:function(e){return n.jumpPage(n.pages)}}},[n._v(n._s(n.pages))]):n._e(),n._v(" "),n.currentPage<n.pages?e("span",{staticClass:"jump",on:{click:n.goNext}},[n._v(n._s(n.pagationLocales.next))]):n._e(),n._v(" "),e("span",{staticClass:"jumppoint"},[n._v(n._s(n.pagationLocales.jump))]),n._v(" "),e("span",{staticClass:"jumpinp"},[e("input",{directives:[{name:"model",rawName:"v-model",value:n.changePage,expression:"changePage"}],attrs:{type:"text"},domProps:{value:n.changePage},on:{input:function(e){e.target.composing||(n.changePage=e.target.value)}}})]),n._v(" "),e("span",{staticClass:"jump gobtn",on:{click:function(e){return n.jumpPage(n.changePage)}}},[n._v(n._s(n.pagationLocales.go))])],2)])}),[],!1,null,"22b6649c",null).exports),ht=(t(280),{tags:{},categories:{},timeline:{}});class ft{constructor(n,e){this._metaMap=Object.assign({},n),Object.keys(this._metaMap).forEach(n=>{const{pageKeys:t}=this._metaMap[n];this._metaMap[n].pages=t.map(n=>function(n,e){for(let t=0;t<n.length;t++){const a=n[t];if(a.key===e)return a}return{path:"",frontmatter:{}}}(e,n))})}get length(){return Object.keys(this._metaMap).length}get map(){return this._metaMap}get pages(){return this.list}get list(){return this.toArray()}toArray(){const n=[];return Object.keys(this._metaMap).forEach(e=>{const{pages:t,path:a}=this._metaMap[e];n.push({name:e,pages:t,path:a})}),n}getItemByName(n){return this._metaMap[n]}}var mt=t(130);const gt=t.n(mt)()("plugin-blog:pagination");class vt{constructor(n,e,t){gt("pagination",n);const{pages:a,prevText:r,nextText:i}=n,{path:o}=t;this._prevText=r,this._nextText=i;for(let n=0,e=a.length;n<e;n++){if(a[n].path===o){this.paginationIndex=n;break}}this.paginationIndex||(this.paginationIndex=0),this._paginationPages=a,this._currentPage=a[this.paginationIndex],this._matchedPages=e.filter(e=>n.filter(e,n.id,n.pid)).sort(n.sorter)}setIndexPage(n){this._indexPage=n}get length(){return this._paginationPages.length}get pages(){const[n,e]=this._currentPage.interval;return this._matchedPages.slice(n,e+1)}get hasPrev(){return 0!==this.paginationIndex}get prevLink(){return this.hasPrev?this.paginationIndex-1==0&&this._indexPage?this._indexPage:this._paginationPages[this.paginationIndex-1].path:null}get hasNext(){return this.paginationIndex!==this.length-1}get nextLink(){return this.hasNext?this._paginationPages[this.paginationIndex+1].path:null}get prevText(){return this._prevText}get nextText(){return this._nextText}getSpecificPageLink(n){return this._paginationPages[n].path}}const yt=new class{constructor(n){this.paginations=n}get pages(){return a.b.$vuepress.$get("siteData").pages}getPagination(n,e,t){gt("id",e),gt("pid",n);const a=this.paginations.filter(t=>t.id===e&&t.pid===n)[0];return new vt(a,this.pages,t)}}([]);var bt={comment:{enabled:!1,service:""},email:{enabled:!1},feed:{rss:!1,atom:!1,json:!1}};function kt(n){const e=document.documentElement.getBoundingClientRect(),t=n.getBoundingClientRect();return{x:t.left-e.left,y:t.top-e.top}}var wt=({Vue:n,router:e})=>{e.options.scrollBehavior=(e,t,a)=>{if(a)return window.scrollTo({top:a.y,behavior:"smooth"});if(!e.hash)return window.scrollTo({top:0,behavior:"smooth"});{if(n.$vuepress.$get("disableScrollBehavior"))return;const t=document.querySelector(e.hash);if(t)return window.scrollTo({top:kt(t).y,behavior:"smooth"})}}},xt={name:"KanBanNiang",data:()=>({isLoaded:!0,displayBanNiang:!1,isShowMessageBox:!1,isShowBtns:!0,messages:{message:"",welcome:"",home:"",theme:"",close:""},currentTheme:"blackCat",myTheme:["blackCat","whiteCat","haru1","haru2","haruto","koharu","izumi","shizuku","wanko","miku","z16"],themeName:["blackCat","whiteCat","haru1","haru2","haruto","koharu","izumi","shizuku","wanko","miku","z16"],model:{blackCat:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-hijiki/assets/hijiki.model.json",whiteCat:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-tororo/assets/tororo.model.json",haru1:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-haru/01/assets/haru01.model.json",haru2:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-haru/02/assets/haru02.model.json",haruto:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-haruto/assets/haruto.model.json",koharu:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-koharu/assets/koharu.model.json",izumi:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-izumi/assets/izumi.model.json",shizuku:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-shizuku/assets/shizuku.model.json",wanko:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-wanko/assets/wanko.model.json",miku:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-miku/assets/miku.model.json",z16:"https://cdn.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-z16/assets/z16.model.json"},style:{width:250,height:320},modelStyle:{right:"90px",bottom:"-20px",opacity:"0.9"},messageStyle:{right:"68px",bottom:"290px"},btnStyle:{right:"90px",bottom:"40px"}}),mounted(){this.btnStyle={...this.btnStyle,height:this.myTheme.length>1?"120px":"100px"},this.initBanNiang()},methods:{hoverGoHome(){this.messages.message=this.messages.home},hoverChangeTheme(){this.messages.message=this.messages.theme},hoverMoreInfo(){this.messages.message=""},hoverCloseBanNiang(){this.messages.message=this.messages.close},resetMessage(){this.messages.message=this.messages.welocme},goHome(){"/"!==this.$route.path&&this.$router.push("/")},changeTheme(){const n=[];for(var e=0;e<this.myTheme.length;e++)this.myTheme[e]!=this.currentTheme&&n.push(this.myTheme[e]);const t=Math.floor(Math.random()*(this.myTheme.length-1));this.currentTheme=n[t],this.initBanNiang()},closeBanNiang(){this.isLoaded=!1,this.displayBanNiang=!0},showBanNiang(){this.isLoaded=!0,this.displayBanNiang=!1,this.initBanNiang()},initBanNiang(){if(-1===this.themeName.indexOf(this.currentTheme))return console.log("@vuepress-reco/vuepress-plugin-kan-ban-niang"+this.currentTheme+", , https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html "),void(document.querySelector(".kanbanniang").style.display="none");if(!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return this.isLoaded=!1,console.log("mobile do not load model");if(!window.loadlive2d){const n=document.createElement("script");n.innerHTML='!function(t){function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var e={};i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=4)}([function(t,i,e){"use strict";function r(){this.live2DModel=null,this.modelMatrix=null,this.eyeBlink=null,this.physics=null,this.pose=null,this.debugMode=!1,this.initialized=!1,this.updating=!1,this.alpha=1,this.accAlpha=0,this.lipSync=!1,this.lipSyncValue=0,this.accelX=0,this.accelY=0,this.accelZ=0,this.dragX=0,this.dragY=0,this.startTimeMSec=null,this.mainMotionManager=new h,this.expressionManager=new h,this.motions={},this.expressions={},this.isTexLoaded=!1}function o(){AMotion.prototype.constructor.call(this),this.paramList=new Array}function n(){this.id="",this.type=-1,this.value=null}function s(){this.nextBlinkTime=null,this.stateStartTime=null,this.blinkIntervalMsec=null,this.eyeState=g.STATE_FIRST,this.blinkIntervalMsec=4e3,this.closingMotionMsec=100,this.closedMotionMsec=50,this.openingMotionMsec=150,this.closeIfZero=!0,this.eyeID_L="PARAM_EYE_L_OPEN",this.eyeID_R="PARAM_EYE_R_OPEN"}function _(){this.tr=new Float32Array(16),this.identity()}function a(t,i){_.prototype.constructor.call(this),this.width=t,this.height=i}function h(){MotionQueueManager.prototype.constructor.call(this),this.currentPriority=null,this.reservePriority=null,this.super=MotionQueueManager.prototype}function l(){this.physicsList=new Array,this.startTimeMSec=UtSystem.getUserTimeMSec()}function $(){this.lastTime=0,this.lastModel=null,this.partsGroups=new Array}function u(t){this.paramIndex=-1,this.partsIndex=-1,this.link=null,this.id=t}function p(){this.EPSILON=.01,this.faceTargetX=0,this.faceTargetY=0,this.faceX=0,this.faceY=0,this.faceVX=0,this.faceVY=0,this.lastTimeSec=0}function f(){_.prototype.constructor.call(this),this.screenLeft=null,this.screenRight=null,this.screenTop=null,this.screenBottom=null,this.maxLeft=null,this.maxRight=null,this.maxTop=null,this.maxBottom=null,this.max=Number.MAX_VALUE,this.min=0}function c(){}var d=0;r.prototype.getModelMatrix=function(){return this.modelMatrix},r.prototype.setAlpha=function(t){t>.999&&(t=1),t<.001&&(t=0),this.alpha=t},r.prototype.getAlpha=function(){return this.alpha},r.prototype.isInitialized=function(){return this.initialized},r.prototype.setInitialized=function(t){this.initialized=t},r.prototype.isUpdating=function(){return this.updating},r.prototype.setUpdating=function(t){this.updating=t},r.prototype.getLive2DModel=function(){return this.live2DModel},r.prototype.setLipSync=function(t){this.lipSync=t},r.prototype.setLipSyncValue=function(t){this.lipSyncValue=t},r.prototype.setAccel=function(t,i,e){this.accelX=t,this.accelY=i,this.accelZ=e},r.prototype.setDrag=function(t,i){this.dragX=t,this.dragY=i},r.prototype.getMainMotionManager=function(){return this.mainMotionManager},r.prototype.getExpressionManager=function(){return this.expressionManager},r.prototype.loadModelData=function(t,i){var e=c.getPlatformManager();this.debugMode&&e.log("Load model : "+t);var r=this;e.loadLive2DModel(t,function(t){if(r.live2DModel=t,r.live2DModel.saveParam(),0!=Live2D.getError())return void console.error("Error : Failed to loadModelData().");r.modelMatrix=new a(r.live2DModel.getCanvasWidth(),r.live2DModel.getCanvasHeight()),r.modelMatrix.setWidth(2),r.modelMatrix.setCenterPosition(0,0),i(r.live2DModel)})},r.prototype.loadTexture=function(t,i,e){d++;var r=c.getPlatformManager();this.debugMode&&r.log("Load Texture : "+i);var o=this;r.loadTexture(this.live2DModel,t,i,function(){d--,0==d&&(o.isTexLoaded=!0),"function"==typeof e&&e()})},r.prototype.loadMotion=function(t,i,e){var r=c.getPlatformManager();this.debugMode&&r.log("Load Motion : "+i);var o=null,n=this;r.loadBytes(i,function(i){o=Live2DMotion.loadMotion(i),null!=t&&(n.motions[t]=o),e(o)})},r.prototype.loadExpression=function(t,i,e){var r=c.getPlatformManager();this.debugMode&&r.log("Load Expression : "+i);var n=this;r.loadBytes(i,function(i){null!=t&&(n.expressions[t]=o.loadJson(i)),"function"==typeof e&&e()})},r.prototype.loadPose=function(t,i){var e=c.getPlatformManager();this.debugMode&&e.log("Load Pose : "+t);var r=this;try{e.loadBytes(t,function(t){r.pose=$.load(t),"function"==typeof i&&i()})}catch(t){console.warn(t)}},r.prototype.loadPhysics=function(t){var i=c.getPlatformManager();this.debugMode&&i.log("Load Physics : "+t);var e=this;try{i.loadBytes(t,function(t){e.physics=l.load(t)})}catch(t){console.warn(t)}},r.prototype.hitTestSimple=function(t,i,e){if(null===this.live2DModel)return!1;var r=this.live2DModel.getDrawDataIndex(t);if(r<0)return!1;for(var o=this.live2DModel.getTransformedPoints(r),n=this.live2DModel.getCanvasWidth(),s=0,_=this.live2DModel.getCanvasHeight(),a=0,h=0;h<o.length;h+=2){var l=o[h],$=o[h+1];l<n&&(n=l),l>s&&(s=l),$<_&&(_=$),$>a&&(a=$)}var u=this.modelMatrix.invertTransformX(i),p=this.modelMatrix.invertTransformY(e);return n<=u&&u<=s&&_<=p&&p<=a},r.prototype.hitTestSimpleCustom=function(t,i,e,r){return null!==this.live2DModel&&t&&(e>=t[0]&&e<=i[0]&&r<=t[1]&&r>=i[1])},o.prototype=new AMotion,o.EXPRESSION_DEFAULT="DEFAULT",o.TYPE_SET=0,o.TYPE_ADD=1,o.TYPE_MULT=2,o.loadJson=function(t){var i=new o,e=c.getPlatformManager(),r=e.jsonParseFromBytes(t);if(i.setFadeIn(parseInt(r.fade_in)>0?parseInt(r.fade_in):1e3),i.setFadeOut(parseInt(r.fade_out)>0?parseInt(r.fade_out):1e3),null==r.params)return i;var s=r.params,_=s.length;i.paramList=[];for(var a=0;a<_;a++){var h=s[a],l=h.id.toString(),$=parseFloat(h.val),u=o.TYPE_ADD,p=null!=h.calc?h.calc.toString():"add";if((u="add"===p?o.TYPE_ADD:"mult"===p?o.TYPE_MULT:"set"===p?o.TYPE_SET:o.TYPE_ADD)==o.TYPE_ADD){var f=null==h.def?0:parseFloat(h.def);$-=f}else if(u==o.TYPE_MULT){var f=null==h.def?1:parseFloat(h.def);0==f&&(f=1),$/=f}var d=new n;d.id=l,d.type=u,d.value=$,i.paramList.push(d)}return i},o.prototype.updateParamExe=function(t,i,e,r){for(var n=this.paramList.length-1;n>=0;--n){var s=this.paramList[n];s.type==o.TYPE_ADD?t.addToParamFloat(s.id,s.value,e):s.type==o.TYPE_MULT?t.multParamFloat(s.id,s.value,e):s.type==o.TYPE_SET&&t.setParamFloat(s.id,s.value,e)}},s.prototype.calcNextBlink=function(){return UtSystem.getUserTimeMSec()+Math.random()*(2*this.blinkIntervalMsec-1)},s.prototype.setInterval=function(t){this.blinkIntervalMsec=t},s.prototype.setEyeMotion=function(t,i,e){this.closingMotionMsec=t,this.closedMotionMsec=i,this.openingMotionMsec=e},s.prototype.updateParam=function(t){var i,e=UtSystem.getUserTimeMSec(),r=0;switch(this.eyeState){case g.STATE_CLOSING:r=(e-this.stateStartTime)/this.closingMotionMsec,r>=1&&(r=1,this.eyeState=g.STATE_CLOSED,this.stateStartTime=e),i=1-r;break;case g.STATE_CLOSED:r=(e-this.stateStartTime)/this.closedMotionMsec,r>=1&&(this.eyeState=g.STATE_OPENING,this.stateStartTime=e),i=0;break;case g.STATE_OPENING:r=(e-this.stateStartTime)/this.openingMotionMsec,r>=1&&(r=1,this.eyeState=g.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink()),i=r;break;case g.STATE_INTERVAL:this.nextBlinkTime<e&&(this.eyeState=g.STATE_CLOSING,this.stateStartTime=e),i=1;break;case g.STATE_FIRST:default:this.eyeState=g.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink(),i=1}this.closeIfZero||(i=-i),t.setParamFloat(this.eyeID_L,i),t.setParamFloat(this.eyeID_R,i)};var g=function(){};g.STATE_FIRST="STATE_FIRST",g.STATE_INTERVAL="STATE_INTERVAL",g.STATE_CLOSING="STATE_CLOSING",g.STATE_CLOSED="STATE_CLOSED",g.STATE_OPENING="STATE_OPENING",_.mul=function(t,i,e){var r,o,n,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<4;r++)for(o=0;o<4;o++)for(n=0;n<4;n++)s[r+4*o]+=t[r+4*n]*i[n+4*o];for(r=0;r<16;r++)e[r]=s[r]},_.prototype.identity=function(){for(var t=0;t<16;t++)this.tr[t]=t%5==0?1:0},_.prototype.getArray=function(){return this.tr},_.prototype.getCopyMatrix=function(){return new Float32Array(this.tr)},_.prototype.setMatrix=function(t){if(null!=this.tr&&this.tr.length==this.tr.length)for(var i=0;i<16;i++)this.tr[i]=t[i]},_.prototype.getScaleX=function(){return this.tr[0]},_.prototype.getScaleY=function(){return this.tr[5]},_.prototype.transformX=function(t){return this.tr[0]*t+this.tr[12]},_.prototype.transformY=function(t){return this.tr[5]*t+this.tr[13]},_.prototype.invertTransformX=function(t){return(t-this.tr[12])/this.tr[0]},_.prototype.invertTransformY=function(t){return(t-this.tr[13])/this.tr[5]},_.prototype.multTranslate=function(t,i){var e=[1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1];_.mul(e,this.tr,this.tr)},_.prototype.translate=function(t,i){this.tr[12]=t,this.tr[13]=i},_.prototype.translateX=function(t){this.tr[12]=t},_.prototype.translateY=function(t){this.tr[13]=t},_.prototype.multScale=function(t,i){var e=[t,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1];_.mul(e,this.tr,this.tr)},_.prototype.scale=function(t,i){this.tr[0]=t,this.tr[5]=i},a.prototype=new _,a.prototype.setPosition=function(t,i){this.translate(t,i)},a.prototype.setCenterPosition=function(t,i){var e=this.width*this.getScaleX(),r=this.height*this.getScaleY();this.translate(t-e/2,i-r/2)},a.prototype.top=function(t){this.setY(t)},a.prototype.bottom=function(t){var i=this.height*this.getScaleY();this.translateY(t-i)},a.prototype.left=function(t){this.setX(t)},a.prototype.right=function(t){var i=this.width*this.getScaleX();this.translateX(t-i)},a.prototype.centerX=function(t){var i=this.width*this.getScaleX();this.translateX(t-i/2)},a.prototype.centerY=function(t){var i=this.height*this.getScaleY();this.translateY(t-i/2)},a.prototype.setX=function(t){this.translateX(t)},a.prototype.setY=function(t){this.translateY(t)},a.prototype.setHeight=function(t){var i=t/this.height,e=-i;this.scale(i,e)},a.prototype.setWidth=function(t){var i=t/this.width,e=-i;this.scale(i,e)},h.prototype=new MotionQueueManager,h.prototype.getCurrentPriority=function(){return this.currentPriority},h.prototype.getReservePriority=function(){return this.reservePriority},h.prototype.reserveMotion=function(t){return!(this.reservePriority>=t)&&(!(this.currentPriority>=t)&&(this.reservePriority=t,!0))},h.prototype.setReservePriority=function(t){this.reservePriority=t},h.prototype.updateParam=function(t){var i=MotionQueueManager.prototype.updateParam.call(this,t);return this.isFinished()&&(this.currentPriority=0),i},h.prototype.startMotionPrio=function(t,i){return i==this.reservePriority&&(this.reservePriority=0),this.currentPriority=i,this.startMotion(t,!1)},l.load=function(t){for(var i=new l,e=c.getPlatformManager(),r=e.jsonParseFromBytes(t),o=r.physics_hair,n=o.length,s=0;s<n;s++){var _=o[s],a=new PhysicsHair,h=_.setup,$=parseFloat(h.length),u=parseFloat(h.regist),p=parseFloat(h.mass);a.setup($,u,p);for(var f=_.src,d=f.length,g=0;g<d;g++){var y=f[g],m=y.id,T=PhysicsHair.Src.SRC_TO_X,P=y.ptype;"x"===P?T=PhysicsHair.Src.SRC_TO_X:"y"===P?T=PhysicsHair.Src.SRC_TO_Y:"angle"===P?T=PhysicsHair.Src.SRC_TO_G_ANGLE:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Src");var S=parseFloat(y.scale),v=parseFloat(y.weight);a.addSrcParam(T,m,S,v)}for(var L=_.targets,M=L.length,g=0;g<M;g++){var E=L[g],m=E.id,T=PhysicsHair.Target.TARGET_FROM_ANGLE,P=E.ptype;"angle"===P?T=PhysicsHair.Target.TARGET_FROM_ANGLE:"angle_v"===P?T=PhysicsHair.Target.TARGET_FROM_ANGLE_V:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Target");var S=parseFloat(E.scale),v=parseFloat(E.weight);a.addTargetParam(T,m,S,v)}i.physicsList.push(a)}return i},l.prototype.updateParam=function(t){for(var i=UtSystem.getUserTimeMSec()-this.startTimeMSec,e=0;e<this.physicsList.length;e++)this.physicsList[e].update(t,i)},$.load=function(t){for(var i=new $,e=c.getPlatformManager(),r=e.jsonParseFromBytes(t),o=r.parts_visible,n=o.length,s=0;s<n;s++){for(var _=o[s],a=_.group,h=a.length,l=new Array,p=0;p<h;p++){var f=a[p],d=new u(f.id);if(l[p]=d,null!=f.link){var g=f.link,y=g.length;d.link=new Array;for(var m=0;m<y;m++){var T=new u(g[m]);d.link.push(T)}}}i.partsGroups.push(l)}return i},$.prototype.updateParam=function(t){if(null!=t){t!=this.lastModel&&this.initParam(t),this.lastModel=t;var i=UtSystem.getUserTimeMSec(),e=0==this.lastTime?0:(i-this.lastTime)/1e3;this.lastTime=i,e<0&&(e=0);for(var r=0;r<this.partsGroups.length;r++)this.normalizePartsOpacityGroup(t,this.partsGroups[r],e),this.copyOpacityOtherParts(t,this.partsGroups[r])}},$.prototype.initParam=function(t){if(null!=t)for(var i=0;i<this.partsGroups.length;i++)for(var e=this.partsGroups[i],r=0;r<e.length;r++){e[r].initIndex(t);var o=e[r].partsIndex,n=e[r].paramIndex;if(!(o<0)){var s=0!=t.getParamFloat(n);if(t.setPartsOpacity(o,s?1:0),t.setParamFloat(n,s?1:0),null!=e[r].link)for(var _=0;_<e[r].link.length;_++)e[r].link[_].initIndex(t)}}},$.prototype.normalizePartsOpacityGroup=function(t,i,e){for(var r=-1,o=1,n=0;n<i.length;n++){var s=i[n].partsIndex,_=i[n].paramIndex;if(!(s<0)&&0!=t.getParamFloat(_)){if(r>=0)break;r=n,o=t.getPartsOpacity(s),o+=e/.5,o>1&&(o=1)}}r<0&&(r=0,o=1);for(var n=0;n<i.length;n++){var s=i[n].partsIndex;if(!(s<0))if(r==n)t.setPartsOpacity(s,o);else{var a,h=t.getPartsOpacity(s);a=o<.5?-.5*o/.5+1:.5*(1-o)/.5;var l=(1-a)*(1-o);l>.15&&(a=1-.15/(1-o)),h>a&&(h=a),t.setPartsOpacity(s,h)}}},$.prototype.copyOpacityOtherParts=function(t,i){for(var e=0;e<i.length;e++){var r=i[e];if(null!=r.link&&!(r.partsIndex<0))for(var o=t.getPartsOpacity(r.partsIndex),n=0;n<r.link.length;n++){var s=r.link[n];s.partsIndex<0||t.setPartsOpacity(s.partsIndex,o)}}},u.prototype.initIndex=function(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)},p.FRAME_RATE=30,p.prototype.setPoint=function(t,i){this.faceTargetX=t,this.faceTargetY=i},p.prototype.getX=function(){return this.faceX},p.prototype.getY=function(){return this.faceY},p.prototype.update=function(){var t=40/7.5/p.FRAME_RATE;if(0==this.lastTimeSec)return void(this.lastTimeSec=UtSystem.getUserTimeMSec());var i=UtSystem.getUserTimeMSec(),e=(i-this.lastTimeSec)*p.FRAME_RATE/1e3;this.lastTimeSec=i;var r=.15*p.FRAME_RATE,o=e*t/r,n=this.faceTargetX-this.faceX,s=this.faceTargetY-this.faceY;if(!(Math.abs(n)<=this.EPSILON&&Math.abs(s)<=this.EPSILON)){var _=Math.sqrt(n*n+s*s),a=t*n/_,h=t*s/_,l=a-this.faceVX,$=h-this.faceVY,u=Math.sqrt(l*l+$*$);(u<-o||u>o)&&(l*=o/u,$*=o/u,u=o),this.faceVX+=l,this.faceVY+=$;var f=.5*(Math.sqrt(o*o+16*o*_-8*o*_)-o),c=Math.sqrt(this.faceVX*this.faceVX+this.faceVY*this.faceVY);c>f&&(this.faceVX*=f/c,this.faceVY*=f/c),this.faceX+=this.faceVX,this.faceY+=this.faceVY}},f.prototype=new _,f.prototype.getMaxScale=function(){return this.max},f.prototype.getMinScale=function(){return this.min},f.prototype.setMaxScale=function(t){this.max=t},f.prototype.setMinScale=function(t){this.min=t},f.prototype.isMaxScale=function(){return this.getScaleX()==this.max},f.prototype.isMinScale=function(){return this.getScaleX()==this.min},f.prototype.adjustTranslate=function(t,i){this.tr[0]*this.maxLeft+(this.tr[12]+t)>this.screenLeft&&(t=this.screenLeft-this.tr[0]*this.maxLeft-this.tr[12]),this.tr[0]*this.maxRight+(this.tr[12]+t)<this.screenRight&&(t=this.screenRight-this.tr[0]*this.maxRight-this.tr[12]),this.tr[5]*this.maxTop+(this.tr[13]+i)<this.screenTop&&(i=this.screenTop-this.tr[5]*this.maxTop-this.tr[13]),this.tr[5]*this.maxBottom+(this.tr[13]+i)>this.screenBottom&&(i=this.screenBottom-this.tr[5]*this.maxBottom-this.tr[13]);var e=[1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1];_.mul(e,this.tr,this.tr)},f.prototype.adjustScale=function(t,i,e){var r=e*this.tr[0];r<this.min?this.tr[0]>0&&(e=this.min/this.tr[0]):r>this.max&&this.tr[0]>0&&(e=this.max/this.tr[0]);var o=[1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1],n=[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,-t,-i,0,1];_.mul(s,this.tr,this.tr),_.mul(n,this.tr,this.tr),_.mul(o,this.tr,this.tr)},f.prototype.setScreenRect=function(t,i,e,r){this.screenLeft=t,this.screenRight=i,this.screenTop=r,this.screenBottom=e},f.prototype.setMaxScreenRect=function(t,i,e,r){this.maxLeft=t,this.maxRight=i,this.maxTop=r,this.maxBottom=e},f.prototype.getScreenLeft=function(){return this.screenLeft},f.prototype.getScreenRight=function(){return this.screenRight},f.prototype.getScreenBottom=function(){return this.screenBottom},f.prototype.getScreenTop=function(){return this.screenTop},f.prototype.getMaxLeft=function(){return this.maxLeft},f.prototype.getMaxRight=function(){return this.maxRight},f.prototype.getMaxBottom=function(){return this.maxBottom},f.prototype.getMaxTop=function(){return this.maxTop},c.platformManager=null,c.getPlatformManager=function(){return c.platformManager},c.setPlatformManager=function(t){c.platformManager=t},t.exports={L2DTargetPoint:p,Live2DFramework:c,L2DViewMatrix:f,L2DPose:$,L2DPartsParam:u,L2DPhysics:l,L2DMotionManager:h,L2DModelMatrix:a,L2DMatrix44:_,EYE_STATE:g,L2DEyeBlink:s,L2DExpressionParam:n,L2DExpressionMotion:o,L2DBaseModel:r}},function(t,i,e){"use strict";var r={DEBUG_LOG:!1,DEBUG_MOUSE_LOG:!1,DEBUG_DRAW_HIT_AREA:!1,DEBUG_DRAW_ALPHA_MODEL:!1,VIEW_MAX_SCALE:2,VIEW_MIN_SCALE:.8,VIEW_LOGICAL_LEFT:-1,VIEW_LOGICAL_RIGHT:1,VIEW_LOGICAL_MAX_LEFT:-2,VIEW_LOGICAL_MAX_RIGHT:2,VIEW_LOGICAL_MAX_BOTTOM:-2,VIEW_LOGICAL_MAX_TOP:2,PRIORITY_NONE:0,PRIORITY_IDLE:1,PRIORITY_SLEEPY:2,PRIORITY_NORMAL:3,PRIORITY_FORCE:4,MOTION_GROUP_IDLE:"idle",MOTION_GROUP_SLEEPY:"sleepy",MOTION_GROUP_TAP_BODY:"tap_body",MOTION_GROUP_FLICK_HEAD:"flick_head",MOTION_GROUP_PINCH_IN:"pinch_in",MOTION_GROUP_PINCH_OUT:"pinch_out",MOTION_GROUP_SHAKE:"shake",HIT_AREA_HEAD:"head",HIT_AREA_BODY:"body"};t.exports=r},function(t,i,e){"use strict";function r(t){n=t}function o(){return n}Object.defineProperty(i,"__esModule",{value:!0}),i.setContext=r,i.getContext=o;var n=void 0},function(t,i,e){"use strict";function r(){}r.matrixStack=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.depth=0,r.currentMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.tmp=new Array(16),r.reset=function(){this.depth=0},r.loadIdentity=function(){for(var t=0;t<16;t++)this.currentMatrix[t]=t%5==0?1:0},r.push=function(){var t=(this.depth,16*(this.depth+1));this.matrixStack.length<t+16&&(this.matrixStack.length=t+16);for(var i=0;i<16;i++)this.matrixStack[t+i]=this.currentMatrix[i];this.depth++},r.pop=function(){--this.depth<0&&(myError("Invalid matrix stack."),this.depth=0);for(var t=16*this.depth,i=0;i<16;i++)this.currentMatrix[i]=this.matrixStack[t+i]},r.getMatrix=function(){return this.currentMatrix},r.multMatrix=function(t){var i,e,r;for(i=0;i<16;i++)this.tmp[i]=0;for(i=0;i<4;i++)for(e=0;e<4;e++)for(r=0;r<4;r++)this.tmp[i+4*e]+=this.currentMatrix[i+4*r]*t[r+4*e];for(i=0;i<16;i++)this.currentMatrix[i]=this.tmp[i]},t.exports=r},function(t,i,e){t.exports=e(5)},function(t,i,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){C=document.getElementById(t),C.addEventListener&&(window.addEventListener("click",g),window.addEventListener("mousedown",g),window.addEventListener("mousemove",g),window.addEventListener("mouseup",g),document.addEventListener("mouseout",g),window.addEventListener("touchstart",y),window.addEventListener("touchend",y),window.addEventListener("touchmove",y))}function n(t){var i=C.width,e=C.height;N=new M.L2DTargetPoint;var r=e/i,o=w.default.VIEW_LOGICAL_LEFT,n=w.default.VIEW_LOGICAL_RIGHT,_=-r,h=r;if(window.Live2D.captureFrame=!1,B=new M.L2DViewMatrix,B.setScreenRect(o,n,_,h),B.setMaxScreenRect(w.default.VIEW_LOGICAL_MAX_LEFT,w.default.VIEW_LOGICAL_MAX_RIGHT,w.default.VIEW_LOGICAL_MAX_BOTTOM,w.default.VIEW_LOGICAL_MAX_TOP),B.setMaxScale(w.default.VIEW_MAX_SCALE),B.setMinScale(w.default.VIEW_MIN_SCALE),U=new M.L2DMatrix44,U.multScale(1,i/e),G=new M.L2DMatrix44,G.multTranslate(-i/2,-e/2),G.multScale(2/i,-2/i),F=v(),(0,D.setContext)(F),!F)return console.error("Failed to create WebGL context."),void(window.WebGLRenderingContext&&console.error("Your browser don\'t support WebGL, check https://get.webgl.org/ for futher information."));window.Live2D.setGL(F),F.clearColor(0,0,0,0),a(t),s()}function s(){b||(b=!0,function t(){_();var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;if(window.Live2D.captureFrame){window.Live2D.captureFrame=!1;var e=document.createElement("a");document.body.appendChild(e),e.setAttribute("type","hidden"),e.href=C.toDataURL(),e.download=window.Live2D.captureName||"live2d.png",e.click()}i(t,C)}())}function _(){O.default.reset(),O.default.loadIdentity(),N.update(),R.setDrag(N.getX(),N.getY()),F.clear(F.COLOR_BUFFER_BIT),O.default.multMatrix(U.getArray()),O.default.multMatrix(B.getArray()),O.default.push();for(var t=0;t<R.numModels();t++){var i=R.getModel(t);if(null==i)return;i.initialized&&!i.updating&&(i.update(),i.draw(F))}O.default.pop()}function a(t){R.reloadFlg=!0,R.count++,R.changeModel(F,t)}function h(t,i){return t.x*i.x+t.y*i.y}function l(t,i){var e=Math.sqrt(t*t+i*i);return{x:t/e,y:i/e}}function $(t,i,e){function r(t,i){return 180*Math.acos(h({x:0,y:1},l(t,i)))/Math.PI}if(i.x<e.left+e.width&&i.y<e.top+e.height&&i.x>e.left&&i.y>e.top)return i;var o=t.x-i.x,n=t.y-i.y,s=r(o,n);i.x<t.x&&(s=360-s);var _=360-r(e.left-t.x,-1*(e.top-t.y)),a=360-r(e.left-t.x,-1*(e.top+e.height-t.y)),$=r(e.left+e.width-t.x,-1*(e.top-t.y)),u=r(e.left+e.width-t.x,-1*(e.top+e.height-t.y)),p=n/o,f={};if(s<$){var c=e.top-t.y,d=c/p;f={y:t.y+c,x:t.x+d}}else if(s<u){var g=e.left+e.width-t.x,y=g*p;f={y:t.y+y,x:t.x+g}}else if(s<a){var m=e.top+e.height-t.y,T=m/p;f={y:t.y+m,x:t.x+T}}else if(s<_){var P=t.x-e.left,S=P*p;f={y:t.y-S,x:t.x-P}}else{var v=e.top-t.y,L=v/p;f={y:t.y+v,x:t.x+L}}return f}function u(t){Y=!0;var i=C.getBoundingClientRect(),e=P(t.clientX-i.left),r=S(t.clientY-i.top),o=$({x:i.left+i.width/2,y:i.top+i.height*X},{x:t.clientX,y:t.clientY},i),n=m(o.x-i.left),s=T(o.y-i.top);w.default.DEBUG_MOUSE_LOG&&console.log("onMouseMove device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+n+" y:"+s+")"),k=e,V=r,N.setPoint(n,s)}function p(t){Y=!0;var i=C.getBoundingClientRect(),e=P(t.clientX-i.left),r=S(t.clientY-i.top),o=$({x:i.left+i.width/2,y:i.top+i.height*X},{x:t.clientX,y:t.clientY},i),n=m(o.x-i.left),s=T(o.y-i.top);w.default.DEBUG_MOUSE_LOG&&console.log("onMouseDown device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+n+" y:"+s+")"),k=e,V=r,R.tapEvent(n,s)}function f(t){var i=C.getBoundingClientRect(),e=P(t.clientX-i.left),r=S(t.clientY-i.top),o=$({x:i.left+i.width/2,y:i.top+i.height*X},{x:t.clientX,y:t.clientY},i),n=m(o.x-i.left),s=T(o.y-i.top);w.default.DEBUG_MOUSE_LOG&&console.log("onMouseMove device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+n+" y:"+s+")"),Y&&(k=e,V=r,N.setPoint(n,s))}function c(){Y&&(Y=!1),N.setPoint(0,0)}function d(){w.default.DEBUG_LOG&&console.log("Set Session Storage."),sessionStorage.setItem("Sleepy","1")}function g(t){if("mousewheel"==t.type);else if("mousedown"==t.type)p(t);else if("mousemove"==t.type){var i=sessionStorage.getItem("Sleepy");"1"===i&&sessionStorage.setItem("Sleepy","0"),u(t)}else if("mouseup"==t.type){if("button"in t&&0!=t.button)return}else if("mouseout"==t.type){w.default.DEBUG_LOG&&console.log("Mouse out Window."),c();var e=sessionStorage.getItem("SleepyTimer");window.clearTimeout(e),e=window.setTimeout(d,5e4),sessionStorage.setItem("SleepyTimer",e)}}function y(t){var i=t.touches[0];"touchstart"==t.type?1==t.touches.length&&u(i):"touchmove"==t.type?f(i):"touchend"==t.type&&c()}function m(t){var i=G.transformX(t);return B.invertTransformX(i)}function T(t){var i=G.transformY(t);return B.invertTransformY(i)}function P(t){return G.transformX(t)}function S(t){return G.transformY(t)}function v(){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=0;i<t.length;i++)try{var e=C.getContext(t[i],{premultipliedAlpha:!0});if(e)return e}catch(t){}return null}function L(t,i,e){X=void 0===e?.5:e,o(t),n(i)}e(6);var M=e(0),E=e(8),A=r(E),I=e(1),w=r(I),x=e(3),O=r(x),D=e(2),R=(window.navigator.platform.toLowerCase(),new A.default),b=!1,F=null,C=null,N=null,B=null,U=null,G=null,Y=!1,k=0,V=0,X=.5;window.loadlive2d=L},function(t,i,e){"use strict";(function(t){!function(){function i(){At||(this._$MT=null,this._$5S=null,this._$NP=0,i._$42++,this._$5S=new Y(this))}function e(t){if(!At){this.clipContextList=new Array,this.glcontext=t.gl,this.dp_webgl=t,this.curFrameNo=0,this.firstError_clipInNotUpdate=!0,this.colorBuffer=0,this.isInitGLFBFunc=!1,this.tmpBoundsOnModel=new S,at.glContext.length>at.frameBuffers.length&&(this.curFrameNo=this.getMaskRenderTexture()),this.tmpModelToViewMatrix=new R,this.tmpMatrix2=new R,this.tmpMatrixForMask=new R,this.tmpMatrixForDraw=new R,this.CHANNEL_COLORS=new Array;var i=new A;i=new A,i.r=0,i.g=0,i.b=0,i.a=1,this.CHANNEL_COLORS.push(i),i=new A,i.r=1,i.g=0,i.b=0,i.a=0,this.CHANNEL_COLORS.push(i),i=new A,i.r=0,i.g=1,i.b=0,i.a=0,this.CHANNEL_COLORS.push(i),i=new A,i.r=0,i.g=0,i.b=1,i.a=0,this.CHANNEL_COLORS.push(i);for(var e=0;e<this.CHANNEL_COLORS.length;e++)this.dp_webgl.setChannelFlagAsColor(e,this.CHANNEL_COLORS[e])}}function r(t,i,e){this.clipIDList=new Array,this.clipIDList=e,this.clippingMaskDrawIndexList=new Array;for(var r=0;r<e.length;r++)this.clippingMaskDrawIndexList.push(i.getDrawDataIndex(e[r]));this.clippedDrawContextList=new Array,this.isUsing=!0,this.layoutChannelNo=0,this.layoutBounds=new S,this.allClippedDrawRect=new S,this.matrixForMask=new Float32Array(16),this.matrixForDraw=new Float32Array(16),this.owner=t}function o(t,i){this._$gP=t,this.drawDataIndex=i}function n(){At||(this.color=null)}function s(){At||(this._$dP=null,this._$eo=null,this._$V0=null,this._$dP=1e3,this._$eo=1e3,this._$V0=1,this._$a0())}function _(){}function a(){this._$r=null,this._$0S=null}function h(){At||(this.x=null,this.y=null,this.width=null,this.height=null)}function l(t){At||et.prototype.constructor.call(this,t)}function $(){}function u(t){At||et.prototype.constructor.call(this,t)}function p(){At||(this._$vo=null,this._$F2=null,this._$ao=400,this._$1S=400,p._$42++)}function f(){At||(this.p1=new c,this.p2=new c,this._$Fo=0,this._$Db=0,this._$L2=0,this._$M2=0,this._$ks=0,this._$9b=0,this._$iP=0,this._$iT=0,this._$lL=new Array,this._$qP=new Array,this.setup(.3,.5,.1))}function c(){this._$p=1,this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.fx=0,this.fy=0,this._$s0=0,this._$70=0,this._$7L=0,this._$HL=0}function d(t,i,e){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=i,this._$V0=e}function g(t,i,e,r){d.prototype.constructor.call(this,i,e,r),this._$tL=null,this._$tL=t}function y(t,i,e){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=i,this._$V0=e}function T(t,i,e,r){y.prototype.constructor.call(this,i,e,r),this._$YP=null,this._$YP=t}function P(){At||(this._$fL=0,this._$gL=0,this._$B0=1,this._$z0=1,this._$qT=0,this.reflectX=!1,this.reflectY=!1)}function S(){At||(this.x=null,this.y=null,this.width=null,this.height=null)}function v(){}function L(){At||(this.x=null,this.y=null)}function M(){At||(this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null,this.clipID=null,this.clipIDList=new Array)}function E(){At||(this._$Eb=E._$ps,this._$lT=1,this._$C0=1,this._$tT=1,this._$WL=1,this.culling=!1,this.matrix4x4=new Float32Array(16),this.premultipliedAlpha=!1,this.anisotropy=0,this.clippingProcess=E.CLIPPING_PROCESS_NONE,this.clipBufPre_clipContextMask=null,this.clipBufPre_clipContextDraw=null,this.CHANNEL_COLORS=new Array)}function A(){At||(this.a=1,this.r=1,this.g=1,this.b=1,this.scale=1,this._$ho=1,this.blendMode=at.L2D_COLOR_BLEND_MODE_MULT)}function I(){At||(this._$kP=null,this._$dr=null,this._$Ai=!0,this._$mS=null)}function w(){}function x(){At||(this._$VP=0,this._$wL=null,this._$GP=null,this._$8o=x._$ds,this._$2r=-1,this._$O2=0,this._$ri=0)}function O(){}function D(){At||(this._$Ob=null)}function R(){this.m=new Float32Array(16),this.identity()}function b(t){At||et.prototype.constructor.call(this,t)}function F(){At||(this._$7=1,this._$f=0,this._$H=0,this._$g=1,this._$k=0,this._$w=0,this._$hi=STATE_IDENTITY,this._$Z=_$pS)}function C(){At||(s.prototype.constructor.call(this),this.motions=new Array,this._$7r=null,this._$7r=C._$Co++,this._$D0=30,this._$yT=0,this._$E=!0,this.loopFadeIn=!0,this._$AS=-1,_$a0())}function N(){this._$P=new Float32Array(100),this.size=0}function B(){this._$4P=null,this._$I0=null,this._$RP=null}function U(){}function G(){}function Y(t){At||(this._$QT=!0,this._$co=-1,this._$qo=0,this._$pb=new Array(Y._$is),this._$_2=new Float32Array(Y._$is),this._$vr=new Float32Array(Y._$is),this._$Rr=new Float32Array(Y._$is),this._$Or=new Float32Array(Y._$is),this._$fs=new Float32Array(Y._$is),this._$Js=new Array(Y._$is),this._$3S=new Array,this._$aS=new Array,this._$Bo=null,this._$F2=new Array,this._$db=new Array,this._$8b=new Array,this._$Hr=new Array,this._$Ws=null,this._$Vs=null,this._$Er=null,this._$Es=new Int16Array(U._$Qb),this._$ZP=new Float32Array(2*U._$1r),this._$Ri=t,this._$b0=Y._$HP++,this.clipManager=null,this.dp_webgl=null)}function k(){}function V(){At||(this._$12=null,this._$bb=null,this._$_L=null,this._$jo=null,this._$iL=null,this._$0L=null,this._$Br=null,this._$Dr=null,this._$Cb=null,this._$mr=null,this._$_L=wt.STATE_FIRST,this._$Br=4e3,this._$Dr=100,this._$Cb=50,this._$mr=150,this._$jo=!0,this._$iL="PARAM_EYE_L_OPEN",this._$0L="PARAM_EYE_R_OPEN")}function X(){At||(E.prototype.constructor.call(this),this._$sb=new Int32Array(X._$As),this._$U2=new Array,this.transform=null,this.gl=null,null==X._$NT&&(X._$NT=X._$9r(256),X._$vS=X._$9r(256),X._$no=X._$vb(256)))}function z(){At||(I.prototype.constructor.call(this),this._$GS=null,this._$Y0=null)}function H(t){_t.prototype.constructor.call(this,t),this._$8r=I._$ur,this._$Yr=null,this._$Wr=null}function W(){At||(M.prototype.constructor.call(this),this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null)}function j(){At||(this._$NL=null,this._$3S=null,this._$aS=null,j._$42++)}function q(){At||(i.prototype.constructor.call(this),this._$zo=new X)}function J(){At||(s.prototype.constructor.call(this),this.motions=new Array,this._$o2=null,this._$7r=J._$Co++,this._$D0=30,this._$yT=0,this._$E=!1,this.loopFadeIn=!0,this._$rr=-1,this._$eP=0)}function Q(t,i){return String.fromCharCode(t.getUint8(i))}function N(){this._$P=new Float32Array(100),this.size=0}function B(){this._$4P=null,this._$I0=null,this._$RP=null}function Z(){At||(I.prototype.constructor.call(this),this._$o=0,this._$A=0,this._$GS=null,this._$Eo=null)}function K(t){_t.prototype.constructor.call(this,t),this._$8r=I._$ur,this._$Cr=null,this._$hr=null}function tt(){At||(this.visible=!0,this._$g0=!1,this._$NL=null,this._$3S=null,this._$aS=null,tt._$42++)}function it(t){this._$VS=null,this._$e0=null,this._$e0=t}function et(t){At||(this.id=t)}function rt(){}function ot(){At||(this._$4S=null)}function nt(t,i){this.canvas=t,this.context=i,this.viewport=new Array(0,0,t.width,t.height),this._$6r=1,this._$xP=0,this._$3r=1,this._$uP=0,this._$Qo=-1,this.cacheImages={}}function st(){At||(this._$TT=null,this._$LT=null,this._$FS=null,this._$wL=null)}function _t(t){At||(this._$e0=null,this._$IP=null,this._$JS=!1,this._$AT=!0,this._$e0=t,this.totalScale=1,this._$7s=1,this.totalOpacity=1)}function at(){}function ht(){}function lt(t){At||(this._$ib=t)}function $t(){At||(W.prototype.constructor.call(this),this._$LP=-1,this._$d0=0,this._$Yo=0,this._$JP=null,this._$5P=null,this._$BP=null,this._$Eo=null,this._$Qi=null,this._$6s=$t._$ms,this.culling=!0,this.gl_cacheImage=null,this.instanceNo=$t._$42++)}function ut(t){Mt.prototype.constructor.call(this,t),this._$8r=W._$ur,this._$Cr=null,this._$hr=null}function pt(){At||(this.x=null,this.y=null)}function ft(t){At||(i.prototype.constructor.call(this),this.drawParamWebGL=new mt(t),this.drawParamWebGL.setGL(at.getGL(t)))}function ct(){At||(this.motions=null,this._$eb=!1,this.motions=new Array)}function dt(){this._$w0=null,this._$AT=!0,this._$9L=!1,this._$z2=-1,this._$bs=-1,this._$Do=-1,this._$sr=null,this._$sr=dt._$Gs++}function gt(){this.m=new Array(1,0,0,0,1,0,0,0,1)}function yt(t){At||et.prototype.constructor.call(this,t)}function mt(t){At||(E.prototype.constructor.call(this),this.textures=new Array,this.transform=null,this.gl=null,this.glno=t,this.firstDraw=!0,this.anisotropyExt=null,this.maxAnisotropy=0,this._$As=32,this._$Gr=!1,this._$NT=null,this._$vS=null,this._$no=null,this.vertShader=null,this.fragShader=null,this.vertShaderOff=null,this.fragShaderOff=null)}function Tt(t,i,e){return null==i&&(i=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW),i}function Pt(t,i,e){return null==i&&(i=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.DYNAMIC_DRAW),i}function St(t){At||(this._$P=new Int8Array(8),this._$R0=new DataView(this._$P.buffer),this._$3i=new Int8Array(1e3),this._$hL=0,this._$v0=0,this._$S2=0,this._$Ko=new Array,this._$T=t,this._$F=0)}function vt(){}function Lt(){}function Mt(t){At||(this._$e0=null,this._$IP=null,this._$Us=null,this._$7s=null,this._$IS=[!1],this._$VS=null,this._$AT=!0,this.baseOpacity=1,this.clipBufPre_clipContext=null,this._$e0=t)}function Et(){}var At=!0;i._$0s=1,i._$4s=2,i._$42=0,i._$62=function(t,e){try{if(e instanceof ArrayBuffer&&(e=new DataView(e)),!(e instanceof DataView))throw new lt("_$SS#loadModel(b) / b _$x be DataView or ArrayBuffer");var r,o=new St(e),n=o._$ST(),s=o._$ST(),a=o._$ST();if(109!=n||111!=s||99!=a)throw new lt("_$gi _$C _$li , _$Q0 _$P0.");if(r=o._$ST(),o._$gr(r),r>G._$T7){t._$NP|=i._$4s;throw new lt("_$gi _$C _$li , _$n0 _$_ version _$li ( SDK : "+G._$T7+" < _$f0 : "+r+" )@_$SS#loadModel()\\n")}var h=o._$nP();if(r>=G._$s7){var l=o._$9T(),$=o._$9T();if(-30584!=l||-30584!=$)throw t._$NP|=i._$0s,new lt("_$gi _$C _$li , _$0 _$6 _$Ui.")}t._$KS(h);var u=t.getModelContext();u.setDrawParam(t.getDrawParam()),u.init()}catch(t){_._$Rb(t)}},i.prototype._$KS=function(t){this._$MT=t},i.prototype.getModelImpl=function(){return null==this._$MT&&(this._$MT=new p,this._$MT._$zP()),this._$MT},i.prototype.getCanvasWidth=function(){return null==this._$MT?0:this._$MT.getCanvasWidth()},i.prototype.getCanvasHeight=function(){return null==this._$MT?0:this._$MT.getCanvasHeight()},i.prototype.getParamFloat=function(t){return"number"!=typeof t&&(t=this._$5S.getParamIndex(u.getID(t))),this._$5S.getParamFloat(t)},i.prototype.setParamFloat=function(t,i,e){"number"!=typeof t&&(t=this._$5S.getParamIndex(u.getID(t))),arguments.length<3&&(e=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1-e)+i*e)},i.prototype.addToParamFloat=function(t,i,e){"number"!=typeof t&&(t=this._$5S.getParamIndex(u.getID(t))),arguments.length<3&&(e=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)+i*e)},i.prototype.multParamFloat=function(t,i,e){"number"!=typeof t&&(t=this._$5S.getParamIndex(u.getID(t))),arguments.length<3&&(e=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1+(i-1)*e))},i.prototype.getParamIndex=function(t){return this._$5S.getParamIndex(u.getID(t))},i.prototype.loadParam=function(){this._$5S.loadParam()},i.prototype.saveParam=function(){this._$5S.saveParam()},i.prototype.init=function(){this._$5S.init()},i.prototype.update=function(){this._$5S.update()},i.prototype._$Rs=function(){return _._$li("_$60 _$PT _$Rs()"),-1},i.prototype._$Ds=function(t){_._$li("_$60 _$PT _$SS#_$Ds() \\n")},i.prototype._$K2=function(){},i.prototype.draw=function(){},i.prototype.getModelContext=function(){return this._$5S},i.prototype._$s2=function(){return this._$NP},i.prototype._$P7=function(t,i,e,r){var o=-1,n=0,s=this;if(0!=e)if(1==t.length){var _=t[0],a=0!=s.getParamFloat(_),h=i[0],l=s.getPartsOpacity(h),$=e/r;a?(l+=$)>1&&(l=1):(l-=$)<0&&(l=0),s.setPartsOpacity(h,l)}else{for(var u=0;u<t.length;u++){var _=t[u],p=0!=s.getParamFloat(_);if(p){if(o>=0)break;o=u;var h=i[u];n=s.getPartsOpacity(h),n+=e/r,n>1&&(n=1)}}o<0&&(console.log("No _$wi _$q0/ _$U default[%s]",t[0]),o=0,n=1,s.loadParam(),s.setParamFloat(t[o],n),s.saveParam());for(var u=0;u<t.length;u++){var h=i[u];if(o==u)s.setPartsOpacity(h,n);else{var f,c=s.getPartsOpacity(h);f=n<.5?-.5*n/.5+1:.5*(1-n)/.5;var d=(1-f)*(1-n);d>.15&&(f=1-.15/(1-n)),c>f&&(c=f),s.setPartsOpacity(h,c)}}}else for(var u=0;u<t.length;u++){var _=t[u],h=i[u],p=0!=s.getParamFloat(_);s.setPartsOpacity(h,p?1:0)}},i.prototype.setPartsOpacity=function(t,i){"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(l.getID(t))),this._$5S.setPartsOpacity(t,i)},i.prototype.getPartsDataIndex=function(t){return t instanceof l||(t=l.getID(t)),this._$5S.getPartsDataIndex(t)},i.prototype.getPartsOpacity=function(t){return"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(l.getID(t))),t<0?0:this._$5S.getPartsOpacity(t)},i.prototype.getDrawParam=function(){},i.prototype.getDrawDataIndex=function(t){return this._$5S.getDrawDataIndex(b.getID(t))},i.prototype.getDrawData=function(t){return this._$5S.getDrawData(t)},i.prototype.getTransformedPoints=function(t){var i=this._$5S._$C2(t);return i instanceof ut?i.getTransformedPoints():null},i.prototype.getIndexArray=function(t){if(t<0||t>=this._$5S._$aS.length)return null;var i=this._$5S._$aS[t];return null!=i&&i.getType()==W._$wb&&i instanceof $t?i.getIndexArray():null},e.CHANNEL_COUNT=4,e.RENDER_TEXTURE_USE_MIPMAP=!1,e.NOT_USED_FRAME=-100,e.prototype._$L7=function(){if(this.tmpModelToViewMatrix&&(this.tmpModelToViewMatrix=null),this.tmpMatrix2&&(this.tmpMatrix2=null),this.tmpMatrixForMask&&(this.tmpMatrixForMask=null),this.tmpMatrixForDraw&&(this.tmpMatrixForDraw=null),this.tmpBoundsOnModel&&(this.tmpBoundsOnModel=null),this.CHANNEL_COLORS){for(var t=this.CHANNEL_COLORS.length-1;t>=0;--t)this.CHANNEL_COLORS.splice(t,1);this.CHANNEL_COLORS=[]}this.releaseShader()},e.prototype.releaseShader=function(){for(var t=at.frameBuffers.length,i=0;i<t;i++)this.gl.deleteFramebuffer(at.frameBuffers[i].framebuffer);at.frameBuffers=[],at.glContext=[]},e.prototype.init=function(t,i,e){for(var o=0;o<i.length;o++){var n=i[o].getClipIDList();if(null!=n){var s=this.findSameClip(n);null==s&&(s=new r(this,t,n),this.clipContextList.push(s));var _=i[o].getDrawDataID(),a=t.getDrawDataIndex(_);s.addClippedDrawData(_,a);e[o].clipBufPre_clipContext=s}}},e.prototype.getMaskRenderTexture=function(){var t=null;return t=this.dp_webgl.createFramebuffer(),at.frameBuffers[this.dp_webgl.glno]=t,this.dp_webgl.glno},e.prototype.setupClip=function(t,i){for(var e=0,r=0;r<this.clipContextList.length;r++){var o=this.clipContextList[r];this.calcClippedDrawTotalBounds(t,o),o.isUsing&&e++}if(e>0){var n=i.gl.getParameter(i.gl.FRAMEBUFFER_BINDING),s=new Array(4);s[0]=0,s[1]=0,s[2]=i.gl.canvas.width,s[3]=i.gl.canvas.height,i.gl.viewport(0,0,at.clippingMaskBufferSize,at.clippingMaskBufferSize),this.setupLayoutBounds(e),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,at.frameBuffers[this.curFrameNo].framebuffer),i.gl.clearColor(0,0,0,0),i.gl.clear(i.gl.COLOR_BUFFER_BIT);for(var r=0;r<this.clipContextList.length;r++){var o=this.clipContextList[r],_=o.allClippedDrawRect,a=(o.layoutChannelNo,o.layoutBounds);this.tmpBoundsOnModel._$jL(_),this.tmpBoundsOnModel.expand(.05*_.width,.05*_.height);var h=a.width/this.tmpBoundsOnModel.width,l=a.height/this.tmpBoundsOnModel.height;this.tmpMatrix2.identity(),this.tmpMatrix2.translate(-1,-1,0),this.tmpMatrix2.scale(2,2,1),this.tmpMatrix2.translate(a.x,a.y,0),this.tmpMatrix2.scale(h,l,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForMask.setMatrix(this.tmpMatrix2.m),this.tmpMatrix2.identity(),this.tmpMatrix2.translate(a.x,a.y,0),this.tmpMatrix2.scale(h,l,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForDraw.setMatrix(this.tmpMatrix2.m);for(var $=this.tmpMatrixForMask.getArray(),u=0;u<16;u++)o.matrixForMask[u]=$[u];for(var p=this.tmpMatrixForDraw.getArray(),u=0;u<16;u++)o.matrixForDraw[u]=p[u];for(var f=o.clippingMaskDrawIndexList.length,c=0;c<f;c++){var d=o.clippingMaskDrawIndexList[c],g=t.getDrawData(d),y=t._$C2(d);i.setClipBufPre_clipContextForMask(o),g.draw(i,t,y)}}i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,n),i.setClipBufPre_clipContextForMask(null),i.gl.viewport(s[0],s[1],s[2],s[3])}},e.prototype.getColorBuffer=function(){return this.colorBuffer},e.prototype.findSameClip=function(t){for(var i=0;i<this.clipContextList.length;i++){var e=this.clipContextList[i],r=e.clipIDList.length;if(r==t.length){for(var o=0,n=0;n<r;n++)for(var s=e.clipIDList[n],_=0;_<r;_++)if(t[_]==s){o++;break}if(o==r)return e}}return null},e.prototype.calcClippedDrawTotalBounds=function(t,i){for(var e=t._$Ri.getModelImpl().getCanvasWidth(),r=t._$Ri.getModelImpl().getCanvasHeight(),o=e>r?e:r,n=o,s=o,_=0,a=0,h=i.clippedDrawContextList.length,l=0;l<h;l++){var $=i.clippedDrawContextList[l],u=$.drawDataIndex,p=t._$C2(u);if(p._$yo()){for(var f=p.getTransformedPoints(),c=f.length,d=[],g=[],y=0,m=U._$i2;m<c;m+=U._$No)d[y]=f[m],g[y]=f[m+1],y++;var T=Math.min.apply(null,d),P=Math.min.apply(null,g),S=Math.max.apply(null,d),v=Math.max.apply(null,g);T<n&&(n=T),P<s&&(s=P),S>_&&(_=S),v>a&&(a=v)}}if(n==o)i.allClippedDrawRect.x=0,i.allClippedDrawRect.y=0,i.allClippedDrawRect.width=0,i.allClippedDrawRect.height=0,i.isUsing=!1;else{var L=_-n,M=a-s;i.allClippedDrawRect.x=n,i.allClippedDrawRect.y=s,i.allClippedDrawRect.width=L,i.allClippedDrawRect.height=M,i.isUsing=!0}},e.prototype.setupLayoutBounds=function(t){var i=t/e.CHANNEL_COUNT,r=t%e.CHANNEL_COUNT;i=~~i,r=~~r;for(var o=0,n=0;n<e.CHANNEL_COUNT;n++){var s=i+(n<r?1:0);if(0==s);else if(1==s){var a=this.clipContextList[o++];a.layoutChannelNo=n,a.layoutBounds.x=0,a.layoutBounds.y=0,a.layoutBounds.width=1,a.layoutBounds.height=1}else if(2==s)for(var h=0;h<s;h++){var l=h%2,$=0;l=~~l;var a=this.clipContextList[o++];a.layoutChannelNo=n,a.layoutBounds.x=.5*l,a.layoutBounds.y=0,a.layoutBounds.width=.5,a.layoutBounds.height=1}else if(s<=4)for(var h=0;h<s;h++){var l=h%2,$=h/2;l=~~l,$=~~$;var a=this.clipContextList[o++];a.layoutChannelNo=n,a.layoutBounds.x=.5*l,a.layoutBounds.y=.5*$,a.layoutBounds.width=.5,a.layoutBounds.height=.5}else if(s<=9)for(var h=0;h<s;h++){var l=h%3,$=h/3;l=~~l,$=~~$;var a=this.clipContextList[o++];a.layoutChannelNo=n,a.layoutBounds.x=l/3,a.layoutBounds.y=$/3,a.layoutBounds.width=1/3,a.layoutBounds.height=1/3}else _._$li("_$6 _$0P mask count : %d",s)}},r.prototype.addClippedDrawData=function(t,i){var e=new o(t,i);this.clippedDrawContextList.push(e)},s._$JT=function(t,i,e){var r=t/i,o=e/i,n=o,s=1-(1-o)*(1-o),_=1-(1-n)*(1-n),a=1/3*(1-o)*s+(n*(2/3)+1/3*(1-n))*(1-s),h=(n+2/3*(1-n))*_+(o*(1/3)+2/3*(1-o))*(1-_),l=1-3*h+3*a-0,$=3*h-6*a+0,u=3*a-0;if(r<=0)return 0;if(r>=1)return 1;var p=r,f=p*p;return l*(p*f)+$*f+u*p+0},s.prototype._$a0=function(){},s.prototype.setFadeIn=function(t){this._$dP=t},s.prototype.setFadeOut=function(t){this._$eo=t},s.prototype._$pT=function(t){this._$V0=t},s.prototype.getFadeOut=function(){return this._$eo},s.prototype._$4T=function(){return this._$eo},s.prototype._$mT=function(){return this._$V0},s.prototype.getDurationMSec=function(){return-1},s.prototype.getLoopDurationMSec=function(){return-1},s.prototype.updateParam=function(t,i){if(i._$AT&&!i._$9L){var e=w.getUserTimeMSec();if(i._$z2<0){i._$z2=e,i._$bs=e;var r=this.getDurationMSec();i._$Do<0&&(i._$Do=r<=0?-1:i._$z2+r)}var o=this._$V0;o=o*(0==this._$dP?1:ht._$r2((e-i._$bs)/this._$dP))*(0==this._$eo||i._$Do<0?1:ht._$r2((i._$Do-e)/this._$eo)),0<=o&&o<=1||console.log("### assert!! ### "),this.updateParamExe(t,e,o,i),i._$Do>0&&i._$Do<e&&(i._$9L=!0)}},s.prototype.updateParamExe=function(t,i,e,r){},_._$8s=0,_._$fT=new Object,_.start=function(t){var i=_._$fT[t];null==i&&(i=new a,i._$r=t,_._$fT[t]=i),i._$0S=w.getSystemTimeMSec()},_.dump=function(t){var i=_._$fT[t];if(null!=i){var e=w.getSystemTimeMSec(),r=e-i._$0S;return console.log(t+" : "+r+"ms"),r}return-1},_.end=function(t){var i=_._$fT[t];if(null!=i){return w.getSystemTimeMSec()-i._$0S}return-1},_._$li=function(t,i){console.log("_$li : "+t+"\\n",i)},_._$Ji=function(t,i){console.log(t,i)},_._$dL=function(t,i){console.log(t,i),console.log("\\n")},_._$KL=function(t,i){for(var e=0;e<i;e++)e%16==0&&e>0?console.log("\\n"):e%8==0&&e>0&&console.log("  "),console.log("%02X ",255&t[e]);console.log("\\n")},_._$nr=function(t,i,e){console.log("%s\\n",t);for(var r=i.length,o=0;o<r;++o)console.log("%5d",i[o]),console.log("%s\\n",e),console.log(",");console.log("\\n")},_._$Rb=function(t){console.log("dump exception : "+t),console.log("stack :: "+t.stack)},h.prototype._$8P=function(){return.5*(this.x+this.x+this.width)},h.prototype._$6P=function(){return.5*(this.y+this.y+this.height)},h.prototype._$EL=function(){return this.x+this.width},h.prototype._$5T=function(){return this.y+this.height},h.prototype._$jL=function(t,i,e,r){this.x=t,this.y=i,this.width=e,this.height=r},h.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},l.prototype=new et,l._$tP=new Object,l._$27=function(){l._$tP.clear()},l.getID=function(t){var i=l._$tP[t];return null==i&&(i=new l(t),l._$tP[t]=i),i},l.prototype._$3s=function(){return new l},u.prototype=new et,u._$tP=new Object,u._$27=function(){u._$tP.clear()},u.getID=function(t){var i=u._$tP[t];return null==i&&(i=new u(t),u._$tP[t]=i),i},u.prototype._$3s=function(){return new u},p._$42=0,p.prototype._$zP=function(){null==this._$vo&&(this._$vo=new ot),null==this._$F2&&(this._$F2=new Array)},p.prototype.getCanvasWidth=function(){return this._$ao},p.prototype.getCanvasHeight=function(){return this._$1S},p.prototype._$F0=function(t){this._$vo=t._$nP(),this._$F2=t._$nP(),this._$ao=t._$6L(),this._$1S=t._$6L()},p.prototype._$6S=function(t){this._$F2.push(t)},p.prototype._$Xr=function(){return this._$F2},p.prototype._$E2=function(){return this._$vo},f.prototype.setup=function(t,i,e){this._$ks=this._$Yb(),this.p2._$xT(),3==arguments.length&&(this._$Fo=t,this._$L2=i,this.p1._$p=e,this.p2._$p=e,this.p2.y=t,this.setup())},f.prototype.getPhysicsPoint1=function(){return this.p1},f.prototype.getPhysicsPoint2=function(){return this.p2},f.prototype._$qr=function(){return this._$Db},f.prototype._$pr=function(t){this._$Db=t},f.prototype._$5r=function(){return this._$M2},f.prototype._$Cs=function(){return this._$9b},f.prototype._$Yb=function(){return-180*Math.atan2(this.p1.x-this.p2.x,-(this.p1.y-this.p2.y))/Math.PI},f.prototype.addSrcParam=function(t,i,e,r){var o=new g(t,i,e,r);this._$lL.push(o)},f.prototype.addTargetParam=function(t,i,e,r){var o=new T(t,i,e,r);this._$qP.push(o)},f.prototype.update=function(t,i){if(0==this._$iP)return this._$iP=this._$iT=i,void(this._$Fo=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)));var e=(i-this._$iT)/1e3;if(0!=e){for(var r=this._$lL.length-1;r>=0;--r){this._$lL[r]._$oP(t,this)}this._$oo(t,e),this._$M2=this._$Yb(),this._$9b=(this._$M2-this._$ks)/e,this._$ks=this._$M2}for(var r=this._$qP.length-1;r>=0;--r){this._$qP[r]._$YS(t,this)}this._$iT=i},f.prototype._$oo=function(t,i){i<.033&&(i=.033);var e=1/i;this.p1.vx=(this.p1.x-this.p1._$s0)*e,this.p1.vy=(this.p1.y-this.p1._$70)*e,this.p1.ax=(this.p1.vx-this.p1._$7L)*e,this.p1.ay=(this.p1.vy-this.p1._$HL)*e,this.p1.fx=this.p1.ax*this.p1._$p,this.p1.fy=this.p1.ay*this.p1._$p,this.p1._$xT();var r,o,n=-Math.atan2(this.p1.y-this.p2.y,this.p1.x-this.p2.x),s=Math.cos(n),_=Math.sin(n),a=9.8*this.p2._$p,h=this._$Db*Lt._$bS,l=a*Math.cos(n-h);r=l*_,o=l*s;var $=-this.p1.fx*_*_,u=-this.p1.fy*_*s,p=-this.p2.vx*this._$L2,f=-this.p2.vy*this._$L2;this.p2.fx=r+$+p,this.p2.fy=o+u+f,this.p2.ax=this.p2.fx/this.p2._$p,this.p2.ay=this.p2.fy/this.p2._$p,this.p2.vx+=this.p2.ax*i,this.p2.vy+=this.p2.ay*i,this.p2.x+=this.p2.vx*i,this.p2.y+=this.p2.vy*i;var c=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y));this.p2.x=this.p1.x+this._$Fo*(this.p2.x-this.p1.x)/c,this.p2.y=this.p1.y+this._$Fo*(this.p2.y-this.p1.y)/c,this.p2.vx=(this.p2.x-this.p2._$s0)*e,this.p2.vy=(this.p2.y-this.p2._$70)*e,this.p2._$xT()},c.prototype._$xT=function(){this._$s0=this.x,this._$70=this.y,this._$7L=this.vx,this._$HL=this.vy},d.prototype._$oP=function(t,i){},g.prototype=new d,g.prototype._$oP=function(t,i){var e=this.scale*t.getParamFloat(this._$wL),r=i.getPhysicsPoint1();switch(this._$tL){default:case f.Src.SRC_TO_X:r.x=r.x+(e-r.x)*this._$V0;break;case f.Src.SRC_TO_Y:r.y=r.y+(e-r.y)*this._$V0;break;case f.Src.SRC_TO_G_ANGLE:var o=i._$qr();o+=(e-o)*this._$V0,i._$pr(o)}},y.prototype._$YS=function(t,i){},T.prototype=new y,T.prototype._$YS=function(t,i){switch(this._$YP){default:case f.Target.TARGET_FROM_ANGLE:t.setParamFloat(this._$wL,this.scale*i._$5r(),this._$V0);break;case f.Target.TARGET_FROM_ANGLE_V:t.setParamFloat(this._$wL,this.scale*i._$Cs(),this._$V0)}},f.Src=function(){},f.Src.SRC_TO_X="SRC_TO_X",f.Src.SRC_TO_Y="SRC_TO_Y",f.Src.SRC_TO_G_ANGLE="SRC_TO_G_ANGLE",f.Target=function(){},f.Target.TARGET_FROM_ANGLE="TARGET_FROM_ANGLE",f.Target.TARGET_FROM_ANGLE_V="TARGET_FROM_ANGLE_V",P.prototype.init=function(t){this._$fL=t._$fL,this._$gL=t._$gL,this._$B0=t._$B0,this._$z0=t._$z0,this._$qT=t._$qT,this.reflectX=t.reflectX,this.reflectY=t.reflectY},P.prototype._$F0=function(t){this._$fL=t._$_T(),this._$gL=t._$_T(),this._$B0=t._$_T(),this._$z0=t._$_T(),this._$qT=t._$_T(),t.getFormatVersion()>=G.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this.reflectX=t._$po(),this.reflectY=t._$po())},P.prototype._$e=function(){};var It=function(){};It._$ni=function(t,i,e,r,o,n,s,_,a){var h=s*n-_*o;if(0==h)return null;var l,$=((t-e)*n-(i-r)*o)/h;return l=0!=o?(t-e-$*s)/o:(i-r-$*_)/n,isNaN(l)&&(l=(t-e-$*s)/o,isNaN(l)&&(l=(i-r-$*_)/n),isNaN(l)&&(console.log("a is NaN @UtVector#_$ni() "),console.log("v1x : "+o),console.log("v1x != 0 ? "+(0!=o)))),null==a?new Array(l,$):(a[0]=l,a[1]=$,a)},S.prototype._$8P=function(){return this.x+.5*this.width},S.prototype._$6P=function(){return this.y+.5*this.height},S.prototype._$EL=function(){return this.x+this.width},S.prototype._$5T=function(){return this.y+this.height},S.prototype._$jL=function(t,i,e,r){this.x=t,this.y=i,this.width=e,this.height=r},S.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},S.prototype.contains=function(t,i){return this.x<=this.x&&this.y<=this.y&&this.x<=this.x+this.width&&this.y<=this.y+this.height},S.prototype.expand=function(t,i){this.x-=t,this.y-=i,this.width+=2*t,this.height+=2*i},v._$Z2=function(t,i,e,r){var o=i._$Q2(t,e),n=t._$vs(),s=t._$Tr();if(i._$zr(n,s,o),o<=0)return r[n[0]];if(1==o){var _=r[n[0]],a=r[n[1]],h=s[0];return _+(a-_)*h|0}if(2==o){var _=r[n[0]],a=r[n[1]],l=r[n[2]],$=r[n[3]],h=s[0],u=s[1],p=_+(a-_)*h|0,f=l+($-l)*h|0;return p+(f-p)*u|0}if(3==o){var c=r[n[0]],d=r[n[1]],g=r[n[2]],y=r[n[3]],m=r[n[4]],T=r[n[5]],P=r[n[6]],S=r[n[7]],h=s[0],u=s[1],v=s[2],_=c+(d-c)*h|0,a=g+(y-g)*h|0,l=m+(T-m)*h|0,$=P+(S-P)*h|0,p=_+(a-_)*u|0,f=l+($-l)*u|0;return p+(f-p)*v|0}if(4==o){var L=r[n[0]],M=r[n[1]],E=r[n[2]],A=r[n[3]],I=r[n[4]],w=r[n[5]],x=r[n[6]],O=r[n[7]],D=r[n[8]],R=r[n[9]],b=r[n[10]],F=r[n[11]],C=r[n[12]],N=r[n[13]],B=r[n[14]],U=r[n[15]],h=s[0],u=s[1],v=s[2],G=s[3],c=L+(M-L)*h|0,d=E+(A-E)*h|0,g=I+(w-I)*h|0,y=x+(O-x)*h|0,m=D+(R-D)*h|0,T=b+(F-b)*h|0,P=C+(N-C)*h|0,S=B+(U-B)*h|0,_=c+(d-c)*u|0,a=g+(y-g)*u|0,l=m+(T-m)*u|0,$=P+(S-P)*u|0,p=_+(a-_)*v|0,f=l+($-l)*v|0;return p+(f-p)*G|0}for(var Y=1<<o,k=new Float32Array(Y),V=0;V<Y;V++){for(var X=V,z=1,H=0;H<o;H++)z*=X%2==0?1-s[H]:s[H],X/=2;k[V]=z}for(var W=new Float32Array(Y),j=0;j<Y;j++)W[j]=r[n[j]];for(var q=0,j=0;j<Y;j++)q+=k[j]*W[j];return q+.5|0},v._$br=function(t,i,e,r){var o=i._$Q2(t,e),n=t._$vs(),s=t._$Tr();if(i._$zr(n,s,o),o<=0)return r[n[0]];if(1==o){var _=r[n[0]],a=r[n[1]],h=s[0];return _+(a-_)*h}if(2==o){var _=r[n[0]],a=r[n[1]],l=r[n[2]],$=r[n[3]],h=s[0],u=s[1];return(1-u)*(_+(a-_)*h)+u*(l+($-l)*h)}if(3==o){var p=r[n[0]],f=r[n[1]],c=r[n[2]],d=r[n[3]],g=r[n[4]],y=r[n[5]],m=r[n[6]],T=r[n[7]],h=s[0],u=s[1],P=s[2];return(1-P)*((1-u)*(p+(f-p)*h)+u*(c+(d-c)*h))+P*((1-u)*(g+(y-g)*h)+u*(m+(T-m)*h))}if(4==o){var S=r[n[0]],v=r[n[1]],L=r[n[2]],M=r[n[3]],E=r[n[4]],A=r[n[5]],I=r[n[6]],w=r[n[7]],x=r[n[8]],O=r[n[9]],D=r[n[10]],R=r[n[11]],b=r[n[12]],F=r[n[13]],C=r[n[14]],N=r[n[15]],h=s[0],u=s[1],P=s[2],B=s[3];return(1-B)*((1-P)*((1-u)*(S+(v-S)*h)+u*(L+(M-L)*h))+P*((1-u)*(E+(A-E)*h)+u*(I+(w-I)*h)))+B*((1-P)*((1-u)*(x+(O-x)*h)+u*(D+(R-D)*h))+P*((1-u)*(b+(F-b)*h)+u*(C+(N-C)*h)))}for(var U=1<<o,G=new Float32Array(U),Y=0;Y<U;Y++){for(var k=Y,V=1,X=0;X<o;X++)V*=k%2==0?1-s[X]:s[X],k/=2;G[Y]=V}for(var z=new Float32Array(U),H=0;H<U;H++)z[H]=r[n[H]];for(var W=0,H=0;H<U;H++)W+=G[H]*z[H];return W},v._$Vr=function(t,i,e,r,o,n,s,_){var a=i._$Q2(t,e),h=t._$vs(),l=t._$Tr();i._$zr(h,l,a);var $=2*r,u=s;if(a<=0){var p=h[0],f=o[p];if(2==_&&0==s)w._$jT(f,0,n,0,$);else for(var c=0;c<$;)n[u]=f[c++],n[u+1]=f[c++],u+=_}else if(1==a)for(var f=o[h[0]],d=o[h[1]],g=l[0],y=1-g,c=0;c<$;)n[u]=f[c]*y+d[c]*g,++c,n[u+1]=f[c]*y+d[c]*g,++c,u+=_;else if(2==a)for(var f=o[h[0]],d=o[h[1]],m=o[h[2]],T=o[h[3]],g=l[0],P=l[1],y=1-g,S=1-P,v=S*y,L=S*g,M=P*y,E=P*g,c=0;c<$;)n[u]=v*f[c]+L*d[c]+M*m[c]+E*T[c],++c,n[u+1]=v*f[c]+L*d[c]+M*m[c]+E*T[c],++c,u+=_;else if(3==a)for(var A=o[h[0]],I=o[h[1]],x=o[h[2]],O=o[h[3]],D=o[h[4]],R=o[h[5]],b=o[h[6]],F=o[h[7]],g=l[0],P=l[1],C=l[2],y=1-g,S=1-P,N=1-C,B=N*S*y,U=N*S*g,G=N*P*y,Y=N*P*g,k=C*S*y,V=C*S*g,X=C*P*y,z=C*P*g,c=0;c<$;)n[u]=B*A[c]+U*I[c]+G*x[c]+Y*O[c]+k*D[c]+V*R[c]+X*b[c]+z*F[c],++c,n[u+1]=B*A[c]+U*I[c]+G*x[c]+Y*O[c]+k*D[c]+V*R[c]+X*b[c]+z*F[c],++c,u+=_;else if(4==a)for(var H=o[h[0]],W=o[h[1]],j=o[h[2]],q=o[h[3]],J=o[h[4]],Q=o[h[5]],Z=o[h[6]],K=o[h[7]],tt=o[h[8]],it=o[h[9]],et=o[h[10]],rt=o[h[11]],ot=o[h[12]],nt=o[h[13]],st=o[h[14]],_t=o[h[15]],g=l[0],P=l[1],C=l[2],at=l[3],y=1-g,S=1-P,N=1-C,ht=1-at,lt=ht*N*S*y,$t=ht*N*S*g,ut=ht*N*P*y,pt=ht*N*P*g,ft=ht*C*S*y,ct=ht*C*S*g,dt=ht*C*P*y,gt=ht*C*P*g,yt=at*N*S*y,mt=at*N*S*g,Tt=at*N*P*y,Pt=at*N*P*g,St=at*C*S*y,vt=at*C*S*g,Lt=at*C*P*y,Mt=at*C*P*g,c=0;c<$;)n[u]=lt*H[c]+$t*W[c]+ut*j[c]+pt*q[c]+ft*J[c]+ct*Q[c]+dt*Z[c]+gt*K[c]+yt*tt[c]+mt*it[c]+Tt*et[c]+Pt*rt[c]+St*ot[c]+vt*nt[c]+Lt*st[c]+Mt*_t[c],++c,n[u+1]=lt*H[c]+$t*W[c]+ut*j[c]+pt*q[c]+ft*J[c]+ct*Q[c]+dt*Z[c]+gt*K[c]+yt*tt[c]+mt*it[c]+Tt*et[c]+Pt*rt[c]+St*ot[c]+vt*nt[c]+Lt*st[c]+Mt*_t[c],++c,u+=_;else{for(var Et=1<<a,At=new Float32Array(Et),It=0;It<Et;It++){for(var wt=It,xt=1,Ot=0;Ot<a;Ot++)xt*=wt%2==0?1-l[Ot]:l[Ot],wt/=2;At[It]=xt}for(var Dt=new Float32Array(Et),Rt=0;Rt<Et;Rt++)Dt[Rt]=o[h[Rt]];for(var c=0;c<$;){for(var bt=0,Ft=0,Ct=c+1,Rt=0;Rt<Et;Rt++)bt+=At[Rt]*Dt[Rt][c],Ft+=At[Rt]*Dt[Rt][Ct];c+=2,n[u]=bt,n[u+1]=Ft,u+=_}}},L.prototype._$HT=function(t,i){this.x=t,this.y=i},L.prototype._$HT=function(t){this.x=t.x,this.y=t.y},M._$ur=-2,M._$ES=500,M._$wb=2,M._$8S=3,M._$52=M._$ES,M._$R2=M._$ES,M._$or=function(){return M._$52},M._$Pr=function(){return M._$R2},M.prototype.convertClipIDForV2_11=function(t){var i=[];return null==t?null:0==t.length?null:/,/.test(t)?i=t.id.split(","):(i.push(t.id),i)},M.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=G._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=[],this._$MS(this._$Lb)},M.prototype.getClipIDList=function(){return this.clipIDList},M.prototype.init=function(t){},M.prototype._$Nr=function(t,i){if(i._$IS[0]=!1,i._$Us=v._$Z2(t,this._$GS,i._$IS,this._$Lb),at._$Zs);else if(i._$IS[0])return;i._$7s=v._$br(t,this._$GS,i._$IS,this._$mS)},M.prototype._$2b=function(t,i){},M.prototype.getDrawDataID=function(){return this._$gP},M.prototype._$j2=function(t){this._$gP=t},M.prototype.getOpacity=function(t,i){return i._$7s},M.prototype._$zS=function(t,i){return i._$Us},M.prototype._$MS=function(t){for(var i=t.length-1;i>=0;--i){var e=t[i];e<M._$52?M._$52=e:e>M._$R2&&(M._$R2=e)}},M.prototype.getTargetBaseDataID=function(){return this._$dr},M.prototype._$gs=function(t){this._$dr=t},M.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},M.prototype.preDraw=function(t,i,e){},M.prototype.draw=function(t,i,e){},M.prototype.getType=function(){},M.prototype._$B2=function(t,i,e){},E._$ps=32,E.CLIPPING_PROCESS_NONE=0,E.CLIPPING_PROCESS_OVERWRITE_ALPHA=1,E.CLIPPING_PROCESS_MULTIPLY_ALPHA=2,E.CLIPPING_PROCESS_DRAW=3,E.CLIPPING_PROCESS_CLEAR_ALPHA=4,E.prototype.setChannelFlagAsColor=function(t,i){this.CHANNEL_COLORS[t]=i},E.prototype.getChannelFlagAsColor=function(t){return this.CHANNEL_COLORS[t]},E.prototype._$ZT=function(){},E.prototype._$Uo=function(t,i,e,r,o,n,s){},E.prototype._$Rs=function(){return-1},E.prototype._$Ds=function(t){},E.prototype.setBaseColor=function(t,i,e,r){t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),e<0?e=0:e>1&&(e=1),r<0?r=0:r>1&&(r=1),this._$lT=t,this._$C0=i,this._$tT=e,this._$WL=r},E.prototype._$WP=function(t){this.culling=t},E.prototype.setMatrix=function(t){for(var i=0;i<16;i++)this.matrix4x4[i]=t[i]},E.prototype._$IT=function(){return this.matrix4x4},E.prototype.setPremultipliedAlpha=function(t){this.premultipliedAlpha=t},E.prototype.isPremultipliedAlpha=function(){return this.premultipliedAlpha},E.prototype.setAnisotropy=function(t){this.anisotropy=t},E.prototype.getAnisotropy=function(){return this.anisotropy},E.prototype.getClippingProcess=function(){return this.clippingProcess},E.prototype.setClippingProcess=function(t){this.clippingProcess=t},E.prototype.setClipBufPre_clipContextForMask=function(t){this.clipBufPre_clipContextMask=t},E.prototype.getClipBufPre_clipContextMask=function(){return this.clipBufPre_clipContextMask},E.prototype.setClipBufPre_clipContextForDraw=function(t){this.clipBufPre_clipContextDraw=t},E.prototype.getClipBufPre_clipContextDraw=function(){return this.clipBufPre_clipContextDraw},I._$ur=-2,I._$c2=1,I._$_b=2,I.prototype._$F0=function(t){this._$kP=t._$nP(),this._$dr=t._$nP()},I.prototype.readV2_opacity=function(t){t.getFormatVersion()>=G.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this._$mS=t._$Tb())},I.prototype.init=function(t){},I.prototype._$Nr=function(t,i){},I.prototype.interpolateOpacity=function(t,i,e,r){null==this._$mS?e.setInterpolatedOpacity(1):e.setInterpolatedOpacity(v._$br(t,i,r,this._$mS))},I.prototype._$2b=function(t,i){},I.prototype._$nb=function(t,i,e,r,o,n,s){},I.prototype.getType=function(){},I.prototype._$gs=function(t){this._$dr=t},I.prototype._$a2=function(t){this._$kP=t},I.prototype.getTargetBaseDataID=function(){return this._$dr},I.prototype.getBaseDataID=function(){return this._$kP},I.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},w._$W2=0,w._$CS=w._$W2,w._$Mo=function(){return!0},w._$XP=function(t){try{for(var i=getTimeMSec();getTimeMSec()-i<t;);}catch(t){t._$Rb()}},w.getUserTimeMSec=function(){return w._$CS==w._$W2?w.getSystemTimeMSec():w._$CS},w.setUserTimeMSec=function(t){w._$CS=t},w.updateUserTimeMSec=function(){return w._$CS=w.getSystemTimeMSec()},w.getTimeMSec=function(){return(new Date).getTime()},w.getSystemTimeMSec=function(){return(new Date).getTime()},w._$Q=function(t){},w._$jT=function(t,i,e,r,o){for(var n=0;n<o;n++)e[r+n]=t[i+n]},x._$ds=-2,x.prototype._$F0=function(t){this._$wL=t._$nP(),this._$VP=t._$6L(),this._$GP=t._$nP()},x.prototype.getParamIndex=function(t){return this._$2r!=t&&(this._$8o=x._$ds),this._$8o},x.prototype._$Pb=function(t,i){this._$8o=t,this._$2r=i},x.prototype.getParamID=function(){return this._$wL},x.prototype._$yP=function(t){this._$wL=t},x.prototype._$N2=function(){return this._$VP},x.prototype._$d2=function(){return this._$GP},x.prototype._$t2=function(t,i){this._$VP=t,this._$GP=i},x.prototype._$Lr=function(){return this._$O2},x.prototype._$wr=function(t){this._$O2=t},x.prototype._$SL=function(){return this._$ri},x.prototype._$AL=function(t){this._$ri=t},O.startsWith=function(t,i,e){var r=i+e.length;if(r>=t.length)return!1;for(var o=i;o<r;o++)if(O.getChar(t,o)!=e.charAt(o-i))return!1;return!0},O.getChar=function(t,i){return String.fromCharCode(t.getUint8(i))},O.createString=function(t,i,e){for(var r=new ArrayBuffer(2*e),o=new Uint16Array(r),n=0;n<e;n++)o[n]=t.getUint8(i+n);return String.fromCharCode.apply(null,o)},O._$LS=function(t,i,e,r){t instanceof ArrayBuffer&&(t=new DataView(t));var o=e,n=!1,s=!1,_=0,a=O.getChar(t,o);"-"==a&&(n=!0,o++);for(var h=!1;o<i;o++){switch(a=O.getChar(t,o)){case"0":_*=10;break;case"1":_=10*_+1;break;case"2":_=10*_+2;break;case"3":_=10*_+3;break;case"4":_=10*_+4;break;case"5":_=10*_+5;break;case"6":_=10*_+6;break;case"7":_=10*_+7;break;case"8":_=10*_+8;break;case"9":_=10*_+9;break;case".":s=!0,o++,h=!0;break;default:h=!0}if(h)break}if(s)for(var l=.1,$=!1;o<i;o++){switch(a=O.getChar(t,o)){case"0":break;case"1":_+=1*l;break;case"2":_+=2*l;break;case"3":_+=3*l;break;case"4":_+=4*l;break;case"5":_+=5*l;break;case"6":_+=6*l;break;case"7":_+=7*l;break;case"8":_+=8*l;break;case"9":_+=9*l;break;default:$=!0}if(l*=.1,$)break}return n&&(_=-_),r[0]=o,_},D.prototype._$zP=function(){this._$Ob=new Array},D.prototype._$F0=function(t){this._$Ob=t._$nP()},D.prototype._$Ur=function(t){if(t._$WS())return!0;for(var i=t._$v2(),e=this._$Ob.length-1;e>=0;--e){var r=this._$Ob[e].getParamIndex(i);if(r==x._$ds&&(r=t.getParamIndex(this._$Ob[e].getParamID())),t._$Xb(r))return!0}return!1},D.prototype._$Q2=function(t,i){for(var e,r,o=this._$Ob.length,n=t._$v2(),s=0,_=0;_<o;_++){var a=this._$Ob[_];if(e=a.getParamIndex(n),e==x._$ds&&(e=t.getParamIndex(a.getParamID()),a._$Pb(e,n)),e<0)throw new Exception("err 23242 : "+a.getParamID());var h=e<0?0:t.getParamFloat(e);r=a._$N2();var l,$,u=a._$d2(),p=-1,f=0;if(r<1);else if(1==r)l=u[0],l-U._$J<h&&h<l+U._$J?(p=0,f=0):(p=0,i[0]=!0);else if(l=u[0],h<l-U._$J)p=0,i[0]=!0;else if(h<l+U._$J)p=0;else{for(var c=!1,d=1;d<r;++d){if($=u[d],h<$+U._$J){$-U._$J<h?p=d:(p=d-1,f=(h-l)/($-l),s++),c=!0;break}l=$}c||(p=r-1,f=0,i[0]=!0)}a._$wr(p),a._$AL(f)}return s},D.prototype._$zr=function(t,i,e){var r=1<<e;r+1>U._$Qb&&console.log("err 23245\\n");for(var o=this._$Ob.length,n=1,s=1,_=0,a=0;a<r;++a)t[a]=0;for(var h=0;h<o;++h){var l=this._$Ob[h];if(0==l._$SL()){var $=l._$Lr()*n;if($<0&&at._$3T)throw new Exception("err 23246");for(var a=0;a<r;++a)t[a]+=$}else{for(var $=n*l._$Lr(),u=n*(l._$Lr()+1),a=0;a<r;++a)t[a]+=(a/s|0)%2==0?$:u;i[_++]=l._$SL(),s*=2}n*=l._$N2()}t[r]=65535,i[_]=-1},D.prototype._$h2=function(t,i,e){for(var r=new Float32Array(i),o=0;o<i;++o)r[o]=e[o];var n=new x;n._$yP(t),n._$t2(i,r),this._$Ob.push(n)},D.prototype._$J2=function(t){for(var i=t,e=this._$Ob.length,r=0;r<e;++r){var o=this._$Ob[r],n=o._$N2(),s=i%o._$N2(),_=o._$d2()[s];console.log("%s[%d]=%7.2f / ",o.getParamID(),s,_),i/=n}console.log("\\n")},D.prototype.getParamCount=function(){return this._$Ob.length},D.prototype._$zs=function(){return this._$Ob},R.prototype.identity=function(){for(var t=0;t<16;t++)this.m[t]=t%5==0?1:0},R.prototype.getArray=function(){return this.m},R.prototype.getCopyMatrix=function(){return new Float32Array(this.m)},R.prototype.setMatrix=function(t){if(null!=t&&16==t.length)for(var i=0;i<16;i++)this.m[i]=t[i]},R.prototype.mult=function(t,i,e){return null==i?null:(this==i?this.mult_safe(this.m,t.m,i.m,e):this.mult_fast(this.m,t.m,i.m,e),i)},R.prototype.mult_safe=function(t,i,e,r){if(t==e){var o=new Array(16);this.mult_fast(t,i,o,r);for(var n=15;n>=0;--n)e[n]=o[n]}else this.mult_fast(t,i,e,r)},R.prototype.mult_fast=function(t,i,e,r){r?(e[0]=t[0]*i[0]+t[4]*i[1]+t[8]*i[2],e[4]=t[0]*i[4]+t[4]*i[5]+t[8]*i[6],e[8]=t[0]*i[8]+t[4]*i[9]+t[8]*i[10],e[12]=t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12],e[1]=t[1]*i[0]+t[5]*i[1]+t[9]*i[2],e[5]=t[1]*i[4]+t[5]*i[5]+t[9]*i[6],e[9]=t[1]*i[8]+t[5]*i[9]+t[9]*i[10],e[13]=t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13],e[2]=t[2]*i[0]+t[6]*i[1]+t[10]*i[2],e[6]=t[2]*i[4]+t[6]*i[5]+t[10]*i[6],e[10]=t[2]*i[8]+t[6]*i[9]+t[10]*i[10],e[14]=t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14],e[3]=e[7]=e[11]=0,e[15]=1):(e[0]=t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12]*i[3],e[4]=t[0]*i[4]+t[4]*i[5]+t[8]*i[6]+t[12]*i[7],e[8]=t[0]*i[8]+t[4]*i[9]+t[8]*i[10]+t[12]*i[11],e[12]=t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12]*i[15],e[1]=t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13]*i[3],e[5]=t[1]*i[4]+t[5]*i[5]+t[9]*i[6]+t[13]*i[7],e[9]=t[1]*i[8]+t[5]*i[9]+t[9]*i[10]+t[13]*i[11],e[13]=t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13]*i[15],e[2]=t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14]*i[3],e[6]=t[2]*i[4]+t[6]*i[5]+t[10]*i[6]+t[14]*i[7],e[10]=t[2]*i[8]+t[6]*i[9]+t[10]*i[10]+t[14]*i[11],e[14]=t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14]*i[15],e[3]=t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15]*i[3],e[7]=t[3]*i[4]+t[7]*i[5]+t[11]*i[6]+t[15]*i[7],e[11]=t[3]*i[8]+t[7]*i[9]+t[11]*i[10]+t[15]*i[11],e[15]=t[3]*i[12]+t[7]*i[13]+t[11]*i[14]+t[15]*i[15])},R.prototype.translate=function(t,i,e){this.m[12]=this.m[0]*t+this.m[4]*i+this.m[8]*e+this.m[12],this.m[13]=this.m[1]*t+this.m[5]*i+this.m[9]*e+this.m[13],this.m[14]=this.m[2]*t+this.m[6]*i+this.m[10]*e+this.m[14],this.m[15]=this.m[3]*t+this.m[7]*i+this.m[11]*e+this.m[15]},R.prototype.scale=function(t,i,e){this.m[0]*=t,this.m[4]*=i,this.m[8]*=e,this.m[1]*=t,this.m[5]*=i,this.m[9]*=e,this.m[2]*=t,this.m[6]*=i,this.m[10]*=e,this.m[3]*=t,this.m[7]*=i,this.m[11]*=e},R.prototype.rotateX=function(t){var i=Lt.fcos(t),e=Lt._$9(t),r=this.m[4];this.m[4]=r*i+this.m[8]*e,this.m[8]=r*-e+this.m[8]*i,r=this.m[5],this.m[5]=r*i+this.m[9]*e,this.m[9]=r*-e+this.m[9]*i,r=this.m[6],this.m[6]=r*i+this.m[10]*e,this.m[10]=r*-e+this.m[10]*i,r=this.m[7],this.m[7]=r*i+this.m[11]*e,this.m[11]=r*-e+this.m[11]*i},R.prototype.rotateY=function(t){var i=Lt.fcos(t),e=Lt._$9(t),r=this.m[0];this.m[0]=r*i+this.m[8]*-e,this.m[8]=r*e+this.m[8]*i,r=this.m[1],this.m[1]=r*i+this.m[9]*-e,this.m[9]=r*e+this.m[9]*i,r=m[2],this.m[2]=r*i+this.m[10]*-e,this.m[10]=r*e+this.m[10]*i,r=m[3],this.m[3]=r*i+this.m[11]*-e,this.m[11]=r*e+this.m[11]*i},R.prototype.rotateZ=function(t){var i=Lt.fcos(t),e=Lt._$9(t),r=this.m[0];this.m[0]=r*i+this.m[4]*e,this.m[4]=r*-e+this.m[4]*i,r=this.m[1],this.m[1]=r*i+this.m[5]*e,this.m[5]=r*-e+this.m[5]*i,r=this.m[2],this.m[2]=r*i+this.m[6]*e,this.m[6]=r*-e+this.m[6]*i,r=this.m[3],this.m[3]=r*i+this.m[7]*e,this.m[7]=r*-e+this.m[7]*i},b.prototype=new et,b._$tP=new Object,b._$27=function(){b._$tP.clear()},b.getID=function(t){var i=b._$tP[t];return null==i&&(i=new b(t),b._$tP[t]=i),i},b.prototype._$3s=function(){return new b},F._$kS=-1,F._$pS=0,F._$hb=1,F.STATE_IDENTITY=0,F._$gb=1,F._$fo=2,F._$go=4,F.prototype.transform=function(t,i,e){var r,o,n,s,_,a,h=0,l=0;switch(this._$hi){default:return;case F._$go|F._$fo|F._$gb:for(r=this._$7,o=this._$H,n=this._$k,s=this._$f,_=this._$g,a=this._$w;--e>=0;){var $=t[h++],u=t[h++];i[l++]=r*$+o*u+n,i[l++]=s*$+_*u+a}return;case F._$go|F._$fo:for(r=this._$7,o=this._$H,s=this._$f,_=this._$g;--e>=0;){var $=t[h++],u=t[h++];i[l++]=r*$+o*u,i[l++]=s*$+_*u}return;case F._$go|F._$gb:for(o=this._$H,n=this._$k,s=this._$f,a=this._$w;--e>=0;){var $=t[h++];i[l++]=o*t[h++]+n,i[l++]=s*$+a}return;case F._$go:for(o=this._$H,s=this._$f;--e>=0;){var $=t[h++];i[l++]=o*t[h++],i[l++]=s*$}return;case F._$fo|F._$gb:for(r=this._$7,n=this._$k,_=this._$g,a=this._$w;--e>=0;)i[l++]=r*t[h++]+n,i[l++]=_*t[h++]+a;return;case F._$fo:for(r=this._$7,_=this._$g;--e>=0;)i[l++]=r*t[h++],i[l++]=_*t[h++];return;case F._$gb:for(n=this._$k,a=this._$w;--e>=0;)i[l++]=t[h++]+n,i[l++]=t[h++]+a;return;case F.STATE_IDENTITY:return void(t==i&&h==l||w._$jT(t,h,i,l,2*e))}},F.prototype.update=function(){0==this._$H&&0==this._$f?1==this._$7&&1==this._$g?0==this._$k&&0==this._$w?(this._$hi=F.STATE_IDENTITY,this._$Z=F._$pS):(this._$hi=F._$gb,this._$Z=F._$hb):0==this._$k&&0==this._$w?(this._$hi=F._$fo,this._$Z=F._$kS):(this._$hi=F._$fo|F._$gb,this._$Z=F._$kS):0==this._$7&&0==this._$g?0==this._$k&&0==this._$w?(this._$hi=F._$go,this._$Z=F._$kS):(this._$hi=F._$go|F._$gb,this._$Z=F._$kS):0==this._$k&&0==this._$w?(this._$hi=F._$go|F._$fo,this._$Z=F._$kS):(this._$hi=F._$go|F._$fo|F._$gb,this._$Z=F._$kS)},F.prototype._$RT=function(t){this._$IT(t);var i=t[0],e=t[2],r=t[1],o=t[3],n=Math.sqrt(i*i+r*r),s=i*o-e*r;0==n?at._$so&&console.log("affine._$RT() / rt==0"):(t[0]=n,t[1]=s/n,t[2]=(r*o+i*e)/s,t[3]=Math.atan2(r,i))},F.prototype._$ho=function(t,i,e,r){var o=new Float32Array(6),n=new Float32Array(6);t._$RT(o),i._$RT(n);var s=new Float32Array(6);s[0]=o[0]+(n[0]-o[0])*e,s[1]=o[1]+(n[1]-o[1])*e,s[2]=o[2]+(n[2]-o[2])*e,s[3]=o[3]+(n[3]-o[3])*e,s[4]=o[4]+(n[4]-o[4])*e,s[5]=o[5]+(n[5]-o[5])*e,r._$CT(s)},F.prototype._$CT=function(t){var i=Math.cos(t[3]),e=Math.sin(t[3]);this._$7=t[0]*i,this._$f=t[0]*e,this._$H=t[1]*(t[2]*i-e),this._$g=t[1]*(t[2]*e+i),this._$k=t[4],this._$w=t[5],this.update()},F.prototype._$IT=function(t){t[0]=this._$7,t[1]=this._$f,t[2]=this._$H,t[3]=this._$g,t[4]=this._$k,t[5]=this._$w},C.prototype=new s,C._$cs="VISIBLE:",C._$ar="LAYOUT:",C._$Co=0,C._$D2=[],C._$1T=1,C.loadMotion=function(t){var i=new C,e=[0],r=t.length;i._$yT=0;for(var o=0;o<r;++o){var n=255&t[o];if("\\n"!=n&&"\\r"!=n)if("#"!=n)if("$"!=n){if("a"<=n&&n<="z"||"A"<=n&&n<="Z"||"_"==n){for(var s=o,_=-1;o<r&&("\\r"!=(n=255&t[o])&&"\\n"!=n);++o)if("="==n){_=o;break}if(_>=0){var a=new B;O.startsWith(t,s,C._$cs)?(a._$RP=B._$hs,a._$4P=new String(t,s,_-s)):O.startsWith(t,s,C._$ar)?(a._$4P=new String(t,s+7,_-s-7),O.startsWith(t,s+7,"ANCHOR_X")?a._$RP=B._$xs:O.startsWith(t,s+7,"ANCHOR_Y")?a._$RP=B._$us:O.startsWith(t,s+7,"SCALE_X")?a._$RP=B._$qs:O.startsWith(t,s+7,"SCALE_Y")?a._$RP=B._$Ys:O.startsWith(t,s+7,"X")?a._$RP=B._$ws:O.startsWith(t,s+7,"Y")&&(a._$RP=B._$Ns)):(a._$RP=B._$Fr,a._$4P=new String(t,s,_-s)),i.motions.push(a);var h=0;for(C._$D2.clear(),o=_+1;o<r&&("\\r"!=(n=255&t[o])&&"\\n"!=n);++o)if(","!=n&&" "!=n&&"\\t"!=n){var l=O._$LS(t,r,o,e);if(e[0]>0){C._$D2.push(l),h++;var $=e[0];if($<o){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\\n");break}o=$}}a._$I0=C._$D2._$BL(),h>i._$yT&&(i._$yT=h)}}}else{for(var s=o,_=-1;o<r&&("\\r"!=(n=255&t[o])&&"\\n"!=n);++o)if("="==n){_=o;break}var u=!1;if(_>=0)for(_==s+4&&"f"==t[s+1]&&"p"==t[s+2]&&"s"==t[s+3]&&(u=!0),o=_+1;o<r&&("\\r"!=(n=255&t[o])&&"\\n"!=n);++o)if(","!=n&&" "!=n&&"\\t"!=n){var l=O._$LS(t,r,o,e);e[0]>0&&u&&5<l&&l<121&&(i._$D0=l),o=e[0]}for(;o<r&&("\\n"!=t[o]&&"\\r"!=t[o]);++o);}else for(;o<r&&("\\n"!=t[o]&&"\\r"!=t[o]);++o);}return i._$AS=1e3*i._$yT/i._$D0|0,i},C.prototype.getDurationMSec=function(){return this._$AS},C.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var i=this.motions[t];console.log("_$wL[%s] [%d]. ",i._$4P,i._$I0.length);for(var e=0;e<i._$I0.length&&e<10;e++)console.log("%5.2f ,",i._$I0[e]);console.log("\\n")}},C.prototype.updateParamExe=function(t,i,e,r){for(var o=i-r._$z2,n=o*this._$D0/1e3,s=0|n,_=n-s,a=0;a<this.motions.length;a++){var h=this.motions[a],l=h._$I0.length,$=h._$4P;if(h._$RP==B._$hs){var u=h._$I0[s>=l?l-1:s];t.setParamFloat($,u)}else if(B._$ws<=h._$RP&&h._$RP<=B._$Ys);else{var p=t.getParamFloat($),f=h._$I0[s>=l?l-1:s],c=h._$I0[s+1>=l?l-1:s+1],d=f+(c-f)*_,g=p+(d-p)*e;t.setParamFloat($,g)}}s>=this._$yT&&(this._$E?(r._$z2=i,this.loopFadeIn&&(r._$bs=i)):r._$9L=!0)},C.prototype._$r0=function(){return this._$E},C.prototype._$aL=function(t){this._$E=t},C.prototype.isLoopFadeIn=function(){return this.loopFadeIn},C.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},N.prototype.clear=function(){this.size=0},N.prototype.add=function(t){if(this._$P.length<=this.size){var i=new Float32Array(2*this.size);w._$jT(this._$P,0,i,0,this.size),this._$P=i}this._$P[this.size++]=t},N.prototype._$BL=function(){var t=new Float32Array(this.size);return w._$jT(this._$P,0,t,0,this.size),t},B._$Fr=0,B._$hs=1,B._$ws=100,B._$Ns=101,B._$xs=102,B._$us=103,B._$qs=104,B._$Ys=105,U._$Ms=1,U._$Qs=2,U._$i2=0,U._$No=2,U._$do=U._$Ms,U._$Ls=!0,U._$1r=5,U._$Qb=65,U._$J=1e-4,U._$FT=.001,U._$Ss=3,G._$o7=6,G._$S7=7,G._$s7=8,G._$77=9,G.LIVE2D_FORMAT_VERSION_V2_10_SDK2=10,G.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1=11,G._$T7=G.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1,G._$Is=-2004318072,G._$h0=0,G._$4L=23,G._$7P=33,G._$uT=function(t){console.log("_$bo :: _$6 _$mo _$E0 : %d\\n",t)},G._$9o=function(t){if(t<40)return G._$uT(t),null;if(t<50)return G._$uT(t),null;if(t<60)return G._$uT(t),null;if(t<100)switch(t){case 65:return new Z;case 66:return new D;case 67:return new x;case 68:return new z;case 69:return new P;case 70:return new $t;default:return G._$uT(t),null}else if(t<150)switch(t){case 131:return new st;case 133:return new tt;case 136:return new p;case 137:return new ot;case 142:return new j}return G._$uT(t),null},Y._$HP=0,Y._$_0=!0;Y._$V2=-1,Y._$W0=-1,Y._$jr=!1,Y._$ZS=!0,Y._$tr=-1e6,Y._$lr=1e6,Y._$is=32,Y._$e=!1,Y.prototype.getDrawDataIndex=function(t){for(var i=this._$aS.length-1;i>=0;--i)if(null!=this._$aS[i]&&this._$aS[i].getDrawDataID()==t)return i;return-1},Y.prototype.getDrawData=function(t){if(t instanceof b){if(null==this._$Bo){this._$Bo=new Object;for(var i=this._$aS.length,e=0;e<i;e++){var r=this._$aS[e],o=r.getDrawDataID();null!=o&&(this._$Bo[o]=r)}}return this._$Bo[id]}return t<this._$aS.length?this._$aS[t]:null},Y.prototype.release=function(){this._$3S.clear(),this._$aS.clear(),this._$F2.clear(),null!=this._$Bo&&this._$Bo.clear(),this._$db.clear(),this._$8b.clear(),this._$Hr.clear()},Y.prototype.init=function(){this._$co++,this._$F2.length>0&&this.release();for(var t=this._$Ri.getModelImpl(),i=t._$Xr(),r=i.length,o=new Array,n=new Array,s=0;s<r;++s){var _=i[s];this._$F2.push(_),this._$Hr.push(_.init(this));for(var a=_.getBaseData(),h=a.length,l=0;l<h;++l)o.push(a[l]);for(var l=0;l<h;++l){var $=a[l].init(this);$._$l2(s),n.push($)}for(var u=_.getDrawData(),p=u.length,l=0;l<p;++l){var f=u[l],c=f.init(this);c._$IP=s,this._$aS.push(f),this._$8b.push(c)}}for(var d=o.length,g=yt._$2o();;){for(var y=!1,s=0;s<d;++s){var m=o[s];if(null!=m){var T=m.getTargetBaseDataID();(null==T||T==g||this.getBaseDataIndex(T)>=0)&&(this._$3S.push(m),this._$db.push(n[s]),o[s]=null,y=!0)}}if(!y)break}var P=t._$E2();if(null!=P){var S=P._$1s();if(null!=S)for(var v=S.length,s=0;s<v;++s){var L=S[s];null!=L&&this._$02(L.getParamID(),L.getDefaultValue(),L.getMinValue(),L.getMaxValue())}}this.clipManager=new e(this.dp_webgl),this.clipManager.init(this,this._$aS,this._$8b),this._$QT=!0},Y.prototype.update=function(){Y._$e&&_.start("_$zL");for(var t=this._$_2.length,i=0;i<t;i++)this._$_2[i]!=this._$vr[i]&&(this._$Js[i]=Y._$ZS,this._$vr[i]=this._$_2[i]);var e=this._$3S.length,r=this._$aS.length,o=W._$or(),n=W._$Pr(),s=n-o+1;(null==this._$Ws||this._$Ws.length<s)&&(this._$Ws=new Int16Array(s),this._$Vs=new Int16Array(s));for(var i=0;i<s;i++)this._$Ws[i]=Y._$V2,this._$Vs[i]=Y._$V2;(null==this._$Er||this._$Er.length<r)&&(this._$Er=new Int16Array(r));for(var i=0;i<r;i++)this._$Er[i]=Y._$W0;Y._$e&&_.dump("_$zL"),Y._$e&&_.start("_$UL");for(var a=null,h=0;h<e;++h){var l=this._$3S[h],$=this._$db[h];try{l._$Nr(this,$),l._$2b(this,$)}catch(t){null==a&&(a=t)}}null!=a&&Y._$_0&&_._$Rb(a),Y._$e&&_.dump("_$UL"),Y._$e&&_.start("_$DL");for(var u=null,p=0;p<r;++p){var f=this._$aS[p],c=this._$8b[p];try{if(f._$Nr(this,c),c._$u2())continue;f._$2b(this,c);var d,g=Math.floor(f._$zS(this,c)-o);try{d=this._$Vs[g]}catch(t){console.log("_$li :: %s / %s \\t\\t\\t\\t@@_$fS\\n",t.toString(),f.getDrawDataID().toString()),g=Math.floor(f._$zS(this,c)-o);continue}d==Y._$V2?this._$Ws[g]=p:this._$Er[d]=p,this._$Vs[g]=p}catch(t){null==u&&(u=t,at._$sT(at._$H7))}}null!=u&&Y._$_0&&_._$Rb(u),Y._$e&&_.dump("_$DL"),Y._$e&&_.start("_$eL");for(var i=this._$Js.length-1;i>=0;i--)this._$Js[i]=Y._$jr;return this._$QT=!1,Y._$e&&_.dump("_$eL"),!1},Y.prototype.preDraw=function(t){null!=this.clipManager&&(t._$ZT(),this.clipManager.setupClip(this,t))},Y.prototype.draw=function(t){if(null==this._$Ws)return void _._$li("call _$Ri.update() before _$Ri.draw() ");var i=this._$Ws.length;t._$ZT();for(var e=0;e<i;++e){var r=this._$Ws[e];if(r!=Y._$V2)for(;;){var o=this._$aS[r],n=this._$8b[r];if(n._$yo()){var s=n._$IP,a=this._$Hr[s];n._$VS=a.getPartsOpacity(),o.draw(t,this,n)}var h=this._$Er[r];if(h<=r||h==Y._$W0)break;r=h}}},Y.prototype.getParamIndex=function(t){for(var i=this._$pb.length-1;i>=0;--i)if(this._$pb[i]==t)return i;return this._$02(t,0,Y._$tr,Y._$lr)},Y.prototype._$BS=function(t){return this.getBaseDataIndex(t)},Y.prototype.getBaseDataIndex=function(t){for(var i=this._$3S.length-1;i>=0;--i)if(null!=this._$3S[i]&&this._$3S[i].getBaseDataID()==t)return i;return-1},Y.prototype._$UT=function(t,i){var e=new Float32Array(i);return w._$jT(t,0,e,0,t.length),e},Y.prototype._$02=function(t,i,e,r){if(this._$qo>=this._$pb.length){var o=this._$pb.length,n=new Array(2*o);w._$jT(this._$pb,0,n,0,o),this._$pb=n,this._$_2=this._$UT(this._$_2,2*o),this._$vr=this._$UT(this._$vr,2*o),this._$Rr=this._$UT(this._$Rr,2*o),this._$Or=this._$UT(this._$Or,2*o);var s=new Array;w._$jT(this._$Js,0,s,0,o),this._$Js=s}return this._$pb[this._$qo]=t,this._$_2[this._$qo]=i,this._$vr[this._$qo]=i,this._$Rr[this._$qo]=e,this._$Or[this._$qo]=r,this._$Js[this._$qo]=Y._$ZS,this._$qo++},Y.prototype._$Zo=function(t,i){this._$3S[t]=i},Y.prototype.setParamFloat=function(t,i){i<this._$Rr[t]&&(i=this._$Rr[t]),i>this._$Or[t]&&(i=this._$Or[t]),this._$_2[t]=i},Y.prototype.loadParam=function(){var t=this._$_2.length;t>this._$fs.length&&(t=this._$fs.length),w._$jT(this._$fs,0,this._$_2,0,t)},Y.prototype.saveParam=function(){var t=this._$_2.length;t>this._$fs.length&&(this._$fs=new Float32Array(t)),w._$jT(this._$_2,0,this._$fs,0,t)},Y.prototype._$v2=function(){return this._$co},Y.prototype._$WS=function(){return this._$QT},Y.prototype._$Xb=function(t){return this._$Js[t]==Y._$ZS},Y.prototype._$vs=function(){return this._$Es},Y.prototype._$Tr=function(){return this._$ZP},Y.prototype.getBaseData=function(t){return this._$3S[t]},Y.prototype.getParamFloat=function(t){return this._$_2[t]},Y.prototype.getParamMax=function(t){return this._$Or[t]},Y.prototype.getParamMin=function(t){return this._$Rr[t]},Y.prototype.setPartsOpacity=function(t,i){this._$Hr[t].setPartsOpacity(i)},Y.prototype.getPartsOpacity=function(t){return this._$Hr[t].getPartsOpacity()},Y.prototype.getPartsDataIndex=function(t){for(var i=this._$F2.length-1;i>=0;--i)if(null!=this._$F2[i]&&this._$F2[i]._$p2()==t)return i;return-1},Y.prototype._$q2=function(t){return this._$db[t]},Y.prototype._$C2=function(t){return this._$8b[t]},Y.prototype._$Bb=function(t){return this._$Hr[t]},Y.prototype._$5s=function(t,i){for(var e=this._$Ws.length,r=t,o=0;o<e;++o){var n=this._$Ws[o];if(n!=Y._$V2)for(;;){var s=this._$8b[n];s._$yo()&&(s._$GT()._$B2(this,s,r),r+=i);var _=this._$Er[n];if(_<=n||_==Y._$W0)break;n=_}}},Y.prototype.setDrawParam=function(t){this.dp_webgl=t},Y.prototype.getDrawParam=function(){return this.dp_webgl},k._$0T=function(t){return k._$0T(new _$5(t))},k._$0T=function(t){if(!t.exists())throw new _$ls(t._$3b());for(var i,e=t.length(),r=new Int8Array(e),o=new _$Xs(new _$kb(t),8192),n=0;(i=o.read(r,n,e-n))>0;)n+=i;return r},k._$C=function(t){var i=null,e=null;try{i=t instanceof Array?t:new _$Xs(t,8192),e=new _$js;for(var r,o=new Int8Array(1e3);(r=i.read(o))>0;)e.write(o,0,r);return e._$TS()}finally{null!=t&&t.close(),null!=e&&(e.flush(),e.close())}},V.prototype._$T2=function(){return w.getUserTimeMSec()+Math._$10()*(2*this._$Br-1)},V.prototype._$uo=function(t){this._$Br=t},V.prototype._$QS=function(t,i,e){this._$Dr=t,this._$Cb=i,this._$mr=e},V.prototype._$7T=function(t){var i,e=w.getUserTimeMSec(),r=0;switch(this._$_L){case STATE_CLOSING:r=(e-this._$bb)/this._$Dr,r>=1&&(r=1,this._$_L=wt.STATE_CLOSED,this._$bb=e),i=1-r;break;case STATE_CLOSED:r=(e-this._$bb)/this._$Cb,r>=1&&(this._$_L=wt.STATE_OPENING,this._$bb=e),i=0;break;case STATE_OPENING:r=(e-this._$bb)/this._$mr,r>=1&&(r=1,this._$_L=wt.STATE_INTERVAL,this._$12=this._$T2()),i=r;break;case STATE_INTERVAL:this._$12<e&&(this._$_L=wt.STATE_CLOSING,this._$bb=e),i=1;break;case STATE_FIRST:default:this._$_L=wt.STATE_INTERVAL,this._$12=this._$T2(),i=1}this._$jo||(i=-i),t.setParamFloat(this._$iL,i),t.setParamFloat(this._$0L,i)};var wt=function(){};wt.STATE_FIRST="STATE_FIRST",wt.STATE_INTERVAL="STATE_INTERVAL",wt.STATE_CLOSING="STATE_CLOSING",wt.STATE_CLOSED="STATE_CLOSED",wt.STATE_OPENING="STATE_OPENING",X.prototype=new E,X._$As=32,X._$Gr=!1,X._$NT=null,X._$vS=null,X._$no=null,X._$9r=function(t){return new Float32Array(t)},X._$vb=function(t){return new Int16Array(t)},X._$cr=function(t,i){return null==t||t._$yL()<i.length?(t=X._$9r(2*i.length),t.put(i),t._$oT(0)):(t.clear(),t.put(i),t._$oT(0)),t},X._$mb=function(t,i){return null==t||t._$yL()<i.length?(t=X._$vb(2*i.length),t.put(i),t._$oT(0)):(t.clear(),t.put(i),t._$oT(0)),t},X._$Hs=function(){return X._$Gr},X._$as=function(t){X._$Gr=t},X.prototype.setGL=function(t){this.gl=t},X.prototype.setTransform=function(t){this.transform=t},X.prototype._$ZT=function(){},X.prototype._$Uo=function(t,i,e,r,o,n,s,_){if(!(n<.01)){var a=this._$U2[t],h=n>.9?at.EXPAND_W:0;this.gl.drawElements(a,e,r,o,n,h,this.transform,_)}},X.prototype._$Rs=function(){throw new Error("_$Rs")},X.prototype._$Ds=function(t){throw new Error("_$Ds")},X.prototype._$K2=function(){for(var t=0;t<this._$sb.length;t++){0!=this._$sb[t]&&(this.gl._$Sr(1,this._$sb,t),this._$sb[t]=0)}},X.prototype.setTexture=function(t,i){this._$sb.length<t+1&&this._$nS(t),this._$sb[t]=i},X.prototype.setTexture=function(t,i){this._$sb.length<t+1&&this._$nS(t),this._$U2[t]=i},X.prototype._$nS=function(t){var i=Math.max(2*this._$sb.length,t+1+10),e=new Int32Array(i);w._$jT(this._$sb,0,e,0,this._$sb.length),this._$sb=e;var r=new Array;w._$jT(this._$U2,0,r,0,this._$U2.length),this._$U2=r},z.prototype=new I,z._$Xo=new Float32Array(2),z._$io=new Float32Array(2),z._$0o=new Float32Array(2),z._$Lo=new Float32Array(2),z._$To=new Float32Array(2),z._$Po=new Float32Array(2),z._$gT=new Array,z.prototype._$zP=function(){this._$GS=new D,this._$GS._$zP(),this._$Y0=new Array},z.prototype.getType=function(){return I._$c2},z.prototype._$F0=function(t){I.prototype._$F0.call(this,t),this._$GS=t._$nP(),this._$Y0=t._$nP(),I.prototype.readV2_opacity.call(this,t)},z.prototype.init=function(t){var i=new H(this);return i._$Yr=new P,this._$32()&&(i._$Wr=new P),i},z.prototype._$Nr=function(t,i){this!=i._$GT()&&console.log("### assert!! ### ");var e=i;if(this._$GS._$Ur(t)){var r=z._$gT;r[0]=!1;var o=this._$GS._$Q2(t,r);i._$Ib(r[0]),this.interpolateOpacity(t,this._$GS,i,r);var n=t._$vs(),s=t._$Tr();if(this._$GS._$zr(n,s,o),o<=0){var _=this._$Y0[n[0]];e._$Yr.init(_)}else if(1==o){var _=this._$Y0[n[0]],a=this._$Y0[n[1]],h=s[0];e._$Yr._$fL=_._$fL+(a._$fL-_._$fL)*h,e._$Yr._$gL=_._$gL+(a._$gL-_._$gL)*h,e._$Yr._$B0=_._$B0+(a._$B0-_._$B0)*h,e._$Yr._$z0=_._$z0+(a._$z0-_._$z0)*h,e._$Yr._$qT=_._$qT+(a._$qT-_._$qT)*h}else if(2==o){var _=this._$Y0[n[0]],a=this._$Y0[n[1]],l=this._$Y0[n[2]],$=this._$Y0[n[3]],h=s[0],u=s[1],p=_._$fL+(a._$fL-_._$fL)*h,f=l._$fL+($._$fL-l._$fL)*h;e._$Yr._$fL=p+(f-p)*u,p=_._$gL+(a._$gL-_._$gL)*h,f=l._$gL+($._$gL-l._$gL)*h,e._$Yr._$gL=p+(f-p)*u,p=_._$B0+(a._$B0-_._$B0)*h,f=l._$B0+($._$B0-l._$B0)*h,e._$Yr._$B0=p+(f-p)*u,p=_._$z0+(a._$z0-_._$z0)*h,f=l._$z0+($._$z0-l._$z0)*h,e._$Yr._$z0=p+(f-p)*u,p=_._$qT+(a._$qT-_._$qT)*h,f=l._$qT+($._$qT-l._$qT)*h,e._$Yr._$qT=p+(f-p)*u}else if(3==o){var c=this._$Y0[n[0]],d=this._$Y0[n[1]],g=this._$Y0[n[2]],y=this._$Y0[n[3]],m=this._$Y0[n[4]],T=this._$Y0[n[5]],P=this._$Y0[n[6]],S=this._$Y0[n[7]],h=s[0],u=s[1],v=s[2],p=c._$fL+(d._$fL-c._$fL)*h,f=g._$fL+(y._$fL-g._$fL)*h,L=m._$fL+(T._$fL-m._$fL)*h,M=P._$fL+(S._$fL-P._$fL)*h;e._$Yr._$fL=(1-v)*(p+(f-p)*u)+v*(L+(M-L)*u),p=c._$gL+(d._$gL-c._$gL)*h,f=g._$gL+(y._$gL-g._$gL)*h,L=m._$gL+(T._$gL-m._$gL)*h,M=P._$gL+(S._$gL-P._$gL)*h,e._$Yr._$gL=(1-v)*(p+(f-p)*u)+v*(L+(M-L)*u),p=c._$B0+(d._$B0-c._$B0)*h,f=g._$B0+(y._$B0-g._$B0)*h,L=m._$B0+(T._$B0-m._$B0)*h,M=P._$B0+(S._$B0-P._$B0)*h,e._$Yr._$B0=(1-v)*(p+(f-p)*u)+v*(L+(M-L)*u),p=c._$z0+(d._$z0-c._$z0)*h,f=g._$z0+(y._$z0-g._$z0)*h,L=m._$z0+(T._$z0-m._$z0)*h,M=P._$z0+(S._$z0-P._$z0)*h,e._$Yr._$z0=(1-v)*(p+(f-p)*u)+v*(L+(M-L)*u),p=c._$qT+(d._$qT-c._$qT)*h,f=g._$qT+(y._$qT-g._$qT)*h,L=m._$qT+(T._$qT-m._$qT)*h,M=P._$qT+(S._$qT-P._$qT)*h,e._$Yr._$qT=(1-v)*(p+(f-p)*u)+v*(L+(M-L)*u)}else if(4==o){var E=this._$Y0[n[0]],A=this._$Y0[n[1]],I=this._$Y0[n[2]],w=this._$Y0[n[3]],x=this._$Y0[n[4]],O=this._$Y0[n[5]],D=this._$Y0[n[6]],R=this._$Y0[n[7]],b=this._$Y0[n[8]],F=this._$Y0[n[9]],C=this._$Y0[n[10]],N=this._$Y0[n[11]],B=this._$Y0[n[12]],U=this._$Y0[n[13]],G=this._$Y0[n[14]],Y=this._$Y0[n[15]],h=s[0],u=s[1],v=s[2],k=s[3],p=E._$fL+(A._$fL-E._$fL)*h,f=I._$fL+(w._$fL-I._$fL)*h,L=x._$fL+(O._$fL-x._$fL)*h,M=D._$fL+(R._$fL-D._$fL)*h,V=b._$fL+(F._$fL-b._$fL)*h,X=C._$fL+(N._$fL-C._$fL)*h,H=B._$fL+(U._$fL-B._$fL)*h,W=G._$fL+(Y._$fL-G._$fL)*h;e._$Yr._$fL=(1-k)*((1-v)*(p+(f-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$gL+(A._$gL-E._$gL)*h,f=I._$gL+(w._$gL-I._$gL)*h,L=x._$gL+(O._$gL-x._$gL)*h,M=D._$gL+(R._$gL-D._$gL)*h,V=b._$gL+(F._$gL-b._$gL)*h,X=C._$gL+(N._$gL-C._$gL)*h,H=B._$gL+(U._$gL-B._$gL)*h,W=G._$gL+(Y._$gL-G._$gL)*h,e._$Yr._$gL=(1-k)*((1-v)*(p+(f-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$B0+(A._$B0-E._$B0)*h,f=I._$B0+(w._$B0-I._$B0)*h,L=x._$B0+(O._$B0-x._$B0)*h,M=D._$B0+(R._$B0-D._$B0)*h,V=b._$B0+(F._$B0-b._$B0)*h,X=C._$B0+(N._$B0-C._$B0)*h,H=B._$B0+(U._$B0-B._$B0)*h,W=G._$B0+(Y._$B0-G._$B0)*h,e._$Yr._$B0=(1-k)*((1-v)*(p+(f-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$z0+(A._$z0-E._$z0)*h,f=I._$z0+(w._$z0-I._$z0)*h,L=x._$z0+(O._$z0-x._$z0)*h,M=D._$z0+(R._$z0-D._$z0)*h,V=b._$z0+(F._$z0-b._$z0)*h,X=C._$z0+(N._$z0-C._$z0)*h,H=B._$z0+(U._$z0-B._$z0)*h,W=G._$z0+(Y._$z0-G._$z0)*h,e._$Yr._$z0=(1-k)*((1-v)*(p+(f-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$qT+(A._$qT-E._$qT)*h,f=I._$qT+(w._$qT-I._$qT)*h,L=x._$qT+(O._$qT-x._$qT)*h,M=D._$qT+(R._$qT-D._$qT)*h,V=b._$qT+(F._$qT-b._$qT)*h,X=C._$qT+(N._$qT-C._$qT)*h,H=B._$qT+(U._$qT-B._$qT)*h,W=G._$qT+(Y._$qT-G._$qT)*h,e._$Yr._$qT=(1-k)*((1-v)*(p+(f-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u))}else{for(var j=0|Math.pow(2,o),q=new Float32Array(j),J=0;J<j;J++){for(var Q=J,Z=1,K=0;K<o;K++)Z*=Q%2==0?1-s[K]:s[K],Q/=2;q[J]=Z}for(var tt=new Array,it=0;it<j;it++)tt[it]=this._$Y0[n[it]];for(var et=0,rt=0,ot=0,nt=0,st=0,it=0;it<j;it++)et+=q[it]*tt[it]._$fL,rt+=q[it]*tt[it]._$gL,ot+=q[it]*tt[it]._$B0,nt+=q[it]*tt[it]._$z0,st+=q[it]*tt[it]._$qT;e._$Yr._$fL=et,e._$Yr._$gL=rt,e._$Yr._$B0=ot,e._$Yr._$z0=nt,e._$Yr._$qT=st}var _=this._$Y0[n[0]];e._$Yr.reflectX=_.reflectX,e._$Yr.reflectY=_.reflectY}},z.prototype._$2b=function(t,i){this!=i._$GT()&&console.log("### assert!! ### ");var e=i;if(e._$hS(!0),this._$32()){var r=this.getTargetBaseDataID();if(e._$8r==I._$ur&&(e._$8r=t.getBaseDataIndex(r)),e._$8r<0)at._$so&&_._$li("_$L _$0P _$G :: %s",r),e._$hS(!1);else{var o=t.getBaseData(e._$8r);if(null!=o){var n=t._$q2(e._$8r),s=z._$Xo;s[0]=e._$Yr._$fL,s[1]=e._$Yr._$gL;var a=z._$io;a[0]=0,a[1]=-.1;n._$GT().getType()==I._$c2?a[1]=-10:a[1]=-.1;var h=z._$0o;this._$Jr(t,o,n,s,a,h);var l=Lt._$92(a,h);o._$nb(t,n,s,s,1,0,2),e._$Wr._$fL=s[0],e._$Wr._$gL=s[1],e._$Wr._$B0=e._$Yr._$B0,e._$Wr._$z0=e._$Yr._$z0,e._$Wr._$qT=e._$Yr._$qT-l*Lt._$NS;var $=n.getTotalScale();e.setTotalScale_notForClient($*e._$Wr._$B0);var u=n.getTotalOpacity();e.setTotalOpacity(u*e.getInterpolatedOpacity()),e._$Wr.reflectX=e._$Yr.reflectX,e._$Wr.reflectY=e._$Yr.reflectY,e._$hS(n._$yo())}else e._$hS(!1)}}else e.setTotalScale_notForClient(e._$Yr._$B0),e.setTotalOpacity(e.getInterpolatedOpacity())},z.prototype._$nb=function(t,i,e,r,o,n,s){this!=i._$GT()&&console.log("### assert!! ### ");for(var _,a,h=i,l=null!=h._$Wr?h._$Wr:h._$Yr,$=Math.sin(Lt._$bS*l._$qT),u=Math.cos(Lt._$bS*l._$qT),p=h.getTotalScale(),f=l.reflectX?-1:1,c=l.reflectY?-1:1,d=u*p*f,g=-$*p*c,y=$*p*f,m=u*p*c,T=l._$fL,P=l._$gL,S=o*s,v=n;v<S;v+=s)_=e[v],a=e[v+1],r[v]=d*_+g*a+T,r[v+1]=y*_+m*a+P},z.prototype._$Jr=function(t,i,e,r,o,n){i!=e._$GT()&&console.log("### assert!! ### ");var s=z._$Lo;z._$Lo[0]=r[0],z._$Lo[1]=r[1],i._$nb(t,e,s,s,1,0,2);for(var _=z._$To,a=z._$Po,h=1,l=0;l<10;l++){if(a[0]=r[0]+h*o[0],a[1]=r[1]+h*o[1],i._$nb(t,e,a,_,1,0,2),_[0]-=s[0],_[1]-=s[1],0!=_[0]||0!=_[1])return n[0]=_[0],void(n[1]=_[1]);if(a[0]=r[0]-h*o[0],a[1]=r[1]-h*o[1],i._$nb(t,e,a,_,1,0,2),_[0]-=s[0],_[1]-=s[1],0!=_[0]||0!=_[1])return _[0]=-_[0],_[0]=-_[0],n[0]=_[0],void(n[1]=_[1]);h*=.1}at._$so&&console.log("_$L0 to transform _$SP\\n")},H.prototype=new _t,W.prototype=new M,W._$ur=-2,W._$ES=500,W._$wb=2,W._$8S=3,W._$os=4,W._$52=W._$ES,W._$R2=W._$ES,W._$Sb=function(t){for(var i=t.length-1;i>=0;--i){var e=t[i];e<W._$52?W._$52=e:e>W._$R2&&(W._$R2=e)}},W._$or=function(){return W._$52},W._$Pr=function(){return W._$R2},W.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=G._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=null,W._$Sb(this._$Lb)},W.prototype.getClipIDList=function(){return this.clipIDList},W.prototype._$Nr=function(t,i){if(i._$IS[0]=!1,i._$Us=v._$Z2(t,this._$GS,i._$IS,this._$Lb),at._$Zs);else if(i._$IS[0])return;i._$7s=v._$br(t,this._$GS,i._$IS,this._$mS)},W.prototype._$2b=function(t){},W.prototype.getDrawDataID=function(){return this._$gP},W.prototype._$j2=function(t){this._$gP=t},W.prototype.getOpacity=function(t,i){return i._$7s},W.prototype._$zS=function(t,i){return i._$Us},W.prototype.getTargetBaseDataID=function(){return this._$dr},W.prototype._$gs=function(t){this._$dr=t},W.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},W.prototype.getType=function(){},j._$42=0,j.prototype._$1b=function(){return this._$3S},j.prototype.getDrawDataList=function(){return this._$aS},j.prototype._$F0=function(t){this._$NL=t._$nP(),this._$aS=t._$nP(),this._$3S=t._$nP()},j.prototype._$kr=function(t){t._$Zo(this._$3S),t._$xo(this._$aS),this._$3S=null,this._$aS=null},q.prototype=new i,q.loadModel=function(t){var e=new q;return i._$62(e,t),e},q.loadModel=function(t){var e=new q;return i._$62(e,t),e},q._$to=function(){return new q},q._$er=function(t){var i=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==i.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+i._$PL());for(var e=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],r=q.loadModel(i._$3b()),o=0;o<e.length;o++){var n=new _$5(e[o]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());r.setTexture(o,_$nL._$_o(t,n._$3b()))}return r},q.prototype.setGL=function(t){this._$zo.setGL(t)},q.prototype.setTransform=function(t){this._$zo.setTransform(t)},q.prototype.draw=function(){this._$5S.draw(this._$zo)},q.prototype._$K2=function(){this._$zo._$K2()},q.prototype.setTexture=function(t,i){null==this._$zo&&_._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,i)},q.prototype.setTexture=function(t,i){null==this._$zo&&_._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,i)},q.prototype._$Rs=function(){return this._$zo._$Rs()},q.prototype._$Ds=function(t){this._$zo._$Ds(t)},q.prototype.getDrawParam=function(){return this._$zo},J.prototype=new s,J._$cs="VISIBLE:",J._$ar="LAYOUT:",J.MTN_PREFIX_FADEIN="FADEIN:",J.MTN_PREFIX_FADEOUT="FADEOUT:",J._$Co=0,J._$1T=1,J.loadMotion=function(t){var i=k._$C(t);return J.loadMotion(i)},J.loadMotion=function(t){t instanceof ArrayBuffer&&(t=new DataView(t));var i=new J,e=[0],r=t.byteLength;i._$yT=0;for(var o=0;o<r;++o){var n=Q(t,o),s=n.charCodeAt(0);if("\\n"!=n&&"\\r"!=n)if("#"!=n)if("$"!=n){if(97<=s&&s<=122||65<=s&&s<=90||"_"==n){for(var _=o,a=-1;o<r&&("\\r"!=(n=Q(t,o))&&"\\n"!=n);++o)if("="==n){a=o;break}if(a>=0){var h=new B;O.startsWith(t,_,J._$cs)?(h._$RP=B._$hs,h._$4P=O.createString(t,_,a-_)):O.startsWith(t,_,J._$ar)?(h._$4P=O.createString(t,_+7,a-_-7),O.startsWith(t,_+7,"ANCHOR_X")?h._$RP=B._$xs:O.startsWith(t,_+7,"ANCHOR_Y")?h._$RP=B._$us:O.startsWith(t,_+7,"SCALE_X")?h._$RP=B._$qs:O.startsWith(t,_+7,"SCALE_Y")?h._$RP=B._$Ys:O.startsWith(t,_+7,"X")?h._$RP=B._$ws:O.startsWith(t,_+7,"Y")&&(h._$RP=B._$Ns)):(h._$RP=B._$Fr,h._$4P=O.createString(t,_,a-_)),i.motions.push(h);var l=0,$=[];for(o=a+1;o<r&&("\\r"!=(n=Q(t,o))&&"\\n"!=n);++o)if(","!=n&&" "!=n&&"\\t"!=n){var u=O._$LS(t,r,o,e);if(e[0]>0){$.push(u),l++;var p=e[0];if(p<o){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\\n");break}o=p-1}}h._$I0=new Float32Array($),l>i._$yT&&(i._$yT=l)}}}else{for(var _=o,a=-1;o<r&&("\\r"!=(n=Q(t,o))&&"\\n"!=n);++o)if("="==n){a=o;break}var f=!1;if(a>=0)for(a==_+4&&"f"==Q(t,_+1)&&"p"==Q(t,_+2)&&"s"==Q(t,_+3)&&(f=!0),o=a+1;o<r&&("\\r"!=(n=Q(t,o))&&"\\n"!=n);++o)if(","!=n&&" "!=n&&"\\t"!=n){var u=O._$LS(t,r,o,e);e[0]>0&&f&&5<u&&u<121&&(i._$D0=u),o=e[0]}for(;o<r&&("\\n"!=Q(t,o)&&"\\r"!=Q(t,o));++o);}else for(;o<r&&("\\n"!=Q(t,o)&&"\\r"!=Q(t,o));++o);}return i._$rr=1e3*i._$yT/i._$D0|0,i},J.prototype.getDurationMSec=function(){return this._$E?-1:this._$rr},J.prototype.getLoopDurationMSec=function(){return this._$rr},J.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var i=this.motions[t];console.log("_$wL[%s] [%d]. ",i._$4P,i._$I0.length);for(var e=0;e<i._$I0.length&&e<10;e++)console.log("%5.2f ,",i._$I0[e]);console.log("\\n")}},J.prototype.updateParamExe=function(t,i,e,r){for(var o=i-r._$z2,n=o*this._$D0/1e3,s=0|n,_=n-s,a=0;a<this.motions.length;a++){var h=this.motions[a],l=h._$I0.length,$=h._$4P;if(h._$RP==B._$hs){var u=h._$I0[s>=l?l-1:s];t.setParamFloat($,u)}else if(B._$ws<=h._$RP&&h._$RP<=B._$Ys);else{var p,f=t.getParamIndex($),c=t.getModelContext(),d=c.getParamMax(f),g=c.getParamMin(f),y=.4*(d-g),m=c.getParamFloat(f),T=h._$I0[s>=l?l-1:s],P=h._$I0[s+1>=l?l-1:s+1];p=T<P&&P-T>y||T>P&&T-P>y?T:T+(P-T)*_;var S=m+(p-m)*e;t.setParamFloat($,S)}}s>=this._$yT&&(this._$E?(r._$z2=i,this.loopFadeIn&&(r._$bs=i)):r._$9L=!0),this._$eP=e},J.prototype._$r0=function(){return this._$E},J.prototype._$aL=function(t){this._$E=t},J.prototype._$S0=function(){return this._$D0},J.prototype._$U0=function(t){this._$D0=t},J.prototype.isLoopFadeIn=function(){return this.loopFadeIn},J.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},N.prototype.clear=function(){this.size=0},N.prototype.add=function(t){if(this._$P.length<=this.size){var i=new Float32Array(2*this.size);w._$jT(this._$P,0,i,0,this.size),this._$P=i}this._$P[this.size++]=t},N.prototype._$BL=function(){var t=new Float32Array(this.size);return w._$jT(this._$P,0,t,0,this.size),t},B._$Fr=0,B._$hs=1,B._$ws=100,B._$Ns=101,B._$xs=102,B._$us=103,B._$qs=104,B._$Ys=105,Z.prototype=new I,Z._$gT=new Array,Z.prototype._$zP=function(){this._$GS=new D,this._$GS._$zP()},Z.prototype._$F0=function(t){I.prototype._$F0.call(this,t),this._$A=t._$6L(),this._$o=t._$6L(),this._$GS=t._$nP(),this._$Eo=t._$nP(),I.prototype.readV2_opacity.call(this,t)},Z.prototype.init=function(t){var i=new K(this),e=(this._$o+1)*(this._$A+1);return null!=i._$Cr&&(i._$Cr=null),i._$Cr=new Float32Array(2*e),null!=i._$hr&&(i._$hr=null),this._$32()?i._$hr=new Float32Array(2*e):i._$hr=null,i},Z.prototype._$Nr=function(t,i){var e=i;if(this._$GS._$Ur(t)){var r=this._$VT(),o=Z._$gT;o[0]=!1,v._$Vr(t,this._$GS,o,r,this._$Eo,e._$Cr,0,2),i._$Ib(o[0]),this.interpolateOpacity(t,this._$GS,i,o)}},Z.prototype._$2b=function(t,i){var e=i;if(e._$hS(!0),this._$32()){var r=this.getTargetBaseDataID();if(e._$8r==I._$ur&&(e._$8r=t.getBaseDataIndex(r)),e._$8r<0)at._$so&&_._$li("_$L _$0P _$G :: %s",r),e._$hS(!1);else{var o=t.getBaseData(e._$8r),n=t._$q2(e._$8r);if(null!=o&&n._$yo()){var s=n.getTotalScale();e.setTotalScale_notForClient(s);var a=n.getTotalOpacity();e.setTotalOpacity(a*e.getInterpolatedOpacity()),o._$nb(t,n,e._$Cr,e._$hr,this._$VT(),0,2),e._$hS(!0)}else e._$hS(!1)}}else e.setTotalOpacity(e.getInterpolatedOpacity())},Z.prototype._$nb=function(t,i,e,r,o,n,s){var _=i,a=null!=_._$hr?_._$hr:_._$Cr;Z.transformPoints_sdk2(e,r,o,n,s,a,this._$o,this._$A)},Z.transformPoints_sdk2=function(i,e,r,o,n,s,_,a){for(var h,l,$,u=r*n,p=0,f=0,c=0,d=0,g=0,y=0,m=!1,T=o;T<u;T+=n){var P,S,v,L;if(v=i[T],L=i[T+1],P=v*_,S=L*a,P<0||S<0||_<=P||a<=S){var M=_+1;if(!m){m=!0,p=.25*(s[2*(0+0*M)]+s[2*(_+0*M)]+s[2*(0+a*M)]+s[2*(_+a*M)]),f=.25*(s[2*(0+0*M)+1]+s[2*(_+0*M)+1]+s[2*(0+a*M)+1]+s[2*(_+a*M)+1]);var E=s[2*(_+a*M)]-s[2*(0+0*M)],A=s[2*(_+a*M)+1]-s[2*(0+0*M)+1],I=s[2*(_+0*M)]-s[2*(0+a*M)],w=s[2*(_+0*M)+1]-s[2*(0+a*M)+1];c=.5*(E+I),d=.5*(A+w),g=.5*(E-I),y=.5*(A-w),p-=.5*(c+g),f-=.5*(d+y)}if(-2<v&&v<3&&-2<L&&L<3)if(v<=0)if(L<=0){var x=s[2*(0+0*M)],O=s[2*(0+0*M)+1],D=p-2*c,R=f-2*d,b=p-2*g,F=f-2*y,C=p-2*c-2*g,N=f-2*d-2*y,B=.5*(v- -2),U=.5*(L- -2);B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else if(L>=1){var b=s[2*(0+a*M)],F=s[2*(0+a*M)+1],C=p-2*c+1*g,N=f-2*d+1*y,x=p+3*g,O=f+3*y,D=p-2*c+3*g,R=f-2*d+3*y,B=.5*(v- -2),U=.5*(L-1);B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else{var G=0|S;G==a&&(G=a-1);var B=.5*(v- -2),U=S-G,Y=G/a,k=(G+1)/a,b=s[2*(0+G*M)],F=s[2*(0+G*M)+1],x=s[2*(0+(G+1)*M)],O=s[2*(0+(G+1)*M)+1],C=p-2*c+Y*g,N=f-2*d+Y*y,D=p-2*c+k*g,R=f-2*d+k*y;B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else if(1<=v)if(L<=0){var D=s[2*(_+0*M)],R=s[2*(_+0*M)+1],x=p+3*c,O=f+3*d,C=p+1*c-2*g,N=f+1*d-2*y,b=p+3*c-2*g,F=f+3*d-2*y,B=.5*(v-1),U=.5*(L- -2);B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else if(L>=1){var C=s[2*(_+a*M)],N=s[2*(_+a*M)+1],b=p+3*c+1*g,F=f+3*d+1*y,D=p+1*c+3*g,R=f+1*d+3*y,x=p+3*c+3*g,O=f+3*d+3*y,B=.5*(v-1),U=.5*(L-1);B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else{var G=0|S;G==a&&(G=a-1);var B=.5*(v-1),U=S-G,Y=G/a,k=(G+1)/a,C=s[2*(_+G*M)],N=s[2*(_+G*M)+1],D=s[2*(_+(G+1)*M)],R=s[2*(_+(G+1)*M)+1],b=p+3*c+Y*g,F=f+3*d+Y*y,x=p+3*c+k*g,O=f+3*d+k*y;B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else if(L<=0){var V=0|P;V==_&&(V=_-1);var B=P-V,U=.5*(L- -2),X=V/_,z=(V+1)/_,D=s[2*(V+0*M)],R=s[2*(V+0*M)+1],x=s[2*(V+1+0*M)],O=s[2*(V+1+0*M)+1],C=p+X*c-2*g,N=f+X*d-2*y,b=p+z*c-2*g,F=f+z*d-2*y;B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else if(L>=1){var V=0|P;V==_&&(V=_-1);var B=P-V,U=.5*(L-1),X=V/_,z=(V+1)/_,C=s[2*(V+a*M)],N=s[2*(V+a*M)+1],b=s[2*(V+1+a*M)],F=s[2*(V+1+a*M)+1],D=p+X*c+3*g,R=f+X*d+3*y,x=p+z*c+3*g,O=f+z*d+3*y;B+U<=1?(e[T]=C+(b-C)*B+(D-C)*U,e[T+1]=N+(F-N)*B+(R-N)*U):(e[T]=x+(D-x)*(1-B)+(b-x)*(1-U),e[T+1]=O+(R-O)*(1-B)+(F-O)*(1-U))}else t.err.printf("_$li calc : %.4f , %.4f\\t\\t\\t\\t\\t@@BDBoxGrid\\n",v,L);else e[T]=p+v*c+L*g,e[T+1]=f+v*d+L*y}else l=P-(0|P),$=S-(0|S),h=2*((0|P)+(0|S)*(_+1)),l+$<1?(e[T]=s[h]*(1-l-$)+s[h+2]*l+s[h+2*(_+1)]*$,e[T+1]=s[h+1]*(1-l-$)+s[h+3]*l+s[h+2*(_+1)+1]*$):(e[T]=s[h+2*(_+1)+2]*(l-1+$)+s[h+2*(_+1)]*(1-l)+s[h+2]*(1-$),e[T+1]=s[h+2*(_+1)+3]*(l-1+$)+s[h+2*(_+1)+1]*(1-l)+s[h+3]*(1-$))}},Z.prototype.transformPoints_sdk1=function(t,i,e,r,o,n,s){for(var _,a,h,l,$,u,p,f=i,c=this._$o,d=this._$A,g=o*s,y=null!=f._$hr?f._$hr:f._$Cr,m=n;m<g;m+=s)at._$ts?(_=e[m],a=e[m+1],_<0?_=0:_>1&&(_=1),a<0?a=0:a>1&&(a=1),_*=c,a*=d,h=0|_,l=0|a,h>c-1&&(h=c-1),l>d-1&&(l=d-1),u=_-h,p=a-l,$=2*(h+l*(c+1))):(_=e[m]*c,a=e[m+1]*d,u=_-(0|_),p=a-(0|a),$=2*((0|_)+(0|a)*(c+1))),u+p<1?(r[m]=y[$]*(1-u-p)+y[$+2]*u+y[$+2*(c+1)]*p,r[m+1]=y[$+1]*(1-u-p)+y[$+3]*u+y[$+2*(c+1)+1]*p):(r[m]=y[$+2*(c+1)+2]*(u-1+p)+y[$+2*(c+1)]*(1-u)+y[$+2]*(1-p),r[m+1]=y[$+2*(c+1)+3]*(u-1+p)+y[$+2*(c+1)+1]*(1-u)+y[$+3]*(1-p))},Z.prototype._$VT=function(){return(this._$o+1)*(this._$A+1)},Z.prototype.getType=function(){return I._$_b},K.prototype=new _t,tt._$42=0,tt.prototype._$zP=function(){this._$3S=new Array,this._$aS=new Array},tt.prototype._$F0=function(t){this._$g0=t._$8L(),this.visible=t._$8L(),this._$NL=t._$nP(),this._$3S=t._$nP(),this._$aS=t._$nP()},tt.prototype.init=function(t){var i=new it(this);return i.setPartsOpacity(this.isVisible()?1:0),i},tt.prototype._$6o=function(t){if(null==this._$3S)throw new Error("_$3S _$6 _$Wo@_$6o");this._$3S.push(t)},tt.prototype._$3o=function(t){if(null==this._$aS)throw new Error("_$aS _$6 _$Wo@_$3o");this._$aS.push(t)},tt.prototype._$Zo=function(t){this._$3S=t},tt.prototype._$xo=function(t){this._$aS=t},tt.prototype.isVisible=function(){return this.visible},tt.prototype._$uL=function(){return this._$g0},tt.prototype._$KP=function(t){this.visible=t},tt.prototype._$ET=function(t){this._$g0=t},tt.prototype.getBaseData=function(){return this._$3S},tt.prototype.getDrawData=function(){return this._$aS},tt.prototype._$p2=function(){return this._$NL},tt.prototype._$ob=function(t){this._$NL=t},tt.prototype.getPartsID=function(){return this._$NL},tt.prototype._$MP=function(t){this._$NL=t},it.prototype=new $,it.prototype.getPartsOpacity=function(){return this._$VS},it.prototype.setPartsOpacity=function(t){this._$VS=t},et._$L7=function(){u._$27(),yt._$27(),b._$27(),l._$27()},et.prototype.toString=function(){return this.id},rt.prototype._$F0=function(t){},ot.prototype._$1s=function(){return this._$4S},ot.prototype._$zP=function(){this._$4S=new Array},ot.prototype._$F0=function(t){this._$4S=t._$nP()},ot.prototype._$Ks=function(t){this._$4S.push(t)},nt.tr=new gt,nt._$50=new gt,nt._$Ti=new Array(0,0),nt._$Pi=new Array(0,0),nt._$B=new Array(0,0),nt.prototype._$lP=function(t,i,e,r){this.viewport=new Array(t,i,e,r)},nt.prototype._$bL=function(){this.context.save();var t=this.viewport;null!=t&&(this.context.beginPath(),this.context._$Li(t[0],t[1],t[2],t[3]),this.context.clip())},nt.prototype._$ei=function(){this.context.restore()},nt.prototype.drawElements=function(t,i,e,r,o,n,s,a){try{o!=this._$Qo&&(this._$Qo=o,this.context.globalAlpha=o);for(var h=i.length,l=t.width,$=t.height,u=this.context,p=this._$xP,f=this._$uP,c=this._$6r,d=this._$3r,g=nt.tr,y=nt._$Ti,m=nt._$Pi,T=nt._$B,P=0;P<h;P+=3){u.save();var S=i[P],v=i[P+1],L=i[P+2],M=p+c*e[2*S],E=f+d*e[2*S+1],A=p+c*e[2*v],I=f+d*e[2*v+1],w=p+c*e[2*L],x=f+d*e[2*L+1];s&&(s._$PS(M,E,T),M=T[0],E=T[1],s._$PS(A,I,T),A=T[0],I=T[1],s._$PS(w,x,T),w=T[0],x=T[1]);var O=l*r[2*S],D=$-$*r[2*S+1],R=l*r[2*v],b=$-$*r[2*v+1],F=l*r[2*L],C=$-$*r[2*L+1],N=Math.atan2(b-D,R-O),B=Math.atan2(I-E,A-M),U=A-M,G=I-E,Y=Math.sqrt(U*U+G*G),k=R-O,V=b-D,X=Math.sqrt(k*k+V*V),z=Y/X;It._$ni(F,C,O,D,R-O,b-D,-(b-D),R-O,y),It._$ni(w,x,M,E,A-M,I-E,-(I-E),A-M,m);var H=(m[0]-y[0])/y[1],W=Math.min(O,R,F),j=Math.max(O,R,F),q=Math.min(D,b,C),J=Math.max(D,b,C),Q=Math.floor(W),Z=Math.floor(q),K=Math.ceil(j),tt=Math.ceil(J);g.identity(),g.translate(M,E),g.rotate(B),g.scale(1,m[1]/y[1]),g.shear(H,0),g.scale(z,z),g.rotate(-N),g.translate(-O,-D),g.setContext(u);if(n||(n=1.2),at.IGNORE_EXPAND&&(n=0),at.USE_CACHED_POLYGON_IMAGE){var it=a._$e0;if(it.gl_cacheImage=it.gl_cacheImage||{},!it.gl_cacheImage[P]){var et=nt.createCanvas(K-Q,tt-Z);at.DEBUG_DATA.LDGL_CANVAS_MB=at.DEBUG_DATA.LDGL_CANVAS_MB||0,at.DEBUG_DATA.LDGL_CANVAS_MB+=(K-Q)*(tt-Z)*4;var rt=et.getContext("2d");rt.translate(-Q,-Z),nt.clip(rt,g,n,Y,O,D,R,b,F,C,M,E,A,I,w,x),rt.drawImage(t,0,0),it.gl_cacheImage[P]={cacheCanvas:et,cacheContext:rt}}u.drawImage(it.gl_cacheImage[P].cacheCanvas,Q,Z)}else at.IGNORE_CLIP||nt.clip(u,g,n,Y,O,D,R,b,F,C,M,E,A,I,w,x),at.USE_ADJUST_TRANSLATION&&(W=0,j=l,q=0,J=$),u.drawImage(t,W,q,j-W,J-q,W,q,j-W,J-q);u.restore()}}catch(t){_._$Rb(t)}},nt.clip=function(t,i,e,r,o,n,s,_,a,h,l,$,u,p,f,c){e>.02?nt.expandClip(t,i,e,r,l,$,u,p,f,c):nt.clipWithTransform(t,null,o,n,s,_,a,h)},nt.expandClip=function(t,i,e,r,o,n,s,_,a,h){var l=s-o,$=_-n,u=a-o,p=h-n,f=l*p-$*u>0?e:-e,c=-$,d=l,g=a-s,y=h-_,m=-y,T=g,P=Math.sqrt(g*g+y*y),S=-p,v=u,L=Math.sqrt(u*u+p*p),M=o-f*c/r,E=n-f*d/r,A=s-f*c/r,I=_-f*d/r,w=s-f*m/P,x=_-f*T/P,O=a-f*m/P,D=h-f*T/P,R=o+f*S/L,b=n+f*v/L,F=a+f*S/L,C=h+f*v/L,N=nt._$50;return null!=i._$P2(N)&&(nt.clipWithTransform(t,N,M,E,A,I,w,x,O,D,F,C,R,b),!0)},nt.clipWithTransform=function(t,i,e,r,o,n,s,a){if(arguments.length<7)return void _._$li("err : @LDGL.clip()");if(!(arguments[1]instanceof gt))return void _._$li("err : a[0] is _$6 LDTransform @LDGL.clip()");var h=nt._$B,l=i,$=arguments;if(t.beginPath(),l){l._$PS($[2],$[3],h),t.moveTo(h[0],h[1]);for(var u=4;u<$.length;u+=2)l._$PS($[u],$[u+1],h),t.lineTo(h[0],h[1])}else{t.moveTo($[2],$[3]);for(var u=4;u<$.length;u+=2)t.lineTo($[u],$[u+1])}t.clip()},nt.createCanvas=function(t,i){var e=document.createElement("canvas");return e.setAttribute("width",t),e.setAttribute("height",i),e||_._$li("err : "+e),e},nt.dumpValues=function(){for(var t="",i=0;i<arguments.length;i++)t+="["+i+"]= "+arguments[i].toFixed(3)+" , ";console.log(t)},st.prototype._$F0=function(t){this._$TT=t._$_T(),this._$LT=t._$_T(),this._$FS=t._$_T(),this._$wL=t._$nP()},st.prototype.getMinValue=function(){return this._$TT},st.prototype.getMaxValue=function(){return this._$LT},st.prototype.getDefaultValue=function(){return this._$FS},st.prototype.getParamID=function(){return this._$wL},_t.prototype._$yo=function(){return this._$AT&&!this._$JS},_t.prototype._$hS=function(t){this._$AT=t},_t.prototype._$GT=function(){return this._$e0},_t.prototype._$l2=function(t){this._$IP=t},_t.prototype.getPartsIndex=function(){return this._$IP},_t.prototype._$x2=function(){return this._$JS},_t.prototype._$Ib=function(t){this._$JS=t},_t.prototype.getTotalScale=function(){return this.totalScale},_t.prototype.setTotalScale_notForClient=function(t){this.totalScale=t},_t.prototype.getInterpolatedOpacity=function(){return this._$7s},_t.prototype.setInterpolatedOpacity=function(t){this._$7s=t},_t.prototype.getTotalOpacity=function(t){return this.totalOpacity},_t.prototype.setTotalOpacity=function(t){this.totalOpacity=t},at._$2s="2.1.00_1",at._$Kr=201001e3,at._$sP=!0,at._$so=!0,at._$cb=!1,at._$3T=!0,at._$Ts=!0,at._$fb=!0,at._$ts=!0,at.L2D_DEFORMER_EXTEND=!0,at._$Wb=!1;at._$yr=!1,at._$Zs=!1,at.L2D_NO_ERROR=0,at._$i7=1e3,at._$9s=1001,at._$es=1100,at._$r7=2e3,at._$07=2001,at._$b7=2002,at._$H7=4e3,at.L2D_COLOR_BLEND_MODE_MULT=0,at.L2D_COLOR_BLEND_MODE_ADD=1,at.L2D_COLOR_BLEND_MODE_INTERPOLATE=2,at._$6b=!0,at._$cT=0,at.clippingMaskBufferSize=256,at.glContext=new Array,at.frameBuffers=new Array,at.fTexture=new Array,at.IGNORE_CLIP=!1,at.IGNORE_EXPAND=!1,at.EXPAND_W=2,at.USE_ADJUST_TRANSLATION=!0,at.USE_CANVAS_TRANSFORM=!0,at.USE_CACHED_POLYGON_IMAGE=!1,at.DEBUG_DATA={},at.PROFILE_IOS_SPEED={PROFILE_NAME:"iOS Speed",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!0,EXPAND_W:4},at.PROFILE_IOS_QUALITY={PROFILE_NAME:"iOS HiQ",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},at.PROFILE_IOS_DEFAULT=at.PROFILE_IOS_QUALITY,at.PROFILE_ANDROID={PROFILE_NAME:"Android",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},at.PROFILE_DESKTOP={PROFILE_NAME:"Desktop",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},at.initProfile=function(){Et.isIOS()?at.setupProfile(at.PROFILE_IOS_DEFAULT):Et.isAndroid()?at.setupProfile(at.PROFILE_ANDROID):at.setupProfile(at.PROFILE_DESKTOP)},at.setupProfile=function(t,i){if("number"==typeof t)switch(t){case 9901:t=at.PROFILE_IOS_SPEED;break;case 9902:t=at.PROFILE_IOS_QUALITY;break;case 9903:t=at.PROFILE_IOS_DEFAULT;break;case 9904:t=at.PROFILE_ANDROID;break;case 9905:t=at.PROFILE_DESKTOP;break;default:alert("profile _$6 _$Ui : "+t)}arguments.length<2&&(i=!0),i&&console.log("profile : "+t.PROFILE_NAME);for(var e in t)at[e]=t[e],i&&console.log("  ["+e+"] = "+t[e])},at.init=function(){if(at._$6b){console.log("Live2D %s",at._$2s),at._$6b=!1;!0,at.initProfile()}},at.getVersionStr=function(){return at._$2s},at.getVersionNo=function(){return at._$Kr},at._$sT=function(t){at._$cT=t},at.getError=function(){var t=at._$cT;return at._$cT=0,t},at.dispose=function(){at.glContext=[],at.frameBuffers=[],at.fTexture=[]},at.setGL=function(t,i){var e=i||0;at.glContext[e]=t},at.getGL=function(t){return at.glContext[t]},at.setClippingMaskBufferSize=function(t){at.clippingMaskBufferSize=t},at.getClippingMaskBufferSize=function(){return at.clippingMaskBufferSize},at.deleteBuffer=function(t){at.getGL(t).deleteFramebuffer(at.frameBuffers[t].framebuffer),delete at.frameBuffers[t],delete at.glContext[t]},ht._$r2=function(t){return t<0?0:t>1?1:.5-.5*Math.cos(t*Lt.PI_F)},lt._$fr=-1,lt.prototype.toString=function(){return this._$ib},$t.prototype=new W,$t._$42=0,$t._$Os=30,$t._$ms=0,$t._$ns=1,$t._$_s=2,$t._$gT=new Array,$t.prototype._$_S=function(t){this._$LP=t},$t.prototype.getTextureNo=function(){return this._$LP},$t.prototype._$ZL=function(){return this._$Qi},$t.prototype._$H2=function(){return this._$JP},$t.prototype.getNumPoints=function(){return this._$d0},$t.prototype.getType=function(){return W._$wb},$t.prototype._$B2=function(t,i,e){var r=i,o=null!=r._$hr?r._$hr:r._$Cr;switch(U._$do){default:case U._$Ms:throw new Error("_$L _$ro ");case U._$Qs:for(var n=this._$d0-1;n>=0;--n)o[n*U._$No+4]=e}},$t.prototype._$zP=function(){this._$GS=new D,this._$GS._$zP()},$t.prototype._$F0=function(t){W.prototype._$F0.call(this,t),this._$LP=t._$6L(),this._$d0=t._$6L(),this._$Yo=t._$6L();var i=t._$nP();this._$BP=new Int16Array(3*this._$Yo);for(var e=3*this._$Yo-1;e>=0;--e)this._$BP[e]=i[e];if(this._$Eo=t._$nP(),this._$Qi=t._$nP(),t.getFormatVersion()>=G._$s7){if(this._$JP=t._$6L(),0!=this._$JP){if(0!=(1&this._$JP)){var r=t._$6L();null==this._$5P&&(this._$5P=new Object),this._$5P._$Hb=parseInt(r)}0!=(this._$JP&$t._$Os)?this._$6s=(this._$JP&$t._$Os)>>1:this._$6s=$t._$ms,0!=(32&this._$JP)&&(this.culling=!1)}}else this._$JP=0},$t.prototype.init=function(t){var i=new ut(this),e=this._$d0*U._$No,r=this._$32();switch(null!=i._$Cr&&(i._$Cr=null),i._$Cr=new Float32Array(e),null!=i._$hr&&(i._$hr=null),i._$hr=r?new Float32Array(e):null,U._$do){default:case U._$Ms:if(U._$Ls)for(var o=this._$d0-1;o>=0;--o){var n=o<<1;this._$Qi[n+1]=1-this._$Qi[n+1]}break;case U._$Qs:for(var o=this._$d0-1;o>=0;--o){var n=o<<1,s=o*U._$No,_=this._$Qi[n],a=this._$Qi[n+1];i._$Cr[s]=_,i._$Cr[s+1]=a,i._$Cr[s+4]=0,r&&(i._$hr[s]=_,i._$hr[s+1]=a,i._$hr[s+4]=0)}}return i},$t.prototype._$Nr=function(t,i){var e=i;if(this!=e._$GT()&&console.log("### assert!! ### "),this._$GS._$Ur(t)&&(W.prototype._$Nr.call(this,t,e),!e._$IS[0])){var r=$t._$gT;r[0]=!1,v._$Vr(t,this._$GS,r,this._$d0,this._$Eo,e._$Cr,U._$i2,U._$No)}},$t.prototype._$2b=function(t,i){try{this!=i._$GT()&&console.log("### assert!! ### ");var e=!1;i._$IS[0]&&(e=!0);var r=i;if(!e&&(W.prototype._$2b.call(this,t),this._$32())){var o=this.getTargetBaseDataID();if(r._$8r==W._$ur&&(r._$8r=t.getBaseDataIndex(o)),r._$8r<0)at._$so&&_._$li("_$L _$0P _$G :: %s",o);else{var n=t.getBaseData(r._$8r),s=t._$q2(r._$8r);null==n||s._$x2()?r._$AT=!1:(n._$nb(t,s,r._$Cr,r._$hr,this._$d0,U._$i2,U._$No),r._$AT=!0),r.baseOpacity=s.getTotalOpacity()}}}catch(t){throw t}},$t.prototype.draw=function(t,i,e){if(this!=e._$GT()&&console.log("### assert!! ### "),!e._$IS[0]){var r=e,o=this._$LP;o<0&&(o=1);var n=this.getOpacity(i,r)*e._$VS*e.baseOpacity,s=null!=r._$hr?r._$hr:r._$Cr;t.setClipBufPre_clipContextForDraw(e.clipBufPre_clipContext),t._$WP(this.culling),t._$Uo(o,3*this._$Yo,this._$BP,s,this._$Qi,n,this._$6s,r)}},$t.prototype.dump=function(){console.log("  _$yi( %d ) , _$d0( %d ) , _$Yo( %d ) \\n",this._$LP,this._$d0,this._$Yo),console.log("  _$Oi _$di = { ");for(var t=0;t<this._$BP.length;t++)console.log("%5d ,",this._$BP[t]);console.log("\\n  _$5i _$30");for(var t=0;t<this._$Eo.length;t++){console.log("\\n    _$30[%d] = ",t);for(var i=this._$Eo[t],e=0;e<i.length;e++)console.log("%6.2f, ",i[e])}console.log("\\n")},$t.prototype._$72=function(t){return null==this._$5P?null:this._$5P[t]},$t.prototype.getIndexArray=function(){return this._$BP},ut.prototype=new Mt,ut.prototype.getTransformedPoints=function(){return null!=this._$hr?this._$hr:this._$Cr},pt.prototype._$HT=function(t){this.x=t.x,this.y=t.y},pt.prototype._$HT=function(t,i){this.x=t,this.y=i},ft.prototype=new i,ft.loadModel=function(t){var e=new ft;return i._$62(e,t),e},ft.loadModel=function(t,e){var r=e||0,o=new ft(r);return i._$62(o,t),o},ft._$to=function(){return new ft},ft._$er=function(t){var i=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==i.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+i._$PL());for(var e=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],r=ft.loadModel(i._$3b()),o=0;o<e.length;o++){var n=new _$5(e[o]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());r.setTexture(o,_$nL._$_o(t,n._$3b()))}return r},ft.prototype.setGL=function(t){at.setGL(t)},ft.prototype.setTransform=function(t){this.drawParamWebGL.setTransform(t)},ft.prototype.update=function(){this._$5S.update(),this._$5S.preDraw(this.drawParamWebGL)},ft.prototype.draw=function(){this._$5S.draw(this.drawParamWebGL)},ft.prototype._$K2=function(){this.drawParamWebGL._$K2()},ft.prototype.setTexture=function(t,i){null==this.drawParamWebGL&&_._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,i)},ft.prototype.setTexture=function(t,i){null==this.drawParamWebGL&&_._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,i)},ft.prototype._$Rs=function(){return this.drawParamWebGL._$Rs()},ft.prototype._$Ds=function(t){this.drawParamWebGL._$Ds(t)},ft.prototype.getDrawParam=function(){return this.drawParamWebGL},ft.prototype.setMatrix=function(t){this.drawParamWebGL.setMatrix(t)},ft.prototype.setPremultipliedAlpha=function(t){this.drawParamWebGL.setPremultipliedAlpha(t)},ft.prototype.isPremultipliedAlpha=function(){return this.drawParamWebGL.isPremultipliedAlpha()},ft.prototype.setAnisotropy=function(t){this.drawParamWebGL.setAnisotropy(t)},ft.prototype.getAnisotropy=function(){return this.drawParamWebGL.getAnisotropy()},ct.prototype._$tb=function(){return this.motions},ct.prototype.startMotion=function(t,i){for(var e=null,r=this.motions.length,o=0;o<r;++o)null!=(e=this.motions[o])&&(e._$qS(e._$w0.getFadeOut()),this._$eb&&_._$Ji("MotionQueueManager[size:%2d]->startMotion() / start _$K _$3 (m%d)\\n",r,e._$sr));if(null==t)return-1;e=new dt,e._$w0=t,this.motions.push(e);var n=e._$sr;return this._$eb&&_._$Ji("MotionQueueManager[size:%2d]->startMotion() / new _$w0 (m%d)\\n",r,n),n},ct.prototype.updateParam=function(t){try{for(var i=!1,e=0;e<this.motions.length;e++){var r=this.motions[e];if(null!=r){var o=r._$w0;null!=o?(o.updateParam(t,r),i=!0,r.isFinished()&&(this._$eb&&_._$Ji("MotionQueueManager[size:%2d]->updateParam() / _$T0 _$w0 (m%d)\\n",this.motions.length-1,r._$sr),this.motions.splice(e,1),e--)):(this.motions=this.motions.splice(e,1),e--)}else this.motions.splice(e,1),e--}return i}catch(t){return _._$li(t),!0}},ct.prototype.isFinished=function(t){if(arguments.length>=1){for(var i=0;i<this.motions.length;i++){var e=this.motions[i];if(null!=e&&(e._$sr==t&&!e.isFinished()))return!1}return!0}for(var i=0;i<this.motions.length;i++){var e=this.motions[i];if(null!=e){if(null!=e._$w0){if(!e.isFinished())return!1}else this.motions.splice(i,1),i--}else this.motions.splice(i,1),i--}return!0},ct.prototype.stopAllMotions=function(){for(var t=0;t<this.motions.length;t++){var i=this.motions[t];if(null!=i){i._$w0;this.motions.splice(t,1),t--}else this.motions.splice(t,1),t--}},ct.prototype._$Zr=function(t){this._$eb=t},ct.prototype._$e=function(){console.log("-- _$R --\\n");for(var t=0;t<this.motions.length;t++){var i=this.motions[t],e=i._$w0;console.log("MotionQueueEnt[%d] :: %s\\n",this.motions.length,e.toString())}},dt._$Gs=0,dt.prototype.isFinished=function(){return this._$9L},dt.prototype._$qS=function(t){var i=w.getUserTimeMSec(),e=i+t;(this._$Do<0||e<this._$Do)&&(this._$Do=e)},dt.prototype._$Bs=function(){return this._$sr},gt.prototype.setContext=function(t){var i=this.m;t.transform(i[0],i[1],i[3],i[4],i[6],i[7])},gt.prototype.toString=function(){for(var t="LDTransform { ",i=0;i<9;i++)t+=this.m[i].toFixed(2)+" ,";return t+=" }"},gt.prototype.identity=function(){var t=this.m;t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0},gt.prototype._$PS=function(t,i,e){null==e&&(e=new Array(0,0));var r=this.m;return e[0]=r[0]*t+r[3]*i+r[6],e[1]=r[1]*t+r[4]*i+r[7],e},gt.prototype._$P2=function(t){t||(t=new gt);var i=this.m,e=i[0],r=i[1],o=i[2],n=i[3],s=i[4],_=i[5],a=i[6],h=i[7],l=i[8],$=e*s*l+r*_*a+o*n*h-e*_*h-o*s*a-r*n*l;if(0==$)return null;var u=1/$;return t.m[0]=u*(s*l-h*_),t.m[1]=u*(h*o-r*l),t.m[2]=u*(r*_-s*o),t.m[3]=u*(a*_-n*l),t.m[4]=u*(e*l-a*o),t.m[5]=u*(n*o-e*_),t.m[6]=u*(n*h-a*s),t.m[7]=u*(a*r-e*h),t.m[8]=u*(e*s-n*r),t},gt.prototype.transform=function(t,i,e){null==e&&(e=new Array(0,0));var r=this.m;return e[0]=r[0]*t+r[3]*i+r[6],e[1]=r[1]*t+r[4]*i+r[7],e},gt.prototype.translate=function(t,i){var e=this.m;e[6]=e[0]*t+e[3]*i+e[6],e[7]=e[1]*t+e[4]*i+e[7],e[8]=e[2]*t+e[5]*i+e[8]},gt.prototype.scale=function(t,i){var e=this.m;e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=i,e[4]*=i,e[5]*=i},gt.prototype.shear=function(t,i){var e=this.m,r=e[0]+e[3]*i,o=e[1]+e[4]*i,n=e[2]+e[5]*i;e[3]=e[0]*t+e[3],e[4]=e[1]*t+e[4],e[5]=e[2]*t+e[5],e[0]=r,e[1]=o,e[2]=n},gt.prototype.rotate=function(t){var i=this.m,e=Math.cos(t),r=Math.sin(t),o=i[0]*e+i[3]*r,n=i[1]*e+i[4]*r,s=i[2]*e+i[5]*r;i[3]=-i[0]*r+i[3]*e,i[4]=-i[1]*r+i[4]*e,i[5]=-i[2]*r+i[5]*e,i[0]=o,i[1]=n,i[2]=s},gt.prototype.concatenate=function(t){var i=this.m,e=t.m,r=i[0]*e[0]+i[3]*e[1]+i[6]*e[2],o=i[1]*e[0]+i[4]*e[1]+i[7]*e[2],n=i[2]*e[0]+i[5]*e[1]+i[8]*e[2],s=i[0]*e[3]+i[3]*e[4]+i[6]*e[5],_=i[1]*e[3]+i[4]*e[4]+i[7]*e[5],a=i[2]*e[3]+i[5]*e[4]+i[8]*e[5],h=i[0]*e[6]+i[3]*e[7]+i[6]*e[8],l=i[1]*e[6]+i[4]*e[7]+i[7]*e[8],$=i[2]*e[6]+i[5]*e[7]+i[8]*e[8];m[0]=r,m[1]=o,m[2]=n,m[3]=s,m[4]=_,m[5]=a,m[6]=h,m[7]=l,m[8]=$},yt.prototype=new et,yt._$eT=null,yt._$tP=new Object,yt._$2o=function(){return null==yt._$eT&&(yt._$eT=yt.getID("DST_BASE")),yt._$eT},yt._$27=function(){yt._$tP.clear(),yt._$eT=null},yt.getID=function(t){var i=yt._$tP[t];return null==i&&(i=new yt(t),yt._$tP[t]=i),i},yt.prototype._$3s=function(){return new yt},mt.prototype=new E,mt._$9r=function(t){return new Float32Array(t)},mt._$vb=function(t){return new Int16Array(t)},mt._$cr=function(t,i){return null==t||t._$yL()<i.length?(t=mt._$9r(2*i.length),t.put(i),t._$oT(0)):(t.clear(),t.put(i),t._$oT(0)),t},mt._$mb=function(t,i){return null==t||t._$yL()<i.length?(t=mt._$vb(2*i.length),t.put(i),t._$oT(0)):(t.clear(),t.put(i),t._$oT(0)),t},mt._$Hs=function(){return this._$Gr},mt._$as=function(t){this._$Gr=t},mt.prototype.getGL=function(){return this.gl},mt.prototype.setGL=function(t){this.gl=t},mt.prototype.setTransform=function(t){this.transform=t},mt.prototype._$ZT=function(){var t=this.gl;this.firstDraw&&(this.initShader(),this.firstDraw=!1,this.anisotropyExt=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic"),this.anisotropyExt&&(this.maxAnisotropy=t.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.DEPTH_TEST),t.frontFace(t.CW),t.enable(t.BLEND),t.colorMask(1,1,1,1),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},mt.prototype._$Uo=function(t,i,e,r,o,n,s,_){if(!(n<.01&&null==this.clipBufPre_clipContextMask)){var a=(n>.9&&at.EXPAND_W,this.gl);if(null==this.gl)throw new Error("gl is null");var h=1*this._$C0*n,l=1*this._$tT*n,$=1*this._$WL*n,u=this._$lT*n;if(null!=this.clipBufPre_clipContextMask){a.frontFace(a.CCW),a.useProgram(this.shaderProgram),this._$vS=Tt(a,this._$vS,r),this._$no=Pt(a,this._$no,e),a.enableVertexAttribArray(this.a_position_Loc),a.vertexAttribPointer(this.a_position_Loc,2,a.FLOAT,!1,0,0),this._$NT=Tt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc,1),a.enableVertexAttribArray(this.a_texCoord_Loc),a.vertexAttribPointer(this.a_texCoord_Loc,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_matrix_Loc,!1,this.getClipBufPre_clipContextMask().matrixForMask);var p=this.getClipBufPre_clipContextMask().layoutChannelNo,f=this.getChannelFlagAsColor(p);a.uniform4f(this.u_channelFlag,f.r,f.g,f.b,f.a);var c=this.getClipBufPre_clipContextMask().layoutBounds;a.uniform4f(this.u_baseColor_Loc,2*c.x-1,2*c.y-1,2*c._$EL()-1,2*c._$5T()-1),a.uniform1i(this.u_maskFlag_Loc,!0)}else if(null!=this.getClipBufPre_clipContextDraw()){a.useProgram(this.shaderProgramOff),this._$vS=Tt(a,this._$vS,r),this._$no=Pt(a,this._$no,e),a.enableVertexAttribArray(this.a_position_Loc_Off),a.vertexAttribPointer(this.a_position_Loc_Off,2,a.FLOAT,!1,0,0),this._$NT=Tt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc_Off,1),a.enableVertexAttribArray(this.a_texCoord_Loc_Off),a.vertexAttribPointer(this.a_texCoord_Loc_Off,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_clipMatrix_Loc_Off,!1,this.getClipBufPre_clipContextDraw().matrixForDraw),a.uniformMatrix4fv(this.u_matrix_Loc_Off,!1,this.matrix4x4),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,at.fTexture[this.glno]),a.uniform1i(this.s_texture1_Loc_Off,2);var p=this.getClipBufPre_clipContextDraw().layoutChannelNo,f=this.getChannelFlagAsColor(p);a.uniform4f(this.u_channelFlag_Loc_Off,f.r,f.g,f.b,f.a),a.uniform4f(this.u_baseColor_Loc_Off,h,l,$,u)}else a.useProgram(this.shaderProgram),this._$vS=Tt(a,this._$vS,r),this._$no=Pt(a,this._$no,e),a.enableVertexAttribArray(this.a_position_Loc),a.vertexAttribPointer(this.a_position_Loc,2,a.FLOAT,!1,0,0),this._$NT=Tt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc,1),a.enableVertexAttribArray(this.a_texCoord_Loc),a.vertexAttribPointer(this.a_texCoord_Loc,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_matrix_Loc,!1,this.matrix4x4),a.uniform4f(this.u_baseColor_Loc,h,l,$,u),a.uniform1i(this.u_maskFlag_Loc,!1);this.culling?this.gl.enable(a.CULL_FACE):this.gl.disable(a.CULL_FACE),this.gl.enable(a.BLEND);var d,g,y,m;if(null!=this.clipBufPre_clipContextMask)d=a.ONE,g=a.ONE_MINUS_SRC_ALPHA,y=a.ONE,m=a.ONE_MINUS_SRC_ALPHA;else switch(s){case $t._$ms:d=a.ONE,g=a.ONE_MINUS_SRC_ALPHA,y=a.ONE,m=a.ONE_MINUS_SRC_ALPHA;break;case $t._$ns:d=a.ONE,g=a.ONE,y=a.ZERO,m=a.ONE;break;case $t._$_s:d=a.DST_COLOR,g=a.ONE_MINUS_SRC_ALPHA,y=a.ZERO,m=a.ONE}a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(d,g,y,m),this.anisotropyExt&&a.texParameteri(a.TEXTURE_2D,this.anisotropyExt.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);var T=e.length;a.drawElements(a.TRIANGLES,T,a.UNSIGNED_SHORT,0),a.bindTexture(a.TEXTURE_2D,null)}},mt.prototype._$Rs=function(){throw new Error("_$Rs")},mt.prototype._$Ds=function(t){throw new Error("_$Ds")},mt.prototype._$K2=function(){for(var t=0;t<this.textures.length;t++){0!=this.textures[t]&&(this.gl._$K2(1,this.textures,t),this.textures[t]=null)}},mt.prototype.setTexture=function(t,i){this.textures[t]=i},mt.prototype.initShader=function(){var t=this.gl;this.loadShaders2(),this.a_position_Loc=t.getAttribLocation(this.shaderProgram,"a_position"),this.a_texCoord_Loc=t.getAttribLocation(this.shaderProgram,"a_texCoord"),this.u_matrix_Loc=t.getUniformLocation(this.shaderProgram,"u_mvpMatrix"),this.s_texture0_Loc=t.getUniformLocation(this.shaderProgram,"s_texture0"),this.u_channelFlag=t.getUniformLocation(this.shaderProgram,"u_channelFlag"),this.u_baseColor_Loc=t.getUniformLocation(this.shaderProgram,"u_baseColor"),this.u_maskFlag_Loc=t.getUniformLocation(this.shaderProgram,"u_maskFlag"),this.a_position_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_position"),this.a_texCoord_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_texCoord"),this.u_matrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_mvpMatrix"),this.u_clipMatrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_ClipMatrix"),this.s_texture0_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture0"),this.s_texture1_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture1"),this.u_channelFlag_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_channelFlag"),this.u_baseColor_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_baseColor")},mt.prototype.disposeShader=function(){var t=this.gl;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=null)},mt.prototype.compileShader=function(t,i){var e=this.gl,r=i,o=e.createShader(t);if(null==o)return _._$Ji("_$L0 to create shader"),null;if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){var n=e.getShaderInfoLog(o);return _._$Ji("_$L0 to compile shader : "+n),e.deleteShader(o),null}return o},mt.prototype.loadShaders2=function(){var t=this.gl;if(this.shaderProgram=t.createProgram(),!this.shaderProgram)return!1;if(this.shaderProgramOff=t.createProgram(),!this.shaderProgramOff)return!1;if(this.vertShader=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_mvpMatrix * a_position;    v_texCoord = a_texCoord;}"),!this.vertShader)return _._$Ji("Vertex shader compile _$li!"),!1;if(this.vertShaderOff=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;uniform mat4       u_ClipMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_ClipMatrix * a_position;    v_texCoord = a_texCoord ;}"),!this.vertShaderOff)return _._$Ji("OffVertex shader compile _$li!"),!1;if(this.fragShader=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform vec4       u_channelFlag;uniform vec4       u_baseColor;uniform bool       u_maskFlag;void main(){    vec4 smpColor;     if(u_maskFlag){        float isInside =             step(u_baseColor.x, v_ClipPos.x/v_ClipPos.w)          * step(u_baseColor.y, v_ClipPos.y/v_ClipPos.w)          * step(v_ClipPos.x/v_ClipPos.w, u_baseColor.z)          * step(v_ClipPos.y/v_ClipPos.w, u_baseColor.w);        smpColor = u_channelFlag * texture2D(s_texture0 , v_texCoord).a * isInside;    }else{        smpColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;    }    gl_FragColor = smpColor;}"),!this.fragShader)return _._$Ji("Fragment shader compile _$li!"),!1;if(this.fragShaderOff=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float ;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_channelFlag;uniform vec4       u_baseColor ;void main(){    vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;    vec4 clipMask = texture2D(s_texture1, v_ClipPos.xy / v_ClipPos.w) * u_channelFlag;    float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;    col_formask = col_formask * maskVal;    gl_FragColor = col_formask;}"),!this.fragShaderOff)return _._$Ji("OffFragment shader compile _$li!"),!1;if(t.attachShader(this.shaderProgram,this.vertShader),t.attachShader(this.shaderProgram,this.fragShader),t.attachShader(this.shaderProgramOff,this.vertShaderOff),t.attachShader(this.shaderProgramOff,this.fragShaderOff),t.linkProgram(this.shaderProgram),t.linkProgram(this.shaderProgramOff),!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS)){var i=t.getProgramInfoLog(this.shaderProgram);return _._$Ji("_$L0 to link program: "+i),this.vertShader&&(t.deleteShader(this.vertShader),this.vertShader=0),this.fragShader&&(t.deleteShader(this.fragShader),this.fragShader=0),this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=0),this.vertShaderOff&&(t.deleteShader(this.vertShaderOff),this.vertShaderOff=0),this.fragShaderOff&&(t.deleteShader(this.fragShaderOff),this.fragShaderOff=0),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=0),!1}return!0},mt.prototype.createFramebuffer=function(){var t=this.gl,i=at.clippingMaskBufferSize,e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,r);var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),at.fTexture[this.glno]=o,{framebuffer:e,renderbuffer:r,texture:at.fTexture[this.glno]}},St.prototype._$fP=function(){var t,i,e,r=this._$ST();if(0==(128&r))return 255&r;if(0==(128&(t=this._$ST())))return(127&r)<<7|127&t;if(0==(128&(i=this._$ST())))return(127&r)<<14|(127&t)<<7|255&i;if(0==(128&(e=this._$ST())))return(127&r)<<21|(127&t)<<14|(127&i)<<7|255&e;throw new lt("_$L _$0P  _")},St.prototype.getFormatVersion=function(){return this._$S2},St.prototype._$gr=function(t){this._$S2=t},St.prototype._$3L=function(){return this._$fP()},St.prototype._$mP=function(){return this._$zT(),this._$F+=8,this._$T.getFloat64(this._$F-8)},St.prototype._$_T=function(){return this._$zT(),this._$F+=4,this._$T.getFloat32(this._$F-4)},St.prototype._$6L=function(){return this._$zT(),this._$F+=4,this._$T.getInt32(this._$F-4)},St.prototype._$ST=function(){return this._$zT(),this._$T.getInt8(this._$F++)},St.prototype._$9T=function(){return this._$zT(),this._$F+=2,this._$T.getInt16(this._$F-2)},St.prototype._$2T=function(){throw this._$zT(),this._$F+=8,new lt("_$L _$q read long")},St.prototype._$po=function(){return this._$zT(),0!=this._$T.getInt8(this._$F++)};var xt=!0;St.prototype._$bT=function(){this._$zT();var t=this._$3L(),i=null;if(xt)try{var e=new ArrayBuffer(2*t);i=new Uint16Array(e);for(var r=0;r<t;++r)i[r]=this._$T.getUint8(this._$F++);return String.fromCharCode.apply(null,i)}catch(t){xt=!1}try{var o=new Array;if(null==i)for(var r=0;r<t;++r)o[r]=this._$T.getUint8(this._$F++);else for(var r=0;r<t;++r)o[r]=i[r];return String.fromCharCode.apply(null,o)}catch(t){console.log("read utf8 / _$rT _$L0 !! : "+t)}},St.prototype._$cS=function(){this._$zT();for(var t=this._$3L(),i=new Int32Array(t),e=0;e<t;e++)i[e]=this._$T.getInt32(this._$F),this._$F+=4;return i},St.prototype._$Tb=function(){this._$zT();for(var t=this._$3L(),i=new Float32Array(t),e=0;e<t;e++)i[e]=this._$T.getFloat32(this._$F),this._$F+=4;return i},St.prototype._$5b=function(){this._$zT();for(var t=this._$3L(),i=new Float64Array(t),e=0;e<t;e++)i[e]=this._$T.getFloat64(this._$F),this._$F+=8;return i},St.prototype._$nP=function(){return this._$Jb(-1)},St.prototype._$Jb=function(t){if(this._$zT(),t<0&&(t=this._$3L()),t==G._$7P){var i=this._$6L();if(0<=i&&i<this._$Ko.length)return this._$Ko[i];throw new lt("_$sL _$4i @_$m0")}var e=this._$4b(t);return this._$Ko.push(e),e},St.prototype._$4b=function(t){if(0==t)return null;if(50==t){var i=this._$bT(),e=b.getID(i);return e}if(51==t){var i=this._$bT(),e=yt.getID(i);return e}if(134==t){var i=this._$bT(),e=l.getID(i);return e}if(60==t){var i=this._$bT(),e=u.getID(i);return e}if(t>=48){var r=G._$9o(t);return null!=r?(r._$F0(this),r):null}switch(t){case 1:return this._$bT();case 10:return new n(this._$6L(),!0);case 11:return new S(this._$mP(),this._$mP(),this._$mP(),this._$mP());case 12:return new S(this._$_T(),this._$_T(),this._$_T(),this._$_T());case 13:return new L(this._$mP(),this._$mP());case 14:return new L(this._$_T(),this._$_T());case 15:for(var o=this._$3L(),e=new Array(o),s=0;s<o;s++)e[s]=this._$nP();return e;case 17:var e=new F(this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP());return e;case 21:return new h(this._$6L(),this._$6L(),this._$6L(),this._$6L());case 22:return new pt(this._$6L(),this._$6L());case 23:throw new Error("_$L _$ro ");case 16:case 25:return this._$cS();case 26:return this._$5b();case 27:return this._$Tb();case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 18:case 19:case 20:case 24:case 28:throw new lt("_$6 _$q : _$nP() of 2-9 ,18,19,20,24,28 : "+t);default:throw new lt("_$6 _$q : _$nP() NO _$i : "+t)}},St.prototype._$8L=function(){return 0==this._$hL?this._$v0=this._$ST():8==this._$hL&&(this._$v0=this._$ST(),this._$hL=0),1==(this._$v0>>7-this._$hL++&1)},St.prototype._$zT=function(){0!=this._$hL&&(this._$hL=0)},vt.prototype._$wP=function(t,i,e){for(var r=0;r<e;r++){for(var o=0;o<i;o++){var n=2*(o+r*i);console.log("(% 7.3f , % 7.3f) , ",t[n],t[n+1])}console.log("\\n")}console.log("\\n")},Lt._$2S=Math.PI/180,Lt._$bS=Math.PI/180,Lt._$wS=180/Math.PI,Lt._$NS=180/Math.PI,Lt.PI_F=Math.PI,Lt._$kT=[0,.012368,.024734,.037097,.049454,.061803,.074143,.086471,.098786,.111087,.12337,.135634,.147877,.160098,.172295,.184465,.196606,.208718,.220798,.232844,.244854,.256827,.268761,.280654,.292503,.304308,.316066,.327776,.339436,.351044,.362598,.374097,.385538,.396921,.408243,.419502,.430697,.441826,.452888,.463881,.474802,.485651,.496425,.507124,.517745,.528287,.538748,.549126,.559421,.56963,.579752,.589785,.599728,.609579,.619337,.629,.638567,.648036,.657406,.666676,.675843,.684908,.693867,.70272,.711466,.720103,.72863,.737045,.745348,.753536,.76161,.769566,.777405,.785125,.792725,.800204,.807561,.814793,.821901,.828884,.835739,.842467,.849066,.855535,.861873,.868079,.874153,.880093,.885898,.891567,.897101,.902497,.907754,.912873,.917853,.922692,.92739,.931946,.936359,.940629,.944755,.948737,.952574,.956265,.959809,.963207,.966457,.96956,.972514,.97532,.977976,.980482,.982839,.985045,.987101,.989006,.990759,.992361,.993811,.995109,.996254,.997248,.998088,.998776,.999312,.999694,.999924,1],Lt._$92=function(t,i){var e=Math.atan2(t[1],t[0]),r=Math.atan2(i[1],i[0]);return Lt._$tS(e,r)},Lt._$tS=function(t,i){for(var e=t-i;e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e},Lt._$9=function(t){return Math.sin(t)},Lt.fcos=function(t){return Math.cos(t)},Mt.prototype._$u2=function(){return this._$IS[0]},Mt.prototype._$yo=function(){return this._$AT&&!this._$IS[0]},Mt.prototype._$GT=function(){return this._$e0},Et._$W2=0,Et.SYSTEM_INFO=null,Et.USER_AGENT=navigator.userAgent,Et.isIPhone=function(){return Et.SYSTEM_INFO||Et.setup(),Et.SYSTEM_INFO._isIPhone},Et.isIOS=function(){return Et.SYSTEM_INFO||Et.setup(),Et.SYSTEM_INFO._isIPhone||Et.SYSTEM_INFO._isIPad},Et.isAndroid=function(){return Et.SYSTEM_INFO||Et.setup(),Et.SYSTEM_INFO._isAndroid},Et.getOSVersion=function(){return Et.SYSTEM_INFO||Et.setup(),Et.SYSTEM_INFO.version},Et.getOS=function(){return Et.SYSTEM_INFO||Et.setup(),Et.SYSTEM_INFO._isIPhone||Et.SYSTEM_INFO._isIPad?"iOS":Et.SYSTEM_INFO._isAndroid?"Android":"_$Q0 OS"},Et.setup=function(){function t(t,i){for(var e=t.substring(i).split(/[ _,;\\.]/),r=0,o=0;o<=2&&!isNaN(e[o]);o++){var n=parseInt(e[o]);if(n<0||n>999){_._$li("err : "+n+" @UtHtml5.setup()"),r=0;break}r+=n*Math.pow(1e3,2-o)}return r}var i,e=Et.USER_AGENT,r=Et.SYSTEM_INFO={userAgent:e};if((i=e.indexOf("iPhone OS "))>=0)r.os="iPhone",r._isIPhone=!0,r.version=t(e,i+"iPhone OS ".length);else if((i=e.indexOf("iPad"))>=0){if((i=e.indexOf("CPU OS"))<0)return void _._$li(" err : "+e+" @UtHtml5.setup()");r.os="iPad",r._isIPad=!0,r.version=t(e,i+"CPU OS ".length)}else(i=e.indexOf("Android"))>=0?(r.os="Android",r._isAndroid=!0,r.version=t(e,i+"Android ".length)):(r.os="-",r.version=-1)},window.UtSystem=w,window.UtDebug=_,window.LDTransform=gt,window.LDGL=nt,window.Live2D=at,window.Live2DModelWebGL=ft,window.Live2DModelJS=q,window.Live2DMotion=J,window.MotionQueueManager=ct,window.PhysicsHair=f,window.AMotion=s,window.PartsDataID=l,window.DrawDataID=b,window.BaseDataID=yt,window.ParamID=u,at.init();var At=!1}()}).call(i,e(7))},function(t,i){t.exports={import:function(){throw new Error("System.import cannot be used indirectly")}}},function(t,i,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(){this.models=[],this.count=-1,this.reloadFlg=!1,Live2D.init(),n.Live2DFramework.setPlatformManager(new _.default)}Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var n=e(0),s=e(9),_=r(s),a=e(10),h=r(a),l=e(1),$=r(l);o.prototype.createModel=function(){var t=new h.default;return this.models.push(t),t},o.prototype.changeModel=function(t,i){if(this.reloadFlg){this.reloadFlg=!1;this.releaseModel(0,t),this.createModel(),this.models[0].load(t,i)}},o.prototype.getModel=function(t){return t>=this.models.length?null:this.models[t]},o.prototype.releaseModel=function(t,i){this.models.length<=t||(this.models[t].release(i),delete this.models[t],this.models.splice(t,1))},o.prototype.numModels=function(){return this.models.length},o.prototype.setDrag=function(t,i){for(var e=0;e<this.models.length;e++)this.models[e].setDrag(t,i)},o.prototype.maxScaleEvent=function(){$.default.DEBUG_LOG&&console.log("Max scale event.");for(var t=0;t<this.models.length;t++)this.models[t].startRandomMotion($.default.MOTION_GROUP_PINCH_IN,$.default.PRIORITY_NORMAL)},o.prototype.minScaleEvent=function(){$.default.DEBUG_LOG&&console.log("Min scale event.");for(var t=0;t<this.models.length;t++)this.models[t].startRandomMotion($.default.MOTION_GROUP_PINCH_OUT,$.default.PRIORITY_NORMAL)},o.prototype.tapEvent=function(t,i){$.default.DEBUG_LOG&&console.log("tapEvent view x:"+t+" y:"+i);for(var e=0;e<this.models.length;e++)this.models[e].hitTest($.default.HIT_AREA_HEAD,t,i)?($.default.DEBUG_LOG&&console.log("Tap face."),this.models[e].setRandomExpression()):this.models[e].hitTest($.default.HIT_AREA_BODY,t,i)?($.default.DEBUG_LOG&&console.log("Tap body. models["+e+"]"),this.models[e].startRandomMotion($.default.MOTION_GROUP_TAP_BODY,$.default.PRIORITY_NORMAL)):this.models[e].hitTestCustom("head",t,i)?($.default.DEBUG_LOG&&console.log("Tap face."),this.models[e].startRandomMotion($.default.MOTION_GROUP_FLICK_HEAD,$.default.PRIORITY_NORMAL)):this.models[e].hitTestCustom("body",t,i)&&($.default.DEBUG_LOG&&console.log("Tap body. models["+e+"]"),this.models[e].startRandomMotion($.default.MOTION_GROUP_TAP_BODY,$.default.PRIORITY_NORMAL));return!0}},function(t,i,e){"use strict";function r(){}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;var o=e(2);r.prototype.loadBytes=function(t,i){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){switch(e.status){case 200:i(e.response);break;default:console.error("Failed to load ("+e.status+") : "+t)}},e.send(null)},r.prototype.loadString=function(t){this.loadBytes(t,function(t){return t})},r.prototype.loadLive2DModel=function(t,i){var e=null;this.loadBytes(t,function(t){e=Live2DModelWebGL.loadModel(t),i(e)})},r.prototype.loadTexture=function(t,i,e,r){var n=new Image;n.crossOrigin="Anonymous",n.src=e;n.onload=function(){var e=(0,o.getContext)(),s=e.createTexture();if(!s)return console.error("Failed to generate gl texture name."),-1;0==t.isPremultipliedAlpha()&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D),t.setTexture(i,s),s=null,"function"==typeof r&&r()},n.onerror=function(){console.error("Failed to load image : "+e)}},r.prototype.jsonParseFromBytes=function(t){var i,e=new Uint8Array(t,0,3);return i=239==e[0]&&187==e[1]&&191==e[2]?String.fromCharCode.apply(null,new Uint8Array(t,3)):String.fromCharCode.apply(null,new Uint8Array(t)),JSON.parse(i)},r.prototype.log=function(t){}},function(t,i,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(){n.L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[]}Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var n=e(0),s=e(11),_=r(s),a=e(1),h=r(a),l=e(3),$=r(l);o.prototype=new n.L2DBaseModel,o.prototype.load=function(t,i,e){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=i.substring(0,i.lastIndexOf("/")+1),this.modelSetting=new _.default;var r=this;this.modelSetting.loadModelSetting(i,function(){var t=r.modelHomeDir+r.modelSetting.getModelFile();r.loadModelData(t,function(t){for(var i=0;i<r.modelSetting.getTextureNum();i++){if(/^https?:\\/\\/|^\\/\\//i.test(r.modelSetting.getTextureFile(i)))var o=r.modelSetting.getTextureFile(i);else var o=r.modelHomeDir+r.modelSetting.getTextureFile(i);r.loadTexture(i,o,function(){if(r.isTexLoaded){if(r.modelSetting.getExpressionNum()>0){r.expressions={};for(var t=0;t<r.modelSetting.getExpressionNum();t++){var i=r.modelSetting.getExpressionName(t),o=r.modelHomeDir+r.modelSetting.getExpressionFile(t);r.loadExpression(i,o)}}else r.expressionManager=null,r.expressions={};if(r.eyeBlink,null!=r.modelSetting.getPhysicsFile()?r.loadPhysics(r.modelHomeDir+r.modelSetting.getPhysicsFile()):r.physics=null,null!=r.modelSetting.getPoseFile()?r.loadPose(r.modelHomeDir+r.modelSetting.getPoseFile(),function(){r.pose.updateParam(r.live2DModel)}):r.pose=null,null!=r.modelSetting.getLayout()){var n=r.modelSetting.getLayout();null!=n.width&&r.modelMatrix.setWidth(n.width),null!=n.height&&r.modelMatrix.setHeight(n.height),null!=n.x&&r.modelMatrix.setX(n.x),null!=n.y&&r.modelMatrix.setY(n.y),null!=n.center_x&&r.modelMatrix.centerX(n.center_x),null!=n.center_y&&r.modelMatrix.centerY(n.center_y),null!=n.top&&r.modelMatrix.top(n.top),null!=n.bottom&&r.modelMatrix.bottom(n.bottom),null!=n.left&&r.modelMatrix.left(n.left),null!=n.right&&r.modelMatrix.right(n.right)}if(null!=r.modelSetting.getHitAreasCustom()){var s=r.modelSetting.getHitAreasCustom();null!=s.head_x&&(h.default.hit_areas_custom_head_x=s.head_x),null!=s.head_y&&(h.default.hit_areas_custom_head_y=s.head_y),null!=s.body_x&&(h.default.hit_areas_custom_body_x=s.body_x),null!=s.body_y&&(h.default.hit_areas_custom_body_y=s.body_y)}for(var t=0;t<r.modelSetting.getInitParamNum();t++)r.live2DModel.setParamFloat(r.modelSetting.getInitParamID(t),r.modelSetting.getInitParamValue(t));for(var t=0;t<r.modelSetting.getInitPartsVisibleNum();t++)r.live2DModel.setPartsOpacity(r.modelSetting.getInitPartsVisibleID(t),r.modelSetting.getInitPartsVisibleValue(t));r.live2DModel.saveParam(),r.preloadMotionGroup(h.default.MOTION_GROUP_IDLE),r.preloadMotionGroup(h.default.MOTION_GROUP_SLEEPY),r.mainMotionManager.stopAllMotions(),r.setUpdating(!1),r.setInitialized(!0),"function"==typeof e&&e()}})}})})},o.prototype.release=function(t){var i=n.Live2DFramework.getPlatformManager();t.deleteTexture(i.texture)},o.prototype.preloadMotionGroup=function(t){for(var i=this,e=0;e<this.modelSetting.getMotionNum(t);e++){var r=this.modelSetting.getMotionFile(t,e);this.loadMotion(r,this.modelHomeDir+r,function(r){r.setFadeIn(i.modelSetting.getMotionFadeIn(t,e)),r.setFadeOut(i.modelSetting.getMotionFadeOut(t,e))})}},o.prototype.update=function(){if(null==this.live2DModel)return void(h.default.DEBUG_LOG&&console.error("Failed to update."));var t=UtSystem.getUserTimeMSec()-this.startTimeMSec,i=t/1e3,e=2*i*Math.PI;if(this.mainMotionManager.isFinished()){"1"===sessionStorage.getItem("Sleepy")?this.startRandomMotion(h.default.MOTION_GROUP_SLEEPY,h.default.PRIORITY_SLEEPY):this.startRandomMotion(h.default.MOTION_GROUP_IDLE,h.default.PRIORITY_IDLE)}this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(e/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(e/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(e/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(e/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(e/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),null==this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()},o.prototype.setRandomExpression=function(){var t=[];for(var i in this.expressions)t.push(i);var e=parseInt(Math.random()*t.length);this.setExpression(t[e])},o.prototype.startRandomMotion=function(t,i){var e=this.modelSetting.getMotionNum(t),r=parseInt(Math.random()*e);this.startMotion(t,r,i)},o.prototype.startMotion=function(t,i,e){var r=this.modelSetting.getMotionFile(t,i);if(null==r||""==r)return void(h.default.DEBUG_LOG&&console.error("Failed to motion."));if(e==h.default.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(e);else if(!this.mainMotionManager.reserveMotion(e))return void(h.default.DEBUG_LOG&&console.log("Motion is running."));var o,n=this;null==this.motions[t]?this.loadMotion(null,this.modelHomeDir+r,function(r){o=r,n.setFadeInFadeOut(t,i,e,o)}):(o=this.motions[t],n.setFadeInFadeOut(t,i,e,o))},o.prototype.setFadeInFadeOut=function(t,i,e,r){var o=this.modelSetting.getMotionFile(t,i);if(r.setFadeIn(this.modelSetting.getMotionFadeIn(t,i)),r.setFadeOut(this.modelSetting.getMotionFadeOut(t,i)),h.default.DEBUG_LOG&&console.log("Start motion : "+o),null==this.modelSetting.getMotionSound(t,i))this.mainMotionManager.startMotionPrio(r,e);else{var n=this.modelSetting.getMotionSound(t,i),s=document.createElement("audio");s.src=this.modelHomeDir+n,h.default.DEBUG_LOG&&console.log("Start sound : "+n),s.play(),this.mainMotionManager.startMotionPrio(r,e)}},o.prototype.setExpression=function(t){var i=this.expressions[t];h.default.DEBUG_LOG&&console.log("Expression : "+t),this.expressionManager.startMotion(i,!1)},o.prototype.draw=function(t){$.default.push(),$.default.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=$.default.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),$.default.pop()},o.prototype.hitTest=function(t,i,e){for(var r=this.modelSetting.getHitAreaNum(),o=0;o<r;o++)if(t==this.modelSetting.getHitAreaName(o)){var n=this.modelSetting.getHitAreaID(o);return this.hitTestSimple(n,i,e)}return!1},o.prototype.hitTestCustom=function(t,i,e){return"head"==t?this.hitTestSimpleCustom(h.default.hit_areas_custom_head_x,h.default.hit_areas_custom_head_y,i,e):"body"==t&&this.hitTestSimpleCustom(h.default.hit_areas_custom_body_x,h.default.hit_areas_custom_body_y,i,e)}},function(t,i,e){"use strict";function r(){this.NAME="name",this.ID="id",this.MODEL="model",this.TEXTURES="textures",this.HIT_AREAS="hit_areas",this.PHYSICS="physics",this.POSE="pose",this.EXPRESSIONS="expressions",this.MOTION_GROUPS="motions",this.SOUND="sound",this.FADE_IN="fade_in",this.FADE_OUT="fade_out",this.LAYOUT="layout",this.HIT_AREAS_CUSTOM="hit_areas_custom",this.INIT_PARAM="init_param",this.INIT_PARTS_VISIBLE="init_parts_visible",this.VALUE="val",this.FILE="file",this.json={}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;var o=e(0);r.prototype.loadModelSetting=function(t,i){var e=this;o.Live2DFramework.getPlatformManager().loadBytes(t,function(t){var r=String.fromCharCode.apply(null,new Uint8Array(t));e.json=JSON.parse(r),i()})},r.prototype.getTextureFile=function(t){return null==this.json[this.TEXTURES]||null==this.json[this.TEXTURES][t]?null:this.json[this.TEXTURES][t]},r.prototype.getModelFile=function(){return this.json[this.MODEL]},r.prototype.getTextureNum=function(){return null==this.json[this.TEXTURES]?0:this.json[this.TEXTURES].length},r.prototype.getHitAreaNum=function(){return null==this.json[this.HIT_AREAS]?0:this.json[this.HIT_AREAS].length},r.prototype.getHitAreaID=function(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.ID]},r.prototype.getHitAreaName=function(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.NAME]},r.prototype.getPhysicsFile=function(){return this.json[this.PHYSICS]},r.prototype.getPoseFile=function(){return this.json[this.POSE]},r.prototype.getExpressionNum=function(){return null==this.json[this.EXPRESSIONS]?0:this.json[this.EXPRESSIONS].length},r.prototype.getExpressionFile=function(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.FILE]},r.prototype.getExpressionName=function(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.NAME]},r.prototype.getLayout=function(){return this.json[this.LAYOUT]},r.prototype.getHitAreasCustom=function(){return this.json[this.HIT_AREAS_CUSTOM]},r.prototype.getInitParamNum=function(){return null==this.json[this.INIT_PARAM]?0:this.json[this.INIT_PARAM].length},r.prototype.getMotionNum=function(t){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]?0:this.json[this.MOTION_GROUPS][t].length},r.prototype.getMotionFile=function(t,i){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][i]?null:this.json[this.MOTION_GROUPS][t][i][this.FILE]},r.prototype.getMotionSound=function(t,i){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][i]||null==this.json[this.MOTION_GROUPS][t][i][this.SOUND]?null:this.json[this.MOTION_GROUPS][t][i][this.SOUND]},r.prototype.getMotionFadeIn=function(t,i){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][i]||null==this.json[this.MOTION_GROUPS][t][i][this.FADE_IN]?1e3:this.json[this.MOTION_GROUPS][t][i][this.FADE_IN]},r.prototype.getMotionFadeOut=function(t,i){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][i]||null==this.json[this.MOTION_GROUPS][t][i][this.FADE_OUT]?1e3:this.json[this.MOTION_GROUPS][t][i][this.FADE_OUT]},r.prototype.getInitParamID=function(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?null:this.json[this.INIT_PARAM][t][this.ID]},r.prototype.getInitParamValue=function(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?NaN:this.json[this.INIT_PARAM][t][this.VALUE]},r.prototype.getInitPartsVisibleNum=function(){return null==this.json[this.INIT_PARTS_VISIBLE]?0:this.json[this.INIT_PARTS_VISIBLE].length},r.prototype.getInitPartsVisibleID=function(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?null:this.json[this.INIT_PARTS_VISIBLE][t][this.ID]},r.prototype.getInitPartsVisibleValue=function(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?NaN:this.json[this.INIT_PARTS_VISIBLE][t][this.VALUE]}}]);\n',document.body.appendChild(n)}var n=new XMLHttpRequest;n.open("get",this.model[this.currentTheme]),n.send(),n.onreadystatechange=function(){200!==n.status&&(console.log("CDN"),document.querySelector(".kanbanniang").style.display="none")},window.loadlive2d("banniang",this.model[this.currentTheme])}}},St=(t(283),Object(Ue.a)(xt,(function(){var n=this,e=n._self._c;return e("div",{staticClass:"kanbanniang"},[e("div",{directives:[{name:"show",rawName:"v-show",value:n.isLoaded,expression:"isLoaded"}],staticClass:"banniang-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:n.isShowMessageBox,expression:"isShowMessageBox"}],staticClass:"messageBox",style:n.messageStyle},[n._v("\n      "+n._s(n.messages.message||" "+n.$site.title)+"\n    ")]),n._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!n.isShowBtns,expression:"!isShowBtns"}],staticClass:"operation",style:n.btnStyle,on:{mouseenter:function(e){n.isShowMessageBox=!0},mouseleave:function(e){n.isShowMessageBox=!1}}},[e("i",{staticClass:"kbnfont kbn-ban-home ban-home",on:{click:n.goHome,mouseenter:n.hoverGoHome,mouseleave:n.resetMessage}}),n._v(" "),e("i",{staticClass:"kbnfont kbn-ban-message message"}),n._v(" "),e("i",{staticClass:"kbnfont kbn-ban-close close",on:{click:n.closeBanNiang,mouseenter:n.hoverCloseBanNiang,mouseleave:n.resetMessage}}),n._v(" "),e("a",{attrs:{target:"_blank",href:"https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html"}},[e("i",{staticClass:"kbnfont kbn-ban-info info",on:{mouseenter:n.hoverMoreInfo,mouseleave:n.resetMessage}})]),n._v(" "),e("i",{directives:[{name:"show",rawName:"v-show",value:n.myTheme.length>1,expression:"myTheme.length > 1"}],staticClass:"kbnfont kbn-ban-theme skin",on:{click:n.changeTheme,mouseenter:n.hoverChangeTheme,mouseleave:n.resetMessage}})]),n._v(" "),e("canvas",{staticClass:"live2d",style:n.modelStyle,attrs:{id:"banniang",width:n.style.width,height:n.style.height}})]),n._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:n.displayBanNiang,expression:"displayBanNiang"}],staticClass:"showBanNiang",on:{click:n.showBanNiang}},[n._v("\n    \n  ")])])}),[],!1,null,"5775ee02",null).exports),_t={name:"Valine",props:{options:{type:Object,default:()=>({})}},mounted:function(){this.initValine()},methods:{initValine(){new(t(284))({el:"#valine",placeholder:"just go go",notify:!1,verify:!1,avatar:"retro",visitor:!0,recordIP:!1,path:window.location.pathname,...this.options})}},watch:{$route(n,e){n.path!==e.path&&setTimeout(()=>{this.initValine()},300)}}},jt=(t(285),Object(Ue.a)(_t,(function(){this._self._c;return this._m(0)}),[function(){var n=this._self._c;return n("div",{staticClass:"valine-wrapper"},[n("div",{attrs:{id:"valine"}})])}],!1,null,null,null).exports),Tt=t(6);function Ct(n){return Object(Tt.a)((function(e,t){void 0===e.inject&&(e.inject={}),Array.isArray(e.inject)||(e.inject[t]=n||t)}))}function At(n){var e=function(){var t=this,a="function"==typeof n?n.call(this):n;for(var r in(a=Object.create(a||null)).__reactiveInject__=this.__reactiveInject__||{},e.managed)a[e.managed[r]]=this[r];var i=function(n){a[e.managedReactive[n]]=o[n],Object.defineProperty(a.__reactiveInject__,e.managedReactive[n],{enumerable:!0,get:function(){return t[n]}})},o=this;for(var r in e.managedReactive)i(r);return a};return e.managed={},e.managedReactive={},e}function It(n){return"function"!=typeof n||!n.managed&&!n.managedReactive}var Et="undefined"!=typeof Reflect&&void 0!==Reflect.getMetadata;function Ot(n,e,t){if(Et&&!Array.isArray(n)&&"function"!=typeof n&&void 0===n.type){var a=Reflect.getMetadata("design:type",e,t);a!==Object&&(n.type=a)}}function Lt(n){return void 0===n&&(n={}),function(e,t){Ot(n,e,t),Object(Tt.a)((function(e,t){(e.props||(e.props={}))[t]=n}))(e,t)}}function $t(n,e){void 0===e&&(e={});var t=e.deep,a=void 0!==t&&t,r=e.immediate,i=void 0!==r&&r;return Object(Tt.a)((function(e,t){"object"!=typeof e.watch&&(e.watch=Object.create(null));var r=e.watch;"object"!=typeof r[n]||Array.isArray(r[n])?void 0===r[n]&&(r[n]=[]):r[n]=[r[n]],r[n].push({handler:t,deep:a,immediate:i})}))}var Pt=t(20);const zt=n=>Object(Pt.stringify)(n),Dt=(n,e)=>`${n}${Object(Pt.stringify)(e,{addQueryPrefix:!0})}`,Mt=(n,e)=>`${n.replace(/\/$/,"")}/${e.replace(/^\//,"")}`;var Ft=t(131),Rt=t.n(Ft);const qt=n=>Rt()(n,"YYYY-MM-DD HH:mm:ss"),Nt=n=>(n.split("#")[0]||"").split("?")[0]||"",Bt=n=>Object(Pt.parse)(n,{ignoreQueryPrefix:!0})
/*!
 * vue-i18n v8.28.2 
 * (c) 2022 kazuya kawaguchi
 * Released under the MIT License.
 */;var Ut=["compactDisplay","currency","currencyDisplay","currencySign","localeMatcher","notation","numberingSystem","signDisplay","style","unit","unitDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"],Jt=["dateStyle","timeStyle","calendar","localeMatcher","hour12","hourCycle","timeZone","formatMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function Vt(n,e){"undefined"!=typeof console&&(console.warn("[vue-i18n] "+n),e&&console.warn(e.stack))}var Wt=Array.isArray;function Ht(n){return null!==n&&"object"==typeof n}function Qt(n){return"string"==typeof n}var Gt=Object.prototype.toString;function Kt(n){return"[object Object]"===Gt.call(n)}function Yt(n){return null==n}function Xt(n){return"function"==typeof n}function Zt(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];var t=null,a=null;return 1===n.length?Ht(n[0])||Wt(n[0])?a=n[0]:"string"==typeof n[0]&&(t=n[0]):2===n.length&&("string"==typeof n[0]&&(t=n[0]),(Ht(n[1])||Wt(n[1]))&&(a=n[1])),{locale:t,params:a}}function na(n){return JSON.parse(JSON.stringify(n))}function ea(n,e){return!!~n.indexOf(e)}var ta=Object.prototype.hasOwnProperty;function aa(n,e){return ta.call(n,e)}function ra(n){for(var e=arguments,t=Object(n),a=1;a<arguments.length;a++){var r=e[a];if(null!=r){var i=void 0;for(i in r)aa(r,i)&&(Ht(r[i])?t[i]=ra(t[i],r[i]):t[i]=r[i])}}return t}function ia(n,e){if(n===e)return!0;var t=Ht(n),a=Ht(e);if(!t||!a)return!t&&!a&&String(n)===String(e);try{var r=Wt(n),i=Wt(e);if(r&&i)return n.length===e.length&&n.every((function(n,t){return ia(n,e[t])}));if(r||i)return!1;var o=Object.keys(n),s=Object.keys(e);return o.length===s.length&&o.every((function(t){return ia(n[t],e[t])}))}catch(n){return!1}}function oa(n){return null!=n&&Object.keys(n).forEach((function(e){"string"==typeof n[e]&&(n[e]=n[e].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"))})),n}var sa={name:"i18n",functional:!0,props:{tag:{type:[String,Boolean,Object],default:"span"},path:{type:String,required:!0},locale:{type:String},places:{type:[Array,Object]}},render:function(n,e){var t=e.data,a=e.parent,r=e.props,i=e.slots,o=a.$i18n;if(o){var s=r.path,l=r.locale,c=r.places,u=i(),d=o.i(s,l,function(n){var e;for(e in n)if("default"!==e)return!1;return Boolean(e)}(u)||c?function(n,e){var t=e?function(n){0;return Array.isArray(n)?n.reduce(ca,{}):Object.assign({},n)}(e):{};if(!n)return t;var a=(n=n.filter((function(n){return n.tag||""!==n.text.trim()}))).every(ua);0;return n.reduce(a?la:ca,t)}(u.default,c):u),p=r.tag&&!0!==r.tag||!1===r.tag?r.tag:"span";return p?n(p,t,d):d}}};function la(n,e){return e.data&&e.data.attrs&&e.data.attrs.place&&(n[e.data.attrs.place]=e),n}function ca(n,e,t){return n[t]=e,n}function ua(n){return Boolean(n.data&&n.data.attrs&&n.data.attrs.place)}var da,pa={name:"i18n-n",functional:!0,props:{tag:{type:[String,Boolean,Object],default:"span"},value:{type:Number,required:!0},format:{type:[String,Object]},locale:{type:String}},render:function(n,e){var t=e.props,a=e.parent,r=e.data,i=a.$i18n;if(!i)return null;var o=null,s=null;Qt(t.format)?o=t.format:Ht(t.format)&&(t.format.key&&(o=t.format.key),s=Object.keys(t.format).reduce((function(n,e){var a;return ea(Ut,e)?Object.assign({},n,((a={})[e]=t.format[e],a)):n}),null));var l=t.locale||i.locale,c=i._ntp(t.value,l,o,s),u=c.map((function(n,e){var t,a=r.scopedSlots&&r.scopedSlots[n.type];return a?a(((t={})[n.type]=n.value,t.index=e,t.parts=c,t)):n.value})),d=t.tag&&!0!==t.tag||!1===t.tag?t.tag:"span";return d?n(d,{attrs:r.attrs,class:r.class,staticClass:r.staticClass},u):u}};function ha(n,e,t){ga(n,t)&&va(n,e,t)}function fa(n,e,t,a){if(ga(n,t)){var r=t.context.$i18n;(function(n,e){var t=e.context;return n._locale===t.$i18n.locale})(n,t)&&ia(e.value,e.oldValue)&&ia(n._localeMessage,r.getLocaleMessage(r.locale))||va(n,e,t)}}function ma(n,e,t,a){if(t.context){var r=t.context.$i18n||{};e.modifiers.preserve||r.preserveDirectiveContent||(n.textContent=""),n._vt=void 0,delete n._vt,n._locale=void 0,delete n._locale,n._localeMessage=void 0,delete n._localeMessage}else Vt("Vue instance does not exists in VNode context")}function ga(n,e){var t=e.context;return t?!!t.$i18n||(Vt("VueI18n instance does not exists in Vue instance"),!1):(Vt("Vue instance does not exists in VNode context"),!1)}function va(n,e,t){var a,r,i=function(n){var e,t,a,r;Qt(n)?e=n:Kt(n)&&(e=n.path,t=n.locale,a=n.args,r=n.choice);return{path:e,locale:t,args:a,choice:r}}(e.value),o=i.path,s=i.locale,l=i.args,c=i.choice;if(o||s||l)if(o){var u=t.context;n._vt=n.textContent=null!=c?(a=u.$i18n).tc.apply(a,[o,c].concat(ya(s,l))):(r=u.$i18n).t.apply(r,[o].concat(ya(s,l))),n._locale=u.$i18n.locale,n._localeMessage=u.$i18n.getLocaleMessage(u.$i18n.locale)}else Vt("`path` is required in v-t directive");else Vt("value type not supported")}function ya(n,e){var t=[];return n&&t.push(n),e&&(Array.isArray(e)||Kt(e))&&t.push(e),t}function ba(n,e){void 0===e&&(e={bridge:!1}),ba.installed=!0;var t;(da=n).version&&Number(da.version.split(".")[0]);(t=da).prototype.hasOwnProperty("$i18n")||Object.defineProperty(t.prototype,"$i18n",{get:function(){return this._i18n}}),t.prototype.$t=function(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var a=this.$i18n;return a._t.apply(a,[n,a.locale,a._getMessages(),this].concat(e))},t.prototype.$tc=function(n,e){for(var t=[],a=arguments.length-2;a-- >0;)t[a]=arguments[a+2];var r=this.$i18n;return r._tc.apply(r,[n,r.locale,r._getMessages(),this,e].concat(t))},t.prototype.$te=function(n,e){var t=this.$i18n;return t._te(n,t.locale,t._getMessages(),e)},t.prototype.$d=function(n){for(var e,t=[],a=arguments.length-1;a-- >0;)t[a]=arguments[a+1];return(e=this.$i18n).d.apply(e,[n].concat(t))},t.prototype.$n=function(n){for(var e,t=[],a=arguments.length-1;a-- >0;)t[a]=arguments[a+1];return(e=this.$i18n).n.apply(e,[n].concat(t))},da.mixin(function(n){function e(){this!==this.$root&&this.$options.__INTLIFY_META__&&this.$el&&this.$el.setAttribute("data-intlify",this.$options.__INTLIFY_META__)}return void 0===n&&(n=!1),n?{mounted:e}:{beforeCreate:function(){var n=this.$options;if(n.i18n=n.i18n||(n.__i18nBridge||n.__i18n?{}:null),n.i18n)if(n.i18n instanceof za){if(n.__i18nBridge||n.__i18n)try{var e=n.i18n&&n.i18n.messages?n.i18n.messages:{};(n.__i18nBridge||n.__i18n).forEach((function(n){e=ra(e,JSON.parse(n))})),Object.keys(e).forEach((function(t){n.i18n.mergeLocaleMessage(t,e[t])}))}catch(n){0}this._i18n=n.i18n,this._i18nWatcher=this._i18n.watchI18nData()}else if(Kt(n.i18n)){var t=this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof za?this.$root.$i18n:null;if(t&&(n.i18n.root=this.$root,n.i18n.formatter=t.formatter,n.i18n.fallbackLocale=t.fallbackLocale,n.i18n.formatFallbackMessages=t.formatFallbackMessages,n.i18n.silentTranslationWarn=t.silentTranslationWarn,n.i18n.silentFallbackWarn=t.silentFallbackWarn,n.i18n.pluralizationRules=t.pluralizationRules,n.i18n.preserveDirectiveContent=t.preserveDirectiveContent),n.__i18nBridge||n.__i18n)try{var a=n.i18n&&n.i18n.messages?n.i18n.messages:{};(n.__i18nBridge||n.__i18n).forEach((function(n){a=ra(a,JSON.parse(n))})),n.i18n.messages=a}catch(n){0}var r=n.i18n.sharedMessages;r&&Kt(r)&&(n.i18n.messages=ra(n.i18n.messages,r)),this._i18n=new za(n.i18n),this._i18nWatcher=this._i18n.watchI18nData(),(void 0===n.i18n.sync||n.i18n.sync)&&(this._localeWatcher=this.$i18n.watchLocale()),t&&t.onComponentInstanceCreated(this._i18n)}else 0;else this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof za?this._i18n=this.$root.$i18n:n.parent&&n.parent.$i18n&&n.parent.$i18n instanceof za&&(this._i18n=n.parent.$i18n)},beforeMount:function(){var n=this.$options;n.i18n=n.i18n||(n.__i18nBridge||n.__i18n?{}:null),n.i18n?(n.i18n instanceof za||Kt(n.i18n))&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0):(this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof za||n.parent&&n.parent.$i18n&&n.parent.$i18n instanceof za)&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0)},mounted:e,beforeDestroy:function(){if(this._i18n){var n=this;this.$nextTick((function(){n._subscribing&&(n._i18n.unsubscribeDataChanging(n),delete n._subscribing),n._i18nWatcher&&(n._i18nWatcher(),n._i18n.destroyVM(),delete n._i18nWatcher),n._localeWatcher&&(n._localeWatcher(),delete n._localeWatcher)}))}}}}(e.bridge)),da.directive("t",{bind:ha,update:fa,unbind:ma}),da.component(sa.name,sa),da.component(pa.name,pa),da.config.optionMergeStrategies.i18n=function(n,e){return void 0===e?n:e}}var ka=function(){this._caches=Object.create(null)};ka.prototype.interpolate=function(n,e){if(!e)return[n];var t=this._caches[n];return t||(t=function(n){var e=[],t=0,a="";for(;t<n.length;){var r=n[t++];if("{"===r){a&&e.push({type:"text",value:a}),a="";var i="";for(r=n[t++];void 0!==r&&"}"!==r;)i+=r,r=n[t++];var o="}"===r,s=wa.test(i)?"list":o&&xa.test(i)?"named":"unknown";e.push({value:i,type:s})}else"%"===r?"{"!==n[t]&&(a+=r):a+=r}return a&&e.push({type:"text",value:a}),e}(n),this._caches[n]=t),function(n,e){var t=[],a=0,r=Array.isArray(e)?"list":Ht(e)?"named":"unknown";if("unknown"===r)return t;for(;a<n.length;){var i=n[a];switch(i.type){case"text":t.push(i.value);break;case"list":t.push(e[parseInt(i.value,10)]);break;case"named":"named"===r&&t.push(e[i.value]);break;case"unknown":0}a++}return t}(t,e)};var wa=/^(?:\d)+/,xa=/^(?:\w)+/;var Sa=[];Sa[0]={ws:[0],ident:[3,0],"[":[4],eof:[7]},Sa[1]={ws:[1],".":[2],"[":[4],eof:[7]},Sa[2]={ws:[2],ident:[3,0],0:[3,0],number:[3,0]},Sa[3]={ident:[3,0],0:[3,0],number:[3,0],ws:[1,1],".":[2,1],"[":[4,1],eof:[7,1]},Sa[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],eof:8,else:[4,0]},Sa[5]={"'":[4,0],eof:8,else:[5,0]},Sa[6]={'"':[4,0],eof:8,else:[6,0]};var _a=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function ja(n){if(null==n)return"eof";switch(n.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return n;case 95:case 36:case 45:return"ident";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return"ident"}function Ta(n){var e,t,a,r=n.trim();return("0"!==n.charAt(0)||!isNaN(n))&&(a=r,_a.test(a)?(t=(e=r).charCodeAt(0))!==e.charCodeAt(e.length-1)||34!==t&&39!==t?e:e.slice(1,-1):"*"+r)}var Ca=function(){this._cache=Object.create(null)};Ca.prototype.parsePath=function(n){var e=this._cache[n];return e||(e=function(n){var e,t,a,r,i,o,s,l=[],c=-1,u=0,d=0,p=[];function h(){var e=n[c+1];if(5===u&&"'"===e||6===u&&'"'===e)return c++,a="\\"+e,p[0](),!0}for(p[1]=function(){void 0!==t&&(l.push(t),t=void 0)},p[0]=function(){void 0===t?t=a:t+=a},p[2]=function(){p[0](),d++},p[3]=function(){if(d>0)d--,u=4,p[0]();else{if(d=0,void 0===t)return!1;if(!1===(t=Ta(t)))return!1;p[1]()}};null!==u;)if(c++,"\\"!==(e=n[c])||!h()){if(r=ja(e),8===(i=(s=Sa[u])[r]||s.else||8))return;if(u=i[0],(o=p[i[1]])&&(a=void 0===(a=i[2])?e:a,!1===o()))return;if(7===u)return l}}(n))&&(this._cache[n]=e),e||[]},Ca.prototype.getPathValue=function(n,e){if(!Ht(n))return null;var t=this.parsePath(e);if(0===t.length)return null;for(var a=t.length,r=n,i=0;i<a;){var o=r[t[i]];if(null==o)return null;r=o,i++}return r};var Aa,Ia=/<\/?[\w\s="/.':;#-\/]+>/,Ea=/(?:@(?:\.[a-zA-Z]+)?:(?:[\w\-_|./]+|\([\w\-_:|./]+\)))/g,Oa=/^@(?:\.([a-zA-Z]+))?:/,La=/[()]/g,$a={upper:function(n){return n.toLocaleUpperCase()},lower:function(n){return n.toLocaleLowerCase()},capitalize:function(n){return""+n.charAt(0).toLocaleUpperCase()+n.substr(1)}},Pa=new ka,za=function(n){var e=this;void 0===n&&(n={}),!da&&"undefined"!=typeof window&&window.Vue&&ba(window.Vue);var t=n.locale||"en-US",a=!1!==n.fallbackLocale&&(n.fallbackLocale||"en-US"),r=n.messages||{},i=n.dateTimeFormats||n.datetimeFormats||{},o=n.numberFormats||{};this._vm=null,this._formatter=n.formatter||Pa,this._modifiers=n.modifiers||{},this._missing=n.missing||null,this._root=n.root||null,this._sync=void 0===n.sync||!!n.sync,this._fallbackRoot=void 0===n.fallbackRoot||!!n.fallbackRoot,this._fallbackRootWithEmptyString=void 0===n.fallbackRootWithEmptyString||!!n.fallbackRootWithEmptyString,this._formatFallbackMessages=void 0!==n.formatFallbackMessages&&!!n.formatFallbackMessages,this._silentTranslationWarn=void 0!==n.silentTranslationWarn&&n.silentTranslationWarn,this._silentFallbackWarn=void 0!==n.silentFallbackWarn&&!!n.silentFallbackWarn,this._dateTimeFormatters={},this._numberFormatters={},this._path=new Ca,this._dataListeners=new Set,this._componentInstanceCreatedListener=n.componentInstanceCreatedListener||null,this._preserveDirectiveContent=void 0!==n.preserveDirectiveContent&&!!n.preserveDirectiveContent,this.pluralizationRules=n.pluralizationRules||{},this._warnHtmlInMessage=n.warnHtmlInMessage||"off",this._postTranslation=n.postTranslation||null,this._escapeParameterHtml=n.escapeParameterHtml||!1,"__VUE_I18N_BRIDGE__"in n&&(this.__VUE_I18N_BRIDGE__=n.__VUE_I18N_BRIDGE__),this.getChoiceIndex=function(n,t){var a=Object.getPrototypeOf(e);if(a&&a.getChoiceIndex)return a.getChoiceIndex.call(e,n,t);var r,i;return e.locale in e.pluralizationRules?e.pluralizationRules[e.locale].apply(e,[n,t]):(r=n,i=t,r=Math.abs(r),2===i?r?r>1?1:0:1:r?Math.min(r,2):0)},this._exist=function(n,t){return!(!n||!t)&&(!Yt(e._path.getPathValue(n,t))||!!n[t])},"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||Object.keys(r).forEach((function(n){e._checkLocaleMessage(n,e._warnHtmlInMessage,r[n])})),this._initVM({locale:t,fallbackLocale:a,messages:r,dateTimeFormats:i,numberFormats:o})},Da={vm:{configurable:!0},messages:{configurable:!0},dateTimeFormats:{configurable:!0},numberFormats:{configurable:!0},availableLocales:{configurable:!0},locale:{configurable:!0},fallbackLocale:{configurable:!0},formatFallbackMessages:{configurable:!0},missing:{configurable:!0},formatter:{configurable:!0},silentTranslationWarn:{configurable:!0},silentFallbackWarn:{configurable:!0},preserveDirectiveContent:{configurable:!0},warnHtmlInMessage:{configurable:!0},postTranslation:{configurable:!0},sync:{configurable:!0}};za.prototype._checkLocaleMessage=function(n,e,t){var a=function(n,e,t,r){if(Kt(t))Object.keys(t).forEach((function(i){var o=t[i];Kt(o)?(r.push(i),r.push("."),a(n,e,o,r),r.pop(),r.pop()):(r.push(i),a(n,e,o,r),r.pop())}));else if(Wt(t))t.forEach((function(t,i){Kt(t)?(r.push("["+i+"]"),r.push("."),a(n,e,t,r),r.pop(),r.pop()):(r.push("["+i+"]"),a(n,e,t,r),r.pop())}));else if(Qt(t)){if(Ia.test(t)){var i="Detected HTML in message '"+t+"' of keypath '"+r.join("")+"' at '"+e+"'. Consider component interpolation with '<i18n>' to avoid XSS. See https://bit.ly/2ZqJzkp";"warn"===n?Vt(i):"error"===n&&function(n,e){"undefined"!=typeof console&&(console.error("[vue-i18n] "+n),e&&console.error(e.stack))}(i)}}};a(e,n,t,[])},za.prototype._initVM=function(n){var e=da.config.silent;da.config.silent=!0,this._vm=new da({data:n,__VUE18N__INSTANCE__:!0}),da.config.silent=e},za.prototype.destroyVM=function(){this._vm.$destroy()},za.prototype.subscribeDataChanging=function(n){this._dataListeners.add(n)},za.prototype.unsubscribeDataChanging=function(n){!function(n,e){if(n.delete(e));}(this._dataListeners,n)},za.prototype.watchI18nData=function(){var n=this;return this._vm.$watch("$data",(function(){for(var e,t,a=(e=n._dataListeners,t=[],e.forEach((function(n){return t.push(n)})),t),r=a.length;r--;)da.nextTick((function(){a[r]&&a[r].$forceUpdate()}))}),{deep:!0})},za.prototype.watchLocale=function(n){if(n){if(!this.__VUE_I18N_BRIDGE__)return null;var e=this,t=this._vm;return this.vm.$watch("locale",(function(a){t.$set(t,"locale",a),e.__VUE_I18N_BRIDGE__&&n&&(n.locale.value=a),t.$forceUpdate()}),{immediate:!0})}if(!this._sync||!this._root)return null;var a=this._vm;return this._root.$i18n.vm.$watch("locale",(function(n){a.$set(a,"locale",n),a.$forceUpdate()}),{immediate:!0})},za.prototype.onComponentInstanceCreated=function(n){this._componentInstanceCreatedListener&&this._componentInstanceCreatedListener(n,this)},Da.vm.get=function(){return this._vm},Da.messages.get=function(){return na(this._getMessages())},Da.dateTimeFormats.get=function(){return na(this._getDateTimeFormats())},Da.numberFormats.get=function(){return na(this._getNumberFormats())},Da.availableLocales.get=function(){return Object.keys(this.messages).sort()},Da.locale.get=function(){return this._vm.locale},Da.locale.set=function(n){this._vm.$set(this._vm,"locale",n)},Da.fallbackLocale.get=function(){return this._vm.fallbackLocale},Da.fallbackLocale.set=function(n){this._localeChainCache={},this._vm.$set(this._vm,"fallbackLocale",n)},Da.formatFallbackMessages.get=function(){return this._formatFallbackMessages},Da.formatFallbackMessages.set=function(n){this._formatFallbackMessages=n},Da.missing.get=function(){return this._missing},Da.missing.set=function(n){this._missing=n},Da.formatter.get=function(){return this._formatter},Da.formatter.set=function(n){this._formatter=n},Da.silentTranslationWarn.get=function(){return this._silentTranslationWarn},Da.silentTranslationWarn.set=function(n){this._silentTranslationWarn=n},Da.silentFallbackWarn.get=function(){return this._silentFallbackWarn},Da.silentFallbackWarn.set=function(n){this._silentFallbackWarn=n},Da.preserveDirectiveContent.get=function(){return this._preserveDirectiveContent},Da.preserveDirectiveContent.set=function(n){this._preserveDirectiveContent=n},Da.warnHtmlInMessage.get=function(){return this._warnHtmlInMessage},Da.warnHtmlInMessage.set=function(n){var e=this,t=this._warnHtmlInMessage;if(this._warnHtmlInMessage=n,t!==n&&("warn"===n||"error"===n)){var a=this._getMessages();Object.keys(a).forEach((function(n){e._checkLocaleMessage(n,e._warnHtmlInMessage,a[n])}))}},Da.postTranslation.get=function(){return this._postTranslation},Da.postTranslation.set=function(n){this._postTranslation=n},Da.sync.get=function(){return this._sync},Da.sync.set=function(n){this._sync=n},za.prototype._getMessages=function(){return this._vm.messages},za.prototype._getDateTimeFormats=function(){return this._vm.dateTimeFormats},za.prototype._getNumberFormats=function(){return this._vm.numberFormats},za.prototype._warnDefault=function(n,e,t,a,r,i){if(!Yt(t))return t;if(this._missing){var o=this._missing.apply(null,[n,e,a,r]);if(Qt(o))return o}else 0;if(this._formatFallbackMessages){var s=Zt.apply(void 0,r);return this._render(e,i,s.params,e)}return e},za.prototype._isFallbackRoot=function(n){return(this._fallbackRootWithEmptyString?!n:Yt(n))&&!Yt(this._root)&&this._fallbackRoot},za.prototype._isSilentFallbackWarn=function(n){return this._silentFallbackWarn instanceof RegExp?this._silentFallbackWarn.test(n):this._silentFallbackWarn},za.prototype._isSilentFallback=function(n,e){return this._isSilentFallbackWarn(e)&&(this._isFallbackRoot()||n!==this.fallbackLocale)},za.prototype._isSilentTranslationWarn=function(n){return this._silentTranslationWarn instanceof RegExp?this._silentTranslationWarn.test(n):this._silentTranslationWarn},za.prototype._interpolate=function(n,e,t,a,r,i,o){if(!e)return null;var s,l=this._path.getPathValue(e,t);if(Wt(l)||Kt(l))return l;if(Yt(l)){if(!Kt(e))return null;if(!Qt(s=e[t])&&!Xt(s))return null}else{if(!Qt(l)&&!Xt(l))return null;s=l}return Qt(s)&&(s.indexOf("@:")>=0||s.indexOf("@.")>=0)&&(s=this._link(n,e,s,a,"raw",i,o)),this._render(s,r,i,t)},za.prototype._link=function(n,e,t,a,r,i,o){var s=t,l=s.match(Ea);for(var c in l)if(l.hasOwnProperty(c)){var u=l[c],d=u.match(Oa),p=d[0],h=d[1],f=u.replace(p,"").replace(La,"");if(ea(o,f))return s;o.push(f);var m=this._interpolate(n,e,f,a,"raw"===r?"string":r,"raw"===r?void 0:i,o);if(this._isFallbackRoot(m)){if(!this._root)throw Error("unexpected error");var g=this._root.$i18n;m=g._translate(g._getMessages(),g.locale,g.fallbackLocale,f,a,r,i)}m=this._warnDefault(n,f,m,a,Wt(i)?i:[i],r),this._modifiers.hasOwnProperty(h)?m=this._modifiers[h](m):$a.hasOwnProperty(h)&&(m=$a[h](m)),o.pop(),s=m?s.replace(u,m):s}return s},za.prototype._createMessageContext=function(n,e,t,a){var r=this,i=Wt(n)?n:[],o=Ht(n)?n:{},s=this._getMessages(),l=this.locale;return{list:function(n){return i[n]},named:function(n){return o[n]},values:n,formatter:e,path:t,messages:s,locale:l,linked:function(n){return r._interpolate(l,s[l]||{},n,null,a,void 0,[n])}}},za.prototype._render=function(n,e,t,a){if(Xt(n))return n(this._createMessageContext(t,this._formatter||Pa,a,e));var r=this._formatter.interpolate(n,t,a);return r||(r=Pa.interpolate(n,t,a)),"string"!==e||Qt(r)?r:r.join("")},za.prototype._appendItemToChain=function(n,e,t){var a=!1;return ea(n,e)||(a=!0,e&&(a="!"!==e[e.length-1],e=e.replace(/!/g,""),n.push(e),t&&t[e]&&(a=t[e]))),a},za.prototype._appendLocaleToChain=function(n,e,t){var a,r=e.split("-");do{var i=r.join("-");a=this._appendItemToChain(n,i,t),r.splice(-1,1)}while(r.length&&!0===a);return a},za.prototype._appendBlockToChain=function(n,e,t){for(var a=!0,r=0;r<e.length&&"boolean"==typeof a;r++){var i=e[r];Qt(i)&&(a=this._appendLocaleToChain(n,i,t))}return a},za.prototype._getLocaleChain=function(n,e){if(""===n)return[];this._localeChainCache||(this._localeChainCache={});var t=this._localeChainCache[n];if(!t){e||(e=this.fallbackLocale),t=[];for(var a,r=[n];Wt(r);)r=this._appendBlockToChain(t,r,e);(r=Qt(a=Wt(e)?e:Ht(e)?e.default?e.default:null:e)?[a]:a)&&this._appendBlockToChain(t,r,null),this._localeChainCache[n]=t}return t},za.prototype._translate=function(n,e,t,a,r,i,o){for(var s,l=this._getLocaleChain(e,t),c=0;c<l.length;c++){var u=l[c];if(!Yt(s=this._interpolate(u,n[u],a,r,i,o,[a])))return s}return null},za.prototype._t=function(n,e,t,a){for(var r,i=[],o=arguments.length-4;o-- >0;)i[o]=arguments[o+4];if(!n)return"";var s=Zt.apply(void 0,i);this._escapeParameterHtml&&(s.params=oa(s.params));var l=s.locale||e,c=this._translate(t,l,this.fallbackLocale,n,a,"string",s.params);if(this._isFallbackRoot(c)){if(!this._root)throw Error("unexpected error");return(r=this._root).$t.apply(r,[n].concat(i))}return c=this._warnDefault(l,n,c,a,i,"string"),this._postTranslation&&null!=c&&(c=this._postTranslation(c,n)),c},za.prototype.t=function(n){for(var e,t=[],a=arguments.length-1;a-- >0;)t[a]=arguments[a+1];return(e=this)._t.apply(e,[n,this.locale,this._getMessages(),null].concat(t))},za.prototype._i=function(n,e,t,a,r){var i=this._translate(t,e,this.fallbackLocale,n,a,"raw",r);if(this._isFallbackRoot(i)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.i(n,e,r)}return this._warnDefault(e,n,i,a,[r],"raw")},za.prototype.i=function(n,e,t){return n?(Qt(e)||(e=this.locale),this._i(n,e,this._getMessages(),null,t)):""},za.prototype._tc=function(n,e,t,a,r){for(var i,o=[],s=arguments.length-5;s-- >0;)o[s]=arguments[s+5];if(!n)return"";void 0===r&&(r=1);var l={count:r,n:r},c=Zt.apply(void 0,o);return c.params=Object.assign(l,c.params),o=null===c.locale?[c.params]:[c.locale,c.params],this.fetchChoice((i=this)._t.apply(i,[n,e,t,a].concat(o)),r)},za.prototype.fetchChoice=function(n,e){if(!n||!Qt(n))return null;var t=n.split("|");return t[e=this.getChoiceIndex(e,t.length)]?t[e].trim():n},za.prototype.tc=function(n,e){for(var t,a=[],r=arguments.length-2;r-- >0;)a[r]=arguments[r+2];return(t=this)._tc.apply(t,[n,this.locale,this._getMessages(),null,e].concat(a))},za.prototype._te=function(n,e,t){for(var a=[],r=arguments.length-3;r-- >0;)a[r]=arguments[r+3];var i=Zt.apply(void 0,a).locale||e;return this._exist(t[i],n)},za.prototype.te=function(n,e){return this._te(n,this.locale,this._getMessages(),e)},za.prototype.getLocaleMessage=function(n){return na(this._vm.messages[n]||{})},za.prototype.setLocaleMessage=function(n,e){"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||this._checkLocaleMessage(n,this._warnHtmlInMessage,e),this._vm.$set(this._vm.messages,n,e)},za.prototype.mergeLocaleMessage=function(n,e){"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||this._checkLocaleMessage(n,this._warnHtmlInMessage,e),this._vm.$set(this._vm.messages,n,ra(void 0!==this._vm.messages[n]&&Object.keys(this._vm.messages[n]).length?Object.assign({},this._vm.messages[n]):{},e))},za.prototype.getDateTimeFormat=function(n){return na(this._vm.dateTimeFormats[n]||{})},za.prototype.setDateTimeFormat=function(n,e){this._vm.$set(this._vm.dateTimeFormats,n,e),this._clearDateTimeFormat(n,e)},za.prototype.mergeDateTimeFormat=function(n,e){this._vm.$set(this._vm.dateTimeFormats,n,ra(this._vm.dateTimeFormats[n]||{},e)),this._clearDateTimeFormat(n,e)},za.prototype._clearDateTimeFormat=function(n,e){for(var t in e){var a=n+"__"+t;this._dateTimeFormatters.hasOwnProperty(a)&&delete this._dateTimeFormatters[a]}},za.prototype._localizeDateTime=function(n,e,t,a,r,i){for(var o=e,s=a[o],l=this._getLocaleChain(e,t),c=0;c<l.length;c++){var u=l[c];if(o=u,!Yt(s=a[u])&&!Yt(s[r]))break}if(Yt(s)||Yt(s[r]))return null;var d,p=s[r];if(i)d=new Intl.DateTimeFormat(o,Object.assign({},p,i));else{var h=o+"__"+r;(d=this._dateTimeFormatters[h])||(d=this._dateTimeFormatters[h]=new Intl.DateTimeFormat(o,p))}return d.format(n)},za.prototype._d=function(n,e,t,a){if(!t)return(a?new Intl.DateTimeFormat(e,a):new Intl.DateTimeFormat(e)).format(n);var r=this._localizeDateTime(n,e,this.fallbackLocale,this._getDateTimeFormats(),t,a);if(this._isFallbackRoot(r)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.d(n,t,e)}return r||""},za.prototype.d=function(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var a=this.locale,r=null,i=null;return 1===e.length?(Qt(e[0])?r=e[0]:Ht(e[0])&&(e[0].locale&&(a=e[0].locale),e[0].key&&(r=e[0].key)),i=Object.keys(e[0]).reduce((function(n,t){var a;return ea(Jt,t)?Object.assign({},n,((a={})[t]=e[0][t],a)):n}),null)):2===e.length&&(Qt(e[0])&&(r=e[0]),Qt(e[1])&&(a=e[1])),this._d(n,a,r,i)},za.prototype.getNumberFormat=function(n){return na(this._vm.numberFormats[n]||{})},za.prototype.setNumberFormat=function(n,e){this._vm.$set(this._vm.numberFormats,n,e),this._clearNumberFormat(n,e)},za.prototype.mergeNumberFormat=function(n,e){this._vm.$set(this._vm.numberFormats,n,ra(this._vm.numberFormats[n]||{},e)),this._clearNumberFormat(n,e)},za.prototype._clearNumberFormat=function(n,e){for(var t in e){var a=n+"__"+t;this._numberFormatters.hasOwnProperty(a)&&delete this._numberFormatters[a]}},za.prototype._getNumberFormatter=function(n,e,t,a,r,i){for(var o=e,s=a[o],l=this._getLocaleChain(e,t),c=0;c<l.length;c++){var u=l[c];if(o=u,!Yt(s=a[u])&&!Yt(s[r]))break}if(Yt(s)||Yt(s[r]))return null;var d,p=s[r];if(i)d=new Intl.NumberFormat(o,Object.assign({},p,i));else{var h=o+"__"+r;(d=this._numberFormatters[h])||(d=this._numberFormatters[h]=new Intl.NumberFormat(o,p))}return d},za.prototype._n=function(n,e,t,a){if(!za.availabilities.numberFormat)return"";if(!t)return(a?new Intl.NumberFormat(e,a):new Intl.NumberFormat(e)).format(n);var r=this._getNumberFormatter(n,e,this.fallbackLocale,this._getNumberFormats(),t,a),i=r&&r.format(n);if(this._isFallbackRoot(i)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.n(n,Object.assign({},{key:t,locale:e},a))}return i||""},za.prototype.n=function(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var a=this.locale,r=null,i=null;return 1===e.length?Qt(e[0])?r=e[0]:Ht(e[0])&&(e[0].locale&&(a=e[0].locale),e[0].key&&(r=e[0].key),i=Object.keys(e[0]).reduce((function(n,t){var a;return ea(Ut,t)?Object.assign({},n,((a={})[t]=e[0][t],a)):n}),null)):2===e.length&&(Qt(e[0])&&(r=e[0]),Qt(e[1])&&(a=e[1])),this._n(n,a,r,i)},za.prototype._ntp=function(n,e,t,a){if(!za.availabilities.numberFormat)return[];if(!t)return(a?new Intl.NumberFormat(e,a):new Intl.NumberFormat(e)).formatToParts(n);var r=this._getNumberFormatter(n,e,this.fallbackLocale,this._getNumberFormats(),t,a),i=r&&r.formatToParts(n);if(this._isFallbackRoot(i)){if(!this._root)throw Error("unexpected error");return this._root.$i18n._ntp(n,e,t,a)}return i||[]},Object.defineProperties(za.prototype,Da),Object.defineProperty(za,"availabilities",{get:function(){if(!Aa){var n="undefined"!=typeof Intl;Aa={dateTimeFormat:n&&void 0!==Intl.DateTimeFormat,numberFormat:n&&void 0!==Intl.NumberFormat}}return Aa}}),za.install=ba,za.version="8.28.2";var Ma=za;
/*!
 * vssue - A vue-powered issue-based comment plugin
 *
 * @version v1.4.8
 * @link https://vssue.js.org
 * @license MIT
 * @copyright 2018-2021 meteorlxy
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Fa(n,e,t,a){var r,i=arguments.length,o=i<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,t):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,e,t,a);else for(var s=n.length-1;s>=0;s--)(r=n[s])&&(o=(i<3?r(o):i>3?r(e,t,o):r(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o}var Ra=a.b.extend({name:"Iconfont"});function qa(n,e,t,a,r,i,o,s,l,c){"boolean"!=typeof o&&(l=s,s=o,o=!1);const u="function"==typeof t?t.options:t;let d;if(n&&n.render&&(u.render=n.render,u.staticRenderFns=n.staticRenderFns,u._compiled=!0,r&&(u.functional=!0)),a&&(u._scopeId=a),i?(d=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),e&&e.call(this,l(n)),n&&n._registeredComponents&&n._registeredComponents.add(i)},u._ssrRegister=d):e&&(d=o?function(n){e.call(this,c(n,this.$root.$options.shadowRoot))}:function(n){e.call(this,s(n))}),d)if(u.functional){const n=u.render;u.render=function(e,t){return d.call(t),n(e,t)}}else{const n=u.beforeCreate;u.beforeCreate=n?[].concat(n,d):[d]}return t}"undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());const Na=qa({render:function(n,e){var t=e._c;return t("svg",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[t("symbol",{attrs:{id:"vssue-icon-bitbucket",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M579.5522464 489.45249493q4.8371808 38.38537173-30.81752427 61.55702827t-67.95459093 3.66689493q-23.79580907-10.37653333-32.6119616-35.34262826t-0.31207573-50.01020907 31.67573333-35.34262827q21.92335253-11.00068587 44.1587808-7.33379093t39.00952427 21.61127573 16.77409493 41.1160384zM647.19476053 476.65737173q-8.50407573-65.22392427-68.8908192-99.9424t-120.07131413-7.9579424q-38.38537173 17.08617173-61.24495253 53.9111616t-21.0651424 78.95527574q2.41859093 55.4715424 47.20152426 94.48106666t100.87862827 34.1723424q55.4715424-4.8371808 92.60860907-51.18049493t30.50544746-102.43900907zM792.93434133 146.32472427q-12.17097173-16.4620192-34.1723424-27.15062827t-35.34262826-13.41927573-43.30057174-7.64586667q-177.33729493-28.63299093-345.00022826 1.24830507-26.2144 4.29104747-40.25782827 7.33379093t-33.54819093 13.41927573-30.50544747 26.2144q18.2564576 17.08617173 46.34331413 27.6967616t44.78293334 13.41927574 53.36502826 7.02171413q138.95192427 17.71032427 273.06666667 0.62415253 38.38537173-4.8371808 54.53531413-7.33379093t44.1587808-13.1072 45.7191616-28.32091413zM827.65281813 777.10872427q-4.8371808 15.83786667-9.44030506 46.65539093t-8.50407574 51.18049493-17.39824746 42.6764192-35.34262827 34.4064q-52.4288 29.2571424-115.46819093 43.61264747t-123.1140576 13.41927573-122.8019808-11.3127616q-28.0088384-4.8371808-49.69813334-11.00068586t-46.65539093-16.4620192-44.4708576-26.52647574-31.67573333-37.4491424q-15.21371413-58.51428587-34.71847574-177.96144746l3.66689494-9.7523808 11.00068586-5.46133334q135.9091808 90.1900192 308.72137174 90.1900192t309.34552426-90.1900192q12.79512427 3.66689493 14.5895616 14.04342827t-3.0427424 27.46270507-4.8371808 22.54750506zM937.97175147 191.41973333q-15.83786667 101.8148576-67.64251414 399.22346667-3.0427424 18.2564576-16.4620192 34.1723424t-26.52647573 24.3419424-33.23611413 18.88060907q-153.61950507 76.7707424-371.8387808 53.67710506-151.12289493-16.4620192-240.14262827-84.72868586-9.12822827-7.33379093-15.52579093-16.1499424t-10.37653334-21.2992-5.46133333-20.75306667-3.66689493-24.10788587-3.3548192-21.2992q-5.46133333-30.50544747-16.1499424-91.43832426t-17.08617174-98.4600384-14.35550506-89.8779424-13.41927574-96.27550507q1.7944384-15.83786667 10.68860907-29.5692192t19.19268587-22.8595808 27.46270506-18.2564576 28.0088384-13.73135253 29.2571424-11.3127616q76.22460907-28.0088384 190.75657174-39.00952427 231.0144-22.54750507 412.01859093 30.50544747 94.48106667 28.0088384 131.072 74.35215253 9.7523808 12.17097173 10.0644576 31.0515808t-3.3548192 32.9240384z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-gitea",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M184.31868985 236.10860742C106.94832667 235.94086648 3.32655508 285.13080468 9.02973665 408.46209936c8.93218827 192.65010787 206.32096845 210.5144844 285.20099725 212.06608453 8.63864186 36.14810496 101.48307766 160.77938883 170.21479898 167.32127321h301.09442177c180.57278288-11.99345499 315.77172611-546.07960359 215.54670217-548.09249109-165.7696721 7.79993906-264.02374305 11.74184405-348.27147151 12.41280591v166.69224585l-26.25140843-11.61603761-0.16773997-154.99233728c-96.70246985-0.04193548-181.83083757-4.52899687-343.4069947-12.49667687-20.21274496-0.12580547-48.39316992-3.5644886-78.67035236-3.64835859z m10.94507577 68.14462849h9.22573371c10.98701124 98.75729283 28.85138778 156.50200291 64.99949274 244.73357185-92.25734394-10.90314029-170.75995634-37.69970509-185.18564974-137.75698809-7.46445813-51.78991757 17.69663558-105.84433456 110.96042329-107.01851827z m358.83913087 97.07988723c6.29027343 0.08386999 12.70635233 1.25805468 18.74501482 4.02577499l31.40943263 13.54505513-22.51917887 41.05451824a28.18042496 25.03528825 0 0 0-10.10637297 1.59353561 28.18042496 25.03528825 0 0 0-16.98373825 32.038459 28.18042496 25.03528825 0 0 0 4.69673781 7.29671718l-38.83195528 70.70267333a28.18042496 25.03528825 0 0 0-9.30960467 1.59353659 28.18042496 25.03528825 0 0 0-16.98373825 32.038459 28.18042496 25.03528825 0 0 0 36.06423497 15.09665623 28.18042496 25.03528825 0 0 0 16.94180276-32.08039449 28.18042496 25.03528825 0 0 0-6.62575434-9.22573468l37.82551056-68.85752581a28.18042496 25.03528825 0 0 0 12.28700044-1.25805469 28.18042496 25.03528825 0 0 0 8.93218826-4.69673783c14.59343435 6.12253248 26.54495386 11.11281671 35.14166122 15.34826717 12.91602778 6.37414341 17.48696012 10.60959485 18.87082027 15.30633169 1.38386015 4.61286685-0.12580547 13.50312062-7.42252263 29.10299872-5.45157063 11.61603859-14.46762889 28.09655497-25.11915823 47.51253164a28.18042496 25.03528825 0 0 0-10.52572486 1.59353659 28.18042496 25.03528825 0 0 0-16.98373826 32.038459 28.18042496 25.03528825 0 0 0 36.06423498 15.09665623 28.18042496 25.03528825 0 0 0 16.94180278-32.03845901 28.18042496 25.03528825 0 0 0-5.74511608-8.47090188c10.52572388-19.20630122 19.58371762-35.72875308 25.41270465-48.14155897 7.88380904-16.85793279 11.99345499-29.39654416 8.38703091-41.51580463-3.60642311-12.11926046-14.67730434-20.0030695-29.35460966-27.25785217-9.6450856-4.73867233-21.68047607-9.77089106-36.06423399-15.80955357a28.18042496 25.03528825 0 0 0-1.59353562-10.022502 28.18042496 25.03528825 0 0 0-6.08059796-8.7644483l22.14176246-40.38355541 122.61839638 52.96410227c22.14176247 9.6031511 31.2836262 33.12877372 20.54822685 52.8382968l-84.28966393 154.32137544c-10.77733482 19.66758857-37.23841869 27.80300855-59.38018118 18.24179293l-173.48574115-74.98005927c-22.14176247-9.5612156-31.32556167-33.12877372-20.54822687-52.83829679l84.28966395-154.27943995c7.38058716-13.54505513 22.22563246-21.59660511 37.951317-22.22563246h2.68384935z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-gitee",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M978.404275 409.561604H455.061338c-25.117645 0-45.499734 20.382089-45.499734 45.499734l-0.031997 113.781333c0 25.117645 20.350092 45.499734 45.499734 45.531731h318.594132c25.117645 0 45.499734 20.382089 45.499734 45.499735v22.749867a136.5312 136.5312 0 0 1-136.5312 136.5312H250.248539a45.499734 45.499734 0 0 1-45.499734-45.499734V341.343999a136.5312 136.5312 0 0 1 136.5312-136.5312L978.308284 204.780802c25.117645 0 45.499734-20.350092 45.499734-45.467738L1023.904009 45.531731h0.031997A45.499734 45.499734 0 0 0 978.468269 0h-0.031997L341.343999 0.031997C152.84967 0.031997 0.031997 152.84967 0.031997 341.343999v637.092273c0 25.117645 20.382089 45.499734 45.499734 45.499734h671.233072a307.171203 307.171203 0 0 0 307.171203-307.171203v-261.671468c0-25.117645-20.382089-45.499734-45.499734-45.499734z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-github",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M512 20.4425c-278.334 0-504 225.6345-504 504 0 222.6735 144.4275 411.6105 344.673 478.233 25.2 4.662 34.461-10.9305 34.461-24.255 0-12.0015-0.4725-51.723-0.693-93.8385-140.238 30.492-169.8165-59.472-169.8165-59.472-22.932-58.2435-55.944-73.7415-55.944-73.7415-45.738-31.2795 3.465-30.6495 3.465-30.6495 50.589 3.5595 77.238 51.9435 77.238 51.9435 44.9505 77.049 117.9045 54.7785 146.664 41.895 4.5045-32.571 17.577-54.81 32.004-67.41-111.951-12.726-229.635-55.9755-229.635-249.0705 0-55.0305 19.6875-99.981 51.9435-135.2925-5.229-12.6945-22.491-63.945 4.8825-133.371 0 0 42.336-13.545 138.6315 51.66 40.194-11.1825 83.3175-16.758 126.1575-16.9785 42.8085 0.189 85.9635 5.796 126.252 16.9785 96.201-65.205 138.4425-51.66 138.4425-51.66 27.4365 69.426 10.1745 120.6765 4.9455 133.371 32.319 35.28 51.8805 80.262 51.8805 135.2925 0 193.5675-117.9045 236.187-230.139 248.6925 18.081 15.6555 34.1775 46.305 34.1775 93.3345 0 67.4415-0.5985 121.716-0.5985 138.3165 0 13.419 9.072 29.1375 34.6185 24.192 200.151-66.717 344.3895-255.5595 344.3895-478.17 0-278.3655-225.666-504-504-504z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-gitlab",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M66.61375986 405.11600042L512.11376028 976.03999972 23.84576 621.65599958a39.312 39.312 0 0 1-14.07600042-43.30799944l56.8080007-173.26800028z m259.88400014 0h371.26800014L512.14975986 976.03999972zM215.11376 60.88400042l111.384 344.232H66.61375986l111.384-344.232a19.72800014 19.72800014 0 0 1 37.11600014 0z m742.49999972 344.232l56.8080007 173.2679993a39.23999986 39.23999986 0 0 1-14.07600042 43.30800042l-488.26800028 354.38400014 445.50000042-570.92400028z m0 0h-259.88400014l111.384-344.232a19.72800014 19.72800014 0 0 1 37.11600014 0z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-loading",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M843.307 742.24c0 3.217 2.607 5.824 5.824 5.824s5.824-2.607 5.824-5.824a5.823 5.823 0 0 0-5.824-5.824 5.823 5.823 0 0 0-5.824 5.824zM714.731 874.912c0 6.398 5.186 11.584 11.584 11.584s11.584-5.186 11.584-11.584-5.186-11.584-11.584-11.584-11.584 5.186-11.584 11.584zM541.419 943.2c0 9.614 7.794 17.408 17.408 17.408s17.408-7.794 17.408-17.408-7.794-17.408-17.408-17.408-17.408 7.794-17.408 17.408z m-186.56-9.152c0 12.795 10.373 23.168 23.168 23.168s23.168-10.373 23.168-23.168-10.373-23.168-23.168-23.168-23.168 10.373-23.168 23.168zM189.355 849.12c0 16.012 12.98 28.992 28.992 28.992s28.992-12.98 28.992-28.992-12.98-28.992-28.992-28.992-28.992 12.98-28.992 28.992zM74.731 704.736c0 19.228 15.588 34.816 34.816 34.816s34.816-15.588 34.816-34.816-15.588-34.816-34.816-34.816-34.816 15.588-34.816 34.816z m-43.008-177.28c0 22.41 18.166 40.576 40.576 40.576s40.576-18.166 40.576-40.576-18.166-40.576-40.576-40.576-40.576 18.166-40.576 40.576z m35.392-176.128c0 25.626 20.774 46.4 46.4 46.4s46.4-20.774 46.4-46.4c0-25.626-20.774-46.4-46.4-46.4-25.626 0-46.4 20.774-46.4 46.4z m106.176-142.016c0 28.843 23.381 52.224 52.224 52.224s52.224-23.381 52.224-52.224c0-28.843-23.381-52.224-52.224-52.224-28.843 0-52.224 23.381-52.224 52.224z m155.904-81.344c0 32.024 25.96 57.984 57.984 57.984s57.984-25.96 57.984-57.984-25.96-57.984-57.984-57.984-57.984 25.96-57.984 57.984z m175.104-5.056c0 35.24 28.568 63.808 63.808 63.808s63.808-28.568 63.808-63.808c0-35.24-28.568-63.808-63.808-63.808-35.24 0-63.808 28.568-63.808 63.808z m160.32 72.128c0 38.421 31.147 69.568 69.568 69.568s69.568-31.147 69.568-69.568-31.147-69.568-69.568-69.568-69.568 31.147-69.568 69.568z m113.92 135.488c0 41.638 33.754 75.392 75.392 75.392s75.392-33.754 75.392-75.392-33.754-75.392-75.392-75.392-75.392 33.754-75.392 75.392z m45.312 175.488c0 44.854 36.362 81.216 81.216 81.216s81.216-36.362 81.216-81.216c0-44.854-36.362-81.216-81.216-81.216-44.854 0-81.216 36.362-81.216 81.216z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-like",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4-20.5-21.5-48.1-33.4-77.9-33.4-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-0.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81z m636.4-353l-21.9 19 13.9 25.4c4.6 8.4 6.9 17.6 6.9 27.3 0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4c4.6 8.4 6.9 17.6 6.9 27.3 0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4c4.6 8.4 6.9 17.6 6.9 27.3 0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5c5.2-18.9 22.5-32.2 42.2-32.3 7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-unlike",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4-8.3-3.6-17.2-5.4-26.5-5.4H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h129.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM184 456V172h81v284h-81z m627.2 160.4H496.8l9.6 198.4c0.6 11.9-4.7 23.1-14.6 30.5-6.1 4.5-13.6 6.8-21.1 6.7-19.6-0.1-36.9-13.4-42.2-32.3L329 459.2V172h415.4c20.4 9.2 33.6 29.4 33.6 51.8 0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19c12.5 10.8 19.6 26.5 19.6 43 0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19c12.5 10.8 19.6 26.5 19.6 43 0 9.7-2.3 18.9-6.9 27.3l-14 25.5 21.9 19c12.5 10.8 19.6 26.5 19.6 43 0 19.1-11 37.5-28.8 48.4z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-heart",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M923 283.6c-13.4-31.1-32.6-58.9-56.9-82.8-24.3-23.8-52.5-42.4-84-55.5-32.5-13.5-66.9-20.3-102.4-20.3-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5-24.4 23.9-43.5 51.7-56.9 82.8-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3 0.1-35.3-7-69.6-20.9-101.9zM512 814.8S156 586.7 156 385.5C156 283.6 240.3 201 344.3 201c73.1 0 136.5 40.8 167.7 100.4C543.2 241.8 606.6 201 679.7 201c104 0 188.3 82.6 188.3 184.5 0 201.2-356 429.3-356 429.3z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-edit",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M723.2 917.76H286.72c-65.28 0-118.4-51.2-118.4-113.92V261.76C168.32 198.4 221.44 147.2 286.72 147.2h375.04c17.92 0 32 14.08 32 32s-14.08 32-32 32H286.72c-30.08 0-54.4 22.4-54.4 49.92v542.08c0 27.52 24.32 49.92 54.4 49.92H723.2c30.08 0 54.4-22.4 54.4-49.92V440.32c0-17.92 14.08-32 32-32s32 14.08 32 32v363.52c0 62.72-53.12 113.92-118.4 113.92z"}}),e._v(" "),t("path",{attrs:{d:"M499.84 602.24c-7.68 0-14.72-2.56-21.12-7.68-13.44-11.52-14.72-32-3.2-45.44L780.16 198.4c11.52-13.44 32-14.72 45.44-3.2s14.72 32 3.2 45.44L524.16 591.36c-6.4 7.04-15.36 10.88-24.32 10.88z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-delete",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M677.647059 256l0-90.352941c0-37.436235-23.461647-60.235294-61.771294-60.235294L408.094118 105.411765c-38.249412 0-61.741176 22.799059-61.741176 60.235294l0 90.352941-180.705882 0 0 60.235294 60.235294 0 0 512c0 54.272 33.972706 90.352941 90.352941 90.352941l391.529412 0c55.085176 0 90.352941-33.490824 90.352941-90.352941l0-512 60.235294 0 0-60.235294L677.647059 256zM406.588235 165.647059l210.823529 0-1.264941 90.352941L406.588235 256 406.588235 165.647059zM737.882353 858.352941l-451.764706 0 0-542.117647 451.764706 0L737.882353 858.352941zM466.823529 376.470588l-58.729412 0-1.505882 391.529412 60.235294 0L466.823529 376.470588zM617.411765 376.470588l-60.235294 0 0 391.529412 60.235294 0L617.411765 376.470588z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-reply",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M426.666667 384 426.666667 213.333333 128 512 426.666667 810.666667 426.666667 635.733333C640 635.733333 789.333333 704 896 853.333333 853.333333 640 725.333333 426.666667 426.666667 384Z"}})]),e._v(" "),t("symbol",{attrs:{id:"vssue-icon-error",viewBox:"0 0 1024 1024"}},[t("path",{attrs:{d:"M512 720m-48 0a48 48 0 1 0 96 0 48 48 0 1 0-96 0Z"}}),e._v(" "),t("path",{attrs:{d:"M480 416v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z"}}),e._v(" "),t("path",{attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48z m-783.5-27.9L512 239.9l339.8 588.2H172.2z"}})])])},staticRenderFns:[]},void 0,Ra,void 0,!0,void 0,!1,void 0,void 0,void 0);const Ba=qa({},void 0,a.b.extend({name:"TransitionFade",functional:!0,props:{group:{type:Boolean,required:!1,default:!1},tag:{type:String,required:!1,default:"div"}},render:(n,{props:e,children:t})=>n(e.group?"TransitionGroup":"Transition",{props:{name:"fade",mode:"out-in",appear:!0,tag:e.tag}},t)}),void 0,void 0,void 0,!1,void 0,void 0,void 0);const Ua=qa({},void 0,a.b.extend({name:"VssueIcon",functional:!0,props:{name:{type:String,required:!0},title:{type:String,required:!1,default:null}},render:(n,{props:e,data:t})=>n("svg",Object.assign(Object.assign({},t),{class:["vssue-icon","vssue-icon-"+e.name],attrs:{"aria-hidden":"true"}}),[n("title",e.title),n("use",{attrs:{"xlink:href":"#vssue-icon-"+e.name}})])}),void 0,void 0,void 0,!1,void 0,void 0,void 0);let Ja=class extends a.b{constructor(){super(...arguments),this.editMode=!1,this.editContent=this.comment.contentRaw,this.creatingReactions=[],this.isPutingComment=!1,this.isDeletingComment=!1}get currentUser(){return this.vssue.user?this.vssue.user.username:null}get content(){return this.comment.content}get author(){return this.comment.author}get createdAt(){return qt(this.comment.createdAt)}get updatedAt(){return qt(this.comment.updatedAt)}get showReactions(){return Boolean(this.vssue.API&&this.vssue.API.platform.meta.reactable&&this.comment.reactions&&!this.editMode)}get reactionKeys(){return["heart","like","unlike"]}get editContentRows(){return this.editContent.split("\n").length-1}get editInputRows(){return this.editContentRows<3?5:this.editContentRows+2}async postReaction({reaction:n}){try{if(this.creatingReactions.includes(n))return;this.creatingReactions.push(n);await this.vssue.postCommentReaction({commentId:this.comment.id,reaction:n})||this.vssue.$emit("error",new Error(this.vssue.$t("reactionGiven",{reaction:this.vssue.$t(n)})));const e=await this.vssue.getCommentReactions({commentId:this.comment.id});e&&(this.comment.reactions=e)}finally{this.creatingReactions.splice(this.creatingReactions.findIndex(e=>e===n),1)}}enterEdit(){this.editMode=!0,this.$nextTick(()=>{this.$refs.input.focus()})}resetEdit(){this.editMode=!1,this.editContent=this.comment.contentRaw}async putComment(){try{if(this.vssue.isPending)return;if(this.editContent!==this.comment.contentRaw){this.isPutingComment=!0,this.vssue.isUpdatingComment=!0;const n=await this.vssue.putComment({commentId:this.comment.id,content:this.editContent});n&&this.vssue.comments.data.splice(this.vssue.comments.data.findIndex(n=>n.id===this.comment.id),1,n)}this.editMode=!1}finally{this.isPutingComment=!1,this.vssue.isUpdatingComment=!1}}async deleteComment(){try{if(this.vssue.isPending)return;if(!window.confirm(this.vssue.$t("deleteConfirm")))return;this.isDeletingComment=!0,this.vssue.isUpdatingComment=!0;await this.vssue.deleteComment({commentId:this.comment.id})?(this.vssue.comments.count-=1,this.vssue.comments.data.length>1&&this.vssue.comments.data.splice(this.vssue.comments.data.findIndex(n=>n.id===this.comment.id),1),this.vssue.query.page>1&&this.vssue.query.page>Math.ceil(this.vssue.comments.count/this.vssue.query.perPage)?this.vssue.query.page-=1:await this.vssue.getComments()):this.vssue.$emit("error",new Error(this.vssue.$t("deleteFailed")))}finally{this.isDeletingComment=!1,this.vssue.isUpdatingComment=!1}}};Fa([Lt({type:Object,required:!0})],Ja.prototype,"comment",void 0),Fa([Ct()],Ja.prototype,"vssue",void 0),Ja=Fa([Object(Tt.b)({components:{VssueIcon:Ua}})],Ja);const Va=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"vssue-comment",class:{"vssue-comment-edit-mode":n.editMode,"vssue-comment-disabled":n.isDeletingComment||n.isPutingComment}},[t("div",{staticClass:"vssue-comment-avatar"},[t("a",{attrs:{href:n.author.homepage,title:n.author.username,target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:n.author.avatar,alt:n.author.username}})])]),n._v(" "),t("div",{staticClass:"vssue-comment-body"},[n._t("body",[t("div",{staticClass:"vssue-comment-header"},[t("span",{staticClass:"vssue-comment-author"},[t("a",{attrs:{href:n.author.homepage,title:n.author.username,target:"_blank",rel:"noopener noreferrer"}},[n._v("\n            "+n._s(n.author.username)+"\n          ")])]),n._v(" "),t("span",{staticClass:"vssue-comment-created-at"},[n._v("\n          "+n._s(n.createdAt)+"\n        ")])]),n._v(" "),t("div",{staticClass:"vssue-comment-main"},[n.editMode?t("textarea",{directives:[{name:"model",rawName:"v-model",value:n.editContent,expression:"editContent"}],ref:"input",staticClass:"vssue-edit-comment-input",attrs:{rows:n.editInputRows},domProps:{value:n.editContent},on:{keyup:function(e){return!e.type.indexOf("key")&&n._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?n.putComment():null},input:function(e){e.target.composing||(n.editContent=e.target.value)}}}):t("article",{staticClass:"markdown-body",domProps:{innerHTML:n._s(n.content)}})]),n._v(" "),t("div",{staticClass:"vssue-comment-footer"},[n.editMode?t("span",{staticClass:"vssue-comment-hint"},[n._v("\n          "+n._s(n.vssue.$t("editMode"))+"\n        ")]):n._e(),n._v(" "),n.showReactions?t("span",{staticClass:"vssue-comment-reactions"},n._l(n.reactionKeys,(function(e){return t("span",{key:e,staticClass:"vssue-comment-reaction",attrs:{title:n.vssue.$t(n.creatingReactions.includes(e)?"loading":e)},on:{click:function(t){return n.postReaction({reaction:e})}}},[t("VssueIcon",{attrs:{name:n.creatingReactions.includes(e)?"loading":e,title:n.vssue.$t(n.creatingReactions.includes(e)?"loading":e)}}),n._v(" "),t("span",{staticClass:"vssue-comment-reaction-number"},[n._v("\n              "+n._s(n.comment.reactions[e])+"\n            ")])],1)})),0):n._e(),n._v(" "),t("span",{staticClass:"vssue-comment-operations"},[n.comment.author.username===n.currentUser&&n.editMode?t("span",{staticClass:"vssue-comment-operation",class:{"vssue-comment-operation-muted":n.isPutingComment},attrs:{title:n.vssue.$t(n.isPutingComment?"loading":"submit")},on:{click:function(e){return n.putComment()}}},[t("VssueIcon",{directives:[{name:"show",rawName:"v-show",value:n.isPutingComment,expression:"isPutingComment"}],attrs:{name:"loading",title:n.vssue.$t("loading")}}),n._v("\n\n            "+n._s(n.vssue.$t("submit"))+"\n          ")],1):n._e(),n._v(" "),n.comment.author.username===n.currentUser&&n.editMode?t("span",{staticClass:"vssue-comment-operation vssue-comment-operation-muted",attrs:{title:n.vssue.$t("cancel")},on:{click:function(e){return n.resetEdit()}}},[n._v("\n            "+n._s(n.vssue.$t("cancel"))+"\n          ")]):n._e(),n._v(" "),n.comment.author.username===n.currentUser?t("span",{directives:[{name:"show",rawName:"v-show",value:!n.editMode,expression:"!editMode"}],staticClass:"vssue-comment-operation",on:{click:function(e){return n.enterEdit()}}},[t("VssueIcon",{attrs:{name:"edit",title:n.vssue.$t("edit")}})],1):n._e(),n._v(" "),n.comment.author.username===n.currentUser||n.vssue.isAdmin?t("span",{directives:[{name:"show",rawName:"v-show",value:!n.editMode,expression:"!editMode"}],staticClass:"vssue-comment-operation",on:{click:function(e){return n.deleteComment()}}},[t("VssueIcon",{attrs:{name:n.isDeletingComment?"loading":"delete",title:n.vssue.$t(n.isDeletingComment?"loading":"delete")}})],1):n._e(),n._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!n.editMode,expression:"!editMode"}],staticClass:"vssue-comment-operation",on:{click:function(e){return n.vssue.$emit("reply-comment",n.comment)}}},[t("VssueIcon",{attrs:{name:"reply",title:n.vssue.$t("reply")}})],1)])])])],2)])},staticRenderFns:[]},void 0,Ja,void 0,!1,void 0,!1,void 0,void 0,void 0);let Wa=class extends a.b{get disabled(){return this.vssue.isPending}get pageCount(){const n=Math.ceil(this.vssue.comments.count/this.vssue.comments.perPage);return n>1?n:1}get perPageOptions(){const n=[5,10,20,50];return!n.includes(this.vssue.options.perPage)&&this.vssue.options.perPage<100&&n.push(this.vssue.options.perPage),n.sort((n,e)=>n-e)}get page(){return this.vssue.query.page>this.pageCount?this.pageCount:this.vssue.query.page}set page(n){n>0&&n<=this.pageCount&&(this.vssue.query.page=n)}get perPage(){return this.vssue.query.perPage}set perPage(n){this.perPageOptions.includes(n)&&(this.vssue.query.perPage=n)}};Fa([Ct()],Wa.prototype,"vssue",void 0),Wa=Fa([Object(Tt.b)({components:{VssueIcon:Ua}})],Wa);const Ha=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"vssue-pagination"},[t("div",{staticClass:"vssue-pagination-per-page"},[t("label",[t("select",{directives:[{name:"model",rawName:"v-model",value:n.perPage,expression:"perPage"}],staticClass:"vssue-pagination-select",attrs:{disabled:n.disabled},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,(function(n){return n.selected})).map((function(n){return"_value"in n?n._value:n.value}));n.perPage=e.target.multiple?t:t[0]}}},n._l(n.perPageOptions,(function(e){return t("option",{key:e,domProps:{value:e}},[n._v("\n          "+n._s(e)+"\n        ")])})),0),n._v(" "),t("span",[n._v("\n        "+n._s(n.vssue.$t("perPage"))+"\n      ")])]),n._v(" "),n.vssue.API.platform.meta.sortable?t("span",{class:{"vssue-pagination-link":!0,disabled:n.disabled},attrs:{title:n.vssue.$t("sort")},on:{click:function(e){n.vssue.query.sort="asc"===n.vssue.query.sort?"desc":"asc"}}},[n._v("\n      "+n._s("asc"===n.vssue.query.sort?"":"")+"\n    ")]):n._e()]),n._v(" "),t("div",{staticClass:"vssue-pagination-page"},[t("span",{class:{"vssue-pagination-link":!0,disabled:1===n.page||n.disabled},attrs:{title:n.vssue.$t("prev")},domProps:{textContent:n._s("<")},on:{click:function(e){n.page-=1}}}),n._v(" "),t("label",[t("span",[n._v("\n        "+n._s(n.vssue.$t("page"))+"\n      ")]),n._v(" "),t("select",{directives:[{name:"show",rawName:"v-show",value:n.pageCount>1,expression:"pageCount > 1"},{name:"model",rawName:"v-model",value:n.page,expression:"page"}],staticClass:"vssue-pagination-select",attrs:{disabled:n.disabled},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,(function(n){return n.selected})).map((function(n){return"_value"in n?n._value:n.value}));n.page=e.target.multiple?t:t[0]}}},n._l(n.pageCount,(function(e){return t("option",{key:e,domProps:{value:e}},[n._v("\n          "+n._s(e)+"\n        ")])})),0),n._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.pageCount<2,expression:"pageCount < 2"}],domProps:{textContent:n._s(n.page)}}),n._v(" "),t("span",{domProps:{textContent:n._s(" / "+n.pageCount+" ")}})]),n._v(" "),t("span",{class:{"vssue-pagination-link":!0,disabled:n.page===n.pageCount||n.disabled},attrs:{title:n.vssue.$t("next")},domProps:{textContent:n._s(">")},on:{click:function(e){n.page+=1}}})])])},staticRenderFns:[]},void 0,Wa,void 0,!1,void 0,!1,void 0,void 0,void 0);let Qa=class extends a.b{};Fa([Ct()],Qa.prototype,"vssue",void 0),Qa=Fa([Object(Tt.b)({components:{TransitionFade:Ba,VssueComment:Va,VssuePagination:Ha}})],Qa);const Ga=qa({render:function(){var n=this.$createElement,e=this._self._c||n;return e("div",{staticClass:"vssue-comments"},[e("VssuePagination"),this._v(" "),e("TransitionFade",{attrs:{group:""}},this._l(this.vssue.comments.data,(function(n){return e("VssueComment",{key:n.id,attrs:{comment:n}})})),1),this._v(" "),e("VssuePagination",{directives:[{name:"show",rawName:"v-show",value:this.vssue.comments.data.length>5,expression:"vssue.comments.data.length > 5"}]})],1)},staticRenderFns:[]},void 0,Qa,void 0,!1,void 0,!1,void 0,void 0,void 0);const Ka=qa({},void 0,a.b.extend({name:"VssueIcon",functional:!0,props:{type:{type:String,required:!1,default:"default"}},render:(n,{props:e,data:t,children:a})=>n("button",Object.assign(Object.assign({},t),{class:["vssue-button","vssue-button-"+e.type]}),a)}),void 0,void 0,void 0,!1,void 0,void 0,void 0);let Ya=class extends a.b{constructor(){super(...arguments),this.content=""}get user(){return this.vssue.user}get platform(){return this.vssue.API&&this.vssue.API.platform.name}get isInputDisabled(){return this.loading||null===this.user||null===this.vssue.issue}get isSubmitDisabled(){return""===this.content||this.vssue.isPending||null===this.vssue.issue}get loading(){return this.vssue.isCreatingComment}get contentRows(){return this.content.split("\n").length-1}get inputRows(){return this.contentRows<3?5:this.contentRows+2}created(){this.vssue.$on("reply-comment",n=>{const e=n.contentRaw.replace(/\n/g,"\n> "),t=`@${n.author.username}\n\n> ${e}\n\n`;this.content=this.content.concat(t),this.focus()})}beforeDestroy(){this.vssue.$off("reply-comment")}focus(){this.$refs.input.focus()}async submit(){this.isSubmitDisabled||(await this.vssue.postComment({content:this.content}),this.content="",await this.vssue.getComments())}};Fa([Ct()],Ya.prototype,"vssue",void 0),Ya=Fa([Object(Tt.b)({components:{VssueButton:Ka,VssueIcon:Ua}})],Ya);const Xa=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"vssue-new-comment"},[t("div",{staticClass:"vssue-comment-avatar"},[n.user?t("a",{attrs:{href:n.user.homepage,title:n.user.username,target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:n.user.avatar,alt:n.user.username}})]):t("VssueIcon",{attrs:{name:n.platform.toLowerCase(),title:n.vssue.$t("loginToComment",{platform:n.platform})},on:{click:function(e){return n.vssue.login()}}})],1),n._v(" "),t("div",{staticClass:"vssue-new-comment-body"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:n.content,expression:"content"}],ref:"input",staticClass:"vssue-new-comment-input",attrs:{rows:n.inputRows,disabled:n.isInputDisabled,placeholder:n.vssue.$t(n.user?"placeholder":"noLoginPlaceHolder"),spellcheck:!1,"aria-label":"leave a comment"},domProps:{value:n.content},on:{keyup:function(e){return!e.type.indexOf("key")&&n._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?n.submit():null},input:function(e){e.target.composing||(n.content=e.target.value)}}})]),n._v(" "),t("div",{staticClass:"vssue-new-comment-footer"},[n.user?t("span",{staticClass:"vssue-current-user"},[t("span",[n._v(n._s(n.vssue.$t("currentUser"))+" - "+n._s(n.user.username)+" - ")]),n._v(" "),t("a",{staticClass:"vssue-logout",on:{click:function(e){return n.vssue.logout()}}},[n._v("\n        "+n._s(n.vssue.$t("logout"))+"\n      ")])]):t("span",{staticClass:"vssue-current-user"},[n._v("\n      "+n._s(n.vssue.$t("loginToComment",{platform:n.platform}))+"\n    ")]),n._v(" "),t("div",{staticClass:"vssue-new-comment-operations"},[n.user?t("VssueButton",{staticClass:"vssue-button-submit-comment",attrs:{type:"primary",disabled:n.isSubmitDisabled},on:{click:function(e){return n.submit()}}},[t("VssueIcon",{directives:[{name:"show",rawName:"v-show",value:n.loading,expression:"loading"}],attrs:{name:"loading"}}),n._v("\n\n        "+n._s(n.vssue.$t(n.loading?"submitting":"submitComment"))+"\n      ")],1):t("VssueButton",{staticClass:"vssue-button-login",attrs:{type:"primary",title:n.vssue.$t("loginToComment",{platform:n.platform})},on:{click:function(e){return n.vssue.login()}}},[n._v("\n        "+n._s(n.vssue.$t("login",{platform:n.platform}))+"\n      ")])],1)])])},staticRenderFns:[]},void 0,Ya,void 0,!1,void 0,!1,void 0,void 0,void 0);let Za=class extends a.b{constructor(){super(...arguments),this.progress={show:!1,percent:0,timer:null,speed:200},this.alert={show:!1,message:null,timer:null}}onLoadingCommentsChange(n){this.vssue.comments&&(n?this.progressStart():this.progressDone())}created(){this.vssue.$on("error",n=>this.alertShow(n.message))}beforeDestroy(){this.vssue.$off("error"),null!==this.progress.timer&&window.clearTimeout(this.progress.timer),null!==this.alert.timer&&window.clearTimeout(this.alert.timer)}progressStart(){this.progress.show=!0,this.progress.percent=0,this.progress.timer=window.setInterval(()=>{this.progress.percent+=5,this.progress.percent>94&&null!==this.progress.timer&&window.clearInterval(this.progress.timer)},this.progress.speed)}progressDone(){this.progress.percent=100,null!==this.progress.timer&&window.clearTimeout(this.progress.timer),this.progress.timer=null,window.setTimeout(()=>{this.progress.show=!1},this.progress.speed)}alertShow(n){this.alert.show=!0,this.alert.message=n,null!==this.alert.timer&&window.clearTimeout(this.alert.timer),this.alert.timer=window.setTimeout(()=>{this.alertHide()},3e3)}alertHide(){this.alert.show=!1,null!==this.alert.timer&&window.clearTimeout(this.alert.timer),this.alert.timer=null}};Fa([Ct()],Za.prototype,"vssue",void 0),Fa([$t("vssue.isLoadingComments")],Za.prototype,"onLoadingCommentsChange",null),Za=Fa([Object(Tt.b)({components:{TransitionFade:Ba}})],Za);const nr=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"vssue-notice"},[t("div",{directives:[{name:"show",rawName:"v-show",value:n.progress.show,expression:"progress.show"}],staticClass:"vssue-progress",style:{width:n.progress.percent+"%",transition:"all "+n.progress.speed+"ms linear"}}),n._v(" "),t("TransitionFade",[t("div",{directives:[{name:"show",rawName:"v-show",value:n.alert.show,expression:"alert.show"}],staticClass:"vssue-alert",domProps:{textContent:n._s(n.alert.message)},on:{click:function(e){return n.alertHide()}}})])],1)},staticRenderFns:[]},void 0,Za,void 0,!1,void 0,!1,void 0,void 0,void 0);let er=class extends a.b{get status(){return this.vssue.isFailed?"failed":this.vssue.isInitializing?"initializing":this.vssue.isIssueNotCreated&&!this.vssue.isCreatingIssue?this.vssue.isAdmin||!this.vssue.isLogined?"issueNotCreated":"failed":this.vssue.isLoginRequired?"loginRequired":!this.vssue.comments||this.vssue.isCreatingIssue?"loadingComments":0===this.vssue.comments.data.length?"noComments":null}handleClick(){"issueNotCreated"===this.status?this.vssue.postIssue():"loginRequired"===this.status&&this.vssue.login()}};Fa([Ct()],er.prototype,"vssue",void 0),er=Fa([Object(Tt.b)({components:{TransitionFade:Ba,VssueIcon:Ua}})],er);const tr=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("TransitionFade",[n.status?t("div",{key:n.status,staticClass:"vssue-status"},[["failed","loadingComments","initializing"].includes(n.status)?t("VssueIcon",{attrs:{name:"failed"===n.status?"error":"loading"}}):n._e(),n._v(" "),t("p",{staticClass:"vssue-status-info"},[t(["issueNotCreated","loginRequired"].includes(n.status)?"a":"span",{tag:"Component",on:{click:n.handleClick}},[n._v("\n        "+n._s(n.vssue.$t(n.status))+"\n      ")])],1)],1):n._e()])},staticRenderFns:[]},void 0,er,void 0,!1,void 0,!1,void 0,void 0,void 0);let ar=class extends a.b{};Fa([Ct()],ar.prototype,"vssue",void 0),ar=Fa([Object(Tt.b)({components:{TransitionFade:Ba,VssueIcon:Ua,VssueComments:Ga,VssueNewComment:Xa,VssueNotice:nr,VssueStatus:tr}})],ar);const rr=qa({render:function(){var n=this.$createElement,e=this._self._c||n;return e("TransitionFade",[this.vssue.isInitializing?e("VssueStatus"):e("div",{staticClass:"vssue-body"},[this.vssue.API?e("VssueNewComment"):this._e(),this._v(" "),e("VssueNotice"),this._v(" "),e("TransitionFade",[this.vssue.comments&&this.vssue.comments.data.length>0?e("VssueComments"):e("VssueStatus")],1)],1)],1)},staticRenderFns:[]},void 0,ar,void 0,!1,void 0,!1,void 0,void 0,void 0);let ir=class extends a.b{};Fa([Ct()],ir.prototype,"vssue",void 0),ir=Fa([Tt.b],ir);const or=qa({render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"vssue-header"},[t("a",{staticClass:"vssue-header-comments-count",attrs:{href:n.vssue.issue?n.vssue.issue.link:null,target:"_blank",rel:"noopener noreferrer"}},[t("span",[n._v("\n      "+n._s(n.vssue.comments?n.vssue.$tc("comments",n.vssue.comments.count,{count:n.vssue.comments.count}):n.vssue.$tc("comments",0))+"\n    ")])]),n._v(" "),t("span",{staticClass:"vssue-header-powered-by"},[t("span",[n._v("Powered by")]),n._v(" "),n.vssue.API?t("span",[t("a",{attrs:{href:n.vssue.API.platform.link,title:n.vssue.API.platform.name+" API "+n.vssue.API.platform.version,target:"_blank",rel:"noopener noreferrer"}},[n._v("\n        "+n._s(n.vssue.API.platform.name)+"\n      ")]),n._v(" "),t("span",[n._v("&")])]):n._e(),n._v(" "),t("a",{attrs:{href:"https://github.com/meteorlxy/vssue",title:"Vssue v"+n.vssue.version,target:"_blank",rel:"noopener noreferrer"}},[n._v("\n      Vssue\n    ")])])])},staticRenderFns:[]},void 0,ir,void 0,!1,void 0,!1,void 0,void 0,void 0),sr={login:"Login with {platform}",logout:"Logout",currentUser:"Current User",loading:"Loading",submit:"Submit",submitting:"Submitting",submitComment:"Submit Comment",cancel:"Cancel",edit:"Edit",editMode:"Edit Mode",delete:"Delete",reply:"Reply",heart:"Heart",like:"Like",unlike:"Unlike",perPage:"Comments per page",sort:"Click to change the sort direction",page:"Page",prev:"Previous Page",next:"Next Page",comments:"Comments | {count} Comment | {count} Comments",loginToComment:"Login with {platform} account to leave a comment",placeholder:"Leave a comment. Styling with Markdown is supported. Ctrl + Enter to submit.",noLoginPlaceHolder:"Login to leave a comment. Styling with Markdown is supported. ",failed:"Failed to load comments",initializing:"Initializing...",issueNotCreated:"Click to create issue",loadingComments:"Loading comments...",loginRequired:"Login to view comments",noComments:"No comments yet. Leave the first comment !",reactionGiven:"Already given '{reaction}' reaction",deleteConfirm:"Confirm to delete this comment ?",deleteFailed:"Failed to delete comment"},lr={login:" {platform} ",logout:"",currentUser:"",loading:"",submit:"",submitting:"",submitComment:"",cancel:"",edit:"",editMode:"",delete:"",reply:"",heart:"",like:"",unlike:"",perPage:"",sort:"",page:"",prev:"",next:"",comments:" | {count}  | {count} ",loginToComment:" {platform} ",placeholder:" Markdown Ctrl + Enter ",noLoginPlaceHolder:" Markdown ",failed:"",initializing:"...",issueNotCreated:" Issue",loadingComments:"...",loginRequired:"",noComments:"",reactionGiven:" '{reaction}' ",deleteConfirm:"",deleteFailed:""},cr={login:"Entrar com {platform}",logout:"Sair",currentUser:"Usurio Atual",loading:"Carregando",submit:"Enviar",submitting:"Enviando",submitComment:"Enviar Comentrio",cancel:"Cancelar",edit:"Editar",editMode:"Modo de Edio",delete:"Apagar",reply:"Responder",heart:"Heart",like:"Like",unlike:"Unlike",perPage:"Comentrios por pgina",sort:"Clique para alterar a ordenao",page:"Pgina",prev:"Pgina Anterior",next:"Prxima Pgina",comments:"Comentrios | {count} Comentrio | {count} Comentrios",loginToComment:"Entre com uma conta {platform} para deixar um comentrio",placeholder:"Deixe um comentrio. Estilos com Markdown suportados. Ctrl + Enter para enviar.",noLoginPlaceHolder:"Entre para deixar um comentrio. Estilos com Markdown suportados. ",failed:"Falha ao carregar comentrios",initializing:"Inicializando...",issueNotCreated:"Click to create issue",loadingComments:"Carregando comentrios...",loginRequired:"Entrar para visualizar comentrios",noComments:"Nenhum comentrio. Deixe o primeiro comentrio!",reactionGiven:"J reagiu com '{reaction}'",deleteConfirm:"Apagar este comentrio?",deleteFailed:"Falha ao apagar comentrio"},ur={login:"{platform} ",logout:"",currentUser:"",loading:"",submit:"",submitting:"",submitComment:"",cancel:"",edit:"",editMode:"",delete:"",reply:"",heart:"",like:"",unlike:"",perPage:"/",sort:"",page:"",prev:"",next:"",comments:" | {count}  | {count} ",loginToComment:" {platform} ",placeholder:"Markdown  Ctrl + Enter ",noLoginPlaceHolder:"",failed:"",initializing:"...",issueNotCreated:"Click to create issue",loadingComments:"...",loginRequired:"",noComments:"",reactionGiven:" '{reaction}' ",deleteConfirm:"",deleteFailed:""},dr={login:"  {platform}",logout:"",currentUser:"/ /",loading:"",submit:"",submitting:"",submitComment:" ",cancel:"",edit:"",editMode:" ",delete:"",reply:"",heart:"",like:"",unlike:"",perPage:" ",sort:"     ",page:"",prev:" ",next:" ",comments:" | {count}  | {count} ",loginToComment:"   {platform}   ",placeholder:" .     Markdown. Ctrl + Enter  .",noLoginPlaceHolder:"   .     Markdown. ",failed:"  ",initializing:"...",issueNotCreated:"  issue",loadingComments:" ...",loginRequired:"   ",noComments:"  .    !",reactionGiven:"   '{reaction}'",deleteConfirm:"   ?",deleteFailed:"  "};Object.prototype.hasOwnProperty.call(a.b,"$i18n")||a.b.use(Ma);const pr=new Ma({locale:"en",fallbackLocale:"en",messages:{en:sr,"en-US":sr,zh:lr,"zh-CN":lr,pt:cr,"pt-BR":cr,ja:ur,"ja-JP":ur,he:dr,"he-IL":dr}});let hr=class extends a.b{constructor(){super(...arguments),this.title=n=>`${n.prefix}${document.title}`,this.issueId=null,this.options=null,this.API=null,this.accessToken=null,this.user=null,this.issue=null,this.comments=null,this.query={page:1,perPage:10,sort:"desc"},this.isInitializing=!0,this.isIssueNotCreated=!1,this.isLoginRequired=!1,this.isFailed=!1,this.isCreatingIssue=!1,this.isLoadingComments=!1,this.isCreatingComment=!1,this.isUpdatingComment=!1}get version(){return"1.4.8"}get issueTitle(){return null===this.options?"":"function"==typeof this.title?this.title(this.options):`${this.options.prefix}${this.title}`}get isPending(){return this.isLoadingComments||this.isCreatingComment||this.isUpdatingComment}get isLogined(){return null!==this.accessToken&&null!==this.user}get isAdmin(){return null!==this.options&&null!==this.accessToken&&null!==this.user&&(this.user.username===this.options.owner||this.options.admins.includes(this.user.username))}get accessTokenKey(){return this.API?`Vssue.${this.API.platform.name.toLowerCase()}.access_token`:""}onQueryPerPageChange(){this.query.page=1,this.getComments()}onQueryChange(){this.getComments()}setOptions(n){this.options=Object.assign({labels:["Vssue"],state:"Vssue",prefix:"[Vssue]",admins:[],perPage:10,proxy:n=>"https://cors-anywhere.azm.workers.dev/"+n,issueContent:({url:n})=>n,autoCreateIssue:!1},n);const e=["api","owner","repo","clientId"];for(const n of e)this.options[n]||console.warn(`[Vssue] the option '${n}' is required`);if(this.options.locale)this.$i18n.locale=this.options.locale;else{const n=Object.keys(this.$i18n.messages),e=window.navigator.languages;this.$i18n.locale=e.filter(e=>n.includes(e)).shift()||"en"}}async init(){try{await this.initStore(),await this.initComments()}catch(n){n.response&&[401,403].includes(n.response.status)?this.isLoginRequired=!0:this.isFailed=!0,console.error(n)}}async initStore(){try{if(!this.options)throw new Error("Options are required to initialize Vssue");this.API=null,this.accessToken=null,this.user=null,this.issue=null,this.comments=null,this.query={page:1,perPage:this.options.perPage,sort:"desc"},this.isInitializing=!0,this.isIssueNotCreated=!1,this.isLoginRequired=!1,this.isFailed=!1,this.isCreatingIssue=!1,this.isLoadingComments=!1,this.isCreatingComment=!1,this.isUpdatingComment=!1;const n=this.options.api;this.API=new n({baseURL:this.options.baseURL,labels:this.options.labels,state:this.options.state,owner:this.options.owner,repo:this.options.repo,clientId:this.options.clientId,clientSecret:this.options.clientSecret,proxy:this.options.proxy}),await this.handleAuth()}finally{this.isInitializing=!1}}async initComments(){if(this.API&&this.options)if(this.issueId){const[n,e]=await Promise.all([this.API.getIssue({accessToken:this.accessToken,issueId:this.issueId}),this.API.getComments({accessToken:this.accessToken,issueId:this.issueId,query:this.query})]);this.issue=n,this.comments=e}else this.issue=await this.API.getIssue({accessToken:this.accessToken,issueTitle:this.issueTitle}),null===this.issue?(this.isIssueNotCreated=!0,this.options.autoCreateIssue&&await this.postIssue()):await this.getComments()}async postIssue(){if(this.API&&this.options&&!this.issue&&!this.issueId&&(this.isLogined||this.login(),this.isAdmin))try{this.isCreatingIssue=!0;const n=await this.API.postIssue({title:this.issueTitle,content:await this.options.issueContent({options:this.options,url:Nt(window.location.href)}),accessToken:this.accessToken});this.issue=n,this.isIssueNotCreated=!1,await this.getComments()}catch(n){this.isFailed=!0}finally{this.isCreatingIssue=!1}}async getComments(){try{if(!this.API||!this.issue||this.isLoadingComments)return;this.isLoadingComments=!0;const n=await this.API.getComments({accessToken:this.accessToken,issueId:this.issue.id,query:this.query});return this.comments=n,this.query.page!==n.page&&(this.query.page=n.page),this.query.perPage!==n.perPage&&(this.query.perPage=n.perPage),n}catch(n){if(!n.response||![401,403].includes(n.response.status)||this.isLogined)throw this.$emit("error",n),n;this.isLoginRequired=!0}finally{this.isLoadingComments=!1}}async postComment({content:n}){try{if(!this.API||!this.issue||this.isCreatingComment)return;this.isCreatingComment=!0;return await this.API.postComment({accessToken:this.accessToken,content:n,issueId:this.issue.id})}catch(n){throw this.$emit("error",n),n}finally{this.isCreatingComment=!1}}async putComment({commentId:n,content:e}){try{if(!this.API||!this.issue)return;return await this.API.putComment({accessToken:this.accessToken,issueId:this.issue.id,commentId:n,content:e})}catch(n){throw this.$emit("error",n),n}}async deleteComment({commentId:n}){try{if(!this.API||!this.issue)return;return await this.API.deleteComment({accessToken:this.accessToken,issueId:this.issue.id,commentId:n})}catch(n){throw this.$emit("error",n),n}}async getCommentReactions({commentId:n}){try{if(!this.API||!this.issue)return;return await this.API.getCommentReactions({accessToken:this.accessToken,issueId:this.issue.id,commentId:n})}catch(n){throw this.$emit("error",n),n}}async postCommentReaction({commentId:n,reaction:e}){try{if(!this.API||!this.issue)return!1;return await this.API.postCommentReaction({accessToken:this.accessToken,issueId:this.issue.id,commentId:n,reaction:e})}catch(n){throw this.$emit("error",n),n}}login(){this.API&&this.API.redirectAuth()}logout(){this.setAccessToken(null),this.user=null}async handleAuth(){if(!this.API)return;const n=await this.API.handleAuth();n?(this.setAccessToken(n),this.user=await this.API.getUser({accessToken:n})):this.getAccessToken()?this.user=await this.API.getUser({accessToken:this.accessToken}):(this.setAccessToken(null),this.user=null)}getAccessToken(){return this.accessToken=window.localStorage.getItem(this.accessTokenKey),this.accessToken}setAccessToken(n){null===n?window.localStorage.removeItem(this.accessTokenKey):window.localStorage.setItem(this.accessTokenKey,n),this.accessToken=n}};Fa([$t("query.perPage")],hr.prototype,"onQueryPerPageChange",null),Fa([$t("query.page"),$t("query.sort")],hr.prototype,"onQueryChange",null),hr=Fa([Object(Tt.b)({i18n:pr})],hr);var fr=hr;let mr=class extends a.b{constructor(){super(...arguments),this.vssue=new fr}onOptionsChange(n){this.vssue.setOptions(n)}mounted(){null!==this.title&&(this.vssue.title=this.title),null!==this.issueId&&(this.vssue.issueId=this.issueId),this.vssue.setOptions(this.options),this.vssue.init()}};var gr;Fa([Lt({type:[String,Function],required:!1,default:null})],mr.prototype,"title",void 0),Fa([Lt({type:[String,Number],required:!1,default:null})],mr.prototype,"issueId",void 0),Fa([Lt({type:Object,required:!1,default:()=>({})})],mr.prototype,"options",void 0),Fa([(gr="vssue",Object(Tt.a)((function(n,e){var t=n.provide;It(t)&&(t=n.provide=At(t)),t.managed[e]=gr||e})))],mr.prototype,"vssue",void 0),Fa([$t("options",{deep:!0})],mr.prototype,"onOptionsChange",null),mr=Fa([Object(Tt.b)({components:{Iconfont:Na,VssueBody:rr,VssueHeader:or}})],mr);const vr=qa({render:function(){var n=this.$createElement,e=this._self._c||n;return e("div",{staticClass:"vssue"},[e("Iconfont"),this._v(" "),e("VssueHeader"),this._v(" "),e("VssueBody")],1)},staticRenderFns:[]},void 0,mr,void 0,!1,void 0,!1,void 0,void 0,void 0);var yr=t(9),br=t.n(yr);function kr(n){return{username:n.login,avatar:n.avatar_url,homepage:n.html_url}}function wr(n){return{id:n.number,title:n.title,content:n.body,link:n.html_url}}function xr(n){return{like:n["+1"],unlike:n[-1],heart:n.heart}}function Sr(n){return{id:n.id,content:n.body_html,contentRaw:n.body,author:kr(n.user),createdAt:n.created_at,updatedAt:n.updated_at,reactions:xr(n.reactions)}}function _r(n){return"like"===n?"+1":"unlike"===n?"-1":n}class jr{constructor({baseURL:n="https://github.com",owner:e,repo:t,labels:a,clientId:r,clientSecret:i,state:o,proxy:s}){if(void 0===i||void 0===s)throw new Error("clientSecret and proxy is required for GitHub V3");this.baseURL=n,this.owner=e,this.repo=t,this.labels=a,this.clientId=r,this.clientSecret=i,this.state=o,this.proxy=s,this.$http=br.a.create({baseURL:"https://github.com"===n?"https://api.github.com":Mt(n,"api/v3"),headers:{Accept:"application/vnd.github.v3+json"}}),this.$http.interceptors.response.use(n=>n.data&&n.data.error?Promise.reject(new Error(n.data.error_description)):n,n=>(void 0===n.response&&"Network Error"===n.message&&(n.response={status:403}),Promise.reject(n)))}get platform(){return{name:"GitHub",link:this.baseURL,version:"v3",meta:{reactable:!0,sortable:!1}}}redirectAuth(){window.location.href=Dt(Mt(this.baseURL,"login/oauth/authorize"),{client_id:this.clientId,redirect_uri:window.location.href,scope:"public_repo",state:this.state})}async handleAuth(){const n=Bt(window.location.search);if(n.code){if(n.state!==this.state)return null;const e=n.code;delete n.code,delete n.state;const t=Dt(Nt(window.location.href),n)+window.location.hash;window.history.replaceState(null,"",t);return await this.getAccessToken({code:e})}return null}async getAccessToken({code:n}){const e=Mt(this.baseURL,"login/oauth/access_token"),t="function"==typeof this.proxy?this.proxy(e):this.proxy,{data:a}=await this.$http.post(t,{client_id:this.clientId,client_secret:this.clientSecret,code:n},{headers:{Accept:"application/json"}});return a.access_token}async getUser({accessToken:n}){const{data:e}=await this.$http.get("user",{headers:{Authorization:"token "+n}});return kr(e)}async getIssue({accessToken:n,issueId:e,issueTitle:t}){const a={};if(n&&(a.headers={Authorization:"token "+n}),!e){a.params={q:[`"${t}"`,"is:issue","in:title",`repo:${this.owner}/${this.repo}`,"is:public",...this.labels.map(n=>"label:"+n)].join(" "),timestamp:Date.now()};const{data:n}=await this.$http.get("search/issues",a);return n.items.map(wr).find(n=>n.title===t)||null}try{a.params={timestamp:Date.now()};const{data:n}=await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${e}`,a);return wr(n)}catch(n){if(n.response&&404===n.response.status)return null;throw n}}async postIssue({accessToken:n,title:e,content:t}){const{data:a}=await this.$http.post(`repos/${this.owner}/${this.repo}/issues`,{title:e,body:t,labels:this.labels},{headers:{Authorization:"token "+n}});return wr(a)}async getComments({accessToken:n,issueId:e,query:{page:t=1,perPage:a=10}={}}){const r={params:{timestamp:Date.now()}},i={params:{page:t,per_page:a,timestamp:Date.now()},headers:{Accept:["application/vnd.github.v3.raw+json","application/vnd.github.v3.html+json","application/vnd.github.squirrel-girl-preview"]}};n&&(r.headers={Authorization:"token "+n},i.headers.Authorization="token "+n);const[o,s]=await Promise.all([this.$http.get(`repos/${this.owner}/${this.repo}/issues/${e}`,r),this.$http.get(`repos/${this.owner}/${this.repo}/issues/${e}/comments`,i)]),l=s.headers.link||null,c=/rel="next"/.test(l)?Number(l.replace(/^.*[^_]page=(\d*).*rel="next".*$/,"$1"))-1:/rel="prev"/.test(l)?Number(l.replace(/^.*[^_]page=(\d*).*rel="prev".*$/,"$1"))+1:1,u=l?Number(l.replace(/^.*per_page=(\d*).*$/,"$1")):a;return{count:Number(o.data.comments),page:c,perPage:u,data:s.data.map(Sr)}}async postComment({accessToken:n,issueId:e,content:t}){const{data:a}=await this.$http.post(`repos/${this.owner}/${this.repo}/issues/${e}/comments`,{body:t},{headers:{Authorization:"token "+n,Accept:["application/vnd.github.v3.raw+json","application/vnd.github.v3.html+json","application/vnd.github.squirrel-girl-preview"]}});return Sr(a)}async putComment({accessToken:n,commentId:e,content:t}){const{data:a}=await this.$http.patch(`repos/${this.owner}/${this.repo}/issues/comments/${e}`,{body:t},{headers:{Authorization:"token "+n,Accept:["application/vnd.github.v3.raw+json","application/vnd.github.v3.html+json","application/vnd.github.squirrel-girl-preview"]}});return Sr(a)}async deleteComment({accessToken:n,commentId:e}){const{status:t}=await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${e}`,{headers:{Authorization:"token "+n}});return 204===t}async getCommentReactions({accessToken:n,commentId:e}){const{data:t}=await this.$http.get(`repos/${this.owner}/${this.repo}/issues/comments/${e}`,{params:{timestamp:Date.now()},headers:{Authorization:"token "+n,Accept:"application/vnd.github.squirrel-girl-preview"}});return xr(t.reactions)}async postCommentReaction({accessToken:n,commentId:e,reaction:t}){const a=await this.$http.post(`repos/${this.owner}/${this.repo}/issues/comments/${e}/reactions`,{content:_r(t)},{headers:{Authorization:"token "+n,Accept:"application/vnd.github.squirrel-girl-preview"}});return 200===a.status?this.deleteCommentReaction({accessToken:n,commentId:e,reactionId:a.data.id}):201===a.status}async deleteCommentReaction({accessToken:n,commentId:e,reactionId:t}){return 204===(await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${e}/reactions/${t}`,{headers:{Authorization:"token "+n,Accept:"application/vnd.github.squirrel-girl-preview"}})).status}}function Tr(n){return null===n?{username:"ghost",avatar:"https://avatars3.githubusercontent.com/u/10137?v=4",homepage:"https://github.com/ghost"}:{username:n.login,avatar:n.avatarUrl,homepage:n.url}}function Cr(n){return{id:n.number,title:n.title,content:n.body,link:n.url}}function Ar(n){return{like:n.find(n=>"THUMBS_UP"===n.content).users.totalCount,unlike:n.find(n=>"THUMBS_DOWN"===n.content).users.totalCount,heart:n.find(n=>"HEART"===n.content).users.totalCount}}function Ir(n){return{id:n.id,content:n.bodyHTML,contentRaw:n.body,author:Tr(n.author),createdAt:n.createdAt,updatedAt:n.updatedAt,reactions:Ar(n.reactionGroups)}}function Er(n){return"like"===n?"THUMBS_UP":"unlike"===n?"THUMBS_DOWN":"heart"===n?"HEART":n}class Or{constructor({baseURL:n="https://github.com",owner:e,repo:t,labels:a,clientId:r,clientSecret:i,state:o,proxy:s}){if(void 0===i||void 0===s)throw new Error("clientSecret and proxy is required for GitHub V4");this.baseURL=n,this.owner=e,this.repo=t,this.labels=a,this.clientId=r,this.clientSecret=i,this.state=o,this.proxy=s,this._pageInfo={page:1,startCursor:null,endCursor:null,sort:null,perPage:null},this._issueNodeId=null,this.$http=br.a.create({baseURL:"https://github.com"===n?"https://api.github.com":Mt(n,"api"),headers:{Accept:"application/vnd.github.v3+json"}}),this.$http.interceptors.response.use(n=>n.data.error?Promise.reject(n.data.error_description):n.data.errors?Promise.reject(n.data.errors[0].message):n)}get platform(){return{name:"GitHub",link:this.baseURL,version:"v4",meta:{reactable:!0,sortable:!0}}}redirectAuth(){window.location.href=Dt(Mt(this.baseURL,"login/oauth/authorize"),{client_id:this.clientId,redirect_uri:window.location.href,scope:"public_repo",state:this.state})}async handleAuth(){const n=Bt(window.location.search);if(n.code){if(n.state!==this.state)return null;const e=n.code;delete n.code,delete n.state;const t=Dt(Nt(window.location.href),n)+window.location.hash;window.history.replaceState(null,"",t);return await this.getAccessToken({code:e})}return null}async getAccessToken({code:n}){const e=Mt(this.baseURL,"login/oauth/access_token"),t="function"==typeof this.proxy?this.proxy(e):this.proxy,{data:a}=await this.$http.post(t,{client_id:this.clientId,client_secret:this.clientSecret,code:n},{headers:{Accept:"application/json"}});return a.access_token}async getUser({accessToken:n}){const{data:e}=await this.$http.post("graphql",{query:"query getUser {\n  viewer {\n    login\n    avatarUrl\n    url\n  }\n}"},{headers:{Authorization:"token "+n}});return Tr(e.data.viewer)}async getIssue({accessToken:n,issueId:e,issueTitle:t}){const a={};if(n&&(a.headers={Authorization:"token "+n}),!e){const n=[`"${t}"`,"in:title",`repo:${this.owner}/${this.repo}`,"is:public",...this.labels.map(n=>"label:"+n)].join(" "),{data:e}=await this.$http.post("graphql",{variables:{query:n},query:"query getIssueByTitle(\n  $query: String!\n) {\n  search(\n    query: $query\n    type: ISSUE\n    first: 20\n    ) {\n      nodes {\n      ... on Issue {\n        id\n        number\n        title\n        body\n        url\n      }\n    }\n  }\n}"},a),r=e.data.search.nodes.find(n=>n.title===t);return r?(this._issueNodeId=r.id,Cr(r)):null}try{const{data:n}=await this.$http.post("graphql",{query:`query getIssueById {\n  repository(owner: "${this.owner}", name: "${this.repo}") {\n    issue (number: ${e}) {\n      id\n      number\n      title\n      body\n      url\n    }\n  }\n}`},a);return this._issueNodeId=n.data.repository.issue.id,Cr(n.data.repository.issue)}catch(n){if(n.response&&404===n.response.status)return null;throw n}}async postIssue({accessToken:n,title:e,content:t}){const{data:a}=await this.$http.post(`repos/${this.owner}/${this.repo}/issues`,{title:e,body:t,labels:this.labels},{headers:{Authorization:"token "+n}});return a.url=a.html_url,this._issueNodeId=a.node_id,Cr(a)}async getComments({accessToken:n,issueId:e,query:{page:t=1,perPage:a=10,sort:r="desc"}={}}){const i={};n&&(i.headers={Authorization:"token "+n}),null!==this._pageInfo.sort&&r!==this._pageInfo.sort&&(t=1);const{firstOrLast:o,afterOrBefore:s,cursor:l}=this._getQueryParams({page:t,sort:r}),{data:c}=await this.$http.post("graphql",{variables:{owner:this.owner,repo:this.repo,issueId:e,perPage:a},query:`query getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${o}: $perPage\n        ${null===s?"":`${s}: "${l}"`}\n      ) {\n        totalCount\n        pageInfo {\n          endCursor\n          startCursor\n        }\n        nodes {\n          id\n          body\n          bodyHTML\n          createdAt\n          updatedAt\n          author {\n            avatarUrl\n            login\n            url\n          }\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`},i),u=c.data.repository.issue.comments;return"desc"===r&&u.nodes.reverse(),this._pageInfo={page:t,startCursor:u.pageInfo.startCursor,endCursor:u.pageInfo.endCursor,sort:r,perPage:a},{count:u.totalCount,page:t,perPage:a,data:u.nodes.map(Ir)}}async postComment({accessToken:n,content:e}){const{data:t}=await this.$http.post("graphql",{variables:{issueNodeId:this._issueNodeId,content:e},query:"mutation postComment(\n  $issueNodeId: ID!\n  $content: String!\n) {\n  addComment(\n    input: {\n      subjectId: $issueNodeId\n      body: $content\n    }\n  ) {\n    commentEdge {\n      node {\n        id\n        body\n        bodyHTML\n        createdAt\n        updatedAt\n        author {\n          avatarUrl\n          login\n          url\n        }\n        reactionGroups {\n          users (first: 0) {\n            totalCount\n          }\n          content\n        }\n      }\n    }\n  }\n}"},{headers:{Authorization:"token "+n}});return Ir(t.data.addComment.commentEdge.node)}async putComment({accessToken:n,commentId:e,content:t}){const{data:a}=await this.$http.post("graphql",{variables:{commentId:e,content:t},query:"mutation putComment(\n  $commentId: ID!,\n  $content: String!,\n) {\n  updateIssueComment(input: {\n    id: $commentId\n    body: $content\n  }) {\n    issueComment {\n      id\n      body\n      bodyHTML\n      createdAt\n      updatedAt\n      author {\n        avatarUrl\n        login\n        url\n      }\n      reactionGroups {\n        users (first: 0) {\n          totalCount\n        }\n        content\n      }\n    }\n  }\n}"},{headers:{Authorization:"token "+n}});return Ir(a.data.updateIssueComment.issueComment)}async deleteComment({accessToken:n,commentId:e}){return await this.$http.post("graphql",{variables:{commentId:e},query:"mutation deleteComment(\n  $commentId: ID!,\n) {\n  deleteIssueComment(input: {\n    id: $commentId\n  }) {\n    clientMutationId\n  }\n}"},{headers:{Authorization:"token "+n}}),!0}async getCommentReactions({accessToken:n,issueId:e,commentId:t}){const{firstOrLast:a,afterOrBefore:r,cursor:i}=this._getQueryParams(),{data:o}=await this.$http.post("graphql",{variables:{owner:this.owner,repo:this.repo,issueId:e,perPage:this._pageInfo.perPage},query:`query getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${a}: $perPage\n        ${null===r?"":`${r}: "${i}"`}\n      ) {\n        nodes {\n          id\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`},{headers:{Authorization:"token "+n}});return Ar(o.data.repository.issue.comments.nodes.find(n=>n.id===t).reactionGroups)}async postCommentReaction({accessToken:n,commentId:e,reaction:t}){return await this.$http.post("graphql",{variables:{commentId:e,content:Er(t)},query:"mutation postCommentReaction(\n  $commentId: ID!,\n  $content: ReactionContent!,\n) {\n  addReaction(input: {\n    subjectId: $commentId\n    content: $content\n  }) {\n    reaction {\n      databaseId\n    }\n  }\n}"},{headers:{Authorization:"token "+n}}),!0}_getQueryParams({page:n=this._pageInfo.page,sort:e=this._pageInfo.sort}={}){let t,a,r;return 1===n?(t="asc"===e?"first":"last",a=null,r=null):"asc"===e?n>this._pageInfo.page?(t="first",a="after",r=this._pageInfo.endCursor):(t="last",a="before",r=this._pageInfo.startCursor):n>this._pageInfo.page?(t="last",a="before",r=this._pageInfo.startCursor):(t="first",a="after",r=this._pageInfo.endCursor),{firstOrLast:t,afterOrBefore:a,cursor:r}}}function Lr(n){return{username:n.username,avatar:n.avatar_url,homepage:n.web_url}}function $r(n){return{id:n.iid,title:n.title,content:n.description,link:n.web_url}}function Pr(n){return{id:n.id,content:n.body_html||"",contentRaw:n.body,author:Lr(n.author),createdAt:n.created_at,updatedAt:n.updated_at,reactions:n.reactions}}function zr(n){return{like:n.filter(n=>"thumbsup"===n.name).length,unlike:n.filter(n=>"thumbsdown"===n.name).length,heart:n.filter(n=>"heart"===n.name).length}}function Dr(n){return"like"===n?"thumbsup":"unlike"===n?"thumbsdown":n}class Mr{constructor({baseURL:n="https://gitlab.com",owner:e,repo:t,labels:a,clientId:r,state:i}){this.baseURL=n,this.owner=e,this.repo=t,this.labels=a,this.clientId=r,this.state=i,this._encodedRepo=encodeURIComponent(`${this.owner}/${this.repo}`),this.$http=br.a.create({baseURL:Mt(n,"api/v4"),headers:{Accept:"application/json"}})}get platform(){return{name:"GitLab",link:this.baseURL,version:"v4",meta:{reactable:!0,sortable:!0}}}redirectAuth(){window.location.href=Dt(Mt(this.baseURL,"oauth/authorize"),{client_id:this.clientId,redirect_uri:window.location.href,response_type:"token",state:this.state})}async handleAuth(){const n=Bt(window.location.hash.slice(1));if(!n.access_token||n.state!==this.state)return null;const e=n.access_token;delete n.access_token,delete n.token_type,delete n.expires_in,delete n.state;const t=zt(n),a=t?"#"+t:"",r=`${Nt(window.location.href)}${window.location.search}${a}`;return window.history.replaceState(null,"",r),e}async getUser({accessToken:n}){const{data:e}=await this.$http.get("user",{headers:{Authorization:"Bearer "+n}});return Lr(e)}async getIssue({accessToken:n,issueId:e,issueTitle:t}){const a={};if(n&&(a.headers={Authorization:"Bearer "+n}),!e){a.params={labels:this.labels.join(","),order_by:"created_at",sort:"asc",search:t};const{data:n}=await this.$http.get(`projects/${this._encodedRepo}/issues`,a);return n.map($r).find(n=>n.title===t)||null}try{const{data:n}=await this.$http.get(`projects/${this._encodedRepo}/issues/${e}`,a);return $r(n)}catch(n){if(n.response&&404===n.response.status)return null;throw n}}async postIssue({accessToken:n,title:e,content:t}){const{data:a}=await this.$http.post(`projects/${this._encodedRepo}/issues`,{title:e,description:t,labels:this.labels.join(",")},{headers:{Authorization:"Bearer "+n}});return $r(a)}async getComments({accessToken:n,issueId:e,query:{page:t=1,perPage:a=10,sort:r="desc"}={}}){const i={params:{page:t,per_page:a,order_by:"created_at",sort:r}};n&&(i.headers={Authorization:"Bearer "+n});const o=await this.$http.get(`projects/${this._encodedRepo}/issues/${e}/notes`,i),s=o.data,l=[];for(const t of s)l.push((async()=>{t.body_html=await this.getMarkdownContent({accessToken:n,contentRaw:t.body})})()),l.push((async()=>{t.reactions=await this.getCommentReactions({accessToken:n,issueId:e,commentId:t.id})})());return await Promise.all(l),{count:Number(o.headers["x-total"]),page:Number(o.headers["x-page"]),perPage:Number(o.headers["x-per-page"]),data:s.map(Pr)}}async postComment({accessToken:n,issueId:e,content:t}){const{data:a}=await this.$http.post(`projects/${this._encodedRepo}/issues/${e}/notes`,{body:t},{headers:{Authorization:"Bearer "+n}});return Pr(a)}async putComment({accessToken:n,issueId:e,commentId:t,content:a}){const{data:r}=await this.$http.put(`projects/${this._encodedRepo}/issues/${e}/notes/${t}`,{body:a},{headers:{Authorization:"Bearer "+n}}),[i,o]=await Promise.all([this.getMarkdownContent({accessToken:n,contentRaw:r.body}),this.getCommentReactions({accessToken:n,issueId:e,commentId:r.id})]);return r.body_html=i,r.reactions=o,Pr(r)}async deleteComment({accessToken:n,issueId:e,commentId:t}){const{status:a}=await this.$http.delete(`projects/${this._encodedRepo}/issues/${e}/notes/${t}`,{headers:{Authorization:"Bearer "+n}});return 204===a}async getCommentReactions({accessToken:n,issueId:e,commentId:t}){const{data:a}=await this.$http.get(`projects/${this._encodedRepo}/issues/${e}/notes/${t}/award_emoji`,{headers:{Authorization:"Bearer "+n}});return zr(a)}async postCommentReaction({issueId:n,commentId:e,reaction:t,accessToken:a}){try{return 201===(await this.$http.post(`projects/${this._encodedRepo}/issues/${n}/notes/${e}/award_emoji`,{name:Dr(t)},{headers:{Authorization:"Bearer "+a}})).status}catch(n){if(n.response&&404===n.response.status)return!1;throw n}}async getMarkdownContent({accessToken:n,contentRaw:e}){const t={};n&&(t.headers={Authorization:"Bearer "+n});const{data:a}=await this.$http.post("markdown",{text:e,gfm:!0},t);return a.html}}function Fr(n){return{username:n.nickname,avatar:n.links.avatar.href,homepage:n.links.html.href}}function Rr(n){return{id:n.id,title:n.title,content:n.content.raw,link:n.links.html.href}}function qr(n){return{id:n.id,content:n.content.html,contentRaw:n.content.raw,author:Fr(n.user),createdAt:n.created_on,updatedAt:n.updated_on,reactions:null}}class Nr{constructor({baseURL:n="https://bitbucket.org",owner:e,repo:t,clientId:a,state:r}){this.baseURL=n,this.owner=e,this.repo=t,this.clientId=a,this.state=r,this.$http=br.a.create({baseURL:"https://api.bitbucket.org/2.0",headers:{Accept:"application/json"}})}get platform(){return{name:"Bitbucket",link:this.baseURL,version:"v2",meta:{reactable:!1,sortable:!0}}}redirectAuth(){window.location.href=Dt(Mt(this.baseURL,"site/oauth2/authorize"),{client_id:this.clientId,redirect_uri:window.location.href,response_type:"token",state:this.state})}async handleAuth(){const n=Bt(window.location.hash.slice(1));if(!n.access_token||n.state!==this.state)return null;const e=n.access_token;delete n.access_token,delete n.token_type,delete n.expires_in,delete n.state,delete n.scopes;const t=zt(n),a=t?"#"+t:"",r=`${Nt(window.location.href)}${window.location.search}${a}`;return window.history.replaceState(null,"",r),e}async getUser({accessToken:n}){const{data:e}=await this.$http.get("user",{headers:{Authorization:"Bearer "+n}});return Fr(e)}async getIssue({accessToken:n,issueId:e,issueTitle:t}){const a={};if(n&&(a.headers={Authorization:"Bearer "+n}),!e){a.params={sort:"created_on",q:`title="${t}"`,timestamp:Date.now()};const{data:n}=await this.$http.get(`repositories/${this.owner}/${this.repo}/issues`,a);return n.size>0?Rr(n.values[0]):null}try{a.params={timestamp:Date.now()};const{data:n}=await this.$http.get(`repositories/${this.owner}/${this.repo}/issues/${e}`,a);return Rr(n)}catch(n){if(n.response&&404===n.response.status)return null;throw n}}async postIssue({accessToken:n,title:e,content:t}){const{data:a}=await this.$http.post(`repositories/${this.owner}/${this.repo}/issues`,{title:e,content:{raw:t},priority:"trivial",kind:"task"},{headers:{Authorization:"Bearer "+n}});return a.links.html={href:Mt(this.baseURL,`${this.owner}/${this.repo}/issues/${a.id}`)},Rr(a)}async getComments({accessToken:n,issueId:e,query:{page:t=1,perPage:a=10,sort:r="desc"}={}}){const i={params:{page:t,pagelen:a,sort:"desc"===r?"-created_on":"created_on",timestamp:Date.now()}};n&&(i.headers={Authorization:"Bearer "+n});const{data:o}=await this.$http.get(`repositories/${this.owner}/${this.repo}/issues/${e}/comments`,i);return{count:o.size,page:o.page,perPage:o.pagelen,data:o.values.filter(n=>null!==n.content.raw).map(qr)}}async postComment({accessToken:n,issueId:e,content:t}){const{data:a}=await this.$http.post(`repositories/${this.owner}/${this.repo}/issues/${e}/comments`,{content:{raw:t}},{headers:{Authorization:"Bearer "+n}});return qr(a)}async putComment({accessToken:n,issueId:e,commentId:t,content:a}){const{data:r}=await this.$http.put(`repositories/${this.owner}/${this.repo}/issues/${e}/comments/${t}`,{content:{raw:a}},{headers:{Authorization:"Bearer "+n}});return qr(r)}async deleteComment({accessToken:n,issueId:e,commentId:t}){const{status:a}=await this.$http.delete(`repositories/${this.owner}/${this.repo}/issues/${e}/comments/${t}`,{headers:{Authorization:"Bearer "+n}});return 204===a}async getCommentReactions(n){throw new Error("501 Not Implemented")}async postCommentReaction(n){throw new Error("501 Not Implemented")}}function Br(n){return{username:n.login,avatar:n.avatar_url,homepage:n.html_url}}function Ur(n){return{id:n.number,title:n.title,content:n.body,link:n.html_url}}function Jr(n){return{id:n.id,content:n.body_html||"",contentRaw:n.body,author:Br(n.user),createdAt:n.created_at,updatedAt:n.updated_at||"",reactions:null}}class Vr{constructor({baseURL:n="https://gitee.com",owner:e,repo:t,labels:a,clientId:r,clientSecret:i,state:o,proxy:s}){if(void 0===i||void 0===s)throw new Error("clientSecret and proxy is required for Gitee V5");this.baseURL=n,this.owner=e,this.repo=t,this.labels=a,this.clientId=r,this.clientSecret=i,this.state=o,this.proxy=s,this.$http=br.a.create({baseURL:Mt(n,"api/v5")}),this.$http.interceptors.response.use(n=>n,n=>(n.response.data&&n.response.data.message&&(n.message=n.response.data.message),Promise.reject(n)))}get platform(){return{name:"Gitee",link:this.baseURL,version:"v5",meta:{reactable:!1,sortable:!1}}}redirectAuth(){window.location.href=Dt(Mt(this.baseURL,"oauth/authorize"),{client_id:this.clientId,redirect_uri:window.location.href,scope:"user_info issues notes",response_type:"code",state:this.state})}async handleAuth(){const n=Bt(window.location.search);if(n.code){if(n.state!==this.state)return null;const e=n.code;delete n.code,delete n.state;const t=Dt(Nt(window.location.href),n)+window.location.hash;window.history.replaceState(null,"",t);return await this.getAccessToken({code:e})}return null}async getAccessToken({code:n}){const e=Mt(this.baseURL,"oauth/token"),t="function"==typeof this.proxy?this.proxy(e):this.proxy,{data:a}=await this.$http.post(t,{client_id:this.clientId,client_secret:this.clientSecret,code:n,grant_type:"authorization_code",redirect_uri:window.location.href});return a.access_token}async getUser({accessToken:n}){const{data:e}=await this.$http.get("user",{params:{access_token:n}});return Br(e)}async getIssue({accessToken:n,issueId:e,issueTitle:t}){const a={params:{timestamp:Date.now()}};if(n&&(a.params.access_token=n),!e){Object.assign(a.params,{q:t,repo:`${this.owner}/${this.repo}`,per_page:1});const{data:n}=await this.$http.get("search/issues",a);return n.map(Ur).find(n=>n.title===t)||null}try{const{data:n}=await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${e}`,a);return Ur(n)}catch(n){if(n.response&&404===n.response.status)return null;throw n}}async postIssue({accessToken:n,title:e,content:t}){const{data:a}=await this.$http.post(`repos/${this.owner}/issues`,{access_token:n,repo:this.repo,title:e,body:t,labels:this.labels.join(",")});return Ur(a)}async getComments({accessToken:n,issueId:e,query:{page:t=1,perPage:a=10}={}}){const r={params:{page:t,per_page:a,timestamp:Date.now()},headers:{Accept:["application/vnd.gitee.html+json"]}};n&&(r.params.access_token=n);const i=await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${e}/comments`,r);return{count:Number(i.headers.total_count),page:t,perPage:a,data:i.data.map(Jr)}}async postComment({accessToken:n,issueId:e,content:t}){const{data:a}=await this.$http.post(`repos/${this.owner}/${this.repo}/issues/${e}/comments`,{body:t,access_token:n},{headers:{Accept:["application/vnd.gitee.html+json"]}});return Jr(a)}async putComment({accessToken:n,commentId:e,content:t}){const{data:a}=await this.$http.patch(`repos/${this.owner}/${this.repo}/issues/comments/${e}`,{body:t,access_token:n},{headers:{Accept:["application/vnd.gitee.html+json"]}});return Jr(a)}async deleteComment({accessToken:n,commentId:e}){const{status:t}=await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${e}`,{params:{access_token:n}});return 204===t}async getCommentReactions(n){throw new Error("501 Not Implemented")}async postCommentReaction(n){throw new Error("501 Not Implemented")}}t(328);var Wr={name:"Vssue",components:{VssueComponent:vr},props:{options:{type:Object,default:()=>({})}},data:()=>({key:"key",platformOptions:{github:jr,"github-v4":Or,gitlab:Mr,bitbucket:Nr,gitee:Vr}}),computed:{vssueOptions(){const{platformOptions:n,options:e}=this,t=n[e.platform];return{...e,api:t}}},watch:{$route(n,e){n.path!==e.path&&setTimeout(()=>{this.key="reco-"+(new Date).getTime()},300)}}},Hr=(t(329),{components:{Valine:jt,Vssue:Object(Ue.a)(Wr,(function(){return(0,this._self._c)("VssueComponent",{key:this.key,staticClass:"vssue-wrapper",attrs:{options:this.vssueOptions}})}),[],!1,null,null,null).exports},props:{isShowComments:{type:Boolean,default:!0}},data:()=>({commentsOptions:{solution:"vssue",options:{title:"vblog",platform:"github",owner:"lowskylee",repo:"vblog",clientId:"37da52dd478c000f6e16",clientSecret:"44055d7a85a0964de4a16cbdd133a81144b74c4d"}}}),computed:{solution(){const{commentsOptions:{solution:n},$themeConfig:{valineConfig:e,vssueConfig:t},$themeLocaleConfig:{valineConfig:a,vssueConfig:r}}=this;let i="";return void 0!==n?i=n:void 0!==a||void 0!==e?i="valine":void 0===r&&void 0===t||(i="vssue"),i},options(){const{commentsOptions:{options:n},$themeConfig:{valineConfig:e,vssueConfig:t},$themeLocaleConfig:{valineConfig:a,vssueConfig:r}}=this;return void 0!==n?n:void 0!==a||void 0!==e?a||e:void 0!==r||void 0!==t?r||t:null},componentName(){const n=this.solution;return"valine"===n?"Valine":"vssue"===n?"Vssue":""}},mounted(){this.$themeConfig.commentsSolution=this.solution}}),Qr=Object(Ue.a)(Hr,(function(){var n=this._self._c;return n("div",{directives:[{name:"show",rawName:"v-show",value:this.isShowComments,expression:"isShowComments"}],staticClass:"comments-wrapper"},[n("ClientOnly",[n(this.componentName,{tag:"component",attrs:{options:this.options}})],1)],1)}),[],!1,null,null,null).exports,Gr={props:{idVal:String,numStyle:Object,flagTitle:{type:String,default:"Your Article Title"}},methods:{getIdVal(n){const e=this.$site.base;return e.slice(0,e.length-1)+n}}},Kr=Object(Ue.a)(Gr,(function(){var n=this._self._c;return n("span",{staticClass:"leancloud-visitors",attrs:{id:this.getIdVal(this.idVal),"data-flag-title":this.flagTitle}},[n("a",{staticClass:"leancloud-visitors-count",style:this.numStyle})])}),[],!1,null,null,null).exports,Yr=(t(330),Object(Ue.a)({},(function(){var n=this,e=n._self._c;return e("div",{attrs:{id:"loader-wrapper"}},[e("div",{staticClass:"loader-main"},n._l(4,(function(n){return e("div",{key:"out"+n})})),0),n._v(" "),n.$frontmatter.home?e("h3",{staticClass:"title"},[n._v(n._s(n.$site.title||n.$localeConfig.title))]):n._e(),n._v(" "),n.$frontmatter.home?e("p",{staticClass:"description"},[n._v(n._s(n.$site.description||n.$localeConfig.description))]):n._e()])}),[],!1,null,"d48f4d20",null).exports),Xr=[({Vue:n,siteData:e,isServer:t,router:a})=>{n.mixin(Qe),n.mixin(tt),Object(at.c)(a),Object(at.a)(a)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},({Vue:n})=>{n.component("BackToTop",it)},({Vue:n})=>{n.component("Pagation",pt)},({Vue:n})=>{n.mixin({computed:{$perPage:()=>10}})},{},({Vue:n})=>{const e=Object.keys(ht).map(n=>{const e=ht[n],t="$"+n;return{[t](){const{pages:n}=this.$site;return new ft(e,n)},["$current"+(n.charAt(0).toUpperCase()+n.slice(1))](){const n=this.$route.meta.id;return this[t].getItemByName(n)}}}).reduce((n,e)=>(Object.assign(n,e),n),{});e.$frontmatterKey=function(){const n=this["$"+this.$route.meta.id];return n||null},n.mixin({computed:e})},({Vue:n})=>{n.mixin({computed:{$pagination(){return this.$route.meta.pid&&this.$route.meta.id?this.$getPagination(this.$route.meta.pid,this.$route.meta.id):null}},methods:{$getPagination(n,e){return e=e||n,yt.getPagination(n,e,this.$route)}}})},({Vue:n})=>{const e={$service:()=>bt};n.mixin({computed:e})},wt,({Vue:n})=>{n.component("KanBanNiang",St)},({Vue:n})=>{n.component("Comments",Qr),n.component("AccessNumber",Kr)},({Vue:n})=>{n.component("LoadingPage",Yr)}],Zr=["BackToTop","KanBanNiang"];class ni extends class{constructor(){this.store=new a.b({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){a.b.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign(ni.prototype,{getPageAsyncComponent:ce,getLayoutAsyncComponent:ue,getAsyncComponent:de,getVueComponent:pe});var ei={install(n){const e=new ni;n.$vuepress=e,n.prototype.$vuepress=e}};function ti(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var ai={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return fe("pageKey",e),a.b.component(e)||a.b.component(e,ce(e)),a.b.component(e)?n(e):n("")}},ri={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},ii={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},oi=(t(331),t(332),Object(Ue.a)(ii,(function(){var n=this._self._c;return n("span",[n("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[n("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),n("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),n("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),si={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};a.b.config.productionTip=!1,a.b.use(Hn),a.b.use(ei),a.b.mixin(function(n,e,t=a.b){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const r=new(n(t.$vuepress.$get("siteData"))),i=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(r)),o={};return Object.keys(i).reduce((n,e)=>(e.startsWith("$")&&(n[e]=i[e].get),n),o),{computed:o}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const a in n)"/"===a?t=n[a]:0===this.$page.path.indexOf(a)&&(e=n[a]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,a=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?a?a+" | "+t:t:a||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const a=n[t];if(a.path.toLowerCase()===e.toLowerCase())return a}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},We)),a.b.component("Content",ai),a.b.component("ContentSlotsDistributor",ri),a.b.component("OutboundLink",oi),a.b.component("ClientOnly",si),a.b.component("Layout",ue("Layout")),a.b.component("NotFound",ue("NotFound")),a.b.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.9",hash:"9d3c126"},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:We.routerBase||We.base,t=new Hn({base:e,mode:"history",fallback:!1,routes:Ve,scrollBehavior:(n,e,t)=>t||(n.hash?!a.b.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,a)=>{if(ti(n,e.path))a();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";ti(n,t)?a(t):a()}else a();else{const t=e.path+"/",r=e.path+".html";ti(n,r)?a(r):ti(n,t)?a(t):a()}})}(t);const r={};try{await Promise.all(Xr.filter(n=>"function"==typeof n).map(e=>e({Vue:a.b,options:r,router:t,siteData:We,isServer:n})))}catch(n){console.error(n)}return{app:new a.b(Object.assign(r,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Zr.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);